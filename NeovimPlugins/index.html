<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Neovim Plugins</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#resources">Resources</a></li><li><a href="#basics">Basics</a></li><li><a href="#buiding-a-plugin">Buiding a Plugin</a></li><li><a href="#installing-a-plugin">Installing a Plugin</a></li><li><a href="#testing-a-plugin">Testing a Plugin</a></li><li><a href="#lua_path">LUA_PATH</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p>This article describes how to implement and share a custom plugin.</p><h2 id="resources" tabindex="-1">Resources</h2><ul><li><a href="https://www.youtube.com/watch?v=PdaObkGazoU&t=924s?v=1.0.21" rel="noopener" target="_blank">Writing Plugins - It's Never Been Easier</a> by DevOnDuty</li><li><a href="https://www.youtube.com/watch?v=9gUatBHuXE0?v=1.0.21" rel="noopener" target="_blank">Automatically Execute <em>Anything</em> in Nvim</a></li><li><a href="https://www.youtube.com/watch?v=HlfjpstqXwE?v=1.0.21" rel="noopener" target="_blank">Execute <strong>anything</strong> in neovim (now customizable)</a></li></ul><h2 id="basics" tabindex="-1">Basics</h2><p>There are four ways to trigger a Lua function in Neovim. Begin by defining a function in any buffer such as:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">Greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Hello!"</span><span class="token punctuation">)</span> <span class="token keyword">end</span></code></pre><p>The first way to run the function is to source the file and use the <code>lua</code> command. The <code>%</code> represents the current buffer.</p><pre class="language-bash"><code class="language-bash">:so %<br>:lua Greet<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>The second way to run the function is to create a user command. Add the following after the function definition inside the buffer. The last argument is a table of options.</p><pre class="language-lua"><code class="language-lua">vim<span class="token punctuation">.</span>api<span class="token punctuation">.</span><span class="token function">nvim_create_user_command</span><span class="token punctuation">(</span><span class="token string">"Greet"</span><span class="token punctuation">,</span> Greet<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>Now source the buffer and use the new command.</p><pre class="language-bash"><code class="language-bash">:so %<br>:Greet</code></pre><p>The third way to run the function is to create an autocommand and cause the action that triggers it. Add the following after the function definition inside the buffer.</p><pre class="language-lua"><code class="language-lua">vim<span class="token punctuation">.</span>api<span class="token punctuation">.</span><span class="token function">nvim_create_autocmd</span><span class="token punctuation">(</span><span class="token string">"event-name"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> callback <span class="token operator">=</span> Greet <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>To get a list of supported event names, ...</p><p>This can be triggered multiple times. To see all the output, enter <code>:messages</code>.</p><p>The fourth way to run the function is to define a key mapping and type the key sequence. Add the following after the function definition inside the buffer. &quot;n&quot; is for normal mode. TODO: Is &quot;<leader>g&quot; already in use?</leader></p><pre class="language-lua"><code class="language-lua">vim<span class="token punctuation">.</span>keymap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"n"</span><span class="token punctuation">,</span> <span class="token string">"&lt;leader>g"</span><span class="token punctuation">,</span> Greet<span class="token punctuation">)</span></code></pre><h2 id="buiding-a-plugin" tabindex="-1">Buiding a Plugin</h2><p>To build a Neovim plugin that can be shared with others:</p><ol><li><p>Create a directory for the plugin. It is common for Neovim plugin repositories to have names that end in &quot;.nvim&quot;. For example, &quot;greet.nvim&quot;</p></li><li><p>Create a <code>README.md</code> file in this directory that describes the functionality of the plugin and the steps to install it.</p></li><li><p>Create a <code>lua</code> directory inside it.</p></li><li><p>Create the file <code>{plugin-name}.lua</code> inside the <code>lua</code> directory.</p></li><li><p>In this file, define and return a Lua module. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> M <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br>M<span class="token punctuation">.</span>greet <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Hello!"</span><span class="token punctuation">)</span> <span class="token keyword">end</span><br><span class="token keyword">return</span> M</code></pre></li><li><p>Create a GitHub repository for the plugin and push this directory to it.</p></li></ol><h2 id="installing-a-plugin" tabindex="-1">Installing a Plugin</h2><p>There are several popular plugin managers for Neovim. One that is highly recommended is <a href="https://github.com/folke/lazy.nvim?v=1.0.21" rel="noopener" target="_blank">lazy.nvim</a>. The instructions here assume that this plugin manager is being used.</p><p>Create the file <code>~/.config/nvim/lua/user/plugins/greet.lua</code> containing the following:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">return</span> <span class="token punctuation">{</span><br>  <span class="token comment">-- "{github-account}/{repository-name}"</span><br>  <span class="token string">"mvolkmann/greet.nvim"</span><br><span class="token punctuation">}</span></code></pre><p>In Neovim, enter <code>:Lazy sync</code></p><h2 id="testing-a-plugin" tabindex="-1">Testing a Plugin</h2><p>A single command can be entered inside Neovim to load a plugin and exercise one of the functions it defines. For example, to verify that the &quot;greet.nvim&quot; plugin was installed, enter the following in Neovim:</p><pre class="language-text"><code class="language-text">:lua require("greet").greet("World")`</code></pre><p>This should display &quot;Hello, World!&quot; in the message area at the bottom.</p><h2 id="lua_path" tabindex="-1">LUA_PATH</h2><p>To see the places that the Lua <code>require</code> function looks for <code>.lua</code> files, enter <code>lua</code> to start it in interactive mode and then enter <code>print(package.path)</code>. By default this will include the following:</p><ul><li><code>/usr/local/share/lua/5.4/?.lua</code></li><li><code>/usr/local/share/lua/5.4/?/init.lua</code></li><li><code>/usr/local/lib/lua/5.4/?.lua</code></li><li><code>/usr/local/lib/lua/5.4/?/init.lua</code></li><li><code>/?.lua</code></li><li><code>/?/init.lua</code></li></ul><p>To add more paths to the beginning of this list, define the environment variable <code>LUA_PATH</code>. For example, when using zsh, add the following in <code>~/.zshrc</code>:</p><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">LUA_PATH</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${<span class="token environment constant">HOME</span>}</span>/lua/?.lua;;"</span></code></pre><p>The second semicolon at the end is replaced by the current value of <code>package.path</code>.</p><p>For me this adds <code>/Users/volkmannm/lua/?.lua;</code> to the beginning. This makes it so searches for <code>.lua</code> files begins in the <code>lua</code> subdirectory of my home directory.</p><p>To automatically require files from this directory on startup of Neovim, add calls to the <code>require</code> function in <code>~/.config/nvim/lua/user/init.lua</code>.</p></article>