<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Nearley</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#installing">Installing</a></li><li><a href="#builtins">Builtins</a></li><li><a href="#creating-a-grammar">Creating a Grammar</a></li><li><a href="#compiling-a-grammar">Compiling a Grammar</a></li><li><a href="#testing-a-grammar">Testing a Grammar</a></li><li><a href="#using-a-grammar-from-javascript-code">Using a Grammar from JavaScript Code</a></li><li><a href="#producing-asts">Producing ASTs</a></li><li><a href="#railroad-diagrams">Railroad Diagrams</a></li><li><a href="#unparsing">Unparsing</a></li></ol></nav></aside><article><style>img {
    border: 1px solid gray;
  }</style><h2 id="overview" tabindex="-1">Overview</h2><p><a href="https://nearley.js.org?v=1.1.1" rel="noopener" target="_blank">nearley</a> is a parsing toolkit with many features including:</p><ul><li>Handles all BNF grammars, including those with left recursion.</li><li>Can produce abstract syntax trees, text output, or simply validate input.</li><li>Provides a testing tool (<code>nearley-test</code>).</li><li>Provides a railroad diagram generator that creates HTML files that include SVG-based diagrams (<code>nearley-railroad</code>).</li><li>Works with many lexers including <a href="https://github.com/no-context/moo?v=1.1.1" rel="noopener" target="_blank">Moo</a>.</li></ul><p>The nearley library:</p><ul><li>can be used in both server-side and browser JavaScript code.</li><li>uses the Earley algorithm</li><li>implements right recursion optimizations from Joop Leo</li><li>can produce random strings that match a given grammar</li><li>has editor plug-ins that provide syntax highlighting for VS Code (from Pouya Kary), Sublime Text, and Vim</li><li>has been maintained by volunteers since 2014</li></ul><h2 id="installing" tabindex="-1">Installing</h2><p>To install nearley global so its tools can be used from the command line, enter <code>npm install -g nearley</code>.</p><p>To install nearley in a node project, enter <code>npm install nearley</code>.</p><p>Installing nearley also installs the Moo lexer library.</p><h2 id="builtins" tabindex="-1">Builtins</h2><p>Nearley provides files that define commonly used grammar rules and functions. These are found at <a href="https://github.com/kach/nearley/tree/master/builtin">https://github.com/kach/nearley/tree/master/builtin</a>.</p><p><code>number.ne</code> defines the grammar rules:</p><ul><li><code>unsigned_int</code></li><li><code>int</code>,</li><li><code>unsigned_decimal</code></li><li><code>decimal</code></li><li><code>percentage</code></li><li><code>jsonfloat</code></li></ul><p><code>postprocessors.ne</code> defines the following functions that are used inside the postprocesssor code associated with grammar rules:</p><ul><li><code>nth</code></li><li><code>$</code></li><li><code>delimited</code></li></ul><p><code>string.ne</code> defines the grammar rules:</p><ul><li><code>dqstring</code> for strings delimited by double quotes</li><li><code>sqstring</code> for strings delimited by single quotes</li><li><code>btquote</code> for strings delimited by backticks</li></ul><p><code>whitespace.ne</code> defines the grammar rules:</p><ul><li><code>_</code> matches zero or more whitespace characters.</li><li><code>__</code> matches one or more whitespace characters.</li></ul><p>To include these files in <code>.ne</code> grammar file, use the <code>@builtin</code> directive. For example, <code>@builtin &quot;whitespace.ne&quot;</code>.</p><h2 id="creating-a-grammar" tabindex="-1">Creating a Grammar</h2><p>Grammars are defined in text files with a <code>.ne</code> file extension. The first grammar rule defines the starting point. The remaining rules can appear in any order, including alphabetical.</p><h2 id="compiling-a-grammar" tabindex="-1">Compiling a Grammar</h2><p>To compile a grammar to JavaScript code, use the <code>nearleyc</code> command. For example, <code>nearlyc my-grammar.ne -o my-grammar.js</code>.</p><h2 id="testing-a-grammar" tabindex="-1">Testing a Grammar</h2><p>To test a grammar with specific input, use the <code>nearley-test</code> command. For example, `nearly-test my-grammar.js -i 'some test input'.</p><h2 id="using-a-grammar-from-javascript-code" tabindex="-1">Using a Grammar from JavaScript Code</h2><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> nearley <span class="token keyword">from</span> <span class="token string">'nearley'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> grammar <span class="token keyword">from</span> <span class="token string">'./grammar2.js'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"><br>a := 1.<br>b := 2.<br>c := a + b.<br></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">nearley<span class="token punctuation">.</span>Parser</span><span class="token punctuation">(</span>nearley<span class="token punctuation">.</span>Grammar<span class="token punctuation">.</span><span class="token function">fromCompiled</span><span class="token punctuation">(</span>grammar<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">try</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> output <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">feed</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> nodes <span class="token operator">=</span> output<span class="token punctuation">.</span>results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'nodes ='</span><span class="token punctuation">,</span> nodes<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h2 id="producing-asts" tabindex="-1">Producing ASTs</h2><p>Abstract syntax trees (ASTs) describe the results of parsing input text. They have many uses, including generating code in some programming language.</p><p>Each grammar rule can be followed by postprocessing code that is delimited by <code>{%</code> and <code>%}</code>.</p><p>The code must be the name of a predefined function or a function definition. The function is passed a data argument commonly named <code>d</code> whose value is an array. The function can return an AST node.</p><h2 id="railroad-diagrams" tabindex="-1">Railroad Diagrams</h2><p>To generate a railroad diagram from a grammar, use the <code>nearley-railroad</code> command. For example, <code>nearly-railroad my-grammar.ne -o my-grammar.html</code>. To view the diagram, open the generated <code>.html</code> in any web browser.</p><h2 id="unparsing" tabindex="-1">Unparsing</h2><p>TODO: What does the <code>nearly-unparse</code> command do? Does in generate input that produces given output?</p></article>