<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Prisma</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#installing">Installing</a></li><li><a href="#example-schema">Example Schema</a></li><li><a href="#creating-client-instance">Creating Client Instance</a></li><li><a href="#creating-a-record">Creating a Record</a></li><li><a href="#querying-records">Querying Records</a></li><li><a href="#updating-records">Updating Records</a></li><li><a href="#deleting-records">Deleting Records</a></li><li><a href="#pagination">Pagination</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p><a href="https://www.prisma.io?v=1.0.21" rel="noopener" target="_blank">Prisma</a> is the &quot;next-generation Node.js and TypeScript ORM&quot;.</p><p>Prisma supports managing and interacting with the following databases:</p><ul><li>CockroachDB</li><li>Microsoft SQL Server</li><li>MongoDB</li><li>MySQL</li><li>PostgreSQL</li><li>SQLite</li></ul><p>Prisma can be used in the following JavaScript/TypeScript environments:</p><ul><li>AdonisJs</li><li>Express</li><li>koa</li><li>Fastify</li><li>Feathers</li><li>Foal TS</li><li>hapi</li><li>Micro</li><li>NestJS</li><li>Next.js</li><li>Polka</li><li>Sails</li></ul><p>Prisma consists of three parts:</p><ul><li>&quot;Prisma Client&quot; is an &quot;auto-generated and type-safe query builder for Node.js &amp; TypeScript&quot;. It allows interacting with databases using an API rather than SQL statements.</li><li>&quot;Prisma Migrate&quot; is a tool for migrating database schemas when changes are required.</li><li>&quot;Prisma Studio&quot; is a &quot;GUI to view and edit data in your database&quot;.</li></ul><h2 id="installing" tabindex="-1">Installing</h2><p>Enter the following commands to create a project that uses Prisma, TypeScript, and SQLite. Slightly different steps are needed to add use of Prisma to an existing project and select different options.</p><ol><li><code>mkdir my-project</code></li><li><code>cd my-project</code></li><li><code>npm init -y</code></li><li><code>npm install -D typescript ts-node @types/node</code></li><li><code>npm tsc --init</code></li><li><code>npm install -D prisma</code></li><li><code>npx prisma init --datasource-provider sqlite</code></li><li>Add your schema definition in the file <code>prisma/schema.prisma</code>. This has it's own syntax which is similar to DDL, but not identical. This can also be generated from the schema of an existing database. See &quot;Example Schema&quot; below.</li><li><code>npx prisma migrate dev --name init</code></li><li><code>npm install @prisma/client</code></li><li><code>prisma generate</code></li></ol><h2 id="example-schema" tabindex="-1">Example Schema</h2><p>This example comes from the Prisma <a href="https://www.prisma.io/docs/getting-started/quickstart?v=1.0.21" rel="noopener" target="_blank">Quickstart</a> page.</p><pre><code>model User {
  id    Int     @id @default(autoincrement())
  email String  @unique
  name  String?
  posts Post[]
}

model Post {
  id        Int     @id @default(autoincrement())
  title     String
  content   String?
  published Boolean @default(false)
  author    User    @relation(fields: [authorId], references: [id])
  authorId  Int
}  id    Int     @id @default(autoincrement())
</code></pre><h2 id="creating-client-instance" tabindex="-1">Creating Client Instance</h2><ol><li><p>Create an instance of the generated <code>PrismaClient</code> with the following code:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> PrismaClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@prisma/client'</span><br><span class="token keyword">const</span> prisma <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrismaClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></li></ol><h2 id="creating-a-record" tabindex="-1">Creating a Record</h2><p>The following example creates a User record and an associated Address record.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> prisma<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token comment">// id is an autoincrement property.</span><br>    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Mark Volkmann'</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token string">'mark@gmail.com'</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>      <span class="token literal-property property">create</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>        <span class="token literal-property property">street</span><span class="token operator">:</span> <span class="token string">'123 Some Street'</span><br>        <span class="token literal-property property">city</span><span class="token operator">:</span> <span class="token string">'Somewhere'</span><span class="token punctuation">,</span><br>        <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token string">'CA'</span><span class="token punctuation">,</span><br>        <span class="token literal-property property">zip</span><span class="token operator">:</span> <span class="token number">123456</span><br>      <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="querying-records" tabindex="-1">Querying Records</h2><p>The following query retrieves all users have a Gmail email address and live in California.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">await</span> prisma<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">findMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token literal-property property">where</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">endsWith</span><span class="token operator">:</span> <span class="token string">'@gmail.com'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token string">'CA'</span> <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><h2 id="updating-records" tabindex="-1">Updating Records</h2><p>The following code updates the email address of a User with a given id.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> prisma<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token literal-property property">where</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">12345678</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token string">'richard@gmail.com'</span> <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="deleting-records" tabindex="-1">Deleting Records</h2><p>The following code deletes one User record with a given id.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> prisma<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">deleteMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token literal-property property">where</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">12345678</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The following code deletes all User records with a state of &quot;CA&quot;.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">await</span> prisma<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">deleteMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token literal-property property">where</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token string">'CA'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="pagination" tabindex="-1">Pagination</h2><p>Prisma supports <a href="https://www.prisma.io/docs/concepts/components/prisma-client/pagination?v=1.0.21" rel="noopener" target="_blank">pagination</a> with the <code>skip</code> and <code>take</code> properties of the object passed to the <code>findMany</code> method.</p></article>