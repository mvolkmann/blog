<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><link rel="stylesheet" href="/blog/assets/github-actions.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>GitHub Actions</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#configuring-workflows">Configuring Workflows</a></li><li><a href="#workflow-jobs">Workflow Jobs</a></li><li><a href="#workflow-steps">Workflow Steps</a></li><li><a href="#supported-webhook-events">Supported Webhook Events</a></li><li><a href="#scheduled-workflows">Scheduled Workflows</a></li><li><a href="#manually-triggered-workflows">Manually Triggered Workflows</a></li><li><a href="#operating-system">Operating System</a></li><li><a href="#viewing-action-results">Viewing Action Results</a></li><li><a href="#workflow-templates">Workflow Templates</a></li><li><a href="#popular-predefined-actions">Popular Predefined Actions</a></li><li><a href="#multi-line-steps">Multi-line Steps</a></li><li><a href="#workflow-errors">Workflow Errors</a></li><li><a href="#using-secrets">Using Secrets</a></li><li><a href="#building-and-publishing-an-eleventy-site">Building and Publishing an Eleventy Site</a></li><li><a href="#manually-triggering-a-workflow">Manually Triggering a Workflow</a></li><li><a href="#output-with-echo">Output with echo</a></li><li><a href="#shell-scripts">Shell Scripts</a></li><li><a href="#contexts">Contexts</a></li><li><a href="#sending-email">Sending Email</a></li><li><a href="#conditional-steps">Conditional Steps</a></li><li><a href="#setting-output">Setting Output</a></li><li><a href="#multiple-workflows">Multiple Workflows</a></li><li><a href="#defining-actions">Defining Actions</a></li></ol></nav></aside><article><h3 id="overview">Overview</h3><p>GitHub Actions enable registering &quot;jobs&quot; to run on a cloud server in response to GitHub events. The cloud server must have the GitHub Actions runner application is installed. GitHub provides these servers for free, but it is also possible to run jobs on your own servers.</p><ul><li>A &quot;<strong>workflow</strong>&quot; defines a set of jobs using a YAML file.</li><li>A &quot;<strong>job</strong>&quot; defines a set up steps to run in given environments (ex. <code>ubuntu-latest</code>).</li><li>A &quot;<strong>step</strong>&quot; is a single task that runs a predefined action or a shell command.</li></ul><p>For example, a workflow can build an application after every push to given branches. This can include running linters, code formatters, and tests. Executed workflows and their output appear in the &quot;Actions&quot; tab of each GitHub repository.</p><p>A shell command can run a shell script or a CLI command such as those provided by <code>npm</code>. Examples include <code>npm install</code>, <code>npm run lint</code>, and <code>npm test</code>.</p><p>There are over 3,000 predefined actions to choose from, cataloged at <a href="https://github.com/actions">https://github.com/actions</a> and <a href="https://github.com/marketplace?type=actions">https://github.com/marketplace?type=actions</a>. Many of these are commercial, but there are over 200 that have a free tier.</p><h3 id="configuring-workflows">Configuring Workflows</h3><p>Workflows for a repository are configured by YAML files in the <code>.github/workflows</code> directory. Any number of workflows can be triggered by a single GitHub event. For details on the syntax of these files, see <a href="https://help.github.com/en/actions/reference/workflow-syntax-for-github-actions">https://help.github.com/en/actions/reference/workflow-syntax-for-github-actions</a>.</p><p>Here is a simple example defined in a file named <code>demo.yml</code>. It uses an action defined at <a href="https://github.com/actions/hello-world-javascript-action">https://github.com/actions/hello-world-javascript-action</a>. The code that implements actions is automatically retrieved from their GitHub repositories.</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> My Demo <span class="token comment"># workflow name</span><br><span class="token key atrule">on</span><span class="token punctuation">:</span> push<br><span class="token key atrule">jobs</span><span class="token punctuation">:</span><br>  <span class="token key atrule">build</span><span class="token punctuation">:</span> <span class="token comment"># job id</span><br>    <span class="token key atrule">name</span><span class="token punctuation">:</span> DemoJob <span class="token comment"># job name</span><br>    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest<br>    <span class="token key atrule">steps</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Hello<br>        <span class="token key atrule">id</span><span class="token punctuation">:</span> hello <span class="token comment"># used below to refer to output from this step</span><br>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/hello<span class="token punctuation">-</span>world<span class="token punctuation">-</span>javascript<span class="token punctuation">-</span>action@master<br>        <span class="token key atrule">with</span><span class="token punctuation">:</span> <span class="token comment"># specifies arguments to the action</span><br>          <span class="token key atrule">who-to-greet</span><span class="token punctuation">:</span> <span class="token string">'Mark Volkmann'</span><br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Time<br>        <span class="token key atrule">run</span><span class="token punctuation">:</span> echo 'The time was $<span class="token punctuation">{</span><span class="token punctuation">{</span> steps.hello.outputs.time <span class="token punctuation">}</span><span class="token punctuation">}</span>.'</code></pre><p>This executes on every push to the repository on any branch.</p><p>The <code>on</code> property can be set to one webhook event name or an array of them. There are many webhook events that can trigger a workflow to run. These are documented at <a href="https://help.github.com/en/actions/reference/events-that-trigger-workflows">https://help.github.com/en/actions/reference/events-that-trigger-workflows</a>. Some events are triggered by more than one kind of activity. When this is the case, a particular activity type can be specified.</p><h3 id="workflow-jobs">Workflow Jobs</h3><p>In the workflow defined above, <code>build</code> is a job id. This workflow defines a single job. Defining multiple jobs is useful to allow some steps to run on a server that uses a different operating system.</p><h3 id="workflow-steps">Workflow Steps</h3><p>Each step (a.k.a. action) within a job is defined by a number of properties.</p><table><thead><tr><th>Property Name</th><th>Meaning</th></tr></thead><tbody><tr><td><code>name</code></td><td>optional step name that appears in the web UI that shows workflow results</td></tr><tr><td><code>run</code></td><td>a shell command to run</td></tr><tr><td><code>uses</code></td><td>a predefined action to use</td></tr><tr><td><code>with</code></td><td>arguments to pass to the action</td></tr><tr><td><code>id</code></td><td>name that will be used to refer to action result properties</td></tr><tr><td><code>needs</code></td><td>step name (or array of them) that must completed before this step begins</td></tr><tr><td><code>if</code></td><td>for conditional execution</td></tr></tbody></table><p>Specify <code>run</code> or <code>uses</code>, but not both.</p><p>If a step does not have a <code>name</code> property, a name is created from the value of <code>run</code> or <code>uses</code>.</p><p>The <code>id</code> property specifies a property name whose value will be an object with an <code>outputs</code> property that is an object that holds all the output values. Actions typically document their outputs. In the example above, the action creates an output named <code>time</code> which can be accessed with <code>steps.hello.outputs.time</code> because the value of <code>id</code> is <code>hello</code>. The action sets this to the time at which it was executed.</p><h3 id="supported-webhook-events">Supported Webhook Events</h3><table><tr><th>Webhook Event</th><th>Triggered By</th></tr><tr><td>check_run</td><td>the "check runs" API is invoked; can check code in various ways (ex. linting)</td></tr><tr><td>check_suite</td><td>a suite of check runs is executed</td></tr><tr><td class="bold">create</td><td>a branch or tag is created</td></tr><tr><td class="bold">delete</td><td>a branch or tag is deleted</td></tr><tr><td>deployment</td><td>a request to deploy a branch, SHA, or tag is received</td></tr><tr><td>deployment_status</td><td>a deployment status is provided by an HTTP POST request to a GitHub API</td></tr><tr><td class="bold">fork</td><td>a repository is forked</td></tr><tr><td class="bold">gollum</td><td>a wiki page is created or updated</td></tr><tr><td class="bold">issue_comment</td><td>an issue comment is created, edited, or deleted</td></tr><tr><td class="bold">issues</td><td>an issue is opened, edited, deleted, transferred, pinned, unpinned, closed, reopened, assigned, unassigned, labeled, unlabeled, locked, unlocked, milestoned, or demilestoned</td></tr><tr><td>label</td><td>a label is created, edited, or deleted</td></tr><tr><td>milestone</td><td>a milestone is created, closed, opened, edited, or deleted</td></tr><tr><td class="bold">page_build</td><td>a GitHub Pages-enabled branch is pushed</td></tr><tr><td class="bold">project</td><td>a project within a repo is created, updated, closed, reopened, edited, or deleted (see the "Projects" tab in a GitHub repo to manage project tasks)</td></tr><tr><td class="bold">project_card</td><td>a project card is created, moved, converted to an issue, edited, or deleted</td></tr><tr><td class="bold">project_column</td><td>a project column is created, updated, moved, or deleted</td></tr><tr><td>public</td><td>a private repo is changed to public</td></tr><tr><td class="bold">pull_request</td><td>a pull request is opened, assigned, unassigned, labeled, unlabeled, edited, closed, reopened, synchronize(d), ready_for_review, locked, unlocked, review_requested, or review_request_removed</td></tr><tr><td class="bold">pull_request_review</td><td>a pull request review is submitted, edited, or dismissed</td></tr><tr><td class="bold">pull_request_review_comment</td><td>a pull request review comment is created, edited, or deleted</td></tr><tr><td class="bold">push</td><td>a commit is pushed</td></tr><tr><td>registry_package</td><td>a registry package (npm alternative) is published or updated</td></tr><tr><td class="bold">release</td><td>a release is created, published, unpublished, edited, prereleased, or deleted</td></tr><tr><td>status</td><td>the status of a commit changes</td></tr><tr><td class="bold">watch</td><td>a user watches or stars the repository</td></tr></table><h3 id="scheduled-workflows">Scheduled Workflows</h3><p>A workflow can be scheduled to run at a certain time interval by defining a &quot;scheduled event&quot;. For example, adding the following in a workflow YAML file causes the jobs that follow it to run every five minutes:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">on</span><span class="token punctuation">:</span><br>  <span class="token key atrule">schedule</span><span class="token punctuation">:</span><br>    <span class="token punctuation">-</span> <span class="token key atrule">cron</span><span class="token punctuation">:</span> <span class="token string">'*/5 * * * *'</span></code></pre><p>The parts of the <code>cron</code> value, in order, are minutes (0-59), hours (0-23), day of month (1-31), month (1-12), and day of week (0-6). An asterisk is treated as a wildcard character, allowing any value. Specifying a minute value with <code>*/n</code> means to run at every nth interval, so <code>*/5</code> runs every five minutes.</p><h3 id="manually-triggered-workflows">Manually Triggered Workflows</h3><p>A workflow can be triggered to run by dispatching a <code>repository_dispatch</code> event. This is done by sending an HTTP POST request to a GitHub API endpoint.</p><p>Define the events that should trigger a workflow in a workflow YAML file as follows:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">on</span><span class="token punctuation">:</span><br>  <span class="token key atrule">repository_dispatch</span><span class="token punctuation">:</span><br>    <span class="token key atrule">types</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>start<span class="token punctuation">-</span>my<span class="token punctuation">-</span>workflow<span class="token punctuation">]</span></code></pre><p>For details on sending a POST request for the specified event type in order to trigger the workflow, see <a href="https://developer.github.com/v3/repos/#create-a-repository-dispatch-event">https://developer.github.com/v3/repos/#create-a-repository-dispatch-event</a> and <a href="https://dev.to/teamhive/triggering-github-actions-using-repository-dispatches-39d1">https://dev.to/teamhive/triggering-github-actions-using-repository-dispatches-39d1</a>. These describe the required request headers (including an <code>Authorization</code> header containing a personal access token) and body.</p><h3 id="operating-system">Operating System</h3><p>For workflows that will run on a GitHub-hosted server (a.k.a. runner), the operating system of the server can be specified. This can be the latest version of a particular OS or a specific version. Current options include:</p><ul><li><code>ubuntu-latest</code></li><li><code>windows-latest</code></li><li><code>macos-latest</code></li><li><code>ubuntu-18.04</code></li><li><code>ubuntu-16.04</code></li><li><code>windows-2019</code></li><li><code>macos-10.15</code></li></ul><p>Workflows can also be self-hosted. An example of specifying this is:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">runs-on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>self<span class="token punctuation">-</span>hosted<span class="token punctuation">,</span> linux<span class="token punctuation">]</span></code></pre><h3 id="viewing-action-results">Viewing Action Results</h3><p>After a workflow is triggered, click the &quot;Actions&quot; tab of the GitHub repository to refresh the list of triggered workflows. This can be done repeatedly until the workflow appears.</p><p><img src="/blog/assets/github-actions-web-ui-1.png" alt="GitHub Actions web UI #1"></p><p>The workflows that have been executed can be filtered on the event that triggered them (ex. &quot;push&quot;), their status (ex. &quot;success&quot; or &quot;failure&quot;), the targeted branch, and the GitHub user name that triggered it.</p><p>Clicking a workflow row displays details about its execution.</p><p><img src="/blog/assets/github-actions-web-ui-2.png" alt="GitHub Actions web UI #1"></p><p>Click a job name (ex. &quot;DemoJob&quot;) in the left nav to see details. This displays information about the steps &quot;Set up job&quot;, &quot;Complete job&quot;, and each named step in the workflow, &quot;Hello&quot; and &quot;Time&quot; in this example. Click the disclosure triangle in front of a step name to see its detail.</p><p>The &quot;Set up job&quot; step sets up the cloud environment where the workflow will execute and downloads all predefined actions that will executed.</p><p>The &quot;Complete job&quot; step tears down the cloud environment, stopping any processes that were started.</p><p>Here we see the &quot;Set up job&quot; and &quot;Hello&quot; steps expanded.</p><p><img src="/blog/assets/github-actions-web-ui-3.png" alt="GitHub Actions web UI #1"></p><p>The &quot;Set up job&quot; step shows the operating system that was used and actions that were downloaded (ex. &quot;hello-world-javascript-action&quot;).</p><p>Next, we see the &quot;Time&quot; and &quot;Complete Job&quot; steps expanded. In this example the &quot;Time&quot; step shows the time at which the &quot;Hello&quot; step was executed.</p><p><img src="/blog/assets/github-actions-web-ui-4.png" alt="GitHub Actions web UI #2"></p><h3 id="workflow-templates">Workflow Templates</h3><p>A workflow can be created from the GitHub web UI. Click the &quot;Actions&quot; tab and press the &quot;New workflow&quot; button. This presents a series of boxes that describe workflow templates. Click the &quot;Set up this workflow&quot; button inside one of the boxes to create a workflow based on that template.</p><p>Here is an example workflow file created from the &quot;Node.js&quot; template:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> Node.js CI<br><br><span class="token key atrule">on</span><span class="token punctuation">:</span><br>  <span class="token key atrule">push</span><span class="token punctuation">:</span><br>    <span class="token key atrule">branches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>master<span class="token punctuation">]</span><br>  <span class="token key atrule">pull_request</span><span class="token punctuation">:</span><br>    <span class="token key atrule">branches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>master<span class="token punctuation">]</span><br><br><span class="token key atrule">jobs</span><span class="token punctuation">:</span><br>  <span class="token key atrule">build</span><span class="token punctuation">:</span><br>    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest<br><br>    <span class="token key atrule">strategy</span><span class="token punctuation">:</span><br>      <span class="token key atrule">matrix</span><span class="token punctuation">:</span><br>        <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>10.x<span class="token punctuation">,</span> 12.x<span class="token punctuation">]</span><br><br>    <span class="token key atrule">steps</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2<br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Use Node.js $<span class="token punctuation">{</span><span class="token punctuation">{</span> matrix.node<span class="token punctuation">-</span>version <span class="token punctuation">}</span><span class="token punctuation">}</span><br>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v1<br>        <span class="token key atrule">with</span><span class="token punctuation">:</span><br>          <span class="token key atrule">node-version</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> matrix.node<span class="token punctuation">-</span>version <span class="token punctuation">}</span><span class="token punctuation">}</span><br>      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm ci<br>      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm run build <span class="token punctuation">-</span><span class="token punctuation">-</span>if<span class="token punctuation">-</span>present<br>      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm test<br>        <span class="token key atrule">env</span><span class="token punctuation">:</span><br>          <span class="token key atrule">CI</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></code></pre><p>After clicking the button, it offers to save this workflow file in <code>.github/workflows/nodejs.yml</code> within your repository. You can customize the file name and the workflow definition if desired.</p><p>When ready to save it, press the &quot;Start Commit&quot; button in the upper-right. A dialog will appear. Optionally enter a commit comment and press the &quot;Commit new file&quot; button. Do a &quot;git pull&quot; to get the new workflow file in your local repository. The new workflow will be scheduled to run immediately. Click the &quot;Actions&quot; tab to see the results.</p><p>Two events trigger this workflow to execute. The first is a push to the master branch. The second is creating a pull request on the master branch.</p><p>Setting <code>strategy.matrix.node-version</code> to an array of version numbers causes it to execute the steps in each listed version of Node. To only use the latest version starting with 12, remove <code>strategy.matrix.node-version</code> and change the <code>node-version</code> property for the <code>setup-node</code> step to <code>12.x</code> instead of <code>${{ matrix.node-version }}</code>.</p><p>This workflow runs the following commands:</p><ul><li><code>actions/checkout@v2</code> is a predefined action that checks out the most recent commit to a given branch which defaults to &quot;master&quot;. See <a href="https://github.com/actions/checkout?v=1.0.17" rel="noopener" target="_blank">checkout</a> for options.</li><li><code>actions/setup-node@v1</code> is a predefined action that sets the Node environment. It uses a version specified in <code>strategy.matrix.node-version</code> unless the <code>node-version</code> property is specified. When the matrix property specifies Node versions, the version used in a particular run becomes part of the step name. See <a href="https://github.com/actions/setup-node?v=1.0.17" rel="noopener" target="_blank">setup-node</a> for options.</li><li><code>npm ci</code> does a clean install of all dependencies. It is similar to <code>npm install</code>, but differs the following ways:<ul><li>If the <code>node_modules</code> directory exists, it is deleted.</li><li>The file <code>package-lock.json</code> must exist.</li><li>It is an error if <code>package.json</code> specifies different dependencies or versions than <code>package-lock.json</code>.</li><li>The <code>package-lock.json</code> file is not be updated.</li></ul></li><li><code>npm run build --if-present</code> runs the <code>build</code> script if it is defined, but it is not treated as an error if it is missing.</li><li><code>npm test</code> runs tests using the commands in the <code>test</code> script. This sets the <code>CI</code> environment variable to <code>true</code> which means that warnings from tests will be treated as errors and cause the build to fail.</li></ul><h3 id="popular-predefined-actions">Popular Predefined Actions</h3><p>The following action checks out the repository in the cloud environment.</p><ul><li><code>actions/checkout@v2</code><br>This is used by many predefined workflows.</li></ul><p>The following actions setup the environment to use a particular programming language.</p><ul><li><p><code>actions/setup-go@v1</code><br>This is used by the &quot;Go&quot; workflow.</p></li><li><p><code>actions/setup-java@v1</code><br>This is used by the &quot;Java with Gradle&quot; and &quot;Java with Maven&quot; workflows.</p></li><li><p><code>actions/setup-node@v1</code><br>This is used by the &quot;Node.js&quot; and &quot;Publish Node.js package&quot; workflows.</p></li><li><p><code>actions/setup-python@v1</code><br>This is used by the &quot;Python application&quot;, &quot;Python package&quot;, and &quot;Publish Python package&quot; workflows.</p></li></ul><p>The following actions are used by the &quot;Deploy to Amazon ECS&quot; workflow for AWS.</p><ul><li><code>aws-actions/configure-aws-credentials@v1</code></li><li><code>aws-actions/amazon-ecr-login@v1</code></li><li><code>aws-actions/amazon-ecs-render-task-definition@v1</code></li><li><code>aws-actions/amazon-ecs-deploy-task-definition@v1</code></li></ul><p>The following action is used by the &quot;Build and Deploy to GKE&quot; workflow for GCP. GKE stands for &quot;Google Kubernetes Engine&quot;. GCP stands for &quot;Google Cloud Platform&quot;.</p><ul><li><code>GoogleCloudPlatform/github-actions/setup-gcloud@master</code></li></ul><h3 id="multi-line-steps">Multi-line Steps</h3><p>In this example, there are multiple, consecutive steps that each run one command.</p><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm ci<br><span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm run lint<br><span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm run format<br><span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm run build</code></pre><p>Alternatively, this can be written as a single step with multiple commands as follows:</p><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"><br>    npm ci<br>    npm run lint<br>    npm run format<br>    npm run build</span></code></pre><h3 id="workflow-errors">Workflow Errors</h3><p>If a workflow step results in an error, subsequent steps will not be executed. For example, this could happen if there is a code linting error, a compiler error, or a test failure.</p><p>If there are any errors, the repository owner will receive an email with the subject &quot;[{username}/{repo-name}] Run failed: {workflow-name} - {branch-name}&quot;. The email will include two links that can be clicked to see the results. The link containing the failed job name is more informative than the link containing &quot;View results&quot;.</p><h3 id="using-secrets">Using Secrets</h3><p>To use secret information like passwords and tokens in a workflow, create GitHub secrets.</p><p>To add a secret to a GitHub repo:</p><ul><li>Browse the GitHub repo.</li><li>Click the &quot;Settings&quot; tab.</li><li>Click &quot;Secrets&quot; in the left nav.</li><li>Click &quot;Add a new secret&quot;.</li><li>Enter a name (ex. GH_TOKEN).</li><li>Enter a value (ex. paste your GitHub personal access token).</li><li>Click &quot;Add secret&quot;.</li></ul><p>Secrets can then be referenced by name in a workflow with the syntax <code>${{ secrets.name }}</code> where <code>name</code> is the secret name. This is used in the workflow in the next section.</p><h3 id="building-and-publishing-an-eleventy-site">Building and Publishing an Eleventy Site</h3><p>Here is a workflow file that builds and deploys an Eleventy site on every push.</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> Eleventy build and deploy<br><span class="token key atrule">on</span><span class="token punctuation">:</span><br>  <span class="token key atrule">push</span><span class="token punctuation">:</span><br>    <span class="token key atrule">branches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>master<span class="token punctuation">]</span><br><span class="token key atrule">jobs</span><span class="token punctuation">:</span><br>  <span class="token key atrule">build-and-deploy</span><span class="token punctuation">:</span><br>    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest<br>    <span class="token key atrule">steps</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2<br>      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v1<br>        <span class="token key atrule">with</span><span class="token punctuation">:</span><br>          <span class="token key atrule">node-version</span><span class="token punctuation">:</span> 14.x<br>      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm ci<br>      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm run lint<br>      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm run format<br>      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm run build<br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> site deploy<br>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> peaceiris/actions<span class="token punctuation">-</span>gh<span class="token punctuation">-</span>pages@v3<br>        <span class="token key atrule">with</span><span class="token punctuation">:</span><br>          <span class="token key atrule">github_token</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.GH_TOKEN <span class="token punctuation">}</span><span class="token punctuation">}</span><br>          <span class="token key atrule">publish_dir</span><span class="token punctuation">:</span> ./_site</code></pre><p>For more details on the &quot;site deploy&quot; step, see <a href="https://github.com/peaceiris/actions-gh-pages">https://github.com/peaceiris/actions-gh-pages</a>.</p><h3 id="manually-triggering-a-workflow">Manually Triggering a Workflow</h3><p>Currently there is no way to manually trigger a workflow from the GitHub web UI. It is a frequently requested feature, as indicated at <a href="https://github.community/t5/GitHub-Actions/GitHub-Actions-Manual-Trigger-Approvals/td-p/31504?v=1.0.17" rel="noopener" target="_blank">feature request</a>.</p><p>However, workarounds are possible. One workaround is to configure a workflow to be triggered when the repository is starred. This is done by changing the <code>on</code> property at the top of a workflow file to the following:</p><pre class="language-json"><code class="language-json">on<span class="token operator">:</span><br>  push<span class="token operator">:</span> # existing event<br>    branches<span class="token operator">:</span> <span class="token punctuation">[</span>master<span class="token punctuation">]</span><br>  watch<span class="token operator">:</span> # newly added event<br>    types<span class="token operator">:</span> <span class="token punctuation">[</span>started<span class="token punctuation">]</span> # triggered by starring the repo<br>    # Why is the event name <span class="token string">"started"</span>?  Looks like a typo.</code></pre><h3 id="output-with-echo">Output with echo</h3><p>When running in a Linux environment, a step can use the <code>echo</code> command to produce output. For example:</p><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> hello world<br>  <span class="token key atrule">run</span><span class="token punctuation">:</span> echo "Hello<span class="token punctuation">,</span> World<span class="token tag">!</span>"</code></pre><p>To see the output, browse the GitHub repository, click the &quot;Actions&quot; tab, select the workflow, select the job, and click the disclosure triangle for the step. If the step has no disclosure triangle, click the ellipsis in the upper-right and select &quot;View raw logs&quot;.</p><h3 id="shell-scripts">Shell Scripts</h3><p>A step can execute a shell script that exists in the repository. For example:</p><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> run shell script<br>  <span class="token key atrule">run</span><span class="token punctuation">:</span> . ./bin/example.sh</code></pre><h3 id="contexts">Contexts</h3><p>A large amount of context information is available in workflows. It is stored in the following context objects: <code>env</code>, <code>github</code>, <code>job</code>, <code>matrix</code>, <code>needs</code>, <code>runner</code>, <code>secrets</code>, <code>steps</code>, and <code>strategy</code>. To learn more about these, see <a href="https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts?v=1.0.17" rel="noopener" target="_blank">contexts</a>.</p><p>To output the data in a particular context in a step, use the <code>toJson</code> function to put the JSON representation of the object in an environment variable and then use an <code>echo</code> shell command to output it. For example:</p><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Dump GitHub context<br>  <span class="token key atrule">env</span><span class="token punctuation">:</span><br>    <span class="token key atrule">GITHUB_CONTEXT</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> toJson(github) <span class="token punctuation">}</span><span class="token punctuation">}</span><br>  <span class="token key atrule">run</span><span class="token punctuation">:</span> echo "$GITHUB_CONTEXT"</code></pre><h3 id="sending-email">Sending Email</h3><p>A step can send an email. For example, this workflow sends an email when a project board in the repository changes.</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> GitHub Project changes<br><span class="token key atrule">on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>project<span class="token punctuation">,</span> project_card<span class="token punctuation">,</span> project_column<span class="token punctuation">]</span><br><span class="token key atrule">jobs</span><span class="token punctuation">:</span><br>  <span class="token key atrule">project-change</span><span class="token punctuation">:</span><br>    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest<br>    <span class="token key atrule">steps</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> dump GitHub context to discover available data<br>        <span class="token key atrule">env</span><span class="token punctuation">:</span><br>          <span class="token key atrule">GITHUB_CONTEXT</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> toJson(github) <span class="token punctuation">}</span><span class="token punctuation">}</span><br>        <span class="token key atrule">run</span><span class="token punctuation">:</span> echo "$GITHUB_CONTEXT"<br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> email summary<br>        <span class="token key atrule">id</span><span class="token punctuation">:</span> projectChange<br>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> dawidd6/action<span class="token punctuation">-</span>send<span class="token punctuation">-</span>mail@v2<br>        <span class="token key atrule">with</span><span class="token punctuation">:</span><br>          <span class="token key atrule">server_address</span><span class="token punctuation">:</span> smtp.gmail.com<br>          <span class="token key atrule">server_port</span><span class="token punctuation">:</span> <span class="token number">465</span><br>          <span class="token key atrule">username</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span>secrets.MAIL_USERNAME<span class="token punctuation">}</span><span class="token punctuation">}</span><br>          <span class="token key atrule">password</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span>secrets.MAIL_PASSWORD<span class="token punctuation">}</span><span class="token punctuation">}</span><br>          <span class="token key atrule">subject</span><span class="token punctuation">:</span> blog project change<br>          <span class="token key atrule">body</span><span class="token punctuation">:</span> <span class="token punctuation">></span><span class="token scalar string"><br>            A change was detected in the<br>            &lt;a href="https://github.com/mvolkmann/blog/projects/3">project board&lt;/a><br>            of the GitHub repository ${{github.repository}}.<br>            &lt;br><br>            updated by ${{ github.actor }}<br>            at ${{ github.event.project_card.updated_at }}<br>            &lt;br><br>            event name = ${{ github.event_name }}<br>            &lt;br><br>            event action = ${{ github.event.action}}<br>            &lt;br><br>            event changes = ${{ toJson(github.event.changes) }}<br>            &lt;br><br>            card note = ${{ github.event.project_card.note }}</span><br>          <span class="token key atrule">to</span><span class="token punctuation">:</span> r.mark.volkmann@gmail.com<br>          <span class="token key atrule">from</span><span class="token punctuation">:</span> Mark Volkmann<br>          <span class="token key atrule">content_type</span><span class="token punctuation">:</span> text/html</code></pre><p>This requires adding secrets with the names <code>MAIL_USERNAME</code> and <code>MAIL_PASSWORD</code>. These steps assume that Gmail is being used.</p><ol><li>Browse <a href="https://myaccount.google.com/">https://myaccount.google.com/</a>.</li><li>Click &quot;Security&quot; in the left nav.</li><li>In the &quot;Signing in to Google&quot; panel, click &quot;App passwords&quot;.</li><li>In the &quot;Select app&quot; drop-down at the bottom, select &quot;Mail&quot;.</li><li>In the &quot;Select device&quot; drop-down, select your current device type.</li><li>Press the &quot;GENERATE&quot; button.</li><li>Copy the displayed password.</li><li>Browse the GitHub repository for the workflow being created.</li><li>Click the &quot;Settings&quot; tab.</li><li>Click &quot;Secrets&quot; in the left nav.</li><li>Click &quot;Add a new secret&quot;.</li><li>Enter &quot;MAIL_USERNAME&quot; for the name.</li><li>Enter your Google username.</li><li>Press the &quot;Add secret&quot; button.</li><li>Click &quot;Add a new secret&quot;.</li><li>Enter &quot;MAIL_PASSWORD&quot; for the name.</li><li>Paste the generated password for the value.</li><li>Press the &quot;Add secret&quot; button.</li></ol><p>For more detail in the <code>action-send-mail</code> action, see <a href="https://github.com/dawidd6/action-send-mail">https://github.com/dawidd6/action-send-mail</a>.</p><h3 id="conditional-steps">Conditional Steps</h3><p>A step can include an <code>if</code> property to make its execution conditional. For a list of available variables that can be used in the condition, see <a href="https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts">https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts</a>.</p><p>One variable that can be used holds the name of the event that triggered the workflow. The following step outputs this:</p><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> report event<br>  <span class="token key atrule">run</span><span class="token punctuation">:</span> echo github.event_name = $<span class="token punctuation">{</span><span class="token punctuation">{</span> github.event_name<span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>For example, a step can execute only if the workflow was triggered by a particular event.</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> Demo trigger on watch<br><span class="token key atrule">on</span><span class="token punctuation">:</span><br>  <span class="token key atrule">push</span><span class="token punctuation">:</span><br>    <span class="token key atrule">branches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>master<span class="token punctuation">]</span><br>  <span class="token key atrule">watch</span><span class="token punctuation">:</span><br>    <span class="token key atrule">types</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>started<span class="token punctuation">]</span><br><span class="token key atrule">jobs</span><span class="token punctuation">:</span><br>  <span class="token key atrule">demo</span><span class="token punctuation">:</span><br>    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest<br>    <span class="token key atrule">steps</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> manual trigger<br>        <span class="token key atrule">if</span><span class="token punctuation">:</span> github.event_name == 'watch'<br>        <span class="token key atrule">run</span><span class="token punctuation">:</span> echo "I was manually triggered."</code></pre><p>To trigger this workflow, star the repo. To trigger it again, unstar and star the repo again.</p><p>The reported action name will be the workflow name rather than a commit message since it was not triggered by a commit.</p><h3 id="setting-output">Setting Output</h3><p>A step can set output that can be used in subsequent steps. It uses some crazy syntax to do this. For example:</p><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> set some output<br>  <span class="token key atrule">run</span><span class="token punctuation">:</span> echo "<span class="token punctuation">:</span><span class="token punctuation">:</span>set<span class="token punctuation">-</span>output name=foo<span class="token punctuation">:</span><span class="token punctuation">:</span>bar"<br>  <span class="token key atrule">id</span><span class="token punctuation">:</span> my_id<br><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> use some output<br>  <span class="token key atrule">run</span><span class="token punctuation">:</span> echo $<span class="token punctuation">{</span><span class="token punctuation">{</span>steps.my_id.outputs.foo<span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>This outputs &quot;bar&quot;.</p><h3 id="multiple-workflows">Multiple Workflows</h3><p>A repository can define any number of workflows by creating multiple YAML files in the <code>.github/workflows</code> directory.</p><p>An event can trigger any number of workflows. Each triggered workflow appears in the &quot;Actions&quot; tab of the GitHub web UI for the repository as a separate entry. When triggered by a push, they will all have the same title which is a commit comment. Below each title is the workflow name which is what distinguishes them. Click them one at a time to see their results.</p><h3 id="defining-actions">Defining Actions</h3><p>An action is defined by a YAML file that describes an object with the following properties:</p><ul><li><code>name</code>: the action name</li><li><code>description</code>: a description of the action</li><li><code>author</code>: GitHub username of the action author</li><li><code>inputs</code>: an object where the keys are input names and the values are objects with <code>description</code> and <code>default</code> properties</li><li><code>outputs</code>: an object where the keys are output names and the values are objects with a <code>description</code> property</li><li><code>runs</code>: an object with <code>using</code> and <code>main</code> properties The value of <code>main</code> is the code to execute. The value of <code>using</code> describes the runtime to use for <code>main</code> such as <code>node12</code>.</li></ul><p>Actions can be implemented in a Docker container using any programming language supported by Docker. They can also be implemented outside of a Docker container using JavaScript.</p><p>Actions that are intended to be used by only a single repository can be defined in that repository. Actions that are intended to be shared across projects should be defined in their own GitHub repository.</p><p>When a workflow uses an action, it can specify the version to use with semantic versioning (major.minor.patch) or just a major version number.</p><p>Let's define a JavaScript action that outputs the day of the week for the current date or a provided date.</p><p>Create the directory <code>src/actions/day-week</code>. In this directory, create the file <code>action.yml</code> with the following content to describe the action:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">'Day of Week'</span><br><span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">'outputs the day of the week for today or a given date'</span><br><span class="token key atrule">author</span><span class="token punctuation">:</span> <span class="token string">'mvolkmann'</span><br><span class="token key atrule">inputs</span><span class="token punctuation">:</span><br>  <span class="token key atrule">date</span><span class="token punctuation">:</span><br>    <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">'a date in the format "yyyy-mm-dd" or the string "today"'</span><br>    <span class="token key atrule">default</span><span class="token punctuation">:</span> <span class="token string">'today'</span><br><span class="token key atrule">outputs</span><span class="token punctuation">:</span><br>  <span class="token key atrule">dayOfWeek</span><span class="token punctuation">:</span><br>    <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">'a day of the week'</span><br><span class="token key atrule">runs</span><span class="token punctuation">:</span><br>  <span class="token key atrule">using</span><span class="token punctuation">:</span> <span class="token string">'node12'</span><br>  <span class="token key atrule">main</span><span class="token punctuation">:</span> <span class="token string">'index.js'</span></code></pre><p>In the same directory, create the file <code>index.js</code> that implements the action.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> core <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@actions/core'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Can access information about the</span><br><span class="token comment">// GitHub repository that is using this action.</span><br><span class="token comment">//const github = require('@actions/github');</span><br><br><span class="token keyword">const</span> days <span class="token operator">=</span> <span class="token punctuation">[</span><br>  <span class="token string">'Sunday'</span><span class="token punctuation">,</span><br>  <span class="token string">'Monday'</span><span class="token punctuation">,</span><br>  <span class="token string">'Tuesday'</span><span class="token punctuation">,</span><br>  <span class="token string">'Wednesday'</span><span class="token punctuation">,</span><br>  <span class="token string">'Thursday'</span><span class="token punctuation">,</span><br>  <span class="token string">'Friday'</span><span class="token punctuation">,</span><br>  <span class="token string">'Saturday'</span><br><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br><span class="token keyword">try</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> dateString <span class="token operator">=</span> core<span class="token punctuation">.</span><span class="token function">getInput</span><span class="token punctuation">(</span><span class="token string">'date'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> date <span class="token operator">=</span> dateString <span class="token operator">===</span> <span class="token string">'today'</span> <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>dateString<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> dayOfWeek <span class="token operator">=</span> days<span class="token punctuation">[</span>date<span class="token punctuation">.</span><span class="token function">getDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dateString<span class="token punctuation">,</span> <span class="token string">'is on a'</span><span class="token punctuation">,</span> dayOfWeek<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  core<span class="token punctuation">.</span><span class="token function">setFailed</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>To use this action, add the following steps to a workflow:</p><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> get day of week for today<br>  <span class="token key atrule">uses</span><span class="token punctuation">:</span> ./src/actions/day<span class="token punctuation">-</span>of<span class="token punctuation">-</span>week<br><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> get day of week for my birthday<br>  <span class="token key atrule">uses</span><span class="token punctuation">:</span> ./src/actions/day<span class="token punctuation">-</span>of<span class="token punctuation">-</span>week<br>  <span class="token key atrule">with</span><span class="token punctuation">:</span><br>    <span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token string">'1961-4-16'</span></code></pre><p>For more details on defining JavaScript actions, see <a href="https://help.github.com/en/actions/building-actions/creating-a-javascript-action">https://help.github.com/en/actions/building-actions/creating-a-javascript-action</a>.</p></article>