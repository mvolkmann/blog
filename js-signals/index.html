<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>JavaScript Signals</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#define-state">Define State</a></li><li><a href="#define-computed-state">Define Computed State</a></li><li><a href="#retrieve-state">Retrieve State</a></li><li><a href="#modify-state">Modify State</a></li><li><a href="#execute-code-when-state-changes">Execute Code When State Changes</a></li><li><a href="#effect-function">effect Function</a></li><li><a href="#utility-functions">Utility Functions</a></li><li><a href="#demo-app">Demo App</a></li></ol></nav></aside><article><figure style="width: 30%"><img alt="OCaml logo" style="border: 0" src="/blog/assets/signals-logo.png?v=1.1.1"></figure><h3 id="overview" tabindex="-1">Overview</h3><p>The <a href="https://github.com/tc39/proposal-signals" target="_blank">JavaScript Signals standard proposal</a> aims to provide a standard way to manage state in JavaScript applications that is &quot;reactive&quot;. This is useful in both user interface and server-side code.</p><p>The design is the result of collaboration between the teams from Angular, Ember, MobX, Preact, Qwik, RxJS, Solid, Svelte, Vue, and more. Noticable absent from this list is the React team. The goal is for signals to be usable in multiple frameworks.</p><p>The proposal defines a new JavaScript namespace named &quot;Signal&quot;. The Signal namespace:</p><ul><li>provides a method to define state with initial values</li><li>provides a method to define state that is computed from other state</li><li>performs lazy evaluation of state so it is not computed until needed</li><li>memoizes the last computation of each piece of state to avoid repeating computations that will result in the same value</li></ul><p>A polyfill is available for use now.</p><p>There is a potential for browsers to implement new DevTools that track and display the state of signals.</p><h2 id="define-state" tabindex="-1">Define State</h2><p>The following code defines a piece of state with an initial value:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Signal<span class="token punctuation">.</span>State</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="define-computed-state" tabindex="-1">Define Computed State</h2><p>The following code defines two pieces of state that are computed from other state:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> isEven <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Signal<span class="token punctuation">.</span>Computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>counter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> parity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Signal<span class="token punctuation">.</span>Computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>isEven<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">'even'</span> <span class="token operator">:</span> <span class="token string">'odd'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="retrieve-state" tabindex="-1">Retrieve State</h2><p>The following code gets the value of a piece of state:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> value <span class="token operator">=</span> counter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="modify-state" tabindex="-1">Modify State</h2><p>The following code modifies a piece of state:</p><pre class="language-js"><code class="language-js">counter<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="execute-code-when-state-changes" tabindex="-1">Execute Code When State Changes</h2><p>The following code executes a function when any state it uses changes:</p><pre class="language-js"><code class="language-js"><span class="token comment">// This prints the value of the parity state in the DevTools console</span><br><span class="token comment">// initially, and again every time it changes.</span><br><span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>parity<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token comment">// The setInnerText function is defined below.</span><br>  <span class="token function">setInnerText</span><span class="token punctuation">(</span><span class="token string">'#sum'</span><span class="token punctuation">,</span> n1State<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> n2State<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="effect-function" tabindex="-1">effect Function</h2><p>The polyfill does not provide the <code>effect</code> function. However, a suggested implementation is provided at <a href="https://github.com/tc39/proposal-signals/tree/main/packages/signal-polyfill#creating-a-simple-effect" target="_blank">Creating a simple effect</a> which is similar to the following that I placed in <code>effect.ts</code>:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>Signal<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'signal-polyfill'</span><span class="token punctuation">;</span><br><br><span class="token keyword">let</span> needsEnqueue <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br><br><span class="token keyword">function</span> <span class="token function">processPending</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  needsEnqueue <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> s <span class="token keyword">of</span> watcher<span class="token punctuation">.</span><span class="token function">getPending</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    s<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  watcher<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">const</span> watcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Signal<span class="token punctuation">.</span>subtle<span class="token punctuation">.</span>Watcher</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>needsEnqueue<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    needsEnqueue <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>    <span class="token function">queueMicrotask</span><span class="token punctuation">(</span>processPending<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>type <span class="token function-variable function">Cleanup</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span><br>type <span class="token function-variable function">Callback</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> Cleanup <span class="token operator">|</span> <span class="token keyword">void</span><span class="token punctuation">;</span><br><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">effect</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">callback</span><span class="token operator">:</span> Callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// The callback function passed to the effect function</span><br>  <span class="token comment">// can optionally return a "cleanup" function.</span><br>  <span class="token comment">// If it does then the cleanup function is called every time</span><br>  <span class="token comment">// a piece of state used in the callback function changes,</span><br>  <span class="token comment">// and again if the function returned by this one is called.</span><br>  <span class="token keyword">let</span> <span class="token literal-property property">cleanup</span><span class="token operator">:</span> Cleanup <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> computed <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Signal<span class="token punctuation">.</span>Computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">typeof</span> cleanup <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    cleanup <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  watcher<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>computed<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  computed<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// The caller of "effect" can call this returned function</span><br>  <span class="token comment">// to stop watching for state changes.</span><br>  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    watcher<span class="token punctuation">.</span><span class="token function">unwatch</span><span class="token punctuation">(</span>computed<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">typeof</span> cleanup <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h2 id="utility-functions" tabindex="-1">Utility Functions</h2><p>The following are examples of utility functions which make working with signals easier that I placed in <code>utilities.ts</code>:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>effect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./effect'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>Signal<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'signal-polyfill'</span><span class="token punctuation">;</span><br><br><span class="token comment">/** Creates a two-way binding between an input element and a state. */</span><br><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">bindNumberInput</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">selector</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">state</span><span class="token operator">:</span> Signal<span class="token punctuation">.</span>State<span class="token operator">&lt;</span>any<span class="token operator">></span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token function">getElement</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLInputElement<span class="token punctuation">;</span><br>  element<span class="token punctuation">.</span><span class="token function-variable function">onchange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> state<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span>value <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getElement</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">selector</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token operator">:</span> HTMLElement <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLElement<span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>element<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">No element found for selector: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>selector<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> element<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">setInnerText</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">selector</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> string <span class="token operator">|</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token function">getElement</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLInputElement<span class="token punctuation">;</span><br>  element<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h2 id="demo-app" tabindex="-1">Demo App</h2><p>For a more full-featured demo app, see <a href="https://github.com/mvolkmann/js-signals-demo" target="_blank">js-signals-demo</a>.</p></article>