<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Server-Sent Events (SSE)</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#demo-client">Demo Client</a></li><li><a href="#demo-server">Demo Server</a></li><li><a href="#use-cases">Use Cases</a></li><li><a href="#alternatives">Alternatives</a><ol><li><a href="#long-polling">Long Polling</a></li><li><a href="#websockets">WebSockets</a></li></ol></li></ol></nav></aside><article><style>img {
    border: 1px solid gray;
  }</style><h2 id="overview" tabindex="-1">Overview</h2><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events?v=1.1.1" rel="noopener" target="_blank">Server-Sent Events</a> (SSE) are used to send data from a server to a client, but not in the other direction.</p><p>SSE is built on HTTP.</p><p>Messages are sent over TCP, not UDP, so there is some overhead for error checking and message coordination.</p><p>For a great video on SSE, see <a href="https://www.youtube.com/watch?v=4HlNv1qpZFY?v=1.1.1" rel="noopener" target="_blank">Server-Sent Events Crash Course</a>.</p><h2 id="demo-client" tabindex="-1">Demo Client</h2><p>The following code is an example client HTML file that connects to the server and receives server-sent events. Note the use of the class <code>EventSource</code>.</p><pre class="language-js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">></span><br><span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">></span><br>  <span class="token operator">&lt;</span>head<span class="token operator">></span><br>    <span class="token operator">&lt;</span>title<span class="token operator">></span><span class="token constant">SSE</span> Demo<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span><br>    <span class="token operator">&lt;</span>script<span class="token operator">></span><br>      <span class="token keyword">const</span> eventSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventSource</span><span class="token punctuation">(</span><span class="token string">'http://localhost:3000/sse'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      eventSource<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span><br>  <span class="token operator">&lt;</span>body<span class="token operator">></span><br>    <span class="token operator">&lt;</span>h1<span class="token operator">></span>Server<span class="token operator">-</span>Sent Events Demo<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><br>    <span class="token operator">&lt;</span>p<span class="token operator">></span>See output <span class="token keyword">in</span> DevTools Console<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span><br><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span></code></pre><h2 id="demo-server" tabindex="-1">Demo Server</h2><p>Responses sent from an SSE endpoint must set the &quot;Content-Type&quot; header to &quot;text/event–stream&quot; and the &quot;Transfer-Encoding&quot; header to &quot;chunked&quot;.</p><p>When using the Node.js Express library, the &quot;Transfer-Encoding&quot; response header is set to &quot;chunked&quot; automatically when the request header &quot;Accept&quot; is set to &quot;text/event-stream&quot;.</p><p>The following code is an example Node.js server that uses the Express library.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/sse'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/event-stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">while</span> <span class="token punctuation">(</span>count <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    count<span class="token operator">++</span><span class="token punctuation">;</span><br>    res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">data:demo</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'listening on port'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The following <code>package.json</code> file can be used to start the server.</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"node-sse"</span><span class="token punctuation">,</span><br>  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span><br>  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"nodemon src/server.js"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"express"</span><span class="token operator">:</span> <span class="token string">"^4.18.2"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"nodemon"</span><span class="token operator">:</span> <span class="token string">"^3.0.3"</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>To run this demo, enter <code>npm run dev</code>, browse localhost:3000, open the browser DevTools, and view the Console output.</p><p>The server is responsible for deciding whether to keep the connection alive.</p><h2 id="use-cases" tabindex="-1">Use Cases</h2><p>Common uses of SSE include:</p><ul><li>live data feeds such as weather and sports updates</li><li>gathering and displaying information about server-side progress</li><li>client-side logging of server-side activity</li></ul><h2 id="alternatives" tabindex="-1">Alternatives</h2><p>If data must be sent in both directions, consider using long polling or WebSockets.</p><p>With long polling, the server can delay sending a response.</p><h3 id="long-polling" tabindex="-1">Long Polling</h3><h3 id="websockets" tabindex="-1">WebSockets</h3><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API?v=1.1.1" rel="noopener" target="_blank">WebSockets</a> can send data in both directions. This is a major reason to choose WebSockets over SSE.</p><p>For a great video on WebSockets, see <a href="https://www.youtube.com/watch?v=2Nt-ZrNP22A?v=1.1.1" rel="noopener" target="_blank">WebSockets Crash Course</a>.</p><p>TODO: Show how to use Web sockets with HTMX.</p><p>when sending data from the server, write to the stream, but do not close it until the server is finished. Sending data on that connection. must prefix data with “data:” and end with two newlines. The data will be in the data property of the MessageEvent Object that is created in Node.js. you can restart the server without restarting the client and the client will continue getting messages. look at all the properties in EventMessage objects besides the data property. individual messages do not include HTTP headers, so they are very small.</p></article>