<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>MongoDB</h2><aside><nav class="toc"><ol><li><a href="#installing-mongodb">Installing MongoDB</a><ol><li><a href="#windows">Windows</a></li><li><a href="#linux">Linux</a></li><li><a href="#macos">macOS</a></li></ol></li><li><a href="#starting-the-database-server">Starting the database server</a></li><li><a href="#mongodb-shell">MongoDB shell</a></li><li><a href="#criteria">Criteria</a></li><li><a href="#joins">Joins</a></li><li><a href="#mongodb-compass">MongoDB Compass</a></li><li><a href="#mongodb-from-javascript">MongoDB from JavaScript</a></li></ol></nav></aside><article><p>MongoDB is currently the most popular NoSQL database. Unlike relational databases that use SQL and are organized into tables that contains rows, and rows that contain columns, MongoDB stores <em>documents</em> in <em>collections</em>. Each collection can have multiple indexes to make queries faster. These indexes are implemented as <a href="https://en.wikipedia.org/wiki/B-tree?v=1.0.22" rel="noopener" target="_blank">B-tree</a> data structures. The documents are JSON objects that are stored in a binary JSON format called BSON.</p><p>Unlike relational databases that define the structure of a database with a schema, MongoDB does not use a schema to restrict what can be stored in a database. This speeds up development when the structure changes often, since no schema changes are required. It also allows properties present in the objects of a collection to vary.</p><p>In practice, all the documents that are added to a given collection typically have the same structure. For example, documents describing a person might all have the following structure:</p><pre class="language-js"><code class="language-js"><span class="token punctuation">{</span><br>  <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">"5e4984b33c9533dfdf102ac8"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">firstName</span><span class="token operator">:</span> <span class="token string">"Mark"</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">lastName</span><span class="token operator">:</span> <span class="token string">"Volkmann"</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">street</span><span class="token operator">:</span> <span class="token string">"123 Some Street"</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">city</span><span class="token operator">:</span> <span class="token string">"Somewhere"</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token string">"Missouri"</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">zip</span><span class="token operator">:</span> <span class="token number">12345</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">favoriteColors</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"yellow"</span><span class="token punctuation">,</span> <span class="token string">"orange"</span><span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre><p>Each document has an <code>_id</code> property that holds a unique identifier within its collection. Documents in other collections can have properties that refer to these. This can be used to simulate what are called <em>joins</em> in relational databases.</p><p>This post provides enough detail to enable implementing CRUD operations on collections of data. It does not cover more advanced topics, such as query optimization, replication, sharding, backups, and security. For detail on these and many other MongoDB topics, see the Manning book <a href="https://www.manning.com/books/mongodb-in-action?v=1.0.22" rel="noopener" target="_blank">MongoDB in Action</a>.</p><p>We’ll look at how to perform various actions from JavaScript code.</p><h2 id="installing-mongodb" tabindex="-1">Installing MongoDB</h2><p>There are multiple ways to install MongoDB, and they vary based on the operating system of the computer. For details, see the <a href="https://docs.mongodb.com/guides/server/install/?v=1.0.22" rel="noopener" target="_blank">MongoDB documentation</a>. We will look at one way of installing for each operating system.</p><h3 id="windows" tabindex="-1">Windows</h3><p>Follow these steps to install MongoDB on Windows:</p><ol><li>Browse <a href="https://www.mongodb.com/try/download/community">https://www.mongodb.com/try/download/community</a>.</li><li>Click Server at the top to bypass requesting a free trial of MongoDB Atlas.</li><li>In the Version drop-down, select the version labeled “current release”.</li><li>In the OS drop-down, select “Windows x64”.</li><li>In the Package drop-down, select “msi”.</li><li>Click the Download button.</li><li>Double-click the downloaded <code>.msi</code> file and follow the installer instructions.</li><li>Open a command prompt window.</li><li>Create the MongoDB data directory by entering <code>md \data\db</code>.</li></ol><p>This will install MongoDB as a Windows service. It will consume resources even when not in use. When it’s not needed, the service can be stopped or it can be uninstalled.</p><h3 id="linux" tabindex="-1">Linux</h3><p>Follow these steps to install MongoDB on Linux:</p><ol><li>Browse to <a href="https://www.mongodb.com/try/download/community">https://www.mongodb.com/try/download/community</a>.</li><li>Click Server at the top to bypass requesting a free trial of MongoDB Atlas.</li><li>In the Version drop-down, select the version labeled “current release”.</li><li>In the OS drop-down, select your version of Linux.</li><li>In the Package drop-down, select “TGZ”.</li><li>Click the Download button.</li><li>Open a terminal window.</li><li><code>cd</code> to the the directory where the <code>.tgz</code> file was downloaded.</li><li>Enter <code>sudo tar -C /opt -xf {file-name}.tgz</code>.</li><li>Add the bin subdirectory of this directory to the <code>PATH</code> environment variable. For example, <code>/opt/mongodb-linux-x86_64-ubuntu1604-4.2.3/bin</code>.</li><li>Create the MongoDB data directory by entering <code>sudo mkdir -p /data/db</code>.</li><li>Set permissions on this directory by entering <code>sudo chmod +rw /data/db</code>.</li></ol><h3 id="macos" tabindex="-1">macOS</h3><p>One option for installing on macOS is to follow the same basic steps as for Linux. Another approach is as follows:</p><ol><li>Install <a href="https://brew.sh/?v=1.0.22" rel="noopener" target="_blank">Homebrew</a>.</li><li>Enter <code>brew tap mongodb/brew</code>.</li><li>Enter <code>brew install mongodb-community</code>.</li></ol><h2 id="starting-the-database-server" tabindex="-1">Starting the database server</h2><p>The steps for starting a MongoDB server vary based on the operating system of the computer.</p><ul><li><p>On Windows, open a command prompt and enter <code>mongod</code>.</p></li><li><p>On Linux, open a terminal window and enter <code>mongod</code>.</p></li><li><p>On macOS, open a terminal window and enter <code>mongod --config /usr/local/etc/mongod.conf --fork</code>.</p></li></ul><h2 id="mongodb-shell" tabindex="-1">MongoDB shell</h2><p>MongoDB shell is a kind of REPL that supports using JavaScript to interact with a MongoDB database.</p><p>There are also many free tools that provide a GUI for performing the same operations. Some to consider can be found at <a href="www.guru99.com/top-20-mongodb-tools.html?v=1.0.22" rel="noopener" target="_blank">here</a>. One great option is <a href="https://www.mongodb.com/products/compass?v=1.0.22" rel="noopener" target="_blank">MongoDB Compass</a>.</p><p>To start the MongoDB shell, enter <code>mongo</code>. This displays a prompt where JavaScript-based MongoDB commands can be entered.</p><p>The table below is a cheat sheet of commands that can be entered to perform common operations. The commands found in it use the following placeholders:</p><ul><li><code>{db}</code> represents the name of a database.</li><li><code>{coll}</code> represents the name of a collection.</li><li><code>{obj}</code> represents a JavaScript object that describes a document.</li></ul><p>It is best to use valid JavaScript names for collections. For example, avoid including dashes in their names.</p><table><thead><tr><th>Action</th><th>Command</th></tr></thead><tbody><tr><td>List existing databases</td><td><code>show dbs</code></td></tr><tr><td>Create a new database</td><td>None; databases are automatically<br>created when a collection is added</td></tr><tr><td>Make a given database the current one</td><td><code>use {db}</code></td></tr><tr><td>Show the current database</td><td><code>db.getName()</code></td></tr><tr><td>Delete the current database</td><td><code>db.dropDatabase()</code></td></tr><tr><td>List the collections in the current database</td><td><code>show collections</code> or <code>db.getCollectionNames()</code></td></tr><tr><td>Create a collection in the current database</td><td><code>db.createCollection('{coll}')</code></td></tr><tr><td>Add a document to a collection</td><td><code>db.{coll}.insert({obj})</code></td></tr><tr><td>Get the number of documents in a collection</td><td><code>db.{coll}.find().count()</code> or<br><code>db.{coll}.find().length()</code></td></tr><tr><td>Output the first 20 documents in a collection</td><td><code>db.{coll}.find()</code></td></tr><tr><td>Output the next 20 documents in a collection</td><td><code>db.{coll}.find().skip(20)</code></td></tr><tr><td>Output the first 20 documents in a collection that match criteria</td><td><code>db.{coll}.find({criteria})</code></td></tr><tr><td>Delete one document from a collection that matches criteria</td><td><code>db.{coll}.deleteOne({criteria})</code></td></tr><tr><td>Delete all documents from a collection that match criteria</td><td><code>db.{coll}.deleteMany({criteria})</code></td></tr><tr><td>Update one document in a collection that matches criteria</td><td><code>db.{coll}.updateOne({criteria}, {$set: {updates}})</code></td></tr><tr><td>Update all documents in a collection that match criteria</td><td><code>db.{coll}.updateMany({criteria}, {$set: {updates}})</code></td></tr><tr><td>Add an index to a collection</td><td><code>db.{coll}.createIndex({ {prop-name}: 1 });</code><br>1 for ascending order, -1 for descending order</td></tr><tr><td>Delete a collection</td><td><code>db.{coll}.drop()</code></td></tr><tr><td>Exit from the shell</td><td><code>exit</code></td></tr></tbody></table><p>The current database starts as &quot;test&quot;, even if no such database exists yet.</p><p>Here is an example session:</p><pre class="language-js"><code class="language-js"><span class="token comment">// We don’t have an “animals” database yet.</span><br>show dbs<br><br><span class="token comment">// A database doesn’t have to exist to “use” it.</span><br>use animals<br><br>db<span class="token punctuation">.</span><span class="token function">createCollection</span><span class="token punctuation">(</span><span class="token string">'dogs'</span><span class="token punctuation">)</span><br><br><span class="token comment">// Now we have an “animals” database because we created a collection in it.</span><br>show dbs<br><br>db<span class="token punctuation">.</span><span class="token function">createCollection</span><span class="token punctuation">(</span><span class="token string">'cats'</span><span class="token punctuation">)</span><br><br><span class="token comment">// The “animals” database now contains the collections “dogs” and “cats”.</span><br>db<span class="token punctuation">.</span><span class="token function">getCollectionNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>db<span class="token punctuation">.</span>dogs<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">breed</span><span class="token operator">:</span> <span class="token string">'Whippet'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Dasher'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br>db<span class="token punctuation">.</span>dogs<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">breed</span><span class="token operator">:</span> <span class="token string">'TWC'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Maisey'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br>db<span class="token punctuation">.</span>dogs<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">breed</span><span class="token operator">:</span> <span class="token string">'NAID'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Ramsay'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br>db<span class="token punctuation">.</span>dogs<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">breed</span><span class="token operator">:</span> <span class="token string">'GSP'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Oscar'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br><span class="token comment">// This outputs the first 20 documents in the “dogs” collection.</span><br>db<span class="token punctuation">.</span>dogs<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br><span class="token comment">// This outputs only the dogs with a breed of “Whippet”.</span><br>db<span class="token punctuation">.</span>dogs<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">breed</span><span class="token operator">:</span> <span class="token string">'Whippet'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br><span class="token comment">// This deletes all the dogs with a breed of “Whippet”.</span><br>db<span class="token punctuation">.</span>dogs<span class="token punctuation">.</span><span class="token function">deleteMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">breed</span><span class="token operator">:</span> <span class="token string">'Whippet'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br><span class="token operator">&lt;</span><span class="token number">8</span><span class="token operator">></span> This shows that the collection no longer contains Whippets<span class="token punctuation">.</span><br>db<span class="token punctuation">.</span>dogs<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br><span class="token comment">// This changes the name of all dogs with a breed of “GSP”.</span><br>db<span class="token punctuation">.</span>dogs<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">breed</span><span class="token operator">:</span> <span class="token string">'GSP'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">$set</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Oscar Wilde'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br><span class="token comment">// This changes the name of the one dog with a given ID.</span><br>db<span class="token punctuation">.</span>dogs<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">'some-id'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">$set</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Oscar Wilder'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br><span class="token comment">// This deletes the “dogs” collection.</span><br>db<span class="token punctuation">.</span>dogs<span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br><span class="token comment">// This shows that we no longer have a “dogs” collection.</span><br>db<span class="token punctuation">.</span><span class="token function">getCollectionNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br><span class="token comment">// This deletes the “animals” database.</span><br>db<span class="token punctuation">.</span><span class="token function">dropDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br><span class="token comment">// This shows that we no longer have an “animals” database.</span><br>show dbs</code></pre><h2 id="criteria" tabindex="-1">Criteria</h2><p>The following are example criteria for finding documents.</p><table><thead><tr><th>Target</th><th>Query</th></tr></thead><tbody><tr><td>string property begins with</td><td><code>{ propertyName: { $regex: &quot;^text&quot; } }</code></td></tr><tr><td>string property ends with</td><td><code>{ propertyName: { $regex: &quot;text$&quot; } }</code></td></tr><tr><td>string property contains</td><td><code>{ propertyName: { $regex: &quot;text&quot; } }</code></td></tr><tr><td>array property contains</td><td><code>{ propertyName: { $all: [&quot;text&quot;] } }</code></td></tr></tbody></table><h2 id="joins" tabindex="-1">Joins</h2><p>The <code>$lookup</code> operator can be used to join collections in a query. I have yet to find a good example of using this.</p><h2 id="mongodb-compass" tabindex="-1">MongoDB Compass</h2><p>TODO: Add more detail.</p><p>To find documents based on multiple property values, use a query like the following:</p><pre class="language-text"><code class="language-text">{ type: 3, itemNumber: '' }</code></pre><p>For documents that have date properties, to find those from today and newer use a query like the following:</p><pre class="language-text"><code class="language-text">{ createdAt: { $gt: new Date('2022-11-25') } }</code></pre><p>To find documents with a property that matches a regular expression, use a query like the following:</p><pre class="language-text"><code class="language-text">{ itemNumber: { $regex: /^Comet/ } }</code></pre><h2 id="mongodb-from-javascript" tabindex="-1">MongoDB from JavaScript</h2><p>Now that we have seen how to use the MongoDB shell, let’s perform the same operations from a JavaScript program.</p><p>There are several open source libraries for using MongoDB from various programming languages. The official library for Node.js is simply called <code>mongodb</code>. To install it, enter <code>npm install mongodb</code>.</p><p>The following code performs all the same operations shown in the previous MongoDB shell session.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> MongoClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MongoClient<span class="token punctuation">;</span><br><br><span class="token comment">// MongoDB thinks localhost is a different database instance than 127.0.0.1.</span><br><span class="token comment">// The mongo shell uses 127.0.0.1, so we use that to hit the same instance.</span><br><span class="token comment">// I thought maybe this was an issue with my /etc/host file,</span><br><span class="token comment">// but I commented out all the lines that associated 127.0.0.1</span><br><span class="token comment">// with something other than localhost and it didn't change anything.</span><br><span class="token comment">//const url = 'mongodb://localhost:27017';</span><br><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'mongodb://127.0.0.1:27017'</span><span class="token punctuation">;</span><br><br><span class="token comment">// These are recommended MongoDB options to avoid deprecation warnings.</span><br><span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">useNewUrlParser</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">useUnifiedTopology</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">logCollection</span><span class="token punctuation">(</span><span class="token parameter">coll</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> coll<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>coll<span class="token punctuation">.</span>collectionName<span class="token punctuation">,</span> <span class="token string">'contains'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">logCollections</span><span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> items <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">listCollections</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><br>    <span class="token string">'collections are'</span><span class="token punctuation">,</span><br>    items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">logDatabases</span><span class="token punctuation">(</span><span class="token parameter">client</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> dbs <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listDatabases</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><br>    <span class="token string">'databases are'</span><span class="token punctuation">,</span><br>    dbs<span class="token punctuation">.</span>databases<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">db</span> <span class="token operator">=></span> db<span class="token punctuation">.</span>name<span class="token punctuation">)</span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Until we have support for top level await in JavaScript,</span><br><span class="token comment">// all uses of the "await" keyword must be in an "async" function.</span><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">doIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">let</span> client<span class="token punctuation">;</span><br>  <span class="token keyword">try</span> <span class="token punctuation">{</span><br>    client <span class="token operator">=</span> <span class="token keyword">await</span> MongoClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// Show that we do not yet have an "animals" database.</span><br>    <span class="token keyword">await</span> <span class="token function">logDatabases</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Use the "animals" database.</span><br>    <span class="token keyword">const</span> db <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'animals'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Create two collections in the "animals" database.</span><br>    <span class="token keyword">const</span> dogs <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">createCollection</span><span class="token punctuation">(</span><span class="token string">'dogs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> cats <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">createCollection</span><span class="token punctuation">(</span><span class="token string">'cats'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Show that we now have an "animals" database.</span><br>    <span class="token keyword">await</span> <span class="token function">logDatabases</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Show that the collections were created.</span><br>    <span class="token keyword">await</span> <span class="token function">logCollections</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Add four documents to the "dogs" collection.</span><br>    <span class="token keyword">await</span> dogs<span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">breed</span><span class="token operator">:</span> <span class="token string">'Whippet'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Dasher'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">await</span> dogs<span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">breed</span><span class="token operator">:</span> <span class="token string">'TWC'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Maisey'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">await</span> dogs<span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">breed</span><span class="token operator">:</span> <span class="token string">'NAID'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Ramsay'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">await</span> dogs<span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">breed</span><span class="token operator">:</span> <span class="token string">'GSP'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Oscar'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Show that there are four documents in the "dogs" collection.</span><br>    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token keyword">await</span> dogs<span class="token punctuation">.</span><span class="token function">countDocuments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dog count ='</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Show the documents in the "dogs" collection.</span><br>    <span class="token keyword">await</span> <span class="token function">logCollection</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Find all the Whippets in the "dogs" collection.</span><br>    result <span class="token operator">=</span> <span class="token keyword">await</span> dogs<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">breed</span><span class="token operator">:</span> <span class="token string">'Whippet'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'whippets are'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Delete all the Whippets from the "dogs" collection.</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'deleting Whippets'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">await</span> dogs<span class="token punctuation">.</span><span class="token function">deleteMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">breed</span><span class="token operator">:</span> <span class="token string">'Whippet'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Show that the "dogs" collection no longer contains Whippets.</span><br>    <span class="token keyword">await</span> <span class="token function">logCollection</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Update the name of all GSPs in the "dogs" collection.</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'updating GSP name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">await</span> dogs<span class="token punctuation">.</span><span class="token function">updateMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">breed</span><span class="token operator">:</span> <span class="token string">'GSP'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">$set</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Oscar Wilde'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">await</span> <span class="token function">logCollection</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Find a specific dog in the "dogs" collection.</span><br>    <span class="token keyword">const</span> dog <span class="token operator">=</span> <span class="token keyword">await</span> dogs<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Oscar Wilde'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Update the name of a specific dog in the "dogs" collection.</span><br>    <span class="token keyword">await</span> dogs<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">_id</span><span class="token operator">:</span> dog<span class="token punctuation">.</span>_id<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">$set</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Oscar Wilder'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">await</span> <span class="token function">logCollection</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Delete the "dogs" collection.</span><br>    <span class="token keyword">await</span> dogs<span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Show that the "animals" database</span><br>    <span class="token comment">// no longer contains a "dogs" collection.</span><br>    <span class="token function">logCollections</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Delete the "animals" database.</span><br>    <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">dropDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Show that the "animals" database no longer exists.</span><br>    <span class="token keyword">await</span> <span class="token function">logDatabases</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">)</span> client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token function">doIt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></article>