<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Bun</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#benefits-over-npm-and-node.js">Benefits Over npm and Node.js</a></li><li><a href="#history">History</a></li><li><a href="#implementation">Implementation</a></li><li><a href="#framework-support">Framework Support</a></li><li><a href="#bun-apis">Bun APIs</a></li><li><a href="#installing">Installing</a></li><li><a href="#repl">REPL</a></li><li><a href="#projects">Projects</a></li><li><a href="#help">Help</a></li><li><a href="#package-manager">Package Manager</a></li><li><a href="#linting">Linting</a></li><li><a href="#code-formatting">Code Formatting</a></li><li><a href="#bundling">Bundling</a></li><li><a href="#unit-tests">Unit Tests</a></li><li><a href="#global-variables">Global Variables</a></li><li><a href="#importing-files">Importing Files</a></li><li><a href="#bun-global-variable">Bun Global Variable</a></li><li><a href="#http-server">HTTP Server</a></li><li><a href="#watch-mode">Watch Mode</a></li><li><a href="#environment-variables">Environment Variables</a></li><li><a href="#executable-files">Executable Files</a></li><li><a href="#executing-without-installing">Executing Without Installing</a></li><li><a href="#import.meta">import.meta</a></li><li><a href="#console">Console</a></li><li><a href="#utilities">Utilities</a></li><li><a href="#jsx">JSX</a></li><li><a href="#serializing-objects">Serializing Objects</a></li><li><a href="#writing-and-reading-files">Writing and Reading Files</a></li><li><a href="#globbing">Globbing</a></li><li><a href="#websockets">WebSockets</a></li><li><a href="#sqlite">SQLite</a></li><li><a href="#foreign-function-interface-(ffi)">Foreign Function Interface (FFI)</a></li><li><a href="#bun-shell">Bun Shell</a></li><li><a href="#elysiajs">ElysiaJS</a></li><li><a href="#todos">TODOs</a></li></ol></nav></aside><article><figure style="width: 33%"><img alt="Ziggy, the Zig mascot" style="border: 0" src="/blog/assets/bun-logo.svg?v=1.1.1"></figure><h2 id="overview" tabindex="-1">Overview</h2><p>&quot;<a href="https://bun.sh?v=1.1.1" rel="noopener" target="_blank">Bun</a> is a fast JavaScript all-in-one toolkit.&quot; It includes a JavaScript runtime, package manager, bundler, and test runner. All of this is free and open source under the MIT license.</p><p>Bun can be used as a drop-in replacement for npm and Node.js. The Bun runtime supports nearly all Node.js builtin modules (around 40 of them). Rarely used modules such as dgram, http2, inspector, and repl are not yet supported. The v8 module is specific to Webkit which Bun does not use.</p><h2 id="benefits-over-npm-and-node.js" tabindex="-1">Benefits Over npm and Node.js</h2><p>The benefits of using Bun over npm and Node.js include:</p><ul><li>Bun provides significantly better performance.</li><li>Bun simplifies the current state of JS/TS tooling (transpilers, bundlers, testing tools, and so on). There is less to install and configure and it is easier to use.</li><li>Bun supports both CommonJS (<code>require</code>) and ESM (<code>import</code>) in the same source files.</li><li>Bun supports TypeScript out of the box.</li><li>Bun supports JSX/TSX files for generating HTML.</li><li>Bun has builtin support for SQLite databases using the <code>bun:sqlite</code> module. It is 2 times faster than Deno and 4 times faster than Node.js in queries per second. Future support for MySQL and Postgres is planned.</li><li>Bun has builtin support for Jest-compatible unit tests using the <code>bun:test</code> module.</li><li>Bun has better support for Web APIs including <code>fetch</code>, <code>Request</code>, <code>Response</code>, <code>ReadableStream</code>, <code>WebSocket</code>, and more. There is no need to install dependencies such as <code>node-fetch</code> and <code>ws</code>. Bun's native implementation of these tends to be faster than third-party libraries used with Node.js.</li><li>Bun provides native hot reloading using the <code>--hot</code> flag which updates a running server without restarting it. This allows preserving application state and connections such as HTTP and WebSockets. Hot reloading in Node.js currently requires either using an external tool like nodemon or the experimental <code>--watch</code> flag.</li><li>Bun provides bun-specific APIs that are alternatives to many npm modules. These are highly optimized and perform much better than their Node.js equivalents.</li><li>Bun has a plugin API that is similar to esbuild. Many esbuild plugins work in Bun without modification.</li></ul><p>The Bun team makes the following additional performance claims:</p><ul><li>Bun is 4 times faster than Node.js for a &quot;hello world&quot; program.</li><li>The time to build and run TS code in Bun is 4 times faster than esbuild, 15 times faster than TSX, and 43 times faster than TSC + Node.</li><li><code>bun install</code> is 29 times faster than npm and 17 times faster than pnpm.</li><li><code>bun run</code> can be used in place of <code>npm run</code> and is 5 times faster.</li><li><code>bun test</code> is 8 times faster than Vitest and 13 times faster than Jest.</li></ul><h2 id="history" tabindex="-1">History</h2><p>Development of Bun started in 2022 by Jarred Sumner with VC funding. Bun became stable (1.0) in September 2023.</p><p>Bun was created by the startup company <a href="https://oven.sh/?v=1.1.1" rel="noopener" target="_blank">Oven.sh</a> because that’s what buns come out of. “Oven has decided to adopt a strategy twinned with Deno Company. They will launch sales of a cloud architecture based on Bun.”</p><p>The name &quot;Bun&quot; came from a friend who suggested it because she has a bunny named &quot;Bun&quot;. The initial reaction was &quot;I'm not going to name it after your bunny. And then I thought about it more and it made some sense.&quot; It also makes sense because &quot;it’s a bundling of the JavaScript ecosystem and a bundler&quot;.</p><h2 id="implementation" tabindex="-1">Implementation</h2><p>Bun is built on JavaScriptCore (JSC) from Safari rather than V8 which is used by Chrome. JSC has faster startup time and lower memory usage than V8, but slightly less overall performance.</p><p>Bun is implemented in Zig and some C++. &quot;Zig is sort of similar to writing C, but with better memory safety features in debug mode and modern features like defer (sort of similar to Go's) and arbitrary code can be executed at compile-time via comptime. It's really good for writing performant low-level software.&quot; Zig &quot;has very few keywords so it's a lot easier to learn than, for example, C++ or Rust.&quot;</p><p>Oven will donate to the Zig Software Foundation to keep the project going.</p><h2 id="framework-support" tabindex="-1">Framework Support</h2><p>Bun works with nearly all major web frameworks including Next.js, SvelteKit, Astro, Nuxt, and Fastify.</p><h2 id="bun-apis" tabindex="-1">Bun APIs</h2><p>Bun provides bun-specific APIs that are alternatives to many npm modules. These are highly optimized and perform much better than their Node.js equivalents.</p><p><code>Bun.file</code> returns a <code>File</code> object with the same properties as DOM <code>File</code> objects. The contents are lazily loaded. It provides many <code>async</code> methods for reading content in different formats including text, json, stream, and ArrayBuffer. These read files up to 10 times faster than Node.js equivalents.</p><p><code>Bun.write</code> writes many kinds of values including strings, buffers, files, and responses from HTTP requests. It writes 3 times faster than Node.js equivalents.</p><p><code>Bun.serve</code> starts an HTTP server based on web APIs. It handles 4 times as many requests per second as the Node.js equivalent.</p><p><code>Bun.env</code> provides access to environment variables without installing and using the <code>dotenv</code> package.</p><p><code>Bun.spawn</code> and <code>Bun.spawnSync</code> enable spawning child processes.</p><p><code>Bun.listen</code> and <code>Bun.connect</code> enable sending and receiving TCP requests.</p><p>Builtin Websocket support handles 5 times as many messages per second as the Node.js equivalent and is easier to use.</p><p>Builtin password hashing using Bcrypt and Argon is provided.</p><p>Bun provides many more APIs!</p><h2 id="installing" tabindex="-1">Installing</h2><p>To install Bun for macOS, Linux, or Windows Subsystem for Linux (WSL), enter <code>curl -fsSL https://bun.sh/install | bash</code>. This adds the <code>bun</code> executable.</p><p>To verify the installation and see the version that is installed, enter <code>bun --version</code> or <code>bun -v</code>.</p><p>To upgrade to the latest version, enter <code>bun upgrade</code>.</p><p>&quot;Bun provides a limited, experimental native build for Windows. At the moment, only the Bun runtime is supported.&quot;</p><h2 id="repl" tabindex="-1">REPL</h2><p>To start a Read-Evaluate-Print-Loop, enter <code>bun repl</code>. This takes a few seconds to install the first time it is run, but is much faster in subsequent runs.</p><h2 id="projects" tabindex="-1">Projects</h2><p>To create a new Bun project, create a directory, cd to it. For a vanilla Bun project, enter <code>bun init</code>. This creates the following files:</p><ul><li><p><code>README.md</code></p><p>This provides basic information about using Bun. The contents should be replaced with project-specific information.</p></li><li><p><code>bun.lockb</code></p><p>This is the Bun equivalent of <code>package-lock.json</code>, but it is in a binary format.</p></li><li><p><code>index.ts</code></p><p>This is the entry point source file.</p></li><li><p><code>package.json</code></p><p>This describes dependencies, scripts, and more.</p></li><li><p><code>tsconfig.json</code></p><p>This configures TypeScript.</p></li></ul><p>It also creates the directory <code>node_modules</code> that holds code for dependencies. Initially it contains the directories <code>.bin</code>, <code>bun-types</code>, and <code>typescript</code>. There is no need to run <code>npm install</code> to get started.</p><p>The file <code>index.ts</code> only contains the following:</p><pre class="language-js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello via Bun!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>To run the project, enter <code>bun run index.ts</code>. Note that TypeScript source files can be executed using <code>bun run</code> without installing additional packages or configuring anything.</p><p>It is somewhat common to create a <code>src</code> directory and move <code>index.ts</code> and other source files into it.</p><p>To create a project from a template, enter <code>bun create {template} {destination}</code>. For example, to create a project that uses Svelte, enter <code>bun create svelte@latest my-svelte-app</code> (or <code>bun c</code>). The destination defaults to the current directory. Some templates will ask questions about your preferences and some will output instructions about what to do next.</p><h2 id="help" tabindex="-1">Help</h2><p>To see all the subcommands supported by the <code>bun</code> command, enter <code>bun</code>. The subcommands include <code>init</code>, <code>run</code>, <code>test</code>, <code>repl</code>, <code>upgrade</code>, and more.</p><p>To see all the options supported by the <code>bun</code> command, enter <code>bun --help</code>.</p><p>To see a list of all scripts defined in <code>package.json</code>, enter <code>bun.run</code>.</p><h2 id="package-manager" tabindex="-1">Package Manager</h2><p>The Bun package manager works with npm packages. It uses <code>package.json</code> files just like npm, but it uses a binary <code>bun.lockb</code> file instead of <code>package-lock.json</code>.</p><p>The <code>bun</code> command can be used as a replacement for the <code>npm</code> even when not using the bun runtime. A motivation for doing this is that <code>bun</code> is significantly faster than <code>npm</code>.</p><p>Just like in Node.js, Bun tracks dependencies in a <code>package.json</code> file and installs dependencies in the <code>node_modules</code> directory.</p><p>Adding dependencies with the <code>bun</code> command is much faster than adding them with the <code>npm</code> command.</p><p>To add a runtime dependency to a Bun project, enter <code>bun add {package-name}</code> (or <code>bun a</code>).</p><p>To add a development dependency to a Bun project, enter <code>bun add -d {package-name}</code>.</p><p>To update a runtime or development dependency in a Bun project, enter <code>bun update {package-name}</code>.</p><p>To remove a runtime or development dependency to a Bun project, enter <code>bun remove {package-name}</code> (or <code>bun rm</code>).</p><p>To install all the dependencies listed in <code>package.json</code>, enter <code>bun install</code> (or <code>bun i</code>).</p><p>All downloaded packages are stored in the global cache directory <code>~/.bin/install/cache</code>. When a project adds a dependency to a package version that is already in the global cache directory, it is &quot;copied&quot; from there instead of downloading it again. In Linux this uses hardlinks. In MacOS, this uses &quot;clonefile&quot; which implements &quot;copy on write&quot;. In both cases, the operation is extremely fast because the files are not actually copied.</p><h2 id="linting" tabindex="-1">Linting</h2><p>Bun does not include support for code linting. To add this using ESLint:</p><ol><li><p>Enter <code>npm init @eslint/config</code>. Note that this uses <code>npm</code> and not <code>bun</code>. This will ask a series of questions, install the required dependencies, and create an ESLint configuration file.</p></li><li><p>Add the following script in <code>package.json</code>:</p><pre class="language-json"><code class="language-json"><span class="token property">"lint"</span><span class="token operator">:</span> <span class="token string">"eslint 'src/**/*.{css,html,ts,tsx}'"</span><span class="token punctuation">,</span></code></pre></li></ol><p>To lint all the source files in the current project, enter <code>bun run lint</code>.</p><h2 id="code-formatting" tabindex="-1">Code Formatting</h2><p>Bun does not include support for code formatting. To add this using Prettier:</p><ol><li><p>Install Prettier with <code>bun add -d prettier</code></p></li><li><p>Create the file <code>.prettierrc</code> with content similar to the following:</p><pre class="language-text"><code class="language-text">{<br>  "arrowParens": "avoid",<br>  "bracketSpacing": false,<br>  "singleQuote": true,<br>  "trailingComma": "none"<br>}</code></pre></li><li><p>Add the following script in <code>package.json</code>:</p><pre class="language-json"><code class="language-json"><span class="token property">"format"</span><span class="token operator">:</span> <span class="token string">"prettier --write 'src/**/*.{css,html,ts,tsx}'"</span><span class="token punctuation">,</span></code></pre></li></ol><p>To format all the source files in the current project, enter <code>bun run format</code>.</p><h2 id="bundling" tabindex="-1">Bundling</h2><p>Bun can bundle all the files for an application into a single JavaScript file.</p><p>To demonstrate this:</p><ol><li><p>Create a new project by entering <code>bun init</code>.</p></li><li><p>Create the file <code>bar.ts</code> containing the following:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'in bar.ts'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Create the file <code>foo.ts</code> containing the following:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>bar<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./bar'</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'in foo.ts'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Modify the file <code>index.ts</code> to contain the following:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>foo<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./foo'</span><span class="token punctuation">;</span><br><br><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'in index.ts'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Bundle these three <code>.ts</code> files by entering <code>bun build index.ts --outdir build</code>.</p></li><li><p>Run the bundled file by entering <code>bun run build/index.js</code>. This should produce the following output:</p><pre class="language-text"><code class="language-text">in index.ts<br>in foo.ts<br>in bar.ts</code></pre></li></ol><p>As an alternative to the last step, create the file <code>bundle.ts</code> containing the following and run it by entering <code>bun run bundle.ts</code>:</p><pre class="language-ts"><code class="language-ts">Bun<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  entrypoints<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'index.ts'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>  outdir<span class="token operator">:</span> <span class="token string">'build'</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="unit-tests" tabindex="-1">Unit Tests</h2><p>Bun has builtin support for implementing and running unit tests that are mostly compatible with Jest.</p><p>Suppose we have the following code in the file <code>math.ts</code>:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span>n1<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> n2<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> n1 <span class="token operator">+</span> n2<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>To implement a unit test for the module defined above, add the following code in the file <code>math.test.ts</code>:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>expect<span class="token punctuation">,</span> test<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'bun:test'</span><span class="token punctuation">;</span><br><span class="token comment">// Can also import describe, beforeAll, beforeEach, afterAll, and afterEach.</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>add<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./math'</span><span class="token punctuation">;</span><br><br><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>To run all the unit tests in the current project, including those found in subdirectories, enter <code>bun test</code>.</p><p>To only run tests whose name matches a given pattern, add the <code>--test-name-pattern {pattern}</code> option.</p><p>To automatically rerun tests when code changes are saved, enter <code>bun --watch test</code>.</p><p>Other functions that can be imported from <code>bun:test</code> include <code>describe</code>, <code>beforeAll</code>, <code>afterAll</code>, <code>beforeEach</code>, and <code>afterEach</code>.</p><p>By default tests timeout and are considered failed after five seconds. To change this, add the <code>--timeout {seconds}</code> option.</p><h2 id="global-variables" tabindex="-1">Global Variables</h2><p>Bun provides the following global variables. For details, see <a href="https://bun.sh/docs/api/globals?v=1.1.1" rel="noopener" target="_blank">Globals</a>.</p><ul><li><p>Bun-specific</p><ul><li>BuildMessage</li><li>Bun</li><li>ResolveMessage</li></ul><p>Add the following in <code>tsconfig.json</code> so VS Code doesn't complain about the <code>Bun</code> global variable.</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    ...<br>    <span class="token property">"types"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>      <span class="token string">"bun-types"</span> <span class="token comment">// add Bun global</span><br>    <span class="token punctuation">]</span><br>    ...<br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Cloudflare</p><ul><li>HTMLRewriter</li></ul></li><li><p>Cross-platform</p><ul><li>globalThis</li></ul></li><li><p>Node.js</p><ul><li>__dirname</li><li>__filename</li><li>Buffer</li><li>exports</li><li>global</li><li>module</li><li>process</li><li>require()</li></ul></li><li><p>Web</p><ul><li>AbortController</li><li>AbortSignal</li><li>alert</li><li>Blob</li><li>ByteLengthQueuingStrategy</li><li>confirm</li><li>atob()</li><li>btoa()</li><li>clearImmediate()</li><li>clearInterval()</li><li>clearTimeout()</li><li>console</li><li>CountQueuingStrategy</li><li>Crypto</li><li>crypto</li><li>CryptoKey</li><li>CustomEvent</li><li>Event</li><li>EventTarget</li><li>fetch</li><li>FormData</li><li>Headers</li><li>JSON</li><li>MessageEvent</li><li>performance</li><li>prompt</li><li>queueMicrotask()</li><li>ReadableByteStreamController</li><li>ReadableStream</li><li>ReadableStreamDefaultController</li><li>ReadableStreamDefaultReader</li><li>reportError</li><li>Response</li><li>Request</li><li>setImmediate()</li><li>setInterval()</li><li>setTimeout()</li><li>ShadowRealm</li><li>SubtleCrypto</li><li>DOMException</li><li>TextDecoder</li><li>TextEncoder</li><li>TransformStream</li><li>TransformStreamDefaultController</li><li>URL</li><li>URLSearchParams</li><li>WebAssembly</li><li>WritableStream</li><li>WritableStreamDefaultController</li><li>WritableStreamDefaultWriter Web</li></ul></li></ul><h2 id="importing-files" tabindex="-1">Importing Files</h2><p>A text file can be imported as a string.</p><p>The following text file <code>haiku.txt</code> contains three lines.</p><pre class="language-text"><code class="language-text">Out of memory.<br>We wish to hold the whole sky,<br>But we never will.</code></pre><p>The following code demonstrates importing and using the text file above.</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> haiku <span class="token keyword">from</span> <span class="token string">'./haiku.txt'</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> lines <span class="token operator">=</span> haiku<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> line <span class="token keyword">of</span> lines<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> words <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>words<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> words: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>line<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>The output of this code is:</p><pre class="language-text"><code class="language-text">3 words: Out of memory.<br>7 words: We wish to hold the whole sky,<br>4 words: But we never will.</code></pre><p>A JSON or TOML file can be imported as JavaScript object.</p><p>The following text file <code>dogs.json</code> describes two dogs.</p><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>  <span class="token punctuation">{</span><span class="token property">"breed"</span><span class="token operator">:</span> <span class="token string">"Whippet"</span><span class="token punctuation">,</span> <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Comet"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><span class="token property">"breed"</span><span class="token operator">:</span> <span class="token string">"German Shorthaired Pointer"</span><span class="token punctuation">,</span> <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Oscar"</span><span class="token punctuation">}</span><br><span class="token punctuation">]</span></code></pre><p>The following code demonstrates importing and using the JSON file above.</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> dogs <span class="token keyword">from</span> <span class="token string">'./dogs.json'</span><span class="token punctuation">;</span><br><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> dog <span class="token keyword">of</span> dogs<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dog<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is a </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dog<span class="token punctuation">.</span>breed<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>The output of this code is:</p><pre class="language-text"><code class="language-text">Comet is a Whippet.<br>Oscar is a German Shorthaired Pointer.</code></pre><h2 id="bun-global-variable" tabindex="-1">Bun Global Variable</h2><p>The <code>Bun</code> global variable has many properties, most of which are functions. Highlights include:</p><ul><li><code>Bun.build</code>: compiles a collection of source files into a single source file</li><li><code>Bun.serve</code>: function that starts an HTTP server</li></ul><h2 id="http-server" tabindex="-1">HTTP Server</h2><p>Bun has builtin support for implementing HTTP servers using the <code>Bun.serve</code> function.</p><p>To implement a basic HTTP server, create a Bun project and replace the contents of <code>index.ts</code> with the following:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> server <span class="token operator">=</span> Bun<span class="token punctuation">.</span><span class="token function">serve</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span><br>  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">'Hi! This is my first Bun server!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token function">error</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Handle the error.</span><br>    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token comment">// optional to support HTTPS</span><br>  <span class="token literal-property property">tls</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">cert</span><span class="token operator">:</span> Bun<span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">'./cert.pem'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">key</span><span class="token operator">:</span> Bun<span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">'./key.pem'</span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server started on port '</span><span class="token punctuation">,</span> server<span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>To run this, enter <code>bun run index.js</code> and browse <code>localhost:3000</code>.</p><p>To simplify starting the server, add the following in <code>package.json</code>:</p><pre class="language-json"><code class="language-json">  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"bun run index.ts"</span><br>  <span class="token punctuation">}</span></code></pre><p>Now the server can be started by entering <code>bun start</code> or <code>bun run start</code>.</p><h2 id="watch-mode" tabindex="-1">Watch Mode</h2><p>To automatically restart a server when code changes are detected, add the following script in <code>package.json</code>:</p><pre class="language-json"><code class="language-json">    <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"bun --watch index.ts"</span></code></pre><p>Then start the server with <code>bun dev</code>.</p><p>To patch the code in place when code changes are detected and not restart the server, use the <code>--hot</code> flag in place of <code>--watch</code>. Technically this updates the internal module cache with the new code.</p><p>For more detail, see <a href="https://bun.sh/docs/runtime/hot?v=1.1.1" rel="noopener" target="_blank">Watch mode</a>.</p><p>This will not refresh a web browser that is displaying content obtained from a Bun server. One way to do that is to use a WebSocket connection.</p><p>Add the following in the server code:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> WebSocket <span class="token keyword">from</span> <span class="token string">'ws'</span><span class="token punctuation">;</span><br><span class="token keyword">new</span> <span class="token class-name">WebSocket<span class="token punctuation">.</span>Server</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">1920</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Add the following in the client-side code:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:1920'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// gives the server time to restart</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The client will lose the WebSocket connect when the server restarts. It will wait 500ms and then reload the browser. By that time the server should be back up again. Even if it isn't, the browser will wait for it.</p><h2 id="environment-variables" tabindex="-1">Environment Variables</h2><p>Bun has builtin support for getting environment variable values from the file <code>.env</code>. For example, suppose this file contains <code>NAME=Mark</code>. The value <code>Mark</code> can be obtained with <code>process.env.NAME</code> or <code>Bun.env.NAME</code>.</p><p>Environment variable values can reference previously defined environment variables.</p><p>For example, suppose the <code>.env</code> file contains the following:</p><pre class="language-text"><code class="language-text">NAME=Mark<br>GREETING="Hello, ${NAME}!"</code></pre><p>The following test will pass:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>expect<span class="token punctuation">,</span> test<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'bun:test'</span><span class="token punctuation">;</span><br><br><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'environment variables'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NAME</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'Mark'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span>Bun<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">GREETING</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'Hello, Mark!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Changes to the <code>.env</code> after a server is started are only available if the server is restarted.</p><h2 id="executable-files" tabindex="-1">Executable Files</h2><p>To allow a JS/TS source file to be executed directly:</p><ol><li>Add the line <code>#!/usr/bin/env bun</code> at the beginning of the file.</li><li>Compile the file with <code>bun build ./file-name.ts --outfile file-name --compile</code></li><li>Enter <code>file-name</code>.</li></ol><h2 id="executing-without-installing" tabindex="-1">Executing Without Installing</h2><p>The <code>npx</code> command can be used to execute a Node package that may not already be installed. For example, <code>npx cowsay Hello Cow!</code> outputs ASCII text that depicts a cow with a speech bubble.</p><p>The same can be done with Bun using <code>bun x</code> (or <code>bunx</code>). The main difference is that the Bun approach is much faster.</p><h2 id="import.meta" tabindex="-1">import.meta</h2><p>The global variable <code>import</code> has a <code>meta</code> property whose value is an object. This object contains several properties and one method, each of which are demonstrated in the following code.</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>expect<span class="token punctuation">,</span> test<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'bun:test'</span><span class="token punctuation">;</span><br><br><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'import.meta'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token comment">// import.meta.env is just an alias for process.env.</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// These get the directory and file name of the current file.</span><br>  <span class="token keyword">const</span> dir <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>dir<span class="token punctuation">;</span><br>  <span class="token keyword">const</span> file <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>file<span class="token punctuation">;</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'/Users/volkmannm/Documents/dev/bun/bun-examples'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'import-meta.test.ts'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// This indicates whether the current file is the one</span><br>  <span class="token comment">// that was directly executed by "bun run" or "bun test".</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>main<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// This finds the path of a file relative to the current file.</span><br>  <span class="token keyword">const</span> importName <span class="token operator">=</span> <span class="token string">'dogs.json'</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> resolved <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'./'</span> <span class="token operator">+</span> importName<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span>resolved<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>importName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="console" tabindex="-1">Console</h2><p>The global <code>console</code> object in Bun supports all the same methods as in browsers and Node.js.</p><p>It can also be used as an <code>AsyncIterable</code> to read from stdin. The following code demonstrates this. It repeatedly prompts for text to be entered and reports the number of words and characters. Pressing return without entering any text ends the program.</p><pre class="language-ts"><code class="language-ts"><span class="token comment">// Using console.write avoids outputting a newline characters at the end.</span><br><span class="token keyword">const</span> <span class="token function-variable function">prompt</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'Enter text: '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> line <span class="token keyword">of</span> <span class="token builtin">console</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> trimmed <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>trimmed<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// break does not exit a "for await" loop</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">const</span> words <span class="token operator">=</span> trimmed<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">words: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>words<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, characters: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>line<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h2 id="utilities" tabindex="-1">Utilities</h2><p>The <code>Bun</code> global variable refers to an object with many properties and methods including:</p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code>deepEquals(obj1, obj2 [, strict])</code></td><td>recursively compares two objects</td></tr><tr><td><code>deflateSync(buffer)</code></td><td>compresses using DEFLATE</td></tr><tr><td><code>env</code></td><td>alias for <code>process.env</code></td></tr><tr><td><code>escapeHTML(value)</code></td><td>escapes built-in entities in HTML</td></tr><tr><td><code>fileURLToPath(url)</code></td><td>converts a <code>file://</code> URL string to an absolute path</td></tr><tr><td><code>gunzipSync(buffer)</code></td><td>decompresses using GUNZIP</td></tr><tr><td><code>gzipSync(buffer)</code></td><td>compresses using GZIP</td></tr><tr><td><code>inflateSync(buffer)</code></td><td>decompresses using INFLATE</td></tr><tr><td><code>inspect.custom</code></td><td>symbol that can be defined as a method to customize what <code>inspect</code> returns</td></tr><tr><td><code>inspect(obj)</code></td><td>serializes an object to a string like <code>console.log</code></td></tr><tr><td><code>main</code></td><td>absolute path to entry point source file</td></tr><tr><td><code>nanoseconds()</code></td><td>returns nanoseconds since this <code>bun</code> process started</td></tr><tr><td><code>openInEditor(file)</code></td><td>opens a file in the default editor</td></tr><tr><td><code>pathToFileURL(path)</code></td><td>converts an absolute path to a <code>file://</code> URL string</td></tr><tr><td><code>peek(promise)</code></td><td>gets a promise result without <code>await</code> or <code>.then</code> when already settled</td></tr><tr><td><code>readableStreamTo*(stream)</code></td><td>set of functions that asynchronously consume a readable stream</td></tr><tr><td><code>resolveSync(path, root)</code></td><td>resolves a file path or module specifier</td></tr><tr><td><code>revision</code></td><td>string containing git commit id of bun version</td></tr><tr><td><code>sleep(ms)</code></td><td>returns Promise that resolves after <code>ms</code> milliseconds</td></tr><tr><td><code>sleepSync(ms)</code></td><td>blocks for <code>ms</code> milliseconds</td></tr><tr><td><code>version</code></td><td>string containing bun version</td></tr><tr><td><code>which(executableName)</code></td><td>returns absolute path to an executable</td></tr></tbody></table><p>For more detail see <a href="https://bun.sh/docs/api/utils?v=1.1.1" rel="noopener" target="_blank">Utils</a>.</p><h2 id="jsx" tabindex="-1">JSX</h2><p>Bun supports embedding JSX for HTML templating in source files with <code>.jsx</code> or <code>.tsx</code> file extensions.</p><p>The <code>compilerOptions</code> property in <code>tsconfig.json</code> determines how JSX is processed. For example, the following settings enable using JSX with the Hono framework:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    ...<br>    <span class="token property">"jsx"</span><span class="token operator">:</span> <span class="token string">"react-jsx"</span><span class="token punctuation">,</span><br>    <span class="token property">"jsxImportSource"</span><span class="token operator">:</span> <span class="token string">"hono/jsx"</span><br>    ...<br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>Depending on the JSX library used, calling <code>toString</code> on a variable set to a JSX value returns an HTML string. This works with the Hono framework.</p><p>Bun supports &quot;prop punning&quot; which is a shorthand syntax for props that have the same name as an in-scope variable. For example, the following are equivalent when the variables <code>class</code> and <code>value</code> are in scope:</p><pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{class}</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{value}</span> <span class="token punctuation">/></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">{class}</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">{value}</span> <span class="token punctuation">/></span></span></code></pre><p>For more detail, see the Bun documentation on <a href="https://bun.sh/docs/runtime/jsx?v=1.1.1" rel="noopener" target="_blank">JSX</a>.</p><h2 id="serializing-objects" tabindex="-1">Serializing Objects</h2><p>The <code>bun:jsc</code> module supports serializing and deserializing JavaScript values. For example:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>serialize<span class="token punctuation">,</span> deserialize<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'bun:jsc'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>expect<span class="token punctuation">,</span> test<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'bun:test'</span><span class="token punctuation">;</span><br><br><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'serialize'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> dogs <span class="token operator">=</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Comet'</span><span class="token punctuation">,</span> breed<span class="token operator">:</span> <span class="token string">'Whippet'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Oscar'</span><span class="token punctuation">,</span> breed<span class="token operator">:</span> <span class="token string">'German Shorthaired Pointer'</span><span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> buffer <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> newDogs <span class="token operator">=</span> <span class="token function">deserialize</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span>newDogs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toStrictEqual</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="writing-and-reading-files" tabindex="-1">Writing and Reading Files</h2><p>The following code demonstrates how to write and read text files using the Bun APIs.</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>expect<span class="token punctuation">,</span> test<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'bun:test'</span><span class="token punctuation">;</span><br><br><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'write/read file'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> filePath <span class="token operator">=</span> <span class="token string">'./data.txt'</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token string">'Hello, World!'</span><span class="token punctuation">;</span><br>  <span class="token comment">// The second argument to the write function can be a string,</span><br>  <span class="token comment">// Buffer, file, or the awaited result of a fetch call.</span><br>  <span class="token keyword">await</span> Bun<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> file <span class="token operator">=</span> Bun<span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> actual <span class="token operator">=</span> <span class="token keyword">await</span> file<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// Other methods on File objects include arrayBuffer, blob, and json.</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span>actual<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="globbing" tabindex="-1">Globbing</h2><p>Bun provides a way to iterate over files that match a given glob pattern.</p><p>The following code lists all TypeScript source files in and below the current directory, excluding any found in <code>node_modules</code> directories.</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>Glob<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'bun'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> glob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Glob</span><span class="token punctuation">(</span><span class="token string">'**/*.ts'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> file <span class="token keyword">of</span> glob<span class="token punctuation">.</span><span class="token function">scan</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// also see glob.scanSync</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'node_modules/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'/node_modules/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span><br>  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>For more detail see <a href="https://bun.sh/docs/api/glob?v=1.1.1" rel="noopener" target="_blank">Glob</a>.</p><h2 id="websockets" tabindex="-1">WebSockets</h2><p>Bun has builtin support for WebSockets.</p><p>The following code in the file <code>ws-server.ts</code> demonstrates writing a WebSocket server. It replies to all text messages with the same text converted to uppercase. To run this, enter</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> server <span class="token operator">=</span> Bun<span class="token punctuation">.</span><span class="token function">serve</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  port<span class="token operator">:</span> <span class="token number">1919</span><span class="token punctuation">,</span><br>  <span class="token function">fetch</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> server<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>server<span class="token punctuation">.</span><span class="token function">upgrade</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">'WebSocket upgrade failed'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>status<span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  websocket<span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token function">open</span><span class="token punctuation">(</span>ws<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'WebSocket opened'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token function">message</span><span class="token punctuation">(</span>ws<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'received:'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'type:'</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'sending response'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token function">close</span><span class="token punctuation">(</span>ws<span class="token punctuation">,</span> code<span class="token punctuation">,</span> reason<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">WebSocket closed with code </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> and reason "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>reason<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'WebSocket server is listening on port'</span><span class="token punctuation">,</span> server<span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The following code in the file <code>ws-client.html</code> demonstrates writing a WebSocket client. After starting the server above, open this in a web browser. Enter any text in the input and click the &quot;Send&quot; button.</p><pre class="language-ts"><code class="language-ts"><span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">></span><br>  <span class="token operator">&lt;</span>head<span class="token operator">></span><br>    <span class="token operator">&lt;</span>script<span class="token operator">></span><br>      <span class="token keyword">let</span> input<span class="token punctuation">,</span> message<span class="token punctuation">,</span> output<span class="token punctuation">;</span><br>      window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        message <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        input <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        output <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'output'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>      <span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:1919'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> event <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'opened connection'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> event <span class="token operator">=></span> <span class="token punctuation">{</span><br>        output<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      <span class="token keyword">function</span> <span class="token function">send</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        input<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> text<span class="token punctuation">;</span><br>        ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span><br>  <span class="token operator">&lt;</span>body<span class="token operator">></span><br>    <span class="token operator">&lt;</span>h1<span class="token operator">></span>WebSocket Client<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><br>    <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">"message"</span> <span class="token operator">/</span><span class="token operator">></span><br>    <span class="token operator">&lt;</span>button onclick<span class="token operator">=</span><span class="token string">"send(message.value)"</span><span class="token operator">></span>Send<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><br>    <span class="token operator">&lt;</span>div<span class="token operator">></span>Input<span class="token operator">:</span> <span class="token operator">&lt;</span>span id<span class="token operator">=</span><span class="token string">"input"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br>    <span class="token operator">&lt;</span>div<span class="token operator">></span>Output<span class="token operator">:</span> <span class="token operator">&lt;</span>span id<span class="token operator">=</span><span class="token string">"output"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span><br><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span></code></pre><h2 id="sqlite" tabindex="-1">SQLite</h2><p>Bun has builtin support for SQLite databases. However, it does not install SQLite. For macOS, SQLite can be installed using Homebrew.</p><p>After installing SQLite, a database containing a table with records can be created with the following steps:</p><pre class="language-bash"><code class="language-bash">sqlite3 todos.db<br>sqlite<span class="token operator">></span> create table todos<span class="token punctuation">(</span>id string primary key, text string, completed numeric<span class="token punctuation">)</span><span class="token punctuation">;</span><br>sqlite<span class="token operator">></span> .schema<br>CREATE TABLE todos<span class="token punctuation">(</span>id string primary key, text string, completed numeric<span class="token punctuation">)</span><span class="token punctuation">;</span><br>sqlite<span class="token operator">></span> insert into todos values<span class="token punctuation">(</span><span class="token string">'t1'</span>, <span class="token string">'cut grass'</span>, <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>sqlite<span class="token operator">></span> insert into todos values<span class="token punctuation">(</span><span class="token string">'t2'</span>, <span class="token string">'buy milk'</span>, <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>sqlite<span class="token operator">></span> <span class="token keyword">select</span> * from todos<span class="token punctuation">;</span><br>t1<span class="token operator">|</span><span class="token function">cut</span> grass<span class="token operator">|</span><span class="token number">0</span><br>t2<span class="token operator">|</span>buy milk<span class="token operator">|</span><span class="token number">1</span><br>sqlite<span class="token operator">></span> .exit</code></pre><p>This creates the file <code>todos.db</code> that contains all the tables for this database (only one in this case).</p><p>To access this database from code, write something like the following in the file <code>sqlite.test.ts</code>:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>Database<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'bun:sqlite'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>expect<span class="token punctuation">,</span> test<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'bun:test'</span><span class="token punctuation">;</span><br><br><span class="token keyword">type</span> <span class="token class-name">Todo</span> <span class="token operator">=</span> <span class="token punctuation">{</span><br>  id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span><br>  text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span><br>  completed<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> <span class="token comment">// 0 or 1 for SQLite compatibility</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Database</span><span class="token punctuation">(</span><span class="token string">'todos.db'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>create<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// Alternative way to access database in src directory:</span><br><span class="token comment">// import {Statement} from 'bun:sqlite';</span><br><span class="token comment">// import db from "./todos.db" with {"type": "sqlite"};</span><br><span class="token keyword">const</span> deleteAllTodosPS <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string">'delete from todos'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> deleteTodoPS <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string">'delete from todos where id = ?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> getTodoQuery <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'select * from todos where id = ?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> getAllTodosQuery <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'select * from todos;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> insertTodoQuery <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><br>  <span class="token string">'insert into todos (text, completed) values (?, 0) returning id'</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> updateTodoPS <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string">'update todos set completed=? where id = ?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'sqlite'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  deleteAllTodosPS<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token string">'buy milk'</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span>id<span class="token punctuation">}</span> <span class="token operator">=</span> insertTodoQuery<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">{</span>id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token comment">// console.log('id =', id);</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeGreaterThan</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">let</span> todos <span class="token operator">=</span> getAllTodosQuery<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> Todo<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span>todos<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">let</span> <span class="token punctuation">[</span>todo<span class="token punctuation">]</span> <span class="token operator">=</span> todos<span class="token punctuation">;</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span>todo<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  updateTodoPS<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> todo<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  todo <span class="token operator">=</span> getTodoQuery<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>todo<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token keyword">as</span> Todo<span class="token punctuation">;</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span>todo<span class="token punctuation">.</span>completed<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  deleteTodoPS<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>todo<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  todos <span class="token operator">=</span> getAllTodosQuery<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> Todo<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span>todos<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Run this with <code>bun test sqlite.test.ts</code>.</p><h2 id="foreign-function-interface-(ffi)" tabindex="-1">Foreign Function Interface (FFI)</h2><p>The <code>bun:ffi</code> module supports calling functions implemented in languages other than JavaScript that support the C ABI. These include C, C++, Kotlin, Rust, Zig, and more.</p><p>The following Zig code defines a function that computes the average of numbers in an array. The array must be passed as a pointer to the first element and a length.</p><pre class="language-zig"><code class="language-zig"><span class="token keyword">pub</span> <span class="token keyword">export</span> <span class="token keyword">fn</span> <span class="token function">average</span><span class="token punctuation">(</span>numbers_ptr<span class="token punctuation">:</span> <span class="token class-name"><span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span><span class="token keyword">const</span> <span class="token builtin-type keyword">f32</span></span><span class="token punctuation">,</span> len<span class="token punctuation">:</span> <span class="token class-name"><span class="token builtin-type keyword">usize</span></span><span class="token punctuation">)</span> <span class="token class-name"><span class="token builtin-type keyword">f32</span></span> <span class="token punctuation">{</span><br>    <span class="token keyword">var</span> sum<span class="token punctuation">:</span> <span class="token class-name"><span class="token builtin-type keyword">f32</span></span> <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> numbers <span class="token operator">=</span> numbers_ptr<span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">..</span>len<span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token keyword">for</span> <span class="token punctuation">(</span>numbers<span class="token punctuation">)</span> <span class="token operator">|</span>number<span class="token operator">|</span> <span class="token punctuation">{</span><br>        sum <span class="token operator">+=</span> number<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">const</span> float_len<span class="token punctuation">:</span> <span class="token class-name"><span class="token builtin-type keyword">f32</span></span> <span class="token operator">=</span> <span class="token builtin">@floatFromInt</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> sum <span class="token operator">/</span> float_len<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>To build this as a library, enter <code>zig build-lib average.zig -dynamic -OReleaseFast</code>.</p><p>The following JavaScript code uses <code>bun:ffi</code> to call the Zig function.</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>dlopen<span class="token punctuation">,</span> FFIType<span class="token punctuation">,</span> ptr<span class="token punctuation">,</span> suffix<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'bun:ffi'</span><span class="token punctuation">;</span><br><br><span class="token comment">// Open a dynamic library.</span><br><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">libaverage.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>suffix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><span class="token keyword">const</span> lib <span class="token operator">=</span> <span class="token function">dlopen</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token punctuation">{</span><br>  average<span class="token operator">:</span> <span class="token punctuation">{</span><br>    args<span class="token operator">:</span> <span class="token punctuation">[</span>FFIType<span class="token punctuation">.</span>ptr<span class="token punctuation">,</span> FFIType<span class="token punctuation">.</span>i32<span class="token punctuation">]</span><span class="token punctuation">,</span><br>    returns<span class="token operator">:</span> FFIType<span class="token punctuation">.</span>f32<br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Get a reference to the average function.</span><br><span class="token keyword">const</span> average <span class="token operator">=</span> lib<span class="token punctuation">.</span>symbols<span class="token punctuation">.</span>average<span class="token punctuation">;</span><br><br><span class="token comment">// Create and pass a typed array.</span><br><span class="token keyword">const</span> numbers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">average</span><span class="token punctuation">(</span><span class="token function">ptr</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">,</span> numbers<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'average is'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>To run this, enter <code>bun run index.ts</code>. The expected output is &quot;average is 2.5&quot;.</p><p>For more detail, see <a href="https://bun.sh/docs/api/ffi?v=1.1.1" rel="noopener" target="_blank">FFI</a>. That page includes a list of all the supported FFI types.</p><h2 id="bun-shell" tabindex="-1">Bun Shell</h2><p>&quot;The <a href="https://bun.sh/blog/the-bun-shell?v=1.1.1" rel="noopener" target="_blank">Bun Shell</a> is a new experimental embedded language and interpreter in Bun that allows you to run cross-platform shell scripts in JavaScript &amp; TypeScript.&quot;</p><p>The following code uses Bun Shell to output the names of all the files in the current directory.</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>$<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'bun'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> lines <span class="token operator">=</span> $<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ls .</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">.</span><span class="token function">lines</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> line <span class="token keyword">of</span> lines<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h2 id="elysiajs" tabindex="-1">ElysiaJS</h2><p><a href="https://elysiajs.com?v=1.1.1" rel="noopener" target="_blank">ElysiaJS</a> is a &quot;TypeScript framework supercharged by Bun with End-to-End Type Safety, unified type system and outstanding developer experience.&quot;</p><p>Elysia is a bun-specific server framework that is 18 times faster than Express. <a href="https://hono.dev?v=1.1.1" rel="noopener" target="_blank">Hono</a> is a close competitor to Elysia.</p><p>To create a new Bun project that uses ElysiaJS:</p><ul><li><p><code>bun create elysia {destination}</code></p><p>The destination is used as the name of a directory to create and can be <code>.</code> to create the project in the current directory.</p></li><li><p><code>cd project-name</code></p></li><li><p><code>bun dev</code> provides hot reloading</p></li><li><p>browse localhost:3000</p></li></ul><p>To define new routes in the project ...</p><p>See the example at <a href="https://github.com/mvolkmann/bun-elysia-demo?v=1.1.1" rel="noopener" target="_blank">bun-elysia-demo</a> GitHub repository.</p><p>When a URL path for hitting an Elysia server does not end in a file name, it does not default to rendering the file &quot;index.html&quot;. To do that, end the URL with &quot;/index.html&quot;. See this <a href="https://github.com/elysiajs/elysia/issues/327?v=1.1.1" rel="noopener" target="_blank">issue</a>.</p><p>For an alternative that runs in Bun and other JavaScript runtimes, see <a href="/blog/topics/#/blog/hono/" target="_blank">Hono</a>.</p><h2 id="todos" tabindex="-1">TODOs</h2><ul><li>Compare performance of bun, deno, and node on your rush-hour code.</li><li>Implement your rush-hour program in Zig and compare performance.</li></ul></article>