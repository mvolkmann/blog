<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Bun</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#installing">Installing</a></li><li><a href="#repl">REPL</a></li><li><a href="#projects">Projects</a></li><li><a href="#help">Help</a></li><li><a href="#dependencies">Dependencies</a></li><li><a href="#code-formatting">Code Formatting</a></li><li><a href="#unit-tests">Unit Tests</a></li><li><a href="#bun-global-variable">Bun Global Variable</a></li><li><a href="#http-server">HTTP Server</a></li><li><a href="#watch-mode">Watch Mode</a></li><li><a href="#environment-variables">Environment Variables</a></li><li><a href="#executable-files">Executable Files</a></li><li><a href="#executing-without-installing">Executing Without Installing</a></li><li><a href="#cleanup-up-remainder-of-this-content">CLEANUP UP REMAINDER OF THIS CONTENT</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p>&quot;<a href="https://bun.sh?v=1.0.22" rel="noopener" target="_blank">Bun</a> is a fast JavaScript all-in-one toolkit.&quot; It includes a JavaScript runtime, package manager, bundler, and test runner. Bun is free and open source.</p><p>Development of Bun started in 2022 by Jarred Sumner with VC funding. Bun became stable (1.0) in September 2023.</p><p>Bun was created by the startup company <a href="https://oven.sh/?v=1.0.22" rel="noopener" target="_blank">Oven.sh</a> because that’s what buns come out of. Oven will donate Zig to the Zig Software Foundation to keep the project going.</p><p>Bun is built on JavaScriptCore from Safari which has faster startup times than V8. Bun supports TypeScript out of the box.</p><p>Bun is implemented in Zig and some C++. &quot;Zig is sort of similar to writing C, but with better memory safety features in debug mode and modern features like defer (sort of similar to Go's) and arbitrary code can be executed at compile-time via comptime. It's really good for writing performant low-level software.&quot; &quot;It has very few keywords so it's a lot easier to learn than, for example, C++ or Rust.&quot;</p><p>Bun works with nearly all major web frameworks including Next.js, SvelteKit, Astro, Nuxt, and Fastify.</p><p>The Bun package manager works with npm packages.</p><p>The name &quot;Bun&quot; came from a friend who suggested it because she has a bunny named &quot;Bun&quot;. The initial reaction was &quot;I'm not going to name it after your bunny. And then I thought about it more and it made some sense.&quot; It also makes sense because &quot;it’s a bundling of the JavaScript ecosystem and a bundler&quot;.</p><h2 id="installing" tabindex="-1">Installing</h2><p>To install Bun for macOS, Linux, or Windows Subsystem for Linux (WSL), enter <code>curl -fsSL https://bun.sh/install | bash</code>. This adds the <code>bun</code> executable.</p><p>To verify the installation and see the version that is installed, enter <code>bun --version</code> or <code>bun -v</code>.</p><p>To upgrade to the latest version, enter <code>bun upgrade</code>.</p><p>&quot;Bun provides a limited, experimental native build for Windows. At the moment, only the Bun runtime is supported.&quot;</p><h2 id="repl" tabindex="-1">REPL</h2><p>To start a Read-Evaluate-Print-Loop, enter <code>bun repl</code>. This takes a few seconds to install the first time it is run, but is much faster in subsequent runs.</p><h2 id="projects" tabindex="-1">Projects</h2><p>To create a new Bun project, create a directory, cd to it, and enter <code>bun init</code>. This creates the files:</p><ul><li><p><code>README.md</code></p><p>This provides basic information about using Bun. The contents should be replaced with project-specific information.</p></li><li><p><code>bun.lockb</code></p><p>This is the Bun equivalent of <code>package-lock.json</code>, but it is in a binary format.</p></li><li><p><code>index.ts</code></p><p>This is the entry point source file.</p></li><li><p><code>package.json</code></p><p>This describes dependencies, scripts, and more.</p></li><li><p><code>tsconfig.json</code></p><p>This configures TypeScript.</p></li></ul><p>It also creates the directory <code>node_modules</code> that holds code for dependencies. Initially it contains the directories <code>.bin</code>, <code>bun-types</code>, and <code>typescript</code>. There is no need to run <code>npm install</code> to get started.</p><p>The file <code>index.ts</code> only contains the following:</p><pre class="language-js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Hello via Bun!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>To run the project, enter <code>bun run index.ts</code>. Note that TypeScript source files can be executed using <code>bun run</code> without installing additional packages or configuring anything.</p><p>It is somewhat common to create a <code>src</code> directory and move <code>index.ts</code> and other source files into it.</p><h2 id="help" tabindex="-1">Help</h2><p>To see all the subcommands supported by the <code>bun</code> command, enter <code>bun</code>. The subcommands include <code>init</code>, <code>run</code>, <code>test</code>, <code>repl</code>, <code>upgrade</code>, and more.</p><p>To see all the options supported by the <code>bun</code> command, enter <code>bun --help</code>.</p><p>To see a list of all scripts defined in <code>package.json</code>, enter <code>bun.run</code>.</p><h2 id="dependencies" tabindex="-1">Dependencies</h2><p>Just like in Node.js, Bun tracks dependencies in a <code>package.json</code> file and installs dependencies in the <code>node_modules</code> directory.</p><p>Adding dependencies with the <code>bun</code> command is much faster than adding them with the <code>npm</code> command.</p><p>To add a runtime dependency to a Bun project, enter <code>bun add {package-name}</code>.</p><p>To add a development dependency to a Bun project, enter <code>bun add -d {package-name}</code>.</p><p>To remove a runtime dependency to a Bun project, enter <code>bun remove {package-name}</code>.</p><p>To remove a development dependency to a Bun project, enter <code>bun remove -d {package-name}</code>.</p><h2 id="code-formatting" tabindex="-1">Code Formatting</h2><p>Bun does not include support for code formatting. To add this using Prettier:</p><ol><li><p>Install Prettier with <code>bun install -d prettier</code></p></li><li><p>Create the file <code>.prettierrc</code> with content similar to the following:</p><pre class="language-text"><code class="language-text">{<br>  "arrowParens": "avoid",<br>  "bracketSpacing": false,<br>  "singleQuote": true,<br>  "trailingComma": "none"<br>}</code></pre></li><li><p>Add the following script in <code>package.json</code>:</p><pre class="language-json"><code class="language-json"><span class="token property">"format"</span><span class="token operator">:</span> <span class="token string">"prettier --write 'src/**/*.{css,html,ts,tsx}'"</span><span class="token punctuation">,</span></code></pre></li></ol><p>To format all the source files in the current project, enter <code>bun run format</code>.</p><h2 id="unit-tests" tabindex="-1">Unit Tests</h2><p>Bun has builtin support for implementing and running unit tests that are mostly compatible with Jest.</p><p>Suppose we have the following code in the file <code>math.ts</code>:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span>n1<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> n2<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> n1 <span class="token operator">+</span> n2<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>To implement a unit test for the module defined above, add the following code in the file <code>math.test.ts</code>:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> expect<span class="token punctuation">,</span> test <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"bun:test"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> add <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./math"</span><span class="token punctuation">;</span><br><br><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"add"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>To run all the unit tests in the current project, including those found in subdirectories, enter <code>bun test</code>.</p><p>To only run tests whose name matches a given pattern, add the <code>--test-name-pattern {pattern}</code> option.</p><p>To automatically rerun tests when code changes are saved, enter <code>bun --watch test</code>.</p><p>Other functions that can be imported from <code>bun:test</code> include <code>describe</code>, <code>beforeAll</code>, <code>afterAll</code>, <code>beforeEach</code>, and <code>afterEach</code>.</p><p>By default tests timeout and are considered failed after five seconds. To change this, add the <code>--timeout {seconds}</code> option.</p><h2 id="bun-global-variable" tabindex="-1">Bun Global Variable</h2><p>The <code>Bun</code> global variable has many properties, most of which are functions. Highlights include:</p><ul><li><code>Bun.build</code>: compiles a collection of source files into a single source file</li><li><code>Bun.serve</code>: function that starts an HTTP server</li></ul><h2 id="http-server" tabindex="-1">HTTP Server</h2><p>To implement a basic HTTP server, replace the contents of <code>index.ts</code> with the following:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> server <span class="token operator">=</span> Bun<span class="token punctuation">.</span><span class="token function">serve</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span><br>  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">'Hi! This is my first Bun server!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server started on port '</span><span class="token punctuation">,</span> server<span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>To run this, enter <code>bun run index.js</code> and browse <code>localhost:3000</code>.</p><p>To simplify starting the server, add the following in <code>package.json</code>:</p><pre class="language-json"><code class="language-json">  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"bun run index.ts"</span><br>  <span class="token punctuation">}</span></code></pre><p>Now the server can be started by entering <code>bun start</code> or <code>bun run start</code>.</p><h2 id="watch-mode" tabindex="-1">Watch Mode</h2><p>To automatically restart a server when code changes are detected, add the following script in <code>package.json</code>:</p><pre class="language-json"><code class="language-json">    <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"bun --watch index.ts"</span></code></pre><p>Then start the server with <code>bun run dev</code>.</p><p>To patch the code in place when code changes are detected and not restart the server, use the <code>--hot</code> flag in place of <code>--watch</code>. Technically this updates the internal module cache with the new code. This will not refresh a web browser that is displaying content obtained from a Bun server.</p><p>For more detail, see <a href="https://bun.sh/docs/runtime/hot?v=1.0.22" rel="noopener" target="_blank">Watch mode</a>.</p><p>This will not automatically refresh browsers that browsing the server URL.</p><h2 id="environment-variables" tabindex="-1">Environment Variables</h2><p>Bun has builtin support for getting environment variables from the file <code>.env</code>. For example, suppose this file contains <code>FOO=bar</code>. The value <code>bar</code> can be obtained with <code>process.env.FOO</code> or <code>Bun.env.FOO</code>.</p><p>Changes to the <code>.env</code> after a server is started are only available if the server is restarted.</p><h2 id="executable-files" tabindex="-1">Executable Files</h2><p>To allow a JS/TS source file to be executed directly:</p><ol><li>Add the line <code>#!/usr/bin/env bun</code> at the beginning of the file.</li><li>Compile the file with <code>bun build ./file-name.ts --outfile file-name --compile</code></li><li>Enter <code>file-name</code>.</li></ol><h2 id="executing-without-installing" tabindex="-1">Executing Without Installing</h2><p>The <code>npx</code> command can be used to execute a Node package that may not already be installed. For example, <code>npx cowsay Hello Cow!</code> outputs ASCII text that depicts a cow with a speech bubble.</p><p>The same can be done with Bun using <code>bun x</code> or <code>bunx</code>. The main difference is that the Bun approach is much faster.</p><h2 id="cleanup-up-remainder-of-this-content" tabindex="-1">CLEANUP UP REMAINDER OF THIS CONTENT</h2><p>These notes are currently in a very rough form!</p><p>Compare performance of bun, deno, and node on your rush-hour code. Implement your rush-hour program in Zig. Compare performance.</p><p>Is the only plan for profit to provide hosting? “Oven has decided to adopt a strategy twinned with Deno Company. They will launch sales of a cloud architecture based on Bun.”</p><p>Create code examples that demonstrate the most important bun-specific APIs.</p><p>Does it share module code across projects like pnpm?</p><p>Why?</p><ul><li>simplifies current state of JS/TS tooling (transpilers, bundlers, testing tools, …); less to install and configure; easier to use</li><li>provides significantly better performance</li><li>supports both CommonJS (require) and ESM (import) in the same source files</li></ul><p>Features</p><ul><li>The bun runtime replaces Node.js and supports nearly all Node.js builtin modules (around 40 of them; rarely used modules such as dgram, http2, inspector, and repl are not yet supported; v8 module is specific to Webkit which Bun does not use)</li><li>Supports JSX/TSX files.</li><li>hot reloading with “bun —hot {file} (watch mode equivalent of nodemon?)</li><li>has a plugin API that is similar to that of esbuild, so many esbuild plugins work in bun without modification</li><li>bun:test a Jest-compatible test runner; 8 times faster than Vitest and 13 times faster than Jest</li><li>SQLite database built into the bun runtime; see bun:sqlite; 2 times faster than Deno and 4 times faster than Node in queries per second</li><li>bun-specific, highly-optimized APIs that perform better than Node.js equivalents<ul><li>Bun.file returns a File object with the same properties as DOM File objects; contents are lazily loaded; many async methods for reading content in different formats including text, json, stream, and ArrayBuffer; reads files up to 10 times faster</li><li>Bun.write to write many kinds of values including strings, buffers, files, and responses from HTTP requests; writes 3 times faster than Node.js</li><li>Bun.serve to start an HTTP server based on web APIs; handles 4 times as many requests per second as Node.js</li><li>Bun.env provides access to environment variables without using the dotenv package</li><li>Websocket support handles 5 times as many messages per second as Node.js and is easier to use</li><li>password hashing (uses Bcrypt and Argon)</li><li>many more APIs!</li></ul></li></ul><p>Performance</p><ul><li>4 times faster than Node.js for a hello world program</li><li>time to build and run TS code is 4 times faster than esbuild, 15 times faster than TSX, and 43 times faster than TSC + Node</li><li>“bun run” can be used in place of “npm run” and is 5 times faster</li><li>“bun install” is 29 times faster than npm and 17 times faster than pnpm; uses package.json files just like npm; uses a binary bun.lockb file instead of package-lock. json; can be used as a replacement for npm even when not using the bun runtime</li><li>“bunx” is the equivalent of “npx”</li></ul><p>Concerns</p><ul><li>Was it a good idea to build with Zig, a new, not yet popular language?</li><li>We’re the Node APIs implemented to have identical characteristics with no bugs?</li></ul><p>More</p><ul><li>Elysia is a bun-specific server framework which is 18 times faster than Express<ul><li><code>bun create elysia project-name</code> generates a scaffolded app</li><li><code>cd project-name</code></li><li><code>bun run dev</code> provides hot reloading</li><li>browse localhost:3000</li><li>bunx prisma init —datasource-provider mysql</li></ul></li><li>Hono is a close competitor to Elysia</li></ul></article>