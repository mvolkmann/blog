<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Remix</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#resources">Resources</a></li><li><a href="#creating-a-new-project">Creating a new project</a></li><li><a href="#project-structure">Project Structure</a></li><li><a href="#ui-components">UI Components</a></li><li><a href="#routes">Routes</a></li><li><a href="#dynamic-routes">Dynamic Routes</a></li><li><a href="#nested-routes">Nested Routes</a></li><li><a href="#resource-routes">Resource Routes</a></li><li><a href="#styling">Styling</a></li><li><a href="#links">Links</a></li><li><a href="#loaders">Loaders</a></li><li><a href="#actions">Actions</a></li><li><a href="#prefetching">Prefetching</a></li><li><a href="#spinners">Spinners</a></li><li><a href="#input-validation">Input Validation</a></li><li><a href="#schema-validation">Schema Validation</a></li><li><a href="#client-only-code">Client Only Code</a></li><li><a href="#error-boundaries">Error Boundaries</a></li><li><a href="#catch-boundaries">Catch Boundaries</a></li><li><a href="#building">Building</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p><a href="https://remix.run?v=1.1.1" rel="noopener" target="_blank">Remix</a> is &quot;a full stack web framework that lets you focus on the user interface and work back through web standards to deliver a fast, slick, and resilient user experience.&quot;</p><p>Remix enables many web applications to work with no client-side JavaScript code. If the use JavaScript is disabled in the browser, the Remix server will return fully-rendered HTML and perform full-page refreshes. If the use JavaScript is enabled in the browser, the Remix server will return JSON data describing updates to the current page and avoid performing full-page refreshes.</p><p>Remix is heavily based on React Router.</p><p>The hooks <code>useState</code> and <code>useEffect</code> can be used in Remix apps, but they tend to be used much less than in standard React apps.</p><p>Remix apps use a database for application state instead of a library like Redux.</p><p>Remix automatically provides route-level code splitting.</p><h2 id="resources" tabindex="-1">Resources</h2><ul><li><a href="https://www.epicweb.dev/?v=1.1.1" rel="noopener" target="_blank">EpicWeb.dev</a> - hosts articles and tutorials on Remix from Kent C. Dodds</li></ul><h2 id="creating-a-new-project" tabindex="-1">Creating a new project</h2><ol><li>Install Node.js.</li><li><code>cd</code> to the directory where the project will be created.</li><li>Enter <code>npx create-remix@latest</code></li><li>Enter a project directory path (ex. <code>./dogs</code>).</li><li>Press return for &quot;Initialize a new git repository?&quot;.</li><li>Press return for &quot;Install dependencies with npm?&quot;.</li><li><code>cd</code> to the new project directory.</li><li>See the <code>README.md</code> file for instructions.</li><li>Enter <code>npm run dev</code></li><li>Browse localhost:5173.</li></ol><h2 id="project-structure" tabindex="-1">Project Structure</h2><p>The <code>public</code> directory contains static assets like images.</p><p>The <code>app</code> directory defines the routes and components of the app.</p><p>The file <code>root.tsx</code> defines the root component. By default this:</p><ul><li>loads Tailwind styles</li><li>loads Google fonts,</li><li>renders <code>meta</code> tags specified by exported <code>meta</code> functions in your routes</li><li>renders <code>link</code> tags specified by exported <code>links</code> functions in your routes</li><li>renders JSX returned by the default function exported in your routes</li><li>and more</li></ul><p>The default export in <code>root.tsx</code> is function that renders an <code>Output</code> component which is responsible for rendering the content for each route. This also exports a <code>Layout</code> function which is the &quot;template&quot; used for rendering all routes. Content that should appear on every page, such as a top navigation bar, can be rendered in the <code>Layout</code> function.</p><p>The file <code>entry.server.tsx</code> defines the server code that runs on every request. Often no changes are needed in this file.</p><p>The file <code>entry.client.tsx</code> defines the code that runs in the browser. Often no changes are needed in this file.</p><p>The <code>app/routes</code> directory defines all the routes of the app that are mapped to URL paths. This begins with only the file <code>_index.tsx</code>.</p><p>To create a new page in the app, create a new file in the <code>app/routes</code> directory. To add a link to this page in <code>_index.tsx</code>, add an element like <code>&lt;a href=&quot;/demo&quot;&gt;Demo&lt;/a&gt;</code>. This downloads the page from the server. To perform client-side routing, import the <code>Link</code> component with:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>Link<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@remix-run/react'</span><span class="token punctuation">;</span></code></pre><p>and use the following instead of an anchor tag:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/demo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Demo Link<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Link</span><span class="token punctuation">></span></span></code></pre><p>Routes can be in deeper subdirectories to require a deeper URL path.</p><h2 id="ui-components" tabindex="-1">UI Components</h2><p>Consider using the React component library <a href="https://reach.tech?v=1.1.1" rel="noopener" target="_blank">Reach UI</a>. It provides many components including <code>Accordion</code>, <code>Alert</code>, <code>Combobox</code>, <code>Dialog</code>, <code>Portal</code>, <code>Slider</code>, <code>Tabs</code>, and <code>Tooltip</code>.</p><p>The Remix team plans to implement Remix-specific versions of these components in the future.</p><h2 id="routes" tabindex="-1">Routes</h2><p>To define routes, add <code>.tsx</code> files in and under the <code>routes</code> directory.</p><p>A route named &quot;demo&quot; can be defined by the file <code>demo.tsx</code> or by the directory &quot;demo&quot; containing the file <code>index.tsx</code>. The latter approach supports placing additional route-specific files in the same directory as <code>index.tsx</code>.</p><p>Subdirectories define URL paths and support nested routes.</p><p>File names containing dots in a addition to the one before the file extension define route paths. For example, the file <code>foo.bar.baz.tsx</code> defines the route <code>foo/bar/baz</code>.</p><h2 id="dynamic-routes" tabindex="-1">Dynamic Routes</h2><p>Dynamic routes have access to data from the URL used to render them.</p><p>Dynamic routes are defined by creating a source file in the <code>routes</code> directory whose name contains <code>$</code>. For example, <code>notes.$id.tsx</code>. The <code>.</code> after <code>notes</code> is translated to a <code>/</code>, so the path for visiting this page will be <code>notes/{some-id}</code>.</p><p>For example:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>useLoaderData<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@remix-run/react'</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">MyDynamicPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">useLoaderData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token punctuation">(</span><br>    <span class="token operator">&lt;</span>main<span class="token operator">></span><br>      <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">{</span>data<span class="token punctuation">.</span>someProperty<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>main<span class="token operator">></span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token punctuation">{</span>params<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> id <span class="token operator">=</span> params<span class="token punctuation">.</span>id<span class="token punctuation">;</span><br>  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getMyData</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">throw</span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>message<span class="token operator">:</span> <span class="token string">'Could not find data.'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>status<span class="token operator">:</span> <span class="token number">404</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">return</span> data<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h2 id="nested-routes" tabindex="-1">Nested Routes</h2><p>Any route can render its own HTML and the HTML of a child route by including <code>&lt;Outlet /&gt;</code> in its JSX.</p><p>When a nested route is visited, all of its ancestor routes are also rendered. This includes calling all the <code>loader</code> functions in the ancestor routes.</p><h2 id="resource-routes" tabindex="-1">Resource Routes</h2><p>Resource routes are routes that expose <code>loader</code> and <code>action</code> functions, but do not export a React component. These are only used for defining API endpoints and are not associated with a specific page in the UI.</p><p>A <code>loader</code> function can just return a JavaScript object and Remix will convert it to a JSON response and include a &quot;Content-Type&quot; header with a value of &quot;application/json; charset=utf-8&quot;. For example, the file <code>routes/song.tsx</code> could contain the following:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">loader</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span><br>  artist<span class="token operator">:</span> <span class="token string">'Phoebe Bridgers'</span><span class="token punctuation">,</span><br>  song<span class="token operator">:</span> <span class="token string">'Graceland Too'</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="styling" tabindex="-1">Styling</h2><p>Global CSS can be defined in a file inside the <code>app</code> directory. This can be included in <code>app/root.jsx</code> to make it available to all pages.</p><p>Styling that is specific to a page or component can be defined in <code>.css</code> files that are imported into the source file for the page or component.</p><p>CSS files for components can be placed in the same directory as the corresponding <code>.tsx</code> file and imported using the path <code>./{some-name}.css</code>.</p><p>CSS files for routes should be placed in the <code>app/styles</code> directory and imported using the path <code>~/styles/{some-name}.css?url</code>. The tilde (<code>~</code>) at the beginning of the path maps to the <code>app</code> directory.</p><p>For example:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span>LinksFunction<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@remix-run/node'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">'~/styles/Demo.css?url'</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> links<span class="token operator">:</span> <span class="token function-variable function">LinksFunction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">[</span><br>  <span class="token punctuation">{</span>rel<span class="token operator">:</span> <span class="token string">'stylesheet'</span><span class="token punctuation">,</span> href<span class="token operator">:</span> styles<span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token operator">:</span> <span class="token string">'style'</span><span class="token punctuation">}</span><br><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><p>Objects in the returned array can include a &quot;media&quot; property to specify a media query that must be satisfied to use the styles. For example, media: &quot;screen and (min-width: 768px)&quot;.</p><p>Remix only looks for &quot;links&quot; and &quot;meta&quot; functions in route components. So users of components (not pages) need to import and call those functions to get arrays and spread them into their own links array. This pattern is called &quot;surfacing links&quot; in the Remix docs.</p><p>For example, the file <code>app/routes/some-route.tsx</code> could contain the following:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> Heading<span class="token punctuation">,</span> <span class="token punctuation">{</span>links <span class="token keyword">as</span> headingLinks<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'~/components/Heading'</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">'~/styles/this-route.css'</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">links</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">[</span><br>  <span class="token punctuation">{</span>rel<span class="token operator">:</span> <span class="token string">'stylesheet'</span><span class="token punctuation">,</span> href<span class="token operator">:</span> styles<span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token operator">...</span><span class="token function">headingLinks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><h2 id="links" tabindex="-1">Links</h2><p>To create a link to another page, use the <code>Link</code> component. This must be imported from &quot;@remix-run/react&quot;.</p><p>The <code>Link</code> <code>to</code> prop supports absolute and relative paths. Absolute paths begin with a slash. Relative paths do not and are appended to the current URL.</p><p>To include a link that refreshes the current page, use <code>&lt;Link to=&quot;.&quot;&gt;Refresh&lt;/Link&gt;</code>.</p><h2 id="loaders" tabindex="-1">Loaders</h2><p>Any route can export a <code>loader</code> function that is optionally async. These functions process GET requests to routes and are used to fetch data needed by pages before they are rendered.</p><p>These functions only exist and run on the server, never in the browser. They enable implementing both client and server functionality for a route in the same source file. Because these functions run on the server, they never have CORS issues.</p><p>The code in <code>loader</code> functions can communicate directly with a database.</p><p>For example:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">type</span> <span class="token class-name">LoaderData</span> <span class="token operator">=</span> Todo<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token punctuation">{</span>params<span class="token punctuation">,</span> request<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// We could authenticate with something like</span><br>  <span class="token comment">// await requireUserId(request);</span><br>  <span class="token comment">// which could throw if the user is not authenticated.</span><br><br>  <span class="token comment">// We could support a query parameter like this:</span><br>  <span class="token comment">// const query = new URL(request.url).searchParams.get('query') ?? '';</span><br>  <span class="token comment">// const todos = await searchTodos(query);</span><br>  <span class="token comment">// return json(todos);</span><br>  <span class="token comment">// We can also return other content types including plain text.</span><br><br>  <span class="token keyword">return</span> <span class="token function">getTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// TODO: Why doesn't this also work?</span><br>  <span class="token comment">// return json(getTodos())</span><br><span class="token punctuation">}</span></code></pre><p>To access the data in the page component, use the <code>useLoaderData</code> hook. For example:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> todos <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useLoaderData</span><span class="token generic class-name"><span class="token operator">&lt;</span>Todo<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>In nested routes, the <code>loader</code> function for that route and the <code>loader</code> functions of all ancestor routes are called.</p><h2 id="actions" tabindex="-1">Actions</h2><p>Any route can export an <code>action</code> function that is optionally <code>async</code>. These are invoked when a <code>form</code> on the page is submitted. Like <code>loader</code> functions, these functions only exist and run on the server, never in the browser. They enable implementing both client and server functionality for a route in the same source file.</p><p><code>action</code> functions process POST requests to the route. HTML <code>form</code> elements only support two methods, <code>GET</code> and <code>POST</code>. Often <code>action</code> functions are used to process requests that would have used <code>PUT</code> or <code>DELETE</code> if those were supported by HTML forms. As a workaround, an property named &quot;intent&quot; can be used to signal to the <code>action</code> function whether it should perform a create, update, or delete operation.</p><p>For example:</p><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">{</span>redirect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@remix-run/node'</span><span class="token punctuation">;</span><br><br><span class="token comment">// Note how the front and back end are implemented in the same file.</span><br><span class="token keyword">export</span> <span class="token keyword">const</span> action<span class="token operator">:</span> <span class="token function-variable function">ActionFunction</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>request<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">try</span> <span class="token punctuation">{</span><br>    <span class="token comment">// No need to use the Fetch API or axios because</span><br>    <span class="token comment">// we are already running in the server.</span><br>    <span class="token keyword">let</span> todos <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">await</span> request<span class="token punctuation">.</span><span class="token function">formData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// This gets an object whose key/value pairs</span><br>    <span class="token comment">// represent all the data passed in the request.</span><br>    <span class="token keyword">const</span> data <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">fromEntries</span><span class="token punctuation">(</span>formData<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// This gets the value of a specific piece of data passed in the request.</span><br>    <span class="token keyword">const</span> intent <span class="token operator">=</span> formData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'intent'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>intent <span class="token operator">===</span> <span class="token string">'add'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// to demonstrate "isSubmitting" state</span><br>      <span class="token keyword">const</span> id <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">const</span> todo <span class="token operator">=</span> <span class="token punctuation">{</span>id<span class="token punctuation">,</span> text<span class="token operator">:</span> formData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>      todos<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">await</span> <span class="token function">saveTodos</span><span class="token punctuation">(</span>todos<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>intent<span class="token operator">?.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'delete-'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>intent<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">const</span> index <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token operator">:</span> Todo<span class="token punctuation">)</span> <span class="token operator">=></span> t<span class="token punctuation">.</span>id <span class="token operator">===</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>message<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">No todo with id </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> found.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>status<span class="token operator">:</span> <span class="token number">404</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>      todos<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">await</span> <span class="token function">saveTodos</span><span class="token punctuation">(</span>todos<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// stays on current page</span><br>    <span class="token comment">// return redirect(path); // redirects to another page</span><br>    <span class="token comment">// In the case of a POST request, this could redirect</span><br>    <span class="token comment">// to a page that displays the newly created resource.</span><br>    <span class="token comment">// For example, return redirect(`/todo/${todo.id}`);</span><br>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'todos.tsx action:'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>In nested routes, only the <code>action</code> function for that route is called. The <code>action</code> functions ancestor routes are not called.</p><p>A route component can contain multiple <code>form</code> elements. When any of them are submitted, the same <code>action</code> function is called. One way to determine which <code>form</code> submit triggered a call to <code>action</code> is to have the submit buttons in each <code>form</code> all have <code>name=&quot;intent&quot;</code> and different values for their <code>value</code> attribute.</p><h2 id="prefetching" tabindex="-1">Prefetching</h2><p>The <code>Link</code> and <code>NavLink</code> components can be configured to prefetch all data they need when the user hovers over them. This makes rendering the associated routes faster. To this, add the prop <code>prefetch=&quot;intent&quot;</code>.</p><h2 id="spinners" tabindex="-1">Spinners</h2><p>Remix automatically displays a spinner in the browser tab when it is waiting for a <code>loader</code> or <code>action</code> function to complete.</p><p>For spinners on the page, see <a href="https://github.com/smeijer/spin-delay?v=1.1.1" rel="noopener" target="_blank">spin-delay</a>.</p><h2 id="input-validation" tabindex="-1">Input Validation</h2><p>Remix favors validating input after a submit button is pressed. The <code>action</code> function can call custom functions to validate each input. It constructs an object containing a <code>fieldErrors</code> property whose value is an object containing an error message for each invalid input. The React component that renders the form can then display an error message below each invalid input. The following code demonstrates this approach.</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span><span class="token keyword">type</span> <span class="token class-name">ActionFunction</span><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@remix-run/node'</span><span class="token punctuation">;</span><br><br><span class="token keyword">type</span> <span class="token class-name">ActionData</span> <span class="token operator">=</span> <span class="token punctuation">{</span><br>  fields<span class="token operator">:</span> <span class="token punctuation">{</span>text<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// values entered for each field</span><br>  fieldErrors<span class="token operator">:</span> <span class="token punctuation">{</span>text<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// error messages for each field</span><br>  formError<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// describes error at form level, not individual input</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token comment">// Define one function like this for each input to be validated.</span><br><span class="token keyword">function</span> <span class="token function">validateText</span><span class="token punctuation">(</span>text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>text<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token string">'Todo text must be at least three characters.'</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> action<span class="token operator">:</span> ActionFunction <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><br>  request<br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Response <span class="token operator">|</span> ActionData<span class="token operator">></span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> fieldErrors <span class="token operator">=</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Add a line like this for each form input.</span><br>    text<span class="token operator">:</span> <span class="token function">validateText</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// This determines if there are one or more validation errors.</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>fieldErrors<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span>Boolean<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token punctuation">{</span>fieldErrors<span class="token punctuation">,</span> fields<span class="token operator">:</span> <span class="token punctuation">{</span>text<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">// If we reach here then there were no validation errors.</span><br>  <span class="token keyword">const</span> id <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> todo <span class="token operator">=</span> <span class="token punctuation">{</span>id<span class="token punctuation">,</span> text<span class="token punctuation">}</span><span class="token punctuation">;</span><br>  todos<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">await</span> <span class="token function">saveTodos</span><span class="token punctuation">(</span>todos<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// stays on current page</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Todos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> setText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> actionData <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useActionData</span><span class="token generic class-name"><span class="token operator">&lt;</span>ActionData<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> fieldErrors <span class="token operator">=</span> actionData<span class="token operator">?.</span>fieldErrors<span class="token punctuation">;</span><br><br>  <span class="token keyword">return</span> <span class="token punctuation">(</span><br>    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"todos"</span><span class="token operator">></span><br>      <span class="token punctuation">{</span><span class="token comment">/* Using Form instead of form prevents full-page reloads. */</span><span class="token punctuation">}</span><br>      <span class="token operator">&lt;</span>Form method<span class="token operator">=</span><span class="token string">"post"</span> id<span class="token operator">=</span><span class="token string">"todo-form"</span><span class="token operator">></span><br>        <span class="token operator">&lt;</span>input<br>          name<span class="token operator">=</span><span class="token string">"text"</span><br>          onChange<span class="token operator">=</span><span class="token punctuation">{</span>e <span class="token operator">=></span> <span class="token function">setText</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span><br>          placeholder<span class="token operator">=</span><span class="token string">"enter new todo here"</span><br>          value<span class="token operator">=</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span><br>        <span class="token operator">/</span><span class="token operator">></span><br>        <span class="token punctuation">{</span>fieldErrors<span class="token operator">?.</span>text <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><br>          <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"error"</span><span class="token operator">></span>Error<span class="token operator">:</span> <span class="token punctuation">{</span>fieldErrors<span class="token punctuation">.</span>text<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br>        <span class="token punctuation">)</span><span class="token punctuation">}</span><br><br>        <span class="token punctuation">{</span><span class="token comment">/* There can be more form inputs here. */</span><span class="token punctuation">}</span><br><br>        <span class="token operator">&lt;</span>button<span class="token operator">></span>Add<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><br>      <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token operator">></span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h2 id="schema-validation" tabindex="-1">Schema Validation</h2><p>Consider using <a href="https://zod.dev?v=1.1.1" rel="noopener" target="_blank">zod</a> for schema validation.</p><h2 id="client-only-code" tabindex="-1">Client Only Code</h2><p>To prevent code from running on the server and only run it on the client-side, surround the code with a check like the following:</p><pre class="language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// Do client-only things here.</span><br><span class="token punctuation">}</span></code></pre><p>For code inside a React component that should only run on the client-side, place it in a call to <code>useEffect</code> as follows:</p><pre class="language-js"><code class="language-js"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token comment">// Do client-only things here.</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="error-boundaries" tabindex="-1">Error Boundaries</h2><p>Each route and <code>root.tsx</code> can befine an <code>ErrorBoundary</code> function which returns JSX to be rendered if an unexpected error occurs. This replaces the content that would otherwise be rendered by<outlet>.</p><p>In the case of nested routes, the closes such function to where the error occurs is used. The <code>ErrorBoundary</code> function in <code>root.tsx</code> serves as a catch-all.</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">ErrorBoundary</span><span class="token punctuation">(</span><span class="token punctuation">{</span>error<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'root.tsx ErrorBoundary: error ='</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token punctuation">(</span><br>    <span class="token operator">&lt;</span>main className<span class="token operator">=</span><span class="token string">"error"</span><span class="token operator">></span><br>      <span class="token operator">&lt;</span>h1<span class="token operator">></span>An error occurred<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><br>      <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">{</span>error<span class="token operator">?.</span>message <span class="token operator">??</span> <span class="token string">'unknown'</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><br>      <span class="token operator">&lt;</span>p<span class="token operator">></span><br>        Back to <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">"/"</span><span class="token operator">></span>safety<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">></span><span class="token punctuation">.</span><br>      <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>main<span class="token operator">></span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h2 id="catch-boundaries" tabindex="-1">Catch Boundaries</h2><p>A <code>CatchBoundary</code> function is similar to an <code>ErrorBoundary</code>, but is focused on expected rather than unexpected errors. Like that we can define it in the root component or specific routes. Remix renders this component when a <code>Response</code> object is thrown. If anything other than an error is thrown then <code>ErrorBoundary</code> is used instead of <code>CatchBoundary</code>.</p><p>One place a <code>Response</code> object can be thrown is in a <code>loader</code> function. For example:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">if</span> <span class="token punctuation">(</span>some <span class="token operator">-</span> condition<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">throw</span> <span class="token function">json</span><span class="token punctuation">(</span><br>    <span class="token comment">// creates a Response object</span><br>    <span class="token punctuation">{</span>message<span class="token operator">:</span> <span class="token string">'some-message'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span>status<span class="token operator">:</span> <span class="token number">404</span><span class="token punctuation">,</span> statusText<span class="token operator">:</span> <span class="token string">'some-status-text'</span><span class="token punctuation">}</span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>The following code demonstrates defining a <code>CatchBoundary</code> function:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>useCatch<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@remix-run/react'</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">CatchBoundary</span><span class="token punctuation">(</span><span class="token punctuation">{</span>error<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token function">useCatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> message <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token operator">?.</span>message <span class="token operator">||</span> <span class="token string">'unspecified error'</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token punctuation">(</span><br>    <span class="token operator">&lt;</span>main<span class="token operator">></span><br>      <span class="token operator">&lt;</span>h1<span class="token operator">></span>An error occurred<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><br>      <span class="token operator">&lt;</span>p<span class="token operator">></span>status<span class="token operator">:</span> <span class="token punctuation">{</span>response<span class="token punctuation">.</span>status<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><br>      <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">{</span>message<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>main<span class="token operator">></span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>If the <code>CatchBoundary</code> function throws an error and an <code>ErrorBoundary</code> function is defined, it will determine what to render.</p><h2 id="building" tabindex="-1">Building</h2><p>To prepare a Remix app for deployment, enter <code>npm build</code>. The generated files for the server are placed in the <code>build</code> directory. The generated files for the client are placed in the <code>public/build</code> directory.</p></article>