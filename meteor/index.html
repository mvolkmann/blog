<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Meteor</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#key-benefits">Key Benefits</a></li><li><a href="#installing">Installing</a></li><li><a href="#creating-a-project">Creating a Project</a></li><li><a href="#directory-structure">Directory Structure</a></li><li><a href="#meteor-packages">Meteor Packages</a></li><li><a href="#mongodb">MongoDB</a></li><li><a href="#collections">Collections</a></li><li><a href="#local-collections">Local Collections</a></li><li><a href="#collection-schemas">Collection Schemas</a></li><li><a href="#meteor-methods">Meteor Methods</a></li><li><a href="#method-retries">Method Retries</a></li><li><a href="#optimistic-ui">Optimistic UI</a></li><li><a href="#viewing-websocket-messages">Viewing WebSocket Messages</a></li><li><a href="#meteor-websocket-messages">Meteor WebSocket Messages</a></li><li><a href="#tracker">Tracker</a></li><li><a href="#reactivevar">ReactiveVar</a></li><li><a href="#reactivedict">ReactiveDict</a></li><li><a href="#session">Session</a></li><li><a href="#email">Email</a></li><li><a href="#eslint">ESLint</a></li><li><a href="#prettier">Prettier</a></li><li><a href="#devtools">DevTools</a></li><li><a href="#tutorials">Tutorials</a></li><li><a href="#todo-app">Todo App</a></li><li><a href="#routing">Routing</a></li><li><a href="#meteor-shell">Meteor Shell</a></li><li><a href="#building-and-deploying">Building and Deploying</a><ol><li><a href="#mongodb-hosting">MongoDB Hosting</a></li><li><a href="#configuring-a-cloud-server">Configuring a Cloud Server</a></li><li><a href="#enabling-https">Enabling HTTPS</a></li><li><a href="#manual-deploy">Manual Deploy</a></li><li><a href="#meteor-up-(mup)">Meteor Up (mup)</a></li><li><a href="#galaxy">Galaxy</a></li></ol></li><li><a href="#creating-meteor-packages">Creating Meteor Packages</a></li><li><a href="#building-a-mobile-app">Building a Mobile App</a></li><li><a href="#resources">Resources</a></li></ol></nav></aside><article><h3 id="overview" tabindex="-1">Overview</h3><p>Meteor (<a href="https://meteor.com/?v=1.0.21" rel="noopener" target="_blank">meteor.com</a>) is an open-source, full-stack, JavaScript platform for building web and mobile (Android and iOS) applications. It is referred to as a platform instead of a framework because it works with other frameworks. It is used to host both client-side and server-side code.</p><p>Meteor is built on Node.js. It has great integration with the MongoDB NoSQL database. It also supports a publish and subscribe mechanism to synchronize user interfaces (UIs) with backend data, providing real-time updates.</p><p>Meteor uses its own build systems and JavaScript bundler. It does not use an external bundler such as Webpack, Rollup, or Parcel. This is partially because Meteor was created before those tools were created or became mature.</p><p>Meteor has its own frontend framework called Blaze. But it also supports other popular options that can be used in its place such as Angular, React, Svelte, Vue, and Cordova (for Android and iOS apps). (Cordova is an open source fork of PhoneGap which was created by Adobe. On August 10, 2020 Adobe announced they will no longer support development of PhoneGap. Development of Cordova continues under Apache.)</p><p>Meteor was initially released in 2012. It gained immediate attention for its novel use of WebSockets as an alternative to HTTP to achieve real-time updates. But the attention faded quickly as other frameworks garnered more notice. It is seeing some resurgence in 2020.</p><p>Tiny (<a href="https://www.tinycapital.com/?v=1.0.21" rel="noopener" target="_blank">tinycapital.com</a>), a Canadian technology holding company, acquired Meteor from the Meteor Development Group in October, 2019. This occurred after most of the Meteor Development Group team transitioned to working on Apollo GraphQL. The new Meteor company supports both Meteor and Galaxy. Galaxy is a commercial cloud hosting platform for Meteor applications.</p><p>Companies that use Meteor include Qualcomm, Mazda, IKEA, and Honeywell.</p><p>Enterprise support is available in order to have guaranteed support response times and service-level agreements (SLAs).</p><p>Meteor provides many command-line tools summarized <a href="https://docs.meteor.com/commandline.html?v=1.0.21" rel="noopener" target="_blank">here</a>. After installing Meteor, enter <code>meteor help</code> for help on using these.</p><h3 id="key-benefits" tabindex="-1">Key Benefits</h3><p>The key benefits of using Meteor are:</p><ul><li>One install provides client, server (Node.js), and database (MongoDB) setup.</li><li>Simple integration with MongoDB is provided out of the box.</li><li>Client and server code can be developed in a single language, JavaScript or TypeScript.</li><li>There is no need to implement REST services or GraphQL queries if using Meteor Methods with WebSockets is acceptable. Meteor Methods are much easier to implement and are described in detail later.</li><li>The UI can be implemented using any popular web framework.</li><li>Real-time UI updates across clients are easy to implement. Changes to data in MongoDB collections can be published to all connected clients using WebSockets so UIs can stay in sync. Clients subscribe to publications of interest.</li><li>User account management and authentication is provided, including OAuth logins.</li><li>Reactivity is provided through the use of the JavaScript classes <code>Tracker</code>, <code>ReactiveVar</code>, <code>ReactiveDict</code>, and <code>Session</code>.</li></ul><p>All of this enables implementing significant functionality in a small amount of code.</p><h3 id="installing" tabindex="-1">Installing</h3><p>For platform-specific instructions on installing Meteor, see <a href="https://www.meteor.com/install?v=1.0.21" rel="noopener" target="_blank">here</a>. On Linux or macOS, enter <code>curl https://install.meteor.com | sh</code>. On Windows, install Chocolatey and enter <code>choco install meteor</code>.</p><p>Install Meteor also installs several tools used by it including MongoDB and TypeScript. <a href="https://nodejs.org/?v=1.0.21" rel="noopener" target="_blank">Node.js</a> must be installed separately and that includes the npm tool.</p><p>Repeating the install command will update the existing installation.</p><h3 id="creating-a-project" tabindex="-1">Creating a Project</h3><p>To create the initial directory structure for a new Meteor project and run it, enter the following commands:</p><ul><li><code>meteor create {app-name}</code></li><li><code>cd {app-name}</code></li><li><code>meteor</code></li></ul><p>This is covered in more detail later in the &quot;Todo App&quot; section.</p><p>It is recommended to use the command <code>meteor npm</code> instead of <code>npm</code> when installing npm packages in a Meteor app. When packages have binary dependencies, this ensures that they are built using the same C libraries.</p><p>Meteor provides &quot;hot code pushes&quot; so the browser doesn't need to be manually refreshed and the server doesn't need to be manually restarted. After making changes to client code, the message &quot;Client modified -- refreshing&quot; will appear in the terminal window where the server is running. After making changes to server code, the message &quot;Meteor server restarted&quot; will appear in the same place.</p><h3 id="directory-structure" tabindex="-1">Directory Structure</h3><p>The recommended directory structure for Meteor applications and the initial set of files inside them is:</p><ul><li><p><code>client</code><br>This holds files that are only used in the browser.</p><ul><li><code>main.html</code></li><li><code>main.css</code></li><li><code>main.js</code></li></ul></li><li><p><code>server</code><br>This holds files that are only used in the server.</p><ul><li><code>main.js</code></li></ul></li><li><p><code>imports</code><br>This holds files that are used in both the browser and server.</p><ul><li><code>*.js</code></li></ul></li><li><p><code>public</code><br>This holds static assets such as images and fonts. When referencing these files, do so as if they were at the top level, not including <code>public/</code>.</p></li><li><p><code>private</code><br>This holds files that are only accessible from server code using the Assets API.</p></li><li><p><code>.meteor</code><br>This holds files that Meteor uses for bookkeeping. These files should not be manually modified.</p></li></ul><p>Additional files can be added to all the directories listed above except <code>.meteor</code>.</p><p>In the past Meteor eagerly loaded files outside the <code>imports</code> directory and lazily loaded files inside the <code>imports</code> directory. As of Meteor 1.7 it no longer makes this distinction and all code is lazily loaded. So there is no longer a requirement to have an <code>imports</code> directory. However, it is still a useful location for files that are shared between client and server code.</p><h3 id="meteor-packages" tabindex="-1">Meteor Packages</h3><p>Meteor projects can use packages from npm and from its own package repository called &quot;Atmosphere&quot;. Atmosphere contains packages that are specific to Meteor. These are referred to as &quot;Isopacks&quot; because they are typically isomorphic, meaning that the code can run on the client or server.</p><p>To see the available packages in Atmosphere, browse <a href="https://atmospherejs.com/?v=1.0.21" rel="noopener" target="_blank">atmosphere.com</a>. Packages without an author prefix followed by a colon are official Meteor packages. This page lists packages that are trending, recently added/updated, and most frequently used.</p><p>To install a package from Atmosphere in your current Meteor project, enter <code>meteor add {package-name}</code>. This writes information about the installed package to <code>.meteor/packages</code> in order to track dependencies, similar to how npm uses the <code>package-lock.json</code> file. It also installs packages on which this one depends. If the app is running, Meteor performs a &quot;hot code push&quot; of the CSS and JS files in the package so the effect is seen immediately, unlike installing npm packages.</p><p>After adding packages to a project, to update to the latest version of each, enter <code>meteor update</code>. This also updates to the latest version of Meteor. To only update packages and not Meteor, enter <code>meteor update --packages-only</code>. The version of each package being used can be found in the file <code>.meteor/versions</code>.</p><p>To import functions, classes, and other values from a Meteor package, use an import with the following syntax:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>name1<span class="token punctuation">,</span> name2<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/{package-prefix}:{package-name}'</span><span class="token punctuation">;</span></code></pre><p>There are five types of packages:</p><ol><li><code>meteor-base</code><br>This is a specific package that contains core components.</li><li>first-party (core) packages<br>These are bundled with Meteor. Some are included by default, but can be removed. Others are not, but can be added. Their names do not have an author prefix.</li><li>local-packages<br>These are specific to your app and reside in the <code>packages</code> directory.</li><li>Atmosphere (community) packages<br>Many of these follow the <code>author:package</code> naming convention and all that are in use are listed in the file <code>.meteor/packages</code>.</li><li>npm packages<br>These are listed as dependencies in the file <code>package.json</code>.</li></ol><p>New Meteor apps typically include three core packages by default which are meteor-platform, autopublish, and insecure. The meteor-platform package has many dependencies that are also installed including blaze, check, ddp, jquery, mongo, session, tracker, and underscore.</p><p>Popular Atmosphere packages include:</p><ul><li>accounts-password - &quot;login service that enables secure password-based login&quot;</li><li>accounts-ui - &quot;turn-key user interface for Meteor Accounts&quot; using Blaze</li><li>meteor-base - &quot;default set of packages that almost every app will have&quot;</li><li>mongo - &quot;adaptor for using MongoDB and Minimongo over DDP&quot;</li><li>rdb:svelte-meteor-data - &quot;reactively track Meteor data inside Svelte components&quot;</li><li>react-meteor-data - &quot;React hook for reactively tracking Meteor data&quot;</li><li>static-html - &quot;define static page content in <code>.html</code> files&quot;; alternative to Blaze</li><li>svelte:compiler - compiles <code>.svelte</code> files to JavaScript</li><li>svelte:blaze-integration - &quot;render Blaze templates inside your Svelte components and vice versa&quot;; useful when using the account-ui package in a Svelte app</li><li>tracker - &quot;dependency tracker to allow reactive callbacks&quot;</li><li>typescript - &quot;compiler plugin that compiles TypeScript and ECMAScript in <code>.ts</code> and <code>.tsx</code> files&quot;</li></ul><h3 id="mongodb" tabindex="-1">MongoDB</h3><p>MongoDB is a popular NoSQL database. There are many commands and options to master, but the following presents some of the basics for using the MongoDB console in conjunction with Meteor.</p><p>To start the MongoDB console, enter <code>meteor mongo</code>.</p><p>To see a list of all the databases, enter <code>show dbs</code>.</p><p>Meteor uses the database named &quot;meteor&quot;. To interact with this database, enter <code>use meteor</code>.</p><p>To see a list of collections in the current database, enter <code>show collections</code>.</p><p>To see the first 20 documents in a given collection, enter <code>db.{coll-name}.find()</code>.</p><p>To delete all the documents in a collection, enter <code>db.{coll-name}.drop()</code>.</p><p>To reset the &quot;meteor&quot; MongoDB database, deleting all documents in all collections, stop the Meteor server and enter <code>meteor reset</code>. This can be useful to start an app in a pristine state.</p><p>Multiple Meteor apps can use the same MongoDB database to share data. Search for &quot;Multiple apps use the same database&quot; in the <a href="http://meteor-up.com/docs.html?v=1.0.21" rel="noopener" target="_blank">Meteor Up</a> docs.</p><h3 id="collections" tabindex="-1">Collections</h3><p>The client-side of Meteor applications can obtain data in many ways including REST calls and GraphQL queries that connect to any kind of database. The data can be stored in clients in many ways including JavaScript variables, session storage, and local storage.</p><p>The most common way for a Meteor application to store data is in &quot;collections&quot;. These are typically associated with a MongoDB collection. They can be accessed from both client and server code. When data is added to a collection, updated, or deleted, client code that uses it typically updates automatically. This provides a significant benefit over using REST services that require the use of polling to get data updates.</p><p>The following code demonstrates creating a MongoDB collection named &quot;tasks&quot;, inserting a document into the collection, and finding it. By convention, variable names that refer to collections have CamelCase names that start uppercase. MongoDB stores the unique id of each document in property named <code>_id</code>. If no value is provided, MongoDB will generate a unique value.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> Tasks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mongo<span class="token punctuation">.</span>Collection</span><span class="token punctuation">(</span><span class="token string">'tasks'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> id <span class="token operator">=</span> Tasks<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'buy milk'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns assigned id</span><br><span class="token keyword">const</span> task <span class="token operator">=</span> Tasks<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">_id</span><span class="token operator">:</span> id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The same code can be used in client or server code when the Meteor &quot;insecure&quot; package is installed. The starter app includes this. Later we will look at securing Meteor applications by removing this package.</p><p>If the code above is run in the server, it creates a MongoDB collection (if it doesn't already exist) and populates it. If the code above is run in the client, it creates a client-side cache using the &quot;Minimonogo&quot; library which provides an in-memory JavaScript implementation of the MongoDB API.</p><p>Minimongo in the client is automatically kept in sync with MongoDB in the server when the &quot;autopublish&quot; package is installed. The starter app includes this. Later we will look at removing this.</p><p>When &quot;autopublish&quot; is not installed, the server must publish documents from collections and the client must subscribe documents of interest. This keeps the client-side cache (implemented by Minimongo) in sync with a subset of the data in MongoDB on the server. The underlying mechanism that supports this is the Meteor Distributed Data Protocol (DDP) which sends WebSocket messages in both directions.</p><h3 id="local-collections" tabindex="-1">Local Collections</h3><p>It is also possible to create a &quot;local collection&quot; that only exists on the client or on the server. These are Minimongo collections that are not synchronized with a MongoDB collection. They are useful for data that only resides in memory in cases where using the MongoDB API to access it is convenient. An alternative is to use a <code>ReactiveVar</code>, <code>ReactiveDict</code>, or the <code>Session</code> object, all of which are described later.</p><p>To create a local collection:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> myCollection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mongo<span class="token punctuation">.</span>Collection</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>or</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> myCollection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mongo<span class="token punctuation">.</span>Collection</span><span class="token punctuation">(</span><span class="token string">'some-name'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">connection</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>To support associations between documents in different collections, see the Meteor package <a href="https://atmospherejs.com/cultofcoders/grapher?v=1.0.21" rel="noopener" target="_blank">cultofcoders:grapher</a>.</p><h3 id="collection-schemas" tabindex="-1">Collection Schemas</h3><p>A schema can be associated with a collection in order to provide validation when documents are added or updated. Schemas can be described using the npm package <a href="https://github.com/aldeed/simpl-schema?v=1.0.21" rel="noopener" target="_blank">simpl-schema</a>, which is installed by entering <code>npm install simpl-schema</code>.</p><p>The type of each property can be specified with either a shorthand or longhand definition. Shorthand definitions only specify a type. Longhand definitions can also specify that a property is optional, a default value, a max length, a regular expression (<code>regEx</code>) to be matched, and more. Both kinds of definitions can be used in the same schema, one per property.</p><p>For example, a <code>tasks</code> collection can be associated with a schema as follows:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> SimpleSchema <span class="token keyword">from</span> <span class="token string">'simpl-schema'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> Tasks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mongo<span class="token punctuation">.</span>Collection</span><span class="token punctuation">(</span><span class="token string">'tasks'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>Tasks<span class="token punctuation">.</span>schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleSchema</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token literal-property property">createdAt</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> Date<span class="token punctuation">,</span> <span class="token literal-property property">defaultValue</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">optional</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> Boolean<span class="token punctuation">,</span> <span class="token literal-property property">defaultValue</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">optional</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">owner</span><span class="token operator">:</span> String<span class="token punctuation">,</span><br>  <span class="token literal-property property">text</span><span class="token operator">:</span> String<span class="token punctuation">,</span><br>  <span class="token literal-property property">username</span><span class="token operator">:</span> String<br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Note that specifying a <code>defaultValue</code> for a property does not imply that it is <code>optional</code>. That must also be specified.</p><p>Here is another example where a property (<code>topics</code>) is an array of objects:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> SimpleSchema <span class="token keyword">from</span> <span class="token string">'simpl-schema'</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> Meetings <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mongo<span class="token punctuation">.</span>Collection</span><span class="token punctuation">(</span><span class="token string">'meetings'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> topicSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleSchema</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token literal-property property">defaultValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">presenter</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token literal-property property">defaultValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">minutes</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> Number<span class="token punctuation">,</span> <span class="token literal-property property">defaultValue</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>Meetings<span class="token punctuation">.</span>schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleSchema</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token literal-property property">defaultValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">date</span><span class="token operator">:</span> String<span class="token punctuation">,</span><br>  <span class="token literal-property property">time</span><span class="token operator">:</span> String<span class="token punctuation">,</span><br>  <span class="token literal-property property">duration</span><span class="token operator">:</span> SimpleSchema<span class="token punctuation">.</span>Integer<span class="token punctuation">,</span><br>  <span class="token literal-property property">topics</span><span class="token operator">:</span> <span class="token punctuation">[</span>topicSchema<span class="token punctuation">]</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Schema validation is not performed automatically. It is done by explicitly passing an object to the <code>validate</code> method. For example, if <code>Tasks.schema.validate(newTask)</code> is called and the object referred to by <code>newTask</code> does not match the schema, a <code>ValidationError</code> which describes the difference is thrown. Extra properties in the object that are not specified in the schema are not allowed.</p><p>The <code>aldeed:collection2</code> Meteor package can be used to automatically validate every insert, update, and upsert performed on a given collection. In addition it coerces values to the expected types when possible, removes properties not in the schema, and assigns default values specified with the <code>defaultValue</code> property. To install this package, enter <code>meteor add aldeed:collection2</code>. To use this on our <code>Tasks</code> and <code>Meetings</code> collections:</p><pre class="language-js"><code class="language-js">Tasks<span class="token punctuation">.</span><span class="token function">attachSchema</span><span class="token punctuation">(</span>Tasks<span class="token punctuation">.</span>schema<span class="token punctuation">)</span><span class="token punctuation">;</span><br>Meetings<span class="token punctuation">.</span><span class="token function">attachSchema</span><span class="token punctuation">(</span>Meetings<span class="token punctuation">.</span>schema<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>For more detail on schema definitions, see <a href="https://github.com/aldeed/simpl-schema?v=1.0.21" rel="noopener" target="_blank">simpl-schema</a>.</p><p>Creating collections whose documents can be deeply nested or can contain large arrays is not recommended. This is because DDP, which is used to send messages to clients that describe new and updated documents, is only able to describe top-level properties and their values. For example, if a document contains a property whose value is a large array and a single element is modified, DDP will send the entire array to clients. This works fine, but is inefficient.</p><h3 id="meteor-methods" tabindex="-1">Meteor Methods</h3><p>Meteor Methods are functions that can reside only on the server or on both the client and server. They are meant to be called from client code. The server instance is invoked using a Remote Procedure Call (RPC) that utilizes WebSockets. By convention, &quot;Method&quot; is written with a capital &quot;M&quot; to distinguish it from normal JavaScript methods.</p><p>Meteor Methods are an alternative to REST calls implemented using HTTP. An issue with using Meteor Methods instead of REST is that they can only be called from the same Meteor app. In many cases the Methods are specific to the app and this is a non-issue.</p><p>Common uses for Methods include inserting a document into a collection, deleting a document from a collection, and updating a document in a collection. There is typically no need to return anything to the client because changes in the MongoDB database are communicated back to the client through WebSocket messages that keep Minimongo in the client synchronized. Retrieving documents from collections is typically done by subscribing to them rather than through methods calls, but Methods can also be used for this purpose.</p><p>Methods can also be used to perform CRUD operations on SQL databases. In this case it makes sense for the methods to only reside on the server and for them to return data needed by the client.</p><p>To implement Methods, import <code>Meteor</code> from the <code>meteor/meteor</code> package and pass an object literal to <code>Meteor.methods</code>. The properties of the object are Method definitions. This registers the Methods with Meteor's DDP system. The <code>Meteor.methods</code> function can be called any number of times to register additional Methods.</p><p>Methods can accept any number of parameters with any JavaScript types.</p><p>The <code>check</code> function in the <code>meteor/check</code> package can be used to check the types of parameters at runtime. Note that TypeScript types are only checked at compile-time. The <code>check</code> function throws a <code>Match.Error</code> error if unexpected types are passed. For details on the <code>check</code> function, see <a href="https://docs.meteor.com/api/check.html?v=1.0.21" rel="noopener" target="_blank">here</a>.</p><p>To report other kinds of parameter validation errors that are based on values rather than types, use <code>throw new ValidationError(message)</code>.</p><p>To report most other errors, use <code>throw new Meteor.Error(errorId, message[, details])</code>. The error id is typically the Method name followed by a period and an error name. If a generic JavaScript error is thrown instead using <code>throw new Error(message)</code>, the details will only appear on the server and clients will only be notified that an internal server error occurred.</p><p>To call a Method from client code, import <code>Meteor</code> from the <code>meteor/meteor</code> package and call <code>Meteor.call</code>, passing it the name of a Method, any number of arguments, and a callback function. This triggers the Method call lifecycle which has six parts.</p><ol><li>If the Method is defined in the client, it is executed there. This typically updates Minimongo and corresponding UI updates are made in response to these changes.</li><li>A JSON-based DDP message is constructed and sent to the server using a WebSocket connection. This includes a message name (<code>msg</code> property set to &quot;method&quot;), Method name (in the <code>method</code> property), arguments (in the <code>params</code> property), and a generated Method id (in the <code>id</code> property).</li><li>The Method executes on the server, possibly updating MongoDB.</li><li>A return value is sent to the client in a message that includes a message name (<code>msg</code> property set to &quot;result&quot;), the previously generated Method id (in the <code>id</code> property), and the result (in the <code>result</code> property).</li><li>DDP messages that describe changes made in MongoDB in the server are received in the client and used to make corresponding changes in Minimongo, but the UI is not yet updated.</li><li>The callback function passed to <code>Meteor.call</code> is invoked, passing it an error description (if there was an error) and the result value. Now the UI is updated using data from Minimongo.</li></ol><p>If the call succeeds, the error description is <code>undefined</code> and the result is set to whatever value the Method returns. If the call fails, the error description is set to an object that contains the properties <code>error</code> (an HTTP status code even though HTTP isn't used), <code>reason</code> (concise message), <code>message</code> (long message), and more. It does not throw a JavaScript <code>Error</code>, so try/catch cannot be used.</p><p>If a Method inserts new documents in a collection, Meteor uses the same random generator seed on the client and server in order to guarantee that documents created by client calls are assigned the same <code>_id</code> values as documents created by server calls.</p><p>When multiple Methods are called without waiting for the result of each before calling the next, Meteor guarantees that they will execute in the order in which they are called and that the results will be processed in the same order. In some cases you may wish to allow multiple methods to execute concurrently. Call <code>this.unblock()</code> in a Method implementation to allow another Method to begin executing before that one finishes.</p><p>While it is not commonly needed, Meteor supports Method implementations that call other Methods.</p><p>Let's implement a simple Method that just adds two numbers. It is not a typical Method because it does not update a collection. We will see several examples of Methods that update a collection later. To verify that the Method is called on both the client and server side, a <code>console.log</code> call is added. It will be output in the DevTools console AND in the terminal window where the server is running.</p><p>Create the directory <code>imports</code> and the file <code>imports/methods.js</code> containing the following:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>check<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/check'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>Meteor<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/meteor'</span><span class="token punctuation">;</span><br><br>Meteor<span class="token punctuation">.</span><span class="token function">methods</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">n1<span class="token punctuation">,</span> n2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'sum called; on server?'</span><span class="token punctuation">,</span> Meteor<span class="token punctuation">.</span>isServer<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">check</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> Number<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// parameter type validation</span><br>    <span class="token function">check</span><span class="token punctuation">(</span>n2<span class="token punctuation">,</span> Number<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// parameter type validation</span><br>    <span class="token keyword">return</span> n1 <span class="token operator">+</span> n2<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Add the following near the top of <code>client/main.js</code> and <code>server/main.js</code> to invoke the code above in the client and server:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">'../imports/methods.js'</span><span class="token punctuation">;</span></code></pre><p>Add the following in <code>client/main.js</code> to call the <code>sum</code> Method:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> number1 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> number2 <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><br><span class="token function">Meteor</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'sum'</span><span class="token punctuation">,</span> number1<span class="token punctuation">,</span> number2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">alert</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'sum ='</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>In this case there is no benefit to invoking the method on both the client and server because it doesn't rely on any server resources. Later in the &quot;Optimistic UI&quot; section we will learn why this can be useful.</p><p>If you prefer to use promises instead of callback functions, implement a utility function that wraps calls in a <code>Promise</code> as follows:</p><pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token function">Meteor</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>        <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>An advantage of calling Methods in this way is that the result of one call can be used to form the arguments of another call without resorting to nested callback functions.</p><p>Using this new <code>call</code> function, our <code>sum</code> Method can be called from an <code>async</code> function as follows:</p><pre class="language-js"><code class="language-js"><span class="token keyword">try</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> sum <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'App.svelte addTask: sum ='</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>If a Method returns a <code>Promise</code>, Meteor will wait for the <code>Promise</code> to resolve or reject before returning a result or an error to the client.</p><p>Two alternate ways to define Methods are <a href="https://guide.meteor.com/methods.html#advanced-boilerplate?v=1.0.21" rel="noopener" target="_blank">Advanced Method boilerplate</a> and <a href="https://guide.meteor.com/methods.html#validated-method?v=1.0.21" rel="noopener" target="_blank">mdg:validated-method</a>. These provide additional features, but may be overkill for most Methods.</p><p>Typically client code only invokes methods that are registered in the server of the same Meteor application. However, it is also possible to invoke methods defined in the server of a different Meteor application. To do this:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span><span class="token constant">DDP</span><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/ddp-client'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token constant">DDP</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>serverUrl<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">connection</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>methodName<span class="token punctuation">,</span> arguments<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>For more details, see <a href="https://docs.meteor.com/api/connections.html#DDP-connect">https://docs.meteor.com/api/connections.html#DDP-connect</a>.</p><h3 id="method-retries" tabindex="-1">Method Retries</h3><p>If a client calls a Method and their internet connection is lost before a result is returned, Meteor will remember this and will make the call again when connectivity is restored. This presents an issue when Methods are not idempotent. In this context, being idempotent means that when a call is repeated no additional changes are made in the database.</p><p>Consider typical CRUD operations.</p><ul><li><p>Creating a new document in a collection using the same data multiple times is typically problematic and it's up to you to guard against this. For example, in a Todo app we could reject attempts to add multiple tasks with the same text.</p></li><li><p>Retrieving a document from a collection multiple times is not a problem.</p></li><li><p>Updating a document multiple times is not a problem as long as the document hasn't been modified using different data in the interim. This can be addressed by adding the last update timestamp to each document and verifying that it matches what is in the data for an update. When the timestamp does not match, we can assume the document has been updated since we last retrieved it and reject the update.</p></li><li><p>Deleting a document multiple times is not a problem as long as an attempt to delete a non-existent document is not treated as an error.</p></li></ul><h3 id="optimistic-ui" tabindex="-1">Optimistic UI</h3><p>Optimistic UI is a feature of Meteor Methods, and also of Apollo GraphQL, that enables a UI to respond to user interactions without waiting for server responses. This is satisfied by the following properties.</p><ol><li><p>The UI is rendered on the client rather than waiting for the server to return HTML or data. This requires predicting the result of Method calls based on data that has been cached on the client.</p></li><li><p>The client-side cache (stored in Minimongo) is a global cache rather than being associated with specific components, so it is not possible for components to disagree on the state. All affected components can re-render using the same data. When a MongoDB query is executed using a Meteor Method, it is first run against Minimongo on the client and then against MongoDB on the server.</p></li><li><p>The client subscribes to data using DDP to keep Minimongo on the client in sync with MongoDB on the server. Updates are made in real time, not using polling.</p></li><li><p>When the server returns the actual results of a Method call, Meteor verifies that it matches what the client predicted. If they differ, Meteor rolls back all the changes made in Minimongo from that point forward and applies the correct changes from the server. The UI can then update using the new data in Minimongo.</p></li></ol><p>All of this functionality is provided by default. The only requirement is for the client to use Meteor Methods to request data changes.</p><p>The following sequence diagram illustrates the order of these operations. It assumes that Svelte is being used to implement the UI and that data retrieved from Minimongo is placed in a Svelte store.</p><p><img src="/blog/assets/meteor-method-flow.png" alt="Meteor Method flow"></p><p>If the Method throws an error when run on the client, it is not called on the server.</p><p>To see rollback in action, we can modify a Meteor Method to return a different result when run on the client versus the server. This is not typical, but it is useful to demonstrate optimistic UI.</p><p>Here is a simplified example from the upcoming Todo app. It inserts a document in the &quot;tasks&quot; collection. When run on the client it updates Minimongo using the text passed as an argument. When run on the server it uses a timeout to wait three seconds and then uses the uppercase version of the text. The Method first runs on the client and the UI renders a new task with the entered text. The Method then runs on the server. After the timeout it sends a message to the client that tells it to update Minimongo using the uppercase version of the text. The UI then updates to show the uppercase text.</p><pre class="language-js"><code class="language-js">Meteor<span class="token punctuation">.</span><span class="token function">methods</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token function">addTask</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">check</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>Meteor<span class="token punctuation">.</span>isServer<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">// Meteor requires using this version of setTimeout.</span><br>        <span class="token comment">// See https://docs.meteor.com/api/timers.html.</span><br>        Meteor<span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>          <span class="token comment">// Tasks is a collection.</span><br>          <span class="token keyword">const</span> id <span class="token operator">=</span> Tasks<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">text</span><span class="token operator">:</span> text<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token function">resolve</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>        <span class="token comment">// in client</span><br>        <span class="token keyword">const</span> id <span class="token operator">=</span> Tasks<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token function">resolve</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>It is possible to define a Method only on the server-side, thereby opting out of optimistic UI. The UI will not update until the Method finishes executing on the server and sends back a result message. This is because Minimongo will not be updated until the result message is received.</p><p>Here is an example of defining a Method on the server taken from the upcoming Todo app. It deletes a task with a given id.</p><pre class="language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>Meteor<span class="token punctuation">.</span>isServer<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  Meteor<span class="token punctuation">.</span><span class="token function">methods</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    <span class="token function">deleteTask</span><span class="token punctuation">(</span><span class="token parameter">taskId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token function">check</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      Tasks<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h3 id="viewing-websocket-messages" tabindex="-1">Viewing WebSocket Messages</h3><p>Chrome DevTools can be used to view the WebSocket messages that are sent by Meteor. Like HTTP messages, they appear on the Network tab. But unlike HTTP messages where there is a separate entry for each request/response pair, there is only a single WebSocket entry per connection. Selecting a connection displays all the messages sent over that connection.</p><p>To view WebSocket messages:</p><ol><li>Open the Chrome DevTools.</li><li>Select the &quot;Network&quot; tab.</li><li>Click &quot;WS&quot; to filter on WebSockets.</li><li>Refresh the browser to get a new WebSocket connection.</li><li>Click the WebSocket connection that is displayed.</li><li>Click the &quot;Messages&quot; tab to see all the WebSocket messages. This list is updated as new messages are received.</li><li>Click a message to see its details.</li></ol><p>Each message is preceded by an arrow. Outgoing messages have a green arrow pointing up and are sent from the client to the server. Incoming messages have a red arrow pointing down and are sent from the server to the client.</p><h3 id="meteor-websocket-messages" tabindex="-1">Meteor WebSocket Messages</h3><p>Each Meteor WebSocket message contains an array of JSON objects that have a <code>msg</code> property and other properties such as <code>collection</code>, <code>fields</code>, <code>id</code>, <code>method</code>, <code>methods</code>, <code>msg</code>, and <code>params</code>. Typically each message array contains a single object.</p><p>When a client initially connects to the server, a series of messages are sent from the server to the client. While I can't describe the purpose of each of these messages, I can describe the pattern observed. These messages include:</p><ul><li><p>one matching</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"msg"</span><span class="token operator">:</span> <span class="token string">"connect"</span><span class="token punctuation">,</span><br>  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"{some-version}"</span><span class="token punctuation">,</span><br>  <span class="token property">"support"</span><span class="token operator">:</span> <span class="token punctuation">[</span>?<span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre></li><li><p>several matching</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"msg"</span><span class="token operator">:</span> <span class="token string">"sub"</span><span class="token punctuation">,</span><br>  <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"{some-id}"</span><span class="token punctuation">,</span><br>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"{some-name}"</span><span class="token punctuation">,</span><br>  <span class="token property">"params"</span><span class="token operator">:</span> <span class="token punctuation">[</span>?<span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre></li><li><p>one matching <code>{&quot;server_id&quot;: &quot;{some-id}&quot;}</code></p></li><li><p>one matching <code>{&quot;msg&quot;: &quot;connected&quot;, &quot;session&quot;: &quot;{session-id}&quot;}</code></p></li><li><p>several matching <code>{&quot;msg&quot;: &quot;ready&quot;, &quot;subs&quot;: [?]}</code></p></li><li><p>several matching</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"msg"</span><span class="token operator">:</span> <span class="token string">"added"</span><span class="token punctuation">,</span><br>  <span class="token property">"collection"</span><span class="token operator">:</span> <span class="token string">"meteor_autoupdate_clientversions"</span><span class="token punctuation">,</span><br>  <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"version"</span><span class="token punctuation">,</span><br>  <span class="token property">"fields"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"version"</span><span class="token operator">:</span> "outdated<span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre></li></ul><p>Periodically, about every 45 seconds, each side sends a &quot;ping&quot; message to verify that the other side is still reachable. The other side replies with a &quot;pong&quot; message.</p><p>If the Meteor accounts packages are used to support account creation and sign in, a sign in request triggers a message from the client to the server containing the following JSON:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"msg"</span><span class="token operator">:</span> <span class="token string">"method"</span><span class="token punctuation">,</span><br>  <span class="token property">"method"</span><span class="token operator">:</span> <span class="token string">"login"</span><span class="token punctuation">,</span><br>  <span class="token property">"params"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"user"</span><span class="token operator">:</span> <span class="token string">"{username}"</span><span class="token punctuation">,</span><br>      <span class="token property">"password"</span><span class="token operator">:</span> <span class="token string">"{hashed-password}"</span><span class="token punctuation">,</span><br>      <span class="token property">"algorithm"</span><span class="token operator">:</span> <span class="token string">"sha-256"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre><p>A successful sign in triggers a message from the server to the client containing the following JSON:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"msg"</span><span class="token operator">:</span> <span class="token string">"result"</span><span class="token punctuation">,</span><br>  <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"{message-id}"</span><span class="token punctuation">,</span><br>  <span class="token property">"result"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"{result-id}"</span><span class="token punctuation">,</span><br>    <span class="token property">"token"</span><span class="token operator">:</span> <span class="token string">"{token}"</span><span class="token punctuation">,</span><br>    <span class="token property">"token-expires"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"$date"</span><span class="token operator">:</span> <span class="token string">"{timestamp}"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"password"</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>Updates to the MongoDB database trigger additional JSON messages from the server to the client that describe the changes. This allows Minimongo in the client to stay in sync. Each message has a <code>msg</code> property that specifies the type of update, a <code>collection</code> property set to the name of the collection, and an <code>id</code> property set to the <code>_id</code> value of the affected document.</p><p>When a document is added to a collection, <code>msg</code> is set to &quot;added&quot; and <code>fields</code> is set to a JSON object containing all the properties of the document.</p><p>When a document is updated, <code>msg</code> is set to &quot;changed&quot; and <code>fields</code> is set to a JSON object containing only the properties of the document that were modified.</p><p>When a document is deleted from a collection, <code>msg</code> is set to &quot;remove&quot;.</p><p>When a client subscribes to a collection, &quot;added&quot; messages described above are sent from the server to initially populate Minimongo.</p><h3 id="tracker" tabindex="-1">Tracker</h3><p>Tracker is a dependency tracking system used by Meteor to update UIs when reactive variables and data sources change. From the Meteor <a href="https://docs.meteor.com/api/tracker.html?v=1.0.21" rel="noopener" target="_blank">Tracker docs</a>, &quot;When you call a function that supports reactive updates (such as a database query), it automatically saves the current <code>Computation</code> object, if any (representing, for example, the current template being rendered). Later, when the data changes, the function can &quot;invalidate&quot; the <code>Computation</code>, causing it to rerun (re-rendering the template).&quot;</p><p>There is a low-level API for using Tracker, but there are easier ways to use it in React and Svelte.</p><p>For React there is hook called <code>useTracker</code> for responding to tracker changes. This is provided by the Meteor package <a href="https://atmospherejs.com/meteor/react-meteor-data?v=1.0.21" rel="noopener" target="_blank">react-meteor-data</a>.</p><p>For Svelte, there is a <code>useTracker</code> function. This is provided by the Meteor package <a href="https://atmospherejs.com/rdb/svelte-meteor-data?v=1.0.21" rel="noopener" target="_blank">rdb/svelte-meteor-data</a>.</p><p>For example, to always get the current user in a Svelte component when the accounts-password package is used:</p><pre class="language-js"><code class="language-js"><span class="token literal-property property">$</span><span class="token operator">:</span> user <span class="token operator">=</span> <span class="token function">useTracker</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> Meteor<span class="token punctuation">.</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The rdb/svelte-meteor-data package also turns MongoDB cursor objects into Svelte stores that automatically update whenever the database is updated in a way that affects the query results.</p><p>For example, to always get the latest tasks from a <code>task</code> collection:</p><pre class="language-js"><code class="language-js"><span class="token comment">// A query can limit the documents returned,</span><br><span class="token comment">// instead of getting all documents in the collection.</span><br><span class="token comment">// It is not typically desirable to</span><br><span class="token comment">// copy a large amount of data into Minimongo.</span><br><span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token comment">// A projection can limit the document properties returned</span><br><span class="token comment">// and/or specify a sort order.</span><br><span class="token keyword">const</span> projection <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">sort</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">createdAt</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// newest first</span><br><span class="token literal-property property">$</span><span class="token operator">:</span> tasks <span class="token operator">=</span> Tasks<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> projection<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Note that both <code>user</code> and <code>tasks</code> are Svelte stores, so references to them should have a <code>$</code> prefix.</p><p>For more information on the relationship between <code>useTracker</code> and Svelte stores, see this <a href="https://github.com/rdb/svelte-meteor-data/issues/6?v=1.0.21" rel="noopener" target="_blank">issue</a>.</p><h3 id="reactivevar" tabindex="-1">ReactiveVar</h3><p>A <code>ReactiveVar</code> is a client-side object holds a single value. They can be created and exported from <code>.js</code> files so they can be imported by multiple components. They can also be passed as a prop to components.</p><p>To use this feature, add the <code>reactive-var</code> package by entering <code>meteor add reactive-var</code>.</p><p>To create a new <code>ReactiveVar</code> object:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>ReactiveVar<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/reactive-var'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> myVar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReactiveVar</span><span class="token punctuation">(</span>initialValue<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>To change the value, call <code>myVar.set(newValue)</code>.</p><p>To get the value, call <code>myVar.get()</code>.</p><p>Here is a Svelte component that demonstrates using a <code>ReactiveVar</code>:</p><pre class="language-js"><code class="language-js"><span class="token operator">&lt;</span>script<span class="token operator">></span><br>  <span class="token keyword">import</span> <span class="token punctuation">{</span>ReactiveVar<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/reactive-var'</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> myRV <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReactiveVar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">let</span> counter<span class="token punctuation">;</span><br>  Tracker<span class="token punctuation">.</span><span class="token function">autorun</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    counter <span class="token operator">=</span> myRV<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><br><br><span class="token operator">&lt;</span>div<span class="token operator">></span><br>  counter <span class="token operator">=</span> <span class="token punctuation">{</span>counter<span class="token punctuation">}</span><br>  <span class="token operator">&lt;</span>button on<span class="token operator">:</span>click<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> myRV<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>Increment<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><br><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span></code></pre><p>Since Svelte components already support reactive variables within components and stores to achieve reactivity across components, there is little reason to use <code>ReactiveVar</code> in Svelte components.</p><h3 id="reactivedict" tabindex="-1">ReactiveDict</h3><p>A <code>ReactiveDict</code> is a client-side reactive data store that holds key/value pairs. They are used in the same ways a <code>ReactiveVar</code> objects, but they can hold multiple values instead of just one. The values can be any kind of JavaScript value that can be converted to JSON. Other values can be made compatible by calling <code>EJSON.addType(name, factory)</code>.</p><p>Multiple instances can be created to maintain separate groups of related key/value pairs.</p><p>To use this feature, add the <code>reactive-dict</code> package by entering <code>meteor add reactive-dict</code>.</p><p>To create a new <code>ReactiveDict</code> object:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>ReactiveDict<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/reactive-dict'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> myDict <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReactiveDict</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> initialKeyValuePairs<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Both constructor arguments are optional. Providing a name allows the key/value pairs to survive hot code pushes, but not browser refreshes. Providing an initial value is an alternative to starting with no key/value pairs.</p><p>To set the default value of a <code>ReactiveDict</code> key, call <code>ReactiveDict.setDefault(key, value)</code>. Only the first call is processed. Subsequent calls are ignored.</p><p>To set a new value of a <code>ReactiveDict</code> key, call <code>ReactiveDict.set(key, value)</code>.</p><p>To get the value of a <code>ReactiveDict</code> key, call <code>ReactiveDict.get(key)</code>.</p><p>To get all the current key/value pairs, call <code>myDict.all()</code>.</p><p>To remove all the key/value pairs, call <code>myDict.clear()</code>.</p><p>For the same reasons explained in the previous section on <code>ReactiveVar</code>, there is little reason to use <code>ReactiveDict</code> in Svelte components.</p><h3 id="session" tabindex="-1">Session</h3><p>The <code>Session</code> is a client-side, global <code>ReactiveDict</code> object. It is typically used to share data between components. The <code>Session</code> object cannot be shared between users or between browser tabs.</p><p>To use this feature, add the <code>session</code> package by entering <code>meteor add session</code>.</p><p>To use <code>Session</code> in a component, import it with <code>import {Session} from 'meteor/session;</code></p><p>The API for the <code>Session</code> object is identical to that of <code>ReactiveDict</code> objects since it is one.</p><p>To make the <code>Session</code> reactive so code is executed whenever the value for a given key changes, use <code>Tracker.autorun</code> as follows:</p><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> someValue<span class="token punctuation">;</span><br>Tracker<span class="token punctuation">.</span><span class="token function">autorun</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  someValue <span class="token operator">=</span> Session<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Here is a Svelte component that demonstrates using a <code>Session</code>:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">import</span> <span class="token punctuation">{</span>Session<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/session'</span><span class="token punctuation">;</span><br>  <span class="token keyword">import</span> <span class="token punctuation">{</span>Tracker<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/tracker'</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">let</span> counter<span class="token punctuation">;</span><br>  Tracker<span class="token punctuation">.</span><span class="token function">autorun</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    counter <span class="token operator">=</span> Session<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'counter'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  Session<span class="token punctuation">.</span><span class="token function">setDefault</span><span class="token punctuation">(</span><span class="token string">'counter'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    Session<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'counter'</span><span class="token punctuation">,</span> counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  {counter}<br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">on:</span>click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{increment}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Increment<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>The ESLint plugin eslint-plugin-meteor will complain about the use of <code>Session</code> based on the <a href="https://github.com/dferber90/eslint-plugin-meteor/blob/master/docs/rules/no-session.md?v=1.0.21" rel="noopener" target="_blank">meteor/no-session</a> rule. Disable this ESLint rule if you decide to use <code>Session</code>.</p><p>For the same reasons explained in the previous section on <code>ReactiveVar</code>, there is little reason to use <code>Session</code> in Svelte components.</p><h3 id="email" tabindex="-1">Email</h3><p>TODO: Document the Meteor API for sending email.</p><h3 id="eslint" tabindex="-1">ESLint</h3><p>The steps to install and configure the ESLint linting tool for use in a Meteor project are listed below. They assume using Svelte as the web framework. When this is not the case, the Svelte-specific parts can be omitted.</p><ul><li><p>Enter <code>npm install eslint eslint-plugin-import eslint-plugin-meteor eslint-plugin-svelte3</code></p></li><li><p>Add the following script in <code>package.json</code>:</p><pre class="language-json"><code class="language-json"><span class="token property">"lint"</span><span class="token operator">:</span> <span class="token string">"eslint --fix --quiet '{client,imports,server}/**/*.{js,svelte}'"</span><span class="token punctuation">,</span></code></pre></li><li><p>Create the file <code>.eslintrc.json</code> containing the following:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"env"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"browser"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>    <span class="token property">"es6"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>    <span class="token property">"jest"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>    <span class="token property">"node"</span><span class="token operator">:</span> <span class="token boolean">true</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token property">"extends"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token string">"eslint:recommended"</span><span class="token punctuation">,</span><br>    <span class="token string">"plugin:import/recommended"</span><span class="token punctuation">,</span><br>    <span class="token string">"plugin:meteor/recommended"</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token property">"overrides"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"files"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"**/*.svelte"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token property">"processor"</span><span class="token operator">:</span> <span class="token string">"svelte3/svelte3"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token property">"parserOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"ecmaVersion"</span><span class="token operator">:</span> <span class="token number">2019</span><span class="token punctuation">,</span><br>    <span class="token property">"sourceType"</span><span class="token operator">:</span> <span class="token string">"module"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"import"</span><span class="token punctuation">,</span> <span class="token string">"meteor"</span><span class="token punctuation">,</span> <span class="token string">"svelte3"</span><span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre></li></ul><p>To run ESLint, enter <code>npm run lint</code>.</p><p>ESLint will give &quot;Unable to resolve path to module&quot; errors on all imports that begin with &quot;meteor/&quot;. However, the Meteor build system is able to resolve these. To suppress these errors, add the following top level property in the <code>.eslintrc.json</code> file:</p><pre class="language-json"><code class="language-json"><span class="token property">"rules"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>  <span class="token property">"import/no-unresolved"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"error"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token property">"ignore"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"^meteor/"</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre><h3 id="prettier" tabindex="-1">Prettier</h3><p>The steps to install and configure the Prettier code formatting tool for use in a Meteor project are listed below. They assume using Svelte as the web framework. When this is not the case, the Svelte-specific parts can be omitted.</p><ul><li><p>Enter <code>npm install prettier prettier-plugin-svelte</code></p></li><li><p>Add the following script in <code>package.json</code>:</p><pre class="language-json"><code class="language-json"><span class="token property">"format"</span><span class="token operator">:</span> <span class="token string">"prettier --write '{client,imports,server}/**/*.{css,html,js,svelte}'"</span><span class="token punctuation">,</span></code></pre></li><li><p>Create the file <code>.prettierrc</code> containing personal preferences like the following:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"arrowParens"</span><span class="token operator">:</span> <span class="token string">"avoid"</span><span class="token punctuation">,</span><br>  <span class="token property">"bracketSpacing"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>  <span class="token property">"singleQuote"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>  <span class="token property">"svelteSortOrder"</span><span class="token operator">:</span> <span class="token string">"scripts-markup-styles"</span><span class="token punctuation">,</span><br>  <span class="token property">"trailingComma"</span><span class="token operator">:</span> <span class="token string">"none"</span><br><span class="token punctuation">}</span></code></pre></li></ul><p>To run Prettier, enter <code>npm run format</code>.</p><h3 id="devtools" tabindex="-1">DevTools</h3><p>The Chrome extension &quot;Meteor DevTools Evolved&quot; displays DDP messages, Minimongo contents, and subscriptions.</p><p>To install it, browse <a href="https://chrome.google.com/webstore/search/meteor%20devtools%20evolved?v=1.0.21" rel="noopener" target="_blank">here</a>.</p><h3 id="tutorials" tabindex="-1">Tutorials</h3><p>The Meteor web site contains several tutorials <a href="https://www.meteor.com/tutorials?v=1.0.21" rel="noopener" target="_blank">here</a> that provide introductions to using Meteor.</p><h3 id="todo-app" tabindex="-1">Todo App</h3><p>Let's walk through the steps to build a Todo app using Meteor. This is a modified version of the Todo app presented at the Meteor site that demonstrates additional features. Code for the final version of this app can be found in <a href="https://github.com/mvolkmann/meteor-svelte-todos?v=1.0.21" rel="noopener" target="_blank">GitHub</a>.</p><ol><li><p>Create the app starting point by entering <code>meteor create todos</code>.</p><p>We are using the default app template here. To use a non-default app template, add one of the following options after <code>create</code>: <code>--bare</code>, <code>--minimal</code>, <code>--full</code>, <code>--react</code>, or <code>--typescript</code>. None of these options corresponds to the default which produces applications that are insecure. Such applications allow all MongoDB updates to be initiated from clients and all documents are synced from MongoDB on the server to Minimongo in the client. We will learn how to fix this later. For details on the Meteor packages included by default and with each of the options see <a href="https://docs.meteor.com/commandline.html#meteorcreate?v=1.0.21" rel="noopener" target="_blank">here</a>.</p></li><li><p>Modify the <code>start</code> script in <code>package.json</code> as follows if you are not targeting older browsers or mobile devices in order to avoid generating unnecessary code:</p><pre class="language-json"><code class="language-json"><span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"meteor run --exclude-archs 'web.browser.legacy, web.cordova'"</span><span class="token punctuation">,</span></code></pre></li><li><p>Start the server by entering <code>cd todos</code>, <code>meteor npm install</code>, and <code>npm start</code>.</p></li><li><p>Browse localhost:3000 to see the following page:</p><p><img src="/blog/assets/meteor-default-page.png" alt="default Meteor app"></p></li><li><p>Press the &quot;Click Me&quot; button multiple times.</p><p>The text &quot;You've pressed the button n times.&quot; will update to display the number of times it was clicked.</p></li><li><p>Exercise &quot;hot code push&quot;.</p><p>The UI is defined by the following files in the <code>client</code> directory: <code>main.html</code>, <code>main.css</code>, and <code>main.js</code>. Try editing the file <code>client/main.html</code>. The browser will updated automatically when the changes are saved.</p></li><li><p>Configure the app to use the Svelte web framework, instead of the default Blaze framework.</p><p>Svelte is a good choice due to its use of reactive statements. For more information about Svelte, see <a href="https://objectcomputing.com/resources/publications/sett/july-2019-web-dev-simplified-with-svelte?v=1.0.21" rel="noopener" target="_blank">my article</a>.</p><ul><li><p>Install Svelte by entering <code>meteor npm install svelte</code>.</p></li><li><p>Add some Meteor packages by entering<br><code>meteor add svelte:compiler rdb:svelte-meteor-data</code></p></li><li><p>Remove a package that will no longer be used by entering<br><code>meteor remove blaze-html-templates</code></p></li><li><p>Add a replacement Meteor package by entering<br><code>meteor add static-html</code></p></li></ul></li><li><p>Replace the content of <code>client/main.html</code> with the following:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Todo App<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>  <span class="token comment">&lt;!-- Svelte will insert content in this div. --></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre></li><li><p>Replace the content of <code>client/main.js</code> with the following:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>Meteor<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/meteor'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.svelte'</span><span class="token punctuation">;</span><br><br>Meteor<span class="token punctuation">.</span><span class="token function">startup</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">new</span> <span class="token class-name">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">target</span><span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Create the file <code>client/Task.svelte</code> containing the following:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">export</span> <span class="token keyword">let</span> task<span class="token punctuation">;</span> <span class="token comment">// Parent components pass this value as a prop.</span><br><br>  <span class="token keyword">const</span> <span class="token function-variable function">formatDate</span> <span class="token operator">=</span> <span class="token parameter">date</span> <span class="token operator">=></span><br>    date<span class="token punctuation">.</span><span class="token function">toLocaleDateString</span><span class="token punctuation">(</span><span class="token string">'en-us'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>      <span class="token literal-property property">month</span><span class="token operator">:</span> <span class="token string">'short'</span><span class="token punctuation">,</span><br>      <span class="token literal-property property">day</span><span class="token operator">:</span> <span class="token string">'numeric'</span><span class="token punctuation">,</span><br>      <span class="token literal-property property">year</span><span class="token operator">:</span> <span class="token string">'numeric'</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// These are Svelte "reactive declarations" which are</span><br>  <span class="token comment">// re-executed any time a variable they depend on changes.</span><br>  <span class="token literal-property property">$</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>createdAt<span class="token punctuation">,</span> text<span class="token punctuation">}</span> <span class="token operator">=</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token literal-property property">$</span><span class="token operator">:</span> item <span class="token operator">=</span> text <span class="token operator">+</span> <span class="token punctuation">(</span>createdAt <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> - added </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">formatDate</span><span class="token punctuation">(</span>createdAt<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>{item}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><br>  <span class="token comment">/* This styling is scoped to this component. */</span><br>  <span class="token selector">li</span> <span class="token punctuation">{</span><br>    <span class="token property">padding-left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre></li><li><p>Create the file <code>client/App.svelte</code> containing the following:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">import</span> Task <span class="token keyword">from</span> <span class="token string">'./Task.svelte'</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Later we will replace this with a way to get the tasks from MongoDB.</span><br>  <span class="token keyword">function</span> <span class="token function">getTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> createdAt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> <span class="token punctuation">[</span><br>      <span class="token punctuation">{</span><span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'This is task 1'</span><span class="token punctuation">,</span> createdAt<span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token punctuation">{</span><span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'This is task 2'</span><span class="token punctuation">,</span> createdAt<span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token punctuation">{</span><span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'This is task 3'</span><span class="token punctuation">,</span> createdAt<span class="token punctuation">}</span><br>    <span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Todo App<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><br>      {#each getTasks() as task}<br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Task</span> <span class="token attr-name">{task}</span> <span class="token punctuation">/></span></span><br>      {/each}<br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>At this point the app should display the following basic task list:</p><p><img src="/blog/assets/meteor-todo-1.png" alt="Todo App after step 14"></p></li><li><p>Replace the contents of <code>client/main.css</code> with what is found at <a href="https://github.com/meteor/simple-todos-svelte/blob/master/client/main.css?v=1.0.21" rel="noopener" target="_blank">here</a>. Now the task list is styled nicely.</p><p><img src="/blog/assets/meteor-todo-2.png" alt="Todo App after step 15"></p></li><li><p>Create a top-level project directory named <code>imports</code>.</p></li><li><p>Create the file <code>imports/tasks.js</code> containing the following which will create a MongoDB collection named &quot;tasks&quot;:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>Mongo<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/mongo'</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> Tasks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mongo<span class="token punctuation">.</span>Collection</span><span class="token punctuation">(</span><span class="token string">'tasks'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Add the following import near the top of <code>server/main.js</code>.</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">'../imports/tasks.js'</span><span class="token punctuation">;</span></code></pre></li><li><p>Add the following import near the top of <code>client/App.svelte</code>:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>Tasks<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../imports/tasks.js'</span><span class="token punctuation">;</span></code></pre></li><li><p>Replace the <code>getTasks</code> function in <code>client/App.svelte</code> with the following in order to get tasks from MongoDB:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> projection <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">sort</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">createdAt</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// newest first</span><br><span class="token comment">// This is a MongoDB cursor which is also a Svelte store.</span><br><span class="token literal-property property">$</span><span class="token operator">:</span> tasks <span class="token operator">=</span> Tasks<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> projection<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Replace the call to <code>getTasks()</code> in <code>client/App.svelte</code> with <code>$tasks</code>.</p><p>This is a reference to a Svelte store that is kept in sync with the MongoDB &quot;tasks&quot; collection. The UI will no longer display any tasks because this collection does not yet contain any tasks.</p></li><li><p>Insert some tasks using the MongoDB console by entering the following:</p><pre class="language-bash"><code class="language-bash">meteor mongo<br>db.tasks.insert<span class="token punctuation">(</span><span class="token punctuation">{</span> text: <span class="token string">"buy milk"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><br>db.tasks.insert<span class="token punctuation">(</span><span class="token punctuation">{</span> text: <span class="token string">"take out trash"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>Note that the UI updates automatically to show these new tasks.</p><p><img src="/blog/assets/meteor-todo-3.png" alt="Todo App after step 22"></p></li><li><p>Enable adding tasks in the UI.</p><ul><li><p>Add the following inside the <code>script</code> element in <code>client/App.svelte</code>:</p><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br><br><span class="token keyword">function</span> <span class="token function">addTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  Tasks<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>text<span class="token punctuation">,</span> <span class="token literal-property property">createdAt</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  text <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Add the following in <code>client/App.svelte</code> as the first child of the <code>section</code> element to prepare for adding tasks in the UI:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name"><span class="token namespace">on:</span>submit|preventDefault</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{addTask}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>todo text<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">bind:</span>value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{text}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>Add<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></code></pre></li><li><p>Add the following after the HTML in <code>client/App.svelte</code>:</p><pre class="language-css"><code class="language-css"><span class="token selector">&lt;style><br>  form</span> <span class="token punctuation">{</span><br>    <span class="token property">margin-top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><br>    <span class="token property">padding-bottom</span><span class="token punctuation">:</span> 1rem<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token selector">section</span> <span class="token punctuation">{</span><br>    <span class="token property">padding</span><span class="token punctuation">:</span> 1rem<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>&lt;/style></code></pre></li></ul><p>Now new tasks can be added by entering text in the input and either pressing the &quot;Add&quot; button or pressing the return key.</p><p><img src="/blog/assets/meteor-todo-4.png" alt="Todo App after step 25"></p></li><li><p>Note how Meteor keeps all clients in sync.</p><p>To see this, open a second web browser or another window in the same web browser and browse localhost:3000. Add a task in either browser window and notice that it appears in both.</p></li><li><p>Add the ability to mark tasks as done and delete them by changing <code>client/Task.svelte</code> to match the following:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">import</span> <span class="token punctuation">{</span>Tasks<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../imports/tasks.js'</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">export</span> <span class="token keyword">let</span> task<span class="token punctuation">;</span><br><br>  <span class="token keyword">function</span> <span class="token function">deleteTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    Tasks<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>_id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">const</span> <span class="token function-variable function">formatDate</span> <span class="token operator">=</span> <span class="token parameter">date</span> <span class="token operator">=></span><br>    date<span class="token punctuation">.</span><span class="token function">toLocaleDateString</span><span class="token punctuation">(</span><span class="token string">'en-us'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>      <span class="token literal-property property">month</span><span class="token operator">:</span> <span class="token string">'short'</span><span class="token punctuation">,</span><br>      <span class="token literal-property property">day</span><span class="token operator">:</span> <span class="token string">'numeric'</span><span class="token punctuation">,</span><br>      <span class="token literal-property property">year</span><span class="token operator">:</span> <span class="token string">'numeric'</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">function</span> <span class="token function">toggleDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    Tasks<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>_id<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">$set</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token operator">!</span>task<span class="token punctuation">.</span>done<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token literal-property property">$</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>createdAt<span class="token punctuation">,</span> text<span class="token punctuation">}</span> <span class="token operator">=</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token literal-property property">$</span><span class="token operator">:</span> item <span class="token operator">=</span> text <span class="token operator">+</span> <span class="token punctuation">(</span>createdAt <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> - added </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">formatDate</span><span class="token punctuation">(</span>createdAt<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">checked</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{task.done}<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">on:</span>click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{toggleDone}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">class:</span>done</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{task.done}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{item}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><br>  <span class="token comment">&lt;!-- using Unicode trash can --></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">on:</span>click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{deleteTask}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token entity" title="&#x1f5d1;">&amp;#x1f5d1;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><br>  <span class="token selector">button</span> <span class="token punctuation">{</span><br>    <span class="token property">background-color</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span><br>    <span class="token property">border</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token selector">.done</span> <span class="token punctuation">{</span><br>    <span class="token property">opacity</span><span class="token punctuation">:</span> 0.3<span class="token punctuation">;</span><br>    <span class="token property">text-decoration</span><span class="token punctuation">:</span> line-through<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token selector">li</span> <span class="token punctuation">{</span><br>    <span class="token property">padding-left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><p>Now tasks can be marked as done by clicking the checkbox in front of them and they can be deleted by clicking the trash can icon after them.</p><p><img src="/blog/assets/meteor-todo-5.png" alt="Todo App after step 26"></p></li><li><p>Show the number of remaining tasks and total tasks in the heading by making the following changes in <code>client/App.svelte</code>:</p><ul><li><p>Add the following in the <code>script</code> element:</p><pre class="language-js"><code class="language-js"><span class="token literal-property property">$</span><span class="token operator">:</span> remaining <span class="token operator">=</span> $tasks<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=></span> <span class="token operator">!</span>t<span class="token punctuation">.</span>done<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span></code></pre></li><li><p>Add the following as the new first child of the <code>section</code> element:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stats<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{remaining} of {$tasks.length} remaining<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code></pre></li><li><p>Add the following inside the <code>style</code> element:</p><pre class="language-css"><code class="language-css"><span class="token selector">.stats</span> <span class="token punctuation">{</span><br>  <span class="token property">margin-top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></li></ul><p>Now when tasks are added, toggled between done and not done, and deleted, the number of remaining tasks and total tasks is updated.</p><p><img src="/blog/assets/meteor-todo-6.png" alt="Todo App after step 27"></p></li><li><p>Add the ability to only display tasks that are not done by making the following changes in <code>client/App.svelte</code>:</p><ul><li><p>Add the following variable declaration in the <code>script</code> element:</p><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> hideCompleted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></code></pre></li><li><p>Add the following inside the <code>form</code> element after the &quot;Add&quot; button:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hide-completed<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">bind:</span>checked</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{hideCompleted}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>  Hide Completed Tasks<br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span></code></pre></li><li><p>Change the content of the <code>{#each}</code> block to the following:</p><pre class="language-html"><code class="language-html">{#if !hideCompleted || !task.done}<br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Task</span> <span class="token attr-name">{task}</span> <span class="token punctuation">/></span></span><br>{/if}</code></pre></li></ul><p>Now when the &quot;Hide Completed Tasks&quot; checkbox is checked, only tasks that are not done are displayed.</p><p><img src="/blog/assets/meteor-todo-7.png" alt="Todo App after step 28"></p></li><li><p>Add support for user accounts by doing the following:</p><ul><li><p>Add some Meteor packages by entering<br><code>meteor add accounts-ui accounts-password svelte:blaze-integration</code></p></li><li><p>Create the file <code>client/accounts-config.js</code> with the following content:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>Accounts<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/accounts-base'</span><span class="token punctuation">;</span><br><br><span class="token comment">// Email is needed for the next step.</span><br>Accounts<span class="token punctuation">.</span>ui<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token literal-property property">passwordSignupFields</span><span class="token operator">:</span> <span class="token string">'USERNAME_AND_EMAIL'</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Add the following near the top of <code>client/main.js</code>:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">'./accounts-config.js'</span><span class="token punctuation">;</span></code></pre><p>Alternatively, this can be imported from a <code>.svelte</code> file, perhaps the one that renders <code>&lt;BlazeTemplate template=&quot;loginButtons&quot; /&gt;</code>, which is described next.</p></li><li><p>Modify the <code>client/App.svelte</code> file to match the following:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">import</span> <span class="token punctuation">{</span>Meteor<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/meteor'</span><span class="token punctuation">;</span><br>  <span class="token keyword">import</span> <span class="token punctuation">{</span>useTracker<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/rdb:svelte-meteor-data'</span><span class="token punctuation">;</span><br>  <span class="token keyword">import</span> <span class="token punctuation">{</span>BlazeTemplate<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/svelte:blaze-integration'</span><span class="token punctuation">;</span><br>  <span class="token keyword">import</span> <span class="token punctuation">{</span>Tasks<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../imports/tasks.js'</span><span class="token punctuation">;</span><br>  <span class="token keyword">import</span> Task <span class="token keyword">from</span> <span class="token string">'./Task.svelte'</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">let</span> hideCompleted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>  <span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br>  <span class="token keyword">let</span> user<span class="token punctuation">;</span><br><br>  <span class="token comment">// user is a store</span><br>  <span class="token literal-property property">$</span><span class="token operator">:</span> user <span class="token operator">=</span> <span class="token function">useTracker</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> Meteor<span class="token punctuation">.</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> projection <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">sort</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">createdAt</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// newest first</span><br>  <span class="token comment">// This is a MongoDB cursor which is also a Svelte store.</span><br>  <span class="token literal-property property">$</span><span class="token operator">:</span> tasks <span class="token operator">=</span> Tasks<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> projection<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token literal-property property">$</span><span class="token operator">:</span> remaining <span class="token operator">=</span> $tasks<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=></span> <span class="token operator">!</span>t<span class="token punctuation">.</span>done<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span><br><br>  <span class="token keyword">function</span> <span class="token function">addTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    Tasks<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>      text<span class="token punctuation">,</span><br>      <span class="token literal-property property">createdAt</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>      <span class="token literal-property property">owner</span><span class="token operator">:</span> Meteor<span class="token punctuation">.</span><span class="token function">userId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>      <span class="token literal-property property">username</span><span class="token operator">:</span> $user<span class="token punctuation">.</span>username<br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    text <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token comment">&lt;!-- This provides the UI for user account management. --></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BlazeTemplate</span> <span class="token attr-name">template</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>loginButtons<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Todo App<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">></span></span><br><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span><span class="token punctuation">></span></span><br>    {#if $user}<br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stats<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{remaining} of {$tasks.length} remaining<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name"><span class="token namespace">on:</span>submit|preventDefault</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{addTask}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>todo text<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">bind:</span>value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{text}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>Add<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hide-completed<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">bind:</span>checked</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{hideCompleted}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>        Hide Completed Tasks<br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><br>      {#each $tasks as task} {#if !hideCompleted || !task.done}<br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Task</span> <span class="token attr-name">{task}</span> <span class="token punctuation">/></span></span><br>      {/if} {/each}<br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><br>    {:else}<br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Please sign in.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><br>    {/if}<br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><br>  <span class="token selector">form</span> <span class="token punctuation">{</span><br>    <span class="token property">margin-top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><br>    <span class="token property">padding-bottom</span><span class="token punctuation">:</span> 1rem<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token selector">section</span> <span class="token punctuation">{</span><br>    <span class="token property">padding</span><span class="token punctuation">:</span> 1rem<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token selector">.stats</span> <span class="token punctuation">{</span><br>    <span class="token property">margin-top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">/* This is a way to define global styles from a Svelte component. */</span><br>  <span class="token selector">:global(#login-buttons)</span> <span class="token punctuation">{</span><br>    <span class="token property">padding</span><span class="token punctuation">:</span> 0.5rem<span class="token punctuation">;</span><br>    <span class="token property">text-align</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token selector">:global(#login-buttons a)</span> <span class="token punctuation">{</span><br>    <span class="token property">text-decoration</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token selector">:global(#login-dropdown-list)</span> <span class="token punctuation">{</span><br>    <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span><br>    <span class="token property">top</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span><br>    <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span><br>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-50%<span class="token punctuation">,</span> -50%<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre></li></ul><p>Now users must create an account and sign in before they can view, add, and modify tasks. Information about user accounts is stored in the MongoDB database &quot;meteor&quot; inside the collection &quot;users&quot;.</p><p>Before a user signs in, they see a &quot;Sign in&quot; link in the upper-right.</p><p><img src="/blog/assets/meteor-todo-before-sign-in.png" alt="Todo App before sign in"></p><p>Clicking &quot;Sign in&quot; displays a dialog that contains a link to create an account.</p><p><img src="/blog/assets/meteor-todo-sign-in.png" alt="Todo App before sign in"></p><p>Clicking &quot;Create account&quot; changes the dialog to prompt for account information. By default, passwords must contain at least six characters, but there are no restrictions on the characters.</p><p><img src="/blog/assets/meteor-todo-create-account.png" alt="Todo App before sign in"></p><p>After creating an account, or entering a username and password for an existing account, the user is signed in and the &quot;Sign in&quot; link in the upper-right is replaced by their username.</p><p><img src="/blog/assets/meteor-todo-after-sign-in.png" alt="Todo App before sign in"></p><p>Clicking the username link in the upper-right presents a dialog for signing out or changing the password.</p><p><img src="/blog/assets/meteor-todo-click-username.png" alt="Todo App before sign in"></p><p>Clicking &quot;Change password&quot; changes the dialog to prompt for the current and new passwords.</p><p><img src="/blog/assets/meteor-todo-change-password.png" alt="Todo App before sign in"></p><p>After successfully changing the password, the dialog changes to notify the user.</p><p><img src="/blog/assets/meteor-todo-password-changed.png" alt="Todo App before sign in"></p><p>For more information on users and accounts features and ways to customize them, see <a href="https://guide.meteor.com/accounts.html?v=1.0.21" rel="noopener" target="_blank">here</a>. This includes adding support for OAuth logins and changing password validation rules. To give users role-based permissions and per-document permissions, see <a href="https://guide.meteor.com/accounts.html#roles-and-permissions?v=1.0.21" rel="noopener" target="_blank">here</a>.</p></li><li><p>Add support for &quot;forgot password&quot; emails.</p><p>This will allow users to click the &quot;Forgot password&quot; link in the &quot;Sign in&quot; dialog which changes the dialog content to prompt for an email address. If a user account exists for the email address, an email is sent containing a link that the user can click to reset their password. After doing so they are immediately signed in.</p><ul><li><p>Add another Meteor packages by entering<br><code>meteor add email</code></p></li><li><p>Create the file <code>secrets.json</code> in the project root directory with content like the following:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"MAIL_NAME"</span><span class="token operator">:</span> <span class="token string">"Your Name"</span><span class="token punctuation">,</span><br>  <span class="token property">"MAIL_USER"</span><span class="token operator">:</span> <span class="token string">"some-user"</span><span class="token punctuation">,</span><br>  <span class="token property">"MAIL_PASSWORD"</span><span class="token operator">:</span> <span class="token string">"some-password"</span><span class="token punctuation">,</span><br>  <span class="token property">"MAIL_USER_DOMAIN"</span><span class="token operator">:</span> <span class="token string">"some-company.com"</span><span class="token punctuation">,</span><br>  <span class="token property">"MAIL_SERVER_DOMAIN"</span><span class="token operator">:</span> <span class="token string">"smtp.gmail.com"</span><span class="token punctuation">,</span><br>  <span class="token property">"MAIL_SERVER_PORT"</span><span class="token operator">:</span> <span class="token number">587</span><br><span class="token punctuation">}</span></code></pre><p>Note that the last two values above are specific to using a Google G Suite account for sending email. The values will differ if you are using a different email service. Another service to consider is <a href="https://mailchimp.com/?v=1.0.21" rel="noopener" target="_blank">MailChimp</a>.</p></li><li><p>If you are saving the project in a Git repository, add <code>secrets.json</code> to the <code>.gitignore</code> file so it is not added to the repository for others to see.</p></li><li><p>Create the file <code>server/accounts-setup.js</code> with the following content:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>Accounts<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/accounts-base'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> secrets <span class="token keyword">from</span> <span class="token string">'../secrets.json'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> siteName <span class="token operator">=</span> <span class="token string">'Todos by Mark'</span><span class="token punctuation">;</span><br>Accounts<span class="token punctuation">.</span>emailTemplates<span class="token punctuation">.</span>siteName <span class="token operator">=</span> siteName<span class="token punctuation">;</span><br><br><span class="token keyword">const</span> from <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>secrets<span class="token punctuation">.</span><span class="token constant">MAIL_NAME</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>secrets<span class="token punctuation">.</span><span class="token constant">MAIL_USER</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">@</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>secrets<span class="token punctuation">.</span><span class="token constant">MAIL_USER_DOMAIN</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>Accounts<span class="token punctuation">.</span>emailTemplates<span class="token punctuation">.</span>from <span class="token operator">=</span> from<span class="token punctuation">;</span></code></pre></li><li><p>Modify the file <code>server/main.js</code> to match the following:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>Meteor<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/meteor'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">'../imports/tasks.js'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">'./accounts-setup.js'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> secrets <span class="token keyword">from</span> <span class="token string">'../secrets.json'</span><span class="token punctuation">;</span><br><br>Meteor<span class="token punctuation">.</span><span class="token function">startup</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token comment">// code to run on server at startup</span><br>  process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MAIL_URL</span> <span class="token operator">=</span><br>    <span class="token string">'smtp://'</span> <span class="token operator">+</span><br>    secrets<span class="token punctuation">.</span><span class="token constant">MAIL_USER</span> <span class="token operator">+</span><br>    <span class="token string">'%40'</span> <span class="token operator">+</span><br>    secrets<span class="token punctuation">.</span><span class="token constant">MAIL_USER_DOMAIN</span> <span class="token operator">+</span><br>    <span class="token string">':'</span> <span class="token operator">+</span><br>    secrets<span class="token punctuation">.</span><span class="token constant">MAIL_PASSWORD</span> <span class="token operator">+</span><br>    <span class="token string">'@'</span> <span class="token operator">+</span><br>    secrets<span class="token punctuation">.</span><span class="token constant">MAIL_SERVER_DOMAIN</span> <span class="token operator">+</span><br>    <span class="token string">':'</span> <span class="token operator">+</span><br>    secrets<span class="token punctuation">.</span><span class="token constant">MAIL_SERVER_PORT</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li></ul><p>Now when a user clicks the &quot;Forgot password&quot; link in the sign in dialog, they can enter their email address and press the &quot;Reset password&quot; button.</p><p><img src="/blog/assets/meteor-todo-forgot-password.png" alt="Todo App forgot password"></p><p>When the email is sent, the dialog changes to include the text &quot;Email sent&quot;.</p><p><img src="/blog/assets/meteor-todo-forgot-password-email-sent.png" alt="Todo App forgot password email sent"></p><p>The user will receive an email like the following:</p><p><img src="/blog/assets/meteor-todo-password-reset-email.png" alt="Todo App password reset email"></p><p>Clicking the link opens the app in a new browser tab and displays a dialog for resetting the password.</p><p><img src="/blog/assets/meteor-todo-password-reset.png" alt="Todo App password reset"></p><p>After entering a new password, the user is notified that it has been reset and that they are now logged in.</p><p><img src="/blog/assets/meteor-todo-after-password-reset.png" alt="Todo App after password reset"></p></li><li><p>Make the app more secure by moving database interactions to the server.</p><p>This is accomplished by implementing Meteor Methods that are invoked by client-side code with calls to <code>Meteor.call(name, data, callback)</code>.</p><ul><li><p>Remove the Meteor package that allows client code to interact with MongoDB by entering <code>meteor remove insecure</code>.</p></li><li><p>Define Methods by modifying <code>imports/tasks.js</code> to match the following:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>check<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/check'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>Meteor<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/meteor'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>Mongo<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/mongo'</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> Tasks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mongo<span class="token punctuation">.</span>Collection</span><span class="token punctuation">(</span><span class="token string">'tasks'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>Meteor<span class="token punctuation">.</span><span class="token function">methods</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token function">addTask</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">check</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// parameter type validation</span><br><br>    <span class="token comment">// Make sure the user is logged in before inserting a task.</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>userId<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Meteor<span class="token punctuation">.</span>Error</span><span class="token punctuation">(</span><span class="token string">'addTask'</span><span class="token punctuation">,</span> <span class="token string">'not-authorized'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">const</span> <span class="token punctuation">{</span>username<span class="token punctuation">}</span> <span class="token operator">=</span> Meteor<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> id <span class="token operator">=</span> Tasks<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>      text<span class="token punctuation">,</span><br>      <span class="token literal-property property">createdAt</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>      <span class="token literal-property property">owner</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userId<span class="token punctuation">,</span><br>      username<br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> id<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br><br>  <span class="token function">deleteTask</span><span class="token punctuation">(</span><span class="token parameter">taskId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">check</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// parameter type validation</span><br>    Tasks<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br><br>  <span class="token function">setDone</span><span class="token punctuation">(</span><span class="token parameter">taskId<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">check</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// parameter type validation</span><br>    <span class="token function">check</span><span class="token punctuation">(</span>done<span class="token punctuation">,</span> Boolean<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// parameter type validation</span><br>    Tasks<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">$set</span><span class="token operator">:</span> <span class="token punctuation">{</span>done<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Create the file <code>client/util.js</code> containing the following error handling function:</p><pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">handleError</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// Replace this will better error handling later.</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">alert</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Add the following <code>import</code> in <code>client/App.svelte</code> and <code>client/Task.svelte</code>:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>handleError<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./util.js'</span><span class="token punctuation">;</span></code></pre></li><li><p>Replace the call to <code>Tasks.insert</code> in the <code>addTask</code> function of <code>client/App.svelte</code> with the following:</p><pre class="language-js"><code class="language-js"><span class="token function">Meteor</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'addTask'</span><span class="token punctuation">,</span> text<span class="token punctuation">,</span> handleError<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Remove the import of <code>Tasks</code> from <code>client/Task.svelte</code> since it is no longer used and add the following import:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>Meteor<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'meteor/meteor'</span><span class="token punctuation">;</span></code></pre></li><li><p>Replace the call to <code>Tasks.remove</code> in the <code>deleteTask</code> function of <code>client/Task.svelte</code> with the following:</p><pre class="language-js"><code class="language-js"><span class="token function">Meteor</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'deleteTask'</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span>_id<span class="token punctuation">,</span> handleError<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Replace the call to <code>Tasks.update</code> in the <code>toggleDone</code> function of <code>client/Task.svelte</code> with the following:</p><pre class="language-js"><code class="language-js"><span class="token function">Meteor</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'setDone'</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span>_id<span class="token punctuation">,</span> <span class="token operator">!</span>task<span class="token punctuation">.</span>done<span class="token punctuation">,</span> handleError<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li></ul><p>Nothing will change in the UI. But client-side code can no longer directly modify the MongoDB database.</p></li><li><p>Explicitly specify what data the server sends to the client so we can separate tasks by user.</p><p>Tasks for all users will still be stored in the same MongoDB collection, but each user will only see and operate on the tasks they add.</p><ul><li><p>Remove the ability for the server to send any MongoDB content requested by clients. Currently the app includes the <code>autopublish</code> package. It shares every collection and every document in them with every connected client. This is convenient for prototyping, but not desired for production.</p><p>Enter <code>meteor remove autopublish</code>.</p></li><li><p>Publish only tasks that belong to the logged in user by adding the following in <code>imports/tasks.js</code> after the line that starts with <code>export const Tasks</code>.</p><pre class="language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>Meteor<span class="token punctuation">.</span>isServer<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// This is only run on the server.</span><br>  <span class="token comment">// An arrow function cannot be used here</span><br>  <span class="token comment">// because we need to use the "this" keyword.</span><br>  <span class="token comment">// If no query is provided, the entire collection is published.</span><br>  <span class="token comment">// A second argument can be passed to the find method which is</span><br>  <span class="token comment">// an object where the keys are names of properties.</span><br>  <span class="token comment">// The values are booleans that either specify which properties</span><br>  <span class="token comment">// to include (true) or which to exclude (false), but not both.</span><br>  Meteor<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'tasks'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> Tasks<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">owner</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userId<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Add the following <code>import</code> in <code>client/App.svelte</code>:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>onMount<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'svelte'</span><span class="token punctuation">;</span></code></pre></li><li><p>Add the following in the <code>script</code> element of <code>client/App.svelte</code> to subscribe to all tasks that are published:</p><pre class="language-js"><code class="language-js"><span class="token comment">// The name passed to subscribe must match a name passed to publish.</span><br><span class="token function">onMount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> Meteor<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'tasks'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Additional arguments can be passed to <code>Meteor.subscribe</code>. These are passed to the function that is passed to <code>Meteor.publish</code> in the server and it can uses them to decide which documents to publish. This is useful to limit the amount of data that is copied into Minimongo on the client.</p><p>The <code>Meteor.subscribe</code> method returns an object that can be captured in a variable. It has three properties. <code>stop</code> is a method that can be called to cancel the subscription. Typically the subscription is retained for the duration of the session. <code>ready</code> is a method returns the boolean <code>true</code> when the server has completed the initial publication of data. <code>subscriptionId</code> is a unique id for the subscription that is not typically needed.</p></li></ul><p>Now users only see and operate on their own tasks.</p></li><li><p>Require account email validation before users can view and operate on their tasks.</p><ul><li><p>Add the following at the bottom of <code>server/accounts-setup.js</code>:</p><pre class="language-js"><code class="language-js">Accounts<span class="token punctuation">.</span><span class="token function">onLogin</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>user<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>email<span class="token punctuation">]</span> <span class="token operator">=</span> user<span class="token punctuation">.</span>emails<span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>email<span class="token punctuation">.</span>verified<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    Accounts<span class="token punctuation">.</span><span class="token function">sendVerificationEmail</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>_id<span class="token punctuation">,</span> email<span class="token punctuation">.</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>Accounts<span class="token punctuation">.</span>emailTemplates<span class="token punctuation">.</span>verifyEmail <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token function">subject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Activate your </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>siteName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> account.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token function">text</span><span class="token punctuation">(</span><span class="token parameter">user<span class="token punctuation">,</span> url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token punctuation">(</span><br>      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hey </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>username<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, click the following link </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span><br>      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">to verify your email address: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></li><li><p>Determine if the logged in user has a verified email address by adding the following in <code>client/App.svelte</code> after the <code>$: user =</code> line:</p><pre class="language-js"><code class="language-js"><span class="token literal-property property">$</span><span class="token operator">:</span> emailVerified <span class="token operator">=</span> $user <span class="token operator">&amp;&amp;</span> $user<span class="token punctuation">.</span>emails<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>verified<span class="token punctuation">;</span></code></pre></li><li><p>Change <code>{#if $user}</code> to <code>{#if $user &amp;&amp; emailVerified}</code></p></li><li><p>Add the following before the <code>{:else}</code> line:</p><pre class="language-js"><code class="language-js"><span class="token punctuation">{</span><span class="token operator">:</span><span class="token keyword">else</span> <span class="token keyword">if</span> $user <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>emailVerified<span class="token punctuation">}</span><br>  <span class="token operator">&lt;</span>p<span class="token operator">></span><br>    You have been sent an email containing a link to verify your account<span class="token punctuation">.</span><br>    Please click that link <span class="token keyword">in</span> order to start adding tasks<span class="token punctuation">.</span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span></code></pre></li></ul><p>Now after a user creates a new account, they will see the following:</p><p><img src="/blog/assets/meteor-todo-verify-email-sent.png" alt="Todo App verify email sent"></p><p>The user must must verify their email address by clicking a link in an email they receive like the following before they can start adding tasks.</p><p><img src="/blog/assets/meteor-todo-verify-email.png" alt="Todo App verify email"></p><p>Clicking the link in the email opens a browser tab containing the following:</p><p><img src="/blog/assets/meteor-todo-email-verified.png" alt="Todo App email verified"></p><p>The user can dismiss the dialog and proceed with using the app.</p></li></ol><p>That's it! We now have a functioning Todo app that supports user accounts and tasks are persisted in a database. I can't imagine doing all of this in less code using anything other than Meteor!</p><h3 id="routing" tabindex="-1">Routing</h3><p>For apps that need client-side page routing there are two popular libraries:</p><ul><li><a href="https://github.com/kadirahq/flow-router?v=1.0.21" rel="noopener" target="_blank">FlowRouter</a> (with flow-router-extra) - recommended by the Meteor Guide</li><li><a href="https://github.com/iron-meteor/iron-router?v=1.0.21" rel="noopener" target="_blank">Iron.Router</a></li></ul><p>Typically these are used with the Blaze framework. When using a different web framework such a Svelte or React, routing approaches for those can be used instead.</p><h3 id="meteor-shell" tabindex="-1">Meteor Shell</h3><p>The <code>meteor shell</code> command launches a REPL that is used to examine and interact with the server side of a Meteor app. TODO: How is it used?</p><h3 id="building-and-deploying" tabindex="-1">Building and Deploying</h3><p>Now that we have our app running locally, we are ready to deploy it to a server so real users can access it.</p><h4 id="mongodb-hosting" tabindex="-1">MongoDB Hosting</h4><p>If your Meteor app uses MongoDB, and most do, the first step is to select a hosting platform. One option is <a href="https://www.mongodb.com/cloud/atlas?v=1.0.21" rel="noopener" target="_blank">MongoDB Atlas</a>. Another option is <a href="https://mlab.com/?v=1.0.21" rel="noopener" target="_blank">mLab</a>.</p><p>MongoDB Atlas has an endless free tier referred to as &quot;Shared Clusters&quot; that does not provide backup.</p><p>To configure MongoDB Atlas:</p><ul><li>Browse <a href="https://www.mongodb.com/cloud/atlas?v=1.0.21" rel="noopener" target="_blank">here</a>.</li><li>Choose between AWS, GCP, and Azure for the cloud provider.</li><li>Create a cluster.</li><li>In the left nav. under &quot;SECURITY&quot;, click &quot;Database Access&quot; and press &quot;Add New Database User&quot;.</li><li>Optionally change the default username and password.</li><li>Select &quot;Database User Privileges&quot; from the drop-down. You will likely want &quot;Read and write to any database&quot;.</li><li>Press &quot;Add User&quot;.</li><li>In the left nav. under &quot;SECURITY&quot;, click &quot;Network Access&quot; and press &quot;ADD IP ADDRESS&quot;.</li><li>Enter IP addresses that should have access. You will likely want to add the IP address of your machine AND the IP address of your cloud or Galaxy server.</li></ul><p>To view databases and collections:</p><ul><li>In the left nav. under &quot;DATA STORAGE&quot;, click &quot;Clusters&quot;.</li><li>Press &quot;COLLECTIONS&quot;.</li><li>Select a database names to see the collections in it.</li><li>Select a collection name to see the documents in it.</li><li>Hover over a document and click the pencil icon to modify the document. Press the &quot;UPDATE&quot; button when finished. It can take about five seconds for Meteor apps that use the document to update.</li><li>Hover over a document and click the trash can icon to delete the document.</li></ul><p>To connect from the mongo shell:</p><ul><li>In the left nav. under &quot;DATA STORAGE&quot;, click &quot;Clusters&quot;.</li><li>Press &quot;CONNECT&quot;.</li><li>Click &quot;Connect with the mongo shell&quot;.</li><li>If you do not already have the mongo shell installed, click &quot;I do not have the mongo shell installed&quot; and follow the platform-specific instructions to install it.</li><li>Otherwise, click &quot;I have the mongo shell installed&quot;.</li><li>Press &quot;Copy&quot; after the supplied connection string.</li><li>Open a terminal window.</li><li>Paste the connection string.</li><li>Replace &quot;<dbname>&quot; with the name of an existing database and press return.</dbname></li><li>Enter the password.</li><li>Enter &quot;show collections&quot; to list the collections within the database.</li></ul><p>To connect from the MongoDB Compass app:</p><ul><li>In the left nav. under &quot;DATA STORAGE&quot;, click &quot;Clusters&quot;.</li><li>Press &quot;CONNECT&quot;.</li><li>Click &quot;Connect using MongoDB Compass&quot;.</li><li>If you do not already have MongoDB Compass installed, click &quot;I do not have MongoDB Compass&quot; and follow the platform-specific instructions to install it.</li><li>Otherwise, click &quot;I have MongoDB Compass&quot;.</li><li>Press &quot;Copy&quot; after the supplied connection string.</li><li>Open the MongoDB Compass app.</li><li>Paste the connection string.</li><li>Replace &quot;<password>&quot; with the password and press &quot;CONNECT&quot;.</password></li><li>Click a database name to see the collections inside it.</li></ul><p>For more detail on using MongoDB Atlas with Meteor, see <a href="https://medium.com/@cfnelson/mongodb-atlas-with-meteor-a-step-by-step-guide-da34093665f4">https://medium.com/@cfnelson/mongodb-atlas-with-meteor-a-step-by-step-guide-da34093665f4</a>.</p><h4 id="configuring-a-cloud-server" tabindex="-1">Configuring a Cloud Server</h4><p>There are many options to choose from including AWS, Google Cloud Platform (GCP), and Azure.</p><p>An option that is fairly simple with a low cost is DigitalOcean.</p><p>You will want to associate a domain name with your DigitalOcean server so you can enable SSL encryption later. There are many domain registrars to choose from. A popular, low cost option is <a href="https://hover.com?v=1.0.21" rel="noopener" target="_blank">hover.com</a>. You can also get a free domain name from <a href="https://www.freenom.com/?v=1.0.21" rel="noopener" target="_blank">freenom.com</a>.</p><p>To associate a domain name with a DigitalOcean project, browse <a href="https://cloud.digitalocean.com?v=1.0.21" rel="noopener" target="_blank">cloud.digitalocean.com</a>, sign in, click &quot;Networking&quot; in the left nav., enter a domain for a project, and press &quot;Add Domain&quot;. Then under &quot;Create new record&quot;, select &quot;A&quot;, enter &quot;@&quot; for &quot;HOSTNAME&quot;, enter your DigitalOcean server IP address for &quot;WILL DIRECT TO&quot;, and press &quot;Create Record&quot;. Repeat this using &quot;www&quot; instead of &quot;@&quot; for &quot;HOSTNAME&quot;. You can also create A records from the domain registrar site such as Hover.</p><p>After ssh'ing to your instance for the first time, it is helping to edit your <code>.bashrc</code> file. Some things you may want to add include:</p><pre class="language-bash"><code class="language-bash"><span class="token comment"># Make it easier to clear the screen.</span><br><span class="token builtin class-name">alias</span> <span class="token assign-left variable">cls</span><span class="token operator">=</span><span class="token string">'clear'</span><br><br><span class="token comment"># Ask for confirmation before overwriting or deleting files.</span><br><span class="token builtin class-name">alias</span> <span class="token assign-left variable">cp</span><span class="token operator">=</span><span class="token string">"cp -i"</span><br><span class="token builtin class-name">alias</span> <span class="token assign-left variable">mv</span><span class="token operator">=</span><span class="token string">"mv -i"</span><br><span class="token builtin class-name">alias</span> <span class="token assign-left variable">rm</span><span class="token operator">=</span><span class="token string">"rm -i"</span><br><br><span class="token comment"># Make the delete key work.</span><br><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">TERM</span></span><span class="token operator">=</span>xterm-256color<br><br><span class="token comment"># Set environment variables that the Meteor server will need.</span><br><span class="token builtin class-name">export</span> <span class="token assign-left variable">MONGO_URL</span><span class="token operator">=</span><span class="token string">'{your-mongodb-url}'</span><br><span class="token builtin class-name">export</span> <span class="token assign-left variable">ROOT_URL</span><span class="token operator">=</span>https://<span class="token punctuation">{</span>ip-address-of-this-server<span class="token punctuation">}</span>:<span class="token punctuation">{</span>port-of-meteor-server<span class="token punctuation">}</span></code></pre><p>To find processes that are listening on ports, enter <code>netstat -tulpn</code>. My DigitalOcean server has nginx listening on port 80 and node listening on port 3000. A different port can be used for the Meteor server.</p><p>To enable accessing you MongoDB Atlas server:</p><ul><li>Browse <a href="http://cloud.mongodb.com">cloud.mongodb.com</a> and log in.</li><li>In the left nav. under &quot;SECURITY&quot;, click &quot;Network Access&quot;.</li><li>Press &quot;ADD IP ADDRESS&quot;.</li><li>Add the IP address of your cloud server.</li></ul><p>TODO: mup works now! Try to get it to use HTTPS! TODO: Get Galaxy to work. TODO: Get manual deploy to work.</p><h4 id="enabling-https" tabindex="-1">Enabling HTTPS</h4><p>To determine the version of Ubuntu you are using, enter <code>lsb_release -a</code>. For me this is 20.04.</p><p>DigitalOcean provides an nginx proxy that is started by default.</p><p>To enable nginx to act as a proxy for a server that listens on a particular port:</p><ul><li><p>Enter <code>sudo touch /etc/nginx/conf.d/sysmon.conf</code></p></li><li><p>Enter <code>sudo vim /etc/nginx/conf.d/sysmon.conf</code></p></li><li><p>Add the following:</p><pre class="language-text"><code class="language-text">server {<br>  listen 1919; # node port<br>  server_name sysmon.{your-domain};<br><br>  location / {<br>    proxy_set_header   X-Forwarded-For $remote_addr;<br>    proxy_set_header   Host $http_host;<br>    proxy_pass         http://{node-ip}:{node-port};<br>  }<br>}</code></pre></li><li><p>Enter <code>sudo systemctl restart nginx</code></p></li><li><p>Now you should be able to browse <a href="https://%7Byour-domain%7D:%7Bnode-port%7D">https://{your-domain}:{node-port}</a></p></li><li><p>TODO: THIS DID NOT WORK! There is a probably a conflict with <code>/etc/nginx/sites-available/{your-domain}</code> below.</p></li></ul><p>Setup nginx &quot;server blocks&quot; by following the steps <a href="https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-20-04#step-5-%E2%80%93-setting-up-server-blocks-(recommended)?v=1.0.21" rel="noopener" target="_blank">here</a> which are summaries below:</p><ol><li><p>Enter <code>sudo mkdir -p /var/www/{your-domain}/html</code></p></li><li><p>Enter <code>sudo chown -R $USER:$USER /var/www/{your-domain}/html</code></p></li><li><p>Enter <code>sudo chmod -R 755 /var/www/{your-domain}</code></p></li><li><p>Enter <code>vim /var/www/{your-domain}/html/index.html</code></p></li><li><p>Add content like the following for testing your site:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Welcome to {your-site}!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Success, the {your-site} server block is working!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre></li><li><p>Enter <code>sudo vim /etc/nginx/sites-available/{your-domain}</code></p></li><li><p>Add content like the following to serve your site:</p><pre class="language-text"><code class="language-text">server {<br>  listen 80;<br>  listen [::]:80;<br><br>  root /var/www/your_domain/html;<br>  index index.html index.htm index.nginx-debian.html;<br><br>  server_name your_domain www.your_domain;<br><br>  location / {<br>    try_files $uri $uri/ =404;<br>  }<br>}</code></pre></li><li><p>Enter <code>sudo ln -s /etc/nginx/sites-available/{your-domain} /etc/nginx/sites-enabled/</code></p></li><li><p>Enter <code>sudo vim /etc/nginx/nginx.conf</code></p></li><li><p>Uncomment the line <code>server_names_hash_bucket_size 64;</code></p></li><li><p>Enter <code>sudo nginx -t</code> to verify that there are no syntax errors in the edited files.</p></li><li><p>Enter <code>sudo systemctl restart nginx</code> to restart nginx.</p></li><li><p>Browse <a href="http://%7Byour-domain%7D">http://{your-domain}</a> to verify that nginx can server the earlier HTML.</p></li></ol><p>Enable SSL by following the steps <a href="https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-ubuntu-20-04?v=1.0.21" rel="noopener" target="_blank">here</a>. These instructions specific to Ubuntu version 20.04. It uses a &quot;certbot&quot; which will automatically renew the certificate before it expires.</p><ol><li>Enter <code>sudo apt install python3-certbot-nginx</code></li><li>Enter <code>sudo ufw status</code> to see that network traffic is currently allowed.</li><li>If &quot;Nginx FULL&quot; is not set to &quot;ALLOW&quot; ...<ul><li>Enter <code>sudo ufw allow 'Nginx Full'</code></li><li>Enter <code>sudo ufw delete allow 'Nginx HTTP'</code> because it is implied by <code>Nginx Full</code>.</li></ul></li><li>Enter <code>cd</code> to change to your home directory.</li><li>Enter <code>sudo certbot --nginx -d {your-site} -d www.{your-site}</code> to obtain an SSL certificate. You will be prompted to enter your email, agree to the LetsEncrypt terms of service, optionally receive email from the Electronic Freedom Foundation, and whether HTTP requests should be redirected to HTTPS.</li></ol><p>Your certificate and chain are saved at <code>/etc/letsencrypt/live/{your-site}/fullchain.pem</code>. Your key file is saved at <code>/etc/letsencrypt/live/mvolkmann.site/privkey.pem</code>. Normally your cert will expire in three months any you need to obtain a new version by running the <code>certbot</code> command again with the <code>--certonly</code> option. You can also non-interactively renew all of your certificates by entering <code>certbot renew</code>. But certbot makes this unnecessary and will automatically renew your cert. Make a backup of the <code>/etc/letsencrypt</code> directory.</p><p>You can now browse <code>https://{your-domain}</code>.</p><h4 id="manual-deploy" tabindex="-1">Manual Deploy</h4><p>To build a Meteor app for deployment:</p><ul><li>cd to the root project directory.</li><li>You may need to enter <code>meteor remove-platform ios</code> before running the next command.</li><li>Enter <code>meteor build {dir-name} --architecture {a-name}</code> where <code>{a-name}</code> is replaced by the target architecture such as <code>os.linux.x86_64</code>.</li></ul><p>This creates the specified directory if it doesn't exist and creates a TAR file named <code>{project-name}.tar.gz</code> inside it. The TAR file contains a single directory named <code>bundle</code> which contains all the files for the client-side and server-side of the application.</p><p>For help on the build command, enter <code>meteor help build</code>.</p><p>To deploy the app:</p><ol><li>Copy the TAR file to a server, perhaps using the <code>scp</code> command. For example, <code>scp {project-name}.tar.gz root@{server-ip-address}:.</code></li><li>Start a terminal session on the server using the <code>ssh</code> command. For example, <code>ssh root@{server-ip-address}</code>. (I store the IP address and password in 1Password.)</li><li>Verify that a recent version of Node.js is installed by entering <code>node -v</code>.</li><li>Create a directory to receive the contents of the tar file by entering <code>mkdir {project-name}</code></li><li>Un-tar the file by entering <code>tar zxf {project-name}.tar.gz -C {project-name}</code></li><li>Enter <code>cd {project-name}/bundle/programs/server</code></li><li>Enter <code>npm install</code></li><li>Enter <code>cd ../..</code></li><li>Set the <code>MONGO_URL</code> environment variable to your MongoDB server URL. For example, <code>mongodb+srv://{username}:{password}@{mongo-host}/meteor</code></li><li>Set the <code>ROOT_URL</code> environment variable to your HTTP server URL. For example, <code>http://{server-ip-address}:{server-port}</code> For example, <code>http://{server-ip-address}:4000</code></li><li>Expose the port that will be used. With DigitalOcean this is done by entering <code>sudo ufw allow {port}/tcp</code>. Meteor uses port 3000 by default, but my DigitalOcean instance has an HTTP server that is always listening on that port, so choose another such as 4000.</li><li>Enter <code>node main.js</code> to start the server. TODO: Do you need to do something to tell it to use port 4000 TODO: or does it get that from the ROOT_URL environment variable?</li></ol><p>This gives the error MongoNetworkError: failed to connect to server [<a href="http://cluster0-shard-00-00.tqq7g.mongodb.net:27017">cluster0-shard-00-00.tqq7g.mongodb.net:27017</a>] on first connect [MongoNetworkError: connection 5 to <a href="http://cluster0-shard-00-00.tqq7g.mongodb.net:27017">cluster0-shard-00-00.tqq7g.mongodb.net:27017</a> closed</p><p>Other alternatives for deploying Meteor apps include Galaxy (<a href="https://www.meteor.com/hosting?v=1.0.21" rel="noopener" target="_blank">here</a>) and Meteor Up (<a href="http://meteor-up.com/?v=1.0.21" rel="noopener" target="_blank">here</a>). Meteor Up, a.k.a mup, can be used to deploy a Meteor app to any server to which you can <code>ssh</code>.</p><h4 id="meteor-up-(mup)" tabindex="-1">Meteor Up (mup)</h4><p>Meteor Up uses Docker to deploy Meteor apps.</p><p>The steps to deploy a Meteor app using Meteor Up are:</p><ul><li>Enter <code>npm install -g mup</code></li><li>cd to the root project directory.</li><li>Enter <code>mup init</code> to create the files <code>mup.json</code> and <code>settings.json</code> in the <code>./deploy</code> directory.</li><li>Add <code>.deploy/mup.js</code> and <code>.deploy/settings.json</code> to <code>.gitignore</code>.</li><li>Edit <code>.deploy/mup.js</code>.<ul><li>Set <code>servers.one.host</code> to the IP address of the server.</li><li>Set <code>servers.one.username</code> to an account username, possibly <code>'root'</code>.</li><li>Set <code>servers.one.password</code> to an account password.</li><li>Set <code>app.name</code> to the app name. If you change this value later, you will have to ssh to the server, run <code>docker ps</code> to find the container started for the old name, and stop it with <code>docker stop {container-id}</code> before you can run <code>mup deploy</code> again.</li><li>Set <code>app.path</code> to <code>'../'</code></li><li>Set <code>app.env.ROOT_URL</code> to the app URL. For example, <code>'https://{server-ip-address}:{server-port}'</code> or <code>'https://{domain-name}:{server-port}'</code></li><li>Set <code>app.env.PORT</code> to the value of <code>server-port</code>. The deploy will fail if this port is already in use. Before redeploying the app, kill the existing process that is listening on this port. Also kill the process for MongoDB listening on port 27017.</li><li>Set <code>app.env.MONGO_URL</code> to the URL of your MongoDB server.</li><li>To enable SSL:<ul><li>See <a href="https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-ubuntu-18-04?v=1.0.21" rel="noopener" target="_blank">How to Secure Nginx</a></li><li>This requires a domain name, not just an ip address.</li><li>Set <code>proxy.domains</code> to <code>'https://{server-ip-address}:80'</code>, // nginx proxy</li><li>Set <code>proxy.ssl.forceSSL</code> to <code>true</code>.</li><li>Set <code>proxy.ssl.letsEncryptEmail</code> to <code>'email@domain.com'</code>.</li></ul></li><li>Delete the top-level <code>mongo</code> property.</li></ul></li><li>Enter <code>cd .deploy</code></li><li>Enter <code>mup setup</code></li><li>If you get the error &quot;endpoint mup-nginx-proxy not found&quot;, this is not your first time running <code>mup</code> for this project, and you have made certain changes to your <code>mup.js</code> file, you may need to enter <code>mup stop</code> and <code>mup reconfig</code> instead of <code>mup setup</code>.</li><li>Enter <code>mup deploy</code> (This works in Node 12, but may not yet work in newer versions.)</li></ul><p>If the last step is successful, browse the URL in <code>app.env.ROOT_URL</code>. This defaults to use a MongoDB database named &quot;test&quot;, not &quot;meteor&quot;.</p><h4 id="galaxy" tabindex="-1">Galaxy</h4><p>Galaxy provides a free, one-month trial.</p><p>Galaxy does not provided MongoDB hosting.</p><p>To use Galaxy:</p><ul><li><p>Browse <a href="https://galaxy.meteor.com?v=1.0.21" rel="noopener" target="_blank">galaxy.meteor.com</a></p></li><li><p>Press &quot;SIGN IN WITH METEOR&quot; and authenticate.</p></li><li><p>Create a free trial account</p></li><li><p>Choose a region (ex. &quot;US-East-1&quot;)</p></li><li><p>Open a terminal window and cd to the root project directory.</p></li><li><p>Create the file <code>settings.json</code> containing the following:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"galaxy.meteor.com"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"env"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>      <span class="token property">"MONGO_URL"</span><span class="token operator">:</span> <span class="token string">"mongodb+srv://{username}:{password}@{mongo-host}/meteor"</span><span class="token punctuation">,</span><br>      <span class="token property">"MAIL_URL"</span><span class="token operator">:</span> <span class="token string">"smtp://volkmannm@objectcomputing.com:$&amp;oBDvwWTTms9d6dxYDG@smtp.gmail.com:587"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Add <code>settings.json</code> to <code>.gitignore</code>.</p></li><li><p>Enter <code>DEPLOY_HOSTNAME=us-east-1.galaxy-deploy.meteor.com \</code> <code>meteor deploy {hostname} --settings settings.json</code> where <code>{hostname}</code> can be &quot;{username}.meteorapp.com&quot;.</p></li></ul><p>This will output the following:</p><pre class="language-text"><code class="language-text">Talking to Galaxy servers at {some-url}<br>Preparing to deploy your app...<br>Uploaded app bundle to upgrade {username}.meteorapp.com to version 3.<br>Galaxy is building the app into a native image.<br>Building app image...<br>Deploying app...</code></pre><p>The last step will fail if it cannot connect to the MongoDB server. Note that Galaxy-provided servers have dynamic IP addresses. For this reason, the MongoDB server must accept requests from an IP address range, not specific IP addresses. The free tier of MongoDB Atlas does not support whitelisting IP address ranges, so upgrading to a paid tier is required to connect to it from a Galaxy server.</p><h3 id="creating-meteor-packages" tabindex="-1">Creating Meteor Packages</h3><p>Early in the &quot;Meteor Packages&quot; section we discussed Isopacks which are packages containing code that often can run on the client or server. You can create your own Isopacks. They can existing locally, only for use by your applications. You can also publish them so anyone can use them, similar to npm packages.</p><p>To create an Isopack:</p><ol><li>Register as a Meteor developer. Your username will be the prefix be used to identify packages you author.</li><li>Enter <code>meteor create --package {your-prefix}:{package-name}</code><br>This creates a directory using the package name containing the files <code>README.md</code> (empty), <code>{package-name}.js</code>, <code>{package-name}-tests.js</code>, and <code>package.js</code>.</li><li>Edit <code>{package-name}.js</code> to add functions. Keep the export of the constant <code>name</code>. Add exports of functions, classes, and other values.</li><li>Edit <code>{package-name}-test.js</code> to add tests for code in <code>{package-name}.js</code>.<br>Follow the naming convention used in the example test provided for the package name. The <code>test</code> object passed to each test function supports the following methods for making assertions: <code>equal</code>, <code>notEqual</code>, <code>instanceOf</code>, <code>isTrue</code>, <code>isFalse</code>, <code>isNull</code>, <code>isNotNull</code>, <code>isUndefined</code>, <code>isNan</code>, <code>matches</code>, and <code>length</code>.</li><li>Run tests by entering <code>meteor test-packages ./</code>.<br>The names of tests run in the server are preceded by &quot;S:&quot;. Those run in the client are preceded by &quot;C:&quot;.</li><li>Browse localhost:3000 to see test results.</li><li>Modify code until tests pass. Tests rerun automatically when changes are detected and browser refreshes.</li><li>Create a Git repository for the package.</li><li>Push the code to the Git repository.</li><li>Modify <code>package.js</code> to set version and add summary and git URL.</li><li>Publish the package by entering <code>meteor publish --create</code>.<br>It can take 5-10 minutes for the package to appear on atmosphere.js, but it should be found by <code>meteor search</code> immediately.</li><li>To publish changes after the initial publish, bump the version in <code>package.js</code>, push changes to the Git repository, and enter <code>meteor publish</code>. These changes will appear on atmosphere.js immediately.</li></ol><p>See the earlier &quot;Meteor Packages&quot; section for details on adding the use of packages to a project and importing values from them.</p><h3 id="building-a-mobile-app" tabindex="-1">Building a Mobile App</h3><ul><li>Create a new Meteor app following the steps described earlier.</li><li>See <a href="http://guide.meteor.com/cordova.html#installing-prerequisites">http://guide.meteor.com/cordova.html#installing-prerequisites</a>.</li><li><code>meteor add-platform android</code></li><li><code>meteor add-platform ios</code></li><li><code>meteor run ios</code> to run in a simulator</li><li><code>meteor run android</code> to run in a simulator</li><li><code>meteor run ios-device</code> to run on an iOS device</li><li><code>meteor run android-device</code> to run on an Android device</li></ul><h3 id="resources" tabindex="-1">Resources</h3><ul><li><a href="https://meteor.com/?v=1.0.21" rel="noopener" target="_blank">Meteor home page</a></li><li><a href="https://guide.meteor.com/?v=1.0.21" rel="noopener" target="_blank">Meteor Guide</a></li><li><a href="https://docs.meteor.com/?v=1.0.21" rel="noopener" target="_blank">Meteor API docs</a></li><li><a href="https://github.com/Urigo/awesome-meteor?v=1.0.21" rel="noopener" target="_blank">Awesome Meteor</a> curated list of packages and libraries</li><li><a href="https://atmospherejs.com/?v=1.0.21" rel="noopener" target="_blank">Atmosphere Meteor package repository</a></li><li><a href="https://forums.meteor.com/?v=1.0.21" rel="noopener" target="_blank">Meteor Forum</a></li><li><a href="https://stackoverflow.com/questions/tagged/meteor?v=1.0.21" rel="noopener" target="_blank">Stack Overflow</a></li></ul></article>