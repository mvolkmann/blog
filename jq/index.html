<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>jq</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#resources">Resources</a></li><li><a href="#installing">Installing</a></li><li><a href="#basic-usage">Basic Usage</a></li><li><a href="#filtering">Filtering</a></li><li><a href="#transforming">Transforming</a></li><li><a href="#regular-expressions">Regular Expressions</a></li><li><a href="#sorting">Sorting</a></li><li><a href="#limiting-output">Limiting Output</a></li><li><a href="#grouping">Grouping</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p>JavaScript Object Notation (JSON) is a data format that is frequently returned by API services and read from files. Often all the data is on a single line with no added spaces, so it is not easy for humans to read. The tool <a href="https://stedolan.github.io/jq/?v=1.0.22" rel="noopener" target="_blank">jq</a> helps with this and does much more.</p><p>jq is a command-line JSON processor that is implemented in C.</p><p>The basic functionality of jq is to pretty-print JSON data. But can also filter, sort, and transform JSON data.</p><p>jq is practically a programming language. It has a long list of features including types, conditionals, regular expressions, math functions, custom function definitions, variables, streaming, and more.</p><h2 id="resources" tabindex="-1">Resources</h2><ul><li><a href="https://stedolan.github.io/jq/?v=1.0.22" rel="noopener" target="_blank">jq Home Page</a></li><li><a href="https://earthly.dev/blog/jq-select/?v=1.0.22" rel="noopener" target="_blank">An Introduction to JQ</a> by Adam Gordon Bell</li><li><a href="https://www.youtube.com/watch?v=FSn_38gDvzM&list=PLKaiHc24qCTSOGkkEpeIMupEmnInqHbbV&index=1?v=1.0.22" rel="noopener" target="_blank">Processing JSON in the command-line made easy - jq tutorial (first steps)</a> YouTube video by Szymon Stepniak</li><li><a href="https://www.youtube.com/watch?v=EIhLl9ebeiA&list=PLKaiHc24qCTSOGkkEpeIMupEmnInqHbbV&index=2?v=1.0.22" rel="noopener" target="_blank">Transforming, sorting, and grouping JSON documents in the command-line - jq tutorial</a> YouTube video by Szymon Stepniak</li></ul><h2 id="installing" tabindex="-1">Installing</h2><p>There is a <a href="https://jqplay.org/?v=1.0.22" rel="noopener" target="_blank">web-based UI</a> for jq that can be used as an alternative to installing it locally or just to experiment.</p><p>To install jq in macOX using Homebrew, enter <code>brew install jq</code>. To install jq in other operating systems or use a different approach for installing in macOS, see <a href="https://stedolan.github.io/jq/download/?v=1.0.22" rel="noopener" target="_blank">Download jq</a>.</p><h2 id="basic-usage" tabindex="-1">Basic Usage</h2><p>To pretty-print the contents of a JSON file, enter <code>cat {file-path} | jq</code>.</p><p>Another way to write this is <code>jq . {file-path}</code> The first argument to <code>jq</code> is a filter string. The filter <code>.</code> is the identity filter meaning it keeps the entire contents. The second argument is the path to a JSON file and can be omitted when JSON data is piped into the <code>jq</code> command.</p><p>To pretty-print the response from an API service, enter <code>curl {service-url} | jq</code>. For example, we can view the JSON response from a public API that returns an object where the keys are dog breeds and the values are arrays of variety names.</p><pre class="language-bash"><code class="language-bash"><span class="token function">curl</span> https://dog.ceo/api/breeds/list/all <span class="token operator">|</span> jq</code></pre><p>The structure of the JSON returned is as follows:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"message"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    ...<br>    <span class="token property">"bulldog"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>      <span class="token string">"boston"</span><span class="token punctuation">,</span><br>      <span class="token string">"english"</span><span class="token punctuation">,</span><br>      <span class="token string">"french"</span><br>    <span class="token punctuation">]</span><span class="token punctuation">,</span><br>    ...<br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token property">"status"</span><span class="token operator">:</span> <span class="token string">"success"</span><br><span class="token punctuation">}</span></code></pre><p>To work repeatedly with the same JSON data returned from an API endpoint, consider capturing the data in a local file. For example:</p><pre class="language-bash"><code class="language-bash"><span class="token function">curl</span> https://dog.ceo/api/breeds/list/all <span class="token operator">></span> dogs.json</code></pre><h2 id="filtering" tabindex="-1">Filtering</h2><p><code>jq</code> can filter the JSON data and output a subset.</p><p>To output on the <code>status</code> property, enter <code>jq .status dogs.json</code>. This outputs <code>&quot;success&quot;</code>. Note that double-quotes around string values are included. To output raw values, include the <code>-r</code> flag.</p><p>To get the varieties of the &quot;hound&quot; breed, enter <code>jq -c .message.hound dogs.json</code>. This assumes that the JSON data describes an object rather than an array, finds the top-level property named &quot;message&quot;, assumes its value is an object, and finds the property &quot;hound&quot; inside that object. This outputs the following which is a compact (<code>-c</code>) JSON array.</p><pre class="language-text"><code class="language-text">["afghan","basset","blood","english","ibizan","plott","walker"]</code></pre><p>To get the second variety of the &quot;hound&quot; breed enter <code>jq '.message.hound[1]' dogs.json</code> which outputs <code>&quot;basset&quot;</code>.</p><p><a href="https://openlibrary.org?v=1.0.22" rel="noopener" target="_blank">Open Library</a> supports an API for getting publications whose description contains a given word. For example, the following command captures JSON describing publications related to Svelte which is a web framework.</p><pre class="language-bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">"https://openlibrary.org/search.json?q=svelte"</span> <span class="token operator">></span> publications.json</code></pre><p>The structure of the JSON returned is as follows:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>    <span class="token property">"numFound"</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span><br>    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>    <span class="token property">"numFoundExact"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>    <span class="token property">"docs"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>        ... publication objects go here ...<br>    <span class="token punctuation">]</span><span class="token punctuation">,</span><br>    <span class="token property">"num_found"</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span><br>    <span class="token property">"q"</span><span class="token operator">:</span> <span class="token string">"Svelte"</span><span class="token punctuation">,</span><br>    <span class="token property">"offset"</span><span class="token operator">:</span> <span class="token null keyword">null</span><br><span class="token punctuation">}</span></code></pre><p>Each publication in the <code>docs</code> array is described similar to the following:</p><pre class="language-json"><code class="language-json">        <span class="token punctuation">{</span><br>            <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"/works/OL21909240W"</span><span class="token punctuation">,</span><br>            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"work"</span><span class="token punctuation">,</span><br>            <span class="token property">"seed"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>                <span class="token string">"/books/OL36011260M"</span><span class="token punctuation">,</span><br>                <span class="token string">"/books/OL29882427M"</span><span class="token punctuation">,</span><br>                <span class="token string">"/works/OL21909240W"</span><span class="token punctuation">,</span><br>                <span class="token string">"/subjects/mathematics"</span><span class="token punctuation">,</span><br>                <span class="token string">"/authors/OL8370536A"</span><br>            <span class="token punctuation">]</span><span class="token punctuation">,</span><br>            <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Svelte and Sapper in Action"</span><span class="token punctuation">,</span><br>            <span class="token property">"title_suggest"</span><span class="token operator">:</span> <span class="token string">"Svelte and Sapper in Action"</span><span class="token punctuation">,</span><br>            <span class="token property">"edition_count"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><br>            <span class="token property">"edition_key"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>                <span class="token string">"OL36011260M"</span><span class="token punctuation">,</span><br>                <span class="token string">"OL29882427M"</span><br>            <span class="token punctuation">]</span><span class="token punctuation">,</span><br>            <span class="token property">"publish_date"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>                <span class="token string">"2020"</span><br>            <span class="token punctuation">]</span><span class="token punctuation">,</span><br>            <span class="token property">"publish_year"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>                <span class="token number">2020</span><br>            <span class="token punctuation">]</span><span class="token punctuation">,</span><br>            <span class="token property">"first_publish_year"</span><span class="token operator">:</span> <span class="token number">2020</span><span class="token punctuation">,</span><br>            <span class="token property">"number_of_pages_median"</span><span class="token operator">:</span> <span class="token number">475</span><span class="token punctuation">,</span><br>            <span class="token property">"lcc"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>                <span class="token string">"QA-0076.76000000.A65"</span><br>            <span class="token punctuation">]</span><span class="token punctuation">,</span><br>            <span class="token property">"isbn"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>                <span class="token string">"9781638350682"</span><span class="token punctuation">,</span><br>                <span class="token string">"163835068X"</span><span class="token punctuation">,</span><br>                <span class="token string">"9781617297946"</span><span class="token punctuation">,</span><br>                <span class="token string">"1617297941"</span><br>            <span class="token punctuation">]</span><span class="token punctuation">,</span><br>            <span class="token property">"last_modified_i"</span><span class="token operator">:</span> <span class="token number">1677546021</span><span class="token punctuation">,</span><br>            <span class="token property">"ebook_count_i"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>            <span class="token property">"ebook_access"</span><span class="token operator">:</span> <span class="token string">"no_ebook"</span><span class="token punctuation">,</span><br>            <span class="token property">"has_fulltext"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>            <span class="token property">"public_scan_b"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>            <span class="token property">"publisher"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>                <span class="token string">"Manning Publications Co. LLC"</span><span class="token punctuation">,</span><br>                <span class="token string">"Manning Publications Company"</span><span class="token punctuation">,</span><br>                <span class="token string">"Manning Publications"</span><br>            <span class="token punctuation">]</span><span class="token punctuation">,</span><br>            <span class="token property">"language"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>                <span class="token string">"eng"</span><br>            <span class="token punctuation">]</span><span class="token punctuation">,</span><br>            <span class="token property">"author_key"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>                <span class="token string">"OL8370536A"</span><br>            <span class="token punctuation">]</span><span class="token punctuation">,</span><br>            <span class="token property">"author_name"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>                <span class="token string">"Mark Volkmann"</span><br>            <span class="token punctuation">]</span><span class="token punctuation">,</span><br>            <span class="token property">"subject"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>                <span class="token string">"Mathematics"</span><br>            <span class="token punctuation">]</span><span class="token punctuation">,</span><br>            <span class="token property">"publisher_facet"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>                <span class="token string">"Manning Publications"</span><span class="token punctuation">,</span><br>                <span class="token string">"Manning Publications Co. LLC"</span><span class="token punctuation">,</span><br>                <span class="token string">"Manning Publications Company"</span><br>            <span class="token punctuation">]</span><span class="token punctuation">,</span><br>            <span class="token property">"subject_facet"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>                <span class="token string">"Mathematics"</span><br>            <span class="token punctuation">]</span><span class="token punctuation">,</span><br>            <span class="token property">"_version_"</span><span class="token operator">:</span> <span class="token number">1759034499007512577</span><span class="token punctuation">,</span><br>            <span class="token property">"lcc_sort"</span><span class="token operator">:</span> <span class="token string">"QA-0076.76000000.A65"</span><span class="token punctuation">,</span><br>            <span class="token property">"author_facet"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>                <span class="token string">"OL8370536A Mark Volkmann"</span><br>            <span class="token punctuation">]</span><span class="token punctuation">,</span><br>            <span class="token property">"subject_key"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>                <span class="token string">"mathematics"</span><br>            <span class="token punctuation">]</span><br>        <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><p>To get only the publications where the author name includes &quot;Volkmann&quot; we can use the <code>select</code> and <code>contains</code> functions as follows where <code>docs</code> is a top-level property in the input JSON whose value is an array of publication objects.</p><pre class="language-bash"><code class="language-bash">jq <span class="token string">'[.docs[] | select(.author_name[0] | contains("Volkmann"))]'</span> publications.json</code></pre><h2 id="transforming" tabindex="-1">Transforming</h2><p>jq can transform the JSON data given to it into different data that may or may not use JSON syntax.</p><p>Many of the examples below create new files whose names begin with <code>pub</code>. It is not necessary to create multiple intermediate files. All the <code>jq</code> syntax shown can be combined into one long filter string to perform all the processing in a single use of the <code>jq</code> command.</p><p>We can transform the <code>publication.json</code> file above into a JSON array of objects that only provide the <code>date</code>, <code>author</code>, and <code>title</code> of each publication. The publication objects in the input JSON have <code>publish_date</code> and <code>author_name</code> properties whose values are arrays. We only care about the first element and we want to rename those properties to <code>date</code> and <code>author</code>. Wrapping the entire filter expression in square brackets causes a JSON array to be output. The expression <code>.docs[]</code> get the elements in the <code>docs</code> property array. The part in curly braces after the pipe operator creates new JSON objects containing the specified properties.</p><pre class="language-bash"><code class="language-bash">jq <span class="token string">'[.docs[] | {date: .publish_date[0], author: .author_name[0], title}]'</span> publications.json <span class="token operator">></span> pub1.json</code></pre><p>The output will begin as follows:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"date"</span><span class="token operator">:</span> <span class="token string">"2018"</span><span class="token punctuation">,</span><br>    <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">"Chris Whyatt"</span><span class="token punctuation">,</span><br>    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Svelt"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"date"</span><span class="token operator">:</span> <span class="token string">"2021"</span><span class="token punctuation">,</span><br>    <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">"Alex Libby"</span><span class="token punctuation">,</span><br>    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Practical Svelte"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><p>If any of the <code>date</code> properties have a <code>null</code> value, we can filter out those publications using the <code>select</code> function as follows where <code>.[]</code> represents the set of elements in the top-level array:</p><pre class="language-bash"><code class="language-bash">jq <span class="token string">'[.[] | select(.date != null)]'</span> pub1.json <span class="token operator">></span> pub2.json</code></pre><h2 id="regular-expressions" tabindex="-1">Regular Expressions</h2><p>jq provides several functions that take regular expressions as arguments. These include <code>capture</code>, <code>gsub</code>, <code>match</code>, <code>scan</code>, <code>split</code>, <code>splits</code>, <code>sub</code>, and <code>test</code>.</p><p>Some of the dates in the JSON file above only specify a year while others also specify a month and day. To transform all the dates to only include the year we can use the <code>scan</code> function as follows. This keeps only the last four characters which should be the year. For example, &quot;February 1, 2002&quot; will be replaced by &quot;2002&quot;.</p><pre class="language-bash"><code class="language-bash">jq <span class="token string">'[.[] | {year: .date | scan("\\d{4}$"), author, title}]'</span> pub2.json <span class="token operator">></span> pub3.json</code></pre><h2 id="sorting" tabindex="-1">Sorting</h2><p>To sort the objects on their <code>date</code> in reverse order we can use the <code>sort_by</code> function as follows where <code>.</code> represents the top-level array:</p><pre class="language-bash"><code class="language-bash">jq <span class="token string">'. | sort_by(.year) | reverse'</span> pub3.json <span class="token operator">></span> pub4.json</code></pre><h2 id="limiting-output" tabindex="-1">Limiting Output</h2><p>We can limit the number of array elements to be output. For example, adding <code>| [limit(3; .[])]</code> only outputs data for the first three publications. The <code>.[]</code> part specifies what we want to limit which in this case is the top-level array. The square brackets around the call to the <code>limit</code> function cause it to output a JSON array rather than just a set of objects.</p><pre class="language-bash"><code class="language-bash">jq <span class="token string">'limit(3; .[])'</span> pub4.json</code></pre><h2 id="grouping" tabindex="-1">Grouping</h2><p>We can group objects based a common property value. For example, adding <code>| group_by(.date)</code>.</p><pre class="language-bash"><code class="language-bash">jq <span class="token string">'group_by(.year)'</span> pub4.json <span class="token operator">></span> pub5.json</code></pre><p>The output will begin as follows:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>  <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"year"</span><span class="token operator">:</span> <span class="token string">"1852"</span><span class="token punctuation">,</span><br>      <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">"Luigi Canina"</span><span class="token punctuation">,</span><br>      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Particolare genere di architettura proprio degli usi domestici"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"year"</span><span class="token operator">:</span> <span class="token string">"1852"</span><span class="token punctuation">,</span><br>      <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">"Luigi Canina"</span><span class="token punctuation">,</span><br>      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Particolare genere di architettura domestica"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"year"</span><span class="token operator">:</span> <span class="token string">"1852"</span><span class="token punctuation">,</span><br>      <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">"Luigi Canina"</span><span class="token punctuation">,</span><br>      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Particolare genere di architettura domestica"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"year"</span><span class="token operator">:</span> <span class="token string">"1959"</span><span class="token punctuation">,</span><br>      <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">"Ben Weider"</span><span class="token punctuation">,</span><br>      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Mangez bien et restez svelte"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span></code></pre><p>Now that the publications are grouped by date, we can output the number of publications in each year. The date for each group can be obtained from the <code>date</code> property of the first element in each group array using the syntax <code>.[0].year</code>. The number of elements in each group can be obtained using the syntax <code>. | length</code>. Each of the objects in the resulting JSON array will have <code>year</code> and <code>count</code> properties. We can sort them on <code>year</code> in descending order with <code>| sort_by(.year) | reverse</code>.</p><pre class="language-bash"><code class="language-bash">jq <span class="token string">'[.[] | {year: .[0].year, count: . | length}] | sort_by(.year) | reverse'</span> pub5.json</code></pre><p>The output will begin as follows:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"year"</span><span class="token operator">:</span> <span class="token string">"2023"</span><span class="token punctuation">,</span><br>    <span class="token property">"count"</span><span class="token operator">:</span> <span class="token number">2</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    <span class="token property">"year"</span><span class="token operator">:</span> <span class="token string">"2022"</span><span class="token punctuation">,</span><br>    <span class="token property">"count"</span><span class="token operator">:</span> <span class="token number">1</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></article>