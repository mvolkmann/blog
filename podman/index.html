<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Podman</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#installing-in-macos">Installing in macOS</a></li><li><a href="#names">Names</a></li><li><a href="#images">Images</a></li><li><a href="#containers">Containers</a></li><li><a href="#finding-available-containers">Finding Available Containers</a></li><li><a href="#executable-example">Executable Example</a></li><li><a href="#node.js-example">Node.js Example</a></li></ol></nav></aside><article><style>img {
    border: 1px solid gray;
  }</style><h2 id="overview" tabindex="-1">Overview</h2><p><a href="https://podman.io?v=1.1.1" rel="noopener" target="_blank">podman</a> is a tool for working with software containers and Kubernetes. It is a popular alternative to Docker.</p><h2 id="installing-in-macos" tabindex="-1">Installing in macOS</h2><ul><li>If you previously installed the &quot;Podman Desktop&quot; app, delete it.</li><li>If you previously installed podman using Homebrew, enter <code>brew uninstall podman</code>.</li><li>Delete any existing <code>podman</code> executables in your PATH by repeatedly entering <code>which podman</code> and deleting the file that finds.</li><li>Download the installer for the podman CLI from <a href="https://podman.io">https://podman.io</a>.</li><li>Run that installer.</li><li><code>podman machine init</code></li><li><code>podman machine start</code></li><li><code>podman info</code></li></ul><h2 id="names" tabindex="-1">Names</h2><p>The names of images and containers are composed of three parts and have the syntax <code>{registry}/{repository}:{tag}</code>.</p><p>When an image or container is downloaded from the web, the <code>{registry}</code> part indicates the source code registry it came from&quot;.</p><p>When an image or container is created locally and the <code>{registry}</code> part cannot be specified and defaults to &quot;localhost&quot;.</p><p>The tag can be used to identify multiple versions of an image or container. When <code>:{tag}</code> part is omitted, it defaults to &quot;latest&quot;.</p><h2 id="images" tabindex="-1">Images</h2><p>To build an image using the <code>Dockerfile</code> file in the current directory, enter <code>podman build -t {image-name} .</code> The <code>.</code> at the end indicates that the file <code>Dockerfile</code> can be found in the current directory.</p><p>To list all the images created on your machine, enter <code>podman images</code>.</p><p>To delete an image, enter <code>podman rmi {name-or-id}</code>. If a name is specified, it must match the pattern <code>{registry}/{repository}:{tag}</code> or <code>{registry}/{repository}</code> if no tag was specified when it was created. Attemtping to delete an image will fail if it is being used by an existing container.</p><h2 id="containers" tabindex="-1">Containers</h2><p>To create a container using a given image, enter the following command:</p><pre class="language-bash"><code class="language-bash"><span class="token function">podman</span> create <span class="token parameter variable">--name</span> <span class="token punctuation">{</span>container-name<span class="token punctuation">}</span> <span class="token punctuation">{</span>image-name<span class="token punctuation">}</span>"</code></pre><p>Often the container exposes a given port (container-port) and you want to map that to port on your machine (host-port). This is done by adding the flag <code>-p {host-port}:{container-port}</code> to the previous command. Typically <code>host-port</code> and <code>container-port</code> are the same.</p><p>To list all the containers created on your machine, enter <code>podman ps -a</code> (for all) or <code>podman container list -a</code>.</p><p>To start a container, enter <code>podman start {name-or-id}</code>.</p><p>To stop a running container, enter <code>podman stop {name-or-id}</code>. This can take around 10 seconds.</p><p>To delete a container, enter <code>podman rm {name-or-id}</code>. This will fail if the container is running.</p><p>To create and run a container using a given image in a single command, enter the following command:</p><pre class="language-bash"><code class="language-bash"><span class="token function">podman</span> run <span class="token parameter variable">--name</span> <span class="token punctuation">{</span>container-name<span class="token punctuation">}</span> <span class="token punctuation">{</span>image-name<span class="token punctuation">}</span>"</code></pre><p>Add the <code>--rm</code> flag to delete the container after it runs.</p><p>Add the <code>-d</code> flag to run the container in detached mode (in the background). When not running in detached mode, the process cannot be stopped by pressing ctrl-c. Instead, open another terminal and enter <code>podman stop {name-or-id}</code>.</p><h2 id="finding-available-containers" tabindex="-1">Finding Available Containers</h2><p><code>podman search docker.io/busybox</code></p><h2 id="executable-example" tabindex="-1">Executable Example</h2><ol><li><p>Create a new directory and cd into it.</p></li><li><p>Create the file <code>script.sh</code> containing the following:</p><pre class="language-bash"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span><br><span class="token builtin class-name">echo</span> <span class="token string">"Hello, World!"</span></code></pre></li><li><p>Enter <code>chmod a+x script.sh</code> to make it executable.</p></li><li><p>Enter <code>. ./script.sh</code> to test the script.</p></li><li><p>Create the file <code>Docker</code> containing the following:</p><pre class="language-docker"><code class="language-docker"><span class="token comment"># Use a lightweight base image.</span><br><span class="token instruction"><span class="token keyword">FROM</span> alpine:latest</span><br><br><span class="token comment"># Set the working directory in the container</span><br><span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span><br><br><span class="token comment"># Copy the local executable (a script here) into the image.</span><br><span class="token instruction"><span class="token keyword">COPY</span> script.sh /app/script.sh</span><br><br><span class="token comment"># Give execute permission to the executable.</span><br><span class="token instruction"><span class="token keyword">RUN</span> chmod +x /app/script.sh</span><br><br><span class="token comment"># Set the default command to run the executable</span><br><span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">"/app/script.sh"</span>]</span></code></pre></li><li><p>Build an image by entering the following:</p><pre class="language-bash"><code class="language-bash"><span class="token function">podman</span> build <span class="token parameter variable">-t</span> podman-executable-image <span class="token builtin class-name">.</span></code></pre></li><li><p>Create a container by entering the following:</p><pre class="language-bash"><code class="language-bash"><span class="token function">podman</span> create <span class="token parameter variable">--name</span> podman-executable-container podman-executable-image</code></pre></li><li><p>Start the container by entering the follwoing:</p><pre class="language-bash"><code class="language-bash"><span class="token function">podman</span> start podman-executable-container</code></pre></li><li><p>View the output by entering the following:</p><pre class="language-bash"><code class="language-bash"><span class="token function">podman</span> logs podman-executable-container</code></pre></li></ol><h2 id="node.js-example" tabindex="-1">Node.js Example</h2><ol><li><p>Create a new directory and cd into it.</p></li><li><p>Enter <code>npm init</code> to create a <code>package.json</code> file.</p></li><li><p>Add the following scripts in <code>package.json</code>:</p><pre class="language-json"><code class="language-json"><span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"podman build -t podman-node-image ."</span><span class="token punctuation">,</span><br><span class="token property">"run"</span><span class="token operator">:</span> <span class="token string">"podman run -d -p 3000:3000 --name podman-node-container podman-node-image"</span></code></pre></li><li><p>Create the file <code>index.js</code> containing the following:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span><br>  res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/plain'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'Hello, Podman!\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Server running on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Create the file <code>Docker</code> containing the following:</p><pre class="language-docker"><code class="language-docker"><span class="token comment"># Use an official Node.js runtime as a parent image.</span><br><span class="token instruction"><span class="token keyword">FROM</span> node:latest</span><br><br><span class="token comment"># Set the working directory in the container.</span><br><span class="token instruction"><span class="token keyword">WORKDIR</span> /usr/src/app</span><br><br><span class="token comment"># Copy package.json and package-lock.json if they exist.</span><br><span class="token instruction"><span class="token keyword">COPY</span> package*.json ./</span><br><br><span class="token comment"># Install application dependencies.</span><br><span class="token instruction"><span class="token keyword">RUN</span> npm install</span><br><br><span class="token comment"># Copy the rest of the application code.</span><br><span class="token instruction"><span class="token keyword">COPY</span> . .</span><br><br><span class="token comment"># Expose the port the app listens on.</span><br><span class="token instruction"><span class="token keyword">EXPOSE</span> 3000</span><br><br><span class="token comment"># Define the command to run the app.</span><br><span class="token instruction"><span class="token keyword">CMD</span> [ <span class="token string">"node"</span>, <span class="token string">"index.js"</span> ]</span></code></pre></li><li><p>Enter <code>npm run build</code> to build the image.</p></li><li><p>Enter <code>npm run</code> to run the image in a container.</p></li></ol></article>