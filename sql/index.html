<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>SQL</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#comments">Comments</a></li><li><a href="#data-definition-language-(ddl)">Data Definition Language (DDL)</a></li><li><a href="#data-manipulation-language-(dml)">Data Manipulation Language (DML)</a></li><li><a href="#sequences">Sequences</a></li><li><a href="#joins">Joins</a></li><li><a href="#common-operations">Common Operations</a><ol><li><a href="#get-last-auto-increment-key">Get last auto-increment key</a></li><li><a href="#get-number-of-rows-in-a-table">Get number of rows in a table</a></li><li><a href="#check-for-duplicate-rows">Check for duplicate rows</a></li><li><a href="#get-current-date%2Ftime">Get current date/time</a></li></ol></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p>Structured Query Language (SQL) is used to interact with relational databases.</p><h2 id="comments" tabindex="-1">Comments</h2><p>Single line comments begin with <code>--</code>.</p><p>Multi-line comments are delimited with <code>/* ... */</code>.</p><h2 id="data-definition-language-(ddl)" tabindex="-1">Data Definition Language (DDL)</h2><p>To create a table:</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> {<span class="token keyword">table</span><span class="token operator">-</span>name} <span class="token punctuation">(</span><br>  {<span class="token keyword">column</span><span class="token operator">-</span>name} {<span class="token keyword">type</span>} {modifiers}<span class="token punctuation">,</span><br>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><br><span class="token punctuation">)</span></code></pre><p>To delete a table:</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">drop</span> <span class="token keyword">table</span> {<span class="token keyword">table</span><span class="token operator">-</span>name}</code></pre><p>To add a column:</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> {<span class="token keyword">table</span><span class="token operator">-</span>name}<br><span class="token keyword">add</span> <span class="token keyword">column</span> {<span class="token keyword">column</span><span class="token operator">-</span>name} {<span class="token keyword">type</span>} {modifiers}</code></pre><p>To delete a column:</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> {<span class="token keyword">table</span><span class="token operator">-</span>name}<br><span class="token keyword">drop</span> <span class="token keyword">column</span> {<span class="token keyword">column</span><span class="token operator">-</span>name}</code></pre><h2 id="data-manipulation-language-(dml)" tabindex="-1">Data Manipulation Language (DML)</h2><p>To insert a row:</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> {<span class="token keyword">table</span><span class="token operator">-</span>name}<br><span class="token punctuation">(</span>{<span class="token keyword">column</span><span class="token operator">-</span>name}<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><br><span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span></code></pre><p>To modify rows:</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">update</span> {<span class="token keyword">table</span><span class="token operator">-</span>name}<br><span class="token keyword">set</span> {<span class="token keyword">column</span><span class="token operator">-</span>name}<span class="token operator">=</span>{<span class="token keyword">value</span>}<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><br><span class="token keyword">where</span> {condition}</code></pre><p>For example (in SQL Server):</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">update</span> some_table<br><span class="token keyword">set</span> end_date <span class="token operator">=</span> cast<span class="token punctuation">(</span><span class="token string">'10/31/2014'</span> <span class="token keyword">as</span> <span class="token keyword">datetime</span><span class="token punctuation">)</span><br><span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">19</span></code></pre><p>An upsert inserts a row if not present and updates a row if present.</p><p>To upsert rows:</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> {<span class="token keyword">table</span><span class="token operator">-</span>name}<br><span class="token punctuation">(</span>{<span class="token keyword">column</span><span class="token operator">-</span>name}<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><br><span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><br><span class="token keyword">on</span> <span class="token keyword">duplicate</span> <span class="token keyword">key</span> <span class="token keyword">update</span><br><span class="token keyword">column</span><span class="token operator">-</span>name<span class="token operator">-</span><span class="token number">1</span> <span class="token operator">=</span> v1<span class="token punctuation">,</span><br><span class="token keyword">column</span><span class="token operator">-</span>name<span class="token operator">-</span><span class="token number">2</span> <span class="token operator">=</span> v2<span class="token punctuation">,</span><br><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><p>To delete rows:</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">delete</span> <span class="token keyword">from</span> {<span class="token keyword">table</span><span class="token operator">-</span>name} <span class="token keyword">where</span> {condition}</code></pre><p>To select rows:</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token punctuation">[</span><span class="token keyword">unique</span><span class="token punctuation">]</span> {<span class="token keyword">column</span><span class="token operator">-</span>name}<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><br><span class="token keyword">from</span> {<span class="token keyword">table</span><span class="token operator">-</span>name}<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><br><span class="token keyword">where</span> {condition}<br><span class="token keyword">order</span> <span class="token keyword">by</span> {<span class="token keyword">column</span><span class="token operator">-</span>name}<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><p>The <code>where</code> and <code>order</code> by clauses are optional. The <code>where</code> clause can use <code>like</code> for wildcard matching</p><ul><li><code>%</code> matches any number of characters including zero</li><li><code>_</code> matches any single character</li><li>for example, <code>select age from people where lastname like 'V_lk%';</code></li></ul><p>To find records where a given column is or isn't null, use <code>{column-name} IS NULL</code> or <code>{column-name} IS NOT NULL</code>.</p><p>When selecting from more than one table (a join), select columns are prefixed by a table alias and can have their own alias to avoid name conflicts. For example;</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> n<span class="token punctuation">.</span>namespace <span class="token keyword">as</span> namespace<br><span class="token keyword">from</span> Element e<span class="token punctuation">,</span> Namespace n<br><span class="token keyword">where</span> e<span class="token punctuation">.</span>sourceFileID <span class="token operator">=</span> <span class="token number">253</span> <span class="token operator">and</span><br>e<span class="token punctuation">.</span>namespaceID <span class="token operator">=</span> n<span class="token punctuation">.</span>id</code></pre><p>The number of rows returned can be limited, but the syntax is database-specific. In Postgres and MySQL, add <code>limit {n}</code> to the end of the <code>select</code>.</p><h2 id="sequences" tabindex="-1">Sequences</h2><p>Sequences are used to assign sequential ids to new rows. To reset a sequence:</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">alter</span> sequence {sequence<span class="token operator">-</span>name} restart <span class="token keyword">with</span> <span class="token number">1</span></code></pre><h2 id="joins" tabindex="-1">Joins</h2><p>A join returns column values from two tables based on matching a column value in one table with a column value in another.</p><p>There are many kinds of joins.</p><figure style="width: 75%"><img alt="SQL joins" src="/blog/assets/sql-joins.jpg?v=1.1.1"><figcaption>SQL joins by @ezekiel_aleke</figcaption></figure><ul><li><p>inner</p><p>This is the most common kind of join and is the default kind. It finds the intersection between two tables. It only returns rows in the first table that have a corresponding row in the second table. Rows in the first table will be returned once for each matching row in the second table.</p><p>For example:</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> e<span class="token punctuation">.</span>name <span class="token keyword">as</span> eName<span class="token punctuation">,</span> s<span class="token punctuation">.</span>filename <span class="token keyword">as</span> sName<br><span class="token keyword">from</span> Element e<span class="token punctuation">,</span> SourceFile s<br><span class="token keyword">where</span> e<span class="token punctuation">.</span>sourceFileID <span class="token operator">=</span> s<span class="token punctuation">.</span>id<br><span class="token keyword">order</span> <span class="token keyword">by</span> eName</code></pre><p>The names <code>eName</code> and <code>sName</code> can be used to retrieve those columns from the rows in the result set.</p></li><li><p>left outer</p><p>This returns all rows in the first table plus matching rows in the second table or null values if there are no matching rows.</p></li><li><p>right outer</p><p>This returns all rows in the second table plus matching rows in the first table or null values if there are no matching rows.</p></li><li><p>full outer</p><p>This returns all rows from both tables with matching rows from the other table or null values if there are no matching rows. Some databases don't support this kind of join.</p></li><li><p>cross</p><p>This returns the cartesian product (all possible combinations) of rows from two tables.</p></li></ul><p>For more detail, see <a href="http://en.wikipedia.org/wiki/Join_(SQL)?v=1.1.1" rel="noopener" target="_blank">Wikipedia</a>.</p><h2 id="common-operations" tabindex="-1">Common Operations</h2><h3 id="get-last-auto-increment-key" tabindex="-1">Get last auto-increment key</h3><p>When keys are automatically assigned from a sequence as new rows are added, the last key assigned in the current process can be obtained using <code>currval()</code>. The steps to do this are:</p><ol><li><code>select currval('sequence_name') as id</code></li><li>Advance to the first row in the result set that is returned.</li><li>Get the integer value of the column named &quot;id&quot;.</li></ol><h3 id="get-number-of-rows-in-a-table" tabindex="-1">Get number of rows in a table</h3><p>The steps to do this are:</p><ol><li><code>select COUNT(\*) as count from table-name</code></li><li>Get value of 'count' as an integer.</li></ol><h3 id="check-for-duplicate-rows" tabindex="-1">Check for duplicate rows</h3><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> col1<span class="token punctuation">,</span> col2<span class="token punctuation">,</span> col3<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token keyword">table</span><span class="token operator">-</span>name<br><span class="token keyword">group</span> <span class="token keyword">by</span> col1<span class="token punctuation">,</span> col2<span class="token punctuation">,</span> col3<br><span class="token keyword">having</span> <span class="token function">count</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span></code></pre><h3 id="get-current-date%2Ftime" tabindex="-1">Get current date/time</h3><p>The steps to do this are:</p><ol><li><code>select CURRENT_DATE from dual</code></li><li>Retrieve the string value of 'CURRENT_DATE' from the result set.</li></ol></article>