<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>IndexedDB</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#storage-quotas">Storage Quotas</a></li><li><a href="#devtools">DevTools</a></li><li><a href="#indexeddb-interfaces">IndexedDB Interfaces</a><ol><li><a href="#idbfactory">IDBFactory</a><ol><li><a href="#open-database">open database</a></li><li><a href="#delete-database">delete database</a></li></ol></li><li><a href="#idbdatabase">IDBDatabase</a><ol><li><a href="#create-store">create store</a></li><li><a href="#delete-store">delete store</a></li><li><a href="#create-transaction">create transaction</a></li><li><a href="#close-connection">close connection</a></li></ol></li><li><a href="#idbtransaction">IDBTransaction</a><ol><li><a href="#get-existing-store">get existing store</a></li><li><a href="#delete-existing-store">delete existing store</a></li><li><a href="#commit-transaction">commit transaction</a></li><li><a href="#abort-transaction-(rolls-back)">abort transaction (rolls back)</a></li><li><a href="#listen-for-events">listen for events</a></li></ol></li><li><a href="#idbobjectstore">IDBObjectStore</a><ol><li><a href="#add-record-to-store">add record to store</a></li><li><a href="#delete-all-records-from-store">delete all records from store</a></li><li><a href="#get-number-of-records-in-store">get number of records in store</a></li><li><a href="#create-index-for-store">create index for store</a></li><li><a href="#delete-records">delete records</a></li><li><a href="#delete-index">delete index</a></li><li><a href="#get-record-with-key">get record with key</a></li><li><a href="#get-records">get records</a></li><li><a href="#get-keys">get keys</a></li><li><a href="#open-index-over-all-records">open index over all records</a></li><li><a href="#open-cursor-over-records-in-a-key-range">open cursor over records in a key range</a></li><li><a href="#open-cursor-to-iterate-over-keys-in-a-key-range">open cursor to iterate over keys in a key range</a></li><li><a href="#upsert-a-record">upsert a record</a></li></ol></li><li><a href="#idbrequest">IDBRequest</a></li><li><a href="#idbcursor">IDBCursor</a><ol><li><a href="#iterate-over-all-records">iterate over all records</a></li><li><a href="#get-store-or-index-associated-with-cursor">get store or index associated with cursor</a></li><li><a href="#get-key-of-current-record">get key of current record</a></li><li><a href="#get-request-that-created-cursor">get request that created cursor</a></li><li><a href="#advance-to-next-record">advance to next record</a></li><li><a href="#advance-to-record-with-given-key">advance to record with given key</a></li><li><a href="#delete-referenced-record">delete referenced record</a></li><li><a href="#update-referenced-record">update referenced record</a></li></ol></li><li><a href="#idbindex">IDBIndex</a></li><li><a href="#idbkeyrange">IDBKeyRange</a><ol><li><a href="#test-if-a-key-is-in-range">test if a key is in range</a></li></ol></li></ol></li><li><a href="#crud-example">CRUD Example</a></li></ol></nav></aside><article><style>img {
    border: 1px solid gray;
  }</style><p><img alt="PWA logo" style="border: none; width: 30%" src="/blog/assets/pwa-logo.svg?v=1.1.1" title="PWA logo"></p><h2 id="overview" tabindex="-1">Overview</h2><p><a href="https://www.w3.org/TR/IndexedDB/?v=1.1.1" rel="noopener" target="_blank">IndexedDB</a> is a JavaScript-based, object-oriented database that is supported by modern web browsers.</p><p>Unlike relational databases that are composed of tables with records that are composed of columns, IndexedDB databases are composed of stores that hold records with properties.</p><p>Objects within stores can be retrieved by their key, and by optional indexes.</p><p>Modifications occur within transactions that can be committed or rolled back.</p><p>All accesses to IndexedDB databases are performed asynchronously, so they do not impact the interactivity of a web application by blocking the main thread.</p><h2 id="storage-quotas" tabindex="-1">Storage Quotas</h2><p>The storage quota available to IndexedDB varies based on the web browser being used and the total amount of storage on the device.</p><p>In Chrome and Chromium-based browsers (including Edge), each domain (or origin) can use up to 60% of total storage space. For example, on a phone with 128 GB of memory, a maximum of 76.8 GB can be used per domain. The available memory is typically much lower due to the operating system and applications consuming a large part of the memory.</p><p>In Safari, each domain can use up to 20% of the total storage space. If a PWA is saved to the home screen, the limit is increased to 60% of the total storage space. There is also a quota of 80% of the total storage space across all domains.</p><p>Web applications can obtain an estimate of the storage space available to their domain with the following:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> estimate <span class="token operator">=</span> <span class="token keyword">await</span> navigator<span class="token punctuation">.</span>storage<span class="token punctuation">.</span><span class="token function">estimate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The <code>estimate</code> variable holds an object with three properties. The <code>quota</code> property gives the maximum number of bytes available. The <code>usage</code> property gives the number of bytes currently being used. The <code>usageDetails</code> property is an object that describes how the memory is currently being used.</p><p>If an attempt is made to use more storage space than the quota allows, a <code>QuotaExceedError</code> will be thrown.</p><p>Previously stored data can be evicted if the available storage is close to being exhausted or the quota across all domains is exceeded.</p><p>In Safari, if the setting &quot;Prevent Cross-Site&quot; Tracking&quot; is turned on, data for any origin that hasn't had an user interactions in the last week will be evicted. This is clearly bad web apps that intended to store data for long periods of time.</p><h2 id="devtools" tabindex="-1">DevTools</h2><p>To see the contents of IndexedDB databases in Chrome:</p><ul><li>open the DevTools</li><li>click the &quot;Application&quot; tab</li><li>in the left nav under the &quot;Storage&quot; section, expand &quot;indexedDB&quot;</li><li>click the name of a store</li><li>all the record keys and values will be displayed</li><li>records can be deleted, but not modified</li></ul><p>To see the contents of IndexedDB databases in Chrome:</p><ul><li>open the &quot;Web Inspector&quot;</li><li>click the &quot;Storage&quot; tab</li><li>in the left nav, expand &quot;Indexed Databases&quot;</li><li>expand a specific database</li><li>click a specific store</li><li>all the record keys and values will be displayed</li></ul><h2 id="indexeddb-interfaces" tabindex="-1">IndexedDB Interfaces</h2><p>The IndexedDB API defines many interfaces that implementations implement. The following subsections summarized the most important properties and methods of these interfaces.</p><p>Also see the Promise-based library <a href="https://github.com/jakearchibald/idb#opendb?v=1.1.1" rel="noopener" target="_blank">idb</a> from Jake Archibald.</p><h3 id="idbfactory" tabindex="-1">IDBFactory</h3><p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/IDBFactory?v=1.1.1" rel="noopener" target="_blank">IDBFactory</a> interface provides access to databases.</p><p>Instances support the following operations.</p><h4 id="open-database" tabindex="-1">open database</h4><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> version <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><br><span class="token comment">// indexedDB is a global property on the window object.</span><br><span class="token keyword">const</span> request <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'db-name'</span><span class="token punctuation">,</span> version<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> db <span class="token operator">=</span> request<span class="token punctuation">.</span>result<span class="token punctuation">;</span><br>  <span class="token comment">// Use the database.</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'failed to open database:'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token comment">// This is called the first time a database is used</span><br><span class="token comment">// and again each time the version number changes.</span><br>request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token comment">// The event may be an instance of the IDBVersionChangeEvent interface</span><br>  <span class="token comment">// and have the properties "oldVersion" and "newVersion".</span><br>  <span class="token keyword">const</span> db <span class="token operator">=</span> request<span class="token punctuation">.</span>result<span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h4 id="delete-database" tabindex="-1">delete database</h4><p>A database can be deleted from the DevTools console by entering <code>indexedDB.deleteDatabase('db-name')</code>.</p><p>In code, a database can be deleted as follows:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> request <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">deleteDatabase</span><span class="token punctuation">(</span><span class="token string">'db-name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'deleted database'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// event.result should be undefined</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'failed to delete database:'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h3 id="idbdatabase" tabindex="-1">IDBDatabase</h3><p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/IDBDatabase?v=1.1.1" rel="noopener" target="_blank">IDBDatabase</a> interface provides a connection to a database.</p><p>Instances support the following operations.</p><h4 id="create-store" tabindex="-1">create store</h4><pre class="language-js"><code class="language-js"><span class="token comment">// Options are optional.  autoIncrement defaults to false.</span><br><span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">autoIncrement</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">keyPath</span><span class="token operator">:</span> <span class="token string">'property-name'</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> store <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">'store-name'</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="delete-store" tabindex="-1">delete store</h4><pre class="language-js"><code class="language-js">db<span class="token punctuation">.</span><span class="token function">deleteObjectStore</span><span class="token punctuation">(</span><span class="token string">'store-name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="create-transaction" tabindex="-1">create transaction</h4><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> mode <span class="token operator">=</span> <span class="token string">'readwrite'</span><span class="token punctuation">;</span> <span class="token comment">// or 'readonly' (default)</span><br><span class="token keyword">const</span> stores <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'db-name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// can be one string or an array of them</span><br><span class="token keyword">const</span> txn <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span>stores<span class="token punctuation">,</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="close-connection" tabindex="-1">close connection</h4><pre class="language-js"><code class="language-js">db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="idbtransaction" tabindex="-1">IDBTransaction</h3><p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/IDBTransaction?v=1.1.1" rel="noopener" target="_blank">IDBTransaction</a> interface provides an asynchronous transaction over a set of stores in a common database.</p><p>Instances have the following properties.</p><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td><code>db</code></td><td>associated database</td></tr><tr><td><code>objectStoreNames</code></td><td>associated store names</td></tr></tbody></table><p>Instances support the following operations.</p><h4 id="get-existing-store" tabindex="-1">get existing store</h4><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> store <span class="token operator">=</span> txn<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'store-name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="delete-existing-store" tabindex="-1">delete existing store</h4><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> store <span class="token operator">=</span> txn<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'store-name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="commit-transaction" tabindex="-1">commit transaction</h4><p>This is not normally needed because transactions automatically commit when all requests are satisfied.</p><pre class="language-js"><code class="language-js">txn<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="abort-transaction-(rolls-back)" tabindex="-1">abort transaction (rolls back)</h4><pre class="language-js"><code class="language-js">txn<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="listen-for-events" tabindex="-1">listen for events</h4><pre class="language-js"><code class="language-js">txn<span class="token punctuation">.</span><span class="token function-variable function">onabort</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'transaction aborted'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>txn<span class="token punctuation">.</span><span class="token function-variable function">oncomplete</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'transaction completed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>txn<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'transaction error:'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h3 id="idbobjectstore" tabindex="-1">IDBObjectStore</h3><p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/IDBObjectStore?v=1.1.1" rel="noopener" target="_blank">IDBObjectStore</a> interface represents a database store which is similar to a table in a relational database.</p><p>Instances have the following properties.</p><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td><code>indexNames</code></td><td>associated index names</td></tr><tr><td><code>keyPath</code></td><td>associated key path</td></tr><tr><td><code>name</code></td><td>store name</td></tr><tr><td><code>transaction</code></td><td>associated transaction</td></tr></tbody></table><p>Instances support the following operations.</p><h4 id="add-record-to-store" tabindex="-1">add record to store</h4><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> request <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'added record'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'failed to add record:'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h4 id="delete-all-records-from-store" tabindex="-1">delete all records from store</h4><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> request <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'cleared store'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'failed to clear store:'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h4 id="get-number-of-records-in-store" tabindex="-1">get number of records in store</h4><p>The <code>count</code> method can:</p><ul><li>get the number records in the store (no argument passed)</li><li>determine if a record with a given key exists, returning 0 or 1 (string key passed)</li><li>get the number of records whose keys fall in a given range (instance of <a href="https://developer.mozilla.org/en-US/docs/Web/API/IDBKeyRange?v=1.1.1" rel="noopener" target="_blank">IDBKeyRange</a> passed)</li></ul><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token operator">...</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> request <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// query is optional</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> count <span class="token operator">=</span> request<span class="token punctuation">.</span>result<span class="token punctuation">;</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'count ='</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'failed to count records:'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h4 id="create-index-for-store" tabindex="-1">create index for store</h4><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> breedIndex <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token string">'breed-index'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'breed'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">unique</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// This creates a "compound index".</span><br><span class="token keyword">const</span> nameBreedIndex <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><br>  <span class="token string">'name-breed-index'</span><span class="token punctuation">,</span><br>  <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'breed'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><span class="token literal-property property">unique</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="delete-records" tabindex="-1">delete records</h4><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> request <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'some-key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// or IDBKeyRange</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'records were deleted'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'failed to delete records:'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h4 id="delete-index" tabindex="-1">delete index</h4><pre class="language-js"><code class="language-js">store<span class="token punctuation">.</span><span class="token function">deleteIndex</span><span class="token punctuation">(</span><span class="token string">'index-name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="get-record-with-key" tabindex="-1">get record with key</h4><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> request <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'some-key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> record <span class="token operator">=</span> request<span class="token punctuation">.</span>result<span class="token punctuation">;</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'record ='</span><span class="token punctuation">,</span> record<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'failed to get record:'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h4 id="get-records" tabindex="-1">get records</h4><p>The <code>getAll</code> method can:</p><ul><li>get all the records in a store (no argument passed)</li><li>get the record with a given key (string key passed)</li><li>get all the records whose keys fall in a given range (instance of <a href="https://developer.mozilla.org/en-US/docs/Web/API/IDBKeyRange?v=1.1.1" rel="noopener" target="_blank">IDBKeyRange</a> passed) This is useful for pagination.</li></ul><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token operator">...</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> request <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// query is optional</span><br><span class="token comment">// Optionally pass a count as the second argument</span><br><span class="token comment">// to limit the number of records returned.</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> records <span class="token operator">=</span> request<span class="token punctuation">.</span>result<span class="token punctuation">;</span> <span class="token comment">// an array</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'records ='</span><span class="token punctuation">,</span> records<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'failed to get record:'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h4 id="get-keys" tabindex="-1">get keys</h4><p>The <code>getAllKeys</code> method gets an array of all the keys of existing records that fall in a specified <a href="https://developer.mozilla.org/en-US/docs/Web/API/IDBKeyRange?v=1.1.1" rel="noopener" target="_blank">IDBKeyRange</a>.</p><h4 id="open-index-over-all-records" tabindex="-1">open index over all records</h4><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> index <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">'index-name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>index<span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> cursor <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span><br>  <span class="token comment">// See IDBCursor methods.</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h4 id="open-cursor-over-records-in-a-key-range" tabindex="-1">open cursor over records in a key range</h4><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> request <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> cursor <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span><br>  <span class="token comment">// See IDBCursor methods.</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h4 id="open-cursor-to-iterate-over-keys-in-a-key-range" tabindex="-1">open cursor to iterate over keys in a key range</h4><p>The <code>openKeyCursor</code> method is similar to the <code>openCursor</code> method, but iterates over keys instead of records.</p><h4 id="upsert-a-record" tabindex="-1">upsert a record</h4><p>If you have a cursor that refers to an existing record, it is preferable to use the cursor method <code>update</code> instead of this.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> request <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>newRecord<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> key <span class="token operator">=</span> request<span class="token punctuation">.</span>result<span class="token punctuation">;</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'upserted record with key'</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'failed to upsert record:'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h3 id="idbrequest" tabindex="-1">IDBRequest</h3><p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/IDBRequest?v=1.1.1" rel="noopener" target="_blank">IDBRequest</a> interface represents the result of an asynchronous operation. It is common to set the <code>onsuccess</code> and <code>onerror</code> properties to a callback function that is passed an event object.</p><p>Instances have the following properties.</p><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td><code>error</code></td><td>associated error, if any</td></tr><tr><td><code>result</code></td><td>associated result</td></tr><tr><td><code>source</code></td><td>associated store or index</td></tr><tr><td><code>transaction</code></td><td>associated transaction</td></tr></tbody></table><p>Instances do not support any operations.</p><h3 id="idbcursor" tabindex="-1">IDBCursor</h3><p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/IDBCursor?v=1.1.1" rel="noopener" target="_blank">IDBCursor</a> interface is used to iterate over records in a store.</p><p>Instances support the following operations.</p><h4 id="iterate-over-all-records" tabindex="-1">iterate over all records</h4><pre class="language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> record <span class="token operator">=</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">;</span><br>  <span class="token comment">// Use record properties.</span><br>  cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'processed all records'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h4 id="get-store-or-index-associated-with-cursor" tabindex="-1">get store or index associated with cursor</h4><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> source <span class="token operator">=</span> cursor<span class="token punctuation">.</span>source<span class="token punctuation">;</span></code></pre><h4 id="get-key-of-current-record" tabindex="-1">get key of current record</h4><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> key <span class="token operator">=</span> cursor<span class="token punctuation">.</span>key<span class="token punctuation">;</span></code></pre><h4 id="get-request-that-created-cursor" tabindex="-1">get request that created cursor</h4><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> request <span class="token operator">=</span> cursor<span class="token punctuation">.</span>request<span class="token punctuation">;</span></code></pre><h4 id="advance-to-next-record" tabindex="-1">advance to next record</h4><pre class="language-js"><code class="language-js">cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="advance-to-record-with-given-key" tabindex="-1">advance to record with given key</h4><pre class="language-js"><code class="language-js">cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="delete-referenced-record" tabindex="-1">delete referenced record</h4><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> request <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'deleted record'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'failed to delete record:'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h4 id="update-referenced-record" tabindex="-1">update referenced record</h4><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> request <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>newRecord<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'updated record'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'failed to update record:'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h3 id="idbindex" tabindex="-1">IDBIndex</h3><p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/IDBIndex?v=1.1.1" rel="noopener" target="_blank">IDBIndex</a> interface provides efficient retrieval of records in a store based on one or more properties of the records.</p><p>Instances have the following properties.</p><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td><code>keyPath</code></td><td>associated key path</td></tr><tr><td><code>name</code></td><td>index name</td></tr><tr><td><code>store</code></td><td>associated store</td></tr><tr><td><code>unique</code></td><td>boolean indicating whether only unique values are allowed</td></tr></tbody></table><p>Instances do not support any operations.</p><h3 id="idbkeyrange" tabindex="-1">IDBKeyRange</h3><p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/IDBKeyRange?v=1.1.1" rel="noopener" target="_blank">IDBKeyRange</a> interface describes a range of keys. It is used to retrieve matching keys or records from a store.</p><p>To create a range, call one of the following static methods:</p><ul><li><code>lowerBound</code>: lower bound can be inclusive or exclusive; no upper bound</li><li><code>upperBound</code>: upper bound can be inclusive or exclusive; no lower bound</li><li><code>bound</code>: lower and upper bound can both be inclusive or exclusive</li><li><code>only</code>: single key</li></ul><p>Instances have the following properties.</p><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td><code>lower</code></td><td>lower bound</td></tr><tr><td><code>lowerOpen</code></td><td>boolean indicating whether the lower bound is exclusive</td></tr><tr><td><code>upper</code></td><td>upper bound</td></tr><tr><td><code>upperOpen</code></td><td>boolean indicating whether the upper bound is exclusive</td></tr></tbody></table><h4 id="test-if-a-key-is-in-range" tabindex="-1">test if a key is in range</h4><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> included <span class="token operator">=</span> range<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="crud-example" tabindex="-1">CRUD Example</h2><p>TODO: Add this detail. TODO: See Documents/dev/pwas/pwa-cloudflare-demo/public/setup.js</p></article>