<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>IndexedDB</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#storage-quotas">Storage Quotas</a></li><li><a href="#devtools">DevTools</a></li><li><a href="#indexeddb-interfaces">IndexedDB Interfaces</a><ol><li><a href="#idbfactory">IDBFactory</a></li><li><a href="#idbdatabase">IDBDatabase</a></li><li><a href="#idbtransaction">IDBTransaction</a></li><li><a href="#idbobjectstore">IDBObjectStore</a></li><li><a href="#idbrequest">IDBRequest</a></li><li><a href="#idbcursor">IDBCursor</a></li></ol></li><li><a href="#common-operations">Common Operations</a></li><li><a href="#create-an-index">Create an index</a></li><li><a href="#delete-an-index">Delete an index</a></li><li><a href="#create-an-object">Create an object</a></li><li><a href="#query-for-a-single-object">Query for a single object</a></li><li><a href="#query-for-multiple-objects">Query for multiple objects</a></li><li><a href="#modify-an-object">Modify an object</a></li><li><a href="#delete-an-object">Delete an object</a></li></ol></nav></aside><article><style>img {
    border: 1px solid gray;
  }</style><p><img alt="PWA logo" style="border: none; width: 30%" src="/blog/assets/pwa-logo.svg?v=1.1.1" title="PWA logo"></p><h2 id="overview" tabindex="-1">Overview</h2><p><a href="https://www.w3.org/TR/IndexedDB/?v=1.1.1" rel="noopener" target="_blank">IndexedDB</a> is a JavaScript-based, object-oriented database that is supported by modern web browsers.</p><p>Unlike relational databases that are composed of tables with records that are composed of columns, IndexedDB databases are composed of stores that hold objects with properties.</p><p>Objects within stores can be retrieved by their key, and by optional indexes.</p><p>Modifications occur within transactions that can be committed or rolled back.</p><p>All accesses to IndexedDB databases are performed asynchronously, so they do not impact the interactivity of a web application by blocking the main thread.</p><h2 id="storage-quotas" tabindex="-1">Storage Quotas</h2><p>The storage quota available to IndexedDB varies based on the web browser being used and the total amount of storage on the device.</p><p>In Chrome and Chromium-based browsers (including Edge), each domain (or origin) can use up to 60% of total storage space. For example, on a phone with 128 GB of memory, a maximum of 76.8 GB can be used per domain. The available memory is typically much lower due to the operating system and applications consuming a large part of the memory.</p><p>In Safari, each domain can use up to 20% of the total storage space. If a PWA is saved to the home screen, the limit is increased to 60% of the total storage space. There is also a quota of 80% of the total storage space across all domains.</p><p>Web applications can obtain an estimate of the storage space available to their domain with the following:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> estimate <span class="token operator">=</span> <span class="token keyword">await</span> navigator<span class="token punctuation">.</span>storage<span class="token punctuation">.</span><span class="token function">estimate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The <code>estimate</code> variable holds an object with three properties. The <code>quota</code> property gives the maximum number of bytes available. The <code>usage</code> property gives the number of bytes currently being used. The <code>usageDetails</code> property is an object that describes how the memory is currently being used.</p><p>If an attempt is made to use more storage space than the quota allows, a <code>QuotaExceedError</code> will be thrown.</p><p>Previously stored data can be evicted if the available storage is close to being exhausted or the quota across all domains is exceeded.</p><p>In Safari, if the setting &quot;Prevent Cross-Site&quot; Tracking&quot; is turned on, data for any origin that hasn't had an user interactions in the last week will be evicted. This is clearly bad web apps that intended to store data for long periods of time.</p><h2 id="devtools" tabindex="-1">DevTools</h2><p>To see the contents of IndexedDB databases in Chrome:</p><ul><li>open the DevTools</li><li>click the &quot;Application&quot; tab</li><li>in the left nav under the &quot;Storage&quot; section, expand &quot;indexedDB&quot;</li><li>click the name of a store</li><li>all the keys and their object values will be displayed</li><li>objects can be deleted, but not modified</li></ul><p>To see the contents of IndexedDB databases in Chrome:</p><ul><li>open the &quot;Web Inspector&quot;</li><li>click the &quot;Storage&quot; tab</li><li>in the left nav, expand &quot;Indexed Databases&quot;</li><li>expand a specific database</li><li>click a specific store</li><li>all the keys and their object values will be displayed</li></ul><h2 id="indexeddb-interfaces" tabindex="-1">IndexedDB Interfaces</h2><h3 id="idbfactory" tabindex="-1">IDBFactory</h3><p>The <code>IDBFactory</code> interface provides access to databases. Instances support the following operations.</p><ul><li><p>open database</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> version <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> request <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'db-name'</span><span class="token punctuation">,</span> version<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'failed to open database:'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> db <span class="token operator">=</span> request<span class="token punctuation">.</span>result<span class="token punctuation">;</span><br>  <span class="token comment">// Use the database.</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token comment">// This is called the first time a database is used</span><br><span class="token comment">// and again each time the version number changes.</span><br>request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> db <span class="token operator">=</span> request<span class="token punctuation">.</span>result<span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></li><li><p>delete database</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> request <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">deleteDatabase</span><span class="token punctuation">(</span><span class="token string">'db-name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'failed to delete database:'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'deleted database'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// event.result should be undefined</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></li></ul><h3 id="idbdatabase" tabindex="-1">IDBDatabase</h3><p>The <code>IDBDatabase</code> interface provides a connection to a database. Instances support the following operations.</p><ul><li>create store</li></ul><pre class="language-js"><code class="language-js"><span class="token comment">// Options are optional.  autoIncrement defaults to false.</span><br><span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">autoIncrement</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">keyPath</span><span class="token operator">:</span> <span class="token string">'property-name'</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> store <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">'store-name'</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ul><li><p>delete store</p><pre class="language-js"><code class="language-js">db<span class="token punctuation">.</span><span class="token function">deleteObjectStore</span><span class="token punctuation">(</span><span class="token string">'store-name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>create transaction</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> mode <span class="token operator">=</span> <span class="token string">'readwrite'</span><span class="token punctuation">;</span> <span class="token comment">// or 'readonly' (default)</span><br><span class="token keyword">const</span> stores <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'db-name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// can be one string or an array of them</span><br><span class="token keyword">const</span> txn <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span>stores<span class="token punctuation">,</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>close database connection</p><pre class="language-js"><code class="language-js">db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li></ul><h3 id="idbtransaction" tabindex="-1">IDBTransaction</h3><ul><li><p>delete a store</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> store <span class="token operator">=</span> txn<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'store-name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>abort transaction (rolls back)</p><pre class="language-js"><code class="language-js">txn<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>commit transaction</p><p>This is not normally needed because transactions automatically commit when all requests are satisfied.</p><pre class="language-js"><code class="language-js">txn<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>listen for events</p><pre class="language-js"><code class="language-js">txn<span class="token punctuation">.</span><span class="token function-variable function">onabort</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'transaction aborted'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>txn<span class="token punctuation">.</span><span class="token function-variable function">oncomplete</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'transaction completed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>txn<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'transaction error:'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></li></ul><h3 id="idbobjectstore" tabindex="-1">IDBObjectStore</h3><h3 id="idbrequest" tabindex="-1">IDBRequest</h3><h3 id="idbcursor" tabindex="-1">IDBCursor</h3><h2 id="common-operations" tabindex="-1">Common Operations</h2><h2 id="create-an-index" tabindex="-1">Create an index</h2><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> db <span class="token operator">=</span> request<span class="token punctuation">.</span>result<span class="token punctuation">;</span><br><span class="token keyword">const</span> store <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">'dogs'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">keyPath</span><span class="token operator">:</span> <span class="token string">'id'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// Include multiple property names in the</span><br><span class="token comment">// 2nd parameter array for a compound index.</span><br>store<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token string">'breed'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'breed'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">unique</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="delete-an-index" tabindex="-1">Delete an index</h2><h2 id="create-an-object" tabindex="-1">Create an object</h2><h2 id="query-for-a-single-object" tabindex="-1">Query for a single object</h2><h2 id="query-for-multiple-objects" tabindex="-1">Query for multiple objects</h2><h2 id="modify-an-object" tabindex="-1">Modify an object</h2><h2 id="delete-an-object" tabindex="-1">Delete an object</h2></article>