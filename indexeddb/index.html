<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>IndexedDB</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#storage-quotas">Storage Quotas</a></li><li><a href="#devtools">DevTools</a></li><li><a href="#common-operations">Common Operations</a><ol><li><a href="#create-a-database">Create a database</a></li></ol></li><li><a href="#delete-a-database">Delete a database</a></li><li><a href="#create-an-index">Create an index</a></li><li><a href="#delete-an-index">Delete an index</a></li><li><a href="#create-an-object">Create an object</a></li><li><a href="#query-for-a-single-object">Query for a single object</a></li><li><a href="#query-for-multiple-objects">Query for multiple objects</a></li><li><a href="#modify-an-object">Modify an object</a></li><li><a href="#delete-an-object">Delete an object</a></li></ol></nav></aside><article><style>img {
    border: 1px solid gray;
  }</style><p><img alt="PWA logo" style="border: none; width: 30%" src="/blog/assets/pwa-logo.svg?v=1.1.1" title="PWA logo"></p><h2 id="overview" tabindex="-1">Overview</h2><p><a href="https://www.w3.org/TR/IndexedDB/?v=1.1.1" rel="noopener" target="_blank">IndexedDB</a> is a JavaScript-based, object-oriented database that is supported by modern web browsers.</p><p>Unlike relational databases that are composed of tables with records that are composed of columns, IndexedDB databases are composed of stores that hold objects with properties.</p><p>Objects within stores can be retrieved by their key, and by optional indexes.</p><p>Modifications occur within transactions that can be committed or rolled back.</p><p>All accesses to IndexedDB databases are performed asynchronously, so they do not impact the interactivity of a web application by blocking the main thread.</p><h2 id="storage-quotas" tabindex="-1">Storage Quotas</h2><p>The storage quota available to IndexedDB varies based on the web browser being used and the total amount of storage on the device.</p><p>In Chrome and Chromium-based browsers (including Edge), each domain (or origin) can use up to 60% of total storage space. For example, on a phone with 128 GB of memory, a maximum of 76.8 GB can be used per domain. The available memory is typically much lower due to the operating system and applications consuming a large part of the memory.</p><p>In Safari, each domain can use up to 20% of the total storage space. If a PWA is saved to the home screen, the limit is increased to 60% of the total storage space. There is also a quota of 80% of the total storage space across all domains.</p><p>Web applications can obtain an estimate of the storage space available to their domain with the following:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> estimate <span class="token operator">=</span> <span class="token keyword">await</span> navigator<span class="token punctuation">.</span>storage<span class="token punctuation">.</span><span class="token function">estimate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The <code>estimate</code> variable holds an object with three properties. The <code>quota</code> property gives the maximum number of bytes available. The <code>usage</code> property gives the number of bytes currently being used. The <code>usageDetails</code> property is an object that describes how the memory is currently being used.</p><p>If an attempt is made to use more storage space than the quota allows, a <code>QuotaExceedError</code> will be thrown.</p><p>Previously stored data can be evicted if the available storage is close to being exhausted or the quota across all domains is exceeded.</p><p>In Safari, if the setting &quot;Prevent Cross-Site&quot; Tracking&quot; is turned on, data for any origin that hasn't had an user interactions in the last week will be evicted. This is clearly bad web apps that intended to store data for long periods of time.</p><h2 id="devtools" tabindex="-1">DevTools</h2><p>To see the contents of IndexedDB databases in Chrome:</p><ul><li>open the DevTools</li><li>click the &quot;Application&quot; tab</li><li>in the left nav under the &quot;Storage&quot; section, expand &quot;indexedDB&quot;</li><li>click the name of a store</li><li>all the keys and their object values will be displayed</li><li>objects can be deleted, but not modified</li></ul><p>To see the contents of IndexedDB databases in Chrome:</p><ul><li>open the &quot;Web Inspector&quot;</li><li>click the &quot;Storage&quot; tab</li><li>in the left nav, expand &quot;Indexed Databases&quot;</li><li>expand a specific database</li><li>click a specific store</li><li>all the keys and their object values will be displayed</li></ul><h2 id="common-operations" tabindex="-1">Common Operations</h2><h3 id="create-a-database" tabindex="-1">Create a database</h3><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> dbName <span class="token operator">=</span> <span class="token string">'myDB'</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> version <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> request <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>dbName<span class="token punctuation">,</span> version<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'IndexedDB error: '</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token comment">// This is called the first time a database is used</span><br><span class="token comment">// and again each time the version number changes.</span><br>request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> db <span class="token operator">=</span> request<span class="token punctuation">.</span>result<span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> db <span class="token operator">=</span> request<span class="token punctuation">.</span>result<span class="token punctuation">;</span><br>  <span class="token keyword">const</span> txn <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">'dogs'</span><span class="token punctuation">,</span> <span class="token string">'readwrite'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  txn<span class="token punctuation">.</span><span class="token function-variable function">oncomplete</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h2 id="delete-a-database" tabindex="-1">Delete a database</h2><h2 id="create-an-index" tabindex="-1">Create an index</h2><h2 id="delete-an-index" tabindex="-1">Delete an index</h2><h2 id="create-an-object" tabindex="-1">Create an object</h2><h2 id="query-for-a-single-object" tabindex="-1">Query for a single object</h2><h2 id="query-for-multiple-objects" tabindex="-1">Query for multiple objects</h2><h2 id="modify-an-object" tabindex="-1">Modify an object</h2><h2 id="delete-an-object" tabindex="-1">Delete an object</h2></article>