<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Turso</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#pricing">Pricing</a></li><li><a href="#alternatives">Alternatives</a></li><li><a href="#available-locations">Available Locations</a></li><li><a href="#write-details">Write Details</a></li><li><a href="#setup">Setup</a></li><li><a href="#cli">CLI</a></li><li><a href="#importing-exising-databases">Importing Exising Databases</a></li><li><a href="#web-based-dashboard">Web-based Dashboard</a></li><li><a href="#app-access">App Access</a></li><li><a href="#resultset-json">ResultSet JSON</a></li><li><a href="#orms">ORMs</a></li><li><a href="#todos">TODOs</a></li></ol></nav></aside><article><figure style="width: 30%"><img alt="Turso logo" style="border: 0" src="/blog/assets/turso-logo.png?v=1.1.1"></figure><h2 id="overview" tabindex="-1">Overview</h2><p><a href="https://turso.tech?v=1.1.1" rel="noopener" target="_blank">Turso</a> is a cloud database that uses a fork of SQLite called <a href="https://github.com/tursodatabase/libsql" target="_blank">libSQL</a>.</p><p>The logo depicts Iku-Turso which is a mythological Finnish sea creature.</p><p>Compute services can be moved to &quot;the edge&quot; so they are closer to users and perform better. But this provides limited benefits if the services need to access databases that are hosted in one location rather than also being on the edge.</p><p>Turso addresses this problem by moving databases to the edge. Each Turso logical database has one primary database and zero or more replica databases.</p><p>Turso uses <a href="https://turso.tech/libsql" target="_blank">libSQL</a> databases. libSQL is an open-source fork of SQLite that adds a server, native replication, and an HTTP mode. This allows it to replicate and scale with low resource usage. libSQL can support having one logical database per tenant or even one logical database per user.</p><p>Primary databases handle both read and write operations. Replica databases handle read operations, but delegate write operations to their primary database. Turso handles making all the replicas eventually consistent.</p><p>Databases can be created and modified in the web UI or using their CLI.</p><p>Turso uses Drizzle ORM.</p><p>Astro uses Turso for &quot;Astro DB&quot;.</p><h2 id="pricing" tabindex="-1">Pricing</h2><p>As of March 2024, Turso offers three plans described in the following table.</p><table><thead><tr><th></th><th>STARTER</th><th>SCALER</th><th>ENTERPRISE PARTNER</th></tr></thead><tbody><tr><td>Price</td><td>free</td><td>$29/month</td><td>$2,999/month</td></tr><tr><td>Storage</td><td>9 GB</td><td>24 GB</td><td>unlimited</td></tr><tr><td>Databases</td><td>500</td><td>10,000</td><td>unlimited</td></tr><tr><td>Locations</td><td>3</td><td>6</td><td>unlimited</td></tr><tr><td>Row reads/month</td><td>1 billion</td><td>100 billion</td><td>unlimited</td></tr><tr><td>Row writes/month</td><td>25 million</td><td>100 million</td><td>unlimited</td></tr></tbody></table><p>The primary limitation of the STARTER and SCALER plans is having a maximum of 3 or 6 locations (primary and replicas). This prevents having fast access all over the world. Depending on the location of users, this may be acceptable for many web applications.</p><h2 id="alternatives" tabindex="-1">Alternatives</h2><p><a href="https://pocketbase.io/" target="_blank">PocketBase</a> is a simple database solution that uses SQLite. It provides SDKs for JavaScript and Dart. No cloud hosting is provided. It must be self-hosted and run on a single server.</p><p><a href="https://supabase.com" target="_blank">Supabase</a> is an alternative to Google's <a href="https://firebase.google.com" target="_blank">Firebase</a> that uses Postgres.</p><p>TODO: Add more detail to this section.</p><h2 id="available-locations" tabindex="-1">Available Locations</h2><p>To see a list of all the available locations for primary and replica databases, enter <code>turso db locations</code>. The current list includes the following:</p><pre class="language-text"><code class="language-text">ID   LOCATION<br>---  --------<br>ams  Amsterdam, Netherlands<br>arn  Stockholm, Sweden<br>atl  Atlanta, Georgia (US)<br>bog  Bogotá, Colombia<br>bom  Mumbai, India<br>bos  Boston, Massachusetts (US)<br>cdg  Paris, France<br>den  Denver, Colorado (US)<br>dfw  Dallas, Texas (US)<br>ewr  Secaucus, NJ (US)<br>eze  Ezeiza, Argentina<br>fra  Frankfurt, Germany<br>gdl  Guadalajara, Mexico<br>gig  Rio de Janeiro, Brazil<br>gru  São Paulo, Brazil<br>hkg  Hong Kong, Hong Kong<br>iad  Ashburn, Virginia (US)<br>jnb  Johannesburg, South Africa<br>lax  Los Angeles, California (US)<br>lhr  London, United Kingdom<br>mad  Madrid, Spain<br>mia  Miami, Florida (US)<br>nrt  Tokyo, Japan<br>ord  Chicago, Illinois (US)  [default]<br>otp  Bucharest, Romania<br>phx  Phoenix, Arizona (US)<br>qro  Querétaro, Mexico<br>scl  Santiago, Chile<br>sea  Seattle, Washington (US)<br>sin  Singapore, Singapore<br>sjc  San Jose, California (US)<br>syd  Sydney, Australia<br>waw  Warsaw, Poland<br>yul  Montreal, Canada<br>yyz  Toronto, Canada</code></pre><h2 id="write-details" tabindex="-1">Write Details</h2><p>When a record is written from a replica, the <code>last_replication_index</code> is immediately returned from the primary. At this point the current replica has not yet been updated.</p><p>When a record is read from a replica, the <code>last_replication_index</code> value is added to the read request. If the replica has a lower <code>last_replication_index</code> then the request is forwarded to the primary. This can result in increased latency for reads until the replica catches up. But it guarantees that reads from a replica will always get the data that was most recently written from the same replica.</p><p>Replication tends to be very fast, so this is not typically an issue.</p><h2 id="setup" tabindex="-1">Setup</h2><ul><li><p>Create a free account.</p></li><li><p>Create your first database.</p><p>The website provides a button that can be clicked to do this. It will create the primary database in the supported location that is nearest to your current location.</p></li><li><p>Optionally create replicas of your database in a specific cities that are near your users.</p><p>The website provides a button that can be clicked to do this. I chose Atlanta, Georgia USA.</p></li><li><p>Install the Turso CLI.</p><p>In macOS, enter <code>brew install tursodatabase/tap/turso</code></p></li><li><p>Sign up by entering <code>turso auth signup</code></p></li></ul><h2 id="cli" tabindex="-1">CLI</h2><ul><li><p>Create a database by entering <code>turso db create {db-name}</code></p></li><li><p>View information about the database by entering <code>turso db show {db-name}</code></p><p>This will output the URL, primary location (ex. ord for Chicago), replica location (ex. atl for Atlanta), and size (ex. 4.1 kB).</p></li><li><p>Connect to the database shell by entering <code>turso db shell {db-name}</code></p></li><li><p>Create a table by entering <code>create table todos(id integer primary key autoincrement, text string, done integer);</code></p></li><li><p>List the existing tables by entering <code>.tables</code></p></li><li><p>Output the schema for all tables or a specific table by entering <code>.schema [table-name]</code></p></li><li><p>Insert a row by entering <code>insert into todos (text, done) values('cut grass', 0);</code></p></li><li><p>Update the row by entering <code>update todos set done=1 where id=1;</code></p></li><li><p>Query the table by entering <code>select * from todos;</code></p></li><li><p>Quit the shell by entering <code>.quit</code></p><p>Unlike in SQLite, <code>.exit</code> does not work.</p></li></ul><h2 id="importing-exising-databases" tabindex="-1">Importing Exising Databases</h2><p>Existing SQLite databases can be imported into Turso using the <code>turso db create {db-name} --from-file {file-path}</code> command.</p><p>See other options at <a href="https://docs.turso.tech/cli/db/create" target="_blank">db create</a>.</p><h2 id="web-based-dashboard" tabindex="-1">Web-based Dashboard</h2><p>Browse <a href="https://turso.tech/" target="_blank">Turso web site</a> and click the &quot;Login&quot; button to access your dashboard. This provides a web-based view that show:</p><ul><li>the number of databases you have created</li><li>the amount of storage used</li><li>the number of locations used for primary and replica databases</li><li>the number or rows read and written</li></ul><p>To access a specific database, click &quot;Databases&quot; in the left nav. A table at the bottom lists the database names. Click one to see its URL, ID, and basic statistics. Click the &quot;Edit Tables&quot; button to view the existing tables and create new tables. From here you can view/modify existing records and add new records.</p><h2 id="app-access" tabindex="-1">App Access</h2><p>Turso currently provides API for interacting with databases using TypeScript, Go, and Rust.</p><ul><li><p>Create a directory for the app and <code>cd</code> to it.</p></li><li><p>Create the initial files by entering <code>bun init</code>.</p></li><li><p>Install the client library by entering <code>bun add @libsql/client</code></p></li><li><p>Create an auth token by entering <code>turso db tokens create {db-name}</code></p></li><li><p>Edit <code>.env</code> and add the following lines:</p><pre class="language-text"><code class="language-text">TURSO_AUTH={auth-token}<br>TURSO_URL={db-url}</code></pre></li><li><p>Get the database URL by entering <code>turso db show {db-name} --url</code></p></li><li><p>Edit <code>index.ts</code> and replace the contents with the following:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>createClient<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@libsql/client'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token function">createClient</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  url<span class="token operator">:</span> Bun<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">TURSO_URL</span> <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">,</span><br>  authToken<span class="token operator">:</span> Bun<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">TURSO_TOKEN</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> resultSet <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">'select * from todos'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// The client.execute method can also run</span><br><span class="token comment">// commands like insert, update, and delete.</span><br><span class="token keyword">const</span> <span class="token punctuation">{</span>columns<span class="token punctuation">,</span> rows<span class="token punctuation">}</span> <span class="token operator">=</span> resultSet<span class="token punctuation">;</span><br><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> row <span class="token keyword">of</span> rows<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'---'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> column <span class="token keyword">of</span> columns<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>column<span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">,</span> row<span class="token punctuation">[</span>column<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Edit <code>package.json</code> and add the following:</p><pre class="language-json"><code class="language-json"><span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>  <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"bun run index.ts"</span><br><span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></li><li><p>Run the app by entering <code>bun dev</code></p></li></ul><h2 id="resultset-json" tabindex="-1">ResultSet JSON</h2><p>The JSON returned by queries will be similar to the following:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"columns"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token string">"text"</span><span class="token punctuation">,</span> <span class="token string">"done"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token property">"columnTypes"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"INTEGER"</span><span class="token punctuation">,</span> <span class="token string">"string"</span><span class="token punctuation">,</span> <span class="token string">"INTEGER"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token property">"rows"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"0"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><br>      <span class="token property">"1"</span><span class="token operator">:</span> <span class="token string">"cut grass"</span><span class="token punctuation">,</span><br>      <span class="token property">"2"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><br>      <span class="token property">"length"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span><br>      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><br>      <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"cut grass"</span><span class="token punctuation">,</span><br>      <span class="token property">"done"</span><span class="token operator">:</span> <span class="token number">1</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"0"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><br>      <span class="token property">"1"</span><span class="token operator">:</span> <span class="token string">"buy milk"</span><span class="token punctuation">,</span><br>      <span class="token property">"2"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>      <span class="token property">"length"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span><br>      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><br>      <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"buy milk"</span><span class="token punctuation">,</span><br>      <span class="token property">"done"</span><span class="token operator">:</span> <span class="token number">0</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token property">"rowsAffected"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>  <span class="token property">"lastInsertRowid"</span><span class="token operator">:</span> undefined<br><span class="token punctuation">}</span></code></pre><h2 id="orms" tabindex="-1">ORMs</h2><p>Using an ORM can simplify the code for interacting with Turso databases. The <a href="/blog/topics/#/blog/drizzle/" target="_blank">Drizzle</a> ORM has great support for Turso.</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span>eq<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'drizzle-orm'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>drizzle<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'drizzle-orm/libsql'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>sqliteTable<span class="token punctuation">,</span> integer<span class="token punctuation">,</span> text<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'drizzle-orm/sqlite-core'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>createClient<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'libsql/client'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token function">createClient</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token punctuation">,</span> authToken<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">drizzle</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Map ORM object properties to table columns.</span><br><span class="token keyword">export</span> <span class="token keyword">const</span> todos <span class="token operator">=</span> <span class="token function">sqliteTable</span><span class="token punctuation">(</span><span class="token string">'todos'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token function">integer</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">primaryKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">256</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token function">integer</span><span class="token punctuation">(</span><span class="token string">'done'</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">function</span> <span class="token function">createTodo</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">text</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">done</span><span class="token operator">:</span> int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>todos<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">{</span>text<span class="token punctuation">,</span> done<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">getTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>todos<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h2 id="todos" tabindex="-1">TODOs</h2><p>Create a demo app that uses Bun, Hono, Turso, and Cloudflare.</p></article>