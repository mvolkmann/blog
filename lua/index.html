<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Lua</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#used-by">Used By</a></li><li><a href="#resources">Resources</a></li><li><a href="#cheat-sheets">Cheat Sheets</a></li><li><a href="#installing">Installing</a></li><li><a href="#compiling">Compiling</a><ol><li><a href="#luac">luac</a></li><li><a href="#luajit">LuaJIT</a></li><li><a href="#pallene">Pallene</a></li></ol></li><li><a href="#vs-code-setup">VS Code Setup</a></li><li><a href="#grammar">Grammar</a></li><li><a href="#source-files">Source Files</a></li><li><a href="#running-code">Running Code</a></li><li><a href="#keywords">Keywords</a></li><li><a href="#comments">Comments</a></li><li><a href="#types">Types</a></li><li><a href="#input%2Foutput">Input/Output</a></li><li><a href="#variables">Variables</a></li><li><a href="#booleans">Booleans</a></li><li><a href="#numbers">Numbers</a></li><li><a href="#strings">Strings</a><ol><li><a href="#patterns">Patterns</a></li></ol></li><li><a href="#operators">Operators</a></li><li><a href="#conditional-logic">Conditional Logic</a></li><li><a href="#iteration">Iteration</a></li><li><a href="#functions">Functions</a></li><li><a href="#default-parameter-values">Default Parameter Values</a></li><li><a href="#utility-functions">Utility Functions</a></li><li><a href="#data-structures">Data Structures</a><ol><li><a href="#tables">Tables</a></li></ol></li><li><a href="#self-parameter">self Parameter</a></li><li><a href="#metatables">Metatables</a><ol><li><a href="#table-delegation">Table Delegation</a></li><li><a href="#classes">Classes</a></li><li><a href="#simplifying-classes">Simplifying Classes</a></li><li><a href="#inheritance">Inheritance</a></li><li><a href="#multiple-inheritance">Multiple Inheritance</a></li></ol></li><li><a href="#metamethods">Metamethods</a></li><li><a href="#lua-functional-(luafun)">Lua Functional (luafun)</a></li><li><a href="#standard-library">Standard Library</a><ol><li><a href="#math-module">math module</a></li><li><a href="#io-module">io Module</a></li><li><a href="#os-module">os Module</a></li></ol></li><li><a href="#modules">Modules</a></li><li><a href="#object-oriented-programming-(oop)">Object Oriented Programming (OOP)</a></li><li><a href="#multitasking">Multitasking</a></li><li><a href="#error-handling">Error Handling</a></li><li><a href="#http">HTTP</a></li><li><a href="#games">Games</a></li><li><a href="#unorganized-content">Unorganized Content</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p><img alt="Lua logo" style="width: 40%" src="/blog/assets/lua-logo.svg?v=1.0.20" title="Lua logo"></p><p><a href="https://www.lua.org/?v=1.0.20" rel="noopener" target="_blank">Lua</a> is a dynamically typed scripting language created in 1993 by a team at <a href="http://www.puc-rio.br?v=1.0.20" rel="noopener" target="_blank">Pontifical Catholic University of Rio de Janeiro</a> in Brazil. The team includes is <a href="https://en.wikipedia.org/wiki/Roberto_Ierusalimschy?v=1.0.20" rel="noopener" target="_blank">Roberto Ierusalimschy</a>, Walemar Celes, and Luiz Henrique de Figueiredo.</p><p>The Portuguese word &quot;Lua&quot; means &quot;Moon&quot;. The logo depicts the Moon orbiting around the Earth and its shadow being cast onto the Earth.</p><p>The goals of Lua are:</p><ul><li>portability: runs on any OS targeted by the ANSI C compiler</li><li>simplicity: easy to use by non-professional programmers</li><li>small size: supports embedding in non-Lua applications</li><li>scripting: easy to invoke from system language such as C</li></ul><p>Examples of Lua simplicity include having a small number of keywords (21) and indexing from 1 instead 0 (like matrices in math). The Lua reference manual that describes every language feature is around 100 pages.</p><p>Lua has an interpreter and a virtual machine. The interpreter is written in C and produces bytecode that runs in the virtual machine. Compiling to bytecode can be done at runtime or ahead of time (although I haven't found a recommended way to do it).</p><p>Lua has a relatively small standard library, but has a large collection of packages that can be installed using the <a href="https://luarocks.org?v=1.0.20" rel="noopener" target="_blank">LuaRocks</a> package manager.</p><p>Pros of Lua include:</p><ul><li>considered to be the fastest scripting language when compiled</li><li>free and open sources under the MIT license</li><li>simple syntax with only 21 keywords</li><li>uses dynamic variables that do not require specifying types</li><li>functions are first class and are closures</li><li>implements tail call optimization</li><li>easy to run C code from Lua and run Lua code from C</li><li>easy to embed in C/C++ applications (interpreter is only 182K)</li><li>highly portable (runs on all major OSes and most microcontrollers)</li><li>native support for multitasking with coroutines</li><li>provides automatic, incremental garbage collection</li></ul><p>Cons of Lua include:</p><ul><li><p>limited Unicode support</p><p>Strings can contain Unicode characters, but indexing into such strings does not account for their size. See <a href="http://lua-users.org/wiki/LuaUnicode?v=1.0.20" rel="noopener" target="_blank">Lua Unicode</a>.</p></li><li><p>variables and functions are global by default</p></li><li><p>lack of type checking</p></li><li><p>lack of support for object oriented programming (OOP), although it can be simulated with metatables and functions</p></li><li><p>limited support for error handling (see the <code>error</code> and <code>pcall</code> functions)</p></li><li><p>limited support for string pattern matching, using string &quot;patterns&quot; which are a simplified version of regular expressions</p></li></ul><p>TODO: Get more from <a href="http://notebook.kulchenko.com/programming/lua-good-different-bad-and-ugly-parts">http://notebook.kulchenko.com/programming/lua-good-different-bad-and-ugly-parts</a>.</p><h2 id="used-by" tabindex="-1">Used By</h2><p>Notable uses of Lua include:</p><ul><li><a href="http://www.legoengineering.com/platform/nxt/?v=1.0.20" rel="noopener" target="_blank">Lego Mindstorms NXT</a></li><li><a href="https://www.minecraft.net/?v=1.0.20" rel="noopener" target="_blank">Minecraft</a> game</li><li><a href="https://neovim.io?v=1.0.20" rel="noopener" target="_blank">Neovim</a> text editor</li><li><a href="https://redis.io?v=1.0.20" rel="noopener" target="_blank">Redis</a> database</li><li><a href="https://www.roblox.com?v=1.0.20" rel="noopener" target="_blank">Roblox</a> game</li><li><a href="https://worldofwarcraft.blizzard.com/?v=1.0.20" rel="noopener" target="_blank">World of Warcraft</a></li><li>Texas Instruments <a href="https://education.ti.com/en/resources/lua-scripting?v=1.0.20" rel="noopener" target="_blank">TI-Nspire</a> graphing calculators</li></ul><p>Roblox uses a variant of Lua called Luau. TODO: How does that differ? TODO: Learn more about Roblox programming.</p><p>For an extensive, see the <a href="https://en.wikipedia.org/wiki/List_of_applications_using_Lua?v=1.0.20" rel="noopener" target="_blank">List of applications using Lua</a> Wikipedia page.</p><h2 id="resources" tabindex="-1">Resources</h2><ul><li><a href="https://www.lua.org/manual/?v=1.0.20" rel="noopener" target="_blank">Lua Reference Manual</a></li><li><a href="https://www.amazon.com/exec/obidos/ASIN/8590379868/lua-pilindex-20?v=1.0.20" rel="noopener" target="_blank">Programming in Lua</a> book</li><li><a href="https://www.lua.org/gems/?v=1.0.20" rel="noopener" target="_blank">Lua Programming Gems</a></li><li><a href="https://github.com/nanotee/nvim-lua-guide?v=1.0.20" rel="noopener" target="_blank">Getting started using Lua in Neovim</a></li><li><a href="https://www.lua.org/pil/?v=1.0.20" rel="noopener" target="_blank">Programming in Lua</a> official book</li><li><a href="https://www.youtube.com/watch?v=XxcSvnEIUq4?v=1.0.20" rel="noopener" target="_blank">Why (and why not) Lua</a> talk by Roberto Ierusalimschy (2019)</li><li><a href="https://www.youtube.com/watch?v=H3inzGGFefg?v=1.0.20" rel="noopener" target="_blank">Lua and Pallene</a> talk by Roberto Ierusalimschy (2022)</li><li><a href="https://github.com/pallene-lang/pallene?v=1.0.20" rel="noopener" target="_blank">Pallene</a></li></ul><h2 id="cheat-sheets" tabindex="-1">Cheat Sheets</h2><ul><li><a href="https://www.codecademy.com/learn/learn-lua/modules/learn-lua-introduction/cheatsheet?v=1.0.20" rel="noopener" target="_blank">codecademy</a></li><li><a href="https://devhints.io/lua?v=1.0.20" rel="noopener" target="_blank">DevHints.io</a></li><li><a href="https://cheatography.com/srgmc/cheat-sheets/lua-scripting-5-1/?v=1.0.20" rel="noopener" target="_blank">Cheatography</a></li></ul><h2 id="installing" tabindex="-1">Installing</h2><p>Lua can be installed in macOS using Homebrew. Enter <code>brew install lua</code> to install it. Enter <code>lua -v</code> to verify that it worked and see the version.</p><p>For installing in other operating systems, see <a href="http://www.lua.org/start.html?v=1.0.20" rel="noopener" target="_blank">Getting Started</a>.</p><p>To experiment with Lua on the web without installing anything, see <a href="http://www.lua.org/demo.html?v=1.0.20" rel="noopener" target="_blank">Lua Demo</a>.</p><h2 id="compiling" tabindex="-1">Compiling</h2><p>Lua programs can be compiled to bytecode before runtime. This enables faster program startup because runtime bytecode generation is no longer needed.</p><p>The performance of standard Lua is worse that many scripting languages, including Python, unless it is compiled ahead of time (AOT) or just in time (JIT).</p><p>There are multiple ways to produce and execute Lua bytecode.</p><p>For a comparison of the performance of each approach, see <a href="https://eklausmeier.goip.de/blog/2020/05-14-performance-comparison-pallene-vs-lua-5-1-5-2-5-3-5-4-vs-c/?v=1.0.20" rel="noopener" target="_blank">Performance Comparison Pallene vs. Lua 5.1, 5.2, 5.3, 5.4 vs. C</a>.</p><h3 id="luac" tabindex="-1">luac</h3><p><a href="https://www.lua.org/manual/5.1/luac.html?v=1.0.20" rel="noopener" target="_blank">luac</a> is the standard Lua compiler.</p><p>By default <code>luac</code> creates the file <code>luac.out</code> Use the <code>-o</code> option to change this.</p><p>To generate a bytecode file, enter a command like <code>luac demo.lua -o demo.luac</code>.</p><p>To execute a bytecode file, enter a command like <code>lua demo.luac</code>.</p><h3 id="luajit" tabindex="-1">LuaJIT</h3><p><a href="https://luajit.org/?v=1.0.20" rel="noopener" target="_blank">LuaJIT</a> is an alternative to <code>luac</code> that produces smaller bytecode files. LuaJIT also executes bytecode files and provides runtime optimizations that typically result in better performance.</p><p>LuaJIT is implemented by a separate team from the team that maintains Lua.</p><p>From <a href="https://api7.ai/learning-center/openresty/luajit-vs-lua?v=1.0.20" rel="noopener" target="_blank">api7.ai</a>:</p><blockquote><p>The LuaJIT runtime environment ... has a JIT compiler that can generate machine code directly. The LuaJIT interpreter records some runtime statistics while executing the bytecode, such as the actual number of times each Lua function call entry is run and the actual number of times each Lua loop is executed. When these counts exceed a random threshold, the corresponding Lua function entry or Lua loop is considered hot enough to trigger the JIT compiler to start working. The JIT compiler tries to compile the corresponding Lua code path, starting from the hot function's entry or the hot loop's location. The compilation process converts the LuaJIT bytecode into LuaJIT's own defined Intermediate Representation (IR) and then generates machine code for the target architecture.</p></blockquote><p>To install LuaJIT:</p><ul><li>Download the source from <a href="?v=1.0.20" rel="noopener" target="_blank"></a> by entering <code>git clone https://luajit.org/git/luajit.git</code>.</li><li>Enter <code>cd luajit</code></li><li>In macOS, enter <code>export MACOSX_DEPLOYMENT_TARGET={version}</code> where <code>version</code> is a value like <code>13.2</code>.</li><li>Enter <code>make &amp;&amp; sudo make install</code></li><li>The previous command will ask you to create a symlink with a command like <code>ln -sf luajit-2.1.0-beta3 /usr/local/bin/luajit</code>. Enter that command.</li></ul><p>To generate a bytecode file from a Lua program, enter a command like <code>luajit -b demo.lua demo.out</code> To execute a bytecode file, enter a command like <code>luajit demo.out</code>. This will start faster than entering <code>luajit demo.lua</code>.</p><h3 id="pallene" tabindex="-1">Pallene</h3><p>&quot;<a href="https://github.com/pallene-lang/pallene?v=1.0.20" rel="noopener" target="_blank">Pallene</a> is a statically typed and ahead-of-time compiled sister language to Lua, with a focus on performance. It is intended for writing performance sensitive code that interacts with Lua, a space that is currently filled by C modules and by LuaJIT. Compared to C, Pallene should offer better support for interacting with Lua data types, bypassing the unfriendly syntax and performance overhead of the Lua-C API. Compared to LuaJIT, Pallene aims to offer more predictable run-time performance.&quot;</p><p>Pallene is the name of a Saturn moon. The name of the moon is pronounced &quot;puh lee nee&quot;, but the language designer pronounces it &quot;pah lean&quot;.</p><h2 id="vs-code-setup" tabindex="-1">VS Code Setup</h2><p>VS Code has great support for Lua.</p><p>The <a href="https://github.com/LuaLS/lua-language-server?v=1.0.20" rel="noopener" target="_blank">Lua</a> extension from sumneko is a Lua language server. It provides code annotations, syntax checking, dynamic type checking, code formatting, spell checking, and more.</p><p>To disable specific diagnostics, open Settings, filter on &quot;Lua&quot;, scroll down to &quot;Lua &gt; Diagnostics: Disable&quot;, click the &quot;Add Item&quot; button, select a diagnostic name from the drop-down, and click the &quot;OK&quot; button. For example, you may wish to disable &quot;lowercase-global&quot;.</p><p>The <a href="https://github.com/Koihik/vscode-lua-format?v=1.0.20" rel="noopener" target="_blank">vscode-lua-format</a> extension from Koihik is a popular Lua code formatting extension. To configure this, open Settings, filter on &quot;Lua&quot;, and enter the path to a configuration file in &quot;Vscode-lua-format: Config Path&quot; such as <code>/Users/{your-user}/Documents/dev/lang/lua/style.config</code>. Then create the file <code>style.config</code> in that location containing something like the following:</p><pre class="language-text"><code class="language-text"># See all the Lua code formatting options at<br># https://github.com/Koihik/LuaFormatter/blob/master/docs/Style-Config.md<br><br>column_limit: 80<br>continuation_indent_width: 2<br>indent_width: 2<br>keep_simple_control_block_one_line: true<br>keep_simple_function_one_line: true<br>single_quote_to_double_quote: true<br>use_tab: false</code></pre><p>The <a href="https://marketplace.visualstudio.com/items?itemName=actboy168.lua-debug?v=1.0.20" rel="noopener" target="_blank">Lua Debug</a> VS Code extension supports debugging Lua code with breakpoints and watches.</p><h2 id="grammar" tabindex="-1">Grammar</h2><p>Lua is a very simple language. The entire grammar, except comment syntax, is described below.</p><ul><li>&quot;binop&quot; is short for &quot;binary operator&quot;.</li><li>&quot;exp&quot; is short for &quot;expression&quot;.</li><li>&quot;fieldsep&quot; is short for &quot;field separator&quot;.</li><li>&quot;stat&quot; is short for &quot;statement&quot;.</li><li>&quot;unop&quot; is short for &quot;unary operator&quot;.</li><li>&quot;var&quot; is short for &quot;variable&quot;.</li></ul><code>chunk ::= {stat [';']} [laststat[';']]<p>block ::= chunk</p><p>// TODO: Fix formatting of this part!!! stat ::= varlist1 '=' explist1 | local namelist ['=' explist1] | if exp then block {elseif exp then block} [else block] end | do block end | while exp do block end | repeat block until exp | for Name '=' exp ',' exp [',' exp] do block end | for namelist in explist1 do block end | function funcname funcbody | local function Name funcbody | functioncall |</p><p>laststat ::= return [explist1] | break</p><p>funcname ::= Name {'.' Name} [':' Name]</p><p>varlist1 ::= var {',' var}</p><p>var ::= Name | prefixexp '[' exp ']' | prefixexp '.' Name</p><p>namelist ::= Name {',' Name}</p><p>explist1 ::= {exp ','} exp</p><p>exp ::= nil | false | true | Number | String | '...' | function | prefixexp | tableconstructor | exp binop exp | unop exp</p><p>prefixexp ::= var | functioncall | '(' exp ')'</p><p>functioncall ::= prefixexp args | prefixexp ':' Name args</p><p>args ::= '(' [explist1] ')' | tableconstructor | String</p><p>function ::= function funcbody</p><p>funcbody ::= '(' [parlist1] ')' block end</p><p>parlist1 ::= namelist [',' '...'] | '...'</p><p>tableconstructor ::= '{' [fieldlist] '}'</p><p>fieldlist ::= field {fieldsep field} [fieldsep]</p><p>field ::= '[' exp ']' '=' exp | Name '=' exp | exp</p><p>fieldsep ::= ',' | ';'</p><p>binop ::= '+' | '-' | '*' | '/' | '^' | '%' | '..' | '&lt;' | '&lt;=' | '&gt;' | '&gt;=' | '==' | '~=' | and | or</p><p>unop ::= '-' | not | '#'</p></code><p></p><h2 id="source-files" tabindex="-1">Source Files</h2><p>Source files have a <code>.lua</code> extension. To execute a source file, enter <code>lua filename.lua</code>.</p><p>A source file can use the variables and functions defined in another source file by using the <code>require</code> function. For example:</p><pre class="language-lua"><code class="language-lua">require <span class="token string">"other"</span></code></pre><h2 id="running-code" tabindex="-1">Running Code</h2><p>To start a Lua REPL, enter <code>lua</code> and then enter Lua statements. To exit the REPL, press ctrl-c or ctrl-d.</p><p>To run a Lua program, enter <code>lua {filename}.lua</code> or <code>luajit {filename}.lua</code>. This runs the source file through the Lua interpreter to produce bytecode and uses the Lua virtual machine to execute the bytecode.</p><p>There are several tools that claim to produce executable files from Lua programs. But none seem to be popular or actively maintained.</p><h2 id="keywords" tabindex="-1">Keywords</h2><p>Lua only defines 21 keywords. Some of the keywords such as <code>end</code>, <code>and</code>, <code>or</code>, and <code>then</code> make the syntax similar to the Ruby programming language.</p><p>Boolean literal values:</p><ul><li>true</li><li>false</li></ul><p>Conditional Logic:</p><ul><li>if</li><li>then</li><li>elseif</li><li>else</li></ul><p>Functions:</p><ul><li>function</li><li>return</li></ul><p>Iteration:</p><ul><li>for: loop over numbers or pairs</li><li>in: specifies what to loop over</li><li>while: top-tested loop</li><li>repeat and until: bottom-tested loop</li><li>break: exit loop early</li></ul><p>Logical Operators:</p><ul><li>and</li><li>or</li><li>not</li></ul><p>Variables:</p><ul><li>local</li></ul><p>Other:</p><ul><li>do: begins a new lexical block</li><li>end: marks the end of a lexical block</li><li>nil: represents having no value</li></ul><h2 id="comments" tabindex="-1">Comments</h2><p>A single-line comment begins with two dashes.</p><p>A multi-line comment is a single-line comment followed by a multi-line string. They begin with <code>--[[</code> and end with <code>]]</code>. No characters are allowed between the beginning <code>--</code> and <code>[[</code>. Sometimes multi-line comments end with <code>--]]</code> to make the end easier to see, but the <code>--</code> is really just part of the multi-line string.</p><h2 id="types" tabindex="-1">Types</h2><p>Lua uses dynamic types. The types of variables and function parameters are never specified and are always inferred.</p><p>Primitive type conversions are supported by the <code>tonumber</code> and <code>tostring</code> functions. There are no builtin functions for converting a boolean to a number, a number to a boolean, or a string to a boolean.</p><p>The following table shows how to convert each primitive type to the other primitive types.</p><table><thead><tr><th>From</th><th>To Boolean</th><th>To Number</th><th>To String</th></tr></thead><tbody><tr><td>boolean <code>b</code></td><td>not needed</td><td><code>b and 1 or 0</code></td><td><code>tostring(b)</code></td></tr><tr><td>number <code>n</code></td><td><code>n == 0</code></td><td>not needed</td><td><code>tostring(n)</code></td></tr><tr><td>string <code>s</code></td><td><code>s == &quot;true&quot;</code></td><td><code>tonumber(s)</code></td><td>not needed</td></tr></tbody></table><p>The conversion from a number to a boolean above assumes that all numbers except zero should be treated as false.</p><p>The <code>tonumber</code> function returns <code>nil</code> if the conversion is not possible.</p><p>While it is not commonly done, functions can validate the types of arguments passed to them using the <code>assert</code> function. It takes a condition and an optional message that defaults to &quot;assertion failed!&quot;. It prints the message and terminates the programming if the condition evaluates to <code>false</code>. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">demo</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><br>  <span class="token function">assert</span><span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"string"</span><span class="token punctuation">,</span> <span class="token string">"demo requires a string"</span><span class="token punctuation">)</span><br>  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br><span class="token function">demo</span><span class="token punctuation">(</span><span class="token string">"yes"</span><span class="token punctuation">)</span> <span class="token comment">-- success</span><br><span class="token function">demo</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token comment">-- demo requires a string</span></code></pre><h2 id="input%2Foutput" tabindex="-1">Input/Output</h2><p>To write to stdout, use the <code>print</code> function or the<code>io.write</code> function. Both take any number of arguments.</p><p>The <code>print</code> function adds a tab character between each value and a newline at the end of its output. It can be called with no arguments to only write a newline character.</p><p>The <code>io.write</code> function does not add any characters between values and does not add a newline at the end. Boolean values must be converted to strings before being passed to <code>io.write</code>.</p><p>For example:</p><pre class="language-lua"><code class="language-lua"><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token comment">-- Hello   true    7</span><br>io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">,</span> <span class="token function">tostring</span><span class="token punctuation">(</span><span class="token keyword">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token comment">-- Hellotrue7</span></code></pre><p>To read from stdin, use the <code>io.read</code> function.</p><p>The following code prompts for two numbers and prints their sum.</p><pre class="language-lua"><code class="language-lua">io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"First Number: "</span><span class="token punctuation">)</span><br><span class="token comment">-- This form of `io.read` returns a number or nil if a non-number is entered.</span><br>n1 <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"*number"</span><span class="token punctuation">)</span><br><br>io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"Second Number: "</span><span class="token punctuation">)</span><br>n2 <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"*number"</span><span class="token punctuation">)</span><br><br><span class="token keyword">if</span> n1 <span class="token keyword">and</span> n2 <span class="token keyword">then</span><br>  sum <span class="token operator">=</span> n1 <span class="token operator">+</span> n2<br>  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Sum: "</span> <span class="token operator">..</span> sum<span class="token punctuation">)</span><br><span class="token keyword">else</span><br>  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"An invalid number was entered."</span><span class="token punctuation">)</span><br><span class="token keyword">end</span></code></pre><h2 id="variables" tabindex="-1">Variables</h2><p>Variable names can contain letters, digits, and underscores, but not any other symbols. They cannot start with a digit. In multi-word names the words can be separated by underscores (preferred) or written in camel-case. For example, <code>one_long_name</code> or <code>oneLongName</code>.</p><p>Variable names, function names, and table keys are case-sensitive.</p><p>To assign a value to a variable, use the <code>=</code> operator.</p><p>Variables are global by default. Use the <code>local</code> keyword to make them only exist in their scope. It's too bad the designers didn't choose to make variables local by default and use a <code>global</code> keyword to make them exist outside their scope.</p><p>For example:</p><pre class="language-lua"><code class="language-lua">a <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">-- global, even if assigned inside a function</span><br><span class="token keyword">local</span> b <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment">-- local to the current scope</span></code></pre><p>TODO: What does <code>_G.name = value</code> do?</p><p>Variables with no assigned value have the value <code>nil</code>.</p><p>New values of any type can be assigned to a variable at any time.</p><p>The <code>type(someVar)</code> function returns a string containing the type name of the variable value. This can be <code>nil</code>, <code>boolean</code>, <code>number</code>, <code>string</code>, <code>table</code>, <code>function</code>, or <code>thread</code>. TODO: Is <code>userdata</code> a type?</p><p>Multi-variable assignment is supported. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><br>a<span class="token punctuation">,</span> b <span class="token operator">=</span> b<span class="token punctuation">,</span> a <span class="token comment">-- swaps values</span></code></pre><h2 id="booleans" tabindex="-1">Booleans</h2><p>Boolean literal values are <code>true</code> and <code>false</code>.</p><p>In conditions the only values treated as false are <code>false</code> and <code>nil</code>. The number zero, an empty string, and an empty table are all treated as true.</p><p>Variables can be set to a condition to get a boolean value. For example, <code>is_bigger = my_score &gt; your_score</code> sets <code>is_bigger</code> to <code>true</code> or <code>false</code>.</p><h2 id="numbers" tabindex="-1">Numbers</h2><p>Numbers in Lua are all double precision floating point numbers.</p><h2 id="strings" tabindex="-1">Strings</h2><p>The string type is used single and multiple character text. Lua does not have a dedicated type for single characters.</p><p>Strings can be delimited with either single or double quotes. For example, <code>'Hello World!'</code> or <code>&quot;Hello World!&quot;</code>. This syntax is referred to as a &quot;short literal string&quot;.</p><p>Escaping certain characters by preceding them with a backslash changes how they are interpreted. For example, <code>\n</code> produces a newline character, <code>\t</code> produces a tab character, <code>\&quot;</code> produces a double quote inside a string delimited by double quotes, and <code>\'</code> produces a single quote inside a string delimited by single quotes, and <code>\\</code> produces a backslash character.</p><p>Multiline strings are delimiting with <code>[[</code> and <code>]]</code>. This syntax is referred to as a &quot;long brackets&quot;. A newline after <code>[[</code> is ignored. A newline before <code>]]</code> is not ignored. For example:</p><pre class="language-lua"><code class="language-lua">haiku <span class="token operator">=</span> <span class="token string">[[<br>Out of memory.<br>We wish to hold the sky.<br>But we never will.<br>]]</span></code></pre><p>There can be any number of <code>=</code> characters between the opening and closing square brackets as long as the count matches. For example, <code>[==[some text]==]</code>.</p><p>Newlines and indentation inside the square brackets are retained.</p><p>Strings are indexed starting from 1 instead of 0.</p><p>Use the <code>..</code> operator to concatenate strings. For example, <code>fullName = firstName .. ' ' .. lastName</code>.</p><p>String operations include:</p><ul><li><p>length: <code>string.len(var)</code> or <code>#var</code></p></li><li><p>substring: <code>string.sub(source, startIndex, endIndex)</code> or <code>source:sub(startIndex, endIndex)</code></p></li><li><p>global substitute: <code>string.gsub(source, oldValue, newValue)</code></p><p>This returns a new string and the number of occurrences that were replaced.</p></li><li><p>find start and end index inclusive: <code>string.find(source, target)</code> or <code>source:find(target)</code></p></li><li><p>uppercase: <code>string.upper(var)</code> or <code>var:upper()</code></p></li><li><p>lowercase: <code>string.lower(var)</code> or <code>var:lower()</code></p></li><li><p>pattern matches: <code>string.match(someString, 'pattern')</code> returns a table of matches?</p></li></ul><p>Some common string operations are not directly supported. For example, there are no functions that test whether a string contains, starts with, or ends with a substring. We can define these using the provided <code>find</code> function as follows:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> string<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">)</span><br>  <span class="token keyword">return</span> source<span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">)</span> <span class="token operator">~=</span> <span class="token keyword">nil</span><br><span class="token keyword">end</span><br><br><span class="token keyword">function</span> string<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">)</span><br>  <span class="token keyword">return</span> source<span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><br><span class="token keyword">end</span><br><br><span class="token keyword">function</span> string<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">)</span><br>  startIndex<span class="token punctuation">,</span> endIndex <span class="token operator">=</span> source<span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">)</span><br>  <span class="token keyword">return</span> endIndex <span class="token operator">==</span> <span class="token operator">#</span>source<br><span class="token keyword">end</span><br><br>text <span class="token operator">=</span> <span class="token string">"This is used to test of our new functions."</span><br><br><span class="token comment">-- These functions can be called in two ways.</span><br><span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- true</span><br><span class="token function">print</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- true</span><br><br><span class="token comment">-- More example calls</span><br><span class="token function">print</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"missing"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- false</span><br><span class="token function">print</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"This"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- true</span><br><span class="token function">print</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"Test"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- false</span><br><span class="token function">print</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">"functions."</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- true</span><br><span class="token function">print</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">"test."</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- false</span></code></pre><p>Lua does not support string interpolation. The closest Lua feature to this is the <code>string.format</code> function. It takes a format string as its first argument. This can contain literal text to be output and formatting directives that begin with a percent sign. The supported formatting directives are:</p><ul><li><code>%o</code> for octal numbers</li><li><code>%x</code> for hexadecimal numbers</li><li><code>%d</code> for decimal numbers</li><li><code>%f</code> for floating point numbers</li><li><code>%s</code> for strings</li></ul><p>The <code>%f</code> directive can specify the number of decimal places to output. For example, to output two decimal places use <code>%.2f</code>.</p><p>For example:</p><pre class="language-lua"><code class="language-lua">name <span class="token operator">=</span> <span class="token string">"Mark"</span><br>color <span class="token operator">=</span> <span class="token string">"yellow"</span><br>sentence <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s's favorite color is %s."</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> color<span class="token punctuation">)</span></code></pre><h3 id="patterns" tabindex="-1">Patterns</h3><p>A Lua pattern is a string containing character classes and magic characters. These provided a simpler alternative to regular expressions which are not directly supported in Lua. The code to support patterns is much smaller than the code required to support regular expressions. This is important since one of the goals of Lua to is to be small.</p><p>Patterns are used in the string library functions <code>find</code>, <code>gfind</code>, and <code>gsub</code>.</p><p>The character classes include:</p><table><thead><tr><th>Character Class</th><th>Meaning</th></tr></thead><tbody><tr><td><code>.</code></td><td>all characters</td></tr><tr><td><code>%a</code></td><td>letters</td></tr><tr><td><code>%c</code></td><td>control characters</td></tr><tr><td><code>%d</code></td><td>digits</td></tr><tr><td><code>%l</code></td><td>lower case letters</td></tr><tr><td><code>%p</code></td><td>punctuation characters</td></tr><tr><td><code>%s</code></td><td>space characters</td></tr><tr><td><code>%u</code></td><td>upper case letters</td></tr><tr><td><code>%w</code></td><td>alphanumeric characters</td></tr><tr><td><code>%x</code></td><td>hexadecimal digits</td></tr><tr><td><code>%z</code></td><td>the character with representation 0</td></tr></tbody></table><p>The magic characters include:</p><table><thead><tr><th>Magic Character</th><th>Meaning</th></tr></thead><tbody><tr><td><code>(</code></td><td></td></tr><tr><td><code>)</code></td><td></td></tr><tr><td><code>.</code></td><td></td></tr><tr><td><code>%</code></td><td></td></tr><tr><td><code>+</code></td><td></td></tr><tr><td><code>-</code></td><td></td></tr><tr><td><code>*</code></td><td></td></tr><tr><td><code>?</code></td><td></td></tr><tr><td><code>[</code></td><td></td></tr><tr><td><code>^</code></td><td></td></tr><tr><td><code>$</code></td><td></td></tr></tbody></table><p>TODO: Add content from <a href="https://www.lua.org/pil/20.2.html">https://www.lua.org/pil/20.2.html</a>.</p><h2 id="operators" tabindex="-1">Operators</h2><p>Lua supports the following mathematical operators:</p><ul><li><code>+</code> addition (not string concatenation)</li><li><code>-</code> subtraction or negation</li><li><code>*</code> multiplication</li><li><code>/</code> division</li><li><code>%</code> modulo</li><li><code>^</code> exponentiation</li></ul><p>The <code>++</code> and <code>--</code> operators found in many other programming languages are not supported.</p><p>Lua supports the following relational operators:</p><ul><li><code>==</code> equal</li><li><code>~=</code> not equal (differs from other languages that use <code>!=</code>)</li><li><code>&lt;</code> less than</li><li><code>&gt;</code> greater than</li><li><code>&lt;=</code> less than or equal to</li><li><code>&gt;=</code> greater than or equal to</li></ul><p>Tables are compared by their memory addresses, not by their contents.</p><p>Lua supports the following logical operators:</p><ul><li><code>and</code></li><li><code>or</code></li><li><code>not</code></li></ul><p>Lua only supports one assignment operator which is <code>=</code>. It does not support shorthand assignment operators like <code>+=</code>. Adding a number to a variable must be done with <code>myVar = myVar + n</code>.</p><p>The operator <code>..</code> is used to concatenate strings.</p><p>Lua operators have the following precedence from highest to lowest:</p><ul><li><code>^</code></li><li><code>not</code> and unary <code>-</code></li><li><code>+</code> and binary <code>-</code></li><li><code>..</code></li><li><code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>==</code>, and <code>~=</code></li><li><code>and</code></li><li><code>or</code></li></ul><p>Parentheses can be used to change the evaluation order of parts of a long expression. For example, <code>(a + b) / (c - d)</code> is evaluated differently than <code>a + b / c - d</code>.</p><p>All operators are left associative except for <code>^</code> and <code>..</code> which are right associative. For example, <code>2 ^ 2 ^ 3</code> is the same as <code>2 ^ 8</code> and not <code>4 ^ 3</code>.</p><h2 id="conditional-logic" tabindex="-1">Conditional Logic</h2><p>Parentheses are not required around conditions.</p><p>In an <code>if</code> statement, the <code>elseif</code> and <code>else</code> blocks shown below are optional.</p><p>All the parts of the <code>if</code> statement can be written on a single line if desired.</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">if</span> condition <span class="token keyword">then</span><br>  <span class="token punctuation">...</span><br><span class="token keyword">elseif</span> condition <span class="token keyword">then</span><br>  <span class="token punctuation">...</span><br><span class="token keyword">else</span><br>  <span class="token punctuation">...</span><br><span class="token keyword">end</span></code></pre><p>Lua does not have a <code>switch</code> statement or an equivalent.</p><p>Lua does not have a ternary operator, but the same functionality can be achieved with the following:</p><pre class="language-lua"><code class="language-lua">let result <span class="token operator">=</span> condition <span class="token keyword">and</span> trueValue <span class="token keyword">or</span> falseValue</code></pre><h2 id="iteration" tabindex="-1">Iteration</h2><pre class="language-lua"><code class="language-lua"><span class="token comment">-- Use a `for` loop to iterate over a range of numbers with a given step size.</span><br><span class="token comment">-- The loop variable, `i` in this case, is local to the loop</span><br><span class="token comment">-- and cannot be accessed outside it.</span><br><span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token keyword">do</span><br>  <span class="token punctuation">...</span><br><span class="token keyword">end</span><br><br><span class="token comment">-- Use a `for` loop to iterate over the key/value pairs in a table.</span><br><span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>mytable<span class="token punctuation">)</span> <span class="token keyword">do</span><br>  <span class="token punctuation">...</span><br><span class="token keyword">end</span><br><br><span class="token comment">-- Use a `for` loop to iterate over the indexes and values pairs</span><br><span class="token comment">-- in a table whose keys are consecutive integers starting at 1.</span><br><span class="token keyword">for</span> index<span class="token punctuation">,</span> value <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>mytable<span class="token punctuation">)</span> <span class="token keyword">do</span><br>  <span class="token punctuation">...</span><br><span class="token keyword">end</span><br><br><span class="token comment">-- Use a `while` loop for a top-tested loop</span><br><span class="token comment">-- that stops when a given condition is no longer true.</span><br><span class="token keyword">while</span> condition <span class="token keyword">do</span><br>  <span class="token punctuation">...</span><br><span class="token keyword">end</span><br><br><span class="token comment">-- Use a `repeat`/`until` loop for a bottom-tested loop</span><br><span class="token comment">-- that stops when a given condition becomes true.</span><br><span class="token comment">-- The body is guaranteed to run at least once.</span><br><span class="token keyword">repeat</span> — bottom<span class="token operator">-</span>tested<br>  <span class="token punctuation">...</span><br><span class="token keyword">until</span> condition</code></pre><p>Loops can use the <code>break</code> keyword to exit, but the <code>continue</code> keyword for advancing to the next iteration is not currently supported.</p><h2 id="functions" tabindex="-1">Functions</h2><p>Functions are defined with the <code>function</code> keyword. This is longest keyword in Lua. It's too bad the designers didn't choose a shorter keyword like <code>func</code>, <code>fun</code>, or <code>fn</code>.</p><p>Parameters are specified in parentheses after the function name and are separated by commas.</p><p>For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><br>  <span class="token keyword">return</span> n1 <span class="token operator">+</span> n2<br><span class="token keyword">end</span><br><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 5</span></code></pre><p>The function definition above is just syntactic sugar for <code>add = function (n1, n2) return n1 + n2 end</code></p><p>From the Lua reference manual:</p><blockquote><p>A call of the form f{fields} is syntactic sugar for f({fields}); that is, the argument list is a single new table. A call of the form f'string' (or f&quot;string&quot; or f[[string]]) is syntactic sugar for f('string'); that is, the argument list is a single literal string.</p></blockquote><p>This means that if a function has only one argument and the argument is either a literal string or a table constructor, calls to the function do not require parentheses.</p><p>To avoid writing functions that take a large number of arguments, use a parameter that expects a table. This simulates having named arguments and allows values to be specified in any order. Table entries with no key (array-like) can be thought of as positional parameters and table entries with a key can be thought of as named parameters.</p><p>Primitive parameters are passed by value and tables are passed by reference. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> n<span class="token punctuation">,</span> s<span class="token punctuation">,</span> t<span class="token punctuation">)</span><br>  b <span class="token operator">=</span> <span class="token keyword">true</span><br>  n <span class="token operator">=</span> <span class="token number">2</span><br>  s <span class="token operator">=</span> <span class="token string">"yes"</span><br>  t<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">2</span><br><span class="token keyword">end</span><br><br>b <span class="token operator">=</span> <span class="token keyword">false</span><br>n <span class="token operator">=</span> <span class="token number">1</span><br>s <span class="token operator">=</span> <span class="token string">"no"</span><br>t <span class="token operator">=</span> <span class="token punctuation">{</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">}</span><br><span class="token function">foo</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> n<span class="token punctuation">,</span> s<span class="token punctuation">,</span> t<span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> n<span class="token punctuation">,</span> s<span class="token punctuation">,</span> t<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token comment">-- false 1 no 2</span></code></pre><p>Functions in Lua are first-class. This means they can take other functions as arguments and can return functions.</p><p>Functions can return multiple values. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">getStooges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token keyword">return</span> <span class="token string">"Moe"</span><span class="token punctuation">,</span> <span class="token string">"Larry"</span><span class="token punctuation">,</span> <span class="token string">"Curly"</span><br><span class="token keyword">end</span><br><br>s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> s3 <span class="token operator">=</span> <span class="token function">getStooges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> s3<span class="token punctuation">)</span> <span class="token comment">-- Moe Larry Curly</span></code></pre><p>Functions can take a variable number of arguments. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">...</span><span class="token punctuation">)</span><br>  <span class="token keyword">local</span> sum <span class="token operator">=</span> <span class="token number">0</span><br>  <span class="token keyword">local</span> args <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token punctuation">}</span> <span class="token comment">-- creates a table containing the arguments</span><br>  <span class="token keyword">for</span> _<span class="token punctuation">,</span> n <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token keyword">do</span><br>    sum <span class="token operator">=</span> sum <span class="token operator">+</span> n<br>  <span class="token keyword">end</span><br>  <span class="token keyword">return</span> sum<br><span class="token keyword">end</span><br><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"The sum is "</span> <span class="token operator">..</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">..</span> <span class="token string">"."</span><span class="token punctuation">)</span> <span class="token comment">-- 6</span><br><br><span class="token keyword">function</span> <span class="token function">report</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span><br>  <span class="token keyword">local</span> count <span class="token operator">=</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token string">"#"</span><span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span><br>  <span class="token keyword">local</span> text <span class="token operator">=</span> <span class="token string">"%s is %d years old and likes %d things.\nThey are"</span><br>  <span class="token keyword">local</span> s <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> count<span class="token punctuation">)</span><br>  <span class="token keyword">local</span> things <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token punctuation">}</span><br>  <span class="token keyword">for</span> index<span class="token punctuation">,</span> thing <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>things<span class="token punctuation">)</span> <span class="token keyword">do</span><br>    <span class="token keyword">local</span> prefix <span class="token operator">=</span> <span class="token string">" "</span><br>    <span class="token keyword">if</span> index <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">then</span><br>      prefix <span class="token operator">=</span> <span class="token string">" "</span><br>    <span class="token keyword">elseif</span> index <span class="token operator">></span> <span class="token number">1</span> <span class="token keyword">and</span> index <span class="token operator">&lt;</span> count <span class="token keyword">then</span><br>      prefix <span class="token operator">=</span> <span class="token string">", "</span><br>    <span class="token keyword">else</span><br>      prefix <span class="token operator">=</span> <span class="token string">", and "</span><br>    <span class="token keyword">end</span><br>    s <span class="token operator">=</span> s <span class="token operator">..</span> prefix <span class="token operator">..</span> thing<br>  <span class="token keyword">end</span><br>  <span class="token keyword">return</span> s <span class="token operator">..</span> <span class="token string">"."</span><br><span class="token keyword">end</span><br><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">report</span><span class="token punctuation">(</span><span class="token string">"Mark"</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token string">"running"</span><span class="token punctuation">,</span> <span class="token string">"biking"</span><span class="token punctuation">,</span> <span class="token string">"programming"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token comment">-- Mark is 61 years old and likes 3 things.</span><br><span class="token comment">-- They are running, biking, and programming.</span></code></pre><p>Anonymous functions (unnamed) are closures and can be stored in variables. For example:</p><pre class="language-lua"><code class="language-lua">product <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><br>  <span class="token keyword">return</span> n1 <span class="token operator">*</span> n2<br><span class="token keyword">end</span><br><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">product</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 6</span></code></pre><p>There are two ways to call functions defined in a module/library.</p><pre class="language-lua"><code class="language-lua"><span class="token comment">-- Approach #1</span><br>library_name<span class="token punctuation">.</span><span class="token function">function_name</span><span class="token punctuation">(</span>target_value<span class="token punctuation">,</span> arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span><br><br><span class="token comment">-- Approach #2</span><br><span class="token comment">-- This implicitly passes `target_value` as the first argument.</span><br><span class="token comment">-- Does this only work when the type of `target_value`</span><br><span class="token comment">-- matches `library_name`?</span><br>TODO<span class="token punctuation">:</span> I'm still confused about this usage!<br>target_value<span class="token punctuation">:</span><span class="token function">function_name</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span></code></pre><h2 id="default-parameter-values" tabindex="-1">Default Parameter Values</h2><p>Lua does not provide an explicit way to define default values for function parameters. A workaround is to implement a function to have table parameter and specify default values in that table using the <code>setmetatable</code> function.</p><p>For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">volume</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><br>  <span class="token comment">-- This supplies default values for missing keys in the table t.</span><br>  <span class="token function">setmetatable</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token punctuation">{</span>__index<span class="token operator">=</span><span class="token punctuation">{</span>width<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> depth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token keyword">return</span> t<span class="token punctuation">.</span>width <span class="token operator">*</span> t<span class="token punctuation">.</span>height <span class="token operator">*</span> t<span class="token punctuation">.</span>depth<br><span class="token keyword">end</span><br><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">volume</span><span class="token punctuation">(</span><span class="token punctuation">{</span>width<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> depth<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 24</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">volume</span><span class="token punctuation">(</span><span class="token punctuation">{</span>width<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 6</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">volume</span><span class="token punctuation">(</span><span class="token punctuation">{</span>width<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> depth<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 8</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">volume</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 1</span></code></pre><p>It's debatable whether this is better than the following approach that achieves the same result without using a metatable:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">volume</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><br>  <span class="token keyword">local</span> w <span class="token operator">=</span> t<span class="token punctuation">.</span>width <span class="token keyword">or</span> <span class="token number">1</span><br>  <span class="token keyword">local</span> h <span class="token operator">=</span> t<span class="token punctuation">.</span>height <span class="token keyword">or</span> <span class="token number">1</span><br>  <span class="token keyword">local</span> d <span class="token operator">=</span> t<span class="token punctuation">.</span>depth <span class="token keyword">or</span> <span class="token number">1</span><br>  <span class="token keyword">return</span> w <span class="token operator">*</span> h <span class="token operator">*</span> d<br><span class="token keyword">end</span></code></pre><p>The <code>volume</code> function could also be implemented as follows:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">volume</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><br>  <span class="token keyword">return</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>width <span class="token keyword">or</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>height <span class="token keyword">or</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>depth <span class="token keyword">or</span> <span class="token number">1</span><span class="token punctuation">)</span><br><span class="token keyword">end</span></code></pre><h2 id="utility-functions" tabindex="-1">Utility Functions</h2><p>The following functions are helpful for debugging. They can be defined in a file like <code>utility.lua</code> and required where needed.</p><pre class="language-lua"><code class="language-lua"><span class="token comment">-- Returns a string description of the keys and values in a table.</span><br><span class="token comment">-- Values can be nested tables.</span><br><span class="token keyword">function</span> <span class="token function">dump</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><br>  <span class="token keyword">if</span> <span class="token function">type</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">~=</span> <span class="token string">"table"</span> <span class="token keyword">then</span><br>    <span class="token keyword">return</span> <span class="token function">tostring</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br><br>  <span class="token keyword">local</span> s <span class="token operator">=</span> <span class="token string">"{ "</span><br>  <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token keyword">do</span><br>    <span class="token keyword">if</span> <span class="token function">type</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">~=</span> <span class="token string">"number"</span> <span class="token keyword">then</span><br>      k <span class="token operator">=</span> <span class="token string">"\""</span> <span class="token operator">..</span> k <span class="token operator">..</span> <span class="token string">"\""</span><br>    <span class="token keyword">end</span><br>    s <span class="token operator">=</span> s <span class="token operator">..</span> k <span class="token operator">..</span> <span class="token string">"="</span> <span class="token operator">..</span> <span class="token function">dump</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">..</span> <span class="token string">", "</span> <span class="token comment">-- recursive</span><br>  <span class="token keyword">end</span><br>  <span class="token keyword">return</span> s <span class="token operator">..</span> <span class="token string">"} "</span><br><span class="token keyword">end</span><br><br><span class="token comment">-- Returns a string containing all the values in a table,</span><br><span class="token comment">-- each separated by a comma and a space.</span><br><span class="token comment">-- Values cannot be nested tables.</span><br><span class="token keyword">function</span> <span class="token function">valuesString</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><br>  <span class="token keyword">if</span> <span class="token function">type</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">~=</span> <span class="token string">"table"</span> <span class="token keyword">then</span><br>    <span class="token keyword">return</span> <span class="token string">""</span><br>  <span class="token keyword">end</span><br><br>  s <span class="token operator">=</span> <span class="token string">""</span><br>  <span class="token keyword">for</span> index<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token keyword">do</span><br>    s <span class="token operator">=</span> s <span class="token operator">..</span> v <span class="token operator">..</span> <span class="token string">", "</span><br>  <span class="token keyword">end</span><br>  <span class="token keyword">return</span> s<span class="token punctuation">:</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><br><span class="token keyword">end</span></code></pre><h2 id="data-structures" tabindex="-1">Data Structures</h2><p>Lua only provides one data structure called a &quot;table&quot;. It is used to represent arrays, dictionaries, trees, and graphs.</p><p>Lua does not support defining classes. Instead it uses a combination of tables and functions for everything. However, the combination of functions, tables, and metatables can be used to simulate classes. See the &quot;Metatables&quot; section for details.</p><h3 id="tables" tabindex="-1">Tables</h3><p>A Lua table is an associative array. They can be array-like, dictionary-like, or both.</p><p>To create a table that is array-like, provide a comma-separated values inside curly braces. Curly braces are only used to construct tables. They are not used to delimit blocks of code.</p><p><em>Implementation Detail from <a href="https://www.lua.org/gems/?v=1.0.20" rel="noopener" target="_blank">Lua Programming Gems</a></em></p><blockquote><p>&quot;Every table in Lua has two parts: the array part and the hash part. The array part stores entries with integer keys in the range 1 to n, for some particular n. All other entries (including integer keys outside that range) go to the hash part.&quot;</p></blockquote><p>For example:</p><pre class="language-lua"><code class="language-lua">scores <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">}</span><br><br>names <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"Mark"</span><span class="token punctuation">,</span> <span class="token string">"Tami"</span><span class="token punctuation">}</span></code></pre><p>Assigning a table to a variable assigns the reference, not a copy of the table.</p><p>To create a table that is dictionary-like, provide keys and values inside curly braces. Each key is followed by <code>=</code> and its value.</p><p>Keys can be any value except <code>nil</code>, including other tables. String keys only require quotes if they contain special characters such as spaces. Non-string keys and string keys in quotes must be enclosed in square brackets.</p><p>Values can be of any type, including other tables. String values must be enclosed in quotes.</p><p>For example:</p><pre class="language-lua"><code class="language-lua">scores <span class="token operator">=</span> <span class="token punctuation">{</span>Mark<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> Tami<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"Unknown Player"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">}</span> <span class="token comment">-- uses string keys</span><br><br>words <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token keyword">true</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"yes"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token keyword">false</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"no"</span><span class="token punctuation">}</span> <span class="token comment">-- uses boolean keys</span><br><br>months <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"January"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"February"</span><span class="token punctuation">}</span> <span class="token comment">-- uses integer keys</span><br><br><span class="token comment">-- This has the same result as the previous line,</span><br><span class="token comment">-- but values are specified without keys.</span><br><span class="token comment">-- Integer keys are provided starting from 1.</span><br>months <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"January"</span><span class="token punctuation">,</span> <span class="token string">"February"</span><span class="token punctuation">}</span></code></pre><p>To create a table that is both array-like and dictionary-like, provide some values with keys and some values without. Each value without a key is assigned a consecutive index key starting from 1. For example:</p><pre class="language-lua"><code class="language-lua">mixed <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"apple"</span><span class="token punctuation">,</span> month<span class="token operator">=</span><span class="token string">"April"</span><span class="token punctuation">,</span> <span class="token string">"banana"</span><span class="token punctuation">,</span> season<span class="token operator">=</span><span class="token string">"Spring"</span><span class="token punctuation">,</span> <span class="token string">"cherry"</span> <span class="token punctuation">}</span><br><span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>mixed<span class="token punctuation">)</span> <span class="token keyword">do</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><br><span class="token keyword">end</span><br><span class="token comment">-- Output is:</span><br><span class="token comment">-- 1	apple</span><br><span class="token comment">-- 2	banana</span><br><span class="token comment">-- 3	cherry</span><br><span class="token comment">-- month	April</span><br><span class="token comment">-- season	Spring</span></code></pre><p>The keys and values in tables can be any kind of value including other tables nested to any level.</p><p>There are two ways to assign a key/value pair to a table.</p><pre class="language-lua"><code class="language-lua">point <span class="token operator">=</span> <span class="token punctuation">{</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">}</span><br>point<span class="token punctuation">[</span><span class="token string">"x"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><br><br><span class="token comment">-- If the key is a valid variable name then</span><br><span class="token comment">-- a value can be assigned using a dot as follows:</span><br>point<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">-- same as previous line</span></code></pre><p>An empty table can be created and filled later. For example:</p><pre class="language-lua"><code class="language-lua">fill_later <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">-- creates an empty table</span><br><br>fill_later<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Hello"</span><br>fill_later<span class="token punctuation">[</span><span class="token string">"condition"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"sunny"</span><br>fill_later<span class="token punctuation">.</span>condition <span class="token operator">=</span> <span class="token string">"sunny"</span> <span class="token comment">-- sames</span></code></pre><p>To get the value corresponding to a table key, use square brackets as follows:</p><pre class="language-lua"><code class="language-lua"><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Tami's score is "</span> <span class="token operator">..</span> scores<span class="token punctuation">[</span><span class="token string">"Tami"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">-- 7</span><br><br><span class="token comment">-- When a key is not found, the value returned is `nil`.</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Mary's score is "</span> <span class="token operator">..</span> <span class="token punctuation">(</span>scores<span class="token punctuation">[</span><span class="token string">"Mary"</span><span class="token punctuation">]</span> <span class="token keyword">or</span> <span class="token string">"unknown"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- unknown</span><br><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"The second month is "</span> <span class="token operator">..</span> months<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">..</span> <span class="token string">"."</span><span class="token punctuation">)</span> <span class="token comment">-- February</span></code></pre><p>To iterate over keys and values, use a <code>for</code> loop with the <code>pairs</code> or <code>ipairs</code> function.</p><p>The <code>pairs</code> function visits all the key/value pairs, but not necessarily in the order in which they were added to the table.</p><p>The <code>ipairs</code> function is intended for iterating over array-like tables. It only visits the consecutive integer keys starting with <code>1</code>. As soon as it fails to find the next integer key, it stops.</p><p>The code below demonstrates these functions and also shows that a table can be both array-like AND dictionary-like.</p><pre class="language-lua"><code class="language-lua"><span class="token comment">-- The entries `5` and `3` are array-like.</span><br><span class="token comment">-- `5` is assigned the key `1` because it is the first array-like entry.</span><br><span class="token comment">-- `3` is assigned the key `2` because it is the second array-like entry.</span><br><span class="token comment">-- The entries `foo=2` and `bar=4` are dictionary-like.</span><br>t <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span> foo<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> bar<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">}</span><br><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"keys and values"</span><span class="token punctuation">)</span><br><span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">do</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><br><span class="token keyword">end</span><br><span class="token comment">-- 1       5</span><br><span class="token comment">-- 2       3</span><br><span class="token comment">-- bar     4</span><br><span class="token comment">-- foo     2</span><br><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"indexes and values"</span><span class="token punctuation">)</span><br><span class="token keyword">for</span> i<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">do</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> v<span class="token punctuation">)</span><br><span class="token keyword">end</span><br><span class="token comment">-- 1       5</span><br><span class="token comment">-- 2       3</span></code></pre><p>The <code>table.insert</code> function inserts an array-like entry so the array-like entries past the insertion point move up by one. This can be expensive if a large number of entries need to be moved. For example:</p><pre class="language-lua"><code class="language-lua">names <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"Mark"</span><span class="token punctuation">,</span> <span class="token string">"Tami"</span><span class="token punctuation">}</span><br>table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"Comet"</span><span class="token punctuation">)</span> <span class="token comment">-- Mark Comet Tami</span><br>table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token string">"Bob"</span><span class="token punctuation">)</span> <span class="token comment">-- pushes onto end; Mark Comet Tami Bob</span></code></pre><p>The <code>table.remove</code> function removes an array-like entry so the array-like entries past the removal point move down by one. This can be expensive if a large number of entries need to be moved. For example:</p><pre class="language-lua"><code class="language-lua">names <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"Mark"</span><span class="token punctuation">,</span> <span class="token string">"Comet"</span><span class="token punctuation">,</span> <span class="token string">"Tami"</span><span class="token punctuation">,</span> <span class="token string">"Bob"</span><span class="token punctuation">}</span><br>table<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">-- changes to Mark Tami Bob and returns Comet</span><br><span class="token comment">-- Omitting the index pops the last entry.</span><br>last_name <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>names<span class="token punctuation">)</span> <span class="token comment">-- changes to Mark Tami and returns Bob</span></code></pre><p>To remove a dictionary-like entry, set its value to <code>nil</code>. For example:</p><pre class="language-lua"><code class="language-lua">scores<span class="token punctuation">[</span><span class="token string">"Mark"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">nil</span></code></pre><p>The <code>table.concat</code> function returns a string created by concatenating all of its array-like values using a given delimiter. This only includes values for consecutive integer keys starting from one. For example:</p><pre class="language-lua"><code class="language-lua">t <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"Mark"</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">"Tami"</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">}</span><br><span class="token function">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">" and "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- "Mark and 7 and Tami and 9"</span><br>t <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span> foo<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> bar<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">}</span><br><span class="token function">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">" and "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 5 and 3</span></code></pre><p>The <code>table.sort</code> function sorts an array-like table in place. For example:</p><pre class="language-lua"><code class="language-lua">names <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"Tami"</span><span class="token punctuation">,</span> <span class="token string">"Mark"</span><span class="token punctuation">,</span> <span class="token string">"Amanda"</span><span class="token punctuation">,</span> <span class="token string">"Jeremy"</span><span class="token punctuation">}</span><br><br><span class="token comment">-- When no comparator function is specified,</span><br><span class="token comment">-- the values are compared using the `&lt;` operator.</span><br>table<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>names<span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token string">", "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- Amanda, Jeremy, Mark, Tami</span><br><br><span class="token comment">-- This specifies a comparator function.</span><br><span class="token comment">-- Values with the same length are sorted using the `&lt;` operator.</span><br><span class="token comment">-- When values lengths differ, shorter lengths come first.</span><br>table<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><br>  <span class="token keyword">if</span> <span class="token operator">#</span>a <span class="token operator">==</span> <span class="token operator">#</span>b <span class="token keyword">then</span><br>    <span class="token keyword">return</span> a <span class="token operator">&lt;</span> b<br>  <span class="token keyword">else</span><br>    <span class="token keyword">return</span> <span class="token operator">#</span>a <span class="token operator">&lt;</span> <span class="token operator">#</span>b<br>  <span class="token keyword">end</span><br><span class="token keyword">end</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token string">", "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- Mark, Tami, Amanda, Jeremy</span></code></pre><p>To get the length of an array-like table, use <code>#my_table</code>. The returns the highest consecutive integer index starting from <code>1</code>.</p><p>Dictionary-like tables do not store their number of entries. To get the count it is necessary to iterate over the table and count them. The &quot;Lua Functional&quot; library described later defines a <code>length</code> function for computing the size of a table, but it has O(n) complexity.</p><p>The <code>table.pack</code> function provides another way to create an array-like table that adds the key <code>n</code> which holds the number of entries. The value of the <code>n</code> is not updated when entries are inserted or removed. For example:</p><pre class="language-lua"><code class="language-lua">t <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">pack</span><span class="token punctuation">(</span><span class="token string">"Mark"</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">"Tami"</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>n<span class="token punctuation">)</span> <span class="token comment">-- 4</span></code></pre><p>The <code>table.unpack</code> function returns consecutive array-like entries with keys starting from <code>1</code>. It does not work with dictionary-like tables. For example:</p><pre class="language-lua"><code class="language-lua">names <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"Mark"</span><span class="token punctuation">,</span> <span class="token string">"Tami"</span><span class="token punctuation">,</span> <span class="token string">"Comet"</span><span class="token punctuation">}</span><br>father<span class="token punctuation">,</span> mother<span class="token punctuation">,</span> dog <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">unpack</span><span class="token punctuation">(</span>names<span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>father<span class="token punctuation">,</span> mother<span class="token punctuation">,</span> dog<span class="token punctuation">)</span> <span class="token comment">-- Mark    Tami    Comet</span><br><span class="token function">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">unpack</span><span class="token punctuation">(</span>names<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- same</span></code></pre><p>Table values can be other tables. This supports creating the equivalent of multi-dimensional arrays. For example:</p><pre class="language-lua"><code class="language-lua">my2d <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br>my2d<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br>my2D<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"some-value"</span><br><span class="token function">print</span><span class="token punctuation">(</span>my2D<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">-- "some-value"</span><br><br>points <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><span class="token function">print</span><span class="token punctuation">(</span>points<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token comment">-- 5</span></code></pre><p>When passing a single table to a function, it is not necessary to include parentheses. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">dump_table</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><br>  <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">do</span><br>    <span class="token function">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br><span class="token keyword">end</span><br><br><span class="token function">dump_table</span><span class="token punctuation">(</span><span class="token punctuation">{</span>foo<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> bar<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token function">dump_table</span><span class="token punctuation">{</span>foo<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> bar<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">}</span> <span class="token comment">-- same as previous line</span></code></pre><p>The <code>table.move</code> function copies entries from one array-like table to another. It does not remove entries from the source table. Existing destination table entries at target indexes are replaced.</p><p>For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">dump</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><br>  <span class="token keyword">for</span> _<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">do</span><br>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"  "</span> <span class="token operator">..</span> v<span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br><span class="token keyword">end</span><br><br>t1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><br>t2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">}</span><br><span class="token comment">-- Copy table t1 elements 1 to 3 into table t2 starting at 4.</span><br><span class="token comment">-- The arguments are source table, start index, end index,</span><br><span class="token comment">-- destination index, and destination table.</span><br>table<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> t2<span class="token punctuation">)</span><br><span class="token function">dump</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span> <span class="token comment">-- 1 2 3</span><br><span class="token function">dump</span><span class="token punctuation">(</span>t2<span class="token punctuation">)</span> <span class="token comment">-- 4 5 1 2 3; existing value 6 was replaced with 1</span></code></pre><h2 id="self-parameter" tabindex="-1">self Parameter</h2><p>Tables can have entries where the key is a function name and the value is a function. These can be defined inside a table literal or outside.</p><p>There are two syntaxes for defining table functions outside a table literal:</p><ul><li><code>MyTable.my_function(p1, p2)</code> referred to below as a &quot;dot function&quot;</li><li><code>MyTable:my_function(p1, p2)</code> referred to below as a &quot;colon function&quot;</li></ul><p>Dot functions are somewhat like object-oriented class methods. They can be called with a dot and sometimes with a colon. For example:</p><pre class="language-lua"><code class="language-lua">MyTable<span class="token punctuation">.</span><span class="token function">my_function</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><br><br><span class="token comment">-- Using a colon is only allowed when v1 has its metatable set to MyTable.</span><br>v1<span class="token punctuation">:</span><span class="token function">my_function</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span></code></pre><p>Colon functions are like object-oriented instance methods. They are supplied with a hidden first parameter named <code>self</code>, whereas dot functions are not.</p><p>Colon functions should always be called with a colon, not a dot. For example, <code>MyTable:my_function(v1, v2)</code>.</p><p>The following code demonstrates defining and calling dot functions and colon functions.</p><pre class="language-lua"><code class="language-lua">MyTable <span class="token operator">=</span> <span class="token punctuation">{</span><br>  dotInner <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span><br>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"dotInner p1 ="</span><span class="token punctuation">,</span> p1<span class="token punctuation">)</span><br>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"dotInner p2 ="</span><span class="token punctuation">,</span> p2<span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br><span class="token punctuation">}</span><br><br>MyTable<span class="token punctuation">.</span><span class="token function">dotInner</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">-- p1 = 1, p2 = 2</span><br><br><span class="token comment">-- This is an alternate way to write the dotInner function,</span><br><span class="token comment">-- defining it outside the table literal.</span><br><span class="token comment">-- The `self` variable is not defined in dot functions.</span><br><span class="token keyword">function</span> MyTable<span class="token punctuation">.</span><span class="token function">dotOuter</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span><br>  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"dotInner p1 ="</span><span class="token punctuation">,</span> p1<span class="token punctuation">)</span><br>  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"dotInner p2 ="</span><span class="token punctuation">,</span> p2<span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br>MyTable<span class="token punctuation">.</span><span class="token function">dotOuter</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">-- p1 = 1, p2 = 2</span><br><br><span class="token comment">-- Here dotOuter is called with a colon.</span><br><span class="token comment">-- Calling any function using a colon causes the variable</span><br><span class="token comment">-- before the colon to be passed as the first argument.</span><br><span class="token comment">-- This makes 1 the second argument and 2 the third.</span><br><span class="token comment">-- Dot function should never be called like this.</span><br>MyTable<span class="token punctuation">:</span><span class="token function">dotOuter</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">-- p1 = MyTable, p2 = 1, last argument 2 is ignored</span><br><br><span class="token comment">-- Colon functions have an invisible first parameter named "self".</span><br><span class="token comment">-- So p1 here is actually the second parameter and p2 is the third.</span><br><span class="token comment">-- When a colon function is called using a colon,</span><br><span class="token comment">-- the variable before the colon is passed as the first argument.</span><br><span class="token comment">-- It seems colon functions cannot be defined inside a table literal.</span><br><span class="token keyword">function</span> MyTable<span class="token punctuation">:</span><span class="token function">colonOuter</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span><br>  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"colonOuter self ="</span><span class="token punctuation">,</span> self<span class="token punctuation">)</span><br>  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"colonOuterFn p1 ="</span><span class="token punctuation">,</span> p1<span class="token punctuation">)</span><br>  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"colorOuterFn p2 ="</span><span class="token punctuation">,</span> p2<span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br><span class="token comment">-- Here colonOuter is called without a colon,</span><br><span class="token comment">-- so MyTable is not passed as the first argument.</span><br><span class="token comment">-- Colon functions should never be called like this.</span><br>MyTable<span class="token punctuation">.</span><span class="token function">colonOuter</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">-- self = 1, p1 = 2, p2 = 3</span><br><br><span class="token comment">-- Here colonOuter is called with a colon,</span><br><span class="token comment">-- so MyTable is passed as the first argument.</span><br><span class="token comment">-- Colon functions should always be called like this.</span><br>MyTable<span class="token punctuation">:</span><span class="token function">colonOuter</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">-- self = MyTable, p1 = 1, p2 = 2</span><br><br><span class="token comment">-- This is equivalent to the previous line.</span><br><span class="token comment">-- While this works, it is overly verbose.</span><br>MyTable<span class="token punctuation">.</span><span class="token function">colonOuter</span><span class="token punctuation">(</span>MyTable<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">-- self = MyTable, p1 = 1, p2 = 2</span></code></pre><h2 id="metatables" tabindex="-1">Metatables</h2><p>A metatable is a table that defines metamethods. All metamethods have names that begin with two underscores. Examples include <code>__tostring</code> which defines the string representation of a table, <code>__add</code> which defines how the <code>+</code> operator adds a value to a table, and <code>__index</code> which determines the value that should be returned when an attempt is made to access a missing key in a table.</p><p>By default tables do not have a metatable. A metatable only becomes useful when it is assigned to a table. This is done with the <code>setmetatable(table, metatable)</code> function. The same metatable can be assigned to multiple tables.</p><p>The <code>setmetatable</code> function returns its first argument which is useful when a literal table is passed.</p><p>The <code>getmetatable(table)</code> function returns the metatable that has been assigned to a given table or <code>nil</code> if one has not been assigned.</p><p>The <code>__index</code> method can be implemented in two ways. It can be a table that supplies default values for missing properties or it can be a function that is passed a table and a key. We will see both approaches below.</p><p>TODO: Get examples from metatables.lua!</p><p>TODO: Add much more here!</p><h3 id="table-delegation" tabindex="-1">Table Delegation</h3><p>The simplest use of metatables is to associated one with a single table. The following code demonstrates this.</p><pre class="language-lua"><code class="language-lua">my_table <span class="token operator">=</span> <span class="token punctuation">{</span>alpha <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">}</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">getmetatable</span><span class="token punctuation">(</span>my_table<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- nil; no metatable assigned yet</span><br><br><span class="token comment">-- Create a metatable containing one metamethod named `__index`.</span><br><span class="token comment">-- Its value is a table holding default key/value pairs.</span><br>my_metatable <span class="token operator">=</span> <span class="token punctuation">{</span>__index <span class="token operator">=</span> <span class="token punctuation">{</span>alpha <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> beta <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">}</span><br><br><span class="token comment">-- Associated the metatable with the table.</span><br><span class="token function">setmetatable</span><span class="token punctuation">(</span>my_table<span class="token punctuation">,</span> my_metatable<span class="token punctuation">)</span><br><br><span class="token function">print</span><span class="token punctuation">(</span>my_table<span class="token punctuation">.</span>alpha<span class="token punctuation">,</span> my_table<span class="token punctuation">.</span>beta<span class="token punctuation">,</span> my_table<span class="token punctuation">.</span>gamma<span class="token punctuation">)</span> <span class="token comment">-- 7 2 nil</span></code></pre><p>There is no need to hold the metatable in a variable. It can be assigned directly to the table as follows:</p><pre class="language-lua"><code class="language-lua"><span class="token function">setmetatable</span><span class="token punctuation">(</span>my_table<span class="token punctuation">,</span> <span class="token punctuation">{</span>__index <span class="token operator">=</span> <span class="token punctuation">{</span>alpha <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> beta <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>Instead of defining a separate table for the metatable, we can make the table serve as its own metatable as follows:</p><pre class="language-lua"><code class="language-lua">my_table<span class="token punctuation">.</span>__index <span class="token operator">=</span> <span class="token punctuation">{</span>alpha <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> beta <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">}</span><br><span class="token function">setmetatable</span><span class="token punctuation">(</span>my_table<span class="token punctuation">,</span> my_table<span class="token punctuation">)</span></code></pre><p>All these variations produce the same results. A downside is that you many encounter all of these approaches in code that others write, so it is necessary to understand all of them.</p><h3 id="classes" tabindex="-1">Classes</h3><p>Lua does include support for defining classes and creating instances. However, these can be simulated using a combination of tables, metatables, and function.</p><p>A class can be represented by a table. A <code>new</code> function can be added to the table and used to create instances which are represented by new tables. There is nothing special about the name &quot;new&quot;, but many other programming languages use that name for creating instances of a class, so it's a good idea to stick with that convention.</p><p>The <code>new</code> function should:</p><ul><li>Create a new table to represent the instance OR use a table that is passed in.</li><li>Associated a metatable with the new table that holds default property values and functions that act as methods of the class.</li><li>Return the table that represents the instance.</li></ul><p>There are a few common approaches for implementing all of this.</p><p>Approach #1:</p><p>The metatable can be a separate table defined outside the <code>new</code> function in a variable.</p><pre class="language-lua"><code class="language-lua"><span class="token comment">-- Define a Shape class.</span><br>Shape <span class="token operator">=</span> <span class="token punctuation">{</span>name <span class="token operator">=</span> <span class="token string">"unknown"</span><span class="token punctuation">,</span> sides <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">}</span><br><span class="token keyword">local</span> metatable <span class="token operator">=</span> <span class="token punctuation">{</span>__index <span class="token operator">=</span> Shape<span class="token punctuation">}</span><br><br><span class="token comment">-- Constructor</span><br><span class="token keyword">function</span> Shape<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> sides<span class="token punctuation">)</span><br>  <span class="token keyword">local</span> instance <span class="token operator">=</span> <span class="token function">setmetatable</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> metatable<span class="token punctuation">)</span><br>  instance<span class="token punctuation">.</span>name <span class="token operator">=</span> name<br>  instance<span class="token punctuation">.</span>sides <span class="token operator">=</span> sides<br>  <span class="token keyword">return</span> instance<br><span class="token keyword">end</span><br><br><span class="token comment">-- Method</span><br><span class="token keyword">function</span> Shape<span class="token punctuation">:</span><span class="token function">report</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s has %d sides"</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>sides<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br>my_shape <span class="token operator">=</span> Shape<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"triangle"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><br>my_shape<span class="token punctuation">:</span><span class="token function">report</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- triangle has 3 sides</span></code></pre><p>Approach #2:</p><p>The metatable can be a property of the class table.</p><p>This only requires the following minor changes to the code in Approach #1.</p><pre class="language-lua"><code class="language-lua"><span class="token comment">-- Replace the line starting with `local metatable` with this.</span><br>Shape<span class="token punctuation">.</span>metatable <span class="token operator">=</span> <span class="token punctuation">{</span>__index <span class="token operator">=</span> Shape<span class="token punctuation">}</span><br><br><span class="token comment">-- Replace the line starting with `local instance` with this.</span><br><span class="token keyword">local</span> instance <span class="token operator">=</span> <span class="token function">setmetatable</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> Shape<span class="token punctuation">.</span>metatable<span class="token punctuation">)</span></code></pre><p>Approach #3:</p><p>The metatable can be the class table itself. This approach requires defining the <code>new</code> function with a colon so it can access the class table using the <code>self</code> variable.</p><p>This only requires the following minor changes to the code in Approach #2.</p><pre class="language-lua"><code class="language-lua"><span class="token comment">-- Replace the line starting with `Shape.metatable =` with this.</span><br>Shape<span class="token punctuation">.</span>__index <span class="token operator">=</span> Shape<br><br><span class="token comment">-- Replace the line starting with `local instance` with this.</span><br><span class="token keyword">local</span> instance <span class="token operator">=</span> <span class="token function">setmetatable</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> Shape<span class="token punctuation">)</span></code></pre><h3 id="simplifying-classes" tabindex="-1">Simplifying Classes</h3><p>There is a fair amount boilerplate code in the examples above and plenty of opportunity to make mistakes. We can address this by writing a <code>class</code> function that does all the work for us. It could be defined in the file <code>oop.lua</code> and then made available in multiple sources files with a <code>require</code> statement.</p><p>The <code>class</code> function can be defined as follows:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> string<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">)</span><br>  <span class="token keyword">return</span> source<span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><br><span class="token keyword">end</span><br><br><span class="token comment">-- The `defaults` parameter is a table that holds default property values</span><br><span class="token comment">-- and optional metamethods like `__tostring`.</span><br><span class="token comment">-- Metamethods will be described later.</span><br><span class="token keyword">function</span> <span class="token function">class</span><span class="token punctuation">(</span>defaults<span class="token punctuation">)</span><br>  <span class="token function">assert</span><span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>defaults<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"table"</span><span class="token punctuation">)</span><br><br>  <span class="token keyword">local</span> metatable <span class="token operator">=</span> <span class="token punctuation">{</span>__index <span class="token operator">=</span> defaults<span class="token punctuation">}</span><br><br>  <span class="token comment">-- Copy all the metamethod functions (start with "__")</span><br>  <span class="token comment">-- from `defaults` to `metatable` and remove them from `defaults`.</span><br>  <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>defaults<span class="token punctuation">)</span> <span class="token keyword">do</span><br>    <span class="token comment">-- This tests whether `k` begins with two underscores.</span><br>    <span class="token comment">-- 1 is the index at which to start the search.</span><br>    <span class="token comment">-- true turns of regular expressions.</span><br>    <span class="token keyword">if</span> k<span class="token punctuation">:</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"__"</span><span class="token punctuation">)</span> <span class="token keyword">then</span><br>      metatable<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v<br>      defaults<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">nil</span><br>    <span class="token keyword">end</span><br>  <span class="token keyword">end</span><br><br>  <span class="token comment">-- Create and return a table to represent the class.</span><br>  <span class="token keyword">return</span> <span class="token punctuation">{</span><br>    <span class="token comment">-- The `new` function creates and returns an instance.</span><br>    new <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>initial<span class="token punctuation">)</span><br>      <span class="token keyword">local</span> instance <span class="token operator">=</span> initial <span class="token keyword">or</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br>      <span class="token function">setmetatable</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> metatable<span class="token punctuation">)</span><br>      <span class="token keyword">return</span> instance<br>    <span class="token keyword">end</span><br>  <span class="token punctuation">}</span><br><span class="token keyword">end</span></code></pre><p>The following code demonstrates using the <code>class</code> function defined above.</p><pre class="language-lua"><code class="language-lua">require <span class="token string">"oop"</span><br><br>Point <span class="token operator">=</span> <span class="token function">class</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token comment">-- Properties</span><br>  x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span><br>  y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span><br><br>  <span class="token comment">-- Methods</span><br>  distanceFromOrigin <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><br>    <span class="token keyword">return</span> math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>x <span class="token operator">^</span> <span class="token number">2</span> <span class="token operator">+</span> p<span class="token punctuation">.</span>y <span class="token operator">^</span> <span class="token number">2</span><span class="token punctuation">)</span><br>  <span class="token keyword">end</span><span class="token punctuation">,</span><br>  print <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><br>    <span class="token function">print</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token comment">-- uses __tostring below</span><br>  <span class="token keyword">end</span><span class="token punctuation">,</span><br><br>  <span class="token comment">-- Metamethods</span><br>  __add <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span><br>    <span class="token keyword">return</span> Point<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">{</span>x <span class="token operator">=</span> p1<span class="token punctuation">.</span>x <span class="token operator">+</span> p2<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y <span class="token operator">=</span> p1<span class="token punctuation">.</span>y <span class="token operator">+</span> p2<span class="token punctuation">.</span>y<span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token keyword">end</span><span class="token punctuation">,</span><br>  __tostring <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><br>    <span class="token keyword">return</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"(%.2f, %.2f)"</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p<span class="token punctuation">.</span>y<span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>p1 <span class="token operator">=</span> Point<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">{</span>x <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"p1 is"</span><span class="token punctuation">,</span> p1<span class="token punctuation">)</span> <span class="token comment">-- p1 is   (3.00, 4.00)</span><br>p1<span class="token punctuation">:</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- (3.00, 4.00)</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"distance = "</span> <span class="token operator">..</span> p1<span class="token punctuation">:</span><span class="token function">distanceFromOrigin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- distance = 5.0</span><br><br>p2 <span class="token operator">=</span> Point<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">{</span>x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br>p3 <span class="token operator">=</span> p1 <span class="token operator">+</span> p2 <span class="token comment">-- uses the __add metamethod</span><br>p3<span class="token punctuation">:</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- (8.0, 5.0)</span><br><br>p4 <span class="token operator">=</span> Point<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">{</span>y <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br>p4<span class="token punctuation">:</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- (0.00, 7.00)</span></code></pre><h3 id="inheritance" tabindex="-1">Inheritance</h3><p>We can simulate class inheritance by setting the metatable of a class to its superclass.</p><p>The following code demonstrates this.</p><p>The <code>Shape</code> class is a abstract class, meaning we cannot create instances from it. Its purpose is to serve as a based class for other classes that wish to inherit from it. The lack of a <code>new</code> function is what makes it abstract.</p><p>The <code>Triangle</code> and <code>Rectangle</code> classes both inherit from the <code>Shape</code> class. The <code>Square</code> class inherits from the <code>Rectangle</code> class.</p><pre class="language-lua"><code class="language-lua"><span class="token comment">-- Define a Shape class.</span><br>Shape <span class="token operator">=</span> <span class="token punctuation">{</span>name <span class="token operator">=</span> <span class="token string">"unknown"</span><span class="token punctuation">,</span> sides <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">}</span><br>Shape<span class="token punctuation">.</span>__index <span class="token operator">=</span> Shape<br><br><span class="token comment">-- Method</span><br><span class="token keyword">function</span> Shape<span class="token punctuation">:</span><span class="token function">report</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><br>    <span class="token string">"%s has %d sides and area %.1f."</span><span class="token punctuation">,</span><br>    self<span class="token punctuation">.</span>name<span class="token punctuation">,</span><br>    self<span class="token punctuation">.</span>sides<span class="token punctuation">,</span><br>    self<span class="token punctuation">:</span><span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br><span class="token comment">-- Define a Triangle class.</span><br>Triangle <span class="token operator">=</span> <span class="token punctuation">{</span>name <span class="token operator">=</span> <span class="token string">"triangle"</span><span class="token punctuation">,</span> sides <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">}</span><br>Triangle<span class="token punctuation">.</span>__index <span class="token operator">=</span> Triangle<br><span class="token function">setmetatable</span><span class="token punctuation">(</span>Triangle<span class="token punctuation">,</span> Shape<span class="token punctuation">)</span><br><br><span class="token comment">-- Constructor</span><br><span class="token keyword">function</span> Triangle<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>base<span class="token punctuation">,</span> height<span class="token punctuation">)</span><br>  <span class="token keyword">local</span> instance <span class="token operator">=</span> <span class="token function">setmetatable</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> Triangle<span class="token punctuation">)</span><br>  instance<span class="token punctuation">.</span>base <span class="token operator">=</span> base<br>  instance<span class="token punctuation">.</span>height <span class="token operator">=</span> height<br>  <span class="token keyword">return</span> instance<br><span class="token keyword">end</span><br><br><span class="token comment">-- Method</span><br><span class="token keyword">function</span> Triangle<span class="token punctuation">:</span><span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token keyword">return</span> self<span class="token punctuation">.</span>base <span class="token operator">*</span> self<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><br><span class="token keyword">end</span><br><br>triangle <span class="token operator">=</span> Triangle<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><br>triangle<span class="token punctuation">:</span><span class="token function">report</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- triangle has 3 sides and area 12.0</span><br><br><span class="token comment">-- Define a Rectangle class.</span><br>Rectangle <span class="token operator">=</span> <span class="token punctuation">{</span>name <span class="token operator">=</span> <span class="token string">"rectangle"</span><span class="token punctuation">,</span> sides <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">}</span><br>Rectangle<span class="token punctuation">.</span>__index <span class="token operator">=</span> Rectangle<br><span class="token function">setmetatable</span><span class="token punctuation">(</span>Rectangle<span class="token punctuation">,</span> Shape<span class="token punctuation">)</span><br><br><span class="token comment">-- Constructor</span><br><span class="token keyword">function</span> Rectangle<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><br>  <span class="token keyword">local</span> instance <span class="token operator">=</span> <span class="token function">setmetatable</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> Rectangle<span class="token punctuation">)</span><br>  instance<span class="token punctuation">.</span>width <span class="token operator">=</span> width<br>  instance<span class="token punctuation">.</span>height <span class="token operator">=</span> height<br>  <span class="token keyword">return</span> instance<br><span class="token keyword">end</span><br><br><span class="token comment">-- Method</span><br><span class="token keyword">function</span> Rectangle<span class="token punctuation">:</span><span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token keyword">return</span> self<span class="token punctuation">.</span>width <span class="token operator">*</span> self<span class="token punctuation">.</span>height<br><span class="token keyword">end</span><br><br>rectangle <span class="token operator">=</span> Rectangle<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><br>rectangle<span class="token punctuation">:</span><span class="token function">report</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- rectangle has 4 sides and area 24.0</span><br><br><span class="token comment">-- Define a Square class.</span><br><span class="token comment">-- Note that we didn't specify the number of sides.</span><br><span class="token comment">-- It will get that from its superclass Rectangle.</span><br>Square <span class="token operator">=</span> <span class="token punctuation">{</span>name <span class="token operator">=</span> <span class="token string">"square"</span><span class="token punctuation">}</span><br>Square<span class="token punctuation">.</span>__index <span class="token operator">=</span> Square<br><span class="token function">setmetatable</span><span class="token punctuation">(</span>Square<span class="token punctuation">,</span> Rectangle<span class="token punctuation">)</span><br><br><span class="token comment">-- Constructor</span><br><span class="token keyword">function</span> Square<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>side<span class="token punctuation">)</span><br>  <span class="token keyword">local</span> instance <span class="token operator">=</span> <span class="token function">setmetatable</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> Square<span class="token punctuation">)</span><br>  instance<span class="token punctuation">.</span>side <span class="token operator">=</span> side<br>  <span class="token keyword">return</span> instance<br><span class="token keyword">end</span><br><br><span class="token comment">-- Method</span><br><span class="token keyword">function</span> Square<span class="token punctuation">:</span><span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token comment">-- TODO: Is it possible to compute this using the superclass method?</span><br>  <span class="token keyword">return</span> self<span class="token punctuation">.</span>side <span class="token operator">^</span> <span class="token number">2</span><br><span class="token keyword">end</span><br><br>square <span class="token operator">=</span> Square<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><br>square<span class="token punctuation">:</span><span class="token function">report</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- square has 4 sides and area 25.0</span></code></pre><p>TODO: Can you simplify inheritance similar to how you simplified defining a class? TODO: Maybe you should show this example again using your <code>class</code> function.</p><h3 id="multiple-inheritance" tabindex="-1">Multiple Inheritance</h3><p>TODO: Add this based on <a href="https://www.youtube.com/watch?v=1BFoprD30dE&amp;t=97s">https://www.youtube.com/watch?v=1BFoprD30dE&amp;t=97s</a>.</p><h2 id="metamethods" tabindex="-1">Metamethods</h2><p>TODO: See your metamethods.lua file.</p><p>Metamethods enable defining the functionality of Lua operators. TODO: Verify that all of these work. Maybe __le isn't supported.</p><table><thead><tr><th>Metamethod</th><th>Operator</th></tr></thead><tbody><tr><td><code>__add</code></td><td><code>+</code></td></tr><tr><td><code>__sub</code></td><td><code>-</code></td></tr><tr><td><code>__mul</code></td><td><code>*</code></td></tr><tr><td><code>__div</code></td><td><code>/</code></td></tr><tr><td><code>__mod</code></td><td><code>%</code></td></tr><tr><td><code>__pow</code></td><td><code>^</code></td></tr><tr><td><code>__concat</code></td><td><code>..</code></td></tr><tr><td><code>__len</code></td><td><code>#</code></td></tr><tr><td><code>__eq</code></td><td><code>==</code></td></tr><tr><td><code>__ne</code></td><td><code>~=</code></td></tr><tr><td><code>__lt</code></td><td><code>&lt;</code></td></tr><tr><td><code>__le</code></td><td><code>&lt;=</code></td></tr><tr><td><code>__gt</code></td><td><code>&gt;</code></td></tr><tr><td><code>__ge</code></td><td><code>&gt;=</code></td></tr><tr><td><code>__unm</code></td><td><code>-</code> (unary)</td></tr></tbody></table><p>Metamethods also support implementing functions that are called when specific things occur.</p><table><thead><tr><th>Metamethod</th><th>Operator</th></tr></thead><tbody><tr><td><code>__call</code></td><td>called when the table is called like a function</td></tr><tr><td><code>__gc</code></td><td>called after garbage collection runs</td></tr><tr><td><code>__index</code></td><td>called if a key is not found in the table</td></tr><tr><td><code>__metatable</code></td><td>prevents changes to metatable; see below</td></tr><tr><td><code>__mode</code></td><td>returns a string; see below</td></tr><tr><td><code>__newindex</code></td><td>called when an entry is added to the table</td></tr><tr><td><code>__tostring</code></td><td>returns a string representation</td></tr></tbody></table><p>When the <code>__metatable</code> function is defined, the metatable cannot be modified and this returns an error message.</p><p>When the <code>__mode</code> function returns a string that contains <code>k</code>, keys are weak. When it contains <code>v</code>, values are weak. Both can be true.</p><h2 id="lua-functional-(luafun)" tabindex="-1">Lua Functional (luafun)</h2><p>The <a href="https://www.lua.org/manual/5.4/manual.html#6.6" target="_blank">table</a> library does not include functions such as <code>map</code>, <code>filter</code>, <code>reduce</code>, <code>some</code>, and <code>every</code>. It's not difficult to write these though. The following code implements and demonstrates using each of them.</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">map</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> t<span class="token punctuation">)</span><br>  <span class="token keyword">local</span> result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br>  <span class="token keyword">for</span> i<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">do</span><br>    result<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br>  <span class="token keyword">return</span> result<br><span class="token keyword">end</span><br><br><span class="token keyword">local</span> numbers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span><br><span class="token keyword">function</span> <span class="token function">square</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token keyword">return</span> n <span class="token operator">*</span> n <span class="token keyword">end</span><br><span class="token keyword">local</span> squares <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span>square<span class="token punctuation">,</span> numbers<span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>squares<span class="token punctuation">,</span> <span class="token string">", "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 1, 4, 9, 16, 25</span><br><br><span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> t<span class="token punctuation">)</span><br>  <span class="token keyword">local</span> result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br>  <span class="token keyword">for</span> i<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">do</span><br>    <span class="token keyword">if</span> <span class="token function">fn</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token keyword">then</span><br>      table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> v<span class="token punctuation">)</span><br>    <span class="token keyword">end</span><br>  <span class="token keyword">end</span><br>  <span class="token keyword">return</span> result<br><span class="token keyword">end</span><br><br><span class="token keyword">function</span> <span class="token function">isEven</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token keyword">return</span> n <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">end</span><br><span class="token keyword">local</span> evens <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>isEven<span class="token punctuation">,</span> numbers<span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>evens<span class="token punctuation">,</span> <span class="token string">", "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 2, 4</span><br><br><span class="token keyword">function</span> <span class="token function">reduce</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> t<span class="token punctuation">,</span> initial<span class="token punctuation">)</span><br>  <span class="token keyword">local</span> acc <span class="token operator">=</span> initial<br>  <span class="token keyword">for</span> i<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">do</span><br>    acc <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>acc<span class="token punctuation">,</span> v<span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br>  <span class="token keyword">return</span> acc<br><span class="token keyword">end</span><br><br><span class="token keyword">local</span> sum <span class="token operator">=</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>acc<span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token keyword">return</span> acc <span class="token operator">+</span> x <span class="token keyword">end</span><span class="token punctuation">,</span> numbers<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span> <span class="token comment">-- 15</span><br><br><span class="token keyword">function</span> <span class="token function">some</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> t<span class="token punctuation">)</span><br>  <span class="token keyword">for</span> i<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">do</span><br>    f <span class="token function">fn</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token keyword">then</span> <span class="token keyword">return</span> <span class="token keyword">true</span> <span class="token keyword">end</span><br>  <span class="token keyword">end</span><br>  <span class="token keyword">return</span> <span class="token keyword">false</span><br><span class="token keyword">end</span><br><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token keyword">return</span> n <span class="token operator">></span> <span class="token number">3</span> <span class="token keyword">end</span><span class="token punctuation">,</span> numbers<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- true</span><br><br><span class="token keyword">function</span> <span class="token function">every</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> t<span class="token punctuation">)</span><br>  <span class="token keyword">for</span> i<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">do</span><br>    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token function">fn</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token keyword">then</span> <span class="token keyword">return</span> <span class="token keyword">false</span> <span class="token keyword">end</span><br>  <span class="token keyword">end</span><br>  <span class="token keyword">return</span> <span class="token keyword">true</span><br><span class="token keyword">end</span><br><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token keyword">return</span> n <span class="token operator">&lt;</span> <span class="token number">7</span> <span class="token keyword">end</span><span class="token punctuation">,</span> numbers<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- true</span></code></pre><p>The functions <code>map</code>, <code>filter</code>, and `reduce (and many more) can be found in the <a href="https://luafun.github.io/?v=1.0.20" rel="noopener" target="_blank">Lua Functional Library</a>.</p><p>This library is distributed in the single file <code>fun.lua</code>. To download the file, enter <code>wget https://raw.github.com/luafun/luafun/master/fun.lua</code>.</p><p>The following code demonstrates basic use of this library:</p><pre class="language-lua"><code class="language-lua">fun <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fun"</span><span class="token punctuation">)</span><br><br>scores <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">}</span><br><br><span class="token comment">-- The `map` and `filter` methods returns an iterator.</span><br><span class="token comment">-- Calling `:totable()` on an iterator returns a table.</span><br><br><span class="token comment">-- Using `map` to double numbers in a table.</span><br><span class="token keyword">function</span> <span class="token function">double</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token keyword">return</span> n <span class="token operator">*</span> <span class="token number">2</span> <span class="token keyword">end</span><br>doubled_iter <span class="token operator">=</span> fun<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>double<span class="token punctuation">,</span> scores<span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Doubled Scores"</span><span class="token punctuation">)</span><br>fun<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>print<span class="token punctuation">,</span> doubled_iter<span class="token punctuation">)</span> <span class="token comment">-- 14 8 26</span><br><br><span class="token comment">-- Using `filter` to get odd numbers from a table.</span><br><span class="token keyword">function</span> <span class="token function">odd</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token keyword">return</span> n <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">end</span><br>odd_iter <span class="token operator">=</span> fun<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>odd<span class="token punctuation">,</span> scores<span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Odd Scores"</span><span class="token punctuation">)</span><br>fun<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>print<span class="token punctuation">,</span> odd_iter<span class="token punctuation">)</span> <span class="token comment">-- 7 3</span><br><br><span class="token comment">-- Using `reduce` to sum numbers in a table.</span><br><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token keyword">end</span><br>total <span class="token operator">=</span> fun<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>add<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> scores<span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Total is "</span> <span class="token operator">..</span> total<span class="token punctuation">)</span> <span class="token comment">-- 24</span><br><br><span class="token comment">-- Doing the same with the `sum` function.</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Total is "</span> <span class="token operator">..</span> fun<span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span>scores<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 24</span><br><br><span class="token comment">-- There are MANY more functions in the luafun library!</span><br><br><span class="token comment">-- Can you use a for loop to iterate over values in an interator?</span><br><span class="token comment">-- for k, v in pairs(doubled_scores) do</span><br><span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> doubled_iter<span class="token punctuation">:</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">do</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token comment">-- 14 8 26</span><br><span class="token keyword">end</span></code></pre><h2 id="standard-library" tabindex="-1">Standard Library</h2><p>The Lua standard library defines the following modules:</p><ul><li><a href="https://www.lua.org/manual/5.4/manual.html#6.1" target="_blank">basic</a></li><li><a href="https://www.lua.org/manual/5.4/manual.html#6.2" target="_blank">coroutine</a></li><li><a href="https://www.lua.org/manual/5.4/manual.html#6.10" target="_blank">debug</a></li><li><a href="https://www.lua.org/manual/5.4/manual.html#6.8" target="_blank">io</a></li><li><a href="https://www.lua.org/manual/5.4/manual.html#6.7" target="_blank">math</a></li><li><a href="https://www.lua.org/manual/5.4/manual.html#6.3" target="_blank">modules/package</a></li><li><a href="https://www.lua.org/manual/5.4/manual.html#6.9" target="_blank">os</a></li><li><a href="https://www.lua.org/manual/5.4/manual.html#6.4" target="_blank">string</a></li><li><a href="https://www.lua.org/manual/5.4/manual.html#6.6" target="_blank">table</a></li><li><a href="https://www.lua.org/manual/5.4/manual.html#6.5" target="_blank">utf8</a></li></ul><p>Modules in the standard library do not need to be imported to use them.</p><h3 id="math-module" tabindex="-1">math module</h3><p>Constants defined by this library include:</p><ul><li><code>math.huge</code> - floating point value greater than any other number</li><li><code>math.maxinteger</code> - maximum integer value</li><li><code>math.mininteger</code> - minimum integer value</li><li><code>math.pi</code> - value of π</li></ul><p>A constant for <code>e</code> is not defined, but it can be obtained from <code>math.exp(1)</code>.</p><p>Trigonometry functions defined by this library include <code>sin</code>, <code>cos</code>, <code>tan</code>, <code>asin</code>, <code>acos</code>, and <code>atan</code>. All of these take and return angles in radians. To convert an angle from degrees to radians, use the <code>math.rad(x)</code> function. To convert an angle from radians to degrees, use the <code>math.deg(x)</code> function.</p><p>To generate random numbers, use the <code>math.randomseed</code> and <code>math.random</code> functions.</p><ul><li><code>math.randomseed(os.time())</code> seeds the random number generator</li><li><code>math.random()</code> returns a floating point number in the range [0, 1)</li><li><code>math.random(10)</code> returns an integer in the range [1, 10]</li><li><code>math.random(5, 10)</code> returns an integer in the range [5, 10]</li></ul><p>Other functions defined in this library include:</p><ul><li><p><code>math.abs(x)</code> for absolute value</p></li><li><p><code>math.ceil(x)</code> for ceiling (rounds up)</p></li><li><p><code>math.exp(x)</code> for e raised to the x power</p></li><li><p><code>math.floor(x)</code> for floor (rounds down)</p></li><li><p><code>math.fmod(x, y)</code> for floating point remainder of x / y</p></li><li><p><code>math.log(x, [base])</code> for logarithm of x with specified base or e</p></li><li><p><code>math.max(...)</code> for maximum of a set of numbers</p></li><li><p><code>math.min(...)</code> for minimum of a set of numbers</p></li><li><p><code>math.modf(x)</code> for integral and fractional parts of a floating point number</p><p>For example, <code>math.modf(3.14)</code> returns <code>3</code> and <code>0.14</code></p></li><li><p><code>math.sqrt(x)</code> for square root</p></li><li><p><code>math.tointeger(x)</code> returns an integer value if x can be converted to an integer; otherwise <code>nil</code></p><p>The value passed can be a number or string. For example, <code>math.tointeger(3.0)</code> and <code>math.tointeger(&quot;3.0&quot;)</code> returns <code>3</code>, and <code>math.tointeger(3.1)</code> returns <code>nil</code>.</p></li><li><p><code>math.type(x)</code> returns <code>&quot;integer&quot;</code>, <code>&quot;float&quot;</code>, or <code>nil</code></p></li><li><p><code>math.ult(m, n)</code> returns <code>true</code> if m &lt; n when compared as unsigned integers; otherwise <code>false</code></p></li></ul><h3 id="io-module" tabindex="-1">io Module</h3><p>The following code shows the most basic way to write to a new file. If the file already exists, it is overwritten.</p><pre class="language-lua"><code class="language-lua"><span class="token comment">-- TODO: What does this do if file_path is omitted?</span><br>io<span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><br>io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>some_string<span class="token punctuation">)</span><br>io<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>The following code shows the most basic way to read from a file.</p><pre class="language-lua"><code class="language-lua"><span class="token comment">-- TODO: What does this do if file_path is omitted?</span><br>io<span class="token punctuation">.</span><span class="token function">input</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><br><span class="token comment">-- TODO: What arguments does this accept and what do they do?</span><br><span class="token keyword">local</span> data <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>io<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>Files can be opened in one of the following modes where the columns indicate the capabilities of each mode:</p><table><thead><tr><th>Mode</th><th style="text-align:center">New</th><th style="text-align:center">Overwrite</th><th style="text-align:center">Read</th><th style="text-align:center">Write</th><th style="text-align:center">Append</th></tr></thead><tbody><tr><td><code>r</code></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">X</td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td><code>w</code></td><td style="text-align:center">X</td><td style="text-align:center">X</td><td style="text-align:center"></td><td style="text-align:center">X</td><td style="text-align:center"></td></tr><tr><td><code>a</code></td><td style="text-align:center">X</td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">X</td></tr><tr><td><code>r+</code></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">X</td><td style="text-align:center">X</td><td style="text-align:center"></td></tr><tr><td><code>w+</code></td><td style="text-align:center">X</td><td style="text-align:center">X</td><td style="text-align:center">X</td><td style="text-align:center">X</td><td style="text-align:center"></td></tr><tr><td><code>a+</code></td><td style="text-align:center">X</td><td style="text-align:center"></td><td style="text-align:center">X</td><td style="text-align:center"></td><td style="text-align:center">X</td></tr></tbody></table><p>To open a file:</p><pre class="language-lua"><code class="language-lua">file <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> mode<span class="token punctuation">)</span> <span class="token comment">-- mode defaults to "r"</span></code></pre><p>To write to a file:</p><pre class="language-lua"><code class="language-lua">file<span class="token punctuation">:</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span></code></pre><p>To read from a file:</p><pre class="language-lua"><code class="language-lua">contents <span class="token operator">=</span> file<span class="token punctuation">:</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"*all"</span><span class="token punctuation">)</span> <span class="token comment">-- reads the entire contents</span><br>line <span class="token operator">=</span> file<span class="token punctuation">:</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"*line"</span><span class="token punctuation">)</span> <span class="token comment">-- reads the next line</span><br>number <span class="token operator">=</span> file<span class="token punctuation">:</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"*number"</span><span class="token punctuation">)</span> <span class="token comment">-- reads a number</span><br>n1<span class="token punctuation">,</span> n2 <span class="token operator">=</span> file<span class="token punctuation">:</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"*number"</span><span class="token punctuation">,</span> <span class="token string">"*number"</span><span class="token punctuation">)</span> <span class="token comment">-- reads two numbers</span><br>text <span class="token operator">=</span> file<span class="token punctuation">:</span><span class="token function">read</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token comment">-- reads a string of up to "n" characters</span><br>end_test <span class="token operator">=</span> file<span class="token punctuation">:</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">-- returns nil if at end of file; otherwise returns ""</span></code></pre><p>To seek to a specific byte offset:</p><pre class="language-lua"><code class="language-lua">file<span class="token punctuation">:</span><span class="token function">seek</span><span class="token punctuation">(</span><span class="token string">"set"</span><span class="token punctuation">,</span> offset<span class="token punctuation">)</span></code></pre><p>TODO: How do you read a given number of bytes from the current offset?</p><p>To close a file:</p><pre class="language-lua"><code class="language-lua">file<span class="token punctuation">:</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h3 id="os-module" tabindex="-1">os Module</h3><ul><li><code>os.time()</code> returns ms since 1970 or a given date/time</li><li><code>os.difftime()</code> returns ms difference between two times</li><li><code>os.date()</code> returns a string describing the current date and time</li><li><code>os.exit(code)</code> — code can be true (exits with EXIT_SUCCESS; default), false (exits with EXIT_FAILURE), or a number</li><li><code>os.getenv(&quot;environment-variable-name&quot;)</code></li><li><code>os.rename(current_file_path, new_file_path)</code></li><li><code>os.remove(current_file_path)</code> — deletes the file</li><li><code>os.execute(shell_command)</code></li></ul><p>The <code>os.date</code> function takes a format string and an option time that defines to now. The format string uses the same characters as the C <a href="https://man7.org/linux/man-pages/man3/strftime.3.html?v=1.0.20" rel="noopener" target="_blank">strftime</a> function For example:</p><pre class="language-lua"><code class="language-lua">now <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span> <span class="token comment">-- Fri Apr  7 03:09:52 2023</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- string</span><br><br>time <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  year <span class="token operator">=</span> <span class="token number">1961</span><span class="token punctuation">,</span><br>  month <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span><br>  day <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span><br>  hour <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span><br>  min <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span><br>  sec <span class="token operator">=</span> <span class="token number">19</span><span class="token punctuation">,</span><br>  isdst <span class="token operator">=</span> <span class="token keyword">true</span> <span class="token comment">-- daylight savings time</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- number</span><br><br>format <span class="token operator">=</span> <span class="token string">"%A, %B %e, %Y"</span><br><span class="token function">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- Sunday, April 16, 1961</span></code></pre><p>To get the time it takes to run some code:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> start <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>— some code here<br><span class="token function">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span></code></pre><h2 id="modules" tabindex="-1">Modules</h2><p>A module is defined by a source file that returns a table containing variables and functions.</p><p>To define a module named <code>my_module</code>, create a file named <code>my_module.lua</code> containing code like the following:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> my_module <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">-- a table</span><br><br>my_module<span class="token punctuation">.</span>some_variable <span class="token operator">=</span> <span class="token string">"some value"</span><br><br><span class="token keyword">function</span> my_module<span class="token punctuation">.</span><span class="token function">some_function</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span><br>  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"some_function was passed "</span> <span class="token operator">..</span> p1 <span class="token operator">..</span> <span class="token string">" and "</span> <span class="token operator">..</span> p2<span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br><span class="token keyword">return</span> my_module</code></pre><p>To use this module:</p><pre class="language-lua"><code class="language-lua">mm <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"my_module"</span><span class="token punctuation">)</span><br>mm<span class="token punctuation">.</span><span class="token function">some_function</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>mm<span class="token punctuation">.</span>some_variable<span class="token punctuation">)</span></code></pre><p>A Lua &quot;package&quot; is a collection of modules.</p><h2 id="object-oriented-programming-(oop)" tabindex="-1">Object Oriented Programming (OOP)</h2><p>While Lua does not support defining classes and creating instances, it can simulate those using metatables. The following code demonstrates defining classes, properties, constructors, methods, and subclasses.</p><pre class="language-lua"><code class="language-lua"><span class="token comment">-- Define Animal class with properties `name` and `says`.</span><br>Animal <span class="token operator">=</span> <span class="token punctuation">{</span>name <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span> says <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">}</span><br><br><span class="token comment">-- Animal constructor</span><br><span class="token keyword">function</span> Animal<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span>kind<span class="token punctuation">,</span> name<span class="token punctuation">,</span> says<span class="token punctuation">)</span><br>  <span class="token comment">-- TODO: This must return a table, but it's not</span><br>  <span class="token comment">-- TODO: clear that it needs to have a metatable.</span><br>  <span class="token comment">-- `self` is a special variable name, not a keyword.</span><br>  <span class="token function">setmetatable</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> self<span class="token punctuation">)</span><br><br>  <span class="token comment">-- Set properties.</span><br>  self<span class="token punctuation">.</span>kind <span class="token operator">=</span> kind<br>  self<span class="token punctuation">.</span>name <span class="token operator">=</span> name<br>  self<span class="token punctuation">.</span>says <span class="token operator">=</span> says<br><br>  <span class="token comment">-- Define methods.</span><br>  <span class="token comment">-- TODO: It seems each instance will have its own copy of every method.</span><br>  self<span class="token punctuation">.</span>someMethod <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span><br>    <span class="token comment">-- Implement the method.</span><br>  <span class="token keyword">end</span><br><br>  <span class="token keyword">return</span> self<br><span class="token keyword">end</span><br><br><span class="token comment">-- Animal method</span><br><span class="token keyword">function</span> Animal<span class="token punctuation">:</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token keyword">local</span> text <span class="token operator">=</span> <span class="token string">"%s is a %s and says %s."</span><br>  <span class="token keyword">return</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>kind<span class="token punctuation">,</span> self<span class="token punctuation">.</span>says<span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br><span class="token comment">-- Create an Animal instance.</span><br>dog <span class="token operator">=</span> Animal<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"dog"</span><span class="token punctuation">,</span> <span class="token string">"Comet"</span><span class="token punctuation">,</span> <span class="token string">"bark"</span><span class="token punctuation">)</span><br><br><span class="token function">print</span><span class="token punctuation">(</span>dog<span class="token punctuation">.</span>says<span class="token punctuation">)</span> <span class="token comment">-- access property; bark</span><br><span class="token function">print</span><span class="token punctuation">(</span>dog<span class="token punctuation">:</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- call method; Comet is a dog and says bark.</span><br><br><span class="token comment">-- Define Giraffe class inheriting from the Animal class.</span><br>Giraffe <span class="token operator">=</span> Animal<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br><span class="token comment">-- Giraffe constuctor</span><br><span class="token keyword">function</span> Giraffe<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> height<span class="token punctuation">)</span><br>  <span class="token function">setmetatable</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> self<span class="token punctuation">)</span><br><br>  <span class="token comment">-- Set superclass properties.</span><br>  self<span class="token punctuation">.</span>kind <span class="token operator">=</span> <span class="token string">"giraffe"</span><br>  self<span class="token punctuation">.</span>name <span class="token operator">=</span> name<br>  self<span class="token punctuation">.</span>says <span class="token operator">=</span> <span class="token string">"nothing"</span><br><br>  <span class="token comment">-- Set properties unique to this class.</span><br>  self<span class="token punctuation">.</span>height <span class="token operator">=</span> height<br><br>  <span class="token keyword">return</span> self<br><br>  <span class="token comment">-- TODO: Maybe all the code above can be replaced by the following:</span><br>  <span class="token comment">--[[<br>  instance = Animal("giraffe", name, "nothing")<br>  instance.height = height<br>  return instance<br>  ]]</span><br><span class="token keyword">end</span><br><br><span class="token comment">-- Giraffe method</span><br><span class="token keyword">function</span> Giraffe<span class="token punctuation">:</span><span class="token function">report</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token keyword">local</span> text <span class="token operator">=</span> <span class="token string">"%s %s is %d feet tall."</span><br>  <span class="token keyword">return</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>kind<span class="token punctuation">,</span> self<span class="token punctuation">.</span>height<span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br><span class="token comment">-- Create Giraffe instance.</span><br>g <span class="token operator">=</span> Giraffe<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Geoffrey"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span> <span class="token comment">-- creates an instance</span><br><br><span class="token function">print</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>height<span class="token punctuation">)</span> <span class="token comment">-- access property; 18</span><br><span class="token function">print</span><span class="token punctuation">(</span>g<span class="token punctuation">:</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- call method; Geoffrey is a giraffe and says nothing.</span><br><span class="token function">print</span><span class="token punctuation">(</span>g<span class="token punctuation">:</span><span class="token function">report</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- call method; Geoffrey giraffe is 18 feet tall.</span></code></pre><h2 id="multitasking" tabindex="-1">Multitasking</h2><p>Lua is single-threaded like JavaScript. It supports collaborative multitasking with coroutines. Coroutines are like threads, but they do not run in parallel.</p><pre class="language-lua"><code class="language-lua"><span class="token comment">-- TODO: Can this function have parameters?</span><br>co <span class="token operator">=</span> coroutine<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token punctuation">...</span><br>  coroutine<span class="token punctuation">.</span><span class="token function">yield</span><span class="token punctuation">(</span><span class="token string">"value #1"</span><span class="token punctuation">)</span><br>  <span class="token punctuation">...</span><br>  coroutine<span class="token punctuation">.</span><span class="token function">yield</span><span class="token punctuation">(</span><span class="token string">"value #1"</span><span class="token punctuation">)</span><br>  <span class="token punctuation">...</span><br>  <span class="token keyword">return</span> <span class="token string">"value #3"</span><br><span class="token keyword">end</span><span class="token punctuation">)</span><br><br>v1 <span class="token operator">=</span> coroutine<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span>co<span class="token punctuation">)</span> <span class="token comment">-- "value #1"</span><br><span class="token function">print</span><span class="token punctuation">(</span>coroutine<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>co<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- "running"</span><br>v2 <span class="token operator">=</span> coroutine<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span>co<span class="token punctuation">)</span> <span class="token comment">-- "value #2"</span><br>v3 <span class="token operator">=</span> coroutine<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span>co<span class="token punctuation">)</span> <span class="token comment">-- "value #3"</span><br>v4 <span class="token operator">=</span> coroutine<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span>co<span class="token punctuation">)</span> — error<br><span class="token function">print</span><span class="token punctuation">(</span>coroutine<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>co<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- "suspended"</span></code></pre><p>TODO: How can you create concurrently running threads in Lua?</p><h2 id="error-handling" tabindex="-1">Error Handling</h2><p>Lua does not have a mechanism for throwing and catching exceptions. In many cases errors result in a function returning the value <code>nil</code> and it left to developers to check for <code>nil</code> values. Failing to do so often results in programs crashing and outputting a stack trace.</p><p>The only error handling mechanism Lua provides is the <code>pcall</code> function (short for &quot;protected call&quot;), which can be compared to a try block in other programming languages. The <code>pcall</code> function is passed a function to execute and optionally arguments to be passed to it. It returns a boolean indicating whether the call completed without error and an error message if one did occur.</p><p>The <code>error</code> function is the Lua equivalent of a <code>throw</code> statement in other programming languages. It is passed a message and an optional integer error level. The message can be any type, but is typically a string or a table.</p><p>The following code demonstrates using the <code>pcall</code> function. It repeated prompts for a dividend and a divisor and displays their quotient. When invalid values are entered, error messages are output, but the program does not crash.</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">read_number</span><span class="token punctuation">(</span>prompt<span class="token punctuation">)</span><br>  io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>prompt <span class="token operator">..</span> <span class="token string">": "</span><span class="token punctuation">)</span><br>  <span class="token keyword">local</span> number <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"*number"</span><span class="token punctuation">)</span><br>  <span class="token comment">-- The previous line does not consume the newline character.</span><br>  <span class="token comment">-- Unless that is done, the next attempt to read a number will return `nil`.</span><br>  <span class="token comment">-- The following line consumes the newline character.</span><br>  <span class="token keyword">local</span> _ <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token keyword">return</span> number<br><span class="token keyword">end</span><br><br><span class="token keyword">function</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token keyword">local</span> dividend <span class="token operator">=</span> <span class="token function">read_number</span><span class="token punctuation">(</span><span class="token string">"Enter a dividend"</span><span class="token punctuation">)</span><br>  <span class="token keyword">if</span> <span class="token keyword">not</span> dividend <span class="token keyword">then</span><br>    <span class="token comment">-- Error messages here are tables containing a message and a code.</span><br>    <span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">{</span>message <span class="token operator">=</span> <span class="token string">"dividend is invalid"</span><span class="token punctuation">,</span> code <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br><br>  <span class="token keyword">local</span> divisor <span class="token operator">=</span> <span class="token function">read_number</span><span class="token punctuation">(</span><span class="token string">"Enter a divisor"</span><span class="token punctuation">)</span><br>  <span class="token keyword">if</span> <span class="token keyword">not</span> divisor <span class="token keyword">then</span><br>    <span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">{</span>message <span class="token operator">=</span> <span class="token string">"divisor is invalid"</span><span class="token punctuation">,</span> code <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br>  <span class="token keyword">if</span> divisor <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">then</span><br>    <span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">{</span>message <span class="token operator">=</span> <span class="token string">"cannot divide by zero"</span><span class="token punctuation">,</span> code <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br><br>  <span class="token keyword">local</span> quotient <span class="token operator">=</span> dividend <span class="token operator">/</span> divisor<br>  io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"The quotient is %.3f\n\n"</span><span class="token punctuation">,</span> quotient<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br><span class="token keyword">while</span> <span class="token keyword">true</span> <span class="token keyword">do</span><br>  <span class="token keyword">local</span> success<span class="token punctuation">,</span> err <span class="token operator">=</span> <span class="token function">pcall</span><span class="token punctuation">(</span>process<span class="token punctuation">)</span><br>  <span class="token keyword">if</span> <span class="token keyword">not</span> success <span class="token keyword">then</span><br>    <span class="token keyword">if</span> err <span class="token keyword">then</span><br>      <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s (code %d)"</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span>message<span class="token punctuation">,</span> err<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token keyword">end</span><br>    <span class="token comment">-- print(debug.traceback()) -- prints a stack trace</span><br>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- extra newline</span><br>  <span class="token keyword">end</span><br><span class="token keyword">end</span></code></pre><h1 id="c-integration" tabindex="-1">C Integration</h1><p>TODO: Add detail on calling C from Lua.</p><p>TODO: Add detail on calling Lua from C.</p><h2 id="http" tabindex="-1">HTTP</h2><p>The <a href="https://github.com/daurnimator/lua-http?v=1.0.20" rel="noopener" target="_blank">lua-http</a> is a Lua library that supports implementing HTTP servers and clients.</p><h2 id="games" tabindex="-1">Games</h2><p><a href="https://love2d.org?v=1.0.20" rel="noopener" target="_blank">LÖVE</a> is a Lua framework for building 2D games. It is free and open source. LÖVE can be downloaded from the previous link.</p><p>For macOS, click the &quot;64-bit zipped&quot; link under &quot;macOS&quot; to download <code>love.app</code>. Drag this file into the &quot;Applications&quot; directory. Double-click <code>love.app</code> to launch the app. This will fail the first time with the message &quot;love.app cannot be opened because the developer cannot be verified&quot;. To fix this, open the Settings app, select &quot;Privacy &amp; Security&quot;, scroll down to &quot;love.app was blocked ...&quot; and click the &quot;Open Anyway&quot; button.</p><p>Create a directory for a new game. Create a file in this directory named &quot;main.lua&quot;.</p><p>If using VS Code:</p><ul><li>Install the extension &quot;Love2D Support&quot; from Pixelbyte Studios.</li><li>Click the gear icon and select &quot;Extension Settings&quot;.</li><li>Change &quot;Pixelbyte &gt; love2d: Path&quot; to &quot;/Applications/love.app/Contents/MacOS/love&quot;.</li><li>Open a &quot;main.lua&quot; file in an editor tab.</li><li>Press cmd-l to run the game.</li></ul><p>Love2D programs always define the functions <code>love.load()</code>, <code>love.draw()</code>, and <code>love.update(dt)</code>. The <code>love.load()</code> function performs initial game setup. The <code>love.draw()</code> function specifies what should be drawn on the screen at any point in time. The <code>love.update(dt)</code> function implements the game logic.</p><p>The parameter <code>dt</code> in the <code>love.update</code> function is short for &quot;delta time&quot;. It is a floating point number that indicates the number of seconds requires to display each frame. This value can vary among devices. For example, when <code>dt</code> is <code>0.1</code>, the device displays 10 frames per second. This is used to make game updates frame rate independent.</p><p>Add a <code>conf.lua</code> file to your game project directory to configure the game. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> love<span class="token punctuation">.</span><span class="token function">conf</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><br>  t<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">"My Game"</span><br>  t<span class="token punctuation">.</span>version <span class="token operator">=</span> <span class="token string">"1.2.3"</span><br>  t<span class="token punctuation">.</span>console <span class="token operator">=</span> <span class="token keyword">true</span><br>  t<span class="token punctuation">.</span>window<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">1280</span><br>  t<span class="token punctuation">.</span>window<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">720</span><br><span class="token keyword">end</span></code></pre><p>To run a game, use one of these approaches:</p><ul><li>Drag the game directory onto the Love application icon.</li><li>If VS Code has been configured property, press cmd-l.</li><li>TODO: Other options?</li></ul><p>When comparing the distance between two points to some value, compare the square of the distance. This removes the need to use the <code>math.sqrt</code> function which can hurt game performance.</p><p>TODO: See lua/love-game/main.lua.</p><h2 id="unorganized-content" tabindex="-1">Unorganized Content</h2><p>summarize the constants and functions in all the standard libraries</p><p>does the: syntax for calling a function only work when the variable has a type that maps to a Standard Library like String and number and table and function?</p><p>How do you work with dates and times in Lua? Are there functions for formatting them?</p><p>Can precede function with local keyword to make it local to the current source file. Correct?</p><p>The ternary trick probably doesn’t work if the desired true value is false or nil.</p><p>Can assign a default value to a function parameter like this:</p><p>function foo(p1) p1 = p1 or default_value … end</p><p>Functions don’t specify the type they return or even if they do return a value. Functions must use the return keyword to return a value.</p><p>Are there recommended Lua linters and code formatters that run outside of VS Code?</p><p>What is the difference between these? my_var = 1 — Is this only global within the current source file? _G.my_var = 1 — Does this make it accessible outside the current source file?</p><p>When getting multiple return values from a function, you can use underscore to act as a placeholder for values you don’t want. ex. pairs function when you don’t want the key or ipairs function when you don’t want the index.</p><p>Functions can call themselves recursively.</p><p>Did you describe the fact that there is no compact syntax for defining them?</p><p>Coroutine status values include running, suspended, normal, and dead (computed or stopped due to error). coroutine.resume(my_coroutine) — starts or resumes a coroutine</p><p>Can a Lua program create multiple threads that run concurrently? What happens if you call coroutine.resume on a coroutine that has a status of dead?</p><p>The things in the standard library are “modules”, not “libraries”. io.read(…) returns nil if there is no more file content to read. There are addition file mode values that include “b” to work with binary files.</p><p>There are probably many variable assignments in the examples here that should be preceded by <code>local</code>.</p><p>OO-like objects hold their properties and methods in a table. Does each object get its own copy of every method?</p><style>h2,
  h3 {
    animation-direction: alternate;
    animation-duration: 500ms;
    animation-iteration-count: 2;
    /* color: purple; */
  }

  @keyframes pulse {
    to {
      color: red;
      font-size: 2rem;
    }
  }</style><script>// The brackets here add a local scope.
  {
    function callback(entries) {
      const intersecting = entries.filter(e => e.isIntersecting);
      for (const entry of entries) {
        entry.target.style.animationName = entry.isIntersecting
          ? 'pulse'
          : 'none';
      }
    }
    // This doesn't work in Safari if threshold is set to 1,
    // but it does work with 0.99.
    const observer = new IntersectionObserver(callback, {threshold: 0.99});

    const headings = document.querySelectorAll('h2,h3');
    for (const heading of headings) {
      observer.observe(heading);
    }
  }</script><p>you can use the or operator to avoid setting instance values to know when they are missing in the passed table. but beware of cases where are the table passed in contains false values because those will not be used if you simply check with the or operator.</p><p>this video suggest multiple ways to handle this: <a href="https://youtu.be/IQf82d3cr20">https://youtu.be/IQf82d3cr20</a></p><p>In the table section, describe copying tables like the following. Is there a way to make a deep copy? Maybe something recursive?</p><pre class="language-lua"><code class="language-lua">t <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"alpha"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"beta"</span><span class="token punctuation">,</span> <span class="token string">"gamma"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><br><span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">do</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br><span class="token comment">-- This makes a shallow copy.</span><br>copy <span class="token operator">=</span> <span class="token punctuation">{</span>table<span class="token punctuation">.</span><span class="token function">unpack</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">}</span><br><span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>copy<span class="token punctuation">)</span> <span class="token keyword">do</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br><span class="token comment">-- This wraps the approach above in a function.</span><br><span class="token keyword">function</span> table<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><br>  <span class="token keyword">return</span> <span class="token punctuation">{</span>table<span class="token punctuation">.</span><span class="token function">unpack</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">}</span><br><span class="token keyword">end</span><br>copy2 <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><br><span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>copy2<span class="token punctuation">)</span> <span class="token keyword">do</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><br><span class="token keyword">end</span></code></pre></article>