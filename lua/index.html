<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Lua</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#used-by">Used By</a></li><li><a href="#resources">Resources</a></li><li><a href="#cheat-sheets">Cheat Sheets</a></li><li><a href="#installing">Installing</a></li><li><a href="#compiling">Compiling</a><ol><li><a href="#luac">luac</a></li><li><a href="#luajit">LuaJIT</a></li><li><a href="#pallene">Pallene</a></li><li><a href="#teal">Teal</a></li></ol></li><li><a href="#vs-code-support">VS Code Support</a></li><li><a href="#grammar">Grammar</a></li><li><a href="#source-files">Source Files</a></li><li><a href="#running-code">Running Code</a></li><li><a href="#keywords">Keywords</a></li><li><a href="#comments">Comments</a></li><li><a href="#types">Types</a></li><li><a href="#input%2Foutput">Input/Output</a></li><li><a href="#names">Names</a></li><li><a href="#variables">Variables</a></li><li><a href="#booleans">Booleans</a></li><li><a href="#numbers">Numbers</a></li><li><a href="#strings">Strings</a></li><li><a href="#patterns">Patterns</a></li><li><a href="#operators">Operators</a></li><li><a href="#conditional-logic">Conditional Logic</a></li><li><a href="#iteration">Iteration</a></li><li><a href="#iterators">Iterators</a></li><li><a href="#functions">Functions</a></li><li><a href="#default-parameter-values">Default Parameter Values</a></li><li><a href="#tables">Tables</a></li><li><a href="#modules">Modules</a></li><li><a href="#metatables">Metatables</a><ol><li><a href="#table-delegation">Table Delegation</a></li><li><a href="#classes">Classes</a></li><li><a href="#method-syntax">Method Syntax</a></li><li><a href="#inheritance">Inheritance</a></li><li><a href="#multiple-inheritance">Multiple Inheritance</a></li><li><a href="#simplifying-classes">Simplifying Classes</a></li></ol></li><li><a href="#metamethods">Metamethods</a></li><li><a href="#evaluting-code-at-runtime">Evaluting Code at Runtime</a></li><li><a href="#lua-functional-(luafun)">Lua Functional (luafun)</a></li><li><a href="#standard-library">Standard Library</a><ol><li><a href="#basic-module">basic module</a></li><li><a href="#debug-module">debug module</a></li><li><a href="#io-module">io module</a></li><li><a href="#math-module">math module</a></li><li><a href="#io-module-1">io Module</a></li><li><a href="#os-module">os Module</a></li><li><a href="#string-module">string Module</a></li><li><a href="#table-module">table module</a></li></ol></li><li><a href="#environments">Environments</a></li><li><a href="#coroutines">Coroutines</a></li><li><a href="#networking">Networking</a></li><li><a href="#utility-functions">Utility Functions</a></li><li><a href="#error-handling">Error Handling</a></li><li><a href="#c-integration">C Integration</a></li><li><a href="#games">Games</a><ol><li><a href="#l%C3%B6ve">LÖVE</a></li><li><a href="#l%C3%B6vr">LÖVR</a></li></ol></li><li><a href="#unorganized-content">Unorganized Content</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p><img alt="Lua logo" style="width: 40%" src="/blog/assets/lua-logo.svg?v=1.0.20" title="Lua logo"></p><p><a href="https://www.lua.org/?v=1.0.20" rel="noopener" target="_blank">Lua</a> is a dynamically typed scripting language created in 1993 by a team at <a href="http://www.puc-rio.br?v=1.0.20" rel="noopener" target="_blank">Pontifical Catholic University of Rio de Janeiro</a> in Brazil. The team members include <a href="https://en.wikipedia.org/wiki/Roberto_Ierusalimschy?v=1.0.20" rel="noopener" target="_blank">Roberto Ierusalimschy</a>, <a href="https://web.tecgraf.puc-rio.br/~celes/?v=1.0.20" rel="noopener" target="_blank">Walemar Celes</a>, and <a href="https://lhf.impa.br/?v=1.0.20" rel="noopener" target="_blank">Luiz Henrique de Figueiredo</a>.</p><p>The Portuguese word &quot;Lua&quot; means &quot;Moon&quot;. The Lua logo depicts the Moon orbiting around the Earth and its shadow being cast onto the Earth.</p><p>The goals of Lua are:</p><ul><li>simplicity: easy to use by non-professional programmers</li><li>small size: supports embedding in non-Lua applications</li><li>scripting: easy to invoke from system languages such as C</li><li>portability: runs on any OS targeted by the ANSI C compiler</li></ul><p>Examples of Lua simplicity include having a small number of keywords (22) and indexing from 1 instead 0 (like matrices in math). The Lua reference manual that describes every language feature is only around 100 pages.</p><p>Standard Lua has an interpreter and a virtual machine. The interpreter is written in C and produces bytecode that runs in the virtual machine. Compiling to bytecode can be done at runtime or ahead of time</p><p>Lua has a relatively small standard library, but a large collection of optional packages can be installed using the <a href="https://luarocks.org?v=1.0.20" rel="noopener" target="_blank">LuaRocks</a> package manager.</p><p>Pros of Lua include:</p><ul><li>simple syntax with only 22 keywords</li><li>easy to embed in C/C++ applications; interpreter is only 182K</li><li>easy to run C code from Lua and run Lua code from C</li><li>highly portable; runs on all major OSes and most microcontrollers</li><li>free and open source under the MIT license</li><li>considered to be the fastest scripting language when compiled</li><li>uses dynamic variables that do not require specifying types</li><li>provides automatic, incremental garbage collection</li><li>functions are first class and are closures</li><li>implements tail call optimization</li><li>native support for collaborative multitasking with coroutines</li></ul><p>Cons of Lua include:</p><ul><li><p>lack of type checking</p></li><li><p>lack of support for object oriented programming (OOP), although it can be simulated with metatables and functions</p></li><li><p>limited support for error handling; see <code>error</code>, <code>pcall</code>, and <code>xpcall</code> functions</p></li><li><p>limited support for string pattern matching, using &quot;patterns&quot; which are a simplified version of regular expressions</p></li><li><p>limited Unicode support</p><p>Strings can contain Unicode characters, but indexing into such strings does not account for their size. See <a href="http://lua-users.org/wiki/LuaUnicode?v=1.0.20" rel="noopener" target="_blank">Lua Unicode</a>.</p></li><li><p>variables and functions are global by default,s but can be declared <code>local</code></p></li></ul><p>For a more extensive list of pros and cons, see <a href="http://notebook.kulchenko.com/programming/lua-good-different-bad-and-ugly-parts?v=1.0.20" rel="noopener" target="_blank">Lua: Good, bad, and ugly parts</a>.</p><h2 id="used-by" tabindex="-1">Used By</h2><p>Notable uses of Lua include:</p><ul><li><a href="https://www.angrybirds.com?v=1.0.20" rel="noopener" target="_blank">Angry Birds</a> game</li><li><a href="http://www.legoengineering.com/platform/nxt/?v=1.0.20" rel="noopener" target="_blank">Lego Mindstorms NXT</a> robotics platform</li><li><a href="https://www.minecraft.net/?v=1.0.20" rel="noopener" target="_blank">Minecraft</a> game</li><li><a href="https://neovim.io?v=1.0.20" rel="noopener" target="_blank">Neovim</a> text editor</li><li><a href="https://redis.io?v=1.0.20" rel="noopener" target="_blank">Redis</a> database</li><li><a href="https://www.roblox.com?v=1.0.20" rel="noopener" target="_blank">Roblox</a> game</li><li><a href="https://worldofwarcraft.blizzard.com/?v=1.0.20" rel="noopener" target="_blank">World of Warcraft</a> game</li><li>Texas Instruments <a href="https://education.ti.com/en/resources/lua-scripting?v=1.0.20" rel="noopener" target="_blank">TI-Nspire</a> graphing calculators</li></ul><p>Roblox uses a variant of Lua called Luau. From <a href="https://devforum.roblox.com/t/what-is-the-difference-between-lua-and-luau/2181620/2?v=1.0.20" rel="noopener" target="_blank">veilict</a>, &quot;Luau's main focus was for much needed optimizations to the Lua VM and to add more complex type checking, which allows you to see more in-depth errors before runtime. You can specify the type of a given variable yourself, or you can have Luau infer the type for you.&quot;</p><p>For a more extensive list of Lua use, see the <a href="https://en.wikipedia.org/wiki/List_of_applications_using_Lua?v=1.0.20" rel="noopener" target="_blank">List of applications using Lua</a> Wikipedia page.</p><h2 id="resources" tabindex="-1">Resources</h2><ul><li><p><a href="https://www.lua.org/manual/?v=1.0.20" rel="noopener" target="_blank">Lua Reference Manual</a></p></li><li><p><a href="https://www.lua.org/pil/?v=1.0.20" rel="noopener" target="_blank">Programming in Lua</a> official book</p></li><li><p><a href="https://www.lua.org/gems/?v=1.0.20" rel="noopener" target="_blank">Lua Programming Gems</a> - &quot;a collection of articles recording some of the wisdom and practice on how to program well in Lua&quot;</p></li><li><p><a href="https://www.youtube.com/watch?v=XxcSvnEIUq4?v=1.0.20" rel="noopener" target="_blank">Why (and why not) Lua</a> talk by Roberto Ierusalimschy (2019)</p></li><li><p><a href="https://github.com/pallene-lang/pallene?v=1.0.20" rel="noopener" target="_blank">Pallene</a>, &quot;a statically typed and ahead-of-time compiled sister language to Lua, with a focus on performance&quot;</p></li><li><p><a href="https://www.youtube.com/watch?v=H3inzGGFefg?v=1.0.20" rel="noopener" target="_blank">Lua and Pallene</a> talk by Roberto Ierusalimschy (2022)</p></li><li><p><a href="https://www.youtube.com/@teej_dv?v=1.0.20" rel="noopener" target="_blank">TJ DeVries</a> YouTube channel; TJ is a Neovim core maintainer and is the creator of several Neovim plugins including:</p><ul><li><a href="https://github.com/nvim-telescope/telescope.nvim?v=1.0.20" rel="noopener" target="_blank">telescope.nvim</a> &quot;highly extendable fuzzy finder&quot;</li><li><a href="https://github.com/nvim-lua/plenary.nvim?v=1.0.20" rel="noopener" target="_blank">plenary.nvim</a> collection of Lua functions used to write Neovim plugins</li><li><a href="https://github.com/tjdevries/tree-sitter-lua?v=1.0.20" rel="noopener" target="_blank">tree-sitter-lua</a> Tree-sitter grammar for Lua</li><li><a href="https://github.com/tjdevries/colorbuddy.nvim?v=1.0.20" rel="noopener" target="_blank">colorbuddy.nvim</a> for creating Neovim color schemes</li></ul></li><li><p><a href="https://github.com/nanotee/nvim-lua-guide?v=1.0.20" rel="noopener" target="_blank">Getting started using Lua in Neovim</a></p></li><li><p><a href="https://github.com/LewisJEllis/awesome-lua?v=1.0.20" rel="noopener" target="_blank">Awesome Lua</a> - &quot;a curated list of quality Lua packages and resources.&quot;</p></li></ul><h2 id="cheat-sheets" tabindex="-1">Cheat Sheets</h2><ul><li><a href="https://devhints.io/lua?v=1.0.20" rel="noopener" target="_blank">DevHints.io</a></li><li><a href="https://cheatography.com/srgmc/cheat-sheets/lua-scripting-5-1/?v=1.0.20" rel="noopener" target="_blank">Cheatography</a></li><li><a href="https://www.codecademy.com/learn/learn-lua/modules/learn-lua-introduction/cheatsheet?v=1.0.20" rel="noopener" target="_blank">codecademy</a></li></ul><h2 id="installing" tabindex="-1">Installing</h2><p>Lua can be installed in macOS using Homebrew. Enter <code>brew install lua</code> to install it. Enter <code>lua -v</code> to verify that it worked and see the version.</p><p>To install in other operating systems, see <a href="http://www.lua.org/start.html?v=1.0.20" rel="noopener" target="_blank">Getting Started</a>.</p><p>To experiment with Lua on the web without installing anything, see <a href="http://www.lua.org/demo.html?v=1.0.20" rel="noopener" target="_blank">Lua Demo</a>.</p><h2 id="compiling" tabindex="-1">Compiling</h2><p>Lua programs can be compiled to bytecode before runtime. This enables faster program startup because runtime bytecode generation is no longer needed.</p><p>The performance of standard Lua is worse than many scripting languages, including Python, unless it is compiled ahead of time (AOT) or just in time (JIT).</p><p>There are multiple ways to produce and execute Lua bytecode.</p><p>For a comparison of the performance of each approach, see <a href="https://eklausmeier.goip.de/blog/2020/05-14-performance-comparison-pallene-vs-lua-5-1-5-2-5-3-5-4-vs-c/?v=1.0.20" rel="noopener" target="_blank">Performance Comparison Pallene vs. Lua vs. C</a>.</p><h3 id="luac" tabindex="-1">luac</h3><p><a href="https://www.lua.org/manual/5.1/luac.html?v=1.0.20" rel="noopener" target="_blank">luac</a> is the standard Lua compiler. It reads Lua source code and outputs Lua bytecode.</p><p>To generate a bytecode file, enter a command like <code>luac demo.lua</code>. This creates the bytecode file <code>luac.out</code>. To change the file name, use the <code>-o</code> option. For example, <code>luac demo.lua -o demo.luac</code>.</p><p>To execute a bytecode file, pass it to the Lua interpreter. For example, <code>lua demo.luac</code>.</p><h3 id="luajit" tabindex="-1">LuaJIT</h3><p><a href="https://luajit.org/?v=1.0.20" rel="noopener" target="_blank">LuaJIT</a> is an alternative to <code>luac</code> that produces smaller bytecode files. LuaJIT also executes bytecode files and provides runtime optimizations that typically result in better performance.</p><p>LuaJIT is implemented by a separate team from the one that maintains Lua.</p><p>From <a href="https://api7.ai/learning-center/openresty/luajit-vs-lua?v=1.0.20" rel="noopener" target="_blank">api7.ai</a>:</p><blockquote><p>The LuaJIT runtime environment ... has a JIT compiler that can generate machine code directly. The LuaJIT interpreter records some runtime statistics while executing the bytecode, such as the actual number of times each Lua function call entry is run and the actual number of times each Lua loop is executed. When these counts exceed a random threshold, the corresponding Lua function entry or Lua loop is considered hot enough to trigger the JIT compiler to start working. The JIT compiler tries to compile the corresponding Lua code path, starting from the hot function's entry or the hot loop's location. The compilation process converts the LuaJIT bytecode into LuaJIT's own defined Intermediate Representation (IR) and then generates machine code for the target architecture.</p></blockquote><p>To install LuaJIT:</p><ul><li>Download the source by entering <code>git clone https://luajit.org/git/luajit.git</code>.</li><li>Enter <code>cd luajit</code></li><li>In macOS, enter <code>export MACOSX_DEPLOYMENT_TARGET={version}</code> where <code>version</code> is a value like <code>13.2</code>.</li><li>Enter <code>make &amp;&amp; sudo make install</code></li><li>The previous command will ask you to create a symlink with a command like <code>ln -sf luajit-2.1.0-beta3 /usr/local/bin/luajit</code>. Enter that command.</li></ul><p>To generate a bytecode file from a Lua program, enter a command like <code>luajit -b demo.lua demo.out</code> To execute a bytecode file, enter a command like <code>luajit demo.out</code>. This will start faster than entering <code>luajit demo.lua</code> which performs just-in-time compilation at runtime.</p><h3 id="pallene" tabindex="-1">Pallene</h3><p>&quot;<a href="https://github.com/pallene-lang/pallene?v=1.0.20" rel="noopener" target="_blank">Pallene</a> is a statically typed and ahead-of-time compiled sister language to Lua, with a focus on performance. It is intended for writing performance sensitive code that interacts with Lua, a space that is currently filled by C modules and by LuaJIT. Compared to C, Pallene should offer better support for interacting with Lua data types, bypassing the unfriendly syntax and performance overhead of the Lua-C API. Compared to LuaJIT, Pallene aims to offer more predictable run-time performance.&quot;</p><p>Pallene is the name of one of the moons of Saturn. The name of the moon is pronounced &quot;puh lee nee&quot;, but the language designer pronounces it &quot;pah lean&quot;.</p><p>One use case is to write performance-critical modules in Pallene, compile them, and require them in Lua code.</p><p>To install Pallene, see the detailed instructions at the Pallene link above.</p><h3 id="teal" tabindex="-1">Teal</h3><p><a href="https://github.com/teal-language/tl?v=1.0.20" rel="noopener" target="_blank">Teal</a> is a typed dialect of Lua.</p><p>The supported types are <code>any</code>, <code>nil</code>, <code>boolean</code>, <code>integer</code>, <code>number</code>, <code>string</code>, <code>function</code>, <code>enum</code>, <code>record</code>, <code>thread</code>, and table types described by their allowed key and value types.</p><p>To install Teal, enter <code>luarocks install tl</code>.</p><p>To perform type checking of a Teal script without running it, enter <code>tl check {file-name}.tl</code>.</p><p>To perform type checking and generate a <code>.lua</code> file with type annotations removed, enter <code>tl gen {file-name}.tl</code>.</p><p>To run a Teal script, enter <code>tl run {file-name}.tl</code>.</p><p>To add support for Teal in Neovim, create the file <code>~/.config/nvim/lua/user/plugins/vim-teal.lua</code> containing the following. This may require also using ALE to get syntax highlighting.</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">return</span> <span class="token punctuation">{</span><br>  <span class="token string">"teal-language/vim-teal"</span><br><span class="token punctuation">}</span></code></pre><p>The following code demonstrates using Teal to implement <a href="https://en.wikipedia.org/wiki/Fizz_buzz?v=1.0.20" rel="noopener" target="_blank">Fizz buzz</a>. This code will make more sense after reading the sections that follow.</p><pre class="language-lua"><code class="language-lua"><span class="token comment">-- This type describes a number and the text that should</span><br><span class="token comment">-- be printed if a given number is divisible by it.</span><br><span class="token keyword">local</span> type Rule <span class="token operator">=</span> <span class="token punctuation">{</span>number<span class="token punctuation">,</span> string<span class="token punctuation">}</span><br><br><span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">fizzBuzz</span><span class="token punctuation">(</span>limit<span class="token punctuation">:</span> number<span class="token punctuation">,</span> rules<span class="token punctuation">:</span> <span class="token punctuation">{</span>Rule<span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token keyword">for</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> limit <span class="token keyword">do</span><br>    <span class="token keyword">local</span> matched <span class="token operator">=</span> <span class="token keyword">false</span><br>    <span class="token keyword">for</span> _<span class="token punctuation">,</span> rule <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>rules<span class="token punctuation">)</span> <span class="token keyword">do</span><br>      <span class="token keyword">local</span> number <span class="token operator">=</span> rule<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> as number<br>      <span class="token keyword">local</span> text <span class="token operator">=</span> rule<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> as string<br>      <span class="token keyword">if</span> n <span class="token operator">%</span> number <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">then</span><br>        <span class="token function">print</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><br>        matched <span class="token operator">=</span> <span class="token keyword">true</span><br>      <span class="token keyword">end</span><br>    <span class="token keyword">end</span><br>    <span class="token keyword">if</span> <span class="token keyword">not</span> matched <span class="token keyword">then</span> <span class="token function">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token keyword">end</span><br>  <span class="token keyword">end</span><br><span class="token keyword">end</span><br><br><span class="token function">fizzBuzz</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>  <span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"fizz"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">"buzz"</span><span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><h2 id="vs-code-support" tabindex="-1">VS Code Support</h2><p>VS Code has great support for Lua.</p><p>The <a href="https://github.com/LuaLS/lua-language-server?v=1.0.20" rel="noopener" target="_blank">Lua</a> extension from sumneko is a Lua language server. It provides code annotations, syntax checking, dynamic type checking, code formatting, spell checking, and more.</p><p>To disable specific diagnostics, open Settings, filter on &quot;Lua&quot;, scroll down to &quot;Lua &gt; Diagnostics: Disable&quot;, click the &quot;Add Item&quot; button, select a diagnostic name from the drop-down, and click the &quot;OK&quot; button.</p><p>The <a href="https://github.com/Koihik/vscode-lua-format?v=1.0.20" rel="noopener" target="_blank">vscode-lua-format</a> extension from Koihik is a popular Lua code formatting extension. To configure this, open Settings, filter on &quot;Lua&quot;, and enter the path to a configuration file in &quot;Vscode-lua-format: Config Path&quot; such as <code>/Users/{your-user}/Documents/dev/lang/lua/style.config</code>. Then create the file <code>style.config</code> in that location containing something like the following:</p><pre class="language-text"><code class="language-text"># See all the Lua code formatting options at<br># https://github.com/Koihik/LuaFormatter/blob/master/docs/Style-Config.md<br><br>column_limit: 80<br>continuation_indent_width: 2<br>indent_width: 2<br>keep_simple_control_block_one_line: true<br>keep_simple_function_one_line: true<br>single_quote_to_double_quote: true<br>use_tab: false</code></pre><p>The <a href="https://marketplace.visualstudio.com/items?itemName=actboy168.lua-debug?v=1.0.20" rel="noopener" target="_blank">Lua Debug</a> VS Code extension supports debugging Lua code with breakpoints and watches.</p><h2 id="grammar" tabindex="-1">Grammar</h2><p>Lua is a very simple language. The entire grammar, except comment syntax, is described below.</p><ul><li>&quot;binop&quot; is short for &quot;binary operator&quot;.</li><li>&quot;exp&quot; is short for &quot;expression&quot;.</li><li>&quot;fieldsep&quot; is short for &quot;field separator&quot;.</li><li>&quot;stat&quot; is short for &quot;statement&quot;.</li><li>&quot;unop&quot; is short for &quot;unary operator&quot;.</li><li>&quot;var&quot; is short for &quot;variable&quot;.</li></ul><code>chunk ::= {stat [';']} [laststat[';']]<p>block ::= chunk</p><p>stat ::=<br>varlist1 '=' explist1 |<br>local namelist ['=' explist1] |<br>if exp then block {elseif exp then block} [else block] end |<br>do block end |<br>while exp do block end |<br>repeat block until exp |<br>for Name '=' exp ',' exp [',' exp] do block end |<br>for namelist in explist1 do block end |<br>function funcname funcbody |<br>local function Name funcbody |<br>functioncall</p><p>laststat ::= return [explist1] | break</p><p>funcname ::= Name {'.' Name} [':' Name]</p><p>varlist1 ::= var {',' var}</p><p>var ::= Name | prefixexp '[' exp ']' | prefixexp '.' Name</p><p>namelist ::= Name {',' Name}</p><p>explist1 ::= {exp ','} exp</p><p>exp ::=<br>nil | false | true | Number | String | '...' |<br>function | prefixexp | tableconstructor | exp binop exp | unop exp</p><p>prefixexp ::= var | functioncall | '(' exp ')'</p><p>functioncall ::= prefixexp args | prefixexp ':' Name args</p><p>args ::= '(' [explist1] ')' | tableconstructor | String</p><p>function ::= function funcbody</p><p>funcbody ::= '(' [parlist1] ')' block end</p><p>parlist1 ::= namelist [',' '...'] | '...'</p><p>tableconstructor ::= '{' [fieldlist] '}'</p><p>fieldlist ::= field {fieldsep field} [fieldsep]</p><p>field ::= '[' exp ']' '=' exp | Name '=' exp | exp</p><p>fieldsep ::= ',' | ';'</p><p>binop ::=<br>'+' | '-' | '*' | '/' | '^' | '%' | '..' |<br>'&lt;' | '&lt;=' | '&gt;' | '&gt;=' | '==' | '~=' |<br>and | or</p><p>unop ::= '-' | not | '#'</p></code><p></p><h2 id="source-files" tabindex="-1">Source Files</h2><p>Lua source files have a <code>.lua</code> extension.</p><p>A source file can use variables and functions defined in another source file by using the <code>require</code> function. The following statement loads the file <code>other.lua</code>:</p><pre class="language-lua"><code class="language-lua">require <span class="token string">"other"</span></code></pre><p>For more information on using <code>require</code>, see the &quot;Modules&quot; section.</p><h2 id="running-code" tabindex="-1">Running Code</h2><p>To use the Lua <a href="https://en.wikipedia.org/wiki/Read–eval–print_loop?v=1.0.20" rel="noopener" target="_blank">REPL</a>, enter <code>lua</code> and then enter Lua statements. To exit the REPL, press ctrl-c or ctrl-d.</p><p>To run a Lua program, enter <code>lua {filename}.lua</code>. This runs the Lua interpreter on the source file to produce bytecode and uses the Lua virtual machine to execute the bytecode. Alternatively, consider using <code>luajit</code>.</p><p>There are several tools that claim to produce executable files from Lua programs. However, none of them seem to be popular or actively maintained.</p><h2 id="keywords" tabindex="-1">Keywords</h2><p>The Lua programming language only defines 22 keywords. Some of the keywords such as <code>then</code>, <code>and</code>, <code>or</code>, and <code>end</code> make the syntax similar to the Ruby programming language.</p><p>Each of the 22 keywords are summarized below.</p><p>Boolean literal values:</p><ul><li><code>true</code></li><li><code>false</code></li></ul><p>Conditional Logic:</p><ul><li><code>if</code></li><li><code>then</code></li><li><code>elseif</code></li><li><code>else</code></li></ul><p>Functions:</p><ul><li><code>function</code></li><li><code>return</code></li></ul><p>Iteration:</p><ul><li><code>for</code>: loop over numbers or pairs</li><li><code>in</code>: used with <code>for</code> to specify what to loop over</li><li><code>while</code>: top-tested loop</li><li><code>repeat</code> and <code>until</code>: bottom-tested loo</li><li><code>break</code>: exit loop early</li></ul><p>Logical Operators:</p><ul><li><code>and</code></li><li><code>or</code></li><li><code>not</code></li></ul><p>Variables:</p><ul><li><code>local</code>: default to global without this</li></ul><p>Other:</p><ul><li><code>do</code>: begins a new lexical block</li><li><code>end</code>: marks the end of a lexical block</li><li><code>goto</code>: jumps to a label</li><li><code>nil</code>: represents having no value</li></ul><h2 id="comments" tabindex="-1">Comments</h2><p>A single-line comment begins with two dashes. For example, <code>-- This is a comment.</code></p><p>A multi-line comment is a single-line comment followed by a multi-line string. They begin with <code>--[[</code> and end with <code>]]</code>. No characters are allowed between the beginning <code>--</code> and <code>[[</code>. Sometimes multi-line comments end with <code>--]]</code> to make the end easier to see, but the <code>--</code> is really just part of the multi-line string. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token comment">--[[<br>This is a multi-line comment<br>that could contain Lua code<br>which is temporarily disabled.<br>--]]</span></code></pre><p>To create a comment around lines that already contain multi-line comments, include any number of equal sizes between the square brackets. This is useful for commented out a section of code that contains a commented out section. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token comment">--[=[<br>  print("one")<br>  --[[<br>  print("two")<br>  print("three")<br>  --]]<br>  print("four")<br>--]=]</span></code></pre><h2 id="types" tabindex="-1">Types</h2><p>Lua uses dynamic types. The types of variables and function parameters are never specified and are always inferred.</p><p>Primitive type conversions are supported by the <code>tonumber</code> and <code>tostring</code> functions. There are no builtin functions for converting a boolean to a number, a number to a boolean, or a string to a boolean.</p><p>The only values treated as <code>false</code> in conditions are <code>false</code> and <code>nil</code>. The number zero and empty strings are not treated as <code>false</code>.</p><p>The following table shows how to convert each primitive type to the other primitive types.</p><table><thead><tr><th>From</th><th>To Boolean</th><th>To Number</th><th>To String</th></tr></thead><tbody><tr><td>boolean <code>b</code></td><td>not needed</td><td><code>b and 1 or 0</code></td><td><code>tostring(b)</code></td></tr><tr><td>number <code>n</code></td><td><code>n == 0</code></td><td>not needed</td><td><code>tostring(n)</code></td></tr><tr><td>string <code>s</code></td><td><code>s == &quot;true&quot;</code></td><td><code>tonumber(s)</code></td><td>not needed</td></tr></tbody></table><p>The conversion from a number to a boolean above assumes that all numbers except zero should be treated as <code>false</code>.</p><p>The <code>tonumber</code> function returns <code>nil</code> if the conversion is not possible.</p><p>While it is not commonly done, functions can validate the types of arguments passed to them using the <code>assert</code> function. This takes a condition and an optional message that defaults to &quot;assertion failed!&quot;. If the condition evaluates to <code>false</code>, it prints the message and terminates the program. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">demo</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><br>  <span class="token function">assert</span><span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"string"</span><span class="token punctuation">,</span> <span class="token string">"demo requires a string"</span><span class="token punctuation">)</span><br>  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br><span class="token function">demo</span><span class="token punctuation">(</span><span class="token string">"yes"</span><span class="token punctuation">)</span> <span class="token comment">-- success</span><br><span class="token function">demo</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token comment">-- demo requires a string</span></code></pre><h2 id="input%2Foutput" tabindex="-1">Input/Output</h2><p>To write to stdout, use the <code>print</code> function or the<code>io.write</code> function. Both take any number of arguments.</p><p>The <code>print</code> function adds a tab character between each value and a newline at the end of its output. The <code>print</code> function can be called with no arguments to only write a newline character.</p><p>I prefer for the <code>print</code> function to separate values with a single space instead of a tab. To override it to do that, add the following function.</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">...</span><span class="token punctuation">)</span><br>  <span class="token keyword">local</span> t <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">...</span> <span class="token punctuation">}</span><br>  <span class="token keyword">local</span> len <span class="token operator">=</span> <span class="token operator">#</span>t<br>  <span class="token keyword">for</span> i<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">do</span><br>    io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token function">tostring</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token keyword">if</span> i <span class="token operator">&lt;</span> len <span class="token keyword">then</span> io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span> <span class="token keyword">end</span><br>  <span class="token keyword">end</span><br>  io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><br><span class="token keyword">end</span></code></pre><p>The <code>io.write</code> function does not add any characters between values and does not add a newline at the end. Boolean values must be converted to strings before being passed to <code>io.write</code>.</p><p>For example:</p><pre class="language-lua"><code class="language-lua"><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token comment">-- Hello   true    7</span><br>io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">,</span> <span class="token function">tostring</span><span class="token punctuation">(</span><span class="token keyword">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token comment">-- Hellotrue7</span></code></pre><p>To read from stdin, use the <code>io.read</code> function. By default this returns a string, but it can also be asked to return a number.</p><p>The following code prompts for two numbers and prints their sum.</p><pre class="language-lua"><code class="language-lua">io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"First Number: "</span><span class="token punctuation">)</span><br><span class="token comment">-- This form of `io.read` returns a number</span><br><span class="token comment">-- or nil if a non-number is entered.</span><br>n1 <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"n"</span><span class="token punctuation">)</span><br><br>io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"Second Number: "</span><span class="token punctuation">)</span><br>n2 <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"n"</span><span class="token punctuation">)</span><br><br><span class="token keyword">if</span> n1 <span class="token keyword">and</span> n2 <span class="token keyword">then</span><br>  sum <span class="token operator">=</span> n1 <span class="token operator">+</span> n2<br>  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Sum: "</span> <span class="token operator">..</span> sum<span class="token punctuation">)</span> <span class="token comment">-- `..` operator performs string concatenation</span><br><span class="token keyword">else</span><br>  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"An invalid number was entered."</span><span class="token punctuation">)</span><br><span class="token keyword">end</span></code></pre><p>To print to the terminal using colors, see:</p><ul><li><p><a href="https://github.com/kikito/ansicolors.lua?v=1.0.20" rel="noopener" target="_blank">ansicolors.lua</a></p><p>To install, enter <code>luarocks install ansicolors</code></p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> term <span class="token operator">=</span> require <span class="token string">'term'</span><br><span class="token keyword">local</span> colors <span class="token operator">=</span> term<span class="token punctuation">.</span>colors<br><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">colors</span><span class="token punctuation">(</span><span class="token string">"%{bright red}red"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">colors</span><span class="token punctuation">(</span><span class="token string">"%{bright yellow}yellow"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">colors</span><span class="token punctuation">(</span><span class="token string">"%{bright blue}blue"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'white'</span><span class="token punctuation">)</span></code></pre></li><li><p><a href="https://github.com/hoelzro/lua-term?v=1.0.20" rel="noopener" target="_blank">lua-term</a></p><p>To install, enter <code>luarocks install lua-term</code></p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> term <span class="token operator">=</span> require <span class="token string">'term'</span><br><span class="token keyword">local</span> colors <span class="token operator">=</span> term<span class="token punctuation">.</span>colors<br><br><span class="token function">print</span><span class="token punctuation">(</span>colors<span class="token punctuation">.</span>bright <span class="token operator">..</span> colors<span class="token punctuation">.</span>red <span class="token string">'red'</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>colors<span class="token punctuation">.</span>bright <span class="token operator">..</span> colors<span class="token punctuation">.</span>yellow <span class="token string">'yellow'</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>colors<span class="token punctuation">.</span>bright <span class="token operator">..</span> colors<span class="token punctuation">.</span>blue <span class="token operator">..</span> <span class="token string">'blue'</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>colors<span class="token punctuation">.</span>reset <span class="token string">'white'</span><span class="token punctuation">)</span></code></pre></li></ul><p>For information on reading and writing files, see the &quot;Standard Library&quot; &quot;io Module&quot; section below.</p><h2 id="names" tabindex="-1">Names</h2><p>Variable and function names can contain letters, digits, and underscores, but no other symbols. They cannot start with a digit.</p><p>In multi-word names, the words can be separated by underscores (preferred) or written in camel-case. For example, <code>one_long_name</code> or <code>oneLongName</code>.</p><p>Variable names, function names, and table keys are case-sensitive.</p><h2 id="variables" tabindex="-1">Variables</h2><p>To assign a value to a variable, use the <code>=</code> operator.</p><p>Variables with no assigned value have the value <code>nil</code>.</p><p>New values of any type can be assigned to a variable at any time.</p><p>The <code>type(some_variable)</code> function returns a string containing the type name of the variable value. This can be <code>nil</code>, <code>boolean</code>, <code>number</code>, <code>string</code>, <code>table</code>, <code>function</code>, <code>thread</code>, or <code>userdata</code>.</p><p>The <code>thread</code> type represents a coroutine which is described in the &quot;Coroutines&quot; section below.</p><p>The <code>userdata</code> type represents raw data provided through the C API.</p><p>Multi-variable assignment is supported. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><br>a<span class="token punctuation">,</span> b <span class="token operator">=</span> b<span class="token punctuation">,</span> a <span class="token comment">-- swaps values</span></code></pre><p>Variables are global by default, even when defined in a different source file. Use the <code>local</code> keyword to confine their use to the current scope. It is common in Lua configuration files to expose values as global variables. This is likely the reason that variables are global, rather than local, by default.</p><p>For example:</p><pre class="language-lua"><code class="language-lua">a <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">-- global, even if assigned inside a function</span><br><span class="token keyword">local</span> b <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment">-- local to the current scope</span></code></pre><p>It is an unenforced convention for global variables to begin with a capital letter and for the names of constants to be all uppercase.</p><p>All variables assigned without the <code>local</code> keyword are added to the global table <code>_G</code>. For example:</p><pre><code>MyGlobal = &quot;demo&quot;
_G.MyGlobal = &quot;demo&quot; -- same as previous line

print(MyGlobal) -- demo
print(_G[&quot;MyGlobal&quot;]) -- demo
print(_G.MyGlobal) -- demo
</code></pre><h2 id="booleans" tabindex="-1">Booleans</h2><p>The boolean literal values are <code>true</code> and <code>false</code>.</p><p>In conditions, the only values treated as false are <code>false</code> and <code>nil</code>. The number zero, an empty string, and an empty table are all treated as true.</p><p>Variables can be set to a condition to obtain a boolean value. For example, <code>is_higher = my_score &gt; your_score</code> sets <code>is_higher</code> to <code>true</code> or <code>false</code>.</p><h2 id="numbers" tabindex="-1">Numbers</h2><p>The <code>number</code> type typically represents numbers with 64-bit integers or double precision floats. However, implementations are free to use other sizes.</p><p>Lua automatic converts numbers between integer and float representations as needed.</p><p>The <code>math.type</code> function returns a string indicating the specific type of a number. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> i <span class="token operator">=</span> <span class="token number">19</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- number  integer</span><br><br><span class="token keyword">local</span> f <span class="token operator">=</span> <span class="token number">3.14</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- number   float</span></code></pre><h2 id="strings" tabindex="-1">Strings</h2><p>The <code>string</code> type is used for single and multiple character text. There is no dedicated type for single characters.</p><p>Strings can be delimited with either single or double quotes. For example, <code>'Hello World!'</code> or <code>&quot;Hello World!&quot;</code>. This syntax is referred to as a &quot;short literal string&quot;.</p><p>Escaping certain characters by preceding them with a backslash changes how they are interpreted. For example:</p><ul><li><code>\n</code> produces a newline character</li><li><code>\t</code> produces a tab character</li><li><code>\&quot;</code> produces a double quote inside a string delimited by double quotes</li><li><code>\'</code> produces a single quote inside a string delimited by single quotes</li><li><code>\\</code> produces a backslash character</li></ul><p>Multi-line strings are delimited by <code>[[</code> and <code>]]</code>. This syntax is referred to as a &quot;long strings&quot;. A newline after <code>[[</code> is ignored and a newline before <code>]]</code> is not ignored. Otherwise newlines and indentation inside the square brackets are retained. For example:</p><pre class="language-lua"><code class="language-lua">haiku <span class="token operator">=</span> <span class="token string">[[<br>Out of memory.<br>We wish to hold the sky.<br>But we never will.]]</span></code></pre><p>There can be any number of <code>=</code> characters between the opening and closing square brackets as long as the count matches. For example, <code>[==[some text]==]</code>. This enables creating strings that contain <code>]]</code> or closing square brackets with a different number of equal signs between them.</p><p>Strings are indexed starting from 1 instead of 0.</p><p>To concatenate strings, use the <code>..</code> operator. This creates a new string and does not modifier either operand. For example, <code>fullName = firstName .. ' ' .. lastName</code>.</p><p>Strings are immutable. Operations on them create new strings.</p><p>String operations are supported by the <code>string</code> standard library which is described later.</p><h2 id="patterns" tabindex="-1">Patterns</h2><p>A pattern is a string containing magic characters and character classes. Patterns are similar to regular expressions, but are bit simpler and not quite as powerful.</p><p>Regular expressions are not directly supported in Lua. The reason for this is that the code to support patterns is much smaller than the code required to support regular expressions. Opting out of regular expression support helps achieve the Lua goal of being small.</p><p>Patterns are used in the string library functions <code>find</code>, <code>gmatch</code>, <code>gsub</code>, and <code>match</code>.</p><p>Characters referred to as &quot;magic characters&quot; have special meaning in patterns. To include them as literal characters without their special meaning, precede them with a <code>%</code> character. The magic characters include:</p><table><thead><tr><th>Magic Character</th><th>Meaning</th></tr></thead><tbody><tr><td><code>^</code></td><td>start anchor or negates a character class</td></tr><tr><td><code>$</code></td><td>end anchor</td></tr><tr><td><code>.</code></td><td>matches any single character</td></tr><tr><td><code>?</code></td><td>zero or one</td></tr><tr><td><code>*</code></td><td>zero or more</td></tr><tr><td><code>+</code></td><td>one or more</td></tr><tr><td><code>[</code></td><td>begins a character class</td></tr><tr><td><code>]</code></td><td>ends a character class</td></tr><tr><td><code>-</code></td><td>forms a range in a custom character class</td></tr><tr><td><code>(</code></td><td>begins a capture group</td></tr><tr><td><code>)</code></td><td>ends a capture group</td></tr><tr><td><code>%</code></td><td>escapes a magic character (ex. <code>%$</code> represents <code>$</code>)</td></tr></tbody></table><p>Character classes are used to match sets of characters. The provided character classes begin with a <code>%</code> character rather than a backslash as they do in regular expression. This was chosen because Lua patterns are strings and strings use backslash to escape characters (ex. <code>\n</code>). If character classes also began with a backslash, they would need to be escaped (ex. <code>\\d</code> instead of <code>%d</code>).</p><p>The provided character classes include:</p><table><thead><tr><th>Character Class</th><th>Meaning</th></tr></thead><tbody><tr><td><code>%a</code></td><td>letters</td></tr><tr><td><code>%c</code></td><td>control characters</td></tr><tr><td><code>%d</code></td><td>digits</td></tr><tr><td><code>%g</code></td><td>printable characters except spaces</td></tr><tr><td><code>%l</code></td><td>lowercase letters</td></tr><tr><td><code>%p</code></td><td>punctuation characters</td></tr><tr><td><code>%s</code></td><td>space characters</td></tr><tr><td><code>%u</code></td><td>uppercase letters</td></tr><tr><td><code>%w</code></td><td>alphanumeric characters</td></tr><tr><td><code>%x</code></td><td>hexadecimal digits</td></tr></tbody></table><p>Custom character classes can be defined by listing individual characters and/or ranges of characters inside square brackets. For example:</p><ul><li><code>[13579]</code> describes odd, single-digit numbers</li><li><code>[abcA-C]</code> allows the characters <code>a</code>, <code>b</code>, <code>c</code>, <code>A</code>, <code>B</code>, and <code>C</code></li><li><code>[%da-fA-F]</code> is the equivalent of <code>%x</code> to describe a hexadecimal digit</li></ul><p>TODO: Add content from <a href="https://www.lua.org/pil/20.2.html">https://www.lua.org/pil/20.2.html</a>.</p><p>TODO: See examples in dev/lua/patterns.lua.</p><p>The <code>string.match</code> function takes a source string and a pattern. When the pattern contains capture groups, <code>string.match</code> returns the text matched by each capture group. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> s <span class="token operator">=</span> <span class="token string">"The score was 19 to 7."</span><br><span class="token keyword">local</span> pattern <span class="token operator">=</span> <span class="token string">"(%d+).+(%d+)"</span><br><span class="token keyword">local</span> score1<span class="token punctuation">,</span> score2 <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> pattern<span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>score1<span class="token punctuation">,</span> score2<span class="token punctuation">)</span> <span class="token comment">-- 19      7</span></code></pre><p>The <code>string.gsub</code> function performs global substitution. It takes source string, a pattern for finding text to replace, the replacement (a string, table, or function), and an option limit on the number of replacements that should be made. It returns a new version of the source string with the replacements made. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> s <span class="token operator">=</span><br>  <span class="token string">"The 2nd time was easier than the 1st, and the 4th was a piece of cake."</span><br><span class="token keyword">local</span> pattern <span class="token operator">=</span> <span class="token string">"%d%l%l"</span><br><br><span class="token keyword">local</span> replTable <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token punctuation">[</span><span class="token string">"1st"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"first"</span><span class="token punctuation">,</span><br>  <span class="token punctuation">[</span><span class="token string">"2nd"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"second"</span><span class="token punctuation">,</span><br>  <span class="token punctuation">[</span><span class="token string">"3rd"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"third"</span><br><span class="token punctuation">}</span><br><span class="token comment">-- If a key for the match is not found in `replTable`, it keeps the match.</span><br><span class="token keyword">local</span> s2 <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">gsub</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> pattern<span class="token punctuation">,</span> replTable<span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><br><span class="token comment">-- The second time was easier than the first, and the 4th was a piece of cake.</span><br><br><span class="token comment">-- This function produces the same result as using `replTable`.</span><br><span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">replFn</span><span class="token punctuation">(</span>match<span class="token punctuation">)</span><br>  <span class="token keyword">if</span> match <span class="token operator">==</span> <span class="token string">"1st"</span> <span class="token keyword">then</span> <span class="token keyword">return</span> <span class="token string">"first"</span> <span class="token keyword">end</span><br>  <span class="token keyword">if</span> match <span class="token operator">==</span> <span class="token string">"2nd"</span> <span class="token keyword">then</span> <span class="token keyword">return</span> <span class="token string">"second"</span> <span class="token keyword">end</span><br>  <span class="token keyword">if</span> match <span class="token operator">==</span> <span class="token string">"3rd"</span> <span class="token keyword">then</span> <span class="token keyword">return</span> <span class="token string">"third"</span> <span class="token keyword">end</span><br>  <span class="token keyword">return</span> match<br><span class="token keyword">end</span><br><br><span class="token keyword">local</span> s3 <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">gsub</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> pattern<span class="token punctuation">,</span> replFn<span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>s3<span class="token punctuation">)</span><br><span class="token comment">-- The second time was easier than the first, and the 4th was a piece of cake.</span></code></pre><h2 id="operators" tabindex="-1">Operators</h2><p>Lua supports the following mathematical operators:</p><ul><li><code>+</code> addition (not string concatenation)</li><li><code>-</code> subtraction (binary) or negation (unary)</li><li><code>*</code> multiplication</li><li><code>/</code> division; ex. <code>7 / 4</code> gives <code>1.75</code></li><li><code>//</code> floor division; ex. <code>7 // 4</code> gives <code>1</code></li><li><code>%</code> modulo; ex. <code>7 % 4</code> gives <code>3</code></li><li><code>^</code> exponentiation; ex. <code>2 ^ 3</code> gives <code>8</code></li></ul><p>The <code>++</code> and <code>--</code> operators found in many other programming languages are not supported.</p><p>Lua supports the following relational operators:</p><ul><li><code>==</code> equal</li><li><code>~=</code> not equal (differs from other languages that use <code>!=</code>)</li><li><code>&lt;</code> less than</li><li><code>&gt;</code> greater than</li><li><code>&lt;=</code> less than or equal to</li><li><code>&gt;=</code> greater than or equal to</li></ul><p>Tables are compared by their memory addresses, not by their contents.</p><p>Lua supports the following logical operators:</p><ul><li><code>and</code></li><li><code>or</code></li><li><code>not</code></li></ul><p>Lua supports the following bitwise operators:</p><ul><li><code>&amp;</code> bitwise and</li><li><code>|</code> bitwise or</li><li><code>~</code> bitwise exclusive or (binary) or bitwise not (unary)</li><li><code>&lt;&lt;</code> bit shift left</li><li><code>&gt;&gt;</code> bit shift right</li></ul><p>The only supported assignment operator <code>=</code>. Shorthand assignment operators like <code>+=</code> that are supported by many other programming languages are not supported in Lua. To add a number to a variable, use the form <code>myVar = myVar + n</code>.</p><p>The operator <code>..</code> is used to concatenate strings. Both operands must be either a string or number. Numbers are automatically converted to strings.</p><p>The <code>#</code> operator is applied on the left side of a string or table to get its length. For a string, this returns the number of bytes which can differ from the number of characters when Unicode characters are included. For a table, this returns the last consecutive integer index starting from <code>1</code>. In a table with the keys <code>1</code>, <code>2</code>, <code>3</code>, and <code>7</code>, the length is reported as <code>3</code>.</p><p>Lua operators have the following precedence from highest to lowest:</p><ul><li><code>^</code></li><li>unary <code>-</code>, <code>~</code>, <code>#</code>, and <code>not</code></li><li><code>*</code>, <code>/</code>, <code>//</code>, <code>%</code></li><li><code>+</code> and binary <code>-</code></li><li><code>..</code></li><li><code>&lt;&lt;</code> and <code>&gt;&gt;</code></li><li><code>&amp;</code></li><li>binary <code>~</code></li><li><code>|</code></li><li><code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>==</code>, and <code>~=</code></li><li><code>and</code></li><li><code>or</code></li></ul><p>Parentheses can be used to change the evaluation order of parts of a long expression. For example, <code>(a + b) / (c - d)</code> is evaluated differently than <code>a + b / c - d</code>.</p><p>All operators are left associative except for <code>^</code> and <code>..</code> which are right associative. For example, <code>2 ^ 2 ^ 3</code> is the same as <code>2 ^ 8</code> and not <code>4 ^ 3</code>.</p><p>All operators and special characters in Lua have a single meaning. For example:</p><ul><li><code>+</code> always performs addition, not string concatenation which uses <code>..</code></li><li><code>{' and</code>}' always construct a table and do not delimit a code block</li><li><code>:</code> always define or calls a function that can be used in the &quot;method&quot; style</li></ul><h2 id="conditional-logic" tabindex="-1">Conditional Logic</h2><p>Lua supports an <code>if</code> statement, but not a <code>switch</code> statement.</p><p>In an <code>if</code> statement, the <code>elseif</code> and <code>else</code> blocks shown below are optional.</p><p>Parentheses are not required around conditions.</p><p>All the parts of the <code>if</code> statement can be written on a single line if desired.</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">if</span> condition <span class="token keyword">then</span><br>  <span class="token punctuation">...</span><br><span class="token keyword">elseif</span> condition <span class="token keyword">then</span><br>  <span class="token punctuation">...</span><br><span class="token keyword">else</span><br>  <span class="token punctuation">...</span><br><span class="token keyword">end</span></code></pre><p>Lua does not have a ternary operator, but the same functionality can be achieved with the following:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> result <span class="token operator">=</span> condition <span class="token keyword">and</span> trueValue <span class="token keyword">or</span> falseValue</code></pre><p>For the condition, recall that <code>false</code> and <code>nil</code> are treated as <code>false</code> and all other values are treated as <code>true</code>.</p><h2 id="iteration" tabindex="-1">Iteration</h2><p>Lua supports <code>for</code>, <code>while</code> (top tested), and <code>repeat</code> (bottom tested) loops. The <code>for</code> loop has two variations, one that iterates over a range of numbers and one that iterates over table entries.</p><pre class="language-lua"><code class="language-lua"><span class="token comment">-- Use a `for` loop to iterate over a range of numbers</span><br>   with a given step size<span class="token punctuation">.</span><br><span class="token comment">-- The loop variable, `i` in this case, is local to the loop</span><br><span class="token comment">-- and cannot be accessed outside it.</span><br><span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token keyword">do</span><br>  <span class="token punctuation">...</span><br><span class="token keyword">end</span><br><br><span class="token comment">-- Use a `for` loop to iterate over the key/value pairs in a table.</span><br><span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>mytable<span class="token punctuation">)</span> <span class="token keyword">do</span><br>  <span class="token punctuation">...</span><br><span class="token keyword">end</span><br><br><span class="token comment">-- Use a `for` loop to iterate over the index/value pairs</span><br><span class="token comment">-- in a table whose keys are consecutive integers starting at 1.</span><br><span class="token keyword">for</span> index<span class="token punctuation">,</span> value <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>mytable<span class="token punctuation">)</span> <span class="token keyword">do</span><br>  <span class="token punctuation">...</span><br><span class="token keyword">end</span><br><br><span class="token comment">-- Use a `while` loop for a top-tested loop</span><br><span class="token comment">-- that stops when a given condition is no longer true.</span><br><span class="token keyword">while</span> condition <span class="token keyword">do</span><br>  <span class="token punctuation">...</span><br><span class="token keyword">end</span><br><br><span class="token comment">-- Use a `repeat`/`until` loop for a bottom-tested loop</span><br><span class="token comment">-- that stops when a given condition becomes true.</span><br><span class="token comment">-- The body is guaranteed to run at least once.</span><br><span class="token keyword">repeat</span> — bottom<span class="token operator">-</span>tested<br>  <span class="token punctuation">...</span><br><span class="token keyword">until</span> condition</code></pre><p>Loops can use the <code>break</code> keyword to exit early. The <code>continue</code> keyword for advancing to the next iteration is not currently supported.</p><h2 id="iterators" tabindex="-1">Iterators</h2><p>The <code>pairs</code> and <code>ipairs</code> functions that are used to iterate over tables return three values needed by a <code>for</code> loop. Understanding the purpose of these three values isn't necessary unless there is a reason to implement custom iterators.</p><p>The following code exposes the three values returned by the <code>pairs</code> function and provides insights on how a custom iterator might be implemented. A <code>for</code> loop that uses the <code>pairs</code> function could be replaced by code like the following:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> t <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">}</span><br><br><span class="token keyword">local</span> iterator<span class="token punctuation">,</span> state<span class="token punctuation">,</span> control <span class="token operator">=</span> <span class="token function">pairs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><br><span class="token comment">-- `iterator` is a function that can be called</span><br><span class="token comment">-- to get the next control and value.</span><br><span class="token comment">-- `state` returned by pairs is just a reference to `t`.</span><br><span class="token comment">-- `control` returned by `pairs` is `nil`.</span><br><br><span class="token keyword">while</span> <span class="token keyword">true</span> <span class="token keyword">do</span><br>  <span class="token comment">-- Get the next control (table key) and its value.</span><br>  control<span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token function">iterator</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> control<span class="token punctuation">)</span><br>  <span class="token keyword">if</span> <span class="token keyword">not</span> control <span class="token keyword">then</span> <span class="token keyword">break</span> <span class="token keyword">end</span> <span class="token comment">-- reached end</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>control<span class="token punctuation">,</span> value<span class="token punctuation">)</span><br><span class="token keyword">end</span></code></pre><p>The output of the code above is:</p><pre class="language-lua"><code class="language-lua"><span class="token number">1</span>       a<br><span class="token number">2</span>       b<br><span class="token number">3</span>       c</code></pre><p>The following custom function can be used to iterate over only the odd numbers in an array-like table. Note how it returns an iterator function, a state, and a control value.</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">odds</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><br>  <span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">iterator</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> control<span class="token punctuation">)</span><br>    control <span class="token operator">=</span> control <span class="token keyword">or</span> <span class="token number">0</span><br>    <span class="token keyword">repeat</span><br>      control <span class="token operator">=</span> control <span class="token operator">+</span> <span class="token number">1</span><br>      value <span class="token operator">=</span> t<span class="token punctuation">[</span>control<span class="token punctuation">]</span><br>    <span class="token keyword">until</span> control <span class="token operator">==</span> <span class="token keyword">nil</span> <span class="token keyword">or</span> <span class="token punctuation">(</span>value <span class="token operator">~=</span> <span class="token keyword">nil</span> <span class="token keyword">and</span> value <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><br>    <span class="token keyword">return</span> control<span class="token punctuation">,</span> value<br>  <span class="token keyword">end</span><br>  <span class="token keyword">return</span> iterator<span class="token punctuation">,</span> state<span class="token punctuation">,</span> <span class="token keyword">nil</span><br><span class="token keyword">end</span><br><br><span class="token keyword">local</span> t <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">}</span><br><span class="token keyword">for</span> i<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">odds</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">do</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token comment">-- 3, 7, and 13</span><br><span class="token keyword">end</span></code></pre><p>Other custom implementations could build and return a state based on the table passed in and could start with a control value other than <code>nil</code>.</p><h2 id="functions" tabindex="-1">Functions</h2><p>Functions are defined with the <code>function</code> keyword. This is longest keyword in Lua. It's too bad the designers didn't choose a shorter keyword like <code>func</code>, <code>fun</code>, or <code>fn</code>.</p><p>Parameters are specified in parentheses after the function name and are separated by commas. The parentheses are required even if there are no parameters.</p><p>The <code>return</code> keyword is used to exit a function and return zero or more values to the caller.</p><p>For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><br>  <span class="token keyword">return</span> n1 <span class="token operator">+</span> n2<br><span class="token keyword">end</span><br><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 5</span></code></pre><p>All functions are anonymous. The function definition above is just syntactic sugar for the following:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> add <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><br>  <span class="token keyword">return</span> n1 <span class="token operator">+</span> n2<br><span class="token keyword">end</span></code></pre><p>All functions are closures. This means they capture in-scope variables and can use them later when called.</p><p>When a function call passes a single literal string or literal table, the parentheses can be omitted. For example, the following are equivalent ways to pass a literal string to a function:</p><pre class="language-lua"><code class="language-lua"><span class="token function">takeString</span><span class="token punctuation">(</span><span class="token string">"some text"</span><span class="token punctuation">)</span><br>takeString <span class="token string">"some text"</span><br>takeString <span class="token string">[[some text]]</span></code></pre><p>Likewise, the following are equivalent ways to pass a table to a function.</p><pre class="language-lua"><code class="language-lua"><span class="token function">takeTable</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token function">takeTable</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span></code></pre><p>To avoid writing functions that take a large number of arguments, use a parameter that expects a table. This simulates having named arguments and allows values to be specified in any order. Table entries with no key (array-like) can be thought of as positional parameters and table entries with a key can be thought of as named parameters.</p><p>Primitive arguments are passed by value and tables are passed by reference. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> n<span class="token punctuation">,</span> s<span class="token punctuation">,</span> t<span class="token punctuation">)</span><br>  b <span class="token operator">=</span> <span class="token keyword">true</span><br>  n <span class="token operator">=</span> <span class="token number">2</span><br>  s <span class="token operator">=</span> <span class="token string">"yes"</span><br>  t<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">2</span><br><span class="token keyword">end</span><br><br>b <span class="token operator">=</span> <span class="token keyword">false</span><br>n <span class="token operator">=</span> <span class="token number">1</span><br>s <span class="token operator">=</span> <span class="token string">"no"</span><br>t <span class="token operator">=</span> <span class="token punctuation">{</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">}</span><br><span class="token function">foo</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> n<span class="token punctuation">,</span> s<span class="token punctuation">,</span> t<span class="token punctuation">)</span> <span class="token comment">-- only t.x is modified in this scope</span><br><span class="token function">print</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> n<span class="token punctuation">,</span> s<span class="token punctuation">,</span> t<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token comment">-- false 1 no 2</span></code></pre><p>Functions in Lua are first-class. This means they can accept other functions as arguments and they can return other functions. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">pow</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span> <span class="token keyword">return</span> n1 <span class="token operator">^</span> n2 <span class="token keyword">end</span><br><br><span class="token comment">-- This function accepts another function as an argument.</span><br><span class="token keyword">function</span> <span class="token function">combine</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> operation<span class="token punctuation">)</span><br>  <span class="token keyword">return</span> <span class="token function">operation</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">combine</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> pow<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 8.0</span><br><br><span class="token comment">-- This function returns another function.</span><br><span class="token keyword">function</span> <span class="token function">makeGreetFn</span><span class="token punctuation">(</span>greeting<span class="token punctuation">)</span><br>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span><br>    <span class="token function">print</span><span class="token punctuation">(</span>greeting <span class="token operator">..</span> <span class="token string">" "</span> <span class="token operator">..</span> name <span class="token operator">..</span> <span class="token string">"!"</span><span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br><span class="token keyword">end</span><br><br><span class="token keyword">local</span> greet <span class="token operator">=</span> <span class="token function">makeGreetFn</span><span class="token punctuation">(</span><span class="token string">"Hola"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token function">greet</span><span class="token punctuation">(</span><span class="token string">"Mark"</span><span class="token punctuation">)</span> <span class="token comment">-- Hola Mark!</span></code></pre><p>Functions can return multiple values. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">getStooges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token keyword">return</span> <span class="token string">"Moe"</span><span class="token punctuation">,</span> <span class="token string">"Larry"</span><span class="token punctuation">,</span> <span class="token string">"Curly"</span><br><span class="token keyword">end</span><br><br>s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> s3 <span class="token operator">=</span> <span class="token function">getStooges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> s3<span class="token punctuation">)</span> <span class="token comment">-- Moe Larry Curly</span></code></pre><p>An underscore can be used as a placeholder for unneeded return values. For example:</p><pre class="language-lua"><code class="language-lua">_<span class="token punctuation">,</span> s2 <span class="token operator">=</span> <span class="token function">getStooges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span> <span class="token comment">-- Larry</span><br><br>_<span class="token punctuation">,</span> _<span class="token punctuation">,</span> s3 <span class="token operator">=</span> <span class="token function">getStooges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>s3<span class="token punctuation">)</span> <span class="token comment">-- Curly</span></code></pre><p>When getting multiple return values from a function, underscores can be used as a placeholder for unneeded values. For example, when calling the <code>ipairs</code> function, if the index isn't needed then it can be used as follows:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">for</span> _<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">do</span><br>  <span class="token punctuation">...</span><br><span class="token keyword">end</span></code></pre><p>Functions can take a variable number of arguments. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">...</span><span class="token punctuation">)</span><br>  <span class="token keyword">local</span> sum <span class="token operator">=</span> <span class="token number">0</span><br>  <span class="token keyword">local</span> args <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token punctuation">}</span> <span class="token comment">-- creates a table containing the arguments</span><br>  <span class="token keyword">for</span> _<span class="token punctuation">,</span> n <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token keyword">do</span><br>    sum <span class="token operator">=</span> sum <span class="token operator">+</span> n<br>  <span class="token keyword">end</span><br>  <span class="token keyword">return</span> sum<br><span class="token keyword">end</span><br><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 6</span><br><br><span class="token keyword">function</span> <span class="token function">report</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span><br>  <span class="token keyword">local</span> count <span class="token operator">=</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token string">"#"</span><span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">)</span><br>  <span class="token keyword">local</span> text <span class="token operator">=</span> <span class="token string">"%s is %d years old and likes %d things.\nThey are"</span><br>  <span class="token keyword">local</span> s <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> count<span class="token punctuation">)</span><br>  <span class="token keyword">local</span> things <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token punctuation">}</span><br>  <span class="token keyword">for</span> index<span class="token punctuation">,</span> thing <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>things<span class="token punctuation">)</span> <span class="token keyword">do</span><br>    <span class="token keyword">local</span> prefix <span class="token operator">=</span> <span class="token string">" "</span><br>    <span class="token keyword">if</span> index <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">then</span><br>      prefix <span class="token operator">=</span> <span class="token string">" "</span><br>    <span class="token keyword">elseif</span> index <span class="token operator">></span> <span class="token number">1</span> <span class="token keyword">and</span> index <span class="token operator">&lt;</span> count <span class="token keyword">then</span><br>      prefix <span class="token operator">=</span> <span class="token string">", "</span><br>    <span class="token keyword">else</span><br>      prefix <span class="token operator">=</span> <span class="token string">", and "</span><br>    <span class="token keyword">end</span><br>    s <span class="token operator">=</span> s <span class="token operator">..</span> prefix <span class="token operator">..</span> thing<br>  <span class="token keyword">end</span><br>  <span class="token keyword">return</span> s <span class="token operator">..</span> <span class="token string">"."</span><br><span class="token keyword">end</span><br><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">report</span><span class="token punctuation">(</span><span class="token string">"Mark"</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token string">"running"</span><span class="token punctuation">,</span> <span class="token string">"biking"</span><span class="token punctuation">,</span> <span class="token string">"programming"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token comment">-- Mark is 62 years old and likes 3 things.</span><br><span class="token comment">-- They are running, biking, and programming.</span></code></pre><h2 id="default-parameter-values" tabindex="-1">Default Parameter Values</h2><p>Lua does not provide an explicit way to define default values for function parameters. There are approaches two implement this.</p><p>The first approach assigns default values using the <code>or</code> operator. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">greet</span><span class="token punctuation">(</span>greeting<span class="token punctuation">,</span> name<span class="token punctuation">)</span><br>  greeting <span class="token operator">=</span> greeting <span class="token keyword">or</span> <span class="token string">"Hello"</span><br>  name <span class="token operator">=</span> name <span class="token keyword">or</span> <span class="token string">"World"</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s, %s!"</span><span class="token punctuation">,</span> greeting<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br><span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- Hello, World!</span><br><span class="token function">greet</span><span class="token punctuation">(</span><span class="token string">"Hola"</span><span class="token punctuation">,</span> <span class="token string">"Mark"</span><span class="token punctuation">)</span> <span class="token comment">-- Hola, Mark!</span><br><br><span class="token keyword">function</span> <span class="token function">volume</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><br>  <span class="token keyword">local</span> w <span class="token operator">=</span> t<span class="token punctuation">.</span>width <span class="token keyword">or</span> <span class="token number">1</span><br>  <span class="token keyword">local</span> h <span class="token operator">=</span> t<span class="token punctuation">.</span>height <span class="token keyword">or</span> <span class="token number">1</span><br>  <span class="token keyword">local</span> d <span class="token operator">=</span> t<span class="token punctuation">.</span>depth <span class="token keyword">or</span> <span class="token number">1</span><br>  <span class="token keyword">return</span> w <span class="token operator">*</span> h <span class="token operator">*</span> d<br><span class="token keyword">end</span><br><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">volume</span><span class="token punctuation">(</span><span class="token punctuation">{</span>width<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> depth<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 24</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">volume</span><span class="token punctuation">(</span><span class="token punctuation">{</span>width<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 6</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">volume</span><span class="token punctuation">(</span><span class="token punctuation">{</span>width<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> depth<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 8</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">volume</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 1</span></code></pre><p>The <code>volume</code> function can also be implemented as follows:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">volume</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><br>  <span class="token keyword">return</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>width <span class="token keyword">or</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>height <span class="token keyword">or</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>depth <span class="token keyword">or</span> <span class="token number">1</span><span class="token punctuation">)</span><br><span class="token keyword">end</span></code></pre><p>The second approach is to accept a table argument and specify default values in that table using the <code>setmetatable</code> function. Metatables are discussed in more detail later. Basically they can provide an alternate place to look when a given key is not found in a table. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">volume</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><br>  <span class="token comment">-- This supplies default values for missing keys in the table t.</span><br>  <span class="token function">setmetatable</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token punctuation">{</span>__index<span class="token operator">=</span><span class="token punctuation">{</span>width<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> depth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token keyword">return</span> t<span class="token punctuation">.</span>width <span class="token operator">*</span> t<span class="token punctuation">.</span>height <span class="token operator">*</span> t<span class="token punctuation">.</span>depth<br><span class="token keyword">end</span></code></pre><h2 id="tables" tabindex="-1">Tables</h2><p>Lua only provides one data structure called a &quot;table&quot; which is an associative array. It is used to represent arrays, dictionaries, trees, and graphs.</p><p>A single table can be array-like, dictionary-like, or both.</p><p>Assigning a table to a variable assigns the reference, not a copy of the table.</p><p><em>Implementation Detail from <a href="https://www.lua.org/gems/?v=1.0.20" rel="noopener" target="_blank">Lua Programming Gems</a></em></p><blockquote><p>&quot;Every table in Lua has two parts: the array part and the hash part. The array part stores entries with integer keys in the range 1 to n, for some particular n. All other entries (including integer keys outside that range) go to the hash part.&quot;</p></blockquote><p>To create a table that is array-like, provide a comma-separated values inside curly braces. Curly braces are only used to construct tables. They are not used to delimit blocks of code.</p><p>For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> scores <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">}</span><br><br><span class="token keyword">local</span> names <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"Mark"</span><span class="token punctuation">,</span> <span class="token string">"Tami"</span><span class="token punctuation">}</span></code></pre><p>To create a table that is dictionary-like, provide keys and values inside curly braces. Each key is followed by <code>=</code> and its value.</p><p>Keys can be any value except <code>nil</code>, including other tables. String keys only require quotes if they contain special characters such as spaces. Non-string keys and string keys in quotes must be enclosed in square brackets.</p><p>Values can be of any type, including other tables. String values must be enclosed in quotes.</p><p>For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> scores <span class="token operator">=</span> <span class="token punctuation">{</span>Mark<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> Tami<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"Unknown Player"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">}</span> <span class="token comment">-- uses string keys</span><br><br><span class="token keyword">local</span> words <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token keyword">true</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"yes"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token keyword">false</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"no"</span><span class="token punctuation">}</span> <span class="token comment">-- uses boolean keys</span><br><br><span class="token keyword">local</span> months <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"January"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"February"</span><span class="token punctuation">}</span> <span class="token comment">-- uses integer keys</span><br><br><span class="token comment">-- This has the same result as the previous line,</span><br><span class="token comment">-- but values are specified without keys.</span><br><span class="token comment">-- Integer keys are provided starting from 1.</span><br><span class="token keyword">local</span> months <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"January"</span><span class="token punctuation">,</span> <span class="token string">"February"</span><span class="token punctuation">}</span></code></pre><p>To create a table that is both array-like and dictionary-like, provide some values with keys and some values without. Each value without a key is assigned a consecutive index key starting from 1. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> mixed <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"apple"</span><span class="token punctuation">,</span> month<span class="token operator">=</span><span class="token string">"April"</span><span class="token punctuation">,</span> <span class="token string">"banana"</span><span class="token punctuation">,</span> season<span class="token operator">=</span><span class="token string">"Spring"</span><span class="token punctuation">,</span> <span class="token string">"cherry"</span> <span class="token punctuation">}</span><br><span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>mixed<span class="token punctuation">)</span> <span class="token keyword">do</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><br><span class="token keyword">end</span><br><span class="token comment">-- Output is:</span><br><span class="token comment">-- 1	apple</span><br><span class="token comment">-- 2	banana</span><br><span class="token comment">-- 3	cherry</span><br><span class="token comment">-- month	April</span><br><span class="token comment">-- season	Spring</span></code></pre><p>There are two ways to assign a key/value pair to a table. The square bracket syntax works with any key value. The dot syntax works with keys that are value variable names. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> point <span class="token operator">=</span> <span class="token punctuation">{</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">}</span><br>point<span class="token punctuation">[</span><span class="token string">"x"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><br>point<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">-- same as previous line</span></code></pre><p>An empty table can be created and filled later. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> later <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">-- creates an empty table</span><br>later<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Hello"</span><br>later<span class="token punctuation">[</span><span class="token string">"condition"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"sunny"</span><br>later<span class="token punctuation">.</span>condition <span class="token operator">=</span> <span class="token string">"sunny"</span> <span class="token comment">-- same</span></code></pre><p>To get the corresponding value of a table key, use the square bracket or dot syntax. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token function">print</span><span class="token punctuation">(</span>scores<span class="token punctuation">.</span>Tami<span class="token punctuation">)</span> <span class="token comment">-- 7</span><br><span class="token function">print</span><span class="token punctuation">(</span>scores<span class="token punctuation">[</span><span class="token string">"Tami"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">-- 7</span><br><br><span class="token comment">-- When a key is not found, the value returned is `nil`.</span><br><span class="token comment">-- The `or` operator can be used to provide a default value.</span><br><span class="token function">print</span><span class="token punctuation">(</span>scores<span class="token punctuation">[</span><span class="token string">"Mary"</span><span class="token punctuation">]</span> <span class="token keyword">or</span> <span class="token string">"unknown"</span><span class="token punctuation">)</span> <span class="token comment">-- unknown</span><br><br><span class="token function">print</span><span class="token punctuation">(</span>months<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">-- February</span></code></pre><p>To iterate over keys and values, use a <code>for</code> loop with the <code>pairs</code> or <code>ipairs</code> function.</p><p>The <code>pairs</code> function visits all the key/value pairs, but not necessarily in the order in which they were added to the table. Entries where the value is set to <code>nil</code> are not visited.</p><p>The <code>ipairs</code> function iterates over array-like entries, only visiting consecutive integer keys starting with <code>1</code>. It stops as soon as it fails to find the next integer key.</p><p>The code below demonstrates these functions and also shows that a table can be both array-like AND dictionary-like.</p><pre class="language-lua"><code class="language-lua"><span class="token comment">-- The entries `5` and `3` are array-like.</span><br><span class="token comment">-- `5` is assigned the key `1` because it is the first array-like entry.</span><br><span class="token comment">-- `3` is assigned the key `2` because it is the second array-like entry.</span><br><span class="token comment">-- The entries `foo=2` and `bar=4` are dictionary-like.</span><br><span class="token keyword">local</span> t <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span> foo<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> bar<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">}</span><br><br><span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token comment">-- keys and values</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><br><span class="token keyword">end</span><br><span class="token comment">-- 1       5</span><br><span class="token comment">-- 2       3</span><br><span class="token comment">-- bar     4</span><br><span class="token comment">-- foo     2</span><br><br><span class="token keyword">for</span> i<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token comment">-- indexes and values</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> v<span class="token punctuation">)</span><br><span class="token keyword">end</span><br><span class="token comment">-- 1       5</span><br><span class="token comment">-- 2       3</span></code></pre><p>The <code>table.insert</code> function inserts an array-like entry. The array-like entries past the insertion point move up by one. This can be expensive if a large number of entries need to be moved. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> names <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"Mark"</span><span class="token punctuation">,</span> <span class="token string">"Tami"</span><span class="token punctuation">}</span><br>table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"Comet"</span><span class="token punctuation">)</span> <span class="token comment">-- Mark Comet Tami</span><br>table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token string">"Bob"</span><span class="token punctuation">)</span> <span class="token comment">-- pushes onto end; Mark Comet Tami Bob</span></code></pre><p>The <code>table.remove</code> function removes an array-like entry. The array-like entries past the removal point move down by one. This can be expensive if a large number of entries need to be moved. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> names <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"Mark"</span><span class="token punctuation">,</span> <span class="token string">"Comet"</span><span class="token punctuation">,</span> <span class="token string">"Tami"</span><span class="token punctuation">,</span> <span class="token string">"Bob"</span><span class="token punctuation">}</span><br>table<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">-- changes to Mark Tami Bob and returns Comet</span><br><span class="token comment">-- Omitting the index pops the last entry.</span><br>table<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>names<span class="token punctuation">)</span> <span class="token comment">-- changes to Mark Tami and returns Bob</span></code></pre><p>To remove a dictionary-like entry, set its value to <code>nil</code>. For example:</p><pre class="language-lua"><code class="language-lua">scores<span class="token punctuation">[</span><span class="token string">"Mark"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">nil</span></code></pre><p>The <code>table.concat</code> function returns a string created by concatenating all of its array-like values using a given delimiter. This only includes values for consecutive integer keys starting from one. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> t <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"Mark"</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">"Tami"</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">}</span><br><span class="token function">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">" and "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- "Mark and 7 and Tami and 9"</span><br><span class="token keyword">local</span> t <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span> foo<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> bar<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">}</span><br><span class="token function">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">" and "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 5 and 3; dictonary-like entries ignored</span></code></pre><p>The <code>table.sort</code> function sorts an array-like table in place. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> names <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"Tami"</span><span class="token punctuation">,</span> <span class="token string">"Mark"</span><span class="token punctuation">,</span> <span class="token string">"Amanda"</span><span class="token punctuation">,</span> <span class="token string">"Jeremy"</span><span class="token punctuation">}</span><br><br><span class="token comment">-- When no comparator function is specified,</span><br><span class="token comment">-- the values are compared using the `&lt;` operator.</span><br>table<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>names<span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token string">", "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- Amanda, Jeremy, Mark, Tami</span><br><br><span class="token comment">-- This specifies a comparator function.</span><br><span class="token comment">-- Values with the same length are sorted using the `&lt;` operator.</span><br><span class="token comment">-- When values lengths differ, shorter lengths come first.</span><br>table<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><br>  <span class="token keyword">if</span> <span class="token operator">#</span>a <span class="token operator">==</span> <span class="token operator">#</span>b <span class="token keyword">then</span><br>    <span class="token keyword">return</span> a <span class="token operator">&lt;</span> b<br>  <span class="token keyword">else</span><br>    <span class="token keyword">return</span> <span class="token operator">#</span>a <span class="token operator">&lt;</span> <span class="token operator">#</span>b<br>  <span class="token keyword">end</span><br><span class="token keyword">end</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token string">", "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- Mark, Tami, Amanda, Jeremy</span></code></pre><p>To get the length of an array-like table, use <code>#my_table</code>. The returns the highest consecutive integer index starting from <code>1</code>.</p><p>Dictionary-like tables do not store their number of entries. To get the count, it is necessary to iterate over the table and count them. The &quot;Lua Functional&quot; library described later defines a <code>length</code> function for computing the size of a table, but it has O(n) complexity.</p><p>The <code>table.pack</code> function provides another way to create an array-like table that adds the key <code>n</code> which holds the number of entries. The value of the <code>n</code> is not updated when entries are inserted or removed. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> t <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">pack</span><span class="token punctuation">(</span><span class="token string">"Mark"</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">"Tami"</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>n<span class="token punctuation">)</span> <span class="token comment">-- 4</span></code></pre><p>The <code>table.unpack</code> function returns consecutive array-like entries with keys starting from <code>1</code>. It does not work with dictionary-like tables. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> names <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"Mark"</span><span class="token punctuation">,</span> <span class="token string">"Tami"</span><span class="token punctuation">,</span> <span class="token string">"Comet"</span><span class="token punctuation">}</span><br><span class="token keyword">local</span> father<span class="token punctuation">,</span> mother<span class="token punctuation">,</span> dog <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">unpack</span><span class="token punctuation">(</span>names<span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>father<span class="token punctuation">,</span> mother<span class="token punctuation">,</span> dog<span class="token punctuation">)</span> <span class="token comment">-- Mark    Tami    Comet</span><br><span class="token function">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">unpack</span><span class="token punctuation">(</span>names<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- same</span></code></pre><p>Table values can be other tables. This supports creating the equivalent of multi-dimensional arrays. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> my2d <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br>my2d<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br>my2D<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"some-value"</span><br><span class="token function">print</span><span class="token punctuation">(</span>my2D<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">-- some-value</span><br><br><span class="token keyword">local</span> points <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>x<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><span class="token function">print</span><span class="token punctuation">(</span>points<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token comment">-- 5</span></code></pre><p>The <code>table.move</code> function copies entries from one array-like table to another. It does not remove entries from the source table. Existing destination table entries at target indexes are replaced.</p><p>For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">dump</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><br>  <span class="token keyword">for</span> _<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">do</span><br>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"  "</span> <span class="token operator">..</span> v<span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br><span class="token keyword">end</span><br><br><span class="token keyword">local</span> t1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><br><span class="token keyword">local</span> t2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">}</span><br><span class="token comment">-- Copy table t1 elements 1 to 3 into table t2 starting at index 3.</span><br><span class="token comment">-- The arguments are source table, start index, end index,</span><br><span class="token comment">-- destination index, and destination table.</span><br>table<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> t2<span class="token punctuation">)</span><br><span class="token function">dump</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span> <span class="token comment">-- 1 2 3</span><br><span class="token function">dump</span><span class="token punctuation">(</span>t2<span class="token punctuation">)</span> <span class="token comment">-- 4 5 1 2 3; existing value 6 was replaced with 1</span></code></pre><h2 id="modules" tabindex="-1">Modules</h2><p>A module is defined by a table whose entries are variables and functions. Typically each module is defined in its own source file and made available in other source files using the <code>require</code> function.</p><p>To define a module named <code>my_module</code>, create a file named <code>my_module.lua</code> containing code like the following:</p><pre class="language-lua"><code class="language-lua"><span class="token comment">-- It is a convention to name this "M".</span><br><span class="token keyword">local</span> M <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">-- a table</span><br><br>M<span class="token punctuation">.</span>some_variable <span class="token operator">=</span> <span class="token string">"some value"</span><br><br><span class="token comment">-- Function names containing a dot cannot be declared `local`.</span><br><span class="token keyword">function</span> M<span class="token punctuation">.</span><span class="token function">some_function</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span><br>  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"some_function was passed "</span> <span class="token operator">..</span> p1 <span class="token operator">..</span> <span class="token string">" and "</span> <span class="token operator">..</span> p2<span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br><span class="token keyword">return</span> M</code></pre><p>The following code shows an equivalent way to write the code above:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">return</span> <span class="token punctuation">{</span><br>  some_variable <span class="token operator">=</span> <span class="token string">"some value"</span><span class="token punctuation">,</span><br>  some_function <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span><br>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"some_function was passed "</span> <span class="token operator">..</span> p1 <span class="token operator">..</span> <span class="token string">" and "</span> <span class="token operator">..</span> p2<span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br><span class="token punctuation">}</span></code></pre><p>The following code demonstrates using the module defined above. Note that the string passed to the <code>require</code> function does not include the <code>.lua</code> file extension.</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> mm <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"my_module"</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>mm<span class="token punctuation">.</span>some_variable<span class="token punctuation">)</span> <span class="token comment">-- some value</span><br>mm<span class="token punctuation">.</span><span class="token function">some_function</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">-- some_function was passed 1 and 2</span></code></pre><p>A Lua &quot;package&quot; is a collection of modules.</p><h2 id="metatables" tabindex="-1">Metatables</h2><p>A metatable is a table that defines metamethods. All metamethods have names that begin with two underscores. Examples include:</p><ul><li><code>__add</code> - defines how the <code>+</code> operator adds values represented by specific kinds of tables</li><li><code>__tostring</code> - defines the string representation of a value</li><li><code>__index</code> - determines the value that should be returned when an attempt is made to access a missing key</li></ul><p>The <code>getmetatable(table)</code> function returns the metatable associated with a given value or <code>nil</code> if one has not been assigned.</p><p>Any value can have a metatable. Of the eight types defined by Lua, only instances of the <code>string</code> type have a metatable by default. The following code demonstrates this:</p><pre class="language-lua"><code class="language-lua"><span class="token function">assert</span><span class="token punctuation">(</span><span class="token function">getmetatable</span><span class="token punctuation">(</span><span class="token keyword">nil</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">nil</span><span class="token punctuation">)</span> <span class="token comment">-- nil type</span><br><span class="token function">assert</span><span class="token punctuation">(</span><span class="token function">getmetatable</span><span class="token punctuation">(</span><span class="token keyword">true</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">nil</span><span class="token punctuation">)</span> <span class="token comment">-- boolean type</span><br><span class="token function">assert</span><span class="token punctuation">(</span><span class="token function">getmetatable</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">nil</span><span class="token punctuation">)</span> <span class="token comment">-- number type</span><br><br><span class="token function">assert</span><span class="token punctuation">(</span><span class="token function">getmetatable</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span> <span class="token operator">~=</span> <span class="token keyword">nil</span><span class="token punctuation">)</span> <span class="token comment">-- string type</span><br><span class="token function">assert</span><span class="token punctuation">(</span><span class="token function">getmetatable</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__index <span class="token operator">==</span> string<span class="token punctuation">)</span><br><span class="token comment">-- This shows that the alternate place to look</span><br><span class="token comment">-- for string functions is the `string` module.</span><br><br><span class="token keyword">local</span> t <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br><span class="token function">assert</span><span class="token punctuation">(</span><span class="token function">getmetatable</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">nil</span><span class="token punctuation">)</span> <span class="token comment">-- table tuype</span><br><br><span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">end</span><br><span class="token function">assert</span><span class="token punctuation">(</span><span class="token function">getmetatable</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">nil</span><span class="token punctuation">)</span> <span class="token comment">-- function type</span><br><br><span class="token keyword">local</span> thread <span class="token operator">=</span> coroutine<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><br><span class="token function">assert</span><span class="token punctuation">(</span><span class="token function">getmetatable</span><span class="token punctuation">(</span>thread<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">nil</span><span class="token punctuation">)</span> <span class="token comment">-- thread type</span></code></pre><p>The colon operator provides syntactic sugar for an alternate way to call a function that is defined as a table entry. For example, the metatable of all <code>string</code> instances contains all the string functions. There are two ways to get the uppercase version of a string.</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> s <span class="token operator">=</span> <span class="token string">"test"</span><br><span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">upper</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- uses the dot operator and returns "TEST"</span><br><span class="token function">print</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span><span class="token function">upper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- uses the colon operator and returns "TEST"</span></code></pre><p>In the last call to <code>upper</code> above Lua attempts to find an <code>upper</code> function in the value of <code>s</code>. But <code>s</code> refers to a string rather than a table, so the <code>upper</code> function is not found there. Next Lua gets the metatable of <code>s</code> and looks for <code>upper</code> in the table that is the value of its <code>__index</code> entry. It finds <code>upper</code> defined there and calls it, passing it the value before the colon which is <code>s</code>.</p><p>The same approach does not work with table instances. Table instances do not have a metatable, much less one whose <code>__index</code> key is set to <code>table</code>. It is possible to configure this for a specific table instance. But doing so only adds the ability to use the colon operator with that specific table instance. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> t <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"apple"</span><span class="token punctuation">,</span> <span class="token string">"banana"</span><span class="token punctuation">,</span> <span class="token string">"cherry"</span><span class="token punctuation">}</span><br><span class="token function">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">" and "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- apple and banana and cherry</span><br><span class="token function">setmetatable</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token punctuation">{</span>__index <span class="token operator">=</span> table<span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">" and "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- apple and banana and cherry</span></code></pre><p>Another issue with this approach is that assigning keys in the table <code>t</code> that have the same name as a table function makes those functions inaccessible using the colon operator. For example:</p><pre class="language-lua"><code class="language-lua">t<span class="token punctuation">.</span>concat <span class="token operator">=</span> <span class="token string">"broken"</span><br><span class="token function">print</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">" and "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- attempt to call a string value (method 'concat')</span></code></pre><h3 id="table-delegation" tabindex="-1">Table Delegation</h3><p>Custom metatables can be added to tables, but not to any other Lua types. This is done with the <code>setmetatable(table, metatable)</code> function.</p><p>The <code>setmetatable</code> function returns its first argument which is useful for getting a reference when a table constructor is passed.</p><p>The <code>__index</code> entry can be implemented in two ways. It can be a table that supplies default values for missing properties or it can be a function that is passed a table and a key. Both approaches are shown below.</p><p>The same metatable can be assigned to multiple tables. Doing so allows them to share both functionality and data.</p><p>The simplest use of metatables is to associated one with a single table. The following code demonstrates this.</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> t <span class="token operator">=</span> <span class="token punctuation">{</span>alpha <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">}</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">getmetatable</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- nil; no metatable assigned yet</span><br><br><span class="token comment">-- Create a metatable containing one metamethod named `__index`.</span><br><span class="token comment">-- Its value is a table holding default key/value pairs.</span><br><span class="token keyword">local</span> my_metatable <span class="token operator">=</span> <span class="token punctuation">{</span>__index <span class="token operator">=</span> <span class="token punctuation">{</span>alpha <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> beta <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">}</span><br><br><span class="token comment">-- Associate the metatable with the table.</span><br><span class="token function">setmetatable</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> my_metatable<span class="token punctuation">)</span><br><br><span class="token function">print</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>alpha<span class="token punctuation">,</span> t<span class="token punctuation">.</span>beta<span class="token punctuation">,</span> t<span class="token punctuation">.</span>gamma<span class="token punctuation">)</span> <span class="token comment">-- 7 2 nil</span></code></pre><p>There is no need to hold the metatable in a variable. It can be assigned directly to the table as follows:</p><pre class="language-lua"><code class="language-lua"><span class="token function">setmetatable</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token punctuation">{</span>__index <span class="token operator">=</span> <span class="token punctuation">{</span>alpha <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> beta <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>Instead of defining a separate table for the metatable, we can make the table serve as its own metatable as follows:</p><pre class="language-lua"><code class="language-lua">t<span class="token punctuation">.</span>__index <span class="token operator">=</span> <span class="token punctuation">{</span>alpha <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> beta <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">}</span><br><span class="token function">setmetatable</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> t<span class="token punctuation">)</span></code></pre><p>The value of <code>__index</code> can be a function instead of a table. For example:</p><pre class="language-lua"><code class="language-lua">t<span class="token punctuation">.</span>__index <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>table<span class="token punctuation">,</span> key<span class="token punctuation">)</span><br>  <span class="token keyword">if</span> key <span class="token operator">==</span> <span class="token string">"beta"</span> <span class="token keyword">then</span> <span class="token keyword">return</span> <span class="token number">2</span> <span class="token keyword">end</span><br>  <span class="token keyword">return</span> <span class="token keyword">nil</span><br><span class="token keyword">end</span><br><span class="token function">setmetatable</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> t<span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>alpha<span class="token punctuation">,</span> t<span class="token punctuation">.</span>beta<span class="token punctuation">,</span> t<span class="token punctuation">.</span>gamma<span class="token punctuation">)</span> <span class="token comment">-- 7 2 nil</span></code></pre><p>All these variations produce the same results. You may encounter all of these approaches in code that others write, so it is necessary to understand all of them.</p><p>Adding a metatable to a single table instance is not nearly as useful as adding a metatable to all instances of a given kind of table when they are created. This is the topic of the next section.</p><h3 id="classes" tabindex="-1">Classes</h3><p>Lua does not directly support defining classes and creating instances. However, these can be simulated using a combination of tables, metatables, and functions.</p><p>A class can be represented by a table. A <code>new</code> function can be added to the table and used to create instances which are represented by new tables. There is nothing special about the name &quot;new&quot;, but many other programming languages use that name for creating instances of a class, so it's a good idea to stick with that convention.</p><p>The <code>new</code> function should:</p><ul><li>Create a new table to represent the instance OR use a table that is passed in.</li><li>Associate a metatable with the new table that holds default property values and functions that act as instance methods of the class.</li><li>Return the table that represents the instance.</li></ul><p>There are a few common approaches for implementing all of this.</p><p>Approach #1:</p><p>The metatable can be a separate table defined outside the <code>new</code> function in a variable.</p><pre class="language-lua"><code class="language-lua"><span class="token comment">-- Define a Shape class.</span><br>Shape <span class="token operator">=</span> <span class="token punctuation">{</span>name <span class="token operator">=</span> <span class="token string">"unknown"</span><span class="token punctuation">,</span> sides <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">}</span><br><span class="token keyword">local</span> metatable <span class="token operator">=</span> <span class="token punctuation">{</span>__index <span class="token operator">=</span> Shape<span class="token punctuation">}</span><br><br><span class="token comment">-- Constructor</span><br><span class="token keyword">function</span> Shape<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> sides<span class="token punctuation">)</span><br>  <span class="token keyword">local</span> instance <span class="token operator">=</span> <span class="token function">setmetatable</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> metatable<span class="token punctuation">)</span><br>  instance<span class="token punctuation">.</span>name <span class="token operator">=</span> name<br>  instance<span class="token punctuation">.</span>sides <span class="token operator">=</span> sides<br>  <span class="token keyword">return</span> instance<br><span class="token keyword">end</span><br><br><span class="token comment">-- Method - note the colon</span><br><span class="token keyword">function</span> Shape<span class="token punctuation">:</span><span class="token function">report</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s has %d sides"</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>sides<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br>my_shape <span class="token operator">=</span> Shape<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"triangle"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><br>my_shape<span class="token punctuation">:</span><span class="token function">report</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- triangle has 3 sides</span></code></pre><p>Approach #2:</p><p>The metatable can be a property of the class table.</p><p>This only requires the following minor changes to the code in Approach #1.</p><pre class="language-lua"><code class="language-lua"><span class="token comment">-- Replace the line starting with `local metatable` with this.</span><br>Shape<span class="token punctuation">.</span>metatable <span class="token operator">=</span> <span class="token punctuation">{</span>__index <span class="token operator">=</span> Shape<span class="token punctuation">}</span><br><br><span class="token comment">-- Replace the line starting with `local instance` with this.</span><br><span class="token keyword">local</span> instance <span class="token operator">=</span> <span class="token function">setmetatable</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> Shape<span class="token punctuation">.</span>metatable<span class="token punctuation">)</span></code></pre><p>Approach #3:</p><p>The metatable can be the class table itself. This approach requires defining the <code>new</code> function with a colon so it can access the class table using the <code>self</code> variable.</p><p>This only requires the following minor changes to the code in Approach #2.</p><pre class="language-lua"><code class="language-lua"><span class="token comment">-- Replace the line starting with `Shape.metatable =` with this.</span><br>Shape<span class="token punctuation">.</span>__index <span class="token operator">=</span> Shape<br><br><span class="token comment">-- Replace the line starting with `local instance` with this.</span><br><span class="token keyword">local</span> instance <span class="token operator">=</span> <span class="token function">setmetatable</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> Shape<span class="token punctuation">)</span></code></pre><p>The following code demonstrates defining and using a <code>Person</code> &quot;class&quot;.</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> mt <span class="token operator">=</span> <span class="token punctuation">{</span><br>  __index <span class="token operator">=</span> <span class="token punctuation">{</span><br>    <span class="token comment">-- Taking a "self" argument allows calling with the method syntax.</span><br>    <span class="token comment">-- There is no way to define a method with a colon inside a table.</span><br>    haveBirthday <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>self<span class="token punctuation">)</span><br>      self<span class="token punctuation">.</span>age <span class="token operator">=</span> self<span class="token punctuation">.</span>age <span class="token operator">+</span> <span class="token number">1</span><br>    <span class="token keyword">end</span><span class="token punctuation">,</span><br><br>    <span class="token comment">-- Taking a "self" argument allows calling with the method syntax.</span><br>    report <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>self<span class="token punctuation">)</span><br>      <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s is %d years old."</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token keyword">end</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">local</span> Person <span class="token operator">=</span> <span class="token punctuation">{</span><br>  new <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>p<span class="token punctuation">)</span><br>    p <span class="token operator">=</span> p <span class="token keyword">or</span> <span class="token punctuation">{</span>name <span class="token operator">=</span> <span class="token string">"unknown"</span><span class="token punctuation">,</span> age <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">}</span><br>    <span class="token function">setmetatable</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> mt<span class="token punctuation">)</span><br>    <span class="token keyword">return</span> p<br>  <span class="token keyword">end</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">local</span> me <span class="token operator">=</span> Person<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name <span class="token operator">=</span> <span class="token string">"Mark"</span><span class="token punctuation">,</span> age <span class="token operator">=</span> <span class="token number">61</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br>me<span class="token punctuation">:</span><span class="token function">haveBirthday</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>me<span class="token punctuation">:</span><span class="token function">report</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- Mark is 62 years old.</span></code></pre><p>The following code demonstrates defining a <code>Point</code> class and three ways to define a function that computes the distance from the origin to a point.</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> Point <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br><br><span class="token keyword">local</span> mt <span class="token operator">=</span> <span class="token punctuation">{</span><br>  __index <span class="token operator">=</span> <span class="token punctuation">{</span><br>    distance1 <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span><br>      <span class="token keyword">return</span> math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>point<span class="token punctuation">.</span>x <span class="token operator">^</span> <span class="token number">2</span> <span class="token operator">+</span> point<span class="token punctuation">.</span>y <span class="token operator">^</span> <span class="token number">2</span><span class="token punctuation">)</span><br>    <span class="token keyword">end</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> Point<span class="token punctuation">.</span><span class="token function">distance2</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span><br>  <span class="token keyword">return</span> math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>point<span class="token punctuation">.</span>x <span class="token operator">^</span> <span class="token number">2</span> <span class="token operator">+</span> point<span class="token punctuation">.</span>y <span class="token operator">^</span> <span class="token number">2</span><span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br><span class="token keyword">function</span> Point<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><br>  p <span class="token operator">=</span> p <span class="token keyword">or</span> <span class="token punctuation">{</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">}</span><br><br>  <span class="token keyword">function</span> p<span class="token punctuation">:</span><span class="token function">distance3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token keyword">return</span> math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>x <span class="token operator">^</span> <span class="token number">2</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>y <span class="token operator">^</span> <span class="token number">2</span><span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br><br>  <span class="token function">setmetatable</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> mt<span class="token punctuation">)</span><br>  <span class="token keyword">return</span> p<br><span class="token keyword">end</span><br><br><span class="token keyword">local</span> pt <span class="token operator">=</span> Point<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">{</span> x <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><br><br><span class="token comment">-- Call function defined on Point instance as a method.</span><br><span class="token comment">-- This is bad because a new function is attached to every instance.</span><br><span class="token function">print</span><span class="token punctuation">(</span>pt<span class="token punctuation">:</span><span class="token function">distance3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 5.0</span><br><br><span class="token comment">-- Call function defined in Point table as a function.</span><br><span class="token comment">-- This is the approach used by the `table` type for functions like `concat`,</span><br><span class="token comment">-- but it is not as concise as the last approach below.</span><br><span class="token function">print</span><span class="token punctuation">(</span>Point<span class="token punctuation">.</span><span class="token function">distance2</span><span class="token punctuation">(</span>pt<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 5.0</span><br><br><span class="token comment">-- Call function defined in metatable \_\_index as a function.</span><br><span class="token comment">-- This is not a nice as the previous call because `pt` must be repeated.</span><br><span class="token function">print</span><span class="token punctuation">(</span>pt<span class="token punctuation">.</span><span class="token function">distance1</span><span class="token punctuation">(</span>pt<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 5.0</span><br><br><span class="token comment">-- Call function defined in metatable \_\_index as a method.</span><br><span class="token comment">-- This is the preferred approach because only one copy of the function</span><br><span class="token comment">-- is defined (in the shared metatable) and calls to it are concise.</span><br><span class="token function">print</span><span class="token punctuation">(</span>pt<span class="token punctuation">:</span><span class="token function">distance1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 5.0</span></code></pre><h3 id="method-syntax" tabindex="-1">Method Syntax</h3><p>Tables can have entries where the key is a function name and the value is a function. While this can be done in any table, it makes the most sense to do this in tables that are the values the <code>__index</code> property in a metatable. The reason for this is that those functions can be shared by multiple other tables that use the metatable.</p><p>These functions can be referred to as &quot;methods&quot; because they are intended to be invoked on a specific table instance.</p><p>Methods can be defined inside or outside of a table constructor. There is one syntax for defining them inside a table constructor and two syntaxes for defining them outside.</p><p>The following code demonstrates all three approaches:</p><pre class="language-lua"><code class="language-lua"><span class="token comment">-- File point.lua</span><br><span class="token keyword">local</span> M <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br><br><span class="token keyword">local</span> mt <span class="token operator">=</span> <span class="token punctuation">{</span><br>  __index <span class="token operator">=</span> <span class="token punctuation">{</span><br>    distance1 <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>point<span class="token punctuation">)</span><br>      <span class="token keyword">return</span> math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>point<span class="token punctuation">.</span>x<span class="token operator">^</span><span class="token number">2</span> <span class="token operator">+</span> point<span class="token punctuation">.</span>y<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span><br>    <span class="token keyword">end</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> mt<span class="token punctuation">.</span><span class="token function">distance2</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span><br>  <span class="token keyword">return</span> math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>point<span class="token punctuation">.</span>x<span class="token operator">^</span><span class="token number">2</span> <span class="token operator">+</span> point<span class="token punctuation">.</span>y<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br><span class="token keyword">function</span> mt<span class="token punctuation">:</span><span class="token function">distance3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token keyword">return</span> math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token operator">^</span><span class="token number">2</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>y<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br><span class="token keyword">function</span> M<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><br>  p <span class="token operator">=</span> p <span class="token keyword">or</span> <span class="token punctuation">{</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">}</span><br>  <span class="token function">setmetatable</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> mt<span class="token punctuation">)</span><br>  <span class="token keyword">return</span> p<br><span class="token keyword">end</span><br><br><span class="token keyword">return</span> M</code></pre><p>The following code demonstrates using the module defined above:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> Point <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"point"</span><span class="token punctuation">)</span><br><br><span class="token keyword">local</span> p <span class="token operator">=</span> Point<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">{</span>x <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>Point<span class="token punctuation">.</span><span class="token function">distance1</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 5.0</span><br><span class="token function">print</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span><span class="token function">distance1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 5.0</span><br><span class="token function">print</span><span class="token punctuation">(</span>Point<span class="token punctuation">.</span><span class="token function">distance2</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 5.0</span><br><span class="token function">print</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span><span class="token function">distance2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 5.0</span><br><span class="token function">print</span><span class="token punctuation">(</span>Point<span class="token punctuation">.</span><span class="token function">distance3</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 5.0</span><br><span class="token function">print</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span><span class="token function">distance3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 5.0</span></code></pre><ul><li><code>MyTable.my_function(p1, p2)</code> referred to below as a &quot;dot function&quot;</li><li><code>MyTable:my_function(p1, p2)</code> referred to below as a &quot;colon function&quot;</li></ul><p>Dot functions are somewhat like object-oriented class methods and colon functions are somewhat like object-oriented instance methods. The only difference between these is that colon functions are supplied with a hidden first parameter named self whose value is the value on which the function was called.</p><p>Functions defined on table can be called using either a dot or a colon, regardless of whether the function was defined with a dot or a colon. The only difference between these is that calling a table function using a colon automatically passes the value on which it is called as the first argument, moving all the explicit arguments to the right.</p><p>Let's clear up the confusion with some examples.</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> point <span class="token operator">=</span> <span class="token punctuation">{</span> x <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">4</span> <span class="token punctuation">}</span><br><span class="token keyword">function</span> Point<span class="token punctuation">.</span><span class="token function">dot_distance</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><br>  <span class="token keyword">return</span> math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token operator">^</span><span class="token number">2</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>y<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span><br><span class="token keyword">end</span><br><span class="token keyword">function</span> Point<span class="token punctuation">:</span><span class="token function">colon_distance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token keyword">return</span> math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token operator">^</span><span class="token number">2</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>y<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span><br><span class="token keyword">end</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>Point <span class="token operator">=</span> <span class="token function">class</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token comment">-- Properties</span><br>  x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span><br>  y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span><br><br>  <span class="token comment">-- Methods</span><br>  distanceFromOrigin <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><br>    <span class="token keyword">return</span> math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>x <span class="token operator">^</span> <span class="token number">2</span> <span class="token operator">+</span> p<span class="token punctuation">.</span>y <span class="token operator">^</span> <span class="token number">2</span><span class="token punctuation">)</span><br>  <span class="token keyword">end</span><span class="token punctuation">,</span><br>  print <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>p<span class="token punctuation">)</span><br>    <span class="token function">print</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token comment">-- uses __tostring below</span><br>  <span class="token keyword">end</span><span class="token punctuation">,</span><br><br>  <span class="token comment">-- Metamethods</span><br>  __add <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span><br>    <span class="token keyword">return</span> Point<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">{</span>x <span class="token operator">=</span> p1<span class="token punctuation">.</span>x <span class="token operator">+</span> p2<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y <span class="token operator">=</span> p1<span class="token punctuation">.</span>y <span class="token operator">+</span> p2<span class="token punctuation">.</span>y<span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token keyword">end</span><span class="token punctuation">,</span><br>  __tostring <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>p<span class="token punctuation">)</span><br>    <span class="token keyword">return</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"(%.2f, %.2f)"</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p<span class="token punctuation">.</span>y<span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br><span class="token keyword">local</span> p1 <span class="token operator">=</span> Point<span class="token punctuation">.</span><span class="token function">new</span> <span class="token punctuation">{</span>x <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">}</span><br><span class="token function">print</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span> <span class="token comment">-- (3.00, 4.00)</span><br><span class="token function">print</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span><span class="token function">distanceFromOrigin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 5.0</span><br><br><span class="token keyword">local</span> p2 <span class="token operator">=</span> Point<span class="token punctuation">.</span><span class="token function">new</span> <span class="token punctuation">{</span>x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">}</span><br><span class="token keyword">local</span> p3 <span class="token operator">=</span> p1 <span class="token operator">+</span> p2 <span class="token comment">-- uses the __add metamethod</span><br><span class="token function">print</span><span class="token punctuation">(</span>p3<span class="token punctuation">)</span> <span class="token comment">-- (8.0, 5.0)</span><br><br><span class="token keyword">local</span> p4 <span class="token operator">=</span> Point<span class="token punctuation">.</span><span class="token function">new</span> <span class="token punctuation">{</span>y <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">}</span><br><span class="token function">print</span><span class="token punctuation">(</span>p4<span class="token punctuation">)</span> <span class="token comment">-- (0.00, 7.00)</span><br><br>MyType <span class="token operator">=</span> <span class="token punctuation">{</span><br>  operation <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span><br>    <span class="token function">print</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br><span class="token punctuation">}</span><br><br>MyTable<span class="token punctuation">.</span><span class="token function">dotInner</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">-- 1, 2</span><br><br><span class="token comment">-- This is an alternate way to write the dotInner function,</span><br><span class="token comment">-- defining it outside the table constructor.</span><br><span class="token keyword">function</span> MyTable<span class="token punctuation">.</span><span class="token function">dotOuter</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br>MyTable<span class="token punctuation">.</span><span class="token function">dotOuter</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">-- 1, 2</span><br><br><span class="token comment">-- Here dotOuter is called with a colon.</span><br><span class="token comment">-- Calling any function using a colon causes the variable</span><br><span class="token comment">-- before the colon to be passed as the first argument.</span><br><span class="token comment">-- This makes 1 the second argument and 2 the third.</span><br><span class="token comment">-- Dot function should never be called like this.</span><br>MyTable<span class="token punctuation">:</span><span class="token function">dotOuter</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">-- MyTable address, 1 (last argument 2 is ignored)</span><br><br><span class="token comment">-- Colon functions cannot be defined inside a table constructor.</span><br><span class="token comment">-- They have an invisible first parameter named `self`.</span><br><span class="token keyword">function</span> MyTable<span class="token punctuation">:</span><span class="token function">colonOuter</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br><span class="token comment">-- Here `colonOuter` is called without a colon,</span><br><span class="token comment">-- so MyTable is not passed as the first argument.</span><br><span class="token comment">-- Colon functions should never be called like this.</span><br>MyTable<span class="token punctuation">.</span><span class="token function">colonOuter</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">-- 1, 2, 3</span><br><br><span class="token comment">-- Here colonOuter is called with a colon,</span><br><span class="token comment">-- so MyTable is passed as the first argument.</span><br><span class="token comment">-- Colon functions should always be called like this.</span><br>MyTable<span class="token punctuation">:</span><span class="token function">colonOuter</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">-- MyTable address, 1, 2</span><br><br><span class="token comment">-- This is equivalent to the previous line.</span><br><span class="token comment">-- While this works, it is overly verbose.</span><br>MyTable<span class="token punctuation">.</span><span class="token function">colonOuter</span><span class="token punctuation">(</span>MyTable<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">-- MyTable address, 1, 2</span></code></pre><p>TODO: See my question about the colon syntax at <a href="https://www.reddit.com/r/lua/comments/12tc33n/colon_syntax/">https://www.reddit.com/r/lua/comments/12tc33n/colon_syntax/</a> TODO: The answer is provided in the example code below!</p><pre class="language-lua"><code class="language-lua">s <span class="token operator">=</span> <span class="token string">"test"</span><br><span class="token function">print</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span><span class="token function">upper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- TEST</span><br><span class="token comment">-- The previous line works because all string instances have a metatable</span><br><span class="token comment">-- with `__index` set to the table `string` that defines all the string functions.</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">getmetatable</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span>__index<span class="token punctuation">.</span>upper<span class="token punctuation">)</span><br><br><span class="token comment">-- Tables do not do the same thing.</span><br>t <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">}</span><br><span class="token function">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- a b c</span><br><span class="token comment">-- print(t:concat(" ")) -- attempt to call a nil value (method 'concat')</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">getmetatable</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- nil</span><br><br><span class="token comment">-- We can fix this for individual tables, not for all of them at once.</span><br><span class="token function">setmetatable</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token punctuation">{</span>__index <span class="token operator">=</span> table<span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- a b c</span></code></pre><h3 id="inheritance" tabindex="-1">Inheritance</h3><p>We can simulate class inheritance by setting the metatable of a class to its superclass. The following code demonstrates this.</p><p>The <code>Shape</code> class is a abstract class, meaning we cannot create instances from it. Its purpose is to serve as a base class for other classes that wish to inherit from it. The lack of a <code>new</code> function is what makes it abstract.</p><p>The <code>Triangle</code> and <code>Rectangle</code> classes both inherit from the <code>Shape</code> class. The <code>Square</code> class inherits from the <code>Rectangle</code> class.</p><pre class="language-lua"><code class="language-lua"><span class="token comment">-- Define a Shape class.</span><br>Shape <span class="token operator">=</span> <span class="token punctuation">{</span>name <span class="token operator">=</span> <span class="token string">"unknown"</span><span class="token punctuation">,</span> sides <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">}</span><br>Shape<span class="token punctuation">.</span>__index <span class="token operator">=</span> Shape<br><br><span class="token comment">-- Method</span><br><span class="token keyword">function</span> Shape<span class="token punctuation">:</span><span class="token function">report</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><br>    <span class="token string">"%s has %d sides and area %.1f."</span><span class="token punctuation">,</span><br>    self<span class="token punctuation">.</span>name<span class="token punctuation">,</span><br>    self<span class="token punctuation">.</span>sides<span class="token punctuation">,</span><br>    self<span class="token punctuation">:</span><span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br><span class="token comment">-- Define a Triangle class.</span><br>Triangle <span class="token operator">=</span> <span class="token punctuation">{</span>name <span class="token operator">=</span> <span class="token string">"triangle"</span><span class="token punctuation">,</span> sides <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">}</span><br>Triangle<span class="token punctuation">.</span>__index <span class="token operator">=</span> Triangle<br><span class="token function">setmetatable</span><span class="token punctuation">(</span>Triangle<span class="token punctuation">,</span> Shape<span class="token punctuation">)</span> <span class="token comment">-- Triangle inherits from Shape</span><br><br><span class="token comment">-- Constructor</span><br><span class="token keyword">function</span> Triangle<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>base<span class="token punctuation">,</span> height<span class="token punctuation">)</span><br>  <span class="token keyword">local</span> instance <span class="token operator">=</span> <span class="token function">setmetatable</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> Triangle<span class="token punctuation">)</span><br>  instance<span class="token punctuation">.</span>base <span class="token operator">=</span> base<br>  instance<span class="token punctuation">.</span>height <span class="token operator">=</span> height<br>  <span class="token keyword">return</span> instance<br><span class="token keyword">end</span><br><br><span class="token comment">-- Instance Method</span><br><span class="token keyword">function</span> Triangle<span class="token punctuation">:</span><span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token keyword">return</span> self<span class="token punctuation">.</span>base <span class="token operator">*</span> self<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><br><span class="token keyword">end</span><br><br>triangle <span class="token operator">=</span> Triangle<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><br>triangle<span class="token punctuation">:</span><span class="token function">report</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- triangle has 3 sides and area 12.0</span><br><br><span class="token comment">-- Define a Rectangle class.</span><br>Rectangle <span class="token operator">=</span> <span class="token punctuation">{</span>name <span class="token operator">=</span> <span class="token string">"rectangle"</span><span class="token punctuation">,</span> sides <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">}</span><br>Rectangle<span class="token punctuation">.</span>__index <span class="token operator">=</span> Rectangle<br><span class="token function">setmetatable</span><span class="token punctuation">(</span>Rectangle<span class="token punctuation">,</span> Shape<span class="token punctuation">)</span> <span class="token comment">-- Rectangle inherits from Shape</span><br><br><span class="token comment">-- Constructor</span><br><span class="token keyword">function</span> Rectangle<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><br>  <span class="token keyword">local</span> instance <span class="token operator">=</span> <span class="token function">setmetatable</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> Rectangle<span class="token punctuation">)</span><br>  instance<span class="token punctuation">.</span>width <span class="token operator">=</span> width<br>  instance<span class="token punctuation">.</span>height <span class="token operator">=</span> height<br>  <span class="token keyword">return</span> instance<br><span class="token keyword">end</span><br><br><span class="token comment">-- Instance Method</span><br><span class="token keyword">function</span> Rectangle<span class="token punctuation">:</span><span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token keyword">return</span> self<span class="token punctuation">.</span>width <span class="token operator">*</span> self<span class="token punctuation">.</span>height<br><span class="token keyword">end</span><br><br>rectangle <span class="token operator">=</span> Rectangle<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><br>rectangle<span class="token punctuation">:</span><span class="token function">report</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- rectangle has 4 sides and area 24.0</span><br><br><span class="token comment">-- Define a Square class.</span><br><span class="token comment">-- Note that we didn't specify the number of sides.</span><br><span class="token comment">-- It will get that from its superclass Rectangle.</span><br>Square <span class="token operator">=</span> <span class="token punctuation">{</span>name <span class="token operator">=</span> <span class="token string">"square"</span><span class="token punctuation">}</span><br>Square<span class="token punctuation">.</span>__index <span class="token operator">=</span> Square<br><span class="token function">setmetatable</span><span class="token punctuation">(</span>Square<span class="token punctuation">,</span> Rectangle<span class="token punctuation">)</span> <span class="token comment">-- Square inherits from Rectangle</span><br><br><span class="token comment">-- Constructor</span><br><span class="token keyword">function</span> Square<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>side<span class="token punctuation">)</span><br>  <span class="token keyword">local</span> instance <span class="token operator">=</span> <span class="token function">setmetatable</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> Square<span class="token punctuation">)</span><br>  instance<span class="token punctuation">.</span>side <span class="token operator">=</span> side<br>  <span class="token keyword">return</span> instance<br><span class="token keyword">end</span><br><br><span class="token comment">-- Instance Method</span><br><span class="token keyword">function</span> Square<span class="token punctuation">:</span><span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token comment">-- TODO: Is it possible to compute this using the superclass method?</span><br>  <span class="token keyword">return</span> self<span class="token punctuation">.</span>side <span class="token operator">^</span> <span class="token number">2</span><br><span class="token keyword">end</span><br><br>square <span class="token operator">=</span> Square<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><br>square<span class="token punctuation">:</span><span class="token function">report</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- square has 4 sides and area 25.0</span></code></pre><p>TODO: Can you simplify inheritance similar to how you simplified defining a class? TODO: Maybe you should show this example again using your <code>class</code> function.</p><h3 id="multiple-inheritance" tabindex="-1">Multiple Inheritance</h3><p>TODO: Add this based on <a href="https://www.youtube.com/watch?v=1BFoprD30dE&amp;t=97s">https://www.youtube.com/watch?v=1BFoprD30dE&amp;t=97s</a>.</p><h3 id="simplifying-classes" tabindex="-1">Simplifying Classes</h3><p>There is a fair amount boilerplate code in all the examples above and plenty of opportunity to make mistakes. We can address this by creating an &quot;oo&quot; module that defines the functions <code>class</code> and <code>subclass</code> that do all the work for us.</p><p>The <code>oo</code> module can be defined as follows:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> M <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br><br><span class="token comment">-- This adds a function to the builtin `string` module.</span><br><span class="token keyword">function</span> string<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">)</span><br>  <span class="token comment">-- 1 is the index at which to start the search.</span><br>  <span class="token comment">-- true turns off use of patterns which improves performance.</span><br>  <span class="token keyword">return</span> source<span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><br><span class="token keyword">end</span><br><br><span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">move_metamethods</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">)</span><br>  <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token keyword">do</span><br>    <span class="token keyword">if</span> k<span class="token punctuation">:</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"__"</span><span class="token punctuation">)</span> <span class="token keyword">then</span><br>      target<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v<br>      source<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">nil</span><br>    <span class="token keyword">end</span><br>  <span class="token keyword">end</span><br><span class="token keyword">end</span><br><br><span class="token comment">-- This creates a table that simulates an OO class.</span><br><span class="token comment">-- The `defaults` parameter is a table that holds default property values</span><br><span class="token comment">-- and optional metamethods like `__tostring`.</span><br><span class="token keyword">function</span> M<span class="token punctuation">.</span><span class="token function">class</span><span class="token punctuation">(</span>defaults<span class="token punctuation">)</span><br>  <span class="token function">assert</span><span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>defaults<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"table"</span><span class="token punctuation">,</span> <span class="token string">"defaults must be a table"</span><span class="token punctuation">)</span><br><br>  <span class="token keyword">local</span> metatable <span class="token operator">=</span> <span class="token punctuation">{</span> __index <span class="token operator">=</span> defaults <span class="token punctuation">}</span><br>  <span class="token function">move_metamethods</span><span class="token punctuation">(</span>defaults<span class="token punctuation">,</span> metatable<span class="token punctuation">)</span><br><br>  <span class="token keyword">return</span> <span class="token punctuation">{</span><br>    meta <span class="token operator">=</span> metatable<span class="token punctuation">,</span> <span class="token comment">-- used by subclass function</span><br>    new <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>initial<span class="token punctuation">)</span><br>      <span class="token function">assert</span><span class="token punctuation">(</span><span class="token keyword">not</span> defaults<span class="token punctuation">.</span>abstract<span class="token punctuation">,</span> <span class="token string">"cannot create instance of abstract class"</span><span class="token punctuation">)</span><br>      <span class="token keyword">local</span> instance <span class="token operator">=</span> initial <span class="token keyword">or</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br>      <span class="token function">setmetatable</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> metatable<span class="token punctuation">)</span><br>      <span class="token keyword">return</span> instance<br>    <span class="token keyword">end</span><br>  <span class="token punctuation">}</span><br><span class="token keyword">end</span><br><br><span class="token comment">-- This creates a table that simulates an OO subclass.</span><br><span class="token comment">-- The `defaults` parameter is a table that holds default property values</span><br><span class="token comment">-- and optional metamethods like `__tostring`.</span><br><span class="token keyword">function</span> M<span class="token punctuation">.</span><span class="token function">subclass</span><span class="token punctuation">(</span>baseClass<span class="token punctuation">,</span> defaults<span class="token punctuation">)</span><br>  <span class="token function">assert</span><span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>baseClass<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"table"</span><span class="token punctuation">,</span> <span class="token string">"base class must be a table"</span><span class="token punctuation">)</span><br>  <span class="token function">assert</span><span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>defaults<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"table"</span><span class="token punctuation">,</span> <span class="token string">"defaults must be a table"</span><span class="token punctuation">)</span><br><br>  <span class="token keyword">local</span> metatable <span class="token operator">=</span> <span class="token punctuation">{</span> __index <span class="token operator">=</span> defaults <span class="token punctuation">}</span><br>  <span class="token function">move_metamethods</span><span class="token punctuation">(</span>defaults<span class="token punctuation">,</span> metatable<span class="token punctuation">)</span><br>  <span class="token function">setmetatable</span><span class="token punctuation">(</span>metatable<span class="token punctuation">.</span>__index<span class="token punctuation">,</span> baseClass<span class="token punctuation">.</span>meta<span class="token punctuation">)</span><br><br>  <span class="token keyword">return</span> <span class="token punctuation">{</span><br>    meta <span class="token operator">=</span> metatable<span class="token punctuation">,</span> <span class="token comment">-- used by subclass function</span><br>    new <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>initial<span class="token punctuation">)</span><br>      <span class="token keyword">local</span> instance <span class="token operator">=</span> initial <span class="token keyword">or</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br>      <span class="token function">setmetatable</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> metatable<span class="token punctuation">)</span><br>      <span class="token keyword">return</span> instance<br>    <span class="token keyword">end</span><br>  <span class="token punctuation">}</span><br><span class="token keyword">end</span><br><br><span class="token keyword">return</span> M</code></pre><p>The following code demonstrates using the <code>class</code> and <code>subclass</code> functions defined in the &quot;oo&quot; module.</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> oo <span class="token operator">=</span> require <span class="token string">"oo"</span><br><br>Point <span class="token operator">=</span> oo<span class="token punctuation">.</span><span class="token function">class</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token comment">-- Properties</span><br>  x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span><br>  y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span><br><br>  <span class="token comment">-- Methods</span><br>  distanceFromOrigin <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><br>    <span class="token keyword">return</span> math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>x <span class="token operator">^</span> <span class="token number">2</span> <span class="token operator">+</span> p<span class="token punctuation">.</span>y <span class="token operator">^</span> <span class="token number">2</span><span class="token punctuation">)</span><br>  <span class="token keyword">end</span><span class="token punctuation">,</span><br><br>  <span class="token comment">-- Metamethods</span><br>  __add <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span><br>    <span class="token keyword">return</span> Point<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">{</span> x <span class="token operator">=</span> p1<span class="token punctuation">.</span>x <span class="token operator">+</span> p2<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y <span class="token operator">=</span> p1<span class="token punctuation">.</span>y <span class="token operator">+</span> p2<span class="token punctuation">.</span>y <span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token keyword">end</span><span class="token punctuation">,</span><br>  __tostring <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><br>    <span class="token keyword">return</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"(%.2f, %.2f)"</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p<span class="token punctuation">.</span>y<span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br><span class="token keyword">local</span> p1 <span class="token operator">=</span> Point<span class="token punctuation">.</span><span class="token function">new</span> <span class="token punctuation">{</span> x <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">4</span> <span class="token punctuation">}</span><br><span class="token function">print</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span> <span class="token comment">-- (3.00, 4.00)</span><br><span class="token function">print</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span><span class="token function">distanceFromOrigin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 5.0</span><br><br><span class="token keyword">local</span> p2 <span class="token operator">=</span> Point<span class="token punctuation">.</span><span class="token function">new</span> <span class="token punctuation">{</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">}</span><br><span class="token keyword">local</span> p3 <span class="token operator">=</span> p1 <span class="token operator">+</span> p2<br><span class="token function">print</span><span class="token punctuation">(</span>p3<span class="token punctuation">)</span> <span class="token comment">-- (8.0, 5.0)</span><br><br><span class="token keyword">local</span> p4 <span class="token operator">=</span> Point<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">{</span> y <span class="token operator">=</span> <span class="token number">7</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>p4<span class="token punctuation">)</span> <span class="token comment">-- (0.00, 7.00)</span><br><br>Shape <span class="token operator">=</span> oo<span class="token punctuation">.</span><span class="token function">class</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  abstract <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">,</span><br>  report <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><br>    <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s has %d sides and area %f"</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>sides<span class="token punctuation">,</span><br>      self<span class="token punctuation">:</span><span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>Triangle <span class="token operator">=</span> oo<span class="token punctuation">.</span><span class="token function">subclass</span><span class="token punctuation">(</span>Shape<span class="token punctuation">,</span> <span class="token punctuation">{</span><br>  name <span class="token operator">=</span> <span class="token string">"triangle"</span><span class="token punctuation">,</span><br>  sides <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span><br>  area <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0.5</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>base <span class="token operator">*</span> self<span class="token punctuation">.</span>height <span class="token keyword">end</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token keyword">local</span> triangle <span class="token operator">=</span> Triangle<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">{</span> base <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> height <span class="token operator">=</span> <span class="token number">6</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"triangle area ="</span><span class="token punctuation">,</span> triangle<span class="token punctuation">:</span><span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 12.0</span><br>triangle<span class="token punctuation">:</span><span class="token function">report</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- triangle has 3 sides and area 12.000000</span><br><br>Rectangle <span class="token operator">=</span> oo<span class="token punctuation">.</span><span class="token function">subclass</span><span class="token punctuation">(</span>Shape<span class="token punctuation">,</span> <span class="token punctuation">{</span><br>  name <span class="token operator">=</span> <span class="token string">"rectangle"</span><span class="token punctuation">,</span><br>  sides <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span><br>  area <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token keyword">return</span> self<span class="token punctuation">.</span>width <span class="token operator">*</span> self<span class="token punctuation">.</span>height <span class="token keyword">end</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token keyword">local</span> rectangle <span class="token operator">=</span> Rectangle<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">{</span> width <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> height <span class="token operator">=</span> <span class="token number">6</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><br>rectangle<span class="token punctuation">:</span><span class="token function">report</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- rectangle has 4 sides</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"rectangle area = "</span> <span class="token operator">..</span> rectangle<span class="token punctuation">:</span><span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 24</span><br><br>Square <span class="token operator">=</span> oo<span class="token punctuation">.</span><span class="token function">subclass</span><span class="token punctuation">(</span>Rectangle<span class="token punctuation">,</span> <span class="token punctuation">{</span><br>  name <span class="token operator">=</span> <span class="token string">"square"</span><span class="token punctuation">,</span><br>  area <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token keyword">return</span> self<span class="token punctuation">.</span>side <span class="token operator">^</span> <span class="token number">2</span> <span class="token keyword">end</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token keyword">local</span> square <span class="token operator">=</span> Square<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">{</span> side <span class="token operator">=</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><br>square<span class="token punctuation">:</span><span class="token function">report</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- square has 4 sides</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"square area = "</span> <span class="token operator">..</span> square<span class="token punctuation">:</span><span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 25.0</span></code></pre><h2 id="metamethods" tabindex="-1">Metamethods</h2><p>Metamethods are special methods from a predefined list that can be defined in a metatable. Many of metamethods define the functionality of Lua operators on tables associated with the metatable.</p><p>The following metamethods define the operation of mathematical operators.</p><table><thead><tr><th>Metamethod</th><th>Operator</th></tr></thead><tbody><tr><td><code>__add</code></td><td><code>+</code></td></tr><tr><td><code>__sub</code></td><td><code>-</code></td></tr><tr><td><code>__mul</code></td><td><code>*</code></td></tr><tr><td><code>__div</code></td><td><code>/</code></td></tr><tr><td><code>__idiv</code></td><td><code>//</code></td></tr><tr><td><code>__mod</code></td><td><code>%</code></td></tr><tr><td><code>__pow</code></td><td><code>^</code></td></tr></tbody></table><p>The following metamethods define the operation of logical operators.</p><table><thead><tr><th>Metamethod</th><th>Operator</th></tr></thead><tbody><tr><td><code>__eq</code></td><td><code>==</code></td></tr><tr><td><code>__lt</code></td><td><code>&lt;</code></td></tr><tr><td><code>__le</code></td><td><code>&lt;=</code></td></tr></tbody></table><p>There are no metamethods that correspond to the logical operators <code>~=</code>, <code>&gt;</code>, and <code>&gt;=</code>. Those are derived from the negation of the other logical operators.</p><p>There are no metamethods that correspond to the logical operators <code>and</code>, <code>or</code>, and <code>not</code>.</p><p>The following metamethods define the operation of bitwise operators.</p><table><thead><tr><th>Metamethod</th><th>Operator</th></tr></thead><tbody><tr><td><code>__band</code></td><td><code>&amp;</code></td></tr><tr><td><code>__bor</code></td><td><code>|</code></td></tr><tr><td><code>__bxor</code></td><td><code>~</code></td></tr><tr><td><code>__bnot</code></td><td><code>!</code></td></tr><tr><td><code>__shl</code></td><td><code>&lt;&lt;</code></td></tr><tr><td><code>__shr</code></td><td><code>&gt;&gt;</code></td></tr></tbody></table><p>The following metamethods define the operation other operators.</p><table><thead><tr><th>Metamethod</th><th>Operator</th></tr></thead><tbody><tr><td><code>__concat</code></td><td><code>..</code></td></tr><tr><td><code>__len</code></td><td><code>#</code></td></tr><tr><td><code>__unm</code></td><td><code>-</code> (unary)</td></tr></tbody></table><p>Metamethods also support implementing functions that are called when specific things occur that are unrelated to operators.</p><table><thead><tr><th>Metamethod</th><th>Operation</th></tr></thead><tbody><tr><td><code>__call</code></td><td>called when the table is called like a function</td></tr><tr><td><code>__gc</code></td><td>called after garbage collection runs</td></tr><tr><td><code>__index</code></td><td>called if a key is not found in the table</td></tr><tr><td><code>__metatable</code></td><td>prevents changes to metatable; see below</td></tr><tr><td><code>__mode</code></td><td>returns a string; see below</td></tr><tr><td><code>__newindex</code></td><td>called when an entry is added to the table</td></tr><tr><td><code>__pairs</code></td><td><code>pairs</code> function</td></tr><tr><td><code>__tostring</code></td><td>returns a string representation</td></tr></tbody></table><p>The <code>__index</code> metamethod is perhaps the most important one in terms of the breadth of functionality it unlocks. This was covered in previous sections on &quot;Metatables&quot; and &quot;Classes&quot;.</p><p>When the <code>__metatable</code> function is defined, the metatable cannot be modified and this returns an error message.</p><p>When the <code>__mode</code> function returns a string. When it contains <code>k</code>, the keys are weak. When it contains <code>v</code>, the values are weak. Both can be true.</p><p>The <code>__pairs</code> method method enables iterating over metatable entries.</p><p>TODO: See your metamethods.lua file.</p><h2 id="evaluting-code-at-runtime" tabindex="-1">Evaluting Code at Runtime</h2><p>The <code>load</code> function takes a string or a function. It returns a function and message, either of which can be <code>nil</code>.</p><p>When a string is passed it parses it as Lua code and returns a function that executes the code and <code>nil</code> for the message. If there are errors in the code, it returns <code>nil</code> for the function and a string for an error message.</p><p>When a function is passed, the function must return a string of code. It is called repeatedly until it returns an empty string or <code>nil</code>. The returned strings are concatenated to form the entire code to be compiled.</p><p>Here are two contrived examples.</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> name <span class="token operator">=</span> <span class="token string">"World"</span><br><span class="token keyword">local</span> code <span class="token operator">=</span> <span class="token string">"print('Hello, "</span> <span class="token operator">..</span> name <span class="token operator">..</span> <span class="token string">"!')"</span><br><span class="token keyword">local</span> fn <span class="token operator">=</span> <span class="token function">load</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><br><span class="token keyword">if</span> fn <span class="token keyword">then</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">end</span> <span class="token comment">-- Hello, World!</span><br><br><span class="token keyword">local</span> n <span class="token operator">=</span> <span class="token number">0</span><br><span class="token keyword">local</span> last <span class="token operator">=</span> <span class="token number">4</span><br><span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token comment">-- local code</span><br>  <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">then</span><br>    code <span class="token operator">=</span> <span class="token string">"print("</span><br>  <span class="token keyword">elseif</span> n <span class="token operator">&lt;</span> last <span class="token keyword">then</span><br>    code <span class="token operator">=</span> n <span class="token operator">..</span> <span class="token string">","</span><br>  <span class="token keyword">elseif</span> n <span class="token operator">==</span> last <span class="token keyword">then</span><br>    code <span class="token operator">=</span> n <span class="token operator">..</span> <span class="token string">")"</span><br>  <span class="token keyword">elseif</span> n <span class="token operator">></span> last <span class="token keyword">then</span><br>    code <span class="token operator">=</span> <span class="token keyword">nil</span><br>  <span class="token keyword">end</span><br><br>  n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span><br>  <span class="token keyword">return</span> code<br><span class="token keyword">end</span><br><br>fn <span class="token operator">=</span> <span class="token function">load</span><span class="token punctuation">(</span>getCode<span class="token punctuation">)</span><br><span class="token keyword">if</span> fn <span class="token keyword">then</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">end</span> <span class="token comment">-- 1       2       3       4</span></code></pre><p>The <code>loadfile</code> function is similar to the <code>load</code> function, but it takes a file path from which code is read. If no file path is provided, it reads code from <code>stdin</code>.</p><p>The <code>dofile</code> function reads code from a file or <code>stdin</code>, executes it, and returns all the values returned by the code rather than returning a function to be executed later.</p><h2 id="lua-functional-(luafun)" tabindex="-1">Lua Functional (luafun)</h2><p>The <a href="https://www.lua.org/manual/5.4/manual.html#6.6" target="_blank">table</a> library does not include functions such as <code>map</code>, <code>filter</code>, <code>reduce</code>, <code>some</code>, and <code>every</code>. It's not difficult to write these though. The following code implements and demonstrates using each of them.</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> <span class="token function">map</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> t<span class="token punctuation">)</span><br>  <span class="token keyword">local</span> result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br>  <span class="token keyword">for</span> i<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">do</span><br>    result<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br>  <span class="token keyword">return</span> result<br><span class="token keyword">end</span><br><br><span class="token keyword">local</span> numbers <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token punctuation">}</span><br><span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">square</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token keyword">return</span> n <span class="token operator">*</span> n <span class="token keyword">end</span><br><span class="token keyword">local</span> squares <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span>square<span class="token punctuation">,</span> numbers<span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>squares<span class="token punctuation">,</span> <span class="token string">", "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 1, 4, 9, 16, 25</span><br><br><span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> t<span class="token punctuation">)</span><br>  <span class="token keyword">local</span> result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br>  <span class="token keyword">for</span> _<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">do</span><br>    <span class="token keyword">if</span> <span class="token function">fn</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token keyword">then</span><br>      table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> v<span class="token punctuation">)</span><br>    <span class="token keyword">end</span><br>  <span class="token keyword">end</span><br>  <span class="token keyword">return</span> result<br><span class="token keyword">end</span><br><br><span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">isEven</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token keyword">return</span> n <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">end</span><br><span class="token keyword">local</span> evens <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>isEven<span class="token punctuation">,</span> numbers<span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>evens<span class="token punctuation">,</span> <span class="token string">", "</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 2, 4</span><br><br><span class="token keyword">function</span> <span class="token function">reduce</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> t<span class="token punctuation">,</span> initial<span class="token punctuation">)</span><br>  <span class="token keyword">local</span> acc <span class="token operator">=</span> initial<br>  <span class="token keyword">for</span> _<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">do</span><br>    acc <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>acc<span class="token punctuation">,</span> v<span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br>  <span class="token keyword">return</span> acc<br><span class="token keyword">end</span><br><br><span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span> <span class="token keyword">return</span> n1 <span class="token operator">+</span> n2 <span class="token keyword">end</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">reduce</span><span class="token punctuation">(</span>sum<span class="token punctuation">,</span> numbers<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 15</span><br><br><span class="token keyword">function</span> <span class="token function">some</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> t<span class="token punctuation">)</span><br>  <span class="token keyword">for</span> _<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">do</span><br>    <span class="token keyword">if</span> <span class="token function">fn</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token keyword">then</span> <span class="token keyword">return</span> <span class="token keyword">true</span> <span class="token keyword">end</span><br>  <span class="token keyword">end</span><br>  <span class="token keyword">return</span> <span class="token keyword">false</span><br><span class="token keyword">end</span><br><br><span class="token keyword">function</span> <span class="token function">every</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> t<span class="token punctuation">)</span><br>  <span class="token keyword">for</span> i<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">do</span><br>    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token function">fn</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token keyword">then</span> <span class="token keyword">return</span> <span class="token keyword">false</span> <span class="token keyword">end</span><br>  <span class="token keyword">end</span><br>  <span class="token keyword">return</span> <span class="token keyword">true</span><br><span class="token keyword">end</span><br><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token keyword">return</span> n <span class="token operator">></span> <span class="token number">3</span> <span class="token keyword">end</span><span class="token punctuation">,</span> numbers<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">-- true</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token keyword">return</span> n <span class="token operator">&lt;</span> <span class="token number">7</span> <span class="token keyword">end</span><span class="token punctuation">,</span> numbers<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- true</span></code></pre><p>The functions <code>map</code>, <code>filter</code>, and <code>reduce</code> (and many more) can be found in the <a href="https://luafun.github.io/?v=1.0.20" rel="noopener" target="_blank">Lua Functional Library</a>.</p><p>This library is distributed in the single file <code>fun.lua</code>. To download the file, enter <code>wget https://raw.github.com/luafun/luafun/master/fun.lua</code>.</p><p>The following code demonstrates basic use of this library:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> fun <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fun"</span><span class="token punctuation">)</span><br><br><span class="token keyword">local</span> scores <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">}</span><br><br><span class="token comment">-- The `map` and `filter` methods returns an iterator.</span><br><span class="token comment">-- Calling `:totable()` on an iterator returns a table.</span><br><br><span class="token comment">-- Use `map` to double the numbers in a table.</span><br><span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">double</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token keyword">return</span> n <span class="token operator">*</span> <span class="token number">2</span> <span class="token keyword">end</span><br>doubled_iter <span class="token operator">=</span> fun<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>double<span class="token punctuation">,</span> scores<span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Doubled Scores"</span><span class="token punctuation">)</span><br>fun<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>print<span class="token punctuation">,</span> doubled_iter<span class="token punctuation">)</span> <span class="token comment">-- 14 8 26</span><br><br><span class="token comment">-- Use `filter` to get odd numbers from a table.</span><br><span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">odd</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token keyword">return</span> n <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">end</span><br>odd_iter <span class="token operator">=</span> fun<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>odd<span class="token punctuation">,</span> scores<span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Odd Scores"</span><span class="token punctuation">)</span><br>fun<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>print<span class="token punctuation">,</span> odd_iter<span class="token punctuation">)</span> <span class="token comment">-- 7 3</span><br><br><span class="token comment">-- Use `reduce` to sum the numbers in a table.</span><br><span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token keyword">end</span><br>total <span class="token operator">=</span> fun<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>add<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> scores<span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Total is "</span> <span class="token operator">..</span> total<span class="token punctuation">)</span> <span class="token comment">-- 24</span><br><br><span class="token comment">-- Do the same with the `sum` function.</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Total is "</span> <span class="token operator">..</span> fun<span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span>scores<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- 24</span><br><br><span class="token comment">-- There are MANY more functions in the luafun library!</span></code></pre><p>TODO: How can you use a for loop to iterate over values in an iterator?</p><h2 id="standard-library" tabindex="-1">Standard Library</h2><p>The Lua standard library defines the following modules:</p><ul><li><a href="https://www.lua.org/manual/5.4/manual.html#6.1" target="_blank">basic</a></li><li><a href="https://www.lua.org/manual/5.4/manual.html#6.2" target="_blank">coroutine</a></li><li><a href="https://www.lua.org/manual/5.4/manual.html#6.10" target="_blank">debug</a></li><li><a href="https://www.lua.org/manual/5.4/manual.html#6.8" target="_blank">io</a></li><li><a href="https://www.lua.org/manual/5.4/manual.html#6.7" target="_blank">math</a></li><li><a href="https://www.lua.org/manual/5.4/manual.html#6.3" target="_blank">modules</a></li><li><a href="https://www.lua.org/manual/5.4/manual.html#6.9" target="_blank">os</a></li><li><a href="https://www.lua.org/manual/5.4/manual.html#6.4" target="_blank">string</a></li><li><a href="https://www.lua.org/manual/5.4/manual.html#6.6" target="_blank">table</a></li><li><a href="https://www.lua.org/manual/5.4/manual.html#6.5" target="_blank">utf8</a></li></ul><p>Modules in the standard library do not need to be imported to use them.</p><h3 id="basic-module" tabindex="-1">basic module</h3><p>The <code>basic</code> module defines the following core Lua functions.</p><table><thead><tr><th>Function</th><th>Description</th></tr></thead><tbody><tr><td><code>assert(v [,message])</code></td><td>raises an error if <code>v</code> is <code>false</code> or <code>nil</code></td></tr><tr><td><code>collectgarbage([opt [,arg]])</code></td><td>controls the operation of the garbage collector</td></tr><tr><td><code>dofile([filename])</code></td><td>opens a file containing Lua code and executes it</td></tr><tr><td><code>error(message [, level])</code></td><td>raises an error that can be caught with <code>pcall</code> and <code>xpcall</code></td></tr><tr><td><code>_G</code></td><td>holds the global environment</td></tr><tr><td><code>getmetatable(object)</code></td><td>gets the metatable of a given object</td></tr><tr><td><code>ipairs(t)</code></td><td>returns three values needed to iterate over the indexes and values in an array-like table</td></tr><tr><td><code>load(chunk, [, chunkname [, mode [, env]]])</code></td><td>loads Lua code from a string or function and returns a function that will execute it</td></tr><tr><td><code>loadfile([filename [, mode, [, env]]])</code></td><td>loads Lua code from a file and returns a function that will execute it</td></tr><tr><td><code>next(table [, index])</code></td><td>gets the next index and value in array-like table</td></tr><tr><td><code>pairs(t)</code></td><td>returns three values needed to iterate over the keys and values in a dictionary-like table</td></tr><tr><td><code>pcall(f, [, arg1, ...])</code></td><td>takes a function and arguments to pass to it; performs a &quot;protected call&quot; that catches errors</td></tr><tr><td><code>print(...)</code></td><td>takes any number of arguments and sends their <code>tostring</code> values to <code>stdout</code></td></tr><tr><td><code>rawequal(v1, v2)</code></td><td>compares values without using their <code>__eq</code> metamethods</td></tr><tr><td><code>rawget(table, index)</code></td><td>gets the value at a given table index without using the <code>__index</code> metamethod</td></tr><tr><td><code>rawlen(v)</code></td><td>gets the length of a value without using its <code>__len</code> metamethod</td></tr><tr><td><code>rawset(table, index, value)</code></td><td>sets the value at a given table index without using the <code>__newindex</code> metamethod</td></tr><tr><td><code>select(index, ...)</code></td><td>returns a subset of its arguments starting at a given index or the number of arguments if the first is <code>#</code></td></tr><tr><td><code>setmetatable(table, metatable)</code></td><td>sets the metatable of a given table</td></tr><tr><td><code>tonumber(e [, base])</code></td><td>converts a string to a number in a given base (defaults to 10)</td></tr><tr><td><code>tostring(v)</code></td><td>converts a value to a string</td></tr><tr><td><code>type(v)</code></td><td>returns the type of a value as a string</td></tr><tr><td><code>_VERSION</code></td><td>a global variable that holds a string that describes the current Lua version (ex. &quot;Lua 5.4&quot;)</td></tr><tr><td><code>warn(msg1, ...)</code></td><td>writes a warning message to <code>stdout</code> that constructed by concatenating its string arguments</td></tr><tr><td><code>xpcall(f, msgh, [, arg1, ...])</code></td><td>similar to <code>pcall</code>, but takes a message handler that can be used to capture additional error information</td></tr></tbody></table><h3 id="debug-module" tabindex="-1">debug module</h3><p>TODO: Add detail on this module.</p><h3 id="io-module" tabindex="-1">io module</h3><p>TODO: Add detail on this module.</p><h3 id="math-module" tabindex="-1">math module</h3><p>Constants defined by this module include:</p><table><thead><tr><th>Constant</th><th>Meaning</th></tr></thead><tbody><tr><td><code>math.huge</code></td><td>floating point value greater than any other number</td></tr><tr><td><code>math.maxinteger</code></td><td>maximum integer value</td></tr><tr><td><code>math.mininteger</code></td><td>minimum integer value</td></tr><tr><td><code>math.pi</code></td><td>value of π</td></tr></tbody></table><p>A constant for <code>e</code> is not defined, but it can be obtained from <code>math.exp(1)</code>.</p><p>Trigonometry functions defined by this module include <code>sin</code>, <code>cos</code>, <code>tan</code>, <code>asin</code>, <code>acos</code>, and <code>atan</code>. All of these take or return angles in radians. To convert an angle from degrees to radians, use the <code>math.rad(x)</code> function. To convert an angle from radians to degrees, use the <code>math.deg(x)</code> function.</p><p>To generate random numbers, use the <code>math.randomseed</code> and <code>math.random</code> functions. For example:</p><ul><li><code>math.randomseed(os.time())</code> seeds the random number generator</li><li><code>math.random()</code> returns a floating point number in the range [0, 1)</li><li><code>math.random(10)</code> returns an integer in the range [1, 10]</li><li><code>math.random(5, 10)</code> returns an integer in the range [5, 10]</li></ul><p>Other functions defined in this module include:</p><table><thead><tr><th>Function</th><th>Returns</th></tr></thead><tbody><tr><td><code>math.abs(x)</code></td><td>absolute value</td></tr><tr><td><code>math.ceil(x)</code></td><td>ceiling (rounds up)</td></tr><tr><td><code>math.exp(x)</code></td><td>e raised to the x power</td></tr><tr><td><code>math.floor(x)</code></td><td>floor (rounds up)</td></tr><tr><td><code>math.fmod(x, y)</code></td><td>floating point remainder of x / y</td></tr><tr><td><code>math.log(x, [base])</code></td><td>logarithm of x with specified base or e</td></tr><tr><td><code>math.max(...)</code></td><td>maximum of a set of numbers</td></tr><tr><td><code>math.min(...)</code></td><td>minimum of a set of numbers</td></tr><tr><td><code>math.modf(x)</code></td><td>integral and fractional parts of a floating point number</td></tr><tr><td><code>math.sqrt(x)</code></td><td>square root</td></tr><tr><td><code>math.tointeger(x)</code></td><td>integer value if x can be converted to an integer; otherwise <code>nil</code></td></tr><tr><td><code>math.type(x)</code></td><td><code>&quot;integer&quot;</code>, <code>&quot;float&quot;</code>, or <code>nil</code></td></tr><tr><td><code>math.ult(m, n)</code></td><td><code>true</code> if m &lt; n when compared as unsigned integers; otherwise <code>false</code></td></tr></tbody></table><p><code>math.modf(3.14)</code> returns <code>3</code> and <code>0.14</code></p><p>The value passed to <code>math.tointeger</code> can be a number or string. For example:</p><ul><li><code>math.tointeger(3.0)</code> and <code>math.tointeger(&quot;3.0&quot;)</code> both return <code>3</code></li><li><code>math.tointeger(3.1)</code> returns <code>nil</code> because it cannot be converted to an integer</li></ul><h3 id="io-module-1" tabindex="-1">io Module</h3><p>The following code shows the most basic way to write to a new file. If the file already exists, it is overwritten.</p><pre class="language-lua"><code class="language-lua"><span class="token comment">-- Open a file in text mode and make it the default output file.</span><br><span class="token comment">-- If `file_path` is omitted, this just</span><br><span class="token comment">-- returns the current default output file, if any.</span><br>io<span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><br><br><span class="token comment">-- Write to the default output file.</span><br>io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>some_string<span class="token punctuation">)</span><br><br><span class="token comment">-- Close the default output file.</span><br>io<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>The following code shows the most basic way to read from a file.</p><pre class="language-lua"><code class="language-lua"><span class="token comment">-- Open a file in text mode and make it the default input file.</span><br><span class="token comment">-- If `file_path` is omitted, this just</span><br><span class="token comment">-- returns the current default input file, if any.</span><br>io<span class="token punctuation">.</span><span class="token function">input</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><br><br><span class="token comment">-- Read from the default input file.</span><br><span class="token comment">-- TODO: What arguments does this accept and what do they do?</span><br><span class="token keyword">local</span> data <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br><span class="token comment">-- Close the default input file.</span><br>io<span class="token punctuation">.</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>Files can be opened in one of the following modes where the columns indicate the capabilities of each mode:</p><table><thead><tr><th>Mode</th><th style="text-align:center">New</th><th style="text-align:center">Overwrite</th><th style="text-align:center">Read</th><th style="text-align:center">Write</th><th style="text-align:center">Append</th></tr></thead><tbody><tr><td><code>r</code></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">X</td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td><code>w</code></td><td style="text-align:center">X</td><td style="text-align:center">X</td><td style="text-align:center"></td><td style="text-align:center">X</td><td style="text-align:center"></td></tr><tr><td><code>a</code></td><td style="text-align:center">X</td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">X</td></tr><tr><td><code>r+</code></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center">X</td><td style="text-align:center">X</td><td style="text-align:center"></td></tr><tr><td><code>w+</code></td><td style="text-align:center">X</td><td style="text-align:center">X</td><td style="text-align:center">X</td><td style="text-align:center">X</td><td style="text-align:center"></td></tr><tr><td><code>a+</code></td><td style="text-align:center">X</td><td style="text-align:center"></td><td style="text-align:center">X</td><td style="text-align:center"></td><td style="text-align:center">X</td></tr></tbody></table><p>To open a file in a specific mode:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> stream <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> mode<span class="token punctuation">)</span> <span class="token comment">-- mode defaults to "r"</span></code></pre><p>To write to a file using the method syntax:</p><pre class="language-lua"><code class="language-lua">stream<span class="token punctuation">:</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span></code></pre><p>The following code demonstrates many ways to read from a stream.</p><pre class="language-lua"><code class="language-lua">contents <span class="token operator">=</span> stream<span class="token punctuation">:</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span> <span class="token comment">-- reads entire contents</span><br><br>line <span class="token operator">=</span> stream<span class="token punctuation">:</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"l"</span><span class="token punctuation">)</span> <span class="token comment">-- reads next line, discarding newline</span><br>line <span class="token operator">=</span> stream<span class="token punctuation">:</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"L"</span><span class="token punctuation">)</span> <span class="token comment">-- reads next line, keeiping newline</span><br><br>number <span class="token operator">=</span> stream<span class="token punctuation">:</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"n"</span><span class="token punctuation">)</span> <span class="token comment">-- reads one number</span><br><br>n1<span class="token punctuation">,</span> n2 <span class="token operator">=</span> stream<span class="token punctuation">:</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"n"</span><span class="token punctuation">,</span> <span class="token string">"n"</span><span class="token punctuation">)</span> <span class="token comment">-- reads two numbers</span><br><br>text <span class="token operator">=</span> stream<span class="token punctuation">:</span><span class="token function">read</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token comment">-- reads a string of up to "n" bytes</span><br><br>end_test <span class="token operator">=</span> stream<span class="token punctuation">:</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">-- returns nil if at end of file; otherwise ""</span></code></pre><p>To seek to a specific byte offset in a stream:</p><pre class="language-lua"><code class="language-lua">stream<span class="token punctuation">:</span><span class="token function">seek</span><span class="token punctuation">(</span><span class="token string">"set"</span><span class="token punctuation">,</span> offset<span class="token punctuation">)</span></code></pre><p>To close a stream:</p><pre class="language-lua"><code class="language-lua">stream<span class="token punctuation">:</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h3 id="os-module" tabindex="-1">os Module</h3><p>The <code>os</code> module defines the following functions:</p><table><thead><tr><th>Function</th><th>Purpose</th></tr></thead><tbody><tr><td><code>os.time()</code></td><td>returns seconds since 1970 or a given date/time</td></tr><tr><td><code>os.difftime()</code></td><td>returns difference in seconds between two times</td></tr><tr><td><code>os.date()</code></td><td>returns a string describing the current date and time</td></tr><tr><td><code>os.exit(code)</code></td><td>code can be true (exits with EXIT_SUCCESS; default), false (exits with EXIT_FAILURE), or a number</td></tr><tr><td><code>os.getenv(&quot;environment-variable-name&quot;)</code></td><td>returns the value of an environment variables</td></tr><tr><td><code>os.rename(current_file_path, new_file_path)</code></td><td>renames a file or directory</td></tr><tr><td><code>os.remove(current_file_path)</code></td><td>deletes a file or empty directory</td></tr><tr><td><code>os.execute(shell_command)</code></td><td>executes a shell command</td></tr></tbody></table><p>The <code>os.date</code> function takes a format string and an optional time that defaults to now. The format string uses the same characters as the C <a href="https://man7.org/linux/man-pages/man3/strftime.3.html?v=1.0.20" rel="noopener" target="_blank">strftime</a> function For example:</p><pre class="language-lua"><code class="language-lua">now <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span> <span class="token comment">-- Fri Apr  7 03:09:52 2023</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- string</span><br><br>time <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  year <span class="token operator">=</span> <span class="token number">1961</span><span class="token punctuation">,</span><br>  month <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span><br>  day <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span><br>  hour <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span><br>  min <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span><br>  sec <span class="token operator">=</span> <span class="token number">19</span><span class="token punctuation">,</span><br>  isdst <span class="token operator">=</span> <span class="token keyword">true</span> <span class="token comment">-- daylight savings time</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span> <span class="token comment">-- -274891181; negative because it is before 1970</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- number</span><br><br>format <span class="token operator">=</span> <span class="token string">"%A, %B %e, %Y"</span><br><span class="token function">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- Sunday, April 16, 1961</span></code></pre><p>To get the time required to run some code:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> start <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token operator">-</span>— Add some code here<span class="token punctuation">.</span><br><span class="token function">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span></code></pre><h3 id="string-module" tabindex="-1">string Module</h3><p>String operations supported by this module include the following, all using method syntax where <code>s</code> is a string:</p><table><thead><tr><th>Function</th><th>Description</th></tr></thead><tbody><tr><td><code>s:len()</code> or <code>#s</code></td><td>returns length in bytes</td></tr><tr><td><code>s:sub(startIndex, endIndex)</code></td><td>returns a substring</td></tr><tr><td><code>s:gsub(source, oldValue, newValue)</code></td><td>performs global substitution</td></tr><tr><td><code>s:find(target)</code></td><td>returns start and end index inclusive</td></tr><tr><td><code>s:upper()</code></td><td>returns uppercase version</td></tr><tr><td><code>s:lower()</code></td><td>returns lowercase version</td></tr><tr><td><code>s:match('pattern', i=1)</code></td><td>returns first match found in s starting at index i</td></tr><tr><td><code>s:gmatch('pattern', i=1)</code></td><td>returns iterator over all matches found in s start at index i</td></tr></tbody></table><p>The <code>gsub</code> function returns a new string and the number of occurrences that were replaced.</p><p>The following code demonstrates using the <code>gmatch</code> function to find all the integers in a string:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> s <span class="token operator">=</span> <span class="token string">"apple 19 banana 7 cherry 21"</span><br><span class="token keyword">local</span> matches <span class="token operator">=</span> s<span class="token punctuation">:</span><span class="token function">gmatch</span><span class="token punctuation">(</span><span class="token string">"%d+"</span><span class="token punctuation">)</span><br><span class="token keyword">for</span> match <span class="token keyword">in</span> matches <span class="token keyword">do</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>match<span class="token punctuation">)</span> <span class="token comment">-- 19, 7, and 21</span><br><span class="token keyword">end</span></code></pre><p>Some common string operations are not directly supported. For example, there are no functions that test whether a string contains, starts with, or ends with a substring. We can define these using the provided <code>find</code> function as follows:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> string<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">)</span><br>  <span class="token keyword">return</span> source<span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">)</span> <span class="token operator">~=</span> <span class="token keyword">nil</span><br><span class="token keyword">end</span><br><br><span class="token keyword">function</span> string<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">)</span><br>  <span class="token keyword">return</span> source<span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><br><span class="token keyword">end</span><br><br><span class="token keyword">function</span> string<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">)</span><br>  startIndex<span class="token punctuation">,</span> endIndex <span class="token operator">=</span> source<span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">)</span><br>  <span class="token keyword">return</span> endIndex <span class="token operator">==</span> <span class="token operator">#</span>source<br><span class="token keyword">end</span><br><br>text <span class="token operator">=</span> <span class="token string">"This is used to test of our new functions."</span></code></pre><p>The <code>contains</code> function defined above can be called in two ways.</p><pre class="language-lua"><code class="language-lua"><span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- true</span><br><span class="token function">print</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- true</span></code></pre><p>Here are more examples of calling the functions defined above using the method syntax.</p><pre class="language-lua"><code class="language-lua"><span class="token function">print</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"missing"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- false</span><br><span class="token function">print</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"This"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- true</span><br><span class="token function">print</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"Test"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- false</span><br><span class="token function">print</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">"functions."</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- true</span><br><span class="token function">print</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">"test."</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- false</span></code></pre><p>Lua does not support string interpolation. The closest Lua feature to this is the <code>string.format</code> function. This takes a format string as its first argument. This can contain literal text and formatting directives that begin with a percent sign.</p><p>The supported formatting directives are:</p><ul><li><code>%o</code> for octal numbers</li><li><code>%d</code> for decimal numbers</li><li><code>%x</code> for hexadecimal numbers</li><li><code>%f</code> for floating point numbers</li><li><code>%s</code> for strings</li></ul><p>For example:</p><pre class="language-lua"><code class="language-lua">name <span class="token operator">=</span> <span class="token string">"Mark"</span><br>color <span class="token operator">=</span> <span class="token string">"yellow"</span><br>sentence <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s's favorite color is %s."</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> color<span class="token punctuation">)</span></code></pre><p>The <code>%f</code> directive can specify the number of decimal places to output. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token comment">-- Print pi to four decimal places.</span><br><span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"pi is %.4f"</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span>pi<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- pi is 3.1416</span></code></pre><h3 id="table-module" tabindex="-1">table module</h3><p>TODO: Add detail on this module.</p><h2 id="environments" tabindex="-1">Environments</h2><p>&quot;Free variables&quot; are variables that are not declared with the <code>local</code> keyword. They are stored in the current &quot;environment&quot; which is a table referred to with the name <code>_ENV</code>. By default the value of <code>_ENV</code> is the same as <code>_G</code>. For example:</p><pre class="language-lua"><code class="language-lua">fruit <span class="token operator">=</span> <span class="token string">"apple"</span><br><span class="token keyword">local</span> fruit <span class="token operator">=</span> <span class="token string">"banana"</span><br><span class="token function">print</span><span class="token punctuation">(</span>fruit<span class="token punctuation">)</span> <span class="token comment">-- banana</span><br><span class="token function">print</span><span class="token punctuation">(</span>_ENV<span class="token punctuation">.</span>fruit<span class="token punctuation">)</span> <span class="token comment">-- apple</span><br><span class="token function">print</span><span class="token punctuation">(</span>_G<span class="token punctuation">.</span>fruit<span class="token punctuation">)</span> <span class="token comment">-- apple</span></code></pre><p>To see all the keys defined in the current environment, execute the following code. This typically includes standard libraries such as <code>coroutine</code>, <code>debug</code>, <code>io</code>, <code>math</code>, <code>os</code>, <code>string</code>, <code>table</code>, and <code>utf8</code>. It also typically includes functions and variables defined in the <code>basic</code> standard library such as <code>assert</code>, <code>print</code>, <code>pairs</code>, <code>ipairs</code>, <code>pcall</code>, <code>getmetatable</code>, <code>setmetatable</code>, and <code>_G</code>.</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>_ENV<span class="token punctuation">)</span> <span class="token keyword">do</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><br><span class="token keyword">end</span></code></pre><p>A function or <code>do</code> block can change its environment. Doing so changes where free variables are stored. This can be useful to avoid changing variables in the outer scope. For example:</p><pre class="language-lua"><code class="language-lua">fruit <span class="token operator">=</span> <span class="token string">"apple"</span><br><br><span class="token keyword">function</span> <span class="token function">demo1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token comment">-- Create a new environment that is only used by this function.</span><br>  <span class="token comment">-- It starts empty and looks in the global environment</span><br>  <span class="token comment">-- for anything it doesn't have.</span><br>  <span class="token comment">-- We can't set _ENV to {} here because that</span><br>  <span class="token comment">-- would prevent us from calling setmetatable.</span><br>  env <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br>  <span class="token function">setmetatable</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> <span class="token punctuation">{</span>__index <span class="token operator">=</span> _G<span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token comment">-- If `local` is not used here, the value of</span><br>  <span class="token comment">-- `_ENV` outside this function will be changed.</span><br>  <span class="token keyword">local</span> _ENV <span class="token operator">=</span> env<br><br>  <span class="token comment">-- Assign a variable in the new environment.</span><br>  fruit <span class="token operator">=</span> <span class="token string">"banana"</span><br><br>  <span class="token comment">-- The print function is not in the new environment,</span><br>  <span class="token comment">-- so the version in the global environment will be used.</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>fruit<span class="token punctuation">)</span> <span class="token comment">-- banana</span><br><br>  <span class="token comment">-- Functions called from here will use the global _ENV</span><br>  <span class="token comment">-- rather the local one we created above</span><br>  <span class="token comment">-- unless we pass it.</span><br>  <span class="token function">demo2</span><span class="token punctuation">(</span>_ENV<span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br><span class="token keyword">function</span> <span class="token function">demo2</span><span class="token punctuation">(</span>_ENV<span class="token punctuation">)</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>fruit<span class="token punctuation">)</span> <span class="token comment">-- banana</span><br><span class="token keyword">end</span><br><br><span class="token function">demo1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span>fruit<span class="token punctuation">)</span> <span class="token comment">-- apple</span></code></pre><h2 id="coroutines" tabindex="-1">Coroutines</h2><p>Lua is single-threaded like JavaScript. It supports collaborative multitasking with coroutines. At any point in time on only one coroutine is running. Coroutines do not run in parallel.</p><p>The following code demonstrates using a coroutine to generate integers in given multiples stopping at a given limit.</p><p>The <code>coroutine.create</code> function returns a value with the type <code>thread</code>, but it is a coroutine instance, not a thread in the usual sense.</p><p>The <code>coroutine.resume</code> function takes a thread and] arguments to be passed to the coroutine function. It returns a boolean indicating if it was successful and any values passed to <code>coroutine.yield</code>.</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">nextNumber</span><span class="token punctuation">(</span>delta<span class="token punctuation">,</span> limit<span class="token punctuation">,</span> previous<span class="token punctuation">)</span><br>  <span class="token keyword">local</span> next <span class="token operator">=</span> <span class="token punctuation">(</span>previous <span class="token keyword">or</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> delta<br>  <span class="token keyword">if</span> next <span class="token operator">&lt;=</span> limit <span class="token keyword">then</span><br>    coroutine<span class="token punctuation">.</span><span class="token function">yield</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><br>    <span class="token function">nextNumber</span><span class="token punctuation">(</span>delta<span class="token punctuation">,</span> limit<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token comment">-- recursive call</span><br>  <span class="token keyword">end</span><br><span class="token keyword">end</span><br><br><span class="token keyword">local</span> thread <span class="token operator">=</span> coroutine<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>nextNumber<span class="token punctuation">)</span><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>thread<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- thread</span><br><span class="token function">print</span><span class="token punctuation">(</span>coroutine<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>thread<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- "suspended"</span><br><br><span class="token comment">-- We only need to pass arguments in the</span><br><span class="token comment">-- first call to `resume` for this coroutine.</span><br><span class="token keyword">local</span> success<span class="token punctuation">,</span> v <span class="token operator">=</span> coroutine<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span>thread<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><br><br><span class="token keyword">while</span> success <span class="token keyword">and</span> v <span class="token keyword">do</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token comment">-- 3, 6, 9, 12, and 15</span><br>  success<span class="token punctuation">,</span> v <span class="token operator">=</span> coroutine<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span>thread<span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br><span class="token function">print</span><span class="token punctuation">(</span>coroutine<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>thread<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- "dead"</span></code></pre><p>The <code>coroutine.wrap</code> function provides an alternative to <code>coroutine.create</code>. Rather than returning a <code>thread</code>, <code>coroutine.wrap</code> returns a function than can be called to resume the <code>thread</code>. Rather than returning a boolean status and the values passed to <code>coroutine.yield</code>, it only returns the values passed to <code>coroutine.yield</code>,</p><p>The following code re-implements the previous example to use <code>coroutine.wrap</code> instead of <code>coroutine.create</code>. The <code>nextNumber</code> function remains unchanged.</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> iterator <span class="token operator">=</span> coroutine<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>nextNumber<span class="token punctuation">)</span><br><br><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>iterator<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">-- function</span><br><br><span class="token keyword">local</span> v <span class="token operator">=</span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><br><span class="token keyword">while</span> v <span class="token keyword">do</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token comment">-- 3, 6, 9, 12, and 15</span><br>  v <span class="token operator">=</span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token keyword">end</span></code></pre><p>Lua does not directly support concurrently running threads, but they can be implemented using the approach described in chapter 26 of the &quot;Programming in Lua - Fourth edition&quot; book. There are many Lua libraries that support multithreading including <a href="http://lualanes.github.io/lanes/?v=1.0.20" rel="noopener" target="_blank">Lua Lanes</a>.</p><p>Lua does not have the equivalent of the <code>async</code> and <code>await</code> keywords in other programming languages, but those can be simulated. See <a href="https://github.com/iamcco/async-await.lua?v=1.0.20" rel="noopener" target="_blank">async-await.lua</a>.</p><p>For sending HTTP requests, see the &quot;Networking&quot; section below.</p><h2 id="networking" tabindex="-1">Networking</h2><p>There are several popular Lua networking libraries.</p><ul><li><a href="http://openresty.org/en/?v=1.0.20" rel="noopener" target="_blank">OpenResty</a> is &quot;a dynamic web platform based on NGINX and LuaJIT.&quot;</li><li><a href="https://github.com/daurnimator/lua-http?v=1.0.20" rel="noopener" target="_blank">lua-http</a> - supports implementing HTTP servers and clients</li><li><a href="https://lunarmodules.github.io/luasocket/?v=1.0.20" rel="noopener" target="_blank">LuaSocket</a> - &quot;a C core that provides support for the TCP and UDP transport layers, and a set of Lua modules that add support for functionality commonly needed by applications that deal with the Internet&quot;</li><li><a href="https://luvit.io?v=1.0.20" rel="noopener" target="_blank">Luvit</a> - &quot;asynchronous I/O for Lua; implements the same APIs as Node.js&quot;</li></ul><h2 id="utility-functions" tabindex="-1">Utility Functions</h2><p>The following functions are helpful for debugging. They can be defined in a file like <code>utility.lua</code> and required where needed.</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> M <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br><br><span class="token comment">-- Returns a string description of the keys and values in a table.</span><br><span class="token comment">-- Values can be nested tables.</span><br><span class="token keyword">function</span> M<span class="token punctuation">.</span><span class="token function">dump</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><br>  <span class="token keyword">if</span> <span class="token function">type</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">~=</span> <span class="token string">"table"</span> <span class="token keyword">then</span><br>    <span class="token keyword">return</span> <span class="token function">tostring</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br><br>  <span class="token keyword">local</span> s <span class="token operator">=</span> <span class="token string">"{ "</span><br>  <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token keyword">do</span><br>    <span class="token keyword">if</span> <span class="token function">type</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">~=</span> <span class="token string">"number"</span> <span class="token keyword">then</span><br>      k <span class="token operator">=</span> <span class="token string">"\""</span> <span class="token operator">..</span> k <span class="token operator">..</span> <span class="token string">"\""</span><br>    <span class="token keyword">end</span><br>    s <span class="token operator">=</span> s <span class="token operator">..</span> k <span class="token operator">..</span> <span class="token string">"="</span> <span class="token operator">..</span> mod<span class="token punctuation">.</span><span class="token function">dump</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">..</span> <span class="token string">", "</span> <span class="token comment">-- recursive</span><br>  <span class="token keyword">end</span><br>  <span class="token keyword">if</span> <span class="token operator">#</span>s <span class="token operator">></span> <span class="token number">2</span> <span class="token keyword">then</span> s <span class="token operator">=</span> s<span class="token punctuation">:</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">end</span>        <span class="token comment">-- removes last comma and space</span><br>  <span class="token keyword">return</span> s <span class="token operator">..</span> <span class="token string">" }"</span><br><span class="token keyword">end</span><br><br><span class="token comment">-- Returns a string containing all the values in a table,</span><br><span class="token comment">-- each separated by a comma and a space.</span><br><span class="token comment">-- Values cannot be nested tables.</span><br><span class="token keyword">function</span> M<span class="token punctuation">.</span><span class="token function">valuesString</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><br>  <span class="token keyword">if</span> <span class="token function">type</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">~=</span> <span class="token string">"table"</span> <span class="token keyword">then</span><br>    <span class="token keyword">return</span> <span class="token string">""</span><br>  <span class="token keyword">end</span><br><br>  s <span class="token operator">=</span> <span class="token string">""</span><br>  <span class="token keyword">for</span> index<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token keyword">do</span><br>    s <span class="token operator">=</span> s <span class="token operator">..</span> v <span class="token operator">..</span> <span class="token string">", "</span><br>  <span class="token keyword">end</span><br>  <span class="token keyword">return</span> s<span class="token punctuation">:</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br><span class="token keyword">return</span> M</code></pre><h2 id="error-handling" tabindex="-1">Error Handling</h2><p>Lua does not have a mechanism for throwing and catching exceptions. In many cases errors result in a function returning the value <code>nil</code> and it is left to developers to check for <code>nil</code> values. Failing to do so can result in programs crashing and outputting a stack trace.</p><p>The only error handling mechanism Lua provides are the <code>pcall</code> and <code>xpcall</code> functions (short for &quot;protected call&quot;). These can be compared to a try block in other programming languages.</p><p>The <code>pcall</code> function is passed a function to execute and optionally arguments to be passed to it. It returns a boolean indicating whether the call completed without error and an error message if one did occur.</p><p>The <code>xpcall</code> function is similar, but accepts a message handler function that can be used to capture additional information about the error.</p><p>The <code>error</code> function is the Lua equivalent of a <code>throw</code> statement in other programming languages. It is passed a message and an optional integer error level. The message can be any type, but is typically a string or a table.</p><p>The following code demonstrates using the <code>pcall</code> function. It repeatedly prompts for a dividend and a divisor and displays their quotient. When invalid values are entered, error messages are output, but the program does not crash.</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">read_number</span><span class="token punctuation">(</span>prompt<span class="token punctuation">)</span><br>  io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>prompt <span class="token operator">..</span> <span class="token string">": "</span><span class="token punctuation">)</span><br>  <span class="token keyword">local</span> number <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"*number"</span><span class="token punctuation">)</span><br>  <span class="token comment">-- The previous line does not consume the newline character.</span><br>  <span class="token comment">-- Unless that is done, the next attempt to read a number will return `nil`.</span><br>  <span class="token comment">-- The following line consumes the newline character.</span><br>  <span class="token keyword">local</span> _ <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token keyword">return</span> number<br><span class="token keyword">end</span><br><br><span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token keyword">local</span> dividend <span class="token operator">=</span> <span class="token function">read_number</span><span class="token punctuation">(</span><span class="token string">"Enter a dividend"</span><span class="token punctuation">)</span><br>  <span class="token keyword">if</span> <span class="token keyword">not</span> dividend <span class="token keyword">then</span><br>    <span class="token comment">-- Error messages here are tables containing a message and a code.</span><br>    <span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">{</span>message <span class="token operator">=</span> <span class="token string">"dividend is invalid"</span><span class="token punctuation">,</span> code <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br><br>  <span class="token keyword">local</span> divisor <span class="token operator">=</span> <span class="token function">read_number</span><span class="token punctuation">(</span><span class="token string">"Enter a divisor"</span><span class="token punctuation">)</span><br>  <span class="token keyword">if</span> <span class="token keyword">not</span> divisor <span class="token keyword">then</span><br>    <span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">{</span>message <span class="token operator">=</span> <span class="token string">"divisor is invalid"</span><span class="token punctuation">,</span> code <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br>  <span class="token keyword">if</span> divisor <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">then</span><br>    <span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">{</span>message <span class="token operator">=</span> <span class="token string">"cannot divide by zero"</span><span class="token punctuation">,</span> code <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br><br>  <span class="token keyword">local</span> quotient <span class="token operator">=</span> dividend <span class="token operator">/</span> divisor<br>  io<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"The quotient is %.3f\n\n"</span><span class="token punctuation">,</span> quotient<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br><span class="token keyword">while</span> <span class="token keyword">true</span> <span class="token keyword">do</span><br>  <span class="token keyword">local</span> success<span class="token punctuation">,</span> err <span class="token operator">=</span> <span class="token function">pcall</span><span class="token punctuation">(</span>process<span class="token punctuation">)</span><br>  <span class="token keyword">if</span> <span class="token keyword">not</span> success <span class="token keyword">then</span><br>    <span class="token keyword">if</span> err <span class="token keyword">then</span><br>      <span class="token function">print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s (code %d)"</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span>message<span class="token punctuation">,</span> err<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token keyword">end</span><br>    <span class="token comment">-- print(debug.traceback()) -- prints a stack trace</span><br>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">-- extra newline</span><br>  <span class="token keyword">end</span><br><span class="token keyword">end</span></code></pre><h2 id="c-integration" tabindex="-1">C Integration</h2><p>A common reason to integrate Lua with C is to use Lua as a configuration language. This has many advantages over other configuration options such as JSON and Python.</p><ul><li>clean, minimal syntax</li><li>can include comments</li><li>can be dynamic, using data such as environment variables</li><li>can write simple code to compute values</li></ul><p>It is common in Lua configuration files to expose values as global variables. This is likely the reason that variables are global by default.</p><p>Download the source for Lua and build it by following these steps:</p><ul><li>Download the Lua source code from <a href="https://www.lua.org/download.html?v=1.0.20" rel="noopener" target="_blank">Lua Download</a>.</li><li>Unzip and untar the downloaded file.</li><li><code>cd</code> to the resulting directory.</li><li>Enter <code>make all test</code></li><li>Enter <code>sudo make install</code> which will:<ul><li>install the <code>lua</code> and <code>luac</code> executables in <code>/usr/local/bin</code></li><li>copy the header files <code>lua.h</code>, <code>luaconf.h</code>, <code>lualib.h</code>, <code>lauxlib.h</code>, and <code>lua.hpp</code> in <code>/usr/local/include</code></li><li>copy the library <code>liblua.a</code> to <code>/usr/local/lib</code></li><li>copy the man pages for <code>lua</code> and <code>luac</code> to <code>/usr/local/man/man1</code></li></ul></li><li>If compiling and linking with gcc (see below) results in the error &quot;ignoring file /usr/local/lib/liblua.dylib, it may be necessary to remove the dynamic library by entering <code>rm /usr/local/lib/liblua.dylib</code> This will cause gcc to use <code>/usr/local/lib/liblua.a</code> instead building for macOS-arm64 but attempting to link with file built for macOS-x86_64&quot;.</li></ul><p>Write C code that loads and runs a Lua script.</p><pre class="language-c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><br><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><br><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span><br><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"lauxlib.h"</span></span><br><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"lua.h"</span></span><br><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"lualib.h"</span></span><br><br><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// Create a Lua virtual machine.</span><br>  lua_State <span class="token operator">*</span>L <span class="token operator">=</span> <span class="token function">luaL_newstate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Make the standard library functions available in Lua code.</span><br>  <span class="token function">luaL_openlibs</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Execute a Lua source file.</span><br>  <span class="token function">luaL_dofile</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token string">"config.lua"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// To check if the top of the stack contains nil ...</span><br>  <span class="token comment">// if (lua_isnil(L, -1))</span><br><br>  <span class="token function">lua_getglobal</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token string">"myBoolean"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">int</span> myBoolean <span class="token operator">=</span> <span class="token function">lua_toboolean</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"myBoolean = %d\n"</span><span class="token punctuation">,</span> myBoolean<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token function">lua_getglobal</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token string">"myInteger"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  lua_Integer myInteger <span class="token operator">=</span> <span class="token function">lua_tointeger</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// lld is long long decimal</span><br>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"myInteger = %lld\n"</span><span class="token punctuation">,</span> myInteger<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token function">lua_getglobal</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token string">"myFloat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  lua_Number myFloat <span class="token operator">=</span> <span class="token function">lua_tonumber</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"myFloat = %f\n"</span><span class="token punctuation">,</span> myFloat<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token function">lua_getglobal</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token string">"myString"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>myString <span class="token operator">=</span> <span class="token function">lua_tostring</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"myString = %s\n"</span><span class="token punctuation">,</span> myString<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Close the Lua virtual machine.</span><br>  <span class="token function">lua_close</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// success</span><br><span class="token punctuation">}</span></code></pre><p>To compile and link the C program, enter:</p><pre class="language-bash"><code class="language-bash">gcc main.c <span class="token parameter variable">-o</span> main <span class="token parameter variable">-llua</span></code></pre><p>Run the executable by entering <code>./main</code></p><p>TODO: Add detail on calling C from Lua. TODO: Add detail on calling Lua from C.</p><p>TODO: Are there two stacks, one for data going from C to Lua TODO: and one for data going from Lua to C?</p><p>Calling <code>lua_openLibs</code> makes the standard library functions available. Lua code that does not call those can be executed without this.</p><p>TODO: Write utility functions that get values of specific types from Lua code TODO: and do all the error checking.</p><p>TODO: Does <code>lua_pcall</code> remove the function and its arguments from the stack?</p><p>See <a href="http://www.troubleshooters.com/codecorn/lua/lua_c_calls_lua.htm?v=1.0.20" rel="noopener" target="_blank">Calling Lua From a C Program</a>.</p><p>TODO: How can you prevent Lua code executed from C from TODO: doing something dangerous like deleting files?</p><p>For calling Lua from JavaScript, see <a href="https://daurnimator.github.io/lua.vm.js/lua.vm.js.html">https://daurnimator.github.io/lua.vm.js/lua.vm.js.html</a> and <a href="https://github.com/Doridian/LuaJS">https://github.com/Doridian/LuaJS</a>.</p><p>For calling Lua from Swift, see <a href="https://www.larsgregori.de/2019/12/27/lua-and-swift-in-ios/">https://www.larsgregori.de/2019/12/27/lua-and-swift-in-ios/</a>.</p><h2 id="games" tabindex="-1">Games</h2><h3 id="l%C3%B6ve" tabindex="-1">LÖVE</h3><p><a href="https://love2d.org?v=1.0.20" rel="noopener" target="_blank">LÖVE</a> is a Lua framework for building 2D games. It is free and open source. LÖVE can be downloaded from the previous link.</p><p>For a great YouTube video on the LÖVE framework, see <a href="https://www.youtube.com/watch?v=3k4CMAaNCuk&t=3309s?v=1.0.20" rel="noopener" target="_blank">Falling in LÖVE with Lua</a>. In the video Colton Ogden walks through the beginnings of writing a Super Mario game. The source code is available at <a href="https://github.com/coltonoscopy/cs502019games-track/tree/master/mario?v=1.0.20" rel="noopener" target="_blank">cs502019games-track</a>.</p><p>For macOS:</p><ul><li>Click the &quot;64-bit zipped&quot; link under &quot;macOS&quot; to download <code>love.app</code>.</li><li>Drag this file into the &quot;Applications&quot; directory.</li><li>Double-click <code>love.app</code> to launch the app. This will fail the first time with the message &quot;love.app cannot be opened because the developer cannot be verified&quot;. To fix this, open the Settings app, select &quot;Privacy &amp; Security&quot;, scroll down to &quot;love.app was blocked ...&quot; and click the &quot;Open Anyway&quot; button.</li></ul><p>TODO: Does Love2D include its own version of Lua TODO: and ignore the installed version?</p><p>To get started creating a game:</p><ul><li>Create a directory for a new game.</li><li>Create a file in this directory named &quot;main.lua&quot;.</li></ul><p>If using VS Code:</p><ul><li>Install the extension &quot;Love2D Support&quot; from Pixelbyte Studios.</li><li>Click the gear icon and select &quot;Extension Settings&quot;.</li><li>Change &quot;Pixelbyte &gt; love2d: Path&quot; to &quot;/Applications/love.app/Contents/MacOS/love&quot;.</li><li>Open a <code>main.lua</code> file in an editor tab.</li><li>Press cmd-l to run the game.</li></ul><p>Love2D programs always define the functions <code>love.load()</code>, <code>love.draw()</code>, and <code>love.update(dt)</code>. The <code>love.load()</code> function performs initial game setup. The <code>love.draw()</code> function specifies what should be drawn on the screen at any point in time. The <code>love.update(dt)</code> function implements the game logic.</p><p>The parameter <code>dt</code> in the <code>love.update</code> function is short for &quot;delta time&quot;. This is used to make game updates frame rate independent. It is a floating point number that indicates the number of seconds requires to display each frame. This value can vary among devices. For example, when <code>dt</code> is <code>0.1</code>, the device displays 10 frames per second.</p><p>To configure a game, add a <code>conf.lua</code> file to your game project directory. For example:</p><pre class="language-lua"><code class="language-lua"><span class="token keyword">function</span> love<span class="token punctuation">.</span><span class="token function">conf</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><br>  t<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">"My Game"</span><br>  t<span class="token punctuation">.</span>version <span class="token operator">=</span> <span class="token string">"1.2.3"</span><br>  t<span class="token punctuation">.</span>console <span class="token operator">=</span> <span class="token keyword">true</span><br>  t<span class="token punctuation">.</span>window<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">1280</span><br>  t<span class="token punctuation">.</span>window<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">720</span><br><span class="token keyword">end</span></code></pre><p>To run a game, use one of these approaches:</p><ul><li>Drag the game directory onto the Love application icon.</li><li>If VS Code has been configured property, press cmd-l.</li><li>TODO: What other options are available?</li></ul><p>When comparing the distance between two points to some value, compare the square of the distance. This removes the need to use the <code>math.sqrt</code> function which can hurt game performance.</p><p>TODO: See lua/love/love-game/main.lua.</p><h3 id="l%C3%B6vr" tabindex="-1">LÖVR</h3><p><a href="https://lovr.org?v=1.0.20" rel="noopener" target="_blank">LÖVR</a> is &quot;an open source framework for rapidly building immersive 3D experiences.&quot;</p><h2 id="unorganized-content" tabindex="-1">Unorganized Content</h2><p>summarize the constants and functions in all the standard libraries</p><p>does the: syntax for calling a function only work when the variable has a type that maps to a Standard Library like String and number and table and function?</p><p>How do you work with dates and times in Lua? Are there functions for formatting them?</p><p>Can precede function with local keyword to make it local to the current source file. Correct?</p><p>The ternary trick probably doesn’t work if the desired true value is false or nil.</p><p>Can assign a default value to a function parameter like this:</p><p>function foo(p1) p1 = p1 or default_value … end</p><p>Are there recommended Lua linters and code formatters that run outside of VS Code?</p><p>What is the difference between these? my_var = 1 — Is this only global within the current source file? _G.my_var = 1 — Does this make it accessible outside the current source file?</p><p>Functions can call themselves recursively.</p><p>Did you describe the fact that there is no compact syntax for defining them?</p><p>Coroutine status values include running, suspended, normal, and dead (computed or stopped due to error). coroutine.resume(my_coroutine) — starts or resumes a coroutine</p><p>Can a Lua program create multiple threads that run concurrently? What happens if you call coroutine.resume on a coroutine that has a status of dead?</p><p>The things in the standard library are “modules”, not “libraries”. io.read(…) returns nil if there is no more file content to read. There are addition file mode values that include “b” to work with binary files.</p><p>There are probably many variable assignments in the examples here that should be preceded by <code>local</code>.</p><p>OO-like objects hold their properties and methods in a table. Does each object get its own copy of every method?</p><p>you can use the or operator to avoid setting instance values to know when they are missing in the passed table. but beware of cases where are the table passed in contains false values because those will not be used if you simply check with the or operator.</p><p>this video suggest multiple ways to handle this: <a href="https://youtu.be/IQf82d3cr20">https://youtu.be/IQf82d3cr20</a></p><p>In the table section, describe copying tables like the following. Is there a way to make a deep copy? Maybe something recursive?</p><pre class="language-lua"><code class="language-lua">t <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"alpha"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"beta"</span><span class="token punctuation">,</span> <span class="token string">"gamma"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><br><span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token keyword">do</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br><span class="token comment">-- This makes a shallow copy.</span><br>copy <span class="token operator">=</span> <span class="token punctuation">{</span>table<span class="token punctuation">.</span><span class="token function">unpack</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">}</span><br><span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>copy<span class="token punctuation">)</span> <span class="token keyword">do</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br><span class="token comment">-- This wraps the approach above in a function.</span><br><span class="token keyword">function</span> table<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><br>  <span class="token keyword">return</span> <span class="token punctuation">{</span>table<span class="token punctuation">.</span><span class="token function">unpack</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">}</span><br><span class="token keyword">end</span><br>copy2 <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><br><span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token function">pairs</span><span class="token punctuation">(</span>copy2<span class="token punctuation">)</span> <span class="token keyword">do</span><br>  <span class="token function">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><br><span class="token keyword">end</span></code></pre><p>Reorder some of the sections above so no section relies on information found in a section that follows it (if possible).</p></article>