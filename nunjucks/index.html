<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Nunjucks</h2><aside><nav class="toc"><ol><li><a href="#vs-code-extensions">VS Code extensions</a></li><li><a href="#configuration">Configuration</a></li><li><a href="#data-types">Data types</a></li><li><a href="#operators">Operators</a></li><li><a href="#comments">Comments</a></li><li><a href="#variables">Variables</a></li><li><a href="#rendering">Rendering</a></li><li><a href="#filters">Filters</a></li><li><a href="#conditional-logic">Conditional logic</a></li><li><a href="#iteration">Iteration</a></li><li><a href="#function-calls">Function calls</a></li><li><a href="#regular-expressions">Regular expressions</a></li><li><a href="#sanitizing">Sanitizing</a></li><li><a href="#includes">Includes</a></li><li><a href="#macros">Macros</a></li><li><a href="#template-inheritance">Template inheritance</a></li><li><a href="#whitespace">Whitespace</a></li><li><a href="#global-functions">Global functions</a></li><li><a href="#documenting-nunjucks-syntax">Documenting Nunjucks syntax</a></li></ol></nav></aside><article><p><a href="https://mozilla.github.io/nunjucks/">Nunjucks</a> is a template language implemented in JavaScript. It supports features seen in most programming languages.</p><h2 id="vs-code-extensions" tabindex="-1">VS Code extensions</h2><p>The VS Code extension &quot;Nunjucks&quot; (ronnidc.nunjucks) applies syntax highlighting in <code>.njk</code> files.</p><p>The VS Code extension &quot;Nunjucks Snippets&quot; (luwenjiechn.nunjucks-vscode-snippets) defines Nunjucks snippets to simplifying writing Nunjucks constructs in <code>.njk</code> files.</p><h2 id="configuration" tabindex="-1">Configuration</h2><p>TODO: Cover other nunjucks-specific configuration.</p><h2 id="data-types" tabindex="-1">Data types</h2><p>Nunjucks essentially supports the same data types as JavaScript. These include:</p><ul><li>Boolean: true, false</li><li>Numbers: 2, 3.4</li><li>Strings: &quot;in double-quotes&quot;, 'in single-quotes'</li><li>Arrays: [true, 2, 'test']</li><li>Dicts: { key1: true, key2: 'text' }</li></ul><h2 id="operators" tabindex="-1">Operators</h2><p>Nunjucks supports these mathematical operators:</p><ul><li>+, -, *, /</li><li>// (integer division)</li><li>% (modulo)</li><li>** (exponentiation)</li></ul><p>Nunjucks supports these comparison operators from JavaScript:</p><ul><li>==, ===</li><li>!=, !==</li><li>&lt;, &lt;=, &gt;=, &gt;</li></ul><p>Nunjucks supports these logical operators:</p><ul><li>and, or, not</li><li>parentheses to group expressions</li></ul><h2 id="comments" tabindex="-1">Comments</h2><p>The syntax for comments is:</p><pre class="language-liquid"><code class="language-liquid">{# some comment #}</code></pre><h2 id="variables" tabindex="-1">Variables</h2><p>To define or modify a variable:</p><pre class="language-liquid"><code class="language-liquid"><span class="token liquid language-liquid"><span class="token delimiter punctuation">{%</span> set name <span class="token operator">=</span> value <span class="token delimiter punctuation">%}</span></span></code></pre><p>Variables defined at the top-level are global. Otherwise they are scoped to the construct in which they are defined.</p><h2 id="rendering" tabindex="-1">Rendering</h2><p>To render an expression, enclose it in double-curly braces. For example:</p><pre class="language-liquid"><code class="language-liquid"><span class="token liquid language-liquid"><span class="token delimiter punctuation">{{</span> dog<span class="token punctuation">.</span>name <span class="token delimiter punctuation">}}</span></span></code></pre><h2 id="filters" tabindex="-1">Filters</h2><p>Nunjucks can render the result of passing a value through a filter. There are many provided filters and custom filters can be implemented. The provided filters are documented at <a href="https://mozilla.github.io/nunjucks/templating.html#built-in-filters">Builtin Filters</a>. They include <code>abs</code>, <code>batch</code>, <code>capitalize</code>, <code>center</code>, <code>default</code>, <code>dictsort</code>, <code>dump</code>, <code>escape</code>, <code>first</code>, <code>float</code>, <code>forceescape</code>, <code>groupby</code>, <code>indent</code>, <code>int</code>, <code>join</code>, <code>last</code>, <code>length</code>, <code>list</code>, <code>lower</code>, <code>nl2br</code>, <code>random</code>, <code>rejectattr</code>, <code>replace</code>, <code>reverse</code>, <code>round</code>, <code>safe</code>, <code>selectattr</code>, <code>slice</code>, <code>sort</code>, <code>string</code>, <code>striptags</code>, <code>sum</code>, <code>title</code>, <code>trim</code>, <code>truncate</code>, <code>upper</code>, <code>urlencode</code>, <code>urlize</code>, and <code>wordcount</code>.</p><p>There are too many to describe, but here are some highlights:</p><ul><li><p><code>dump</code> calls <code>JSON.stringify</code> on a value and is useful for debugging.</p></li><li><p><code>first</code> returns the first element of an array or the first character of a string.</p></li><li><p><code>last</code> returns the last element of an array or the last character of a string.</p></li><li><p><code>groupby</code> creates an array of arrays of objects from an array of objects based on a common property value.</p></li><li><p><code>join</code> concatenates an array of values, separated by a delimiter</p></li><li><p><code>nl2br</code> replaces newline characters with HTML <code>&lt;br /&gt;</code> elements</p></li><li><p><code>random</code> returns a random element from an array</p></li><li><p><code>rejectattr</code> filters an array of objects, rejecting those where a given property passes a test</p></li><li><p><code>selectattr</code> filters an array of objects, keeping those where a given property passes a test</p></li><li><p><code>sort</code> sorts an array. It is called as a function with three arguments. The first is a boolean indicating whether the sort should be in reverse order. The second is a boolean indicating whether the sort should be case insensitive. The third is the string name of the property on which the objects should be sorted. For example, <code>{% for team in hockey | sort(false, false, 'city') %}</code> .</p></li><li><p><code>urlencode</code> encodes a URL using UTF-8.</p></li><li><p><code>urlize</code> turns URLs in a string into links. The string can contain any number of URLs. The result must be passed to the <code>safe</code> filter. Otherwise the resulting HTML is escaped and presented as plain text. For example,</p><pre class="language-liquid"><code class="language-liquid"><span class="token liquid language-liquid"><span class="token delimiter punctuation">{{</span> <span class="token string">'before http://foo.bar after'</span> <span class="token operator">|</span> <span class="token function filter">urlize</span> <span class="token operator">|</span> <span class="token function filter">safe</span> <span class="token delimiter punctuation">}}</span></span></code></pre><p>renders <code>before &lt;a href=&quot;http://foo.bar&quot;&gt;http://foo.bar&lt;/a&gt; after</code>.</p></li></ul><p>Here is an example of applying the <code>upper</code> filter to a string:</p><pre class="language-liquid"><code class="language-liquid"><span class="token liquid language-liquid"><span class="token delimiter punctuation">{{</span> dog<span class="token punctuation">.</span>name <span class="token operator">|</span> <span class="token function filter">upper</span> <span class="token delimiter punctuation">}}</span></span></code></pre><p>Another syntax is available for applying a filter to a large amount of content. For example:</p><pre class="language-liquid"><code class="language-liquid"><span class="token liquid language-liquid"><span class="token delimiter punctuation">{%</span> <span class="token object">filter</span> upper <span class="token delimiter punctuation">%}</span></span><br>  Mark is a software engineer at Object Computing, Inc.<br><span class="token liquid language-liquid"><span class="token delimiter punctuation">{%</span> endfilter <span class="token delimiter punctuation">%}</span></span></code></pre><p>This form can only contain literal content, not other Nunjucks constructs.</p><p>Nunjucks also supports defining custom filters. When using 11ty, they can be defined in the <code>.eleventy.js</code>. For example, this filter writes the value of an expression to the devtools console.</p><pre class="language-js"><code class="language-js">eleventyConfig<span class="token punctuation">.</span><span class="token function">addFilter</span><span class="token punctuation">(</span><span class="token string">'log'</span><span class="token punctuation">,</span> console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>This filter will be added to 11ty in version 11.</p><h2 id="conditional-logic" tabindex="-1">Conditional logic</h2><p>Content can be conditionally included using an <code>if</code> statement. For example:</p><pre class="language-liquid"><code class="language-liquid"><span class="token liquid language-liquid"><span class="token delimiter punctuation">{%</span> <span class="token keyword">if</span> <span class="token object">color</span> <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">'yellow'</span> <span class="token delimiter punctuation">%}</span></span><br>  sunny<br><span class="token liquid language-liquid"><span class="token delimiter punctuation">{%</span> elif <span class="token object">color</span> <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">'blue'</span> <span class="token delimiter punctuation">%}</span></span><br>  rainy<br><span class="token liquid language-liquid"><span class="token delimiter punctuation">{%</span> <span class="token keyword">else</span> <span class="token delimiter punctuation">%}</span></span><br>  unknown<br><span class="token liquid language-liquid"><span class="token delimiter punctuation">{%</span> <span class="token keyword">endif</span> <span class="token delimiter punctuation">%}</span></span></code></pre><p>Nunjucks supports using and <code>if</code> for an odd kind of ternary operator. For example, this outputs &quot;yellow&quot; if <code>happy</code> is true.</p><pre class="language-liquid"><code class="language-liquid"><span class="token liquid language-liquid"><span class="token delimiter punctuation">{{</span> <span class="token string">"yellow"</span> <span class="token keyword">if</span> happy <span class="token delimiter punctuation">}}</span></span></code></pre><p>This is similar, but outputs &quot;gray&quot; if <code>happy</code> is false.</p><pre class="language-liquid"><code class="language-liquid"><span class="token liquid language-liquid"><span class="token delimiter punctuation">{{</span> <span class="token string">"yellow"</span> <span class="token keyword">if</span> happy <span class="token keyword">else</span> <span class="token string">"gray"</span> <span class="token delimiter punctuation">}}</span></span></code></pre><h2 id="iteration" tabindex="-1">Iteration</h2><p>A <code>for</code> loop iterates over the elements of an array or the properties of an object and renders content for each element. An optional <code>else</code> block specifies content to render if the array is empty.</p><p>If the variable <code>dogs</code> holds an array of objects, we can iterate over the array as follows:</p><pre class="language-liquid"><code class="language-liquid"><span class="token liquid language-liquid"><span class="token delimiter punctuation">{%</span> <span class="token keyword">for</span> dog <span class="token keyword">in</span> dogs <span class="token delimiter punctuation">%}</span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token liquid language-liquid"><span class="token delimiter punctuation">{{</span> dog<span class="token punctuation">.</span>name <span class="token delimiter punctuation">}}</span></span> is a <span class="token liquid language-liquid"><span class="token delimiter punctuation">{{</span> dog<span class="token punctuation">.</span>breed <span class="token delimiter punctuation">}}</span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><br><span class="token liquid language-liquid"><span class="token delimiter punctuation">{%</span> <span class="token keyword">else</span> <span class="token delimiter punctuation">%}</span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Who let the dogs out?<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><br><span class="token liquid language-liquid"><span class="token delimiter punctuation">{%</span> <span class="token keyword">endfor</span> <span class="token delimiter punctuation">%}</span></span></code></pre><p>The current loop index is available in <code>loop.index</code> (starts from 1) and <code>loop.index0</code> (starts from 0).</p><p>If the variable <code>dog</code> holds an object, we can iterate over its properties as follows:</p><pre class="language-liquid"><code class="language-liquid"><span class="token liquid language-liquid"><span class="token delimiter punctuation">{%</span> <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> dog <span class="token delimiter punctuation">%}</span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token liquid language-liquid"><span class="token delimiter punctuation">{{</span>key<span class="token delimiter punctuation">}}</span></span> = <span class="token liquid language-liquid"><span class="token delimiter punctuation">{{</span>value<span class="token delimiter punctuation">}}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><br><span class="token liquid language-liquid"><span class="token delimiter punctuation">{%</span> <span class="token keyword">endfor</span> <span class="token delimiter punctuation">%}</span></span></code></pre><p>There is also support for asynchronous versions of this (<code>asyncEach</code> and <code>asyncAll</code>) that most sites will not need. It is documented at <a href="https://mozilla.github.io/nunjucks/api.html#asynchronous-support">Asynchronous Support</a>.</p><h2 id="function-calls" tabindex="-1">Function calls</h2><p>JavaScript functions can be called using the same syntax as JavaScript. For example, this calls a function and renders its result:</p><pre class="language-liquid"><code class="language-liquid"><span class="token liquid language-liquid"><span class="token delimiter punctuation">{{</span> someFunction<span class="token punctuation">(</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span> <span class="token delimiter punctuation">}}</span></span></code></pre><p>This calls a function and assigns its result to a variable:</p><pre class="language-liquid"><code class="language-liquid">{% set name = someFunction(arg1, arg2) }}</code></pre><h2 id="regular-expressions" tabindex="-1">Regular expressions</h2><p>Regular expressions are defined by beginning with <code>r/</code>. For example:</p><pre class="language-liquid"><code class="language-liquid"><span class="token liquid language-liquid"><span class="token delimiter punctuation">{%</span> set re <span class="token operator">=</span> r/^a<span class="token punctuation">.</span>*z$/i <span class="token delimiter punctuation">%}</span></span><br><span class="token liquid language-liquid"><span class="token delimiter punctuation">{%</span> <span class="token keyword">if</span> re<span class="token punctuation">.</span>test<span class="token punctuation">(</span>dog<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token delimiter punctuation">%}</span></span><br>  This dog goes from a to z!<br><span class="token liquid language-liquid"><span class="token delimiter punctuation">{%</span> <span class="token keyword">endif</span> <span class="token delimiter punctuation">%}</span></span></code></pre><p>The <code>i</code> option at the end of the regular expression signifies case-insensitive matching.</p><h2 id="sanitizing" tabindex="-1">Sanitizing</h2><p>When rendering HTML from a potentially untrusted source, use the <code>safe</code> filter to sanitize it. For example:</p><pre class="language-liquid"><code class="language-liquid"><span class="token liquid language-liquid"><span class="token delimiter punctuation">{{</span> someHtml <span class="token operator">|</span> <span class="token function filter">safe</span> <span class="token delimiter punctuation">}}</span></span></code></pre><h2 id="includes" tabindex="-1">Includes</h2><p>One template can include another. This allows a template to be reused in many places. For example:</p><pre class="language-liquid"><code class="language-liquid"><span class="token liquid language-liquid"><span class="token delimiter punctuation">{%</span> <span class="token keyword">include</span> <span class="token string">"snippet.html"</span> <span class="token delimiter punctuation">%}</span></span></code></pre><p>This is useful when the content to be included doesn't require any data to be supplied. When data is required, consider using Nunjucks macros which are described next.</p><h2 id="macros" tabindex="-1">Macros</h2><p>Macros are like functions that have parameters and render something based on those. Parameters can have default values that are used when a value is not provided. For example:</p><pre class="language-liquid"><code class="language-liquid"><span class="token liquid language-liquid"><span class="token delimiter punctuation">{%</span> macro dogP<span class="token punctuation">(</span>name<span class="token punctuation">,</span> breed<span class="token punctuation">,</span> gender<span class="token operator">=</span><span class="token string">'unknown'</span><span class="token punctuation">)</span> <span class="token delimiter punctuation">%}</span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token liquid language-liquid"><span class="token delimiter punctuation">{{</span>name<span class="token delimiter punctuation">}}</span></span> is a <span class="token liquid language-liquid"><span class="token delimiter punctuation">{{</span>gender<span class="token delimiter punctuation">}}</span></span> <span class="token liquid language-liquid"><span class="token delimiter punctuation">{{</span>breed<span class="token delimiter punctuation">}}</span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><br><span class="token liquid language-liquid"><span class="token delimiter punctuation">{%</span> endmacro <span class="token delimiter punctuation">%}</span></span></code></pre><p>A macro call looks like a function call. For example:</p><pre class="language-liquid"><code class="language-liquid"><span class="token liquid language-liquid"><span class="token delimiter punctuation">{%</span> <span class="token keyword">for</span> dog <span class="token keyword">in</span> collections<span class="token punctuation">.</span>dogsByName <span class="token delimiter punctuation">%}</span></span><br>  <span class="token liquid language-liquid"><span class="token delimiter punctuation">{{</span> dogP<span class="token punctuation">(</span>dog<span class="token punctuation">.</span>data<span class="token punctuation">.</span>name<span class="token punctuation">,</span> dog<span class="token punctuation">.</span>data<span class="token punctuation">.</span>breed<span class="token punctuation">,</span> dog<span class="token punctuation">.</span>data<span class="token punctuation">.</span>gender<span class="token punctuation">)</span> <span class="token delimiter punctuation">}}</span></span><br><span class="token liquid language-liquid"><span class="token delimiter punctuation">{%</span> <span class="token keyword">endfor</span> <span class="token delimiter punctuation">%}</span></span></code></pre><p>Arguments can be specified positionally or by name. The previous example used positional arguments. The next example uses named arguments.</p><pre class="language-liquid"><code class="language-liquid"><span class="token liquid language-liquid"><span class="token delimiter punctuation">{%</span> <span class="token keyword">for</span> dog <span class="token keyword">in</span> collections<span class="token punctuation">.</span>dogsByName <span class="token delimiter punctuation">%}</span></span><br>  <span class="token liquid language-liquid"><span class="token delimiter punctuation">{{</span> dogP<span class="token punctuation">(</span>gender<span class="token operator">=</span>dog<span class="token punctuation">.</span>data<span class="token punctuation">.</span>gender<span class="token punctuation">,</span> breed<span class="token operator">=</span>dog<span class="token punctuation">.</span>data<span class="token punctuation">.</span>breed<span class="token punctuation">,</span> name<span class="token operator">=</span>dog<span class="token punctuation">.</span>data<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token delimiter punctuation">}}</span></span><br><span class="token liquid language-liquid"><span class="token delimiter punctuation">{%</span> <span class="token keyword">endfor</span> <span class="token delimiter punctuation">%}</span></span></code></pre><p>Macros can be defined in a <code>.njk</code> file and imported where needed. For example, the following imports the file <code>_includes/macros.njk</code>:</p><pre class="language-liquid"><code class="language-liquid"><span class="token liquid language-liquid"><span class="token delimiter punctuation">{%</span> import <span class="token string">'macros.njk'</span> <span class="token keyword">as</span> macros <span class="token keyword">with</span> context <span class="token delimiter punctuation">%}</span></span></code></pre><p>To call a macro named &quot;demo&quot; that is defined in <code>macros.njk</code>,</p><pre class="language-liquid"><code class="language-liquid"><span class="token liquid language-liquid"><span class="token delimiter punctuation">{{</span> macros<span class="token punctuation">.</span>demo<span class="token punctuation">(</span>arguments<span class="token punctuation">)</span> <span class="token delimiter punctuation">}}</span></span></code></pre><p>For an example of using this approach, see how <code>_includes/layout.njk</code> uses macros to render the left nav.</p><p>A <code>call</code> block enables passing enclosed text to a macro.</p><p>TODO: Maybe Nunjucks macros can be used as an alternative to 11ty shortcodes.</p><h2 id="template-inheritance" tabindex="-1">Template inheritance</h2><p>Blocks define named locations in a template where content can be inserted. They can contain default content that a using template can override.</p><p>The <code>extends</code> tag inherits another template. This is followed by <code>block</code> tags that supply content to be inserted.</p><p>The <code>super</code> function is used in conjunction with template inheritance to render the contents of a parent block.</p><p>For more detail, see <a href="https://mozilla.github.io/nunjucks/templating.html#template-inheritance">Template Inheritance</a>.</p><h2 id="whitespace" tabindex="-1">Whitespace</h2><p>By default all whitespace is retained. To trim whitespace before a construct, begin with <code>{%-</code> instead of <code>{%</code>. To trim whitespace after a construct, end with <code>-%}</code> instead of <code>%}</code>. Zach Leatherman recommends only using <code>{%-</code>.</p><h2 id="global-functions" tabindex="-1">Global functions</h2><p>Nunjucks provides some predefined functions that address common needs.</p><ul><li><code>range</code> is used to iterate over a range of integer values.</li><li><code>cycler</code> rotates through a set of values.</li><li><code>joiner</code> returns a function that outputs a given string each time it is called except for the first.</li></ul><h2 id="documenting-nunjucks-syntax" tabindex="-1">Documenting Nunjucks syntax</h2><p>To escape Nunjucks syntax so it is rendered as-is instead of being evaluated, wrap it in a <code>raw</code> block. It may also be desirable to wrap the text in a Markdown fenced block. There is no support for Nunjucks syntax, but Liquid syntax is close enough. In the example below, the apostrophe characters should really be backticks.</p><pre class="language-liquid"><code class="language-liquid"><span class="token liquid language-liquid"><span class="token delimiter punctuation">{%</span> <span class="token keyword">raw</span> <span class="token delimiter punctuation">%}</span></span><br>'''liquid<br>Some Nunjucks syntax goes here.<br>'''<br><span class="token liquid language-liquid"><span class="token delimiter punctuation">{%</span> <span class="token keyword">endraw</span> <span class="token delimiter punctuation">%}</span></span><br></code></pre><p><code>verbatim</code> is an alias for <code>raw</code>.</p></article>