<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>UIKit</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#uiview">UIView</a></li><li><a href="#relationship-to-swiftui">Relationship to SwiftUI</a></li><li><a href="#uiviewrepresentable">UIViewRepresentable</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p>TODO: Add detail here. The <a href="https://developer.apple.com/documentation/uikit?v=1.0.20" rel="noopener" target="_blank">UIKit</a> framework predates SwiftUI which is now the preferred framework for building iOS, watchOS, macOS, and tvOS apps.</p><p>UIKIt has features not present in SwiftUI. When those features are needed, UIKit views can be used inside a SwiftUI app. This is accomplished by wrapping a UIKit view in a struct that conforms to the <a href="https://developer.apple.com/documentation/swiftui/uiviewrepresentable?v=1.0.20" rel="noopener" target="_blank">UIViewRepresentable</a> protocol. This is explained in the <a href="#uiviewrepresentable">UIViewRepresentable</a> section below.</p><h2 id="uiview" tabindex="-1">UIView</h2><p>All views in the UIKit framework are classes that inherit from the <a href="https://developer.apple.com/documentation/uikit/uiview?v=1.0.20" rel="noopener" target="_blank">UIView</a> class, either directly or indirectly. For example, the <a href="https://developer.apple.com/documentation/uikit/uibutton?v=1.0.20" rel="noopener" target="_blank">UIButton</a> class inherits from <a href="https://developer.apple.com/documentation/uikit/uicontrol?v=1.0.20" rel="noopener" target="_blank">UIControl</a> class which inherits from <code>UIView</code> class.</p><p>UIKit views typically have properties that are set after an instance is created. The following code creates a <a href="https://developer.apple.com/documentation/uikit/uilabel?v=1.0.20" rel="noopener" target="_blank">UILabel</a> and sets some of its properties.</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">let</span> label <span class="token operator">=</span> <span class="token class-name">UILabel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>label<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token class-name">UIFont</span><span class="token punctuation">.</span><span class="token function">systemFont</span><span class="token punctuation">(</span>ofSize<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">)</span><br>label<span class="token punctuation">.</span>textColor <span class="token operator">=</span> <span class="token punctuation">.</span>red<br>label<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Hello, World!"</span></span></code></pre><p>UIKit views that need to report on changes or user interactions do so using a &quot;delegate&quot;. This is an object that conforms to a specific protocol and is assigned to a <code>UIView</code> instance.</p><h2 id="relationship-to-swiftui" tabindex="-1">Relationship to SwiftUI</h2><p>The table below identifies the SwiftUI views that correspond to UIKit concepts:</p><table><thead><tr><th>UIKit</th><th>SwiftUI</th></tr></thead><tbody><tr><td><code>NSAttributedString</code></td><td><code>Text</code> with <code>AttributedString</code></td></tr><tr><td><code>UIActivityIndicatorView</code></td><td><code>ProgressView without a value</code></td></tr><tr><td><code>UIAlertController</code> with style <code>.actionsheet</code></td><td><code>ActionSheet</code></td></tr><tr><td><code>UIAlertController</code> with style <code>.alert</code></td><td><code>Alert</code></td></tr><tr><td><code>UIButton</code></td><td><code>Button</code></td></tr><tr><td><code>UICollectionView</code></td><td><code>LazyVGrid and LazyHGrid</code></td></tr><tr><td><code>UIDatePicker</code></td><td><code>DatePicker</code></td></tr><tr><td><code>UIImageView</code></td><td><code>Image</code></td></tr><tr><td><code>UILabel</code></td><td><code>Text</code></td></tr><tr><td><code>UINavigationController</code></td><td><code>NavigationView</code></td></tr><tr><td><code>UIProgressView</code></td><td><code>ProgressView with a value</code></td></tr><tr><td><code>UISegmentedControl</code></td><td><code>Picker</code></td></tr><tr><td><code>UISlider</code></td><td><code>Slider</code></td></tr><tr><td><code>UIStackView</code> with horizontal axis</td><td><code>HStack</code></td></tr><tr><td><code>UIStackView</code> with vertical axis</td><td><code>VStack</code></td></tr><tr><td><code>UIStepper</code></td><td><code>Stepper</code></td></tr><tr><td><code>UISwitch</code></td><td><code>Toggle</code></td></tr><tr><td><code>UITableView</code></td><td><code>List</code></td></tr><tr><td><code>UITextField</code></td><td><code>TextField</code></td></tr><tr><td><code>UITextField</code> with <code>isSecureTextEntry</code> true</td><td><code>SecureField</code></td></tr><tr><td><code>UITextView</code></td><td><code>TextEditor</code> for plain strings</td></tr></tbody></table><p>It is possible to use UIKit components in a SwiftUI app by wrapping them in a struct that conforms to the <a href="https://developer.apple.com/documentation/swiftui/uiviewrepresentable?v=1.0.20" rel="noopener" target="_blank">UIViewRepresentable</a> protocol. However, there is enough functionality in SwiftUI that this is typically not necessary.</p><h2 id="uiviewrepresentable" tabindex="-1">UIViewRepresentable</h2><p>There is no need to wrap a <code>UILabel</code> in a <code>UIViewRepresentable</code> because SwiftUI provides the <code>Text</code> view which can be used instead. However, doing so provides a simple example of using <code>UIViewRepresentable</code> and this is demonstrated in the following code.</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">SwiftUI</span><br><span class="token keyword">import</span> <span class="token class-name">UIKit</span><br><br><span class="token keyword">struct</span> <span class="token class-name">MyLabel</span><span class="token punctuation">:</span> <span class="token class-name">UIViewRepresentable</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> text<span class="token punctuation">:</span> <span class="token class-name">String</span><br><br>    <span class="token comment">// Creates a kind of UIView and configures its initial state.</span><br>    <span class="token keyword">func</span> <span class="token function-definition function">makeUIView</span><span class="token punctuation">(</span>context<span class="token punctuation">:</span> <span class="token class-name">Context</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">UILabel</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> label <span class="token operator">=</span> <span class="token class-name">UILabel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        label<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token class-name">UIFont</span><span class="token punctuation">.</span><span class="token function">systemFont</span><span class="token punctuation">(</span>ofSize<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">)</span><br>        label<span class="token punctuation">.</span>textColor <span class="token operator">=</span> <span class="token punctuation">.</span>red<br>        <span class="token comment">// There is no need to set the `text` property here</span><br>        <span class="token comment">// because `updateUIView` will do it.</span><br><br>        <span class="token comment">// This sets the priority with which a view resists</span><br>        <span class="token comment">// being made larger than its intrinsic size.</span><br>        <span class="token comment">// The UILabel will be the minimum size required to fit the text.</span><br>        label<span class="token punctuation">.</span><span class="token function">setContentHuggingPriority</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token keyword">required</span><span class="token punctuation">,</span> <span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>horizontal<span class="token punctuation">)</span><br>        label<span class="token punctuation">.</span><span class="token function">setContentHuggingPriority</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token keyword">required</span><span class="token punctuation">,</span> <span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>vertical<span class="token punctuation">)</span><br><br>        <span class="token keyword">return</span> label<br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// Updates the state of the UIView created in `makeUIView`</span><br>    <span class="token comment">// with new data provided by a SwiftUI View.</span><br>    <span class="token comment">// This called after makeUIView and again every time a parameter changes.</span><br>    <span class="token keyword">func</span> <span class="token function-definition function">updateUIView</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> uiView<span class="token punctuation">:</span> <span class="token class-name">UILabel</span><span class="token punctuation">,</span> context<span class="token punctuation">:</span> <span class="token class-name">Context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        uiView<span class="token punctuation">.</span>text <span class="token operator">=</span> text<br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>The struct above can be used in SwiftUI as follows:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">ContentView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> labelText <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"First"</span></span><br><br>    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>        <span class="token class-name">VStack</span> <span class="token punctuation">{</span><br>            <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Toggle Label Text"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                labelText <span class="token operator">=</span> labelText <span class="token operator">==</span> <span class="token string-literal"><span class="token string">"First"</span></span> <span class="token operator">?</span> <span class="token string-literal"><span class="token string">"Second"</span></span> <span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"First"</span></span><br>            <span class="token punctuation">}</span><br>            <span class="token class-name">MyLabel</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> labelText<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>In example above, SwiftUI sends data to the <code>UIViewRepresentable</code> using the <code>text</code> parameter, but no data comes back.</p><p>Let's look at an example where data also needs to come back. There are many approaches for doing this. One approach is to pass a binding to the <code>UIViewRepresentable</code> subtype that it can update. Changing the binding will cause the view that owns the binding to update.</p><p>The following code demonstrates this approach.</p><pre class="language-swift"><code class="language-swift"><span class="token constant">TODO</span><span class="token punctuation">:</span> <span class="token class-name">Add</span> <span class="token class-name">MapView</span> example <span class="token keyword">where</span> a starting location <span class="token keyword">is</span> passed <span class="token keyword">in</span><br><span class="token constant">TODO</span><span class="token punctuation">:</span> and the current map center <span class="token keyword">is</span> passed back when the user pans the map<span class="token punctuation">.</span></code></pre><p>Another approach for updating a view based on changes in a <code>UIViewRepresentable</code> subtype is to store the changeable data in a view model The following code demonstrates this approach. It renders a map using the UIKit <code>MKMapView</code> class. Initially the map is centered on Apple Park. Tapping the &quot;Current Location&quot; button uses Core Location to get the current device location and centers the map there. The user can drag the map to a new location. The latitude and longitude of the map center is displayed above the map and updates during dragging. The user can re-center the map on the device location by tapping the &quot;Reset&quot; button.</p><pre class="language-swift"><code class="language-swift"><span class="token comment">// ContentView.swift</span><br><span class="token keyword">import</span> <span class="token class-name">CoreLocation</span><br><span class="token keyword">import</span> <span class="token class-name">CoreLocationUI</span><br><span class="token keyword">import</span> <span class="token class-name">MapKit</span><br><span class="token keyword">import</span> <span class="token class-name">SwiftUI</span><br><br><span class="token keyword">struct</span> <span class="token class-name">ContentView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>    <span class="token attribute atrule">@StateObject</span> <span class="token keyword">private</span> <span class="token keyword">var</span> locationManager <span class="token operator">=</span> <span class="token class-name">LocationManager</span><span class="token punctuation">.</span>shared<br><br>    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>        <span class="token class-name">VStack</span> <span class="token punctuation">{</span><br>            <span class="token keyword">if</span> locationManager<span class="token punctuation">.</span>userLocation <span class="token operator">==</span> <span class="token nil constant">nil</span> <span class="token punctuation">{</span><br>                <span class="token comment">// Tap this to get the device location and pan the map to it.</span><br>                <span class="token class-name">LocationButton</span> <span class="token punctuation">{</span><br>                    locationManager<span class="token punctuation">.</span><span class="token function">requestLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>                <span class="token punctuation">}</span><br>                <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span><span class="token punctuation">.</span>white<span class="token punctuation">)</span> <span class="token comment">// defaults to black</span><br>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>                <span class="token comment">// Tap this to reset the map to the device location.</span><br>                <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Reset"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                    locationManager<span class="token punctuation">.</span><span class="token function">panToDeviceLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>                <span class="token punctuation">}</span><br>                <span class="token punctuation">.</span><span class="token function">buttonStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>bordered<span class="token punctuation">)</span><br>            <span class="token punctuation">}</span><br><br>            <span class="token comment">// This updates if the user drags the map.</span><br>            <span class="token keyword">if</span> <span class="token keyword">let</span> c <span class="token operator">=</span> locationManager<span class="token punctuation">.</span>mapCenter <span class="token punctuation">{</span><br>                <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Lat: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">c<span class="token punctuation">.</span>latitude</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">, Lng: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">c<span class="token punctuation">.</span>longitude</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span><br>            <span class="token punctuation">}</span><br><br>            <span class="token class-name">MapView</span><span class="token punctuation">(</span>initialCenter<span class="token punctuation">:</span> locationManager<span class="token punctuation">.</span>initialCenter<span class="token punctuation">)</span><br><br>            <span class="token class-name">Spacer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">struct</span> <span class="token class-name">ContentView_Previews</span><span class="token punctuation">:</span> <span class="token class-name">PreviewProvider</span> <span class="token punctuation">{</span><br>    <span class="token keyword">static</span> <span class="token keyword">var</span> previews<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>        <span class="token class-name">ContentView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><pre class="language-swift"><code class="language-swift"><span class="token comment">// LocationManager.swift</span><br><span class="token keyword">import</span> <span class="token class-name">CoreLocation</span><br><span class="token keyword">import</span> <span class="token class-name">SwiftUI</span><br><br><span class="token keyword">private</span> <span class="token keyword">let</span> appleParkLatitude <span class="token operator">=</span> <span class="token number">37.334_900</span><br><span class="token keyword">private</span> <span class="token keyword">let</span> appleParkLongitude <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">122.009_020</span><br><br><span class="token keyword">class</span> <span class="token class-name">LocationManager</span><span class="token punctuation">:</span> <span class="token class-name">NSObject</span><span class="token punctuation">,</span> <span class="token class-name">ObservableObject</span><span class="token punctuation">,</span> <span class="token class-name">CLLocationManagerDelegate</span> <span class="token punctuation">{</span><br>    <span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> error<span class="token punctuation">:</span> <span class="token class-name">Error</span><span class="token operator">?</span><br><br>    <span class="token comment">// This is the requested map center.</span><br>    <span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> initialCenter <span class="token operator">=</span> <span class="token class-name">CLLocationCoordinate2D</span><span class="token punctuation">(</span><br>        latitude<span class="token punctuation">:</span> appleParkLatitude<span class="token punctuation">,</span><br>        longitude<span class="token punctuation">:</span> appleParkLongitude<br>    <span class="token punctuation">)</span><br><br>    <span class="token comment">// This is the current map center which differs</span><br>    <span class="token comment">// from initialCenter if the user drags the map.</span><br>    <span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> mapCenter<span class="token punctuation">:</span> <span class="token class-name">CLLocationCoordinate2D</span><span class="token operator">?</span><br><br>    <span class="token comment">// This is the device location.</span><br>    <span class="token comment">// It is not updated if the device moves.</span><br>    <span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> userLocation<span class="token punctuation">:</span> <span class="token class-name">CLLocationCoordinate2D</span><span class="token operator">?</span><br><br>    <span class="token keyword">let</span> manager <span class="token operator">=</span> <span class="token class-name">CLLocationManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>    <span class="token keyword">static</span> <span class="token keyword">var</span> shared <span class="token operator">=</span> <span class="token class-name">LocationManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>    <span class="token keyword">override</span> <span class="token keyword">private</span> <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        manager<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// This is called when the device location is determined.</span><br>    <span class="token comment">// An attempt to determine the location is triggered by</span><br>    <span class="token comment">// the `requestLocation` method below.</span><br>    <span class="token keyword">func</span> <span class="token function-definition function">locationManager</span><span class="token punctuation">(</span><br>        <span class="token omit keyword">_</span> manager<span class="token punctuation">:</span> <span class="token class-name">CLLocationManager</span><span class="token punctuation">,</span><br>        didUpdateLocations locations<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">CLLocation</span><span class="token punctuation">]</span><br>    <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        userLocation <span class="token operator">=</span> locations<span class="token punctuation">.</span>first<span class="token operator">?</span><span class="token punctuation">.</span>coordinate<br>        initialCenter <span class="token operator">=</span> userLocation<span class="token operator">!</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// This is called if there is an error determining the device location.</span><br>    <span class="token keyword">func</span> <span class="token function-definition function">locationManager</span><span class="token punctuation">(</span><br>        <span class="token omit keyword">_</span> manager<span class="token punctuation">:</span> <span class="token class-name">CLLocationManager</span><span class="token punctuation">,</span><br>        didFailWithError error<span class="token punctuation">:</span> <span class="token class-name">Error</span><br>    <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"LocationManager error:"</span></span><span class="token punctuation">)</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span>error <span class="token operator">=</span> error<br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// This sets the map center to the device location.</span><br>    <span class="token keyword">func</span> <span class="token function-definition function">panToDeviceLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">guard</span> <span class="token keyword">let</span> userLocation <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span><br><br>        <span class="token comment">// Hack alert!</span><br>        <span class="token comment">// If the initial map center is already at the user location ...</span><br>        <span class="token keyword">if</span> initialCenter <span class="token operator">==</span> userLocation <span class="token punctuation">{</span><br>            <span class="token comment">// Change it slightly to try `MapView` to re-render.</span><br>            initialCenter<span class="token punctuation">.</span>longitude <span class="token operator">+=</span> <span class="token number">0.0000001</span><br>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>            <span class="token comment">// Go to the user location.</span><br>            initialCenter <span class="token operator">=</span> userLocation<br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// This is called by `ContentView`.</span><br>    <span class="token keyword">func</span> <span class="token function-definition function">requestLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        manager<span class="token punctuation">.</span><span class="token function">requestLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><pre class="language-swift"><code class="language-swift"><span class="token comment">// MapView.swift</span><br><span class="token keyword">import</span> <span class="token class-name">CoreLocation</span><br><span class="token keyword">import</span> <span class="token class-name">SwiftUI</span><br><br><span class="token keyword">private</span> <span class="token keyword">let</span> appleParkLatitude <span class="token operator">=</span> <span class="token number">37.334_900</span><br><span class="token keyword">private</span> <span class="token keyword">let</span> appleParkLongitude <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">122.009_020</span><br><br><span class="token keyword">class</span> <span class="token class-name">LocationManager</span><span class="token punctuation">:</span> <span class="token class-name">NSObject</span><span class="token punctuation">,</span> <span class="token class-name">ObservableObject</span><span class="token punctuation">,</span> <span class="token class-name">CLLocationManagerDelegate</span> <span class="token punctuation">{</span><br>    <span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> error<span class="token punctuation">:</span> <span class="token class-name">Error</span><span class="token operator">?</span><br><br>    <span class="token comment">// This is the requested map center.</span><br>    <span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> initialCenter <span class="token operator">=</span> <span class="token class-name">CLLocationCoordinate2D</span><span class="token punctuation">(</span><br>        latitude<span class="token punctuation">:</span> appleParkLatitude<span class="token punctuation">,</span><br>        longitude<span class="token punctuation">:</span> appleParkLongitude<br>    <span class="token punctuation">)</span><br><br>    <span class="token comment">// This is the current map center which differs</span><br>    <span class="token comment">// from initialCenter if the user drags the map.</span><br>    <span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> mapCenter<span class="token punctuation">:</span> <span class="token class-name">CLLocationCoordinate2D</span><span class="token operator">?</span><br><br>    <span class="token comment">// This is the device location.</span><br>    <span class="token comment">// It is not updated if the device moves.</span><br>    <span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> userLocation<span class="token punctuation">:</span> <span class="token class-name">CLLocationCoordinate2D</span><span class="token operator">?</span><br><br>    <span class="token keyword">let</span> manager <span class="token operator">=</span> <span class="token class-name">CLLocationManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>    <span class="token keyword">static</span> <span class="token keyword">var</span> shared <span class="token operator">=</span> <span class="token class-name">LocationManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>    <span class="token keyword">override</span> <span class="token keyword">private</span> <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        manager<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// This is called when the device location is determined.</span><br>    <span class="token comment">// An attempt to determine the location is triggered by</span><br>    <span class="token comment">// the `requestLocation` method below.</span><br>    <span class="token keyword">func</span> <span class="token function-definition function">locationManager</span><span class="token punctuation">(</span><br>        <span class="token omit keyword">_</span> manager<span class="token punctuation">:</span> <span class="token class-name">CLLocationManager</span><span class="token punctuation">,</span><br>        didUpdateLocations locations<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">CLLocation</span><span class="token punctuation">]</span><br>    <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        userLocation <span class="token operator">=</span> locations<span class="token punctuation">.</span>first<span class="token operator">?</span><span class="token punctuation">.</span>coordinate<br>        initialCenter <span class="token operator">=</span> userLocation<span class="token operator">!</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// This is called if there is an error determining the device location.</span><br>    <span class="token keyword">func</span> <span class="token function-definition function">locationManager</span><span class="token punctuation">(</span><br>        <span class="token omit keyword">_</span> manager<span class="token punctuation">:</span> <span class="token class-name">CLLocationManager</span><span class="token punctuation">,</span><br>        didFailWithError error<span class="token punctuation">:</span> <span class="token class-name">Error</span><br>    <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"LocationManager error:"</span></span><span class="token punctuation">)</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span>error <span class="token operator">=</span> error<br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// This sets the map center to the device location.</span><br>    <span class="token keyword">func</span> <span class="token function-definition function">panToDeviceLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">guard</span> <span class="token keyword">let</span> userLocation <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span><br><br>        <span class="token comment">// Hack alert!</span><br>        <span class="token comment">// If the initial map center is already at the user location ...</span><br>        <span class="token keyword">if</span> initialCenter <span class="token operator">==</span> userLocation <span class="token punctuation">{</span><br>            <span class="token comment">// Change it slightly to try `MapView` to re-render.</span><br>            initialCenter<span class="token punctuation">.</span>longitude <span class="token operator">+=</span> <span class="token number">0.0000001</span><br>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>            <span class="token comment">// Go to the user location.</span><br>            initialCenter <span class="token operator">=</span> userLocation<br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// This is called by `ContentView`.</span><br>    <span class="token keyword">func</span> <span class="token function-definition function">requestLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        manager<span class="token punctuation">.</span><span class="token function">requestLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><pre class="language-swift"><code class="language-swift"><span class="token comment">// CLLocationCoordinate2DExtension.swift</span><br><span class="token keyword">import</span> <span class="token class-name">MapKit</span><br><br><span class="token keyword">extension</span> <span class="token class-name">CLLocationCoordinate2D</span><span class="token punctuation">:</span> <span class="token class-name">Equatable</span> <span class="token punctuation">{</span><br>    <span class="token comment">// This is need in order to compare instances of this type.</span><br>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token operator">==</span> <span class="token punctuation">(</span><br>        lhs<span class="token punctuation">:</span> <span class="token class-name">CLLocationCoordinate2D</span><span class="token punctuation">,</span><br>        rhs<span class="token punctuation">:</span> <span class="token class-name">CLLocationCoordinate2D</span><br>    <span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Bool</span> <span class="token punctuation">{</span><br>        lhs<span class="token punctuation">.</span>latitude <span class="token operator">==</span> rhs<span class="token punctuation">.</span>latitude <span class="token operator">&amp;&amp;</span> lhs<span class="token punctuation">.</span>longitude <span class="token operator">==</span> rhs<span class="token punctuation">.</span>longitude<br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre></article>