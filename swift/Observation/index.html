<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Observation</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#resources">Resources</a></li><li><a href="#%40binding">@Binding</a></li><li><a href="#%40observable">@Observable</a></li><li><a href="#%40bindable">@Bindable</a></li><li><a href="#example-app">Example App</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p>Observation enables defining model objects using Swift syntax and triggering SwiftUI updates based on changes to model objects.</p><h2 id="resources" tabindex="-1">Resources</h2><ul><li><a href="https://developer.apple.com/wwdc23/10149?v=1.0.21" rel="noopener" target="_blank">What is Observation?</a> video from WWDC 2023</li></ul><h2 id="%40binding" tabindex="-1">@Binding</h2><p>The <code>@Binding</code> property wrapper allows a view to mutate data that is owned by another view, typically its parent view.</p><p>The following code implements a checkbox view:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">SwiftUI</span><br><br><span class="token keyword">struct</span> <span class="token class-name">Checkbox</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>    <span class="token keyword">var</span> label<span class="token punctuation">:</span> <span class="token class-name">String</span><br>    <span class="token attribute atrule">@Binding</span> <span class="token keyword">var</span> isOn<span class="token punctuation">:</span> <span class="token class-name">Bool</span><br><br>    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>        <span class="token comment">// This approach only works in macOS.</span><br>        <span class="token comment">// Toggle(isOn: $isOn) { Text(label) }.toggleStyle(.checkbox)</span><br><br>        <span class="token class-name">Button</span> <span class="token punctuation">{</span><br>            isOn<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span> label<span class="token punctuation">:</span><br>            <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> isOn <span class="token operator">?</span> <span class="token string-literal"><span class="token string">"checkmark.square"</span></span> <span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"square"</span></span><span class="token punctuation">)</span><br>            <span class="token class-name">Text</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>        <span class="token punctuation">.</span><span class="token function">buttonStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>plain<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>The following code demonstrates using the <code>Checkbox</code> view:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">ContentView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> isHappy <span class="token operator">=</span> <span class="token boolean">false</span><br><br>    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>        <span class="token class-name">VStack</span><span class="token punctuation">(</span>alignment<span class="token punctuation">:</span> <span class="token punctuation">.</span>leading<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token class-name">Checkbox</span><span class="token punctuation">(</span>label<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Happy?"</span></span><span class="token punctuation">,</span> isOn<span class="token punctuation">:</span> $isHappy<span class="token punctuation">)</span><br>            <span class="token class-name">Text</span><span class="token punctuation">(</span>isHappy <span class="token operator">?</span> <span class="token string-literal"><span class="token string">"Good for you!"</span></span> <span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Maybe tomorrow."</span></span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><h2 id="%40observable" tabindex="-1">@Observable</h2><p>To define a data model, apply the <code>Observable</code> macro to a class definition. For example:</p><pre class="language-swift"><code class="language-swift"><span class="token attribute atrule">@Observable</span> <span class="token keyword">class</span> <span class="token class-name">TodosModel</span> <span class="token punctuation">{</span><br>    <span class="token keyword">var</span> todos<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Todo</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre><h2 id="%40bindable" tabindex="-1">@Bindable</h2><p>The <code>@Bindable</code> property wrapper creates a two-way binding to instance of a class to which the <code>@Observable</code> macro is applied. This binding can be used to get and set properties in the object.</p><p>The app <a href="https://github.com/mvolkmann/ObservationDemo/blob/main/ObservationDemo/ContentView.swift?v=1.0.21" rel="noopener" target="_blank">ObservableDemo</a> demonstrates this. It defines a <code>ViewModel</code> as follows:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Observation</span><br><br><span class="token attribute atrule">@Observable</span><br><span class="token keyword">class</span> <span class="token class-name">ViewModel</span> <span class="token punctuation">{</span><br>    <span class="token keyword">var</span> todos<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Todo</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><br>        <span class="token class-name">Todo</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Cut grass"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token class-name">Todo</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Buy Milk"</span></span><span class="token punctuation">,</span> done<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><br>    <span class="token punctuation">]</span><br><br>    <span class="token keyword">func</span> <span class="token function-definition function">addTodo</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> todo<span class="token punctuation">:</span> <span class="token class-name">Todo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        todos<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">func</span> <span class="token function-definition function">deleteTodo</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> todo<span class="token punctuation">:</span> <span class="token class-name">Todo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        todos<span class="token punctuation">.</span>removeAll <span class="token punctuation">{</span> <span class="token short-argument">$0</span> <span class="token operator">==</span> todo <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>The <code>Todo</code> type is defined as follows:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Foundation</span> <span class="token comment">// for UUID</span><br><span class="token keyword">import</span> <span class="token class-name">Observation</span><br><br><span class="token comment">// This needs to be a class instead of a struct</span><br><span class="token comment">// in order to apply the @Observable macro.</span><br><span class="token attribute atrule">@Observable</span><br><span class="token keyword">class</span> <span class="token class-name">Todo</span><span class="token punctuation">:</span> <span class="token class-name">Equatable</span><span class="token punctuation">,</span> <span class="token class-name">Identifiable</span> <span class="token punctuation">{</span><br>    <span class="token keyword">var</span> description <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span><br>    <span class="token keyword">var</span> done <span class="token operator">=</span> <span class="token boolean">false</span><br>    <span class="token keyword">let</span> id<span class="token punctuation">:</span> <span class="token constant">UUID</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> description<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> done<span class="token punctuation">:</span> <span class="token class-name">Bool</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span>description <span class="token operator">=</span> description<br>        <span class="token keyword">self</span><span class="token punctuation">.</span>done <span class="token operator">=</span> done<br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token operator">==</span> <span class="token punctuation">(</span>lhs<span class="token punctuation">:</span> <span class="token class-name">Todo</span><span class="token punctuation">,</span> rhs<span class="token punctuation">:</span> <span class="token class-name">Todo</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Bool</span> <span class="token punctuation">{</span><br>        lhs<span class="token punctuation">.</span>id <span class="token operator">==</span> rhs<span class="token punctuation">.</span>id<span class="token punctuation">:</span>w<br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>The main view is defined as follows:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Observation</span><br><span class="token keyword">import</span> <span class="token class-name">SwiftUI</span><br><br><span class="token keyword">struct</span> <span class="token class-name">ContentView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>    <span class="token attribute atrule">@Environment</span><span class="token punctuation">(</span><span class="token class-name">ViewModel</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token keyword">var</span> vm<br>    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> description <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span><br><br>    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>        <span class="token class-name">VStack</span><span class="token punctuation">(</span>alignment<span class="token punctuation">:</span> <span class="token punctuation">.</span>leading<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token class-name">HStack</span> <span class="token punctuation">{</span><br>                <span class="token class-name">TextField</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"todo description"</span></span><span class="token punctuation">,</span> text<span class="token punctuation">:</span> $description<span class="token punctuation">)</span><br>                    <span class="token punctuation">.</span><span class="token function">textInputAutocapitalization</span><span class="token punctuation">(</span><span class="token punctuation">.</span>never<span class="token punctuation">)</span><br>                    <span class="token punctuation">.</span><span class="token function">textFieldStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>roundedBorder<span class="token punctuation">)</span><br>                <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Add"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                    vm<span class="token punctuation">.</span><span class="token function">addTodo</span><span class="token punctuation">(</span><span class="token class-name">Todo</span><span class="token punctuation">(</span>description<span class="token punctuation">)</span><span class="token punctuation">)</span><br>                    description <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span><br>                <span class="token punctuation">}</span><br>                <span class="token punctuation">.</span><span class="token function">buttonStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>borderedProminent<span class="token punctuation">)</span><br>                <span class="token punctuation">.</span><span class="token function">disabled</span><span class="token punctuation">(</span>description<span class="token punctuation">.</span>isEmpty<span class="token punctuation">)</span><br>            <span class="token punctuation">}</span><br><br>            <span class="token class-name">List</span> <span class="token punctuation">{</span><br>                <span class="token comment">// The `sortedInsensitive` method is defined in</span><br>                <span class="token comment">// Extensions/SequenceExtension.swift.</span><br>                <span class="token class-name">ForEach</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">sortedInsensitive</span><span class="token punctuation">(</span>by<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span>description<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> todo <span class="token keyword">in</span><br>                    <span class="token class-name">TodoRow</span><span class="token punctuation">(</span>todo<span class="token punctuation">:</span> todo<span class="token punctuation">)</span><br>                <span class="token punctuation">}</span><br>            <span class="token punctuation">}</span><br>            <span class="token punctuation">.</span><span class="token function">listStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>plain<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>The <code>TodoRow</code> view takes a binding to an instance of the <code>Todo</code> class to which the <code>@Observable</code> macro is applied. A binding to the <code>done</code> property of the <code>Todo</code> object is passed to the <code>Checkbox</code> view which can modify that property.</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Observation</span><br><span class="token keyword">import</span> <span class="token class-name">SwiftUI</span><br><br><span class="token keyword">struct</span> <span class="token class-name">TodoRow</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>    <span class="token attribute atrule">@Bindable</span> <span class="token keyword">var</span> todo<span class="token punctuation">:</span> <span class="token class-name">Todo</span><br>    <span class="token attribute atrule">@Environment</span><span class="token punctuation">(</span><span class="token class-name">ViewModel</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token keyword">var</span> vm<br><br>    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>        <span class="token class-name">HStack</span> <span class="token punctuation">{</span><br>            <span class="token class-name">Checkbox</span><span class="token punctuation">(</span>label<span class="token punctuation">:</span> todo<span class="token punctuation">.</span>description<span class="token punctuation">,</span> isOn<span class="token punctuation">:</span> $todo<span class="token punctuation">.</span>done<span class="token punctuation">)</span><br>                <span class="token punctuation">.</span><span class="token function">strikethrough</span><span class="token punctuation">(</span>todo<span class="token punctuation">.</span>done<span class="token punctuation">)</span><br>            <span class="token class-name">Spacer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>            <span class="token class-name">Button</span> <span class="token punctuation">{</span><br>                vm<span class="token punctuation">.</span><span class="token function">deleteTodo</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span><br>            <span class="token punctuation">}</span> label<span class="token punctuation">:</span> <span class="token punctuation">{</span><br>                <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"trash"</span></span><span class="token punctuation">)</span><br>            <span class="token punctuation">}</span><br>            <span class="token comment">// Without this, tapping any button triggers</span><br>            <span class="token comment">// all buttons in the same HStack!</span><br>            <span class="token punctuation">.</span><span class="token function">buttonStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>borderless<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>The <code>Checkbox</code> view is defined as follow:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">SwiftUI</span><br><br><span class="token keyword">struct</span> <span class="token class-name">Checkbox</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>    <span class="token keyword">var</span> label<span class="token punctuation">:</span> <span class="token class-name">String</span><br>    <span class="token attribute atrule">@Binding</span> <span class="token keyword">var</span> isOn<span class="token punctuation">:</span> <span class="token class-name">Bool</span><br><br>    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>        <span class="token class-name">Button</span> <span class="token punctuation">{</span><br>            isOn<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span> gg<br>        <span class="token punctuation">}</span> label<span class="token punctuation">:</span> <span class="token punctuation">{</span><br>            <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> isOn <span class="token operator">?</span> <span class="token string-literal"><span class="token string">"checkmark.square"</span></span> <span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"square"</span></span><span class="token punctuation">)</span><br>            <span class="token class-name">Text</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>        <span class="token punctuation">.</span><span class="token function">buttonStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>plain<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><h2 id="example-app" tabindex="-1">Example App</h2><p>See <a href="https://github.com/mvolkmann/ObservationDemo/blob/main/ObservationDemo/ContentView.swift?v=1.0.21" rel="noopener" target="_blank">ObservableDemo</a>.</p></article>