<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Layout Protocol</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#example-app">Example App</a></li><li><a href="#layout-protocol">Layout Protocol</a></li><li><a href="#anylayout-struct">AnyLayout Struct</a></li><li><a href="#radial-layout">Radial Layout</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p>iOS 16 introduced the <a href="https://developer.apple.com/documentation/swiftui/layout?v=1.0.20" rel="noopener" target="_blank">Layout</a> protocol and the <a href="https://developer.apple.com/documentation/swiftui/anylayout?v=1.0.20" rel="noopener" target="_blank">AnyLayout</a> struct.</p><p>See the excellent YouTube videos from Stewart Lynch, <a href="https://www.youtube.com/watch?v=WD7ebJZ7PaI?v=1.0.20" rel="noopener" target="_blank">AnyLayout and Custom Layouts in iOS 16</a>.</p><h2 id="example-app" tabindex="-1">Example App</h2><p>See <a href="https://github.com/mvolkmann/AnyLayoutDemo?v=1.0.20" rel="noopener" target="_blank">AnyLayoutDemo</a> which demonstrates everything shared in the Steward Lynch video linked above.</p><h2 id="layout-protocol" tabindex="-1">Layout Protocol</h2><p>The <a href="https://developer.apple.com/documentation/swiftui/layout?v=1.0.20" rel="noopener" target="_blank">Layout</a> protocol &quot;defines the geometry of a collection of views&quot;. It is useful in apps that need view layouts that cannot be easily achieved using standard container views like <code>HStack</code> and <code>VStack</code>.</p><p>SwiftUI provides three structs that conform to the <code>Layout</code> protocol. These take <code>alignment</code> and <code>spacing</code> arguments that customize the layout.</p><ul><li><a href="https://developer.apple.com/documentation/swiftui/hstacklayout?v=1.0.20" rel="noopener" target="_blank">HStackLayout</a></li><li><a href="https://developer.apple.com/documentation/swiftui/vstacklayout?v=1.0.20" rel="noopener" target="_blank">VStackLayout</a></li><li><a href="https://developer.apple.com/documentation/swiftui/zstacklayout?v=1.0.20" rel="noopener" target="_blank">ZStackLayout</a></li></ul><p>Custom layouts that conform to the <code>Layout</code> protocol can also be created. The following code provides a heavily commented example derived from the Stewart Lynch video:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">SwiftUI</span><br><br><span class="token comment">/**<br>  This is a custom layout that is a variation on VStackLayout.<br>  Child views are referred to as "subviews".<br>  Subviews that have even indexes (0, 2, ...) are left-aligned.<br>  Subviews that have odd indexes (1, 3, ...) are also left-aligned,<br>  but are indented in by the width of the widest even subview.<br> */</span><br><span class="token keyword">struct</span> <span class="token class-name">AlternateStackLayout</span><span class="token punctuation">:</span> <span class="token class-name">Layout</span> <span class="token punctuation">{</span><br>    <span class="token comment">// This is used to share data between methods in the `Layout` protocol.</span><br>    <span class="token keyword">struct</span> <span class="token class-name">Cache</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> maxEvenWidth<span class="token punctuation">:</span> <span class="token class-name">CGFloat</span><br>        <span class="token keyword">let</span> maxOddWidth<span class="token punctuation">:</span> <span class="token class-name">CGFloat</span><br>        <span class="token keyword">let</span> sizes<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">CGSize</span><span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// This is called first in order to computed data</span><br>    <span class="token comment">// that can be used by the other methods.</span><br>    <span class="token keyword">func</span> <span class="token function-definition function">makeCache</span><span class="token punctuation">(</span>subviews<span class="token punctuation">:</span> <span class="token class-name">Subviews</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Cache</span> <span class="token punctuation">{</span><br>        <span class="token comment">// Get the size of each subview.</span><br>        <span class="token comment">// The type is `[CGSize]`.</span><br>        <span class="token comment">// `CGSize` has `width` and `height` properties.</span><br>        <span class="token keyword">let</span> sizes <span class="token operator">=</span> subviews<span class="token punctuation">.</span>map <span class="token punctuation">{</span> <span class="token short-argument">$0</span><span class="token punctuation">.</span><span class="token function">sizeThatFits</span><span class="token punctuation">(</span><span class="token punctuation">.</span>unspecified<span class="token punctuation">)</span> <span class="token punctuation">}</span><br><br>        <span class="token comment">// Get the maximum width of the even subviews</span><br>        <span class="token comment">// and the maximum width of the odd subviews.</span><br>        <span class="token keyword">var</span> maxEvenWidth <span class="token operator">=</span> <span class="token number">0.0</span><br>        <span class="token keyword">var</span> maxOddWidth <span class="token operator">=</span> <span class="token number">0.0</span><br>        <span class="token keyword">var</span> isEven <span class="token operator">=</span> <span class="token boolean">true</span><br>        <span class="token keyword">for</span> size <span class="token keyword">in</span> sizes <span class="token punctuation">{</span><br>            <span class="token keyword">let</span> width <span class="token operator">=</span> size<span class="token punctuation">.</span>width<br>            <span class="token keyword">if</span> isEven <span class="token punctuation">{</span><br>                <span class="token keyword">if</span> width <span class="token operator">></span> maxEvenWidth <span class="token punctuation">{</span> maxEvenWidth <span class="token operator">=</span> width <span class="token punctuation">}</span><br>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>                <span class="token keyword">if</span> width <span class="token operator">></span> maxOddWidth <span class="token punctuation">{</span> maxOddWidth <span class="token operator">=</span> width <span class="token punctuation">}</span><br>            <span class="token punctuation">}</span><br>            isEven<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br><br>        <span class="token keyword">return</span> <span class="token class-name">Cache</span><span class="token punctuation">(</span><br>            maxEvenWidth<span class="token punctuation">:</span> maxEvenWidth<span class="token punctuation">,</span><br>            maxOddWidth<span class="token punctuation">:</span> maxOddWidth<span class="token punctuation">,</span><br>            sizes<span class="token punctuation">:</span> sizes<br>        <span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// This is called before `placeSubviews`.</span><br>    <span class="token comment">// It determines the container width and height required to</span><br>    <span class="token comment">// hold all the subviews in their computed locations.</span><br>    <span class="token keyword">func</span> <span class="token function-definition function">sizeThatFits</span><span class="token punctuation">(</span><br>        proposal<span class="token punctuation">:</span> <span class="token class-name">ProposedViewSize</span><span class="token punctuation">,</span> <span class="token comment">// seems to be the entire screen size</span><br>        subviews<span class="token punctuation">:</span> <span class="token class-name">Subviews</span><span class="token punctuation">,</span><br>        cache<span class="token punctuation">:</span> <span class="token keyword">inout</span> <span class="token class-name">Cache</span><br>    <span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">CGSize</span> <span class="token punctuation">{</span><br>        subviews<span class="token punctuation">.</span>isEmpty <span class="token operator">?</span> <span class="token punctuation">.</span>zero <span class="token punctuation">:</span> <span class="token class-name">CGSize</span><span class="token punctuation">(</span><br>            width<span class="token punctuation">:</span> cache<span class="token punctuation">.</span>maxEvenWidth <span class="token operator">+</span> cache<span class="token punctuation">.</span>maxOddWidth<span class="token punctuation">,</span><br>            height<span class="token punctuation">:</span> cache<span class="token punctuation">.</span>sizes<span class="token punctuation">.</span>map <span class="token punctuation">{</span> <span class="token short-argument">$0</span><span class="token punctuation">.</span>height <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">+</span><span class="token punctuation">)</span><br>        <span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// This is called after `sizeThatFits`.</span><br>    <span class="token comment">// It places each subview at a computed x, y location with a proposed size.</span><br>    <span class="token keyword">func</span> <span class="token function-definition function">placeSubviews</span><span class="token punctuation">(</span><br>        <span class="token keyword">in</span> bounds<span class="token punctuation">:</span> <span class="token class-name">CGRect</span><span class="token punctuation">,</span><br>        proposal<span class="token punctuation">:</span> <span class="token class-name">ProposedViewSize</span><span class="token punctuation">,</span> <span class="token comment">// seems to be the entire screen size</span><br>        subviews<span class="token punctuation">:</span> <span class="token class-name">Subviews</span><span class="token punctuation">,</span><br>        cache<span class="token punctuation">:</span> <span class="token keyword">inout</span> <span class="token class-name">Cache</span><br>    <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">// If there are no subviews then there is no work to be done.</span><br>        <span class="token comment">// guard !subviews.isEmpty else { return }</span><br><br>        <span class="token comment">// Determine the `x` values for even and odd subviews.</span><br>        <span class="token keyword">let</span> evenX <span class="token operator">=</span> bounds<span class="token punctuation">.</span>minX<br>        <span class="token keyword">let</span> oddX <span class="token operator">=</span> bounds<span class="token punctuation">.</span>minX <span class="token operator">+</span> cache<span class="token punctuation">.</span>maxEvenWidth<br><br>        <span class="token comment">// Determine the `y` value of the first subview.</span><br>        <span class="token keyword">var</span> y <span class="token operator">=</span> bounds<span class="token punctuation">.</span>minY<br><br>        <span class="token keyword">var</span> x <span class="token operator">=</span> evenX<br>        <span class="token keyword">for</span> <span class="token punctuation">(</span>subview<span class="token punctuation">,</span> size<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token function">zip</span><span class="token punctuation">(</span>subviews<span class="token punctuation">,</span> cache<span class="token punctuation">.</span>sizes<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            subview<span class="token punctuation">.</span><span class="token function">place</span><span class="token punctuation">(</span><br>                at<span class="token punctuation">:</span> <span class="token class-name">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span><br>                anchor<span class="token punctuation">:</span> <span class="token punctuation">.</span>topLeading<span class="token punctuation">,</span><br>                proposal<span class="token punctuation">:</span> <span class="token class-name">ProposedViewSize</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><br>            <span class="token punctuation">)</span><br><br>            <span class="token comment">// The next subview will use the other x value.</span><br>            x <span class="token operator">=</span> x <span class="token operator">==</span> evenX <span class="token operator">?</span> oddX <span class="token punctuation">:</span> evenX<br><br>            <span class="token comment">// The y value for the next subview will greater than</span><br>            <span class="token comment">// the y value of this subview by the height of this subview.</span><br>            y <span class="token operator">+=</span> size<span class="token punctuation">.</span>height<br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><h2 id="anylayout-struct" tabindex="-1">AnyLayout Struct</h2><p>The <a href="https://developer.apple.com/documentation/swiftui/anylayout?v=1.0.20" rel="noopener" target="_blank">AnyLayout</a> struct is a type-erased instance of the <a href="https://developer.apple.com/documentation/swiftui/layout?v=1.0.20" rel="noopener" target="_blank">Layout</a> protocol. <code>AnyLayout</code> is used &quot;to enable dynamically changing the type of a layout container without destroying the state of the subviews&quot;.</p><p>The following code displays a series of rectangles and uses <code>AnyLayout</code> to allows the user to toggle between the three provided layouts and the custom layout implemented above. This code is also derived from the Stewart Lynch video.</p><p><img alt="SwiftUI AnyLayout HStack" style="border: 1px solid gray; width: 24%" src="/blog/assets/SwiftUI-AnyLayout-H.png?v=1.0.20" title="Swift AnyLayout HStack"> <img alt="SwiftUI AnyLayout VStack" style="border: 1px solid gray; width: 24%" src="/blog/assets/SwiftUI-AnyLayout-V.png?v=1.0.20" title="Swift AnyLayout VStack"> <img alt="SwiftUI AnyLayout ZStack" style="border: 1px solid gray; width: 24%" src="/blog/assets/SwiftUI-AnyLayout-H.png?v=1.0.20" title="Swift AnyLayout ZStack"> <img alt="SwiftUI AnyLayout Alternate" style="border: 1px solid gray; width: 24%" src="/blog/assets/SwiftUI-AnyLayout-Alternate.png?v=1.0.20" title="Swift AnyLayout Alternate"></p><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">SwiftUI</span><br><br><span class="token keyword">struct</span> <span class="token class-name">ContentView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> layoutType <span class="token operator">=</span> <span class="token class-name">LayoutType</span><span class="token punctuation">.</span>h<br><br>    <span class="token keyword">enum</span> <span class="token class-name">LayoutType</span><span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">,</span> <span class="token class-name">CaseIterable</span> <span class="token punctuation">{</span><br>        <span class="token keyword">case</span> h<span class="token punctuation">,</span> v<span class="token punctuation">,</span> z<span class="token punctuation">,</span> alt<br><br>        <span class="token keyword">var</span> index<span class="token punctuation">:</span> <span class="token class-name">Int</span> <span class="token punctuation">{</span><br>            <span class="token keyword">Self</span><span class="token punctuation">.</span>allCases<span class="token punctuation">.</span><span class="token function">firstIndex</span><span class="token punctuation">(</span><span class="token keyword">where</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token short-argument">$0</span> <span class="token operator">==</span> <span class="token keyword">self</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">!</span><br>        <span class="token punctuation">}</span><br><br>        <span class="token keyword">var</span> layout<span class="token punctuation">:</span> any <span class="token class-name">Layout</span> <span class="token punctuation">{</span><br>            <span class="token keyword">switch</span> <span class="token keyword">self</span> <span class="token punctuation">{</span><br>            <span class="token keyword">case</span> <span class="token punctuation">.</span>h<span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token class-name">HStackLayout</span><span class="token punctuation">(</span>alignment<span class="token punctuation">:</span> <span class="token punctuation">.</span>top<span class="token punctuation">,</span> spacing<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span><br>            <span class="token keyword">case</span> <span class="token punctuation">.</span>v<span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token class-name">VStackLayout</span><span class="token punctuation">(</span>alignment<span class="token punctuation">:</span> <span class="token punctuation">.</span>leading<span class="token punctuation">,</span> spacing<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span><br>            <span class="token keyword">case</span> <span class="token punctuation">.</span>z<span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token class-name">ZStackLayout</span><span class="token punctuation">(</span>alignment<span class="token punctuation">:</span> <span class="token punctuation">.</span>topLeading<span class="token punctuation">)</span><br>            <span class="token keyword">case</span> <span class="token punctuation">.</span>alt<span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token class-name">AlternateStackLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>            <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">struct</span> <span class="token class-name">Box</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> color<span class="token punctuation">:</span> <span class="token class-name">Color</span><br>        <span class="token keyword">let</span> width<span class="token punctuation">:</span> <span class="token class-name">CGFloat</span><br>        <span class="token keyword">let</span> height<span class="token punctuation">:</span> <span class="token class-name">CGFloat</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">private</span> <span class="token keyword">let</span> boxes <span class="token operator">=</span> <span class="token punctuation">[</span><br>        <span class="token class-name">Box</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>indigo<span class="token punctuation">,</span> width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token class-name">Box</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>teal<span class="token punctuation">,</span> width<span class="token punctuation">:</span> <span class="token number">80</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token class-name">Box</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>purple<span class="token punctuation">,</span> width<span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token class-name">Box</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token punctuation">.</span>red<span class="token punctuation">,</span> width<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">)</span><br>    <span class="token punctuation">]</span><br><br>    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>        <span class="token class-name">NavigationStack</span> <span class="token punctuation">{</span><br>            <span class="token class-name">AnyLayout</span><span class="token punctuation">(</span>layoutType<span class="token punctuation">.</span>layout<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                <span class="token class-name">ForEach</span><span class="token punctuation">(</span>boxes<span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span>color<span class="token punctuation">)</span> <span class="token punctuation">{</span> box <span class="token keyword">in</span><br>                    box<span class="token punctuation">.</span>color<span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span><br>                        width<span class="token punctuation">:</span> box<span class="token punctuation">.</span>width<span class="token punctuation">,</span><br>                        height<span class="token punctuation">:</span> box<span class="token punctuation">.</span>height<br>                    <span class="token punctuation">)</span><br>                <span class="token punctuation">}</span><br>            <span class="token punctuation">}</span><br>            <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">navigationTitle</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"AnyLayout Demo"</span></span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">animation</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> layoutType<span class="token punctuation">)</span><br>            <span class="token punctuation">.</span>toolbar <span class="token punctuation">{</span><br>                <span class="token class-name">ToolbarItem</span><span class="token punctuation">(</span>placement<span class="token punctuation">:</span> <span class="token punctuation">.</span>navigationBarTrailing<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                    <span class="token class-name">Button</span><span class="token punctuation">(</span><br>                        action<span class="token punctuation">:</span> <span class="token punctuation">{</span><br>                            <span class="token keyword">let</span> cases <span class="token operator">=</span> <span class="token class-name">LayoutType</span><span class="token punctuation">.</span>allCases<br>                            layoutType <span class="token operator">=</span><br>                                cases<span class="token punctuation">[</span><span class="token punctuation">(</span>layoutType<span class="token punctuation">.</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> cases<span class="token punctuation">.</span>count<span class="token punctuation">]</span><br>                        <span class="token punctuation">}</span><span class="token punctuation">,</span><br>                        label<span class="token punctuation">:</span> <span class="token punctuation">{</span><br>                            <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"circle.grid.3x3.circle.fill"</span></span><span class="token punctuation">)</span><br>                                <span class="token punctuation">.</span><span class="token function">imageScale</span><span class="token punctuation">(</span><span class="token punctuation">.</span>large<span class="token punctuation">)</span><br>                        <span class="token punctuation">}</span><br>                    <span class="token punctuation">)</span><br>                <span class="token punctuation">}</span><br>            <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><h2 id="radial-layout" tabindex="-1">Radial Layout</h2><p>Paul Hudson provided an excellent example of implementing a custom layout in his post <a href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-create-a-custom-layout-using-the-layout-protocol?v=1.0.20" rel="noopener" target="_blank">How to create a custom layout using the Layout protocol</a> It arranges a set of circles in a circular pattern.</p><p>The following code is my modified version of his example. It adds a random color to each of the circles and keeps the same color for each when the number of circles is changed.</p><p><img alt="SwiftUI Radial Layout" style="border: 1px solid gray; width: 50%" src="/blog/assets/SwiftUI-Radial-Layout.png?v=1.0.20" title="Swift Radial Layout"></p><pre class="language-swift"><code class="language-swift"><span class="token keyword">public</span> <span class="token keyword">extension</span> <span class="token class-name">Color</span> <span class="token punctuation">{</span><br>    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Color</span> <span class="token punctuation">{</span><br>        <span class="token class-name">Color</span><span class="token punctuation">(</span><br>            red<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token operator">...</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            green<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token operator">...</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            blue<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token operator">...</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            opacity<span class="token punctuation">:</span> <span class="token number">1</span><br>        <span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">struct</span> <span class="token class-name">RadialLayout</span><span class="token punctuation">:</span> <span class="token class-name">Layout</span> <span class="token punctuation">{</span><br>    <span class="token comment">// This "assigns positions to the containerâ€™s subviews."</span><br>    <span class="token keyword">func</span> <span class="token function-definition function">placeSubviews</span><span class="token punctuation">(</span><br>        <span class="token keyword">in</span> bounds<span class="token punctuation">:</span> <span class="token class-name">CGRect</span><span class="token punctuation">,</span><br>        proposal<span class="token punctuation">:</span> <span class="token class-name">ProposedViewSize</span><span class="token punctuation">,</span><br>        subviews<span class="token punctuation">:</span> <span class="token class-name">Subviews</span><span class="token punctuation">,</span><br>        cache<span class="token punctuation">:</span> <span class="token keyword">inout</span> <span class="token class-name">Void</span><br>    <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">// Get half the smallest dimension to use as the circle radius.</span><br>        <span class="token keyword">let</span> radius <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>bounds<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token punctuation">,</span> bounds<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><br><br>        <span class="token comment">// Get the angle between each subview.</span><br>        <span class="token keyword">let</span> deltaAngle <span class="token operator">=</span> <span class="token class-name">Angle</span><span class="token punctuation">.</span><span class="token function">degrees</span><span class="token punctuation">(</span><span class="token number">360</span> <span class="token operator">/</span> <span class="token class-name">Double</span><span class="token punctuation">(</span>subviews<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>radians<br><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span>index<span class="token punctuation">,</span> subview<span class="token punctuation">)</span> <span class="token keyword">in</span> subviews<span class="token punctuation">.</span><span class="token function">enumerated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token keyword">let</span> idealSize <span class="token operator">=</span> subview<span class="token punctuation">.</span><span class="token function">sizeThatFits</span><span class="token punctuation">(</span><span class="token punctuation">.</span>unspecified<span class="token punctuation">)</span><br><br>            <span class="token comment">// Get the offset from the circle center</span><br>            <span class="token comment">// that would place the subview on the circle.</span><br>            <span class="token keyword">let</span> angle <span class="token operator">=</span> deltaAngle <span class="token operator">*</span> <span class="token class-name">Double</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">.</span>pi <span class="token operator">/</span> <span class="token number">2</span><br>            <span class="token keyword">let</span> dx <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>radius <span class="token operator">-</span> idealSize<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><br>            <span class="token keyword">let</span> dy <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>radius <span class="token operator">-</span> idealSize<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><br><br>            <span class="token comment">// Calculate the subview position within the parent view.</span><br>            <span class="token keyword">let</span> position <span class="token operator">=</span> <span class="token class-name">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> bounds<span class="token punctuation">.</span>midX <span class="token operator">+</span> dx<span class="token punctuation">,</span> y<span class="token punctuation">:</span> bounds<span class="token punctuation">.</span>midY <span class="token operator">+</span> dy<span class="token punctuation">)</span><br><br>            <span class="token comment">// Place the subview at the calculated position.</span><br>            subview<span class="token punctuation">.</span><span class="token function">place</span><span class="token punctuation">(</span>at<span class="token punctuation">:</span> position<span class="token punctuation">,</span> anchor<span class="token punctuation">:</span> <span class="token punctuation">.</span>center<span class="token punctuation">,</span> proposal<span class="token punctuation">:</span> <span class="token punctuation">.</span>unspecified<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// This "reports the size of the composite layout view."</span><br>    <span class="token keyword">func</span> <span class="token function-definition function">sizeThatFits</span><span class="token punctuation">(</span><br>        proposal<span class="token punctuation">:</span> <span class="token class-name">ProposedViewSize</span><span class="token punctuation">,</span><br>        subviews<span class="token punctuation">:</span> <span class="token class-name">Subviews</span><span class="token punctuation">,</span><br>        cache<span class="token punctuation">:</span> <span class="token keyword">inout</span> <span class="token class-name">Void</span><br>    <span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">CGSize</span> <span class="token punctuation">{</span><br>        <span class="token comment">// "Creates a new proposal that replaces</span><br>        <span class="token comment">// unspecified dimensions in this proposal with</span><br>        <span class="token comment">// the corresponding dimension of the specified size."</span><br>        proposal<span class="token punctuation">.</span><span class="token function">replacingUnspecifiedDimensions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">struct</span> <span class="token class-name">ContentView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">16</span><br>    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> colors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Color</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br><br>    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        _colors <span class="token operator">=</span> <span class="token class-name">State</span><span class="token punctuation">(</span>initialValue<span class="token punctuation">:</span> <span class="token function">getColors</span><span class="token punctuation">(</span>count<span class="token punctuation">:</span> count<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>        <span class="token class-name">RadialLayout</span> <span class="token punctuation">{</span><br>            <span class="token class-name">ForEach</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">..&lt;</span> count<span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> index <span class="token keyword">in</span><br>                <span class="token keyword">let</span> color <span class="token operator">=</span> index <span class="token operator">&lt;</span> colors<span class="token punctuation">.</span>count <span class="token operator">?</span> colors<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token punctuation">.</span>black<br>                <span class="token class-name">Circle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>                    <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><br>                    <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">32</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">32</span><span class="token punctuation">)</span><br>            <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br>        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">safeAreaInset</span><span class="token punctuation">(</span>edge<span class="token punctuation">:</span> <span class="token punctuation">.</span>bottom<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token comment">// This allows the user to change the number of subviews</span><br>            <span class="token comment">// and animates the change.</span><br>            <span class="token class-name">Stepper</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Count: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">count</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> $count<span class="token punctuation">.</span><span class="token function">animation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token operator">...</span> <span class="token number">36</span><span class="token punctuation">)</span><br>                <span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token omit keyword">_</span> <span class="token keyword">in</span><br>                    <span class="token function">ensureColors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>                <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">ensureColors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> missingCount <span class="token operator">=</span> count <span class="token operator">-</span> colors<span class="token punctuation">.</span>count<br>        <span class="token keyword">guard</span> missingCount <span class="token operator">></span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span><br>        colors<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>contentsOf<span class="token punctuation">:</span> <span class="token function">getColors</span><span class="token punctuation">(</span>count<span class="token punctuation">:</span> missingCount<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">getColors</span><span class="token punctuation">(</span>count<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">[</span><span class="token class-name">Color</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><br>        <span class="token keyword">var</span> colors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Color</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br>        <span class="token keyword">for</span> <span class="token omit keyword">_</span> <span class="token keyword">in</span> <span class="token number">0</span> <span class="token operator">..&lt;</span> count <span class="token punctuation">{</span><br>            colors<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">return</span> colors<br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre></article>