<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Layout Protocol</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#example-app">Example App</a></li><li><a href="#layout-protocol">Layout Protocol</a></li><li><a href="#anylayout-struct">AnyLayout Struct</a></li><li><a href="#radial-layout">Radial Layout</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p>iOS 16 introduced the <a href="https://developer.apple.com/documentation/swiftui/layout?v=1.0.20" rel="noopener" target="_blank">Layout</a> protocol and the <a href="https://developer.apple.com/documentation/swiftui/anylayout?v=1.0.20" rel="noopener" target="_blank">AnyLayout</a> struct.</p><p>See the excellent YouTube videos from Stewart Lynch, <a href="https://www.youtube.com/watch?v=WD7ebJZ7PaI?v=1.0.20" rel="noopener" target="_blank">AnyLayout and Custom Layouts in iOS 16</a>.</p><h2 id="example-app" tabindex="-1">Example App</h2><p>See <a href="https://github.com/mvolkmann/AnyLayoutDemo?v=1.0.20" rel="noopener" target="_blank">AnyLayoutDemo</a> which demonstrates everything shared in the Steward Lynch video linked above.</p><h2 id="layout-protocol" tabindex="-1">Layout Protocol</h2><p>The <a href="https://developer.apple.com/documentation/swiftui/layout?v=1.0.20" rel="noopener" target="_blank">Layout</a> protocol ...</p><p>TODO: Add detail.</p><h2 id="anylayout-struct" tabindex="-1">AnyLayout Struct</h2><p>The <a href="https://developer.apple.com/documentation/swiftui/anylayout?v=1.0.20" rel="noopener" target="_blank">AnyLayout</a> struct is a type-erased instance of the <a href="https://developer.apple.com/documentation/swiftui/layout?v=1.0.20" rel="noopener" target="_blank">Layout</a> protocol. TODO: Add detail.</p><h2 id="radial-layout" tabindex="-1">Radial Layout</h2><p>Paul Hudson provided an excellent example of implementing a custom layout in his post <a href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-create-a-custom-layout-using-the-layout-protocol?v=1.0.20" rel="noopener" target="_blank">How to create a custom layout using the Layout protocol</a> It arranges a set of circles in a circular pattern.</p><p>The following code is my modified version of his example. It adds a random color to each of the circles and keeps the same color for each when the number of circles is changed.</p><p><img alt="SwiftUI Radial Layout" style="border: 1px solid gray; width: 50%" src="/blog/assets/SwiftUI-Radial-Layout.png?v=1.0.20" title="Swift Radial Layout"></p><pre class="language-swift"><code class="language-swift"><span class="token keyword">public</span> <span class="token keyword">extension</span> <span class="token class-name">Color</span> <span class="token punctuation">{</span><br>    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Color</span> <span class="token punctuation">{</span><br>        <span class="token class-name">Color</span><span class="token punctuation">(</span><br>            red<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token operator">...</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            green<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token operator">...</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            blue<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token operator">...</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            opacity<span class="token punctuation">:</span> <span class="token number">1</span><br>        <span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">struct</span> <span class="token class-name">RadialLayout</span><span class="token punctuation">:</span> <span class="token class-name">Layout</span> <span class="token punctuation">{</span><br>    <span class="token comment">// This "assigns positions to the containerâ€™s subviews."</span><br>    <span class="token keyword">func</span> <span class="token function-definition function">placeSubviews</span><span class="token punctuation">(</span><br>        <span class="token keyword">in</span> bounds<span class="token punctuation">:</span> <span class="token class-name">CGRect</span><span class="token punctuation">,</span><br>        proposal<span class="token punctuation">:</span> <span class="token class-name">ProposedViewSize</span><span class="token punctuation">,</span><br>        subviews<span class="token punctuation">:</span> <span class="token class-name">Subviews</span><span class="token punctuation">,</span><br>        cache<span class="token punctuation">:</span> <span class="token keyword">inout</span> <span class="token class-name">Void</span><br>    <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">// Get half the smallest dimension to use as the circle radius.</span><br>        <span class="token keyword">let</span> radius <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>bounds<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token punctuation">,</span> bounds<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><br><br>        <span class="token comment">// Get the angle between each subview.</span><br>        <span class="token keyword">let</span> deltaAngle <span class="token operator">=</span> <span class="token class-name">Angle</span><span class="token punctuation">.</span><span class="token function">degrees</span><span class="token punctuation">(</span><span class="token number">360</span> <span class="token operator">/</span> <span class="token class-name">Double</span><span class="token punctuation">(</span>subviews<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>radians<br><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span>index<span class="token punctuation">,</span> subview<span class="token punctuation">)</span> <span class="token keyword">in</span> subviews<span class="token punctuation">.</span><span class="token function">enumerated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token keyword">let</span> idealSize <span class="token operator">=</span> subview<span class="token punctuation">.</span><span class="token function">sizeThatFits</span><span class="token punctuation">(</span><span class="token punctuation">.</span>unspecified<span class="token punctuation">)</span><br><br>            <span class="token comment">// Get the offset from the circle center</span><br>            <span class="token comment">// that would place the subview on the circle.</span><br>            <span class="token keyword">let</span> angle <span class="token operator">=</span> deltaAngle <span class="token operator">*</span> <span class="token class-name">Double</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">.</span>pi <span class="token operator">/</span> <span class="token number">2</span><br>            <span class="token keyword">let</span> dx <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>radius <span class="token operator">-</span> idealSize<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><br>            <span class="token keyword">let</span> dy <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>radius <span class="token operator">-</span> idealSize<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><br><br>            <span class="token comment">// Calculate the subview position within the parent view.</span><br>            <span class="token keyword">let</span> position <span class="token operator">=</span> <span class="token class-name">CGPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> bounds<span class="token punctuation">.</span>midX <span class="token operator">+</span> dx<span class="token punctuation">,</span> y<span class="token punctuation">:</span> bounds<span class="token punctuation">.</span>midY <span class="token operator">+</span> dy<span class="token punctuation">)</span><br><br>            <span class="token comment">// Place the subview at the calculated position.</span><br>            subview<span class="token punctuation">.</span><span class="token function">place</span><span class="token punctuation">(</span>at<span class="token punctuation">:</span> position<span class="token punctuation">,</span> anchor<span class="token punctuation">:</span> <span class="token punctuation">.</span>center<span class="token punctuation">,</span> proposal<span class="token punctuation">:</span> <span class="token punctuation">.</span>unspecified<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// This "reports the size of the composite layout view."</span><br>    <span class="token keyword">func</span> <span class="token function-definition function">sizeThatFits</span><span class="token punctuation">(</span><br>        proposal<span class="token punctuation">:</span> <span class="token class-name">ProposedViewSize</span><span class="token punctuation">,</span><br>        subviews<span class="token punctuation">:</span> <span class="token class-name">Subviews</span><span class="token punctuation">,</span><br>        cache<span class="token punctuation">:</span> <span class="token keyword">inout</span> <span class="token class-name">Void</span><br>    <span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">CGSize</span> <span class="token punctuation">{</span><br>        <span class="token comment">// "Creates a new proposal that replaces</span><br>        <span class="token comment">// unspecified dimensions in this proposal with</span><br>        <span class="token comment">// the corresponding dimension of the specified size."</span><br>        proposal<span class="token punctuation">.</span><span class="token function">replacingUnspecifiedDimensions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">struct</span> <span class="token class-name">ContentView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">16</span><br>    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> colors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Color</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br><br>    <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        _colors <span class="token operator">=</span> <span class="token class-name">State</span><span class="token punctuation">(</span>initialValue<span class="token punctuation">:</span> <span class="token function">getColors</span><span class="token punctuation">(</span>count<span class="token punctuation">:</span> count<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>        <span class="token class-name">RadialLayout</span> <span class="token punctuation">{</span><br>            <span class="token class-name">ForEach</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">..&lt;</span> count<span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> index <span class="token keyword">in</span><br>                <span class="token keyword">let</span> color <span class="token operator">=</span> index <span class="token operator">&lt;</span> colors<span class="token punctuation">.</span>count <span class="token operator">?</span> colors<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token punctuation">.</span>black<br>                <span class="token class-name">Circle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>                    <span class="token punctuation">.</span><span class="token function">foregroundColor</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><br>                    <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">32</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">32</span><span class="token punctuation">)</span><br>            <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br>        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">safeAreaInset</span><span class="token punctuation">(</span>edge<span class="token punctuation">:</span> <span class="token punctuation">.</span>bottom<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token comment">// This allows the user to change the number of subviews</span><br>            <span class="token comment">// and animates the change.</span><br>            <span class="token class-name">Stepper</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Count: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">count</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> $count<span class="token punctuation">.</span><span class="token function">animation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token operator">...</span> <span class="token number">36</span><span class="token punctuation">)</span><br>                <span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token omit keyword">_</span> <span class="token keyword">in</span><br>                    <span class="token function">ensureColors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>                <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">ensureColors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> missingCount <span class="token operator">=</span> count <span class="token operator">-</span> colors<span class="token punctuation">.</span>count<br>        <span class="token keyword">guard</span> missingCount <span class="token operator">></span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span><br>        colors<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>contentsOf<span class="token punctuation">:</span> <span class="token function">getColors</span><span class="token punctuation">(</span>count<span class="token punctuation">:</span> missingCount<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">getColors</span><span class="token punctuation">(</span>count<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">[</span><span class="token class-name">Color</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><br>        <span class="token keyword">var</span> colors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Color</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br>        <span class="token keyword">for</span> <span class="token omit keyword">_</span> <span class="token keyword">in</span> <span class="token number">0</span> <span class="token operator">..&lt;</span> count <span class="token punctuation">{</span><br>            colors<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">return</span> colors<br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre></article>