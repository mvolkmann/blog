<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>ARKit</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#resources">Resources</a></li><li><a href="#configuration">Configuration</a></li><li><a href="#anchors">Anchors</a></li><li><a href="#entities">Entities</a></li><li><a href="#getting-started">Getting Started</a></li><li><a href="#reality-composer">Reality Composer</a><ol><li><a href="#adding-a-shape">Adding a Shape</a></li><li><a href="#configuring-a-shape">Configuring a Shape</a></li><li><a href="#behaviors">Behaviors</a></li><li><a href="#accessing-project-file">Accessing Project File</a></li></ol></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p><a href="https://developer.apple.com/documentation/arkit?v=1.0.20" rel="noopener" target="_blank">ARKit</a> is an Apple framework for rendering augmented reality experiences in iOS and iPadOS. ARKit utilizes device front and rear facing cameras and motion sensors.</p><p>One of the most important classes provided by ARKit is <a href="https://developer.apple.com/documentation/realitykit/arview?v=1.0.20" rel="noopener" target="_blank">ARView</a>. This displays a camera stream on a device.</p><p><a href="https://developer.apple.com/documentation/realitykit/?v=1.0.20" rel="noopener" target="_blank">RealityKit</a> is another Apple framework that is often used with ARKit. It renders 3D images and simulates changes to them. It can be used to add virtual objects to an ARKit view.</p><h2 id="resources" tabindex="-1">Resources</h2><p>Florian Schweizer (@FloWritesCode) created the following excellent YouTube videos on ARKit:</p><ul><li><a href="https://www.youtube.com/watch?v=lamIxNozxv4">Intro to ARKit 01: Project Setup &amp; ARView</a></li><li><a href="https://www.youtube.com/watch?v=vL-JKo_wtxM">Intro to ARKit 02: Placing Object</a></li><li><a href="https://www.youtube.com/watch?v=KbqbU-cCKf4">Intro to ARKit 03: Communication via Combine</a></li><li><a href="https://www.youtube.com/watch?v=brko7EoYJAk">Intro to ARKit 04: RealityComposer</a></li></ul><h2 id="configuration" tabindex="-1">Configuration</h2><p>To change the configuration of an <code>ARView</code> session, pass a configuration object to the <code>run</code> method of the <a href="https://developer.apple.com/documentation/arkit/arsession?v=1.0.20" rel="noopener" target="_blank">ARSession</a><br>object stored in the <code>session</code> property of the <code>ARView</code> object. Supported configuration types include:</p><ul><li><p><a href="https://developer.apple.com/documentation/arkit/arbodytrackingconfiguration?v=1.0.20" rel="noopener" target="_blank">ARBodyTrackingConfiguration</a> &quot;tracks human body poses, planar surfaces, and images using the rear-facing camera&quot;.</p></li><li><p><a href="https://developer.apple.com/documentation/arkit/arfacetrackingconfiguration?v=1.0.20" rel="noopener" target="_blank">ARFaceTrackingConfiguration</a> &quot;tracks facial movement and expressions using the front camera&quot;.</p></li><li><p><a href="https://developer.apple.com/documentation/arkit/argeotrackingconfiguration?v=1.0.20" rel="noopener" target="_blank">ARGeoTrackingConfiguration</a> &quot;tracks locations with GPS, map data, and a device's compass&quot;. For a list of supported cities, scroll to the &quot;Supported Areas and Cities&quot; section of the <code>ARGeoTrackingConfiguration</code> page.</p></li><li><p><a href="https://developer.apple.com/documentation/arkit/arimagetrackingconfiguration?v=1.0.20" rel="noopener" target="_blank">ARImageTrackingConfiguration</a> &quot;tracks known images using the rear-facing camera&quot;.</p></li><li><p><a href="https://developer.apple.com/documentation/arkit/arobjectscanningconfiguration?v=1.0.20" rel="noopener" target="_blank">ARObjectScanningConfiguration</a> &quot;recognizes objects and collects high-fidelity data about specific objects using the rear-facing camera&quot;.</p></li><li><p><a href="https://developer.apple.com/documentation/arkit/arorientationtrackingconfiguration?v=1.0.20" rel="noopener" target="_blank">AROrientationTrackingConfiguration</a> &quot;tracks only the device’s orientation using the rear-facing camera&quot;.</p></li><li><p><a href="https://developer.apple.com/documentation/arkit/arpositionaltrackingconfiguration?v=1.0.20" rel="noopener" target="_blank">ARPositionalTrackingConfiguration</a> &quot;tracks only the device’s position in 3D space&quot;.</p></li><li><p><a href="https://developer.apple.com/documentation/arkit/arworldtrackingconfiguration?v=1.0.20" rel="noopener" target="_blank">ARWorldTrackingConfiguration</a> &quot;tracks the position of a device in relation to objects in the environment&quot;.</p></li></ul><h2 id="anchors" tabindex="-1">Anchors</h2><p>An anchor ties entities to a location in a scene such as a coordinate relative to an iPhone location when the app launches. There are several kinds of anchors including a 3D coordinate (specified by a 3x3 matrix of the type <code>SIMD3&lt;Scalar&gt;</code>), a horizontal plane (ex. the floor or a desk top), a vertical plane (ex. a wall), a face, a body, and image in the scene.</p><p>After creating an anchor it must be added to a scene with <code>scene.addAnchor(myAnchor)</code>.</p><h2 id="entities" tabindex="-1">Entities</h2><p>An entity is a 3D object that can be placed in a scene. There are many ways to load entities into a project. One option is to use a USDZ file. The USDZ file format was created by Pixar. Many USDZ files can be downloaded from the <a href="https://developer.apple.com/augmented-reality/quick-look/?v=1.0.20" rel="noopener" target="_blank">Apple Developer website</a>.</p><p>To load an entity from a file and place it at an anchor:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">let</span> entity <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">?</span> <span class="token class-name">Entity</span><span class="token punctuation">.</span> <span class="token function">load</span> <span class="token punctuation">(</span>named<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"usdz-file-name"</span></span><span class="token punctuation">)</span><br>anchor<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span></code></pre><p>The Apple <a href="https://developer.apple.com/augmented-reality/tools/?v=1.0.20" rel="noopener" target="_blank">Augmented Reality Tools</a> web page contains links for downloading the tools &quot;Reality Composer&quot; (iPhone and iPad only) and &quot;Reality Converter&quot;.</p><p><a href="#reality-composer">Reality Composer</a> is described below.</p><p>The <strong>Reality Converter</strong> macOS app &quot;converts common 3D file formats such as <code>.obj</code>, <code>.gltf</code>, <code>.fbx</code>, and <code>USD</code> to <code>USDZ</code>. It also lets you view the converted model, customize its material properties with your own textures, and edit the file's metadata.&quot;</p><p>Files produced by these apps can be loaded into an ARKIt app in the same way as USDZ files.</p><p>Entities can be created using the <a href="https://developer.apple.com/documentation/realitykit/meshresource?v=1.0.20" rel="noopener" target="_blank">MeshResource</a> class provided by ARKit. This has the methods <code>generateBox</code>, <code>generatePlane</code>, and <code>generateSphere</code>. For example, to create and display a blue box:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">let</span> block <span class="token operator">=</span> <span class="token class-name">MeshResource</span><span class="token punctuation">.</span><span class="token function">generateBox</span><span class="token punctuation">(</span>size<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 1 meter on all sides</span><br><span class="token keyword">let</span> material <span class="token operator">=</span> <span class="token class-name">SimpleMaterial</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token class-name">UIColor</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span>blue<span class="token punctuation">)</span><span class="token punctuation">,</span> isMetallic<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><br><span class="token keyword">let</span> entity <span class="token operator">=</span> <span class="token class-name">ModelEntity</span><span class="token punctuation">(</span>mesh<span class="token punctuation">:</span> block<span class="token punctuation">,</span> materials<span class="token punctuation">:</span> <span class="token punctuation">[</span>material<span class="token punctuation">]</span><span class="token punctuation">)</span><br><span class="token keyword">let</span> anchor <span class="token operator">=</span> <span class="token class-name">AnchorEntity</span><span class="token punctuation">(</span>plane<span class="token punctuation">:</span> <span class="token punctuation">.</span>horizontal<span class="token punctuation">)</span><br>anchor<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><br>scene<span class="token punctuation">.</span><span class="token function">addAnchor</span><span class="token punctuation">(</span>anchor<span class="token punctuation">)</span></code></pre><h2 id="getting-started" tabindex="-1">Getting Started</h2><p>An Xcode project that uses ARKit can be created in two ways. It can be an SwiftUI &quot;App&quot; or an &quot;Augmented Reality App&quot; which does not use SwiftUI. We will only consider the first option here.</p><p>Currently ARKit views are compatible with UIKit, but not SwiftUI. We need to wrap the <code>ARView</code> in a <code>UIViewRepresentable</code> in order to access it from SwiftUI.</p><ol><li>In Xcode, create a SwiftUI project.</li><li>Select the top entry in the Project Navigator.</li><li>Select the main target.</li><li>Select the &quot;Info&quot; tab.</li><li>Hover over any row and click the &quot;+&quot; button.</li><li>For the value, describe for users why camera access is needed. For example, &quot;Need for augmented reality view&quot;.</li><li>TODO: Finish this!</li></ol><h2 id="reality-composer" tabindex="-1">Reality Composer</h2><p>The &quot;Reality Composer&quot; iOS app (best used on an iPad) and a macOS app (included with Xcode?) that allows users to &quot;easily prototype and produce AR experiences directly with no prior 3D experience&quot;. This includes creating virtual objects from existing 3D models, adding animations to them, and adding audio that can be triggered in many ways. The app can &quot;record sensor and camera data in the actual location you are building it for, and then replay it on your iOS device&quot;.</p><p>To create a new &quot;Reality Composer&quot; project:</p><ul><li>Click the &quot;+&quot; in the upper-right.</li><li>Choose an anchor such as &quot;Horizontal&quot;. This creates an initial scene containing a single white cube.</li><li>To pan, rotate, and zoom the scene, use two fingers on the screen.</li><li>To remove the cube, select add press the delete key or long-press the cube and tap &quot;Delete&quot;.</li><li>To delete the thing (what is it?) that was below the cube, use the same steps.</li><li>Tap &quot;&lt; Projects&quot; in the upper-left.</li><li>Tap the current project name which will be &quot;New Project.rcproject&quot;.</li><li>Type a new name, keeping the file extension <code>.rcproject</code>.</li><li>This will be saved in &quot;iCloud Drive&quot; inside a directory named &quot;Reality Composer&quot; so it is also accessible from your Mac.</li></ul><h3 id="adding-a-shape" tabindex="-1">Adding a Shape</h3><p>To add a shape to the scene:</p><ul><li>Tap the &quot;+&quot; in the upper-right.</li><li>In the dialog that is displayed, tap &quot;Import&quot; to add your own model or select a predefined model. For example, tap the &quot;Activities&quot; category in the left nav, scroll down to the &quot;Sports&quot; section, and tap the football. This will download a 3D model and add it to the center of the scene.</li></ul><h3 id="configuring-a-shape" tabindex="-1">Configuring a Shape</h3><p>To change the position, rotation, and scale of an object:</p><ul><li>Tap the object to select it.</li><li>In the Inspector on the right, expand the &quot;Transform&quot; section.</li><li>Modify the values under Position, Rotation, and Scale.</li><li>The position can also be modified by dragging the red, blue, and green cones just outside the object that represent the x, y, z axes. TODO: Does the y-axis value specify the distance above the surface? TODO: Does the z-axis value specify the distance away?</li></ul><p>To change the &quot;look&quot; of an object:</p><ul><li>Tap the object to select it.</li><li>In the Inspector on the right, expand the &quot;Look&quot; section.</li><li>Under &quot;Style&quot;, tap the &quot;Realistic&quot;, &quot;Stylized&quot;, or &quot;Iconic&quot; button.</li></ul><p>To cause an object to participate in physics:</p><ul><li>Tap the object to select it.</li><li>In the Inspector on the right, expand the &quot;Physics&quot; section.</li><li>Change the &quot;Participates&quot; toggle to be on.</li><li>Select a &quot;Motion Type&quot; of either &quot;Fixed&quot; or &quot;Dynamic&quot;.</li><li>Select a &quot;Material&quot; which can be &quot;Lead&quot;, &quot;Plastic&quot;, &quot;Wood&quot;, or &quot;Rubber&quot;. This affects how the object responds to collisions with surfaces or other objects.</li><li>Select a &quot;Collision Shape&quot; which can be &quot;Automatic&quot;, &quot;Box&quot;, &quot;Capsule&quot;, or &quot;Sphere&quot;.</li></ul><h3 id="behaviors" tabindex="-1">Behaviors</h3><p>Any number of behaviors can be added to each object. Each behavior has a trigger and a sequence of actions. The trigger and each action can be configured.</p><p>Each trigger has a type and a set of &quot;Affected Objects&quot;. The supported trigger types include:</p><ul><li>&quot;Tap&quot; when an object in a specified set is tapped</li><li>&quot;Scene Start&quot; when the scene is rendered</li><li>&quot;Proximity to Camera&quot; when an object in a specified set is a specified distance from the camera</li><li>&quot;Collide&quot; when an object from a specified set collides with an object in another specified set</li><li>&quot;Notification&quot; when a notification with a specified identifier is received</li></ul><p>Each action also has a type and a set of &quot;Affected Objects&quot;. Example action types include:</p><ul><li>&quot;Emphasize&quot; has &quot;Duration&quot;, &quot;Motion Type&quot;, and &quot;Style&quot;.</li><li>&quot;Play Sound&quot; has volume and &quot;Audio Clip&quot;, and &quot;Triggered while Running&quot;.</li><li>&quot;Add Force&quot; has &quot;Velocity&quot;.</li><li>&quot;Hide&quot; has &quot;Duration&quot; and &quot;Motion Type&quot;.</li><li>&quot;Wait&quot; has &quot;Duration&quot;.</li><li>&quot;Show&quot; has &quot;Duration&quot; and &quot;Motion Type&quot;.</li></ul><p>To add a behavior to the selected object:</p><ul><li>Tap the circle containing a right-pointing arrow in the upper-right. This opens an area at the bottom titled &quot;Behaviors&quot;.</li><li>Tap the &quot;+&quot; in the left nav to create a new behavior.</li><li>In the popup that appears, select a behavior type which can be:<ul><li>&quot;Tap &amp; Flip&quot; flips the object when tapped.</li><li>&quot;Tap &amp; Play Sound&quot; plays a sound when tapped.</li><li>&quot;Tap &amp; Add Force&quot; adds &quot;impulse force&quot; when tapped (What is this?).</li><li>&quot;Start Hidden&quot; hides the object when the scene begins.</li><li>&quot;Wait &amp; Show&quot; shows the object after a configurable delay.</li><li>&quot;Proximity &amp; Jiggle&quot; jiggles the object when near another.</li><li>&quot;Custom&quot; defines a custom behavior, beginning with no predefined trigger or actions.</li></ul></li></ul><p>Behaviors are given default names like &quot;Behavior&quot; and &quot;Behavior 1&quot;. To rename a behavior, long-press it in the left nav, tap &quot;Rename&quot;, and edit the name.</p><p>To change a trigger, long-press its name, select &quot;Replace&quot;, and select a new trigger from the popup that appears.</p><p>To add another action to the action sequence of a behavior:</p><ul><li>Tap the &quot;+&quot; after the heading &quot;Action Sequence&quot;.</li><li>In the popup that appears, select a behavior type.</li></ul><p>To play a behavior in order to see its effect:</p><ul><li>Tap a behavior in the left nav to select it.</li><li>Tap the play (triangle) button after &quot;Action Sequence&quot; to play the entire sequence.</li><li>Tap the play (triangle) button in an action box to play only that action.</li></ul><p>TODO: Is there a way to execute two actions at the same time TODO: rather than in sequence?</p><p>Behaviors that have missing or invalid data in their trigger or actions will have a warning icon after their name. Select the behavior in the left nav. to repair it. The trigger or actions that are invalid will have the same warning icon in the upper-right of their boxes.</p><p>To copy a behavior:</p><ul><li>Long press it in the left nav.</li><li>Tap &quot;Duplicate&quot;.</li></ul><p>To temporarily disable a behavior:</p><ul><li>Long press it in the left nav.</li><li>Tap &quot;Disable&quot;.</li></ul><p>To delete a behavior:</p><ul><li>Long press it in the left nav.</li><li>Tap &quot;Delete&quot;.</li></ul><h3 id="accessing-project-file" tabindex="-1">Accessing Project File</h3><p>To add a Reality Composer project that created on a iPad and saved in &quot;iCloud Drive&quot; to an Xcode project on a Mac:</p><ul><li>Open the Finder.</li><li>Select &quot;iCloud Drive&quot; in the left nav.</li><li>Select the &quot;Reality Composer&quot; directory.</li><li>Drag the <code>.rcproject</code> file into the Xcode Project Navigator.</li><li>In the dialog that appears, check the &quot;Copy items if needed&quot; checkbox and click the &quot;Finish&quot; button.</li><li>Click the <code>.rcproject</code> file in the Project Navigator.</li><li>Click the &quot;Open in Reality Composer&quot; button in the upper-right. This will open it in &quot;Reality Composer&quot; on the Mac. TODO: How did this get installed? Is it included with Xcode?</li><li>Select each object one at a time and click the cloud icon in the upper-right to download the model for the object.</li><li>Select File ... Save to save the downloaded models in the project. They will now appear in the Xcode view of the project.</li></ul></article>