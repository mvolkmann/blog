<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>ARKit</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#resources">Resources</a></li><li><a href="#reality-composer">Reality Composer</a><ol><li><a href="#terminology">Terminology</a></li><li><a href="#creating-a-project">Creating a Project</a></li><li><a href="#creating-a-scene">Creating a Scene</a></li><li><a href="#anchors">Anchors</a></li><li><a href="#creating-objects">Creating Objects</a></li><li><a href="#configuring-an-object">Configuring an Object</a></li><li><a href="#physics">Physics</a></li><li><a href="#duplicating-an-object">Duplicating an Object</a></li><li><a href="#undo">Undo</a></li><li><a href="#behaviors">Behaviors</a></li><li><a href="#triggers">Triggers</a></li><li><a href="#actions">Actions</a></li><li><a href="#images">Images</a></li><li><a href="#sounds">Sounds</a></li><li><a href="#playing-a-project">Playing a Project</a></li><li><a href="#ar-mode">AR Mode</a></li><li><a href="#occlusion">Occlusion</a></li><li><a href="#accessing-a-project">Accessing a Project</a></li><li><a href="#exporting-a-project">Exporting a Project</a></li></ol></li><li><a href="#object-capture">Object Capture</a></li><li><a href="#writing-code">Writing Code</a><ol><li><a href="#arview-configuration">ARView Configuration</a></li><li><a href="#important-realitykit-types">Important RealityKit Types</a></li></ol></li><li><a href="#getting-started">Getting Started</a></li><li><a href="#capturesample-app">CaptureSample App</a></li><li><a href="#pre-built-models">Pre-built models</a></li><li><a href="#viewing-models">Viewing Models</a></li><li><a href="#guidelines-for-creating-models">Guidelines for Creating Models</a></li><li><a href="#example-project">Example Project</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p><a href="https://developer.apple.com/documentation/arkit?v=1.0.20" rel="noopener" target="_blank">ARKit</a> is an Apple framework for rendering augmented reality experiences in iOS and iPadOS. ARKit utilizes device front and rear facing cameras and motion sensors.</p><p>One of the most important classes provided by ARKit is <a href="https://developer.apple.com/documentation/realitykit/arview?v=1.0.20" rel="noopener" target="_blank">ARView</a>. This displays a camera stream on a device.</p><p><a href="https://developer.apple.com/documentation/realitykit/?v=1.0.20" rel="noopener" target="_blank">RealityKit</a> is another Apple framework that is often used with ARKit. It renders 3D images and simulates changes to them. It can be used to add virtual objects to an ARKit view.</p><h2 id="resources" tabindex="-1">Resources</h2><p>Florian Schweizer (@FloWritesCode) created the following excellent YouTube videos on ARKit:</p><ul><li><a href="https://www.youtube.com/watch?v=lamIxNozxv4">Intro to ARKit 01: Project Setup &amp; ARView</a></li><li><a href="https://www.youtube.com/watch?v=vL-JKo_wtxM">Intro to ARKit 02: Placing Object</a></li><li><a href="https://www.youtube.com/watch?v=KbqbU-cCKf4">Intro to ARKit 03: Communication via Combine</a></li><li><a href="https://www.youtube.com/watch?v=brko7EoYJAk">Intro to ARKit 04: RealityComposer</a></li></ul><h2 id="reality-composer" tabindex="-1">Reality Composer</h2><p>The &quot;Reality Composer&quot; iOS app (best used on an iPad) and a macOS app (included with Xcode) that allows users to &quot;easily prototype and produce AR experiences directly with no prior 3D experience&quot;. This includes creating virtual objects from existing 3D models, adding animations to them, and adding audio that can be triggered in many ways. The app can &quot;record sensor and camera data in the actual location you are building it for, and then replay it on your iOS device&quot;.</p><p>To launch the &quot;Reality Composer&quot; app in macOS, launch Xcode and select Xcode ... Open Developer Tool .. Reality Composer.</p><h3 id="terminology" tabindex="-1">Terminology</h3><ul><li><strong>project</strong>: has one or more scenes</li><li><strong>scene</strong>: has one anchor and one or more objects</li><li><strong>anchor</strong>: determines how objects are positioned</li><li><strong>object</strong>: a 3D model that has any number of behaviors</li><li><strong>behavior</strong>: associated with one or more &quot;affected objects&quot;; has one trigger and one or more effects</li><li><strong>trigger</strong>: determines what causes a behavior to execute</li><li><strong>action</strong>: changes one or more objects in specific ways</li></ul><h3 id="creating-a-project" tabindex="-1">Creating a Project</h3><p>To create a new project:</p><ul><li>Click the &quot;+&quot; in the upper-right.</li><li>Choose an anchor such as &quot;Horizontal&quot;. This creates an initial scene containing a single white cube.</li><li>To remove the cube, tap it and press the delete key. Alternatively, tap the cube, tap it again to get a popup of options, and tap &quot;Delete&quot;.</li><li>To delete the thing (what is it?) that was below the cube, use the same steps.</li></ul><p>To rename a project:</p><ul><li>Tap &quot;&lt; Projects&quot; in the upper-left.</li><li>Tap the current project name which will be &quot;New Project.rcproject&quot;.</li><li>Type a new name, keeping the file extension <code>.rcproject</code>.</li><li>This will be saved in &quot;iCloud Drive&quot; inside a directory named &quot;Reality Composer&quot; so it is also accessible from your Mac. Editing the project from any device or Mac that shares the iCloud account will edit the same project file.</li></ul><h3 id="creating-a-scene" tabindex="-1">Creating a Scene</h3><p>A project begins with one default scene.</p><p>To create another scene:</p><ul><li>Tap the left nav button in the upper-left to toggle display of the list of current scenes.</li><li>Tap &quot;+&quot; after the title &quot;Scenes&quot;.</li><li>Select an anchor type.</li><li>The new scene will be given a default name of &quot;Scene&quot; followed by a number or just &quot;Scene&quot; if no other scene has that name.</li></ul><p>To select a scene:</p><ul><li>Tap the left nav button in the upper-left to toggle display of the list of current scenes.</li><li>Tap a scene.</li></ul><p>To rename a scene:</p><ul><li>Tap the left nav button in the upper-left to toggle display of the list of current scenes.</li><li>Tap the scene to be renamed.</li><li>Tap the properties button (cube in gear in circle) in the upper-right to open the properties panel on the right.</li><li>Tap the name input at the top.</li><li>Modify the scene name and press the return key.</li></ul><p>To delete a scene:</p><ul><li>Tap the left nav button in the upper-left to toggle display of the list of current scenes.</li><li>Long-press the scene to be deleted.</li><li>Tap &quot;Delete&quot;.</li></ul><p>To duplicate a scene:</p><ul><li>Tap the left nav button in the upper-left to toggle display of the list of current scenes.</li><li>Long-press the scene to be duplicated.</li><li>Tap &quot;Duplicate&quot;.</li></ul><p>To enable switching from one scene to another when the project is running, add a &quot;Change Scene&quot; action to a behavior and select a destination scene. For example, this can be an action in a &quot;Tap&quot; behavior so tapping an object triggers a scene change. Perhaps this can be used to simulate exiting a room and entering another.</p><p>To transform the view of a scene:</p><ul><li>Pan by dragging two fingers on the screen.</li><li>Rotate by dragging one finger on the screen.</li><li>Zoom by pinching or spreading two fingers on the screen.</li></ul><h3 id="anchors" tabindex="-1">Anchors</h3><p>An anchor ties objects in a scene to a scene location such as a coordinate relative to an iPhone location when the app launches.</p><p>The supported anchor types include:</p><ul><li>Horizontal: a horizontal plane that can represent a surface such as the floor or table top</li><li>Vertical: a vertical plane that can represent a surface such as a wall</li><li>Image: a real-world image such as a painting on a wall; objects in the scene will be positioned relative to the selected image</li><li>Face: the face of a person objects in the scene will be positioned relative to any human face</li><li>Object: a real-world object (ex. a globe) objects in the scene will be positioned relative to the object TODO: TRY THIS!</li></ul><p>When an anchor is created in code, it must be added to a scene with <code>scene.addAnchor(myAnchor)</code>.</p><h3 id="creating-objects" tabindex="-1">Creating Objects</h3><p>To add an object to the scene:</p><ul><li><p>Tap the &quot;+&quot; in the upper-right.</p></li><li><p>In the dialog that is displayed, select from a large set of predefined objects or tap &quot;Import&quot; to add your own model. The predefined objects are divided into the following categories and sub-categories:</p><ul><li>Imported: models you imported from <code>.usdz</code> files</li><li>Basic: Shapes, Text, Arrows, Callouts, Signs, and Charts</li><li>Activities: Billiards, Checkers, Chess, Events, Games, Sports, and Toys</li><li>Arts: Frames and Music</li><li>Food: Baked Goods, Cookware, Drinks, Fruit, Meals, Scanned, Tableware, and Vegetables</li><li>Furnishings: Furniture</li><li>Nature: Scanned</li><li>Places: Houses and Locations</li><li>Retail: Shopping,</li><li>Storage: Storage</li><li>Symbols: Communication, Finance, Security, and Time</li><li>Work: Supplies, Technology, and Tools</li></ul><p>For example, tap the &quot;Activities&quot; category in the left nav, scroll down to the &quot;Sports&quot; section, and tap the football. This will download a 3D model and add it to the center of the scene.</p></li><li><p>In the Inspector panel on the right, in the &quot;Object Name&quot; input, enter a name that will be used to refer to the object in code.</p></li></ul><h3 id="configuring-an-object" tabindex="-1">Configuring an Object</h3><p>To toggle display of the Inspector panel on the right side, tap the properties button in the upper-right (cube in a gear in a circle).</p><p>To change the position, rotation, and scale of an object:</p><ul><li>Tap the object to select it.</li><li>In the Inspector on the right, expand the &quot;Transform&quot; section.</li><li>Modify the values under Position, Rotation, and Scale.</li><li>The position can also be modified by dragging the red, blue, and green cones just outside the object that represent the x, y, z axes. TODO: Does the y-axis value specify the distance above the surface? TODO: Does the z-axis value specify the distance away?</li><li>To rotate an object around a given axis where the origin is considered to be the center of the object, select an object, tap one of the colored cones outside it, and drag the ring that appears.</li><li>To cause an object to snap to planes and other objects when dragged near it, tap the magnet button in the upper-left to toggle snap mode on.</li></ul><p>To change the &quot;look&quot; of an object:</p><ul><li>Tap the object to select it.</li><li>In the Inspector on the right, expand the &quot;Look&quot; section.</li><li>Under &quot;Style&quot;, tap the &quot;Realistic&quot;, &quot;Stylized&quot;, or &quot;Iconic&quot; button.</li></ul><p>Basic shapes can also select a &quot;Material&quot; and a &quot;Material Color&quot;. Material options include &quot;Glossy Paint&quot;, &quot;Matte Paint&quot;, &quot;Plastic&quot;, &quot;Car Paint&quot;, &quot;Aluminum&quot;, &quot;Brass&quot;, &quot;Bronze&quot;, &quot;Gold&quot;, &quot;Steel&quot;, &quot;Rubber&quot;, and &quot;Terracotta&quot;.</p><p>Objects can be grouped so they can be transformed as a single unit. To select all objects in the scene, tap outside all of them and tap &quot;Select All&quot;. To select a subset of the objects, hold down on one object and tap all the others. After selecting the objects to be grouped, tap any one of them to get a popup of options, and tap &quot;Group&quot;. To ungroup the objects in a group, tap the group to selected it, tap again to get a popup of options, and tap &quot;Ungroup&quot;.</p><h3 id="physics" tabindex="-1">Physics</h3><p>Objects can optionally participate in physics. When participating objects are off the ground and their scene is played, gravity causes them to fall toward the ground.</p><p>To cause an object to participate in physics:</p><ul><li>Tap the object to select it.</li><li>In the Inspector on the right, expand the &quot;Physics&quot; section.</li><li>Change the &quot;Participates&quot; toggle to be on.</li><li>Select a &quot;Motion Type&quot; of either &quot;Fixed&quot; (never moves) or &quot;Dynamic&quot; (can move).</li><li>Select a &quot;Material&quot; which can be &quot;Lead&quot;, &quot;Plastic&quot;, &quot;Wood&quot;, or &quot;Rubber&quot;. This affects how the object responds to collisions with surfaces or other objects.</li><li>Select a &quot;Collision Shape&quot; which can be &quot;Automatic&quot;, &quot;Box&quot;, &quot;Capsule&quot;, or &quot;Sphere&quot;.</li></ul><h3 id="duplicating-an-object" tabindex="-1">Duplicating an Object</h3><p>To duplicate an object, tap the object, tap it again to get a popup of options, and tap &quot;Duplicate&quot;. By default this does not copy behaviors. To do that, open the settings panel by tapping the ellipsis button and toggle &quot;Duplicate with Behaviors&quot; on.</p><h3 id="undo" tabindex="-1">Undo</h3><p>To undo the last change, tap the undo button in the upper-left.</p><h3 id="behaviors" tabindex="-1">Behaviors</h3><p>Any number of behaviors can be added to each object. Each behavior has a trigger and a sequence of actions. The trigger and each action can be configured.</p><p>To add a behavior to the selected object:</p><ul><li>Tap the circle containing a right-pointing arrow in the upper-right. This opens an area at the bottom titled &quot;Behaviors&quot;.</li><li>Tap the &quot;+&quot; in the left nav to create a new behavior.</li><li>In the popup that appears, select a behavior type which can be:<ul><li>&quot;Tap &amp; Flip&quot; flips the object when tapped.</li><li>&quot;Tap &amp; Play Sound&quot; plays a sound when tapped.</li><li>&quot;Tap &amp; Add Force&quot; adds &quot;impulse force&quot; when tapped. For example, this can be used to propel a ball into a wall.</li><li>&quot;Start Hidden&quot; hides the object when the scene begins.</li><li>&quot;Wait &amp; Show&quot; shows the object after a configurable delay.</li><li>&quot;Proximity &amp; Jiggle&quot; jiggles the object when near another.</li><li>&quot;Custom&quot; defines a custom behavior, beginning with no predefined trigger or actions.</li></ul></li></ul><p>Behaviors are given default names like &quot;Behavior&quot; and &quot;Behavior 1&quot;. To rename a behavior, long-press it in the left nav, tap &quot;Rename&quot;, and edit the name. Since these names will become property names in code, use a camelCase name that starts with a lowercase letter.</p><h3 id="triggers" tabindex="-1">Triggers</h3><p>Each trigger has a type and a set of &quot;Affected Objects&quot;. The supported trigger types include:</p><ul><li>&quot;Tap&quot; when an object in a specified set is tapped</li><li>&quot;Scene Start&quot; when the scene is rendered</li><li>&quot;Proximity to Camera&quot; when an object in a specified set is a specified distance from the camera</li><li>&quot;Collide&quot; when an object from a specified set collides with an object in another specified set</li><li>&quot;Notification&quot; when a notification with a specified identifier is received</li></ul><h3 id="actions" tabindex="-1">Actions</h3><p>Each action has a type and a set of &quot;Affected Objects&quot;. The supported actions include:</p><ul><li>&quot;Emphasize&quot; has Duration, Motion Type, and Style.</li><li>&quot;Show&quot; has Duration and Motion Type.</li><li>&quot;Hide&quot; has Duration and Motion Type.</li><li>&quot;Move, Rotate, Scale To&quot; has Duration, Ease Type, Position, Rotation, and Scale.</li><li>&quot;Move, Rotate, Scale By&quot; has Duration, Ease Type, Position, Rotation, and Scale.</li><li>&quot;Add Force&quot; has &quot;Velocity&quot;.</li><li>&quot;Orbit&quot; has Center, Duration, Revolutions, and Orbit Direction.</li><li>&quot;Spin&quot; has Duration, Iteration, Spin Direction, and Axis.</li><li>&quot;Change Scene&quot; has Scene.</li><li>&quot;Play Sound&quot; has volume, Audio Clip, and Triggered while Running.</li><li>&quot;Play Ambience&quot; has volume and Audio Clip.</li><li>&quot;Play Music&quot; has volume and Audio Clip.</li><li>&quot;Wait&quot; has &quot;Duration&quot;.</li><li>&quot;USDZ Animation&quot; has Duration, Iterations, and Triggered while Running.</li><li>&quot;Look at Camera&quot; has Duration, Facing Direction, and Rotation.</li><li>&quot;Notify&quot; has a behavior identifier. This can bve used to trigger another behavior.</li></ul><p>To change a trigger, long-press its name, select &quot;Replace&quot;, and select a new trigger from the popup that appears.</p><p>To add another action to the action sequence of a behavior:</p><ul><li>Tap the &quot;+&quot; after the heading &quot;Action Sequence&quot;.</li><li>In the popup that appears, select a behavior type.</li></ul><p>To cause an action to execute simultaneously with the action before it, drag it on top of the previous action and drop it.</p><p>To play a behavior in order to see its effect:</p><ul><li>Tap a behavior in the left nav to select it.</li><li>Tap the play (triangle) button after &quot;Action Sequence&quot; to play the entire sequence.</li><li>Tap the play (triangle) button in an action box to play only that action.</li></ul><p>TODO: Is there a way to execute two actions at the same time TODO: rather than in sequence?</p><p>Behaviors that have missing or invalid data in their trigger or actions will have a warning icon after their name. Select the behavior in the left nav. to repair it. The trigger or actions that are invalid will have the same warning icon in the upper-right of their boxes.</p><p>To copy a behavior:</p><ul><li>Long press it in the left nav.</li><li>Tap &quot;Duplicate&quot;.</li></ul><p>To temporarily disable a behavior:</p><ul><li>Long press it in the left nav.</li><li>Tap &quot;Disable&quot;.</li></ul><p>To delete a behavior:</p><ul><li>Long press it in the left nav.</li><li>Tap &quot;Delete&quot;.</li></ul><h3 id="images" tabindex="-1">Images</h3><p>Images can be added to a model. One way to do this is to:</p><ol><li>Copy a photo from the Photos app to the Files app using the share sheet button.</li><li>Add a Frame object from the Arts category to a Reality Composer project.</li><li>Edit the Frame object and select the image from the Files app.</li></ol><p>Another way is to drag an image into a Reality Composer scene. This is easy to do in macOS, but it's unclear how to do this in iOS.</p><h3 id="sounds" tabindex="-1">Sounds</h3><p>Reality Composer provides a large selection of sounds and new sounds can be imported from apps like &quot;Voice Memo&quot;.</p><p>To play a sound when an object is tapped:</p><ol><li>Open the Voice Memo app.</li><li>Record a new voice memo.</li><li>Tap the share sheet button.</li><li>Save the voice memo in the Files app.</li><li>In Reality Composer, add a &quot;Tap &amp; Play Sound&quot; behavior to an object.</li><li>In the Trigger, select an object that will be tapped to play the sound.</li><li>In the &quot;Play Sound&quot; action, tap &quot;Choose&quot; for &quot;Audio Clip&quot;.</li><li>In the dialog that appears, either select a provided sound or tap &quot;Import&quot;.</li><li>If &quot;Import&quot; was tapped, locate a sound file in the Files app, open it, and select the newly imported sound.</li></ol><h3 id="playing-a-project" tabindex="-1">Playing a Project</h3><p>To play a project tap the play button in the upper-right. This will begin executing behaviors that are configured to begin when the scene starts. It will also display a stop button at the bottom center. Tap the stop button to return to editing the project.</p><h3 id="ar-mode" tabindex="-1">AR Mode</h3><p>In iOS (iPhone or iPad) display a model and execute its behaviors by toggling the &quot;AR&quot; button in the upper-right on. This will ask for permission to access the camera and them display the model on top of what the camera sees. Tap the play button to execute the behaviors.</p><h3 id="occlusion" tabindex="-1">Occlusion</h3><p>To cause objects to occlude real-world objects when viewing them, tap the &quot;...&quot; button in the upper-left and toggle &quot;Real-World Occlusion&quot; to be on.</p><h3 id="accessing-a-project" tabindex="-1">Accessing a Project</h3><p>To add a Reality Composer project that created on a iPad and saved in &quot;iCloud Drive&quot; to an Xcode project on a Mac:</p><ul><li>Open the Finder.</li><li>Select &quot;iCloud Drive&quot; in the left nav.</li><li>Select the &quot;Reality Composer&quot; directory.</li><li>Drag the <code>.rcproject</code> file into the Xcode Project Navigator.</li><li>In the dialog that appears, check the &quot;Copy items if needed&quot; checkbox and click the &quot;Finish&quot; button.</li><li>Click the <code>.rcproject</code> file in the Project Navigator.</li><li>Click the &quot;Open in Reality Composer&quot; button in the upper-right. This will open it in &quot;Reality Composer&quot; on the Mac which is included with Xcode.</li><li>Select each object one at a time and click the cloud icon in the upper-right to download the model for the object.</li><li>Select File ... Save to save the downloaded models in the project. They will now appear in the Xcode view of the project.</li></ul><h3 id="exporting-a-project" tabindex="-1">Exporting a Project</h3><p>A project can be exported as a USDZ model (not easily edited) or a Reality file (easily edited).</p><p>To export the current model:</p><ol><li>Tap the ellipsis button to open the settings panel.</li><li>Tap Export.</li><li>Choose between exporting the entire project or only the current scene.</li><li>Tap &quot;Export&quot; in the upper-right.</li><li>Choose a location where it will be send such as AirDrop, Messages, Email, or &quot;Save to Files&quot;.</li></ol><p>TODO: It seems that Reality Composer now only supports TODO: exporting as a <code>.reality</code> file?</p><h2 id="object-capture" tabindex="-1">Object Capture</h2><p>The &quot;Object Capture&quot; API that is part of the RealityKit framework processes a series of object photos taken from many angles and produces a 3D model in the USDZ format.</p><p>Apple provides the HelloPhotogrammetry Xcode project that uses the Object Capture API. It can be downloaded at <a href="https://developer.apple.com/documentation/realitykit/creating_a_photogrammetry_command-line_app?v=1.0.20" rel="noopener" target="_blank">Creating a Photogrammetry Command-Line App</a>. Building this project creates a command-line app that generates a model file from a collection of model photos.</p><p>To build this app:</p><ol><li>Double-click the file <code>HelloPhotogrammetry.xcodeproj</code> to open the project in Xcode.</li><li>Select the top entry in the Project Navigator.</li><li>Select the top target.</li><li>Select the General tab.</li><li>Select a value in the &quot;Team&quot; dropdown.</li><li>Select File ... Project Settings...</li><li>In the dialog that appears, change the &quot;Derived Data&quot; dropdown to &quot;Custom Location&quot;.</li><li>Enter the path to your home directory or another easily located directory.</li><li>Click the scheme dropdown to the left of the device dropdown at the top of the Xcode window.</li><li>Select &quot;Edit Scheme...&quot;</li><li>In the dialog that appears, click &quot;Run&quot; in the left nav.</li><li>Click the &quot;Info&quot; tab.</li><li>Change the &quot;Build Configuration&quot; dropdown from &quot;Debug&quot; to &quot;Release&quot;.</li><li>Click the &quot;Close&quot; button.</li><li>Select Product ... Build For ... Running</li><li>Wait for the build to finish.</li><li>Copy or move the file named &quot;HelloPhotogrammetry&quot; found below the specified directory in Build/Products/Release to a directory in your PATH.</li></ol><p>Models can be produced in four detail levels which are Reduced, Medium, Full, and Raw (for custom workflows). The Reduced and Medium levels are good for use in web and mobile apps. The Full and Raw levels are intended for high-end usage. Medium detail models can be viewed in the ARQuickLook macOS app. To display multiple scans in the same scene, use the Reduced level.</p><p>To run this app:</p><ol><li>From a Terminal window enter <code>HelloPhotogrammetry</code>. This will output usage instructions.</li><li>Enter <code>HelloPhotogrammetry {images-dir-path} {output-file-path}</code> to generate a <code>.usdz</code> file from the images in a given directory.</li><li>To specify a detail level, add the <code>-d {level}</code> option where <code>{level}</code> is <code>preview</code>, <code>reduced</code>, <code>medium</code>, <code>full</code>, or <code>raw</code>.</li></ol><p>To create your own app for reading images and producing <code>.usdz</code> files, write code similar to the following:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">RealityKit</span><br><br><span class="token comment">// Create a session.</span><br><span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>fileURLWithPath<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"/tmp/photos/"</span></span><span class="token punctuation">,</span> isDirectory<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><br><span class="token keyword">let</span> session <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">!</span> <span class="token class-name">PhotogrammetrySession</span><span class="token punctuation">(</span><br>    input<span class="token punctuation">:</span> url<span class="token punctuation">,</span><br>    configuration<span class="token punctuation">:</span> <span class="token class-name">PhotogrammetrySession</span><span class="token punctuation">.</span><span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span><br><br><span class="token comment">// Prepare to process outputs.</span><br><span class="token class-name">Task</span> <span class="token punctuation">{</span><br>    <span class="token keyword">for</span> <span class="token keyword">try</span> <span class="token keyword">await</span> output <span class="token keyword">in</span> session<span class="token punctuation">.</span>outputs <span class="token punctuation">{</span><br>        <span class="token keyword">switch</span> output <span class="token punctuation">{</span><br>        <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">requestProgress</span><span class="token punctuation">(</span><span class="token keyword">let</span> request<span class="token punctuation">,</span> <span class="token keyword">let</span> fraction<span class="token punctuation">)</span><span class="token punctuation">:</span><br>            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Progress:"</span></span><span class="token punctuation">,</span> fraction<span class="token punctuation">)</span><br>        <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">requestComplete</span><span class="token punctuation">(</span><span class="token keyword">let</span> request<span class="token punctuation">,</span> <span class="token keyword">let</span> result<span class="token punctuation">)</span><span class="token punctuation">:</span><br>            <span class="token keyword">if</span> <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">modelFile</span><span class="token punctuation">(</span><span class="token keyword">let</span> url<span class="token punctuation">)</span> <span class="token operator">=</span> result <span class="token punctuation">{</span><br>                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Output at"</span></span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><br>            <span class="token punctuation">}</span><br>        <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">requestError</span><span class="token punctuation">(</span><span class="token keyword">let</span> request<span class="token punctuation">,</span> <span class="token keyword">let</span> error<span class="token punctuation">)</span><span class="token punctuation">:</span><br>            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Error:"</span></span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><br>        <span class="token keyword">case</span> <span class="token punctuation">.</span>processingComplete<span class="token punctuation">:</span><br>            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Completed"</span></span><span class="token punctuation">)</span><br>        <span class="token keyword">default</span><span class="token punctuation">:</span><br>            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Unhandled case"</span></span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Initiate processing of input photos.</span><br><span class="token comment">// This request two models to be produced.</span><br><span class="token keyword">try</span><span class="token operator">!</span> session<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>requests<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">.</span><span class="token function">modelFile</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"/tmp/models/reduced.usdz"</span></span><span class="token punctuation">,</span> detail<span class="token punctuation">:</span> <span class="token punctuation">.</span>reduced<span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">.</span><span class="token function">modelFile</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"/tmp/models/medium.usdz"</span></span><span class="token punctuation">,</span> detail<span class="token punctuation">:</span> <span class="token punctuation">.</span>medium<span class="token punctuation">)</span><br><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><h2 id="writing-code" tabindex="-1">Writing Code</h2><p>An Xcode project that uses ARKit can be created in two ways. It can be an SwiftUI &quot;App&quot; or an &quot;Augmented Reality App&quot; which does not use SwiftUI. We will only consider the first option here.</p><p>Currently ARKit views are compatible with UIKit, but not SwiftUI. We need to wrap the <code>ARView</code> in a <code>UIViewRepresentable</code> in order to access it from SwiftUI.</p><ol><li>In Xcode, create a SwiftUI project.</li><li>Select the top entry in the Project Navigator.</li><li>Select the main target.</li><li>Select the &quot;Info&quot; tab.</li><li>Hover over any row and click the &quot;+&quot; button.</li><li>For the value, describe for users why camera access is needed. For example, &quot;Need for augmented reality view&quot;.</li><li>See code in the example project <a href="https://github.com/mvolkmann/ARKitDemo/?v=1.0.20" rel="noopener" target="_blank">ARKitDemo</a>.</li></ol><h3 id="arview-configuration" tabindex="-1">ARView Configuration</h3><p>To change the configuration of an <code>ARView</code> session, pass a configuration object to the <code>run</code> method of the <a href="https://developer.apple.com/documentation/arkit/arsession?v=1.0.20" rel="noopener" target="_blank">ARSession</a><br>object stored in the <code>session</code> property of the <code>ARView</code> object. Supported configuration types include:</p><ul><li><p><a href="https://developer.apple.com/documentation/arkit/arbodytrackingconfiguration?v=1.0.20" rel="noopener" target="_blank">ARBodyTrackingConfiguration</a> &quot;tracks human body poses, planar surfaces, and images using the rear-facing camera&quot;.</p></li><li><p><a href="https://developer.apple.com/documentation/arkit/arfacetrackingconfiguration?v=1.0.20" rel="noopener" target="_blank">ARFaceTrackingConfiguration</a> &quot;tracks facial movement and expressions using the front camera&quot;.</p></li><li><p><a href="https://developer.apple.com/documentation/arkit/argeotrackingconfiguration?v=1.0.20" rel="noopener" target="_blank">ARGeoTrackingConfiguration</a> &quot;tracks locations with GPS, map data, and a device's compass&quot;. For a list of supported cities, scroll to the &quot;Supported Areas and Cities&quot; section of the <code>ARGeoTrackingConfiguration</code> page.</p></li><li><p><a href="https://developer.apple.com/documentation/arkit/arimagetrackingconfiguration?v=1.0.20" rel="noopener" target="_blank">ARImageTrackingConfiguration</a> &quot;tracks known images using the rear-facing camera&quot;.</p></li><li><p><a href="https://developer.apple.com/documentation/arkit/arobjectscanningconfiguration?v=1.0.20" rel="noopener" target="_blank">ARObjectScanningConfiguration</a> &quot;recognizes objects and collects high-fidelity data about specific objects using the rear-facing camera&quot;.</p></li><li><p><a href="https://developer.apple.com/documentation/arkit/arorientationtrackingconfiguration?v=1.0.20" rel="noopener" target="_blank">AROrientationTrackingConfiguration</a> &quot;tracks only the device’s orientation using the rear-facing camera&quot;.</p></li><li><p><a href="https://developer.apple.com/documentation/arkit/arpositionaltrackingconfiguration?v=1.0.20" rel="noopener" target="_blank">ARPositionalTrackingConfiguration</a> &quot;tracks only the device’s position in 3D space&quot;.</p></li><li><p><a href="https://developer.apple.com/documentation/arkit/arworldtrackingconfiguration?v=1.0.20" rel="noopener" target="_blank">ARWorldTrackingConfiguration</a> &quot;tracks the position of a device in relation to objects in the environment&quot;.</p></li></ul><h3 id="important-realitykit-types" tabindex="-1">Important RealityKit Types</h3><ul><li><a href="https://developer.apple.com/documentation/realitykit/arview?v=1.0.20" rel="noopener" target="_blank">ARView</a> class manages and displays a single <code>Scene</code>.</li><li><a href="https://developer.apple.com/documentation/realitykit/scene?v=1.0.20" rel="noopener" target="_blank">Scene</a> class holds a <code>Scene.AnchorCollection</code>.</li><li><a href="https://developer.apple.com/documentation/realitykit/scene/anchorcollection?v=1.0.20" rel="noopener" target="_blank">Scene.AnchorCollection</a> struct holds a collection of <code>AnchorEntity</code> objects that are accessed by subscript.</li><li><a href="https://developer.apple.com/documentation/realitykit/anchorentity/?v=1.0.20" rel="noopener" target="_blank">AnchorEntity</a> class inherits from <code>Entity</code> and anchors any number of entities to a <code>Scene</code>.</li><li><a href="https://developer.apple.com/documentation/realitykit/entity?v=1.0.20" rel="noopener" target="_blank">Entity</a> class instances represent virtual or physical objects that can have appearance and behaviors.</li><li><a href="https://developer.apple.com/documentation/realitykit/modelentity?v=1.0.20" rel="noopener" target="_blank">ModelEntity</a> class is a subclass of <code>Entity</code>. Instances represent physical objects to be rendered.</li></ul><p>An <strong>entity</strong> is a 3D object that can be placed in a scene. There are many ways to load entities into an <a href="https://developer.apple.com/documentation/arkit/aranchor?v=1.0.20" rel="noopener" target="_blank">ARAnchor</a>. One option is to use a USDZ file. The USDZ file format was created by Pixar. Many USDZ files can be downloaded from the <a href="https://developer.apple.com/augmented-reality/quick-look/?v=1.0.20" rel="noopener" target="_blank">Apple Developer website</a>.</p><p>To load an entity from a file and place it at an anchor:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">let</span> entity <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">?</span> <span class="token class-name">Entity</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>named<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"usdz-file-name"</span></span><span class="token punctuation">)</span><br>anchor<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span></code></pre><p>The Apple <a href="https://developer.apple.com/augmented-reality/tools/?v=1.0.20" rel="noopener" target="_blank">Augmented Reality Tools</a> web page contains links for downloading the tools &quot;Reality Composer&quot; (iPhone and iPad only) and &quot;Reality Converter&quot;.</p><p><a href="#reality-composer">Reality Composer</a> is described below.</p><p>The <strong>Reality Converter</strong> macOS app &quot;converts common 3D file formats such as <code>.obj</code>, <code>.gltf</code>, <code>.fbx</code>, and <code>USD</code> to <code>USDZ</code>. It also lets you view the converted model, customize its material properties with your own textures, and edit the file's metadata.&quot;</p><p>Files produced by these apps can be loaded into an ARKIt app in the same way as USDZ files.</p><p>Entities can be created using the <a href="https://developer.apple.com/documentation/realitykit/meshresource?v=1.0.20" rel="noopener" target="_blank">MeshResource</a> class provided by ARKit. This has the methods <code>generateBox</code>, <code>generatePlane</code>, and <code>generateSphere</code>. For example, to create and display a blue box:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">let</span> block <span class="token operator">=</span> <span class="token class-name">MeshResource</span><span class="token punctuation">.</span><span class="token function">generateBox</span><span class="token punctuation">(</span>size<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 1 meter on all sides</span><br><span class="token keyword">let</span> material <span class="token operator">=</span> <span class="token class-name">SimpleMaterial</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token class-name">UIColor</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span>blue<span class="token punctuation">)</span><span class="token punctuation">,</span> isMetallic<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><br><span class="token keyword">let</span> entity <span class="token operator">=</span> <span class="token class-name">ModelEntity</span><span class="token punctuation">(</span>mesh<span class="token punctuation">:</span> block<span class="token punctuation">,</span> materials<span class="token punctuation">:</span> <span class="token punctuation">[</span>material<span class="token punctuation">]</span><span class="token punctuation">)</span><br><span class="token keyword">let</span> anchor <span class="token operator">=</span> <span class="token class-name">AnchorEntity</span><span class="token punctuation">(</span>plane<span class="token punctuation">:</span> <span class="token punctuation">.</span>horizontal<span class="token punctuation">)</span><br>anchor<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><br>scene<span class="token punctuation">.</span><span class="token function">addAnchor</span><span class="token punctuation">(</span>anchor<span class="token punctuation">)</span></code></pre><h2 id="getting-started" tabindex="-1">Getting Started</h2><h2 id="capturesample-app" tabindex="-1">CaptureSample App</h2><p>Apple provides the CaptureSample project that implements an iOS app for capturing photos of a real-world object in preparation for generating a USDZ model file. The project can be downloaded from <a href="https://developer.apple.com/documentation/realitykit/taking_pictures_for_3d_object_capture?v=1.0.20" rel="noopener" target="_blank">Taking Pictures for 3D Object Capture</a>.</p><p>To build and run this app:</p><ol><li>Double-click the file <code>CaptureSample.xcodeproj</code> to open the project in Xcode.</li><li>Select the top entry in the Project Navigator.</li><li>Select the top target.</li><li>Select the General tab.</li><li>Select a value in the &quot;Team&quot; dropdown.</li><li>Attach an iPhone to the computer with a USB cable.</li><li>Select the iPhone from device dropdown at the top of the Xcode window.</li><li>Press cmd-r to build and run the app on the iPhone.</li></ol><h2 id="pre-built-models" tabindex="-1">Pre-built models</h2><p>Apple provides some pre-built USDZ at <a href="https://developer.apple.com/augmented-reality/quick-look/?v=1.0.20" rel="noopener" target="_blank">AR Quick Look</a>.</p><h2 id="viewing-models" tabindex="-1">Viewing Models</h2><p>Double-clicking a <code>.usdz</code> file opens and displays the model in Xcode using &quot;AR Quick Look&quot;. Drag around on the image to rotate it around any axis to see all sides. Some models appear in shades of black when viewed in Xcode, but will be in color when imported into the &quot;Reality Composer&quot; app.</p><h2 id="guidelines-for-creating-models" tabindex="-1">Guidelines for Creating Models</h2><p>When creating models from real-world objects:</p><ul><li>Choose an object that has adequate texture detail. If an object has low texture or transparent portions, the resulting model will lack detail.</li><li>Choose an object that does not have highly reflective regions.</li><li>If the object will need to be moved to take photos at various angles, choose a rigid object that will not change its shape when moved.</li><li>Place the object on an uncluttered background such as a solid white table so it clearly stands out.</li><li>Move slowly around the object while taking photos to capture a uniform set of views. Alternatively place the camera on a tripod, place the object on a turntable, and turn it to capture photos and various angles. Consider using timed shutter mode that is synced to a motorized turntable.</li><li>To capture the bottom of the object, flip it over and repeat the process of taking photos.</li><li>Take between 20 and 200 photos.</li></ul><h2 id="example-project" tabindex="-1">Example Project</h2><p>See <a href="https://github.com/mvolkmann/ARKitDemo/?v=1.0.20" rel="noopener" target="_blank">ARKitDemo</a>.</p></article>