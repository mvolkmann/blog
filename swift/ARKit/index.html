<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>ARKit</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#resources">Resources</a></li><li><a href="#reality-composer">Reality Composer</a></li><li><a href="#object-capture">Object Capture</a></li><li><a href="#writing-code">Writing Code</a><ol><li><a href="#arview-configuration">ARView Configuration</a></li><li><a href="#important-realitykit-types">Important RealityKit Types</a></li></ol></li><li><a href="#getting-started">Getting Started</a></li><li><a href="#capturesample-app">CaptureSample App</a></li><li><a href="#pre-built-models">Pre-built models</a></li><li><a href="#viewing-models">Viewing Models</a></li><li><a href="#guidelines-for-creating-models">Guidelines for Creating Models</a></li><li><a href="#example-project">Example Project</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p><a href="https://developer.apple.com/documentation/arkit?v=1.0.22" rel="noopener" target="_blank">ARKit</a> is an Apple framework for rendering augmented reality experiences in iOS and iPadOS. ARKit utilizes device front and rear facing cameras and motion sensors.</p><p><a href="https://developer.apple.com/documentation/realitykit/?v=1.0.22" rel="noopener" target="_blank">RealityKit</a> is another Apple framework that is often used with ARKit. It renders 3D images and simulates changes to them. RealityKit can be used to add virtual objects to an ARKit view.</p><p>ARKit and RealityKit use the USDZ file format to describe 3D objects. The USDZ file format was created by Pixar. Many USDZ files can be downloaded from the <a href="https://developer.apple.com/augmented-reality/quick-look/?v=1.0.22" rel="noopener" target="_blank">Apple Developer website</a>.</p><h2 id="resources" tabindex="-1">Resources</h2><p>Florian Schweizer (@FloWritesCode) created the following excellent YouTube videos on ARKit:</p><ul><li><a href="https://www.youtube.com/watch?v=lamIxNozxv4">Intro to ARKit 01: Project Setup &amp; ARView</a></li><li><a href="https://www.youtube.com/watch?v=vL-JKo_wtxM">Intro to ARKit 02: Placing Object</a></li><li><a href="https://www.youtube.com/watch?v=KbqbU-cCKf4">Intro to ARKit 03: Communication via Combine</a></li><li><a href="https://www.youtube.com/watch?v=brko7EoYJAk">Intro to ARKit 04: RealityComposer</a></li></ul><h2 id="reality-composer" tabindex="-1">Reality Composer</h2><p>&quot;Reality Composer&quot; is an iOS and macOS app that allows users to &quot;easily prototype and produce AR experiences directly with no prior 3D experience&quot;. See <a href="/blog/swift/RealityComposer">RealityComposer</a>.</p><h2 id="object-capture" tabindex="-1">Object Capture</h2><p>The &quot;Object Capture&quot; API that is part of the RealityKit framework processes a series of object photos taken from many angles and produces a 3D model in the USDZ format.</p><p>Apple provides the HelloPhotogrammetry Xcode project that uses the Object Capture API. It can be downloaded at <a href="https://developer.apple.com/documentation/realitykit/creating_a_photogrammetry_command-line_app?v=1.0.22" rel="noopener" target="_blank">Creating a Photogrammetry Command-Line App</a>. Building this project creates a command-line app that generates a model file from a collection of model photos.</p><p>To build this app:</p><ol><li>Double-click the file <code>HelloPhotogrammetry.xcodeproj</code> to open the project in Xcode.</li><li>Select the top entry in the Project Navigator.</li><li>Select the top target.</li><li>Select the General tab.</li><li>Select a value in the &quot;Team&quot; dropdown.</li><li>Select File ... Project Settings...</li><li>In the dialog that appears, change the &quot;Derived Data&quot; dropdown to &quot;Custom Location&quot;.</li><li>Enter the path to your home directory or another easily located directory.</li><li>Click the scheme dropdown to the left of the device dropdown at the top of the Xcode window.</li><li>Select &quot;Edit Scheme...&quot;</li><li>In the dialog that appears, click &quot;Run&quot; in the left nav.</li><li>Click the &quot;Info&quot; tab.</li><li>Change the &quot;Build Configuration&quot; dropdown from &quot;Debug&quot; to &quot;Release&quot;.</li><li>Click the &quot;Close&quot; button.</li><li>Select Product ... Build For ... Running</li><li>Wait for the build to finish.</li><li>Copy or move the file named &quot;HelloPhotogrammetry&quot; found below the specified directory in Build/Products/Release to a directory in your PATH.</li></ol><p>Models can be produced in four detail levels which are Reduced, Medium, Full, and Raw (for custom workflows). The Reduced and Medium levels are good for use in web and mobile apps. The Full and Raw levels are intended for high-end usage. Medium detail models can be viewed in the ARQuickLook macOS app. To display multiple scans in the same scene, use the Reduced level.</p><p>To run this app:</p><ol><li>From a Terminal window enter <code>HelloPhotogrammetry</code>. This will output usage instructions.</li><li>Enter <code>HelloPhotogrammetry {images-dir-path} {output-file-path}</code> to generate a <code>.usdz</code> file from the images in a given directory.</li><li>To specify a detail level, add the <code>-d {level}</code> option where <code>{level}</code> is <code>preview</code>, <code>reduced</code>, <code>medium</code>, <code>full</code>, or <code>raw</code>.</li></ol><p>To create your own app for reading images and producing <code>.usdz</code> files, write code similar to the following:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">RealityKit</span><br><br><span class="token comment">// Create a session.</span><br><span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>fileURLWithPath<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"/tmp/photos/"</span></span><span class="token punctuation">,</span> isDirectory<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><br><span class="token keyword">let</span> session <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">!</span> <span class="token class-name">PhotogrammetrySession</span><span class="token punctuation">(</span><br>    input<span class="token punctuation">:</span> url<span class="token punctuation">,</span><br>    configuration<span class="token punctuation">:</span> <span class="token class-name">PhotogrammetrySession</span><span class="token punctuation">.</span><span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span><br><br><span class="token comment">// Prepare to process outputs.</span><br><span class="token class-name">Task</span> <span class="token punctuation">{</span><br>    <span class="token keyword">for</span> <span class="token keyword">try</span> <span class="token keyword">await</span> output <span class="token keyword">in</span> session<span class="token punctuation">.</span>outputs <span class="token punctuation">{</span><br>        <span class="token keyword">switch</span> output <span class="token punctuation">{</span><br>        <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">requestProgress</span><span class="token punctuation">(</span><span class="token keyword">let</span> request<span class="token punctuation">,</span> <span class="token keyword">let</span> fraction<span class="token punctuation">)</span><span class="token punctuation">:</span><br>            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Progress:"</span></span><span class="token punctuation">,</span> fraction<span class="token punctuation">)</span><br>        <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">requestComplete</span><span class="token punctuation">(</span><span class="token keyword">let</span> request<span class="token punctuation">,</span> <span class="token keyword">let</span> result<span class="token punctuation">)</span><span class="token punctuation">:</span><br>            <span class="token keyword">if</span> <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">modelFile</span><span class="token punctuation">(</span><span class="token keyword">let</span> url<span class="token punctuation">)</span> <span class="token operator">=</span> result <span class="token punctuation">{</span><br>                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Output at"</span></span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><br>            <span class="token punctuation">}</span><br>        <span class="token keyword">case</span> <span class="token punctuation">.</span><span class="token function">requestError</span><span class="token punctuation">(</span><span class="token keyword">let</span> request<span class="token punctuation">,</span> <span class="token keyword">let</span> error<span class="token punctuation">)</span><span class="token punctuation">:</span><br>            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Error:"</span></span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><br>        <span class="token keyword">case</span> <span class="token punctuation">.</span>processingComplete<span class="token punctuation">:</span><br>            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Completed"</span></span><span class="token punctuation">)</span><br>        <span class="token keyword">default</span><span class="token punctuation">:</span><br>            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Unhandled case"</span></span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Initiate processing of input photos.</span><br><span class="token comment">// This request two models to be produced.</span><br><span class="token keyword">try</span><span class="token operator">!</span> session<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>requests<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">.</span><span class="token function">modelFile</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"/tmp/models/reduced.usdz"</span></span><span class="token punctuation">,</span> detail<span class="token punctuation">:</span> <span class="token punctuation">.</span>reduced<span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">.</span><span class="token function">modelFile</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"/tmp/models/medium.usdz"</span></span><span class="token punctuation">,</span> detail<span class="token punctuation">:</span> <span class="token punctuation">.</span>medium<span class="token punctuation">)</span><br><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><h2 id="writing-code" tabindex="-1">Writing Code</h2><p>An Xcode project that uses ARKit can be created in two ways. It can be an SwiftUI &quot;App&quot; or an &quot;Augmented Reality App&quot; which does not use SwiftUI. We will only consider the first option here.</p><p>Currently ARKit views are compatible with UIKit, but not SwiftUI. We need to wrap the <code>ARView</code> in a <code>UIViewRepresentable</code> in order to access it from SwiftUI.</p><ol><li>In Xcode, create a SwiftUI project.</li><li>Select the top entry in the Project Navigator.</li><li>Select the main target.</li><li>Select the &quot;Info&quot; tab.</li><li>Hover over any row and click the &quot;+&quot; button.</li><li>For the value, describe for users why camera access is needed. For example, &quot;Need for augmented reality view&quot;.</li><li>See code in the example project <a href="https://github.com/mvolkmann/ARKitDemo/?v=1.0.22" rel="noopener" target="_blank">ARKitDemo</a>.</li></ol><h3 id="arview-configuration" tabindex="-1">ARView Configuration</h3><p>To change the configuration of an <code>ARView</code> session, pass a configuration object to the <code>run</code> method of the <a href="https://developer.apple.com/documentation/arkit/arsession?v=1.0.22" rel="noopener" target="_blank">ARSession</a><br>object stored in the <code>session</code> property of the <code>ARView</code> object. Supported configuration types include:</p><ul><li><p><a href="https://developer.apple.com/documentation/arkit/arbodytrackingconfiguration?v=1.0.22" rel="noopener" target="_blank">ARBodyTrackingConfiguration</a> &quot;tracks human body poses, planar surfaces, and images using the rear-facing camera&quot;.</p></li><li><p><a href="https://developer.apple.com/documentation/arkit/arfacetrackingconfiguration?v=1.0.22" rel="noopener" target="_blank">ARFaceTrackingConfiguration</a> &quot;tracks facial movement and expressions using the front camera&quot;.</p></li><li><p><a href="https://developer.apple.com/documentation/arkit/argeotrackingconfiguration?v=1.0.22" rel="noopener" target="_blank">ARGeoTrackingConfiguration</a> &quot;tracks locations with GPS, map data, and a device's compass&quot;. For a list of supported cities, scroll to the &quot;Supported Areas and Cities&quot; section of the <code>ARGeoTrackingConfiguration</code> page.</p></li><li><p><a href="https://developer.apple.com/documentation/arkit/arimagetrackingconfiguration?v=1.0.22" rel="noopener" target="_blank">ARImageTrackingConfiguration</a> &quot;tracks known images using the rear-facing camera&quot;.</p></li><li><p><a href="https://developer.apple.com/documentation/arkit/arobjectscanningconfiguration?v=1.0.22" rel="noopener" target="_blank">ARObjectScanningConfiguration</a> &quot;recognizes objects and collects high-fidelity data about specific objects using the rear-facing camera&quot;.</p></li><li><p><a href="https://developer.apple.com/documentation/arkit/arorientationtrackingconfiguration?v=1.0.22" rel="noopener" target="_blank">AROrientationTrackingConfiguration</a> &quot;tracks only the device’s orientation using the rear-facing camera&quot;.</p></li><li><p><a href="https://developer.apple.com/documentation/arkit/arpositionaltrackingconfiguration?v=1.0.22" rel="noopener" target="_blank">ARPositionalTrackingConfiguration</a> &quot;tracks only the device’s position in 3D space&quot;.</p></li><li><p><a href="https://developer.apple.com/documentation/arkit/arworldtrackingconfiguration?v=1.0.22" rel="noopener" target="_blank">ARWorldTrackingConfiguration</a> &quot;tracks the position of a device in relation to objects in the environment&quot;.</p></li></ul><h3 id="important-realitykit-types" tabindex="-1">Important RealityKit Types</h3><ul><li><a href="https://developer.apple.com/documentation/realitykit/arview?v=1.0.22" rel="noopener" target="_blank">ARView</a> class manages and displays a single <code>Scene</code> along with a camera stream on a device.</li><li><a href="https://developer.apple.com/documentation/realitykit/scene?v=1.0.22" rel="noopener" target="_blank">Scene</a> class holds a <code>Scene.AnchorCollection</code>.</li><li><a href="https://developer.apple.com/documentation/realitykit/scene/anchorcollection?v=1.0.22" rel="noopener" target="_blank">Scene.AnchorCollection</a> struct holds a collection of <code>AnchorEntity</code> objects that are accessed by subscript.</li><li><a href="https://developer.apple.com/documentation/realitykit/anchorentity/?v=1.0.22" rel="noopener" target="_blank">AnchorEntity</a> class inherits from <code>Entity</code> and anchors any number of entities to a <code>Scene</code>.</li><li><a href="https://developer.apple.com/documentation/realitykit/entity?v=1.0.22" rel="noopener" target="_blank">Entity</a> class instances represent virtual or physical objects that can have appearance and behaviors.</li><li><a href="https://developer.apple.com/documentation/realitykit/modelentity?v=1.0.22" rel="noopener" target="_blank">ModelEntity</a> class is a subclass of <code>Entity</code>. Instances represent physical objects to be rendered.</li></ul><p>There are many ways to load entities. One option is to use a USDZ file.</p><p>To load an entity from a file and place it at an anchor:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">let</span> entity <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">?</span> <span class="token class-name">Entity</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>named<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"usdz-file-name"</span></span><span class="token punctuation">)</span><br>anchor<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span></code></pre><p>The Apple <a href="https://developer.apple.com/augmented-reality/tools/?v=1.0.22" rel="noopener" target="_blank">Augmented Reality Tools</a> web page contains links for downloading the tools &quot;Reality Composer&quot; (iPhone and iPad only) and &quot;Reality Converter&quot;.</p><p><a href="#reality-composer">Reality Composer</a> is described below.</p><p>The <strong>Reality Converter</strong> macOS app &quot;converts common 3D file formats such as <code>.obj</code>, <code>.gltf</code>, <code>.fbx</code>, and <code>USD</code> to <code>USDZ</code>. It also lets you view the converted model, customize its material properties with your own textures, and edit the file's metadata.&quot;</p><p>Files produced by these apps can be loaded into an ARKIt app in the same way as USDZ files.</p><p>Entities can be created using the <a href="https://developer.apple.com/documentation/realitykit/meshresource?v=1.0.22" rel="noopener" target="_blank">MeshResource</a> class provided by ARKit. This has the methods <code>generateBox</code>, <code>generatePlane</code>, and <code>generateSphere</code>. For example, to create and display a blue box:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">let</span> block <span class="token operator">=</span> <span class="token class-name">MeshResource</span><span class="token punctuation">.</span><span class="token function">generateBox</span><span class="token punctuation">(</span>size<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 1 meter on all sides</span><br><span class="token keyword">let</span> material <span class="token operator">=</span> <span class="token class-name">SimpleMaterial</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token class-name">UIColor</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span>blue<span class="token punctuation">)</span><span class="token punctuation">,</span> isMetallic<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><br><span class="token keyword">let</span> entity <span class="token operator">=</span> <span class="token class-name">ModelEntity</span><span class="token punctuation">(</span>mesh<span class="token punctuation">:</span> block<span class="token punctuation">,</span> materials<span class="token punctuation">:</span> <span class="token punctuation">[</span>material<span class="token punctuation">]</span><span class="token punctuation">)</span><br><span class="token keyword">let</span> anchor <span class="token operator">=</span> <span class="token class-name">AnchorEntity</span><span class="token punctuation">(</span>plane<span class="token punctuation">:</span> <span class="token punctuation">.</span>horizontal<span class="token punctuation">)</span><br>anchor<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><br>scene<span class="token punctuation">.</span><span class="token function">addAnchor</span><span class="token punctuation">(</span>anchor<span class="token punctuation">)</span></code></pre><h2 id="getting-started" tabindex="-1">Getting Started</h2><h2 id="capturesample-app" tabindex="-1">CaptureSample App</h2><p>Apple provides the CaptureSample project that implements an iOS app for capturing photos of a real-world object in preparation for generating a USDZ model file. The project can be downloaded from <a href="https://developer.apple.com/documentation/realitykit/taking_pictures_for_3d_object_capture?v=1.0.22" rel="noopener" target="_blank">Taking Pictures for 3D Object Capture</a>.</p><p>I was able to run this app and capture images, but the images were not saved anywhere so I could not use them to create a USDZ model file. Consider using the app PhotoCatch in the iOS App Store.</p><p>To build and run the CaptureSample app:</p><ol><li>Double-click the file <code>CaptureSample.xcodeproj</code> to open the project in Xcode.</li><li>Select the top entry in the Project Navigator.</li><li>Select the top target.</li><li>Select the General tab.</li><li>Select a value in the &quot;Team&quot; dropdown.</li><li>Attach an iPhone to the computer with a USB cable.</li><li>Select the iPhone from device dropdown at the top of the Xcode window.</li><li>Press cmd-r to build and run the app on the iPhone.</li></ol><h2 id="pre-built-models" tabindex="-1">Pre-built models</h2><p>Apple provides some pre-built USDZ at <a href="https://developer.apple.com/augmented-reality/quick-look/?v=1.0.22" rel="noopener" target="_blank">AR Quick Look</a>.</p><h2 id="viewing-models" tabindex="-1">Viewing Models</h2><p>Double-clicking a <code>.usdz</code> file opens and displays the model in Xcode using &quot;AR Quick Look&quot;. Drag around on the image to rotate it around any axis to see all sides. Some models appear in shades of black when viewed in Xcode, but will be in color when imported into the &quot;Reality Composer&quot; app.</p><h2 id="guidelines-for-creating-models" tabindex="-1">Guidelines for Creating Models</h2><p>When creating models from real-world objects:</p><ul><li>Choose an object that has adequate texture detail. If an object has low texture or transparent portions, the resulting model will lack detail.</li><li>Choose an object that does not have highly reflective regions.</li><li>If the object will need to be moved to take photos at various angles, choose a rigid object that will not change its shape when moved.</li><li>Place the object on an uncluttered background such as a solid white table so it clearly stands out.</li><li>Move slowly around the object while taking photos to capture a uniform set of views. Alternatively place the camera on a tripod, place the object on a turntable, and turn it to capture photos and various angles. Consider using timed shutter mode that is synced to a motorized turntable.</li><li>To capture the bottom of the object, flip it over and repeat the process of taking photos.</li><li>Take between 20 and 200 photos.</li></ul><h2 id="example-project" tabindex="-1">Example Project</h2><p>See <a href="https://github.com/mvolkmann/ARKitDemo/?v=1.0.22" rel="noopener" target="_blank">ARKitDemo</a>.</p></article>