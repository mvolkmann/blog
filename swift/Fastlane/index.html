<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Fastlane</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#resources">Resources</a></li><li><a href="#high-level-steps">High-level Steps</a></li><li><a href="#provisioning-profiles-and-code-signing">Provisioning Profiles and Code Signing</a></li><li><a href="#installing">Installing</a><ol><li><a href="#ruby">Ruby</a></li><li><a href="#fastlane">Fastlane</a></li></ol></li><li><a href="#configuring">Configuring</a><ol><li><a href="#appfile">Appfile</a></li><li><a href="#authentication">Authentication</a></li><li><a href="#appfile-1">Appfile</a></li><li><a href="#fastfile">Fastfile</a></li><li><a href="#snapfile">Snapfile</a></li><li><a href="#configuring-screenshot-generation">Configuring Screenshot Generation</a></li></ol></li><li><a href="#generating-screenshots">Generating Screenshots</a></li><li><a href="#running-tests">Running Tests</a></li><li><a href="#code-signing">Code Signing</a></li><li><a href="#building">Building</a></li><li><a href="#deploying-to-testflight">Deploying to TestFlight</a></li><li><a href="#deploying-to-the-app-store">Deploying to the App Store</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p><a href="https://fastlane.tools/?v=1.0.20" rel="noopener" target="_blank">Fastlane</a> is an open source platform managed by Google that automates many tasks related to Android and iOS mobile app deployment. These include running tests, generating screenshots, deploying iOS apps to TestFlight, deploying iOS apps to the App Store, and more.</p><p>Some tasks require interacting with the <a href="https://developer.apple.com/account?v=1.0.20" rel="noopener" target="_blank">Apple Developer Portal</a> and <a href="https://appstoreconnect.apple.com/?v=1.0.20" rel="noopener" target="_blank">App Store Connect</a>. Fastlane provides a way to do this from the command line.</p><p>The file <code>Fastfile</code> defines &quot;lanes&quot; which are sequences of actions that automate a specific task such as running tests, generating screenshots, deploying to TestFlight, or deploying to the App Store. These lanes can be run from the command line or by CI/CD servers.</p><p>Fastlane is primarily implemented in Ruby.</p><p>This page focuses on usage for iOS apps.</p><h2 id="resources" tabindex="-1">Resources</h2><ul><li><a href="https://fastlane.tools?v=1.0.20" rel="noopener" target="_blank">Fastline home page</a></li><li><a href="https://www.runway.team/blog/how-to-build-the-perfect-fastlane-pipeline-for-ios?v=1.0.20" rel="noopener" target="_blank">How to build the perfect fastlane pipeline for iOS</a></li></ul><h2 id="high-level-steps" tabindex="-1">High-level Steps</h2><ul><li><p>Enroll in the Apple Developer Program (currently $99/year USD).</p></li><li><p>Register the app to be managed on the Apple Developer Portal and App Store Connect.</p><ul><li>The fastlane action <a href="https://docs.fastlane.tools/actions/produce/?v=1.0.20" rel="noopener" target="_blank">produce</a> is an alias for <code>create_app_online</code>. It creates a new iOS app on both the Apple Developer Portal and App Store Connect.</li></ul></li><li><p>Register the certificates and devices of each developer with the project.</p><ul><li>The fastlane action <a href="https://docs.fastlane.tools/actions/cert/?v=1.0.20" rel="noopener" target="_blank">cert</a> is an alias for <code>get_certificates</code>. It determines if a new signing certificate is needed. If so it:<ul><li>creates a new private key</li><li>creates a new signing request</li><li>generates, downloads, and installs the certificate</li><li>imports all the generated files into the Keychain app</li></ul></li><li>The fastlane action <a href="https://docs.fastlane.tools/actions/sigh/?v=1.0.20" rel="noopener" target="_blank">sigh</a> is an alias for <code>get_provisioning_profile</code>. It can create, renew, download, and repair provisioning profiles.</li><li>The fastlane action <a href="https://docs.fastlane.tools/actions/match/?v=1.0.20" rel="noopener" target="_blank">match</a> is an alias for <code>sync_code_signing</code>. It combines the functionality of <code>cert</code> and <code>sigh</code>. In addition, it stores the certificates and provisioning profiles in a private git repository (or another supported location) so a team of developers can share them. It is recommended to use <code>match</code> in place of <code>cert</code> and <code>sigh</code> unless the fine-grained control those provide is needed or it is not desired to store the artifacts in a git repository. Perhaps <code>match</code> should only be used when a project has more than one developer.</li></ul></li><li><p>Register each of the capabilities (ex. CloudKit or MapKit) used by the project with the Developer Portal and update the app entitlements. This is done manually in Xcode.</p></li><li><p>Test the app.</p><ul><li><p>Create distribution profiles for testing beta versions of the app in a service like TestFlight.</p></li><li><p>Create and code sign an IPA file.</p></li><li><p>Upload the IPA file to a test service like TestFlight.</p></li><li><p>Register beta testers in services like TestFlight.</p></li><li><p>To build the app, see the fastlane tool <a href="https://docs.fastlane.tools/actions/gym/?v=1.0.20" rel="noopener" target="_blank">gym</a> which is an alias for <code>build_app</code>. It builds and packages an app, creating a signed <code>.ipa</code> or <code>.app</code> file.</p></li><li><p>To run automated tests, see the fastlane tool <a href="https://docs.fastlane.tools/actions/scan/?v=1.0.20" rel="noopener" target="_blank">scan</a> which is an alias for <code>run_tests</code>. It runs all the automated tests in a project in a Simulator or on a connected device.</p></li><li><p>To deploy the app to TestFlight, see the fastlane tool <a href="https://docs.fastlane.tools/actions/pilot/?v=1.0.20" rel="noopener" target="_blank">pilot</a> which is an alias for <code>upload_to_testflight</code>. It can upload a build to TestFlight, add or remove testers, get information about testers and devices, and import or export data describing all the testers.</p></li></ul></li><li><p>Create screenshots for each screen in the app, repeating for each supported device size and supported language.</p><ul><li><p>To capture localized screenshots, see the fastlane tool <a href="https://docs.fastlane.tools/actions/snapshot/?v=1.0.20" rel="noopener" target="_blank">snapshot</a> which is an alias for <code>capture_ios_screenshots</code>. It automates generating screenshots for each screen navigated to in a UI Test. It repeats this for each supported device size and language.</p></li><li><p>To add device frames around screenshots, see the fastlane tool &quot;frameit&quot; <a href="https://docs.fastlane.tools/actions/frameit/?v=1.0.20" rel="noopener" target="_blank">frameit</a> is an alias for <code>frame_screenshots</code>. It adds a device frame around screenshots. Before running this, enter <code>brew install imagemagick</code>. It creates new <code>.png</code> files below the <code>fastlane/screenshots</code> directory that have <code>_framed</code> appended to their names. The framed screenshots are beautiful, but they are all larger than the originals and are incompatible with the sizes the App Store accepts. See this <a href="https://github.com/fastlane/fastlane/issues/21067?v=1.0.20" rel="noopener" target="_blank">issue</a>.</p></li></ul></li><li><p>Upload to the App Store.</p><ul><li>The fastlane tool <a href="https://docs.fastlane.tools/actions/deliver/?v=1.0.20" rel="noopener" target="_blank">deliver</a> is an alias for <code>upload_to_app_store</code>. It can upload screenshots, metadata, and binaries to App Store Connect. It can also update the app version number and submit the app for review. There are many parameters whose names begin with <code>skip_</code> that control what it does. TODO: Will it upload framed screenshots and not the unframed versions?</li></ul></li><li><p>Submit the tested app to the App Store. The <a href="https://docs.fastlane.tools/actions/deliver/?v=1.0.20" rel="noopener" target="_blank">deliver</a> action described above can do this.</p></li></ul><p>Also consider using these actions:</p><ul><li>The <a href="https://docs.fastlane.tools/actions/slather/?v=1.0.20" rel="noopener" target="_blank">slather</a> action generates a code coverage report.</li><li>The <a href="https://docs.fastlane.tools/actions/swiftlint/?v=1.0.20" rel="noopener" target="_blank">swiftlint</a> action performs code validation using SwiftLint.</li></ul><h2 id="provisioning-profiles-and-code-signing" tabindex="-1">Provisioning Profiles and Code Signing</h2><p>For details on &quot;code signing&quot; and &quot;provisioning profiles&quot;, see the Apple Tech Note <a href="https://developer.apple.com/documentation/technotes/tn3125-inside-code-signing-provisioning-profiles?v=1.0.20" rel="noopener" target="_blank">TN3125: Inside Code Signing: Provisioning Profiles</a>. This document says the following:</p><blockquote><p>Apple platforms, except macOS, won't run arbitrary third-party code. All execution of third-party code must be authorized by Apple. This authorization comes in the form of a provisioning profile, which ties together five criteria:</p><ul><li>Who is allowed to sign code? (which developers)</li><li>What apps are they allowed to sign? (typically a single app id, but can use a wildcard to match multiple apps)</li><li>Where can those apps run? (platforms such as iOS)</li><li>When can those apps run? (expiration date after which the profile becomes invalid)</li><li>How can those apps be entitled? (what apps are entitled to do)</li></ul><p>The exact format of provisioning profiles isn't documented and could change at any time.</p></blockquote><p>Provisioning profiles include signing certificates, device identifiers, and a bundle ID. They are cryptographically signed.</p><p>TODO: Does each developer have their own signing certificate? TODO: Can a developer have multiple signing certificates? TODO: Are these used to sign a provisioning profile so it is known who created the provisioning profile?</p><h2 id="installing" tabindex="-1">Installing</h2><h3 id="ruby" tabindex="-1">Ruby</h3><p>There are often issues with using the version of Ruby that comes with macOS. To avoid these issues, install a new version of Ruby using Homebrew:</p><ol><li>Enter <code>brew install ruby</code>.</li><li>Modify your shell configuration file (such as <code>.zshrc</code>) to add <code>/opt/homebrew/opt/ruby/bin</code> to the beginning of the <code>PATH</code> environment variable value.</li><li>Start a new shell session.</li><li>Verify by entering <code>which ruby</code>.</li><li>Enter <code>gem install bundler</code>.</li></ol><h3 id="fastlane" tabindex="-1">Fastlane</h3><ol><li>Install fastlane by entering <code>brew install fastlane</code>.</li><li>If git is not already installed, enter <code>brew install git</code>.</li><li>If the Xcode Command Line Tools are not already installed, enter <code>xcode-select -install</code>.</li></ol><h2 id="configuring" tabindex="-1">Configuring</h2><ol><li><p>Add the following environment variables in your shell configuration file such as <code>.zshrc</code>:</p><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>en_US.UTF-8<br><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">LC_ALL</span></span><span class="token operator">=</span>en_US.UTF-8</code></pre></li><li><p>Open a Terminal window and cd to a root project directory.</p></li><li><p>Enter <code>fastlane init</code>.</p></li><li><p>Select one of the following options:</p><ul><li>Automate screenshots</li><li>Automate beta distribution to TestFlight</li><li>Automate App Store distribution</li><li>Manual setup (for implementing multiple lanes)</li></ul></li><li><p>Answer many more questions including your Apple ID and password.</p></li><li><p>This results in a new directory named <code>fastlane</code>. When the option &quot;Automate screenshots&quot; is selected, this directory will contain the files <code>Appfile</code>, <code>Fastfile</code>, <code>Snapfile</code>, and <code>SnapshotHelper.swift</code>.</p></li><li><p>Add the <code>fastlane</code> directory to the Xcode project and to the git repository.</p></li></ol><h3 id="appfile" tabindex="-1">Appfile</h3><p>The file <code>Appfile</code> contains the application bundle identifier and your Apple ID.</p><ol><li>Edit the file <code>fastlane/Appfile</code>.</li><li>Uncomment the line containing <code>app_identifier(</code>.</li><li>Uncomment the line containing <code>apple_id(</code>.</li></ol><h3 id="authentication" tabindex="-1">Authentication</h3><p>Many actions require authenticating against your App Store Connect account. To configure this:</p><ol><li>Browse <a href="https://appstoreconnect.apple.com?v=1.0.20" rel="noopener" target="_blank">App Store Connect</a>.</li><li>Login</li><li>Click the &quot;Users and Access&quot; button.</li><li>Select the &quot;Keys&quot; tab.</li><li>Click the &quot;Request Access&quot; button.</li><li>Check the checkbox to agree to terms.</li><li>Click the &quot;Submit&quot; button.</li><li>Click the &quot;Generate API Key&quot; button.</li><li>Enter a key name such as &quot;fastlane key&quot;.</li><li>Select an access role such as &quot;App Manager&quot;.</li><li>Click the &quot;Generate&quot; button.</li><li>Click &quot;Download API Key&quot;.</li><li>Click the &quot;Download&quot; button.</li><li>Move the downloaded <code>.p8</code> file to the project <code>fastlane</code> directory.</li></ol><p>To get base64 encoded key content enter <code>cat {key-name}.p8 | base64</code>.</p><p>In the file <code>Fastfile</code> add the following before any action that requires authentication:</p><pre class="language-ruby"><code class="language-ruby">app_store_connect_api_key<span class="token punctuation">(</span><br>  <span class="token symbol">key_id</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">"{key-id}"</span></span><span class="token punctuation">,</span> <span class="token comment"># from downloaded key file name</span><br>  <span class="token symbol">issuer_id</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">"{issuer-id}"</span></span><span class="token punctuation">,</span> <span class="token comment"># How can this be determined?</span><br>  <span class="token symbol">key_content</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">"{base64-encoded-key}"</span></span><span class="token punctuation">,</span> <span class="token comment"># from base64 command above</span><br>  <span class="token symbol">is_key_content_base64</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>  <span class="token symbol">in_house</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment"># indicates whether the team is Enterprise</span><br><span class="token punctuation">)</span></code></pre><p>Alternatively, set the following environment variables and just use <code>app_store_connect_api_key()</code>:</p><ul><li>key_id: APP_STORE_CONNECT_API_KEY_KEY_ID</li><li>issuer_id: APP_STORE_CONNECT_API_KEY_ISSUER_ID</li><li>key_content: APP_STORE_CONNECT_API_KEY_KEY</li><li>in_house: APP_STORE_CONNECT_API_KEY_IN_HOUSE</li></ul><p>Calling <code>app_store_connect_api_key()</code> with or without arguments sets a shared variable that can be used to get the API key in any lane. For example:</p><pre class="language-ruby"><code class="language-ruby">api_key <span class="token operator">=</span> lane_context<span class="token punctuation">[</span>SharedValues<span class="token double-colon punctuation">::</span><span class="token constant">APP_STORE_CONNECT_API_KEY</span><span class="token punctuation">]</span><br><span class="token comment"># Pass api_key to any action.</span></code></pre><h3 id="appfile-1" tabindex="-1">Appfile</h3><p>This is a Ruby source file that defines values used in <code>Fastfile</code>. It can contain code like the following:</p><pre class="language-ruby"><code class="language-ruby">app_identifier <span class="token string-literal"><span class="token string">"{app-bundle-identifier}"</span></span><br>apple_id <span class="token string-literal"><span class="token string">"{my-apple-id}"</span></span><br><br>itc_team_id <span class="token string-literal"><span class="token string">"{app-store-connect-team-id}"</span></span> <span class="token comment"># 9-digit number</span><br>team_id <span class="token string-literal"><span class="token string">"{developer-portal-team-id}"</span></span> <span class="token comment"># 10 characters</span></code></pre><p>For more information about the Appfile, see the fastline docs on <a href="https://docs.fastlane.tools/advanced/#appfile?v=1.0.20" rel="noopener" target="_blank">Appfile</a>.</p><h3 id="fastfile" tabindex="-1">Fastfile</h3><p>By default <code>Fastfile</code> contains code written in the Ruby programming language. There is a option to use code written in the Swift programming language, but that executes more slowly because it still interacts with Ruby.</p><ol><li><p>Edit the file <code>fastlane/Fastfile</code>.</p></li><li><p>Change the the contents to the following:</p><pre class="language-ruby"><code class="language-ruby">default_platform<span class="token punctuation">(</span><span class="token symbol">:ios</span><span class="token punctuation">)</span><br><br>platform <span class="token symbol">:ios</span> <span class="token keyword">do</span><br>  lane <span class="token symbol">:certs</span> <span class="token keyword">do</span><br>    cert<span class="token punctuation">(</span><span class="token symbol">development</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><br>    sigh<span class="token punctuation">(</span><span class="token symbol">development</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br><br>  desc <span class="token string-literal"><span class="token string">"Generate localized screenshots"</span></span><br>  lane <span class="token symbol">:screenshots</span> <span class="token keyword">do</span><br>    capture_screenshots<span class="token punctuation">(</span><span class="token symbol">scheme</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">"ScreenshotTests"</span></span><span class="token punctuation">)</span> <span class="token comment"># main change</span><br>    <span class="token comment"># The "update" step is optional.</span><br>    <span class="token comment"># upload_to_app_store(skip_binary_upload: true, skip_metadata: true)</span><br>  <span class="token keyword">end</span><br><span class="token keyword">end</span></code></pre></li><li><p>Follow the steps in the instructions that are printed which guide you to:</p><ul><li>Open the project in Xcode.</li><li>Create a new UI Test target named &quot;ScreenshotTests&quot; that is specifically for creating screenshots as described in my XCTest blog page. This should be separate from the target that runs the real UI tests.</li><li>Delete the file <code>ScreenshotTests/ScreenshotTestsLaunchTests.swift</code>. This isn't needed for capturing screenshots.</li><li>Move the <code>fastlane/SnapshotHelper.swift</code> into the new target directory.</li><li>Edit the file <code>ScreenshotTests/ScreenshotTests.swift</code>.</li><li>In the <code>setupWithError</code> method, add the following:<pre class="language-swift"><code class="language-swift"><span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token class-name">XCUIApplication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token function">setupSnapshot</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><br>app<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></li><li>Rename the test method <code>testExample</code> to <code>testScreenshots</code>.</li><li>Replace the code in this method with code that visits each screen in the app.</li><li>After the code that visiting each screen, call <code>snapshot(&quot;{screenshot-file-name}&quot;)</code>. The actual file name will begin with the device name (ex. &quot;iPhone 14-&quot;) and end with &quot;.png&quot;. This works in simulators, but does nothing when running on a real device.</li><li>Delete the method definition for <code>testLaunchPerformance</code>.</li></ul></li><li><p>Click the &quot;Close&quot; button.</p></li></ol><p>A lane can be specific to a given platform (ex. ios or mac) or it can be platform independent.</p><p>To list the lanes implemented for a given project, enter <code>fastlane lanes</code>.</p><p>The <code>fastlane</code> command can be passed the name of an action or a lane to run. To execute a lane, enter <code>bundle exec fastlane {platform} {action-or-lane}</code>. For example, <code>bundle exec fastlane ios screenshots</code>.</p><h3 id="snapfile" tabindex="-1">Snapfile</h3><ol><li><p>Edit the <code>fastlane/Snapfile</code> file.</p></li><li><p>Uncomment lines so it indicates the devices and languages to use for creating screenshots. For example:</p><pre class="language-ruby"><code class="language-ruby">devices<span class="token punctuation">(</span><span class="token punctuation">[</span><br>  <span class="token string-literal"><span class="token string">"iPhone 8 Plus"</span></span><span class="token punctuation">,</span><br>  <span class="token string-literal"><span class="token string">"iPhone 13 Pro Max"</span></span><span class="token punctuation">,</span><br>  <span class="token string-literal"><span class="token string">"iPad Pro (12.9-inch) (2nd generation)"</span></span><span class="token punctuation">,</span><br>  <span class="token string-literal"><span class="token string">"iPad Pro (12.9-inch) (6th generation)"</span></span><br><span class="token punctuation">]</span><span class="token punctuation">)</span><br><br>languages<span class="token punctuation">(</span><span class="token punctuation">[</span><br>  <span class="token comment"># These are five most used languages in the world</span><br>  <span class="token comment"># in order from most to least used</span><br>  <span class="token comment"># including the region in which they are most used.</span><br>  <span class="token string-literal"><span class="token string">"en-US"</span></span><span class="token punctuation">,</span> <span class="token comment"># English - USA</span><br>  <span class="token string-literal"><span class="token string">"zh-CN"</span></span><span class="token punctuation">,</span> <span class="token comment"># Chinese Simplified - China</span><br>  <span class="token string-literal"><span class="token string">"hi-IN"</span></span><span class="token punctuation">,</span> <span class="token comment"># Hindi - India</span><br>  <span class="token string-literal"><span class="token string">"es-ES"</span></span><span class="token punctuation">,</span> <span class="token comment"># Spanish - Spain</span><br>  <span class="token string-literal"><span class="token string">"fr-FR"</span></span> <span class="token comment"># French - France</span><br><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre></li><li><p>Uncomment the line that calls the <code>scheme</code> function and change it to <code>scheme(&quot;ScreenshotTests&quot;)</code>.</p></li><li><p>Uncomment the line <code>output_directory(&quot;./screenshots&quot;)</code> and change the path to <code>./fastlane/screenshots</code>.</p></li><li><p>Uncomment the line <code>clear_previous_screenshots(true)</code>. This deletes all the <code>.png</code> files in the <code>fastlane/screenshots</code> directory. Maybe this isn't always desirable!</p></li><li><p>Uncomment the line <code>override_status_bar(true)</code>.</p></li><li><p>Add the line <code>headless(false)</code>. Tests that need to wait for elements to appear seem to fail without this.</p></li></ol><h3 id="configuring-screenshot-generation" tabindex="-1">Configuring Screenshot Generation</h3><ol><li>Click the scheme dropdown at the top and select &quot;New Scheme...&quot;.</li><li>Enter &quot;ScreenshotTests&quot; for the name</li><li>Click the &quot;OK&quot; button.</li><li>Click the scheme dropdown at the top again and select &quot;Edit Scheme...&quot;.</li><li>In the dialog that appears, verify that the &quot;Shared&quot; checkbox at the bottom is checked.</li><li>Select &quot;Test&quot; in the left nav.</li><li>Click &quot;+&quot; at the bottom and add the &quot;ScreenshotTests&quot; target.</li><li>In the dialog that appears, select the &quot;ScreenshotTests&quot; target and click the &quot;Add&quot; button.</li></ol><p>For more information, see <a href="https://docs.fastlane.tools/getting-started/ios/screenshots/?v=1.0.20" rel="noopener" target="_blank">fastlane screenshots</a>.</p><h2 id="generating-screenshots" tabindex="-1">Generating Screenshots</h2><ol><li><p>Verify that all the Simulators to be used are in the expected light/dark mode. Many seem to default to dark mode.</p><ul><li>Open Xcode.</li><li>Select Xcode ... Open Developer Tool ... Simulator.</li><li>For each device<ul><li>In the Simulator app, select File ... Open Simulator ... iOS {version} ... {device-type}.</li><li>In the device simulator<ul><li>Open the Settings app.</li><li>Select &quot;Developer&quot;.</li><li>Toggle &quot;Dark Appearance&quot; to the desired setting.</li></ul></li></ul></li></ul></li><li><p>From the <code>fastlane</code> subdirectory enter <code>bundle exec fastlane screenshots</code>. This generates a lot of output and takes several minutes to complete.</p></li><li><p>The produced screenshot <code>.png</code> files will be in <code>fastlane/screenshots</code> directory.</p></li><li><p>An HTML file that displays all the screenshots will open in your default web browser. To skip this, add the following in <code>fastlane/Snapfile</code>:</p><pre class="language-ruby"><code class="language-ruby">skip_open_summary<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></code></pre></li></ol><h2 id="running-tests" tabindex="-1">Running Tests</h2><p>Tests run much faster in Xcode than they do from fastlane.</p><p>To run both unit tests and UI tests from fastlane:</p><ol><li><p>Modify the file <code>fastlane/Fastfile</code> to contain the following:</p><pre class="language-ruby"><code class="language-ruby">platform <span class="token symbol">:ios</span> <span class="token keyword">do</span><br>  desc <span class="token string-literal"><span class="token string">"Run tests"</span></span><br>  lane <span class="token symbol">:tests</span> <span class="token keyword">do</span><br>    run_tests<span class="token punctuation">(</span><span class="token symbol">scheme</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">"{main-scheme-name}"</span></span><span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br><span class="token keyword">end</span></code></pre></li><li><p>From the <code>fastlane</code> subdirectory enter <code>bundle exec fastlane tests</code>.</p></li></ol><p>TODO: Can you skip editing <code>Fastfile</code> and run the tests with <code>fastlane scan</code>?</p><h2 id="code-signing" tabindex="-1">Code Signing</h2><p>These steps will generate and install all required keys, certificates, and provisioning profiles.</p><ol><li><p>From the project root directory, enter <code>fastlane match init</code></p></li><li><p>For the storage mode, select &quot;1. git&quot;.</p></li><li><p>Paste the URL of the project GitHub repository.</p></li><li><p>Enter <code>fastlane match development</code></p></li><li><p>Enter a passphrase that you must remember.</p></li><li><p>Enter the password for accessing your login keychain.</p></li><li><p>Enter <code>fastlane match appstore</code></p></li><li><p>Browse <a href="https://developer.apple.com/account?v=1.0.20" rel="noopener" target="_blank">developer.apple.com</a>.</p></li><li><p>Click &quot;Account&quot; and login.</p></li><li><p>Under &quot;Certificates, Identifiers &amp; Profiles&quot; click &quot;Profiles&quot;.</p></li><li><p>Verify that the list contains a profile whose name begins with &quot;match Development&quot; and another that begins with &quot;match &quot;AppStore&quot;.</p></li><li><p>In order to allow fastlane to manage code signing you must disable automatic code signing in the Xcode project.</p><ol><li>Open the project in Xcode.</li><li>Select the top entry in the Project Navigator.</li><li>Select the main target.</li><li>Select the &quot;Signing &amp; Capabilities&quot; tab.</li><li>Uncheck the checkbox for &quot;Automatically manage signing&quot;.</li><li>Change the value in the &quot;Provisioning Profile&quot; dropdown to the one that begins with &quot;match AppStore&quot;.</li></ol></li><li><p>Edit <code>fastlane/Fastfile</code>.</p></li><li><p>Add the following lane definition to synchronize certificates:</p><pre class="language-ruby"><code class="language-ruby">desc <span class="token string-literal"><span class="token string">"Sync certificates"</span></span><br>lane <span class="token symbol">:sync_certificates</span> <span class="token keyword">do</span><br>  <span class="token comment"># read-only disables overriding existing certificates.</span><br>  match<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token symbol">readonly</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token symbol">type</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">"appstore"</span></span><span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token keyword">end</span></code></pre></li></ol><h2 id="building" tabindex="-1">Building</h2><p>These steps will enable Fastline to build the app.</p><ol><li><p>From the project root directory, enter <code>fastlane gym init</code> to create the file <code>fastlane/Gymfile</code>.</p></li><li><p>Edit the file <code>fastlane/Gymfile</code>.</p></li><li><p>Replace the contents of the file with the following:</p><pre class="language-ruby"><code class="language-ruby">scheme<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"{main-scheme-name}"</span></span><span class="token punctuation">)</span><br><br><span class="token comment"># Provide provisioning profiles to use.</span><br>export_options<span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token symbol">method</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">"app-store"</span></span><span class="token punctuation">,</span><br>  <span class="token symbol">provisioningProfiles</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token string-literal"><span class="token string">"{bundle-identifier}"</span></span> <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"match AppStore {bundle-identifier}"</span></span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br><span class="token comment"># Specify the path to store .ipa file.</span><br>output_directory<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"./fastlane/builds"</span></span><span class="token punctuation">)</span><br><br>include_bitcode<span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><br>include_symbols<span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span></code></pre></li><li><p>Open the project in Xcode.</p></li><li><p>Select the top entry in the Project Navigator.</p></li><li><p>Select the main target.</p></li><li><p>Select the &quot;Build Settings&quot; tab.</p></li><li><p>Scroll down to the &quot;Versioning&quot; section.</p></li><li><p>Verify that &quot;Versioning System&quot; is set to &quot;Apple Generic&quot; (default).</p></li><li><p>Edit <code>fastlane/Fastfile</code>.</p></li><li><p>Add the following lane definition to synchronize certificates:</p><pre class="language-ruby"><code class="language-ruby">desc <span class="token string-literal"><span class="token string">"Create ipa"</span></span><br>lane <span class="token symbol">:build</span> <span class="token keyword">do</span><br>  sync_profiles<br>  increment_build_number<br>  gym <span class="token comment"># creates a signed file</span><br><span class="token keyword">end</span></code></pre></li><li><p>From the project root directory, enter <code>bundle exec fastlane build</code>.</p></li></ol><h2 id="deploying-to-testflight" tabindex="-1">Deploying to TestFlight</h2><p>TODO: Finish this.</p><h2 id="deploying-to-the-app-store" tabindex="-1">Deploying to the App Store</h2><p>TODO: Finish this.</p></article>