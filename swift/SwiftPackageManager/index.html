<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Swift Package Manager</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#benefits">Benefits</a></li><li><a href="#terminology">Terminology</a></li><li><a href="#dependencies">Dependencies</a></li><li><a href="#creating-a-package">Creating a Package</a></li><li><a href="#command-line-executable-example">Command-line Executable Example</a></li><li><a href="#package-contents">Package Contents</a></li><li><a href="#manifest-file">Manifest File</a></li><li><a href="#building-a-package">Building a Package</a></li><li><a href="#documentation">Documentation</a></li><li><a href="#available-features">Available Features</a></li><li><a href="#using-github">Using GitHub</a></li><li><a href="#finding-packages">Finding Packages</a></li><li><a href="#using-packages">Using Packages</a></li><li><a href="#updating-packages">Updating Packages</a></li><li><a href="#adding-assets">Adding Assets</a></li><li><a href="#unit-tests">Unit Tests</a></li><li><a href="#resources">Resources</a></li><li><a href="#excluding-resources">Excluding Resources</a></li><li><a href="#localized-resources">Localized Resources</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p><a href="https://www.swift.org/package-manager/?v=1.0.20" rel="noopener" target="_blank">Swift Package Manager</a> (SPM) provides a standard way to define and use software packages in Swift applications. SPM is preferred over other packaging options such as <a href="https://cocoapods.org?v=1.0.20" rel="noopener" target="_blank">CocoaPods</a> and <a href="https://github.com/Carthage/Carthage?v=1.0.20" rel="noopener" target="_blank">Carthage</a> because it is provided by Apple and is integrated into Xcode.</p><p>Packages can contain source code written in Swift, Objective-C, or C/C++, but these cannot be mixed within the same package.</p><p>Packages can be local to a specific project or remote.</p><p>Packages can depend of other packages. Dependencies on local packages are expressed using relative (preferred) or absolute file paths. Dependencies on remote packages are expressed using Git URLs.</p><p>Packages can contain unit and integration tests.</p><p>Packages typically reside in their own Git repository. These repositories can be public or private. For details on using private Git repositories see <a href="https://developer.apple.com/documentation/xcode/building-swift-packages-or-apps-that-use-them-in-continuous-integration-workflows?v=1.0.20" rel="noopener" target="_blank">Building Swift Packages or Apps that Use Them in Continuous Integration Workflows</a></p><p>For example packages, see <a href="https://github.com/mvolkmann/RMVGeometry?v=1.0.20" rel="noopener" target="_blank">RMVGeometry</a> and <a href="https://github.com/mvolkmann/RMVSwiftUIViews?v=1.0.20" rel="noopener" target="_blank">RMVSwiftUIViews</a>.</p><h2 id="benefits" tabindex="-1">Benefits</h2><p>There are several benefits to factoring out code from a large application into packages that each reside in their own source control repository.</p><ul><li>It enables sharing code with other applications and packages. Each of these can select a different version to use. They do not all need to upgrade to a new version at the same time.</li><li>It enables testing and improving the code for each package in isolation.</li><li>It decreases application build times since the code that has been moved to packages does not need to be compiled.</li><li>It allows developers to focus on code with a specific purpose.</li><li>It reduces the possibilities for source control merge conflicts.</li></ul><h2 id="terminology" tabindex="-1">Terminology</h2><ul><li><p>Module</p><p>The term &quot;module&quot; is somewhat of an umbrella term. Libraries, frameworks, and Swift packages are all kinds of modules. A new project begins as a single module.</p></li><li><p>Swift Package</p><p>A &quot;Swift package&quot; is a collection of libraries. Many packages define a single library. A package can be added as a dependency of an app or another package. A package can be local to the project that uses it or be in a remote location such as a GitHub repository which allows it to be used in multiple projects.</p></li><li><p>Library</p><p>A &quot;library&quot; is a collection of targets that define types that have a common goal. Some libraries contain a single target. Examples include network utilities, database access, and a specific category of business logic. A library can be static or dynamic.</p><p>A static library is compiled into each app that uses it which increase the executable size of each app.</p><p>A dynamic library lives outside the apps the use it amd is linked into each app at runtime, not impacted their executable size. When a dynamic library is updated, all the apps that use can automatically use the newest version.</p><p>On Apple platforms, only libraries supplied by Apple can be dynamic. All libraries you create will be static.</p></li><li><p>Target</p><p>A &quot;target&quot; can be an executable or a set of closely related types. Swift code imports non-executable targets by name.</p></li><li><p>Framework</p><p>A &quot;framework&quot; is folder that holds code, resources (such as images), static libraries, and references to dynamic libraries. Examples of Apple-provided frameworks include AppKit (for macOS apps), CloudKit, Core Data, Core Location, Dispatch, Foundation, HealthKit, HomeKit, JavaScriptCore, MapKit, MusicKit, PDFKit, SceneKit, SpriteKit, StoreKit, Swift Charts, SwiftUI, System, UIKit, WatchKit, WeatherKit, WebKit, WidgetKit, and XCTest.</p></li></ul><p>It is common for the names of packages, libraries, and targets to have UpperCamelCase names. It is common for git repositories that hold the code for a package to have a kebab-case name.</p><p>The package names used by an app must be unique within that app. One way to avoid name conflicts it to add a two or three letter prefix to package names that identifiers the company or developer that created it.</p><h2 id="dependencies" tabindex="-1">Dependencies</h2><p>Every Swift app and package can have dependencies on other Swift packages. Swift Package Manager manages these dependencies. It can install directly specified dependencies and the dependencies of those recursively.</p><p>Swift Package Manager honors many kinds of version constraints in order to select the Git commit of a package that:</p><ul><li>is tagged with the highest semantic version that has a given major version (ex. <code>from: &quot;2.0.0&quot;</code>)</li><li>is tagged with the highest semantic version that has a given major and minor version (ex. <code>from: &quot;2.3.0&quot;</code>)</li><li>is the latest on a given branch (ex. <code>.branch(&quot;branch-name&quot;)</code>)</li><li>is tagged with a given semantic version (ex. <code>.exact(&quot;1.2.3&quot;)</code>; rarely used)</li><li>is tagged with the highest semantic version in a range of semantic versions (ex. <code>&quot;2.1.4&quot;...&quot;3.5.1&quot;</code>; rarely used)</li><li>has a given commit identifier (ex. <code>.revision(&quot;9c0445321380e97fb8f3d3f000c22a495f13b4d6&quot;)</code>; rarely used)</li></ul><h2 id="creating-a-package" tabindex="-1">Creating a Package</h2><p>To create a new package from the command line:</p><ul><li>cd to the directory that will hold the new package.</li><li>Create the package directory by entering <code>mkdir {package-name}</code>.</li><li>Enter <code>swift package init</code>.</li></ul><p>This creates the directory structure and files described in the <a href="#package-contents">Package Contents</a> section.</p><p>To create a new package in Xcode:</p><ul><li>Select File ... New ... Package...</li><li>In the dialog that appears, enter a name for the package.</li><li>Select the directory where it will be stored.</li><li>Click the Create button.</li></ul><p>To create a local package inside an existing project for ease of testing from it:</p><ul><li>Follow the steps above, but in the dialog select the project directory and select the project in the &quot;Add to&quot; dropdown. This creates a new scheme for the library inside the package that is used to build and test the library.</li><li>Add the package as a dependency of the project.<ul><li>Select the top entry in the Project Navigator.</li><li>Select the main target.</li><li>Select the &quot;General&quot; tab.</li><li>Scroll down to the &quot;Frameworks, Libraries, and Embedded Content&quot; section.</li><li>Click the &quot;+&quot; button.</li><li>Locate a package to be added and select one of its libraries. Often a package only contains a single library.</li><li>Click the &quot;Add&quot; button. This provides access to all the targets defined in the library.</li><li>Import targets from the library in each app source file that will use them.</li></ul></li></ul><p>For all types, properties, methods, and functions to be exposed by the package, change any existing access specifiers to <code>public</code> or add <code>public</code> if there is no access specifier. This includes the parameter and return types of functions. It also includes the <code>body</code> computed property in structs that conform to the <code>View</code> protocol.</p><p>For structs that are taking advantage of the default memberwise initializer (have no <code>init</code> method), add a <code>public</code> <code>init</code> method that takes all the <code>struct</code> properties as arguments and explicitly initializes all the properties.</p><p>If the package includes <code>.xcassets</code> files and uses image sets in them in SwiftUI <code>Image</code> views, add <code>bundle: .module</code> to those <code>Image</code> initializer calls.</p><p>Add DocC documentation to each type and method. To have Xcode supply as much of this as it can, select the first line of a type, method, or function and select Editor ... Structure ... Add Documentation or press cmd-option-/. After adding this documentation, rebuild the project and option-click on the name of a documented item to see the documentation in a popup.</p><h2 id="command-line-executable-example" tabindex="-1">Command-line Executable Example</h2><p>The following steps generate the files required to implement a Swift command-line executable, build a development version, run unit tests, run it locally, build a production version, and copy it into the PATH:</p><ol><li><code>mkdir mydemo</code></li><li><code>cd mydemo</code></li><li><code>swift package init --type executable</code></li><li><code>swift build</code></li><li><code>swift test</code> to run unit tests</li><li><code>swift run</code> to run as an executable (will print &quot;Hello, World!&quot;)</li><li><code>swift build --configuration release</code></li><li><code>cp -f .build/release/banner /usr/local/bin</code></li><li><code>mydemo</code></li></ol><p>To add command-line argument parsing:</p><ol><li><p>Edit <code>Package.swift</code>.</p></li><li><p>Add the following in the <code>dependencies</code> array:</p><pre class="language-swift"><code class="language-swift"><span class="token punctuation">.</span><span class="token function">package</span><span class="token punctuation">(</span>url<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"https://github.com/apple/swift-argument-parser"</span></span><span class="token punctuation">,</span> from<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"0.0.1"</span></span><span class="token punctuation">)</span></code></pre></li><li><p>In the <code>executableTarget</code> <code>dependencies</code> array, add <code>&quot;ArgumentParser&quot;</code>.</p></li><li><p>Edit the <code>.swift</code> file in the <code>Sources</code> directory.</p></li><li><p>Add <code>import SPMUtility</code>.</p></li><li><p>TODO: Finish this from <a href="https://www.avanderlee.com/swift/command-line-tool-package-manager/">https://www.avanderlee.com/swift/command-line-tool-package-manager/</a></p></li></ol><h2 id="package-contents" tabindex="-1">Package Contents</h2><p>The initial package contents are:</p><ul><li><p><a href="http://README.md">README.md</a></p><p>This is a Markdown file that describes the package. It can include the goals of the package, license information, supported operating systems, supported Swift versions, installation steps, usage information, and contact information.</p></li><li><p>Package.swift</p><p>This is the package manifest file. See the <a href="#manifest-file">Manifest File</a> section below for details.</p></li><li><p>Sources</p><ul><li><p>{package-name}</p><p>This directory holds all the package source files and resources for the main target. Resources include <code>.xcassets</code> files that hold images, <code>.strings</code> and <code>.stringsdict</code> files for localization, Core Data model files, and more.</p><p>If the package defines multiple targets, there will be a separate directory under `Sources for each.</p><ul><li><p>{package-name}.swift</p><p>This is the starting point of the code.</p></li></ul></li></ul></li><li><p>Tests</p><ul><li><p>{package-name}Tests</p><p>This directory holds unit test and integration test source files for the main target that use the XCTest framework.</p><p>If the package defines multiple targets, there will be a separate directory under <code>Tests</code> for each.</p><ul><li><p>{package-name}Tests.swift</p><p>This is an example unit test file.</p></li></ul></li></ul></li></ul><p>Items such as classes, structs, enums, properties, methods, and functions that should be accessible outside of the package must be marked as <code>public</code>. Default memberwise initializers in structs are not <code>public</code>, so it is necessary to add <code>public</code> initializers.</p><h2 id="manifest-file" tabindex="-1">Manifest File</h2><p>The file <code>Package.swift</code> is the package manifest. It contains Swift code the creates a <code>Package</code> object. The <code>Package</code> initializer is passed the following arguments:</p><ul><li><p><code>name</code> is a <code>String</code> that specifies the package name.</p></li><li><p><code>defaultLocalization</code> is a <code>String</code> that specifies the default language.</p></li><li><p><code>platforms</code> is an optional array of <a href="https://developer.apple.com/documentation/packagedescription/supportedplatform?v=1.0.20" rel="noopener" target="_blank">SupportedPlatform</a> instances that describe the operating systems and versions where the package can run. Versions can be specified using predefined constants or strings. For example, <code>[.iOS(.v14), .watchOS(&quot;7.0.0&quot;)]</code>. Other platforms include <code>.macOS</code>, <code>.tvOS</code>, and <code>.linux</code>.</p><p>Packages can be used on all platforms even if they are not listed here. When a platform is omitted from this array, the first version of the platform that supports Swift is assumed to be the minimum supported platform version.</p></li><li><p><code>products</code> is an array of <a href="https://developer.apple.com/documentation/packagedescription/product?v=1.0.20" rel="noopener" target="_blank">Product</a> objects that describe the executables, libraries, and plugins that the package produces.</p></li><li><p><code>dependencies</code> is an array of <a href="https://developer.apple.com/documentation/packagedescription/package/dependency?v=1.0.20" rel="noopener" target="_blank">Package.Dependency</a> objects that describe the packages, including version constraints, on which this package depends.</p></li><li><p><code>targets</code> is an array of <a href="https://developer.apple.com/documentation/packagedescription/target?v=1.0.20" rel="noopener" target="_blank">Target</a> objects that describe the targets this package produces.</p></li></ul><p>This file takes the place of having a <code>.xcodeproj</code> file as is present in applications. It is similar to a <code>package.json</code> file in a Node.js project.</p><p>Here is an example manifest for a package that defines two targets.</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">PackageDescription</span><br><br><span class="token comment">// This specifies the version of Swift Tools the `Package` object assumes and</span><br><span class="token comment">// by association the minimum version of Swift needed to build this package.</span><br><span class="token comment">// Even though it is a comment, Swift Package Manager uses it.</span><br><span class="token comment">// swift-tools-version: 5.7</span><br><br><span class="token keyword">let</span> package <span class="token operator">=</span> <span class="token class-name">Package</span><span class="token punctuation">(</span><br>    name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"RMVGeometry"</span></span><span class="token punctuation">,</span><br>    defaultLocalization<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"en"</span></span><span class="token punctuation">,</span><br>    platforms<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>        <span class="token punctuation">.</span><span class="token function">macOS</span><span class="token punctuation">(</span><span class="token punctuation">.</span>v11<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">iOS</span><span class="token punctuation">(</span><span class="token punctuation">.</span>v14<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">watchOS</span><span class="token punctuation">(</span><span class="token punctuation">.</span>v7<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">tvOS</span><span class="token punctuation">(</span><span class="token punctuation">.</span>v14<span class="token punctuation">)</span><br>    <span class="token punctuation">]</span><span class="token punctuation">,</span><br>    products<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>        <span class="token comment">// Products define the executables and libraries a package produces,</span><br>        <span class="token comment">// and make them visible to other packages.</span><br>        <span class="token punctuation">.</span><span class="token function">library</span><span class="token punctuation">(</span><br>            name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"RMVGeometry"</span></span><span class="token punctuation">,</span><br>            targets<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"RMVCircle"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"RMVGeometry"</span></span><span class="token punctuation">]</span><br>        <span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">]</span><span class="token punctuation">,</span><br>    dependencies<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>        <span class="token comment">// Dependencies describe other packages on which this package depends.</span><br>        <span class="token comment">// For packages in a remote repository ...</span><br>        <span class="token comment">// .package(url: some-url, from: "some-version"),</span><br>        <span class="token comment">// For packages in the local file system ...</span><br>        <span class="token comment">// .package(url: some-file-path, from: "some-version"),</span><br>        <span class="token comment">// some-file-path can be absolute or relative.</span><br>        <span class="token comment">// Relative paths are preferred so they can</span><br>        <span class="token comment">// remain valid in a CI/CD environment.</span><br>    <span class="token punctuation">]</span><span class="token punctuation">,</span><br>    targets<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>        <span class="token comment">// A target can define a module or a test suite.</span><br>        <span class="token comment">// Targets can depend on other targets in this package,</span><br>        <span class="token comment">// and on products in packages this package depends on.</span><br>        <span class="token punctuation">.</span><span class="token function">target</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"RMVCircle"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token punctuation">.</span><span class="token function">testTarget</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"RMVCircleTests"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token punctuation">.</span><span class="token function">target</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"RMVGeometry"</span></span><span class="token punctuation">,</span> dependencies<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token punctuation">.</span><span class="token function">testTarget</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"RMVGeometryTests"</span></span><span class="token punctuation">,</span> dependencies<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"RMVGeometry"</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token punctuation">]</span><br><span class="token punctuation">)</span></code></pre><h2 id="building-a-package" tabindex="-1">Building a Package</h2><p>Building a package begins by downloading all of its remote dependencies recursively.</p><p>To build a package from the command-line, enter <code>swift build</code>.</p><p>To build a package inside Xcode, select Product ... Build or press cmd-b.</p><h2 id="documentation" tabindex="-1">Documentation</h2><p>Package documentation is provided by the README .md file and by <a href="/blog/topics/#/blog/swift/DocC/?v=1.0.20" rel="noopener" target="_blank">DocC</a> comments in the code.</p><h2 id="available-features" tabindex="-1">Available Features</h2><p>To state that items in a library should only be available in applications that require at least a certain version of iOS, add an <code>@available(iOS {version}, *)</code> attribute before the item definition where <code>{version}</code> is an iOS version like <code>16.0</code>. This is alway needed when an item uses SwiftUI.</p><h2 id="using-github" tabindex="-1">Using GitHub</h2><p>Swift packages are frequently stored in a GitHub repository. Each package must be in its own repository. To create a GitHub repository for a new package inside Xcode:</p><ul><li><p>Quit Xcode.</p></li><li><p>If the package directory is inside a project directory that has a git repository, move the package directory to a new location.</p></li><li><p>In the Finder, locate the <code>Package.swift</code> file of the package.</p></li><li><p>Double-click this file in the Finder to open an Xcode window that only shows the files in the package.</p></li><li><p>Select the &quot;<a href="http://README.md">README.md</a>&quot; file and add details.</p></li><li><p>Select Source Control ... New Git Repository...</p></li><li><p>Click the &quot;Create&quot; button.</p></li><li><p>If your GitHub account has not already been associated with Xcode:</p><ul><li>Select Xcode ... Settings...</li><li>Select the &quot;Accounts&quot; tab.</li><li>Click the &quot;+&quot; button in the lower-left.</li><li>In the dialog that appears, select &quot;GitHub&quot;.</li><li>Click the &quot;Continue&quot; button.</li><li>Enter a GitHub account name.</li><li>Paste in a personal access token for the account.</li><li>Click the &quot;Sign In&quot; button.</li></ul></li><li><p>Open the Source Control Navigator which is the second Navigator tab.</p></li><li><p>Click the &quot;Repositories&quot; tab.</p></li><li><p>Right-click the top entry and select &quot;New {package-name} Remote...&quot;.</p></li><li><p>In the dialog that appears, verify the account, enter a description, and choose &quot;Public&quot; or &quot;Private&quot;.</p></li><li><p>Click the &quot;Create&quot; button.</p></li><li><p>Select the Source Control Navigator (2nd tab).</p></li><li><p>Select the &quot;Repositories&quot; tab.</p></li></ul><p>Package versions are specified with Git tags that are semantic version numbers. To add a tag to the current commit of a Swift package:</p><ul><li>Open the Source Control Navigator which is the second Navigator tab.</li><li>Click the &quot;Repositories&quot; tab.</li><li>Expand the &quot;Tags&quot; section to see the existing tags.</li><li>Right-click the top entry and select &quot;Tag {branch-name}...&quot; where branch-name is typically &quot;main&quot;.</li><li>In the dialog that appears, enter a semantic version number that is higher than the previous tag (ex. 1.2.3).</li><li>Optionally enter a description in the Message input.</li><li>Click the Create button.</li><li>Select Source Control ... Push...</li><li>In the dialog that appears, check the &quot;Include Tags&quot; checkbox and click the &quot;Push&quot; button.</li></ul><p>For each new version of the package to be published, commit the changes, tag the commit, and push it as described above.</p><p>To view the GitHub repository in your default web browser:</p><ul><li>Open the Source Control Navigator which is the second Navigator tab.</li><li>Click the &quot;Repositories&quot; tab.</li><li>Right-click the top entry and select &quot;View on GitHub...&quot;.</li></ul><h2 id="finding-packages" tabindex="-1">Finding Packages</h2><p>There is no official package index similar to <a href="https://www.npmjs.com?v=1.0.20" rel="noopener" target="_blank">npmjs</a> for Node.js packages. <a href="https://swiftpackageindex.com?v=1.0.20" rel="noopener" target="_blank">Swift Package Index</a> is an unofficial index where you can search for open source packages. As of January 7, 2023 it provides information on 5,306 packages.</p><h2 id="using-packages" tabindex="-1">Using Packages</h2><p>To use a package in an application or other package:</p><ul><li><p>Open the application or package that will use the package in Xcode.</p></li><li><p>Select File ... Add Packages... .</p><p>Alternatively this longer set of steps can be used:</p><ul><li>Select the top entry in the Project Navigator.</li><li>Select the project.</li><li>Click the &quot;Package Dependencies&quot; tab.</li><li>Click the &quot;+&quot; button at the bottom.</li></ul></li><li><p>Paste the Git URL into the search input. This renders the Markdown found in the <code>README.md</code> file of the package. TODO: Why doesn't this work for many packages including <code>RMVGeometry</code> package?</p></li><li><p>In the &quot;Dependency Rule&quot; dropdown, select one of the following options where the repository tags are semantic version numbers:</p><ul><li>Version: Up to Next Major - latest tag with a specified major version (most common)</li><li>Version: Up to Next Minor - latest tag with a specified major.minor version</li><li>Version: Range - latest tag in a specified range</li><li>Version: Exact - specific tag</li><li>Branch: latest commit on a specific branch</li><li>Commit: specific commit</li></ul></li><li><p>Enter a semantic version number.</p></li><li><p>Click the &quot;Add Package&quot; button.</p></li><li><p>In the confirmation dialog that appears, click a second &quot;Add Package&quot; button.</p></li><li><p>In source files that will use the package, import the desired package targets.</p></li><li><p>Add code that uses the public types, functions, and values defined in the imported package targets.</p></li></ul><p>To update the version of all package dependencies, select File ... Packages ... Update to Latest Package Versions.</p><p>To update the version of a specific package dependency:</p><ul><li>Open the Project Navigator.</li><li>Under &quot;Package Dependencies&quot;, find the package and right-click it.</li><li>Select &quot;Update Package&quot;.</li></ul><p>To see source code for a package dependency:</p><ul><li>Open the Project Navigator.</li><li>Under &quot;Package Dependencies&quot;, find the package and expand it.</li><li>Expand the &quot;Sources&quot; directory.</li><li>Click a source file to view it.</li></ul><p>In source files that wish to use a package, import one or more targets defined by the package. Often a package defines a single target whose name is the same as that of the package. But the names do not always match, especially when a package defines multiple targets.</p><h2 id="updating-packages" tabindex="-1">Updating Packages</h2><p>To update the version of a single package dependency to the latest version that is compatible with the dependency rule for specified for the package, right-click the dependency near the bottom of the Project Navigator and select &quot;Update Package&quot;.</p><p>To update the version of all of the application dependencies, select File ... Packages ... Update to Latest Package Versions.</p><p>Application projects contain the file <code>{project-name}.xcodeproj/project.xcworkspace/xcshareddata/swiftpm/Package.resolved</code>. This file records the exact version of each package dependency being used. It is similar to a <code>package-lock.json</code> file in a Node.js project.</p><p>The <code>Package.resolved</code> file can be checked into version control to enable all developers on a team to use the same versions of all the dependencies. This file is updated when a new package dependency is added and when an existing package dependency is updated.</p><p>Other options in the File ... Packages menu include:</p><ul><li><p>Reset Package Caches</p><p>This deletes all local package data and downloads all the dependencies again from their Git repositories. Sometimes this can be used to resolve odd build errors.</p></li><li><p>Resolve Package Versions</p><p>This updates the version of each dependency being used to be the version specified in the <code>Package.resolved</code> file. It is useful when another team member has updated that file.</p></li></ul><h2 id="adding-assets" tabindex="-1">Adding Assets</h2><p>To add assets such as color sets and image sets to a package:</p><ul><li><p>For a target the will use assets, right-click the target folder under the <code>Sources</code> folder.</p></li><li><p>Select &quot;New Folder&quot;.</p></li><li><p>Name the new folder <code>Resources</code>.</p></li><li><p>Right-click the new <code>Resources</code> folder.</p></li><li><p>Select &quot;New File...&quot;.</p></li><li><p>Select &quot;Asset Catalog&quot;.</p></li><li><p>Click the &quot;Next&quot; button.</p></li><li><p>The file <code>Media.xcassets</code> will be added.</p></li><li><p>Add image and color sets in the same way as adding them to <code>Assets.xcassets</code> in an application.</p></li><li><p>Edit the manifest file <code>Package.swift</code>.</p></li><li><p>Add an argument like the following to the <code>.target</code> call for the target:</p><pre class="language-swift"><code class="language-swift">resources<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"{TargetName}/Resources/Media.xcassets"</span></span><span class="token punctuation">)</span><br><span class="token punctuation">]</span></code></pre><p>The <code>process</code> method optimizes resources when possible. If it is passed a directory name, it process flattens the folder structure so all files in and below the directory appear to be in its parent directory.</p><p>The <code>copy</code> method can be used in place of the <code>process</code> method. It does not optimize the resource at the path passed to it and copies the resource as-is in the bundle. If it is passed a directory name, it retains the file structure of that directory.</p></li><li><p>Build the package and verify that there are no errors.</p></li><li><p>Commit and push the changes to Git.</p></li><li><p>Tag the commit and push the new tag.</p></li></ul><p>Here is an example of a package method that returns a SwiftUI <code>Image</code>:</p><pre class="language-swift"><code class="language-swift">    <span class="token keyword">public</span> <span class="token keyword">func</span> <span class="token function-definition function">comet</span><span class="token punctuation">(</span>size<span class="token punctuation">:</span> <span class="token class-name">Double</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>        <span class="token comment">// This looks for the image inside the .xcassets file in this package</span><br>        <span class="token comment">// instead of looking in the .xcassets file of the using application.</span><br>        <span class="token class-name">Image</span><span class="token punctuation">(</span>uiImage<span class="token punctuation">:</span> <span class="token class-name">UIImage</span><span class="token punctuation">(</span>named<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Comet"</span></span><span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>module<span class="token punctuation">,</span> with<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">scaledToFit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> size<span class="token punctuation">,</span> height<span class="token punctuation">:</span> size<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span></code></pre><h2 id="unit-tests" tabindex="-1">Unit Tests</h2><p>Unit tests enables verifying the functionality of a package before deploying the initial version or changes to it.</p><p>Unit tests for a package reside in the <code>Tests/{package-name}Tests</code> directory.</p><p>The <code>@testable</code> attribute can be applied to an <code>import</code> statement. It raises the access level of the types exposed by the imported target. For example, imported types that have an access level of <code>internal</code> are treated as though they have an access level of <code>public</code>. This enables writing tests for them.</p><p>Tests must be implemented as methods inside a <code>class</code> that inherits from <a href="https://developer.apple.com/documentation/xctest/xctestcase?v=1.0.20" rel="noopener" target="_blank">XCTestCase</a>. The methods must have names that begin with &quot;test&quot;.</p><p>For example, the file <code>IconTests.swift</code> below comes from the package GitHub repository <a href="https://github.com/mvolkmann/RMVSwiftUIViews?v=1.0.20" rel="noopener" target="_blank">RMVSwiftUIViews</a>.</p><pre class="language-swift"><code class="language-swift"><span class="token attribute atrule">@testable</span> <span class="token keyword">import</span> <span class="token class-name">RMVSwiftUIViews</span><br><span class="token keyword">import</span> <span class="token class-name">XCTest</span><br><br><span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">IconTests</span><span class="token punctuation">:</span> <span class="token class-name">XCTestCase</span> <span class="token punctuation">{</span><br>    <span class="token keyword">func</span> <span class="token function-definition function">testEnumCases</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span><br>        <span class="token class-name">XCTAssertEqual</span><span class="token punctuation">(</span><span class="token class-name">Icon</span><span class="token punctuation">.</span>baseball<span class="token punctuation">.</span>rawValue<span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"baseball"</span></span><span class="token punctuation">)</span><br>        <span class="token class-name">XCTAssertEqual</span><span class="token punctuation">(</span><span class="token class-name">Icon</span><span class="token punctuation">.</span>bell<span class="token punctuation">.</span>rawValue<span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"sf-bell"</span></span><span class="token punctuation">)</span><br>        <span class="token class-name">XCTAssertEqual</span><span class="token punctuation">(</span><span class="token class-name">Icon</span><span class="token punctuation">.</span>thumbsUp<span class="token punctuation">.</span>rawValue<span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"sf-hand.thumbsup"</span></span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>The file <code>IconToggleTests.swift</code> below comes from the same package GitHub repository. It demonstrates creating an instance of a custom <code>View</code> in a test, including passing it a <code>Binding</code>.</p><pre class="language-swift"><code class="language-swift"><span class="token attribute atrule">@testable</span> <span class="token keyword">import</span> <span class="token class-name">RMVSwiftUIViews</span><br><span class="token keyword">import</span> <span class="token class-name">SwiftUI</span><br><span class="token keyword">import</span> <span class="token class-name">XCTest</span><br><br><span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">RMVSwiftUIViewsTests</span><span class="token punctuation">:</span> <span class="token class-name">XCTestCase</span> <span class="token punctuation">{</span><br>    <span class="token keyword">func</span> <span class="token function-definition function">testDefaultParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span><br>        <span class="token keyword">var</span> bindingValue <span class="token operator">=</span> <span class="token boolean">false</span><br>        <span class="token keyword">let</span> binding <span class="token operator">=</span> <span class="token class-name">Binding</span><span class="token punctuation">(</span><br>            <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> bindingValue <span class="token punctuation">}</span><span class="token punctuation">,</span><br>            <span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> bindingValue <span class="token operator">=</span> <span class="token short-argument">$0</span> <span class="token punctuation">}</span><br>        <span class="token punctuation">)</span><br>        <span class="token keyword">let</span> view <span class="token operator">=</span> <span class="token class-name">IconToggle</span><span class="token punctuation">(</span>icon<span class="token punctuation">:</span> <span class="token punctuation">.</span>football<span class="token punctuation">,</span> isOn<span class="token punctuation">:</span> binding<span class="token punctuation">)</span><br>        <span class="token class-name">XCTAssertEqual</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span>color<span class="token punctuation">,</span> <span class="token class-name">Color</span><span class="token punctuation">.</span>black<span class="token punctuation">)</span><br>        <span class="token class-name">XCTAssertEqual</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span>size<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">func</span> <span class="token function-definition function">testSuppliedParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span><br>        <span class="token keyword">var</span> bindingValue <span class="token operator">=</span> <span class="token boolean">false</span><br>        <span class="token keyword">let</span> binding <span class="token operator">=</span> <span class="token class-name">Binding</span><span class="token punctuation">(</span><br>            <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> bindingValue <span class="token punctuation">}</span><span class="token punctuation">,</span><br>            <span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> bindingValue <span class="token operator">=</span> <span class="token short-argument">$0</span> <span class="token punctuation">}</span><br>        <span class="token punctuation">)</span><br>        <span class="token keyword">let</span> color<span class="token punctuation">:</span> <span class="token class-name">Color</span> <span class="token operator">=</span> <span class="token punctuation">.</span>red<br>        <span class="token keyword">let</span> size <span class="token operator">=</span> <span class="token number">50.0</span><br>        <span class="token keyword">let</span> view <span class="token operator">=</span> <span class="token class-name">IconToggle</span><span class="token punctuation">(</span><br>            icon<span class="token punctuation">:</span> <span class="token punctuation">.</span>football<span class="token punctuation">,</span><br>            color<span class="token punctuation">:</span> color<span class="token punctuation">,</span><br>            size<span class="token punctuation">:</span> size<span class="token punctuation">,</span><br>            isOn<span class="token punctuation">:</span> binding<br>        <span class="token punctuation">)</span><br>        <span class="token class-name">XCTAssertEqual</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span>color<span class="token punctuation">,</span> color<span class="token punctuation">)</span><br>        <span class="token class-name">XCTAssertEqual</span><span class="token punctuation">(</span>view<span class="token punctuation">.</span>size<span class="token punctuation">,</span> size<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>To run all of the tests in a package inside Xcode, select Product ... Test or press cmd-u.</p><p>To run a specific test function, click the diamond icon to the left of the first line in the function definition These can be found in the left gutter where line numbers typically appear. If no diamond icons appear, close the test source file and open it again. If the test passes, the diamond will turn green with a white checkmark inside. If the test fails, the diamond will turn red with a white &quot;X&quot; inside.</p><p>To run all the tests in an <code>XCTestCase</code> subclass, click the diamond icon to the left of the first line in the class definition.</p><p>Tests can also be run from the Test Navigator which is the sixth navigator tab. To run a specific test function, click the diamond icon to the right of the function name. To run all the tests in an <code>XCTestCase</code> subclass, click the diamond icon to the right of the class name.</p><p>For packages that target macOS or Linux (not other platforms like iOS), the following commands can be run from the command-line. To list all of the tests in a package, enter <code>swift test --list-tests</code> or <code>swift test -l</code>. To run all of the tests in a package, enter <code>swift test</code>. To run the tests in parallel, add the <code>--parallel</code> option.</p><p>To run tests in a specific iOS or watchOS Simulator, create a shell script containing the following command. TODO: Can this script can be used to run the tests in a headless fashion in a CI/CD server?</p><pre class="language-bash"><code class="language-bash">xcodebuild <span class="token punctuation">\</span><br>  <span class="token parameter variable">-scheme</span> RMVSwiftUIViews <span class="token punctuation">\</span><br>  <span class="token parameter variable">-sdk</span> iphonesimulator <span class="token punctuation">\</span><br>  <span class="token parameter variable">-destination</span> <span class="token string">'platform=iOS Simulator,name=iPhone 14 Pro,OS=16.2'</span> <span class="token punctuation">\</span><br>  <span class="token builtin class-name">test</span></code></pre><p>The XCTest framework relies on the Objective-C runtime to find the test methods to be run. When running in Linux, this is not available. In a Linux environment it is necessary to define a static variable named <code>allTests</code> that is set to an array of strings that are the names of the test methods to run. This array must be updated whenever new test methods are added. It is possible to automate this by running the command <code>swift test --generate-linuxmain</code>.</p><h2 id="resources" tabindex="-1">Resources</h2><p>A package can include resources that are files other that Swift source files. These include <code>.xcassets</code> files that hold images, <code>.strings</code> and <code>.stringsdict</code> files for localization, Core Data model files, and more.</p><p>The following <code>package.swift</code> manifest file from the <a href="https://github.com/mvolkmann/RMVSwiftUIViews?v=1.0.20" rel="noopener" target="_blank">RMVSwiftUIViews</a> package demonstrates including the file <code>Assets.xcassets</code> which contains several Image Sets. Note the line that begins with &quot;resources:&quot;.</p><pre class="language-swift"><code class="language-swift"><span class="token comment">// swift-tools-version: 5.7</span><br><span class="token keyword">import</span> <span class="token class-name">PackageDescription</span><br><br><span class="token keyword">let</span> package <span class="token operator">=</span> <span class="token class-name">Package</span><span class="token punctuation">(</span><br>    name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"RMVSwiftUIViews"</span></span><span class="token punctuation">,</span><br>    platforms<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token function">iOS</span><span class="token punctuation">(</span><span class="token punctuation">.</span>v13<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>    products<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>        <span class="token comment">// This package defines a single library that defines a single target.</span><br>        <span class="token punctuation">.</span><span class="token function">library</span><span class="token punctuation">(</span><br>            name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"RMVSwiftUIViews"</span></span><span class="token punctuation">,</span><br>            targets<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"RMVSwiftUIViews"</span></span><span class="token punctuation">]</span><br>        <span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">]</span><span class="token punctuation">,</span><br>    dependencies<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// This package doesn't depend on any others.</span><br>    targets<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>        <span class="token comment">// This target will be imported by apps.</span><br>        <span class="token punctuation">.</span><span class="token function">target</span><span class="token punctuation">(</span><br>            name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"RMVSwiftUIViews"</span></span><span class="token punctuation">,</span><br>            dependencies<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>            resources<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Assets.xcassets"</span></span><span class="token punctuation">)</span><span class="token punctuation">]</span><br>        <span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token comment">// This target contains unit tests for the target above.</span><br>        <span class="token punctuation">.</span><span class="token function">testTarget</span><span class="token punctuation">(</span><br>            name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"RMVSwiftUIViewsTests"</span></span><span class="token punctuation">,</span><br>            dependencies<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"RMVSwiftUIViews"</span></span><span class="token punctuation">]</span><br>        <span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">]</span><br><span class="token punctuation">)</span></code></pre><p>The following method from the <code>Icon</code> <code>enum</code> defined in this package demonstrates getting images from both the package bundle and the bundle of an app that uses this package.</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">func</span> <span class="token function-definition function">image</span><span class="token punctuation">(</span>fill<span class="token punctuation">:</span> <span class="token class-name">Bool</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Image</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> suffix <span class="token operator">=</span> fill <span class="token operator">?</span> <span class="token string-literal"><span class="token string">".fill"</span></span> <span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">""</span></span><br>    <span class="token keyword">if</span> rawValue<span class="token punctuation">.</span><span class="token keyword">prefix</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string-literal"><span class="token string">"sf-"</span></span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> systemName <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">(</span>rawValue<span class="token punctuation">.</span><span class="token function">dropFirst</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> suffix<br>        <span class="token keyword">return</span> <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> systemName<span class="token punctuation">)</span> <span class="token comment">// gets from SF Symbols</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> rawValue <span class="token operator">==</span> <span class="token string-literal"><span class="token string">"custom"</span></span> <span class="token operator">?</span><br>        <span class="token class-name">Image</span><span class="token punctuation">(</span>rawValue <span class="token operator">+</span> suffix<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token comment">// gets from the app bundle</span><br>        <span class="token class-name">Image</span><span class="token punctuation">(</span>rawValue <span class="token operator">+</span> suffix<span class="token punctuation">,</span> bundle<span class="token punctuation">:</span> <span class="token punctuation">.</span>module<span class="token punctuation">)</span> <span class="token comment">// gets from this bundle</span><br><span class="token punctuation">}</span></code></pre><p>To add a text file to the package as a resource, modify the <code>resources</code> array passed to the first target in <code>package.swift</code> as follows:</p><pre class="language-swift"><code class="language-swift">            resources<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>                <span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Assets.xcassets"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>                <span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"demo.csv"</span></span><span class="token punctuation">)</span> <span class="token comment">// a text file</span><br>            <span class="token punctuation">]</span></code></pre><p>Alternatively, place all the resource files in a subdirectory of the package named <code>Resources</code> and make the following change to the <code>resources</code> array. With this change, additional resource files can be added in the <code>Resources</code> directory and it will not be necessary to add a reference to each one in <code>package.swift</code>.</p><pre class="language-swift"><code class="language-swift">            resources<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>                <span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Assets.xcassets"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>                <span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Resources"</span></span><span class="token punctuation">)</span><br>            <span class="token punctuation">]</span><br></code></pre><p>See the discussion about the differences between the <code>process</code> and <code>copy</code> methods in the <a href="#adding-assets">Adding Assets</a> section.</p><p>To read the resource text file from code in the package:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">let</span> filePath <span class="token operator">=</span> <span class="token class-name">Bundle</span><span class="token punctuation">.</span>module<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><br>    forResource<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"myFileName"</span></span><span class="token punctuation">,</span><br>    ofType<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"csv"</span></span><br><span class="token punctuation">)</span><br><span class="token keyword">if</span> <span class="token keyword">let</span> filePath <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> contents <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">String</span><span class="token punctuation">(</span>contentsOfFile<span class="token punctuation">:</span> filePath<span class="token punctuation">)</span><br>    <span class="token comment">// Do something with contents.</span><br><span class="token punctuation">}</span></code></pre><h2 id="excluding-resources" tabindex="-1">Excluding Resources</h2><p>Some files that are part of the package project do not need to be included in the bundle that is produced. These include documentation files, code examples, and shell scripts, but not files used in unit tests.</p><p>To exclude specific files from the bundle, add an <code>exclude</code> argument to the <code>target</code> method whose value is an array of relative file path strings. For example:</p><pre class="language-swift"><code class="language-swift">        <span class="token punctuation">.</span><span class="token function">target</span><span class="token punctuation">(</span><br>            <span class="token operator">...</span><br>            exclude<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"notes.md"</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>            <span class="token operator">...</span><br>        <span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre><h2 id="localized-resources" tabindex="-1">Localized Resources</h2><p>To include a resource that requires a different file for each supported language, add one directory inside the <code>Sources/{package-name}</code> directory for each language with the name <code>{language-code}.lproj</code>. For example, <code>en.lproj</code> for English and <code>fr.lproj</code> for French. Then add files in these directories where the corresponding files have the same name (ex. <code>message.txt</code>).</p><figure style="width: 40%"><img alt="SwiftUI Package Localized Resources" src="/blog/assets/swiftui-package-localized-resources.png?v=1.0.20" title="Swift Package Localized Resources"><figcaption>Swift Package Localized Resources</figcaption></figure><p>Note that there is a <code>message.txt</code> file for each supported language. The file in the <code>en.lproj</code> directory contains &quot;Hello&quot;. The file in the <code>es.lproj</code> directory contains &quot;Hola&quot;. The file in the <code>fr.lproj</code> directory contains &quot;Bonjour&quot;.</p><p>The <code>.lproj</code> directories cannot contain subdirectories.</p><p>The <code>package.swift</code> manifest file is required to specify <code>defaultLocalization</code> when there are localized resources. For example, <code>defaultLocalization: &quot;en&quot;,</code>.</p><p>It seems there is no way to change the locale used by a test inside the test code. To change the locale that will be used when tests are run:</p><ul><li>Click the scheme dropdown to the left of the device dropdown at the top of the Xcode window.</li><li>Select &quot;Edit Scheme...&quot;</li><li>In the left nav, select &quot;Test&quot;.</li><li>Select the &quot;Options&quot; tab.</li><li>Select a language in the &quot;App Language&quot; dropdown.</li></ul><p>The following code defines a function to be tested. It reads and returns the contents of a localized resource file.</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Foundation</span><br><br><span class="token keyword">extension</span> <span class="token class-name">String</span><span class="token punctuation">:</span> <span class="token class-name">LocalizedError</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Allows String values to be thrown.</span><br>    <span class="token keyword">public</span> <span class="token keyword">var</span> errorDescription<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token operator">?</span> <span class="token punctuation">{</span> <span class="token keyword">self</span> <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">public</span> <span class="token keyword">func</span> <span class="token function-definition function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> filePath <span class="token operator">=</span> <span class="token class-name">Bundle</span><span class="token punctuation">.</span>module<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span>forResource<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"message"</span></span><span class="token punctuation">,</span> ofType<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"txt"</span></span><span class="token punctuation">)</span><br>    <span class="token keyword">guard</span> <span class="token keyword">let</span> filePath <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token string-literal"><span class="token string">"file not found"</span></span> <span class="token punctuation">}</span><br>    <span class="token keyword">let</span> line <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">String</span><span class="token punctuation">(</span>contentsOfFile<span class="token punctuation">:</span> filePath<span class="token punctuation">)</span><br>    <span class="token keyword">return</span> line<span class="token punctuation">.</span><span class="token function">trimmingCharacters</span><span class="token punctuation">(</span><span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>whitespacesAndNewlines<span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre><p>The following test code demonstrates detecting the current language and using it to determine the expected value. Run this test once for each supported language by following the steps above to select the language to use.</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">LocalizeTests</span><span class="token punctuation">:</span> <span class="token class-name">XCTestCase</span> <span class="token punctuation">{</span><br>    <span class="token keyword">func</span> <span class="token function-definition function">testMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> lang <span class="token operator">=</span> <span class="token class-name">Locale</span><span class="token punctuation">.</span>preferredLanguages<span class="token punctuation">.</span>first<br>        <span class="token keyword">guard</span> <span class="token keyword">let</span> lang <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token string-literal"><span class="token string">"language not set"</span></span> <span class="token punctuation">}</span><br>        <span class="token keyword">let</span> actual <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token keyword">let</span> expected <span class="token operator">=</span><br>            lang <span class="token operator">==</span> <span class="token string-literal"><span class="token string">"en"</span></span> <span class="token operator">?</span> <span class="token string-literal"><span class="token string">"Hello"</span></span> <span class="token punctuation">:</span><br>            lang <span class="token operator">==</span> <span class="token string-literal"><span class="token string">"es"</span></span> <span class="token operator">?</span> <span class="token string-literal"><span class="token string">"Hola"</span></span> <span class="token punctuation">:</span><br>            lang <span class="token operator">==</span> <span class="token string-literal"><span class="token string">"fr"</span></span> <span class="token operator">?</span> <span class="token string-literal"><span class="token string">"Bonjour"</span></span> <span class="token punctuation">:</span><br>            <span class="token string-literal"><span class="token string">"unsupported language </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">lang</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><br>        <span class="token class-name">XCTAssertEqual</span><span class="token punctuation">(</span>actual<span class="token punctuation">,</span> expected<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre></article>