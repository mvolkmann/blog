<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Swift Package Manager</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#creating-a-package">Creating a Package</a></li><li><a href="#package-contents">Package Contents</a></li><li><a href="#manifest-file">Manifest File</a></li><li><a href="#available-features">Available Features</a></li><li><a href="#using-github">Using GitHub</a></li><li><a href="#using-a-package">Using a Package</a></li><li><a href="#updating-packages">Updating Packages</a></li><li><a href="#adding-assets-to-a-package">Adding Assets to a Package</a></li></ol></nav></aside><article><h2 id="overview">Overview</h2><p><a href="https://www.swift.org/package-manager/?v=1.0.20" rel="noopener" target="_blank">Swift Package Manager</a> (SPM) provides a standard way to define and use software packages in Swift applications. Packages can contain unit tests and can depend of other packages.</p><p>Packages typically reside in their own Git repository. These repositories can be public or private.</p><p>Dependencies on packages are expressed using Git URLs.</p><h2 id="creating-a-package">Creating a Package</h2><p>To create a new package in Xcode:</p><ul><li>Select File ... New ... Package... .</li><li>Enter a name for the package.</li><li>Select the directory where it will be stored.</li><li>Click the Create button.</li></ul><h2 id="package-contents">Package Contents</h2><p>The initial package contents are:</p><ul><li><p><a href="http://README.md">README.md</a></p><p>Enter a description of the package and usage instructions here.</p></li><li><p>Package.swift</p><p>This defines the package name, products, dependencies, and targets. It is referred to as the &quot;manifest file&quot; and takes the place of having a <code>.xcodeproj</code> file as is present in applications.</p></li><li><p>Sources</p><ul><li><p>{PackageName}</p><ul><li><p>{PackageName}.swift</p><p>This is the starting point of the code.</p></li></ul></li></ul></li><li><p>Tests</p><ul><li><p>{PackageName}Tests</p><ul><li><p>{PackageName}Tests.swift</p><p>This contains unit test code that uses XCTest.</p></li></ul></li></ul></li></ul><p>Items that should be accessible must be marked as <code>public</code>. Note that default memberwise initializers in structs are not <code>public</code>, so it is necessary to add <code>public</code> initializers.</p><h2 id="manifest-file">Manifest File</h2><p>The file <code>Package.swift</code> is the package manifest. It lists all the source files to be included and the packages on which this package depends.</p><p>Here is an example manifest for a package that defines two targets.</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">PackageDescription</span><br><br><span class="token keyword">let</span> package <span class="token operator">=</span> <span class="token class-name">Package</span><span class="token punctuation">(</span><br>    name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"RMVGeometry"</span></span><span class="token punctuation">,</span><br>    products<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>        <span class="token comment">// Products define the executables and libraries a package produces,</span><br>        <span class="token comment">// and make them visible to other packages.</span><br>        <span class="token punctuation">.</span><span class="token function">library</span><span class="token punctuation">(</span><br>            name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"RMVGeometry"</span></span><span class="token punctuation">,</span><br>            targets<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"RMVCircle"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"RMVGeometry"</span></span><span class="token punctuation">]</span><br>        <span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">]</span><span class="token punctuation">,</span><br>    dependencies<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>        <span class="token comment">// Dependencies declare other packages that this package depends on.</span><br>        <span class="token comment">// .package(url: /* package url */, from: "1.0.0"),</span><br>    <span class="token punctuation">]</span><span class="token punctuation">,</span><br>    targets<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>        <span class="token comment">// A target can define a module or a test suite.</span><br>        <span class="token comment">// Targets can depend on other targets in this package,</span><br>        <span class="token comment">// and on products in packages this package depends on.</span><br>        <span class="token punctuation">.</span><span class="token function">target</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"RMVCircle"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token punctuation">.</span><span class="token function">testTarget</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"RMVCircleTests"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token punctuation">.</span><span class="token function">target</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"RMVGeometry"</span></span><span class="token punctuation">,</span> dependencies<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token punctuation">.</span><span class="token function">testTarget</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"RMVGeometryTests"</span></span><span class="token punctuation">,</span> dependencies<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"RMVGeometry"</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token punctuation">]</span><br><span class="token punctuation">)</span></code></pre><h2 id="available-features">Available Features</h2><p>To state that items in a library should only be available in applications that require at least a certain version of iOS, add an <code>@available(iOS {version}, *)</code> attribute before the item definition where <code>{version}</code> is an iOS version like <code>16.0</code>. This is alway needed when an item uses SwiftUI.</p><h2 id="using-github">Using GitHub</h2><p>Swift packages are frequently stored in a GitHub repository. Package versions are specified with Git tags that are semantic version numbers. To add a tag to the current commit of a Swift package:</p><ul><li>Open the Source Control Navigator which is the second Navigator tab.</li><li>Click the &quot;Repositories&quot; tab.</li><li>Expand the &quot;Tabs&quot; section to see the existing tags.</li><li>Right-click the top entry and select &quot;Tag {branch-name}...&quot;.</li><li>In the dialog that appears, enter a semantic version number that is higher than the previous tag (ex. 1.2.3).</li><li>Optionally enter a description in the Message input.</li><li>Click the Create button.</li></ul><p>The new tag only exists in the local repository. To push it to the remote repository, open a terminal window and enter <code>git push origin --tags</code>.</p><h2 id="using-a-package">Using a Package</h2><p>To use a package from an application or other package:</p><ul><li><p>Open the application or package that will use the package in Xcode.</p></li><li><p>Select File ... Add Packages... .</p><p>Alternatively this longer set of steps can be used:</p><ul><li>Select the top entry in the Navigator.</li><li>Select the project.</li><li>Click the &quot;Package Dependencies&quot; tab.</li><li>Click the &quot;+&quot; button at the bottom.</li></ul></li><li><p>Paste the Git URL into the search input.</p></li><li><p>In the &quot;Dependency Rule&quot; dropdown, select one of the following options where the repository tags are semantic version numbers:</p><ul><li>Version: Up to Next Major - latest tag with a specified major version</li><li>Version: Up to Next Minor - latest tag with a specified major.minor version</li><li>Version: Range - latest tag in a specified range</li><li>Version: Exact - specific tag</li><li>Branch: latest commit on a specific branch</li><li>Commit: specific commit</li></ul></li><li><p>Enter a semantic version number.</p></li><li><p>Click the &quot;Add Package&quot; button.</p></li><li><p>In the confirmation dialog that appears, click a second &quot;Add Package&quot; button.</p></li><li><p>In source files that will use the package, import the desired package targets.</p></li><li><p>Add code that uses the public types, functions, and values defined in the imported package targets.</p></li></ul><h2 id="updating-packages">Updating Packages</h2><p>To modify an application to use the latest version of all of its dependencies, compatible with the selected dependency rule for each, select File ... Packages ... Update to Latest Package Versions.</p><h2 id="adding-assets-to-a-package">Adding Assets to a Package</h2><p>To add assets such as color sets and image sets to a package:</p><ul><li><p>For a target the will use assets, right-click the target folder under the <code>Sources</code> folder.</p></li><li><p>Select &quot;New Folder&quot;.</p></li><li><p>Name the new folder <code>Resources</code>.</p></li><li><p>Right-click the new <code>Resources</code> folder.</p></li><li><p>Select &quot;New File...&quot;.</p></li><li><p>Select &quot;Asset Catalog&quot;.</p></li><li><p>Click the &quot;Next&quot; button.</p></li><li><p>The file <code>Media.xcassets</code> will be added.</p></li><li><p>Add image and color sets in the same way as adding them to <code>Assets.xcassets</code> in an application.</p></li><li><p>Edit the manifest file <code>Package.swift</code>.</p></li><li><p>Add an argument like the following to the <code>.target</code> call for the target:</p><pre class="language-swift"><code class="language-swift">resources<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"{TargetName}/Resources/Media.xcassets"</span></span><span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre></li><li><p>Build the package and verify that there are no errors.</p></li><li><p>Commit and push the changes to Git.</p></li><li><p>Tag the commit and push the new tag.</p></li></ul><p>Here is an example of a package method that returns a SwiftUI <code>Image</code>:</p><pre class="language-swift"><code class="language-swift">    <span class="token keyword">public</span> <span class="token keyword">func</span> <span class="token function-definition function">comet</span><span class="token punctuation">(</span>size<span class="token punctuation">:</span> <span class="token class-name">Double</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>        <span class="token comment">// This looks for the image inside the .xcassets file in this package</span><br>        <span class="token comment">// instead of looking in the .xcassets file of the using application.</span><br>        <span class="token class-name">Image</span><span class="token punctuation">(</span>uiImage<span class="token punctuation">:</span> <span class="token class-name">UIImage</span><span class="token punctuation">(</span>named<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Comet"</span></span><span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>module<span class="token punctuation">,</span> with<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">resizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">scaledToFit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> size<span class="token punctuation">,</span> height<span class="token punctuation">:</span> size<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span></code></pre></article>