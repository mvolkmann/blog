<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>XCTest</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#unit-test-configuration">Unit Test Configuration</a></li><li><a href="#ui-test-configuration">UI Test Configuration</a></li><li><a href="#implementing-tests">Implementing Tests</a></li><li><a href="#running-tests-in-xcode">Running Tests in Xcode</a></li><li><a href="#viewing-test-results">Viewing Test Results</a></li><li><a href="#code-coverage">Code Coverage</a></li><li><a href="#ui-view-testing">UI View Testing</a></li><li><a href="#add-utility-methods">Add Utility Methods</a></li><li><a href="#run-from-command-line">Run from Command Line</a></li><li><a href="#github-actions">GitHub Actions</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p>XCTest is a unit testing framework for SwiftUI. &quot;XC&quot; is an abbreviation for &quot;Xcode&quot;.</p><h2 id="unit-test-configuration" tabindex="-1">Unit Test Configuration</h2><ol><li><p>Select the topmost entry in the Navigator.</p></li><li><p>Select the main target.</p></li><li><p>Click the &quot;+&quot; button at the bottom of the left nav to create a new target.</p></li><li><p>Select &quot;Unit Testing Bundle&quot;.</p></li><li><p>Click the &quot;Next&quot; button.</p></li><li><p>Click the &quot;Finish&quot; button.</p><p>Note that a new folder appears in the Navigator whose name is the project name followed by &quot;Tests&quot;. This contains a <code>.swift</code> file with the same name.</p></li><li><p>Edit the provided <code>.swift</code> files in the new target.</p></li></ol><h2 id="ui-test-configuration" tabindex="-1">UI Test Configuration</h2><ol><li><p>Select the topmost entry in the Navigator.</p></li><li><p>Click the &quot;+&quot; button at the bottom of the left nav to create another target.</p></li><li><p>Select &quot;UI Testing Bundle&quot;.</p></li><li><p>Click the &quot;Next&quot; button.</p></li><li><p>Click the &quot;Finish&quot; button.</p><p>Note that a new folder appears in the Navigator whose name is the project name followed by &quot;UITests&quot;. This contains a <code>.swift</code> file with the same name.</p></li><li><p>Edit the provided <code>.swift</code> files in the new target.</p></li></ol><h2 id="implementing-tests" tabindex="-1">Implementing Tests</h2><ol><li><p>To make all the source files in the project available to the test, add the line <code>@testable import {project-name}</code> before each test class definition. Replace hyphens with underscores.</p></li><li><p>Add test methods whose names begin with &quot;test&quot;.</p></li><li><p>To make an assertion, call one of the <code>XCTAssert{kind}</code> functions.</p><p>Assertion kind values include <code>Nil</code>, <code>NotNil</code>, <code>True</code>, <code>False</code>, <code>Equal</code>, <code>NotEqual</code>, <code>Identical</code>, <code>LessThan</code>, <code>LessThanOrEqual</code>, <code>GreaterThan</code>, <code>GreaterThanOrEqual</code>, <code>NoThrow</code>, and <code>ThrowsError</code>. Each of these has a version that takes and does not take an error message.</p></li></ol><h2 id="running-tests-in-xcode" tabindex="-1">Running Tests in Xcode</h2><ol><li>To run a single test method, click the diamond where the line number of the first line of the method (starts with <code>func</code>) would normally appear. If the diamonds don't appear, click and different source file and they click back on the test file.</li><li>To run all the test methods in the file, click the diamond where the line number of the first line of the class would normally appear.</li><li>To run all the tests in Navigator folder, click the diamond to the right of the folder name.</li><li>To run all the tests, select Product ... Test or press cmd-u.</li></ol><p>In UI tests, the on-screen keyboard doesn't always appear. If it doesn't, tests that require typing in text fields will fail. To fix this, go the Simulator app, select I/O ... Keyboard, and unselect &quot;Connect Hardware Keyboard&quot;.</p><h2 id="viewing-test-results" tabindex="-1">Viewing Test Results</h2><p>To see a report on test results:</p><ol><li>Click the &quot;Show Report Navigator&quot; button, which is the last button at the top of the Navigator, and then click a test run with a specific time.</li><li>In the editor panel where test results are displayed, click a category of test results to view which include &quot;All&quot;, &quot;Passed&quot;, &quot;Failed&quot;, &quot;Skipped&quot;, &quot;Expected Failures&quot;, and &quot;Mixed&quot;.</li></ol><h2 id="code-coverage" tabindex="-1">Code Coverage</h2><p>To enable collecting code coverage data:</p><ol><li>Click the target dropdown at the top of Xcode.</li><li>Select &quot;Edit Scheme...&quot;.</li><li>Select &quot;Test&quot; in the left nav.</li><li>Click the &quot;Options&quot; tab.</li><li>Check the &quot;Gather coverage for&quot; checkbox.</li><li>Select &quot;some targets&quot; in the dropdown to the right of this checkbox.</li><li>Click the &quot;+&quot; button to select a target.</li><li>Select the target of the main app.</li><li>Click the &quot;Close&quot; button.</li><li>Run all the tests again.</li><li>View the test results as described above.</li><li>Click &quot;Coverage&quot; under the new test run.</li><li>Expand the test folder displayed to see the coverage percentage of each source file.</li></ol><h2 id="ui-view-testing" tabindex="-1">UI View Testing</h2><p>To generate test code by recording user interactions:</p><ol><li>Click inside a test function where code should be inserted.</li><li>Click the red &quot;record&quot; circle at the bottom of the editor pane of the test source file.</li><li>Wait for the app to begin running in the Simulator.</li><li>Interact with the UI to navigation to the point within the app where assertions should be made. This includes tapping text fields to move focus into them, typing text, tapping buttons, and selecting items from pickers.</li><li>Optionally manually improve the generated test code.</li><li>Add assertions about what should be in the UI.</li></ol><h2 id="add-utility-methods" tabindex="-1">Add Utility Methods</h2><p>Add utility methods to the <code>XCTestCase</code> class to simplify writing tests. For example:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">XCTest</span><br><br><span class="token keyword">extension</span> <span class="token class-name">XCTestCase</span> <span class="token punctuation">{</span><br>    <span class="token keyword">static</span> <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token class-name">XCUIApplication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>    <span class="token keyword">func</span> <span class="token function-definition function">buttonExists</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> label<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span><br>        <span class="token class-name">XCTAssertTrue</span><span class="token punctuation">(</span><span class="token class-name">XCTestCase</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span>buttons<span class="token punctuation">[</span>label<span class="token punctuation">]</span><span class="token punctuation">.</span>exists<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">func</span> <span class="token function-definition function">enterSecureText</span><span class="token punctuation">(</span>label<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> text<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token class-name">XCTestCase</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span>secureTextFields<span class="token punctuation">[</span>label<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token keyword">for</span> char <span class="token keyword">in</span> text <span class="token punctuation">{</span><br>            <span class="token class-name">XCTestCase</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span>keys<span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br><br>        <span class="token comment">/* Tests fail with this approach.<br>        let field = XCTestCase.app.secureTextFields[label]<br>        field.tap()<br>        field.typeText(text)<br>        */</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">func</span> <span class="token function-definition function">enterText</span><span class="token punctuation">(</span>label<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> text<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token class-name">XCTestCase</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span>textFields<span class="token punctuation">[</span>label<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token keyword">for</span> char <span class="token keyword">in</span> text <span class="token punctuation">{</span><br>            <span class="token keyword">let</span> key <span class="token operator">=</span> <span class="token class-name">XCTestCase</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span>keys<span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">]</span><br>            key<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br><br>        <span class="token comment">/* Tests fail with this approach.<br>        let field = XCTestCase.app.textFields[label]<br>        field.tap()<br>        field.typeText(text)<br>        */</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">func</span> <span class="token function-definition function">tapButton</span><span class="token punctuation">(</span>label<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token class-name">XCTestCase</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span>buttons<span class="token punctuation">[</span>label<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">func</span> <span class="token function-definition function">textExists</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> text<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span><br>        <span class="token class-name">XCTAssertTrue</span><span class="token punctuation">(</span><span class="token class-name">XCTestCase</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span>staticTexts<span class="token punctuation">[</span>text<span class="token punctuation">]</span><span class="token punctuation">.</span>exists<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>In the <code>setUpWithError</code> method of test files, add the following:</p><pre class="language-swift"><code class="language-swift"><span class="token class-name">XCTestCase</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h2 id="run-from-command-line" tabindex="-1">Run from Command Line</h2><p>See <a href="https://www.appsdeveloperblog.com/run-xcode-unit-tests-from-the-command-line/?v=1.0.20" rel="noopener" target="_blank">Run Xcode Unit Tests From The Command Line</a>.</p><p>To enable this, enter <code>sudo xcode-select -s /Applications/Xcode.app/Contents/Developer</code></p><p>Start the Simulator app. Will the tests fail without this? To toggle between light and dark mode, select Features ... Toggle Appearance.</p><p><code>cd</code> to a directory containing a <code>.xcodeproj</code> file.</p><p>To get lists of targets, build configurations, and schemes defined in an Xcode project, enter <code>xcodebuild -list</code></p><p>To get a list of available devices supported by the simulator, enter <code>xcrun simctl list devices</code></p><p>To build and run all the XCTests, enter an <code>xcodebuild</code> command similar to the the following:</p><pre class="language-bash"><code class="language-bash">xcodebuild <span class="token punctuation">\</span><br>  <span class="token parameter variable">-scheme</span> MyApp <span class="token punctuation">\</span><br>  <span class="token parameter variable">-destination</span> <span class="token string">'name=iPhone 13'</span><br>  <span class="token parameter variable">-enableCodeCoverage</span> YES <span class="token punctuation">\</span><br>  clean <span class="token builtin class-name">test</span></code></pre><p>Add <code>-quiet</code> to reduce the output and only show errors.</p><p>If</p><h2 id="github-actions" tabindex="-1">GitHub Actions</h2><p>See <a href="https://vmois.dev/xcode-github-actions/?v=1.0.20" rel="noopener" target="_blank">How to use GitHub Actions for testing Xcode project</a>.</p></article>