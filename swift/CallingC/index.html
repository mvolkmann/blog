<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Calling C</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#steps">Steps</a></li><li><a href="#libraries">Libraries</a></li><li><a href="#invoking-lua">Invoking Lua</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p>Swift code can all functions written in C. This page describes the steps to create a SwiftUI app that includes C code and calls its functions.</p><h2 id="steps" tabindex="-1">Steps</h2><ol><li><p>Create a new Xcode project where the interface is &quot;SwiftUI&quot; and the language is &quot;Swift&quot;.</p></li><li><p>Select File ... New ... File (or press cmd-n).</p></li><li><p>In the &quot;Source&quot; category, select &quot;C File&quot;.</p></li><li><p>Enter a name for the file without a file extension.</p></li><li><p>Check the &quot;Also create a header file&quot; checkbox.</p></li><li><p>Click the &quot;Next&quot; button.</p></li><li><p>Click the &quot;Create&quot; button.</p></li><li><p>In the dialog that appears, click the &quot;Create Bridging Header&quot; button.</p></li><li><p>In the generated header file, enter the signatures of the functions you will define. For example:</p><pre class="language-c"><code class="language-c"><span class="token keyword">long</span> <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>In the generated C file, enter the function definitions. For example:</p><pre class="language-c"><code class="language-c"><span class="token keyword">long</span> <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> n <span class="token operator">*</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></li><li><p>In the generated <code>SwiftUICallsC-Bridging-Header.h</code> file, add import directives for each of your C header files. For example:</p><pre class="language-c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">import</span> <span class="token string">"factorial.h"</span></span></code></pre></li><li><p>Call the C functions in Swift source files. For example, <code>ContentView.swift</code> could contain the following:</p><pre class="language-swift"><code class="language-swift"><span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Factorial is </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token function">factorial</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">."</span></span><span class="token punctuation">)</span> <span class="token comment">// 120</span></code></pre></li></ol><h2 id="libraries" tabindex="-1">Libraries</h2><p>To use a C library from Swift:</p><ol><li>Build a version of the C library that is compatible with iOS.</li><li>Create a group within the Xcode project named &quot;include&quot;.</li><li>Copy the <code>.h</code> files for each library into this directory.</li><li>Create a group within the Xcode project named &quot;lib&quot;.</li><li>Copy the <code>.a</code> files for each library into this directory.</li><li>Select the top entry in the project navigator.</li><li>Select the project.</li><li>Select the &quot;Build Settings&quot; tab.</li><li>Open the &quot;Search&quot; section.</li><li>Open the &quot;Header Search Paths&quot; entry.</li><li>In the &quot;Release&quot; section, add the string &quot;include&quot;.</li><li>Open the &quot;Library Search Paths&quot; entry.</li><li>In the &quot;Release&quot; section, add the string &quot;lib&quot;.</li></ol><h2 id="invoking-lua" tabindex="-1">Invoking Lua</h2><p>For details on the Lua programming language, see <a href="/blog/topics/#/blog/lua/?v=1.1.0" rel="noopener" target="_blank">Lua</a>. This contains details on starting the Lua virtual machine from C and deciding which standard libraries should be loaded. For example, by not loading the &quot;os&quot; library, Lua code is unable to read or write files.</p><ol><li>Build a version of Lua that is compatible with iOS. See <a href="https://github.com/apotocki/lua-iosx?v=1.1.0" rel="noopener" target="_blank">lua-iosx</a>. Enter the following commands to generate the directory <code>frameworks/lua.xcframework</code>:<ul><li><code>git clone -b 5.4.4 https://github.com/apotocki/lua-iosx</code></li><li><code>cd lua-iosx</code></li><li><code>scripts/build.sh</code></li></ul></li><li>Create a &quot;Frameworks&quot; group.</li><li>Drag the <code>lua-ios/frameworks/lua.xcframework</code> directory into the group.</li><li>In the dialog that appears, check the &quot;Copy items if needed&quot; checkbox and click the &quot;Finish&quot; button.</li></ol><p>It is now possible to call functions from the Lua C API from functions defined in C source files. Those C functions can be called from Swift code.</p><p>For an example of embedding the Lua interpreter in a SwiftUI application, see <a href="/blog/topics/#/blog/swift/CallingC?v=1.1.0" rel="noopener" target="_blank">Swift Calling C</a> and the GitHub respository <a href="https://github.com/mvolkmann/SwiftUICallsC?v=1.1.0" rel="noopener" target="_blank">SwiftUICallsC</a>.</p></article>