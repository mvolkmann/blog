<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Notifications</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#local-notifications">Local Notifications</a><ol><li><a href="#localnotification-struct">LocalNotification struct</a></li><li><a href="#localnotificationmanager-class">LocalNotificationManager class</a></li><li><a href="#example-app">Example App</a></li></ol></li><li><a href="#remote-notifications">Remote Notifications</a></li></ol></nav></aside><article><h2 id="overview">Overview</h2><p>iOS supports two kinds of user notifications. Local notifications are sent from an app running on the device. Remote (or push) notifications are sent from a server.</p><p>TODO: In addition to displaying notifications, can an app listen for notifications and act on them?</p><h2 id="local-notifications">Local Notifications</h2><p>Stewart Lynch created an excellent 4-part series of YouTube videos <a href="https://www.youtube.com/watch?v=tNaSlfLeCB0?v=1.0.20" rel="noopener" target="_blank">Local Notifications</a>. The code below is my version of his code.</p><h3 id="localnotification-struct">LocalNotification struct</h3><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Foundation</span><br><br><span class="token comment">// This is based on the YouTube videos by Stewart Lynch</span><br><span class="token comment">// at https://www.youtube.com/watch?v=tNaSlfLeCB0.</span><br><span class="token keyword">struct</span> <span class="token class-name">LocalNotification</span> <span class="token punctuation">{</span><br>    <span class="token keyword">enum</span> <span class="token class-name">ScheduleType</span> <span class="token punctuation">{</span><br>        <span class="token keyword">case</span> calendar<span class="token punctuation">,</span> timeInterval<br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">var</span> identifier<span class="token punctuation">:</span> <span class="token class-name">String</span><br>    <span class="token keyword">var</span> title<span class="token punctuation">:</span> <span class="token class-name">String</span><br>    <span class="token keyword">var</span> subtitle<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token operator">?</span><br>    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token class-name">String</span><br>    <span class="token keyword">var</span> scheduleType<span class="token punctuation">:</span> <span class="token class-name">ScheduleType</span><br>    <span class="token keyword">var</span> dateComponents<span class="token punctuation">:</span> <span class="token class-name">DateComponents</span><span class="token operator">?</span><br>    <span class="token keyword">var</span> timeInterval<span class="token punctuation">:</span> <span class="token class-name">Double</span><span class="token operator">?</span> <span class="token comment">// in seconds</span><br>    <span class="token keyword">var</span> repeats<span class="token punctuation">:</span> <span class="token class-name">Bool</span><br><br>    <span class="token comment">// This provides a way to pass data from a tapped notification</span><br>    <span class="token comment">// to the app that created the notification.</span><br>    <span class="token keyword">var</span> userInfo<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">AnyHashable</span><span class="token punctuation">:</span> <span class="token keyword">Any</span><span class="token punctuation">]</span><span class="token operator">?</span><br><br>    <span class="token comment">// This describes buttons that should appear in a notification</span><br>    <span class="token comment">// when it is long-pressed.</span><br>    <span class="token keyword">var</span> categoryIdentifier<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token operator">?</span><br><br>    <span class="token keyword">init</span><span class="token punctuation">(</span><br>        identifier<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>        title<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>        body<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>        dateComponents<span class="token punctuation">:</span> <span class="token class-name">DateComponents</span><span class="token punctuation">,</span><br>        repeats<span class="token punctuation">:</span> <span class="token class-name">Bool</span><br>    <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        scheduleType <span class="token operator">=</span> <span class="token punctuation">.</span>calendar<br>        <span class="token keyword">self</span><span class="token punctuation">.</span>identifier <span class="token operator">=</span> identifier<br>        <span class="token keyword">self</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title<br>        <span class="token keyword">self</span><span class="token punctuation">.</span>body <span class="token operator">=</span> body<br>        timeInterval <span class="token operator">=</span> <span class="token nil constant">nil</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span>dateComponents <span class="token operator">=</span> dateComponents<br>        <span class="token keyword">self</span><span class="token punctuation">.</span>repeats <span class="token operator">=</span> repeats<br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">init</span><span class="token punctuation">(</span><br>        identifier<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>        title<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>        body<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>        timeInterval<span class="token punctuation">:</span> <span class="token class-name">Double</span><span class="token punctuation">,</span><br>        repeats<span class="token punctuation">:</span> <span class="token class-name">Bool</span><br>    <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        scheduleType <span class="token operator">=</span> <span class="token punctuation">.</span>timeInterval<br>        <span class="token keyword">self</span><span class="token punctuation">.</span>identifier <span class="token operator">=</span> identifier<br>        <span class="token keyword">self</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title<br>        <span class="token keyword">self</span><span class="token punctuation">.</span>body <span class="token operator">=</span> body<br>        <span class="token keyword">self</span><span class="token punctuation">.</span>timeInterval <span class="token operator">=</span> timeInterval<br>        dateComponents <span class="token operator">=</span> <span class="token nil constant">nil</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span>repeats <span class="token operator">=</span> repeats<br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">sendNow</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> identifier <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"r.mark.volkmann.gmail.com.NotificationsDemo"</span></span><br>        <span class="token keyword">let</span> notification <span class="token operator">=</span> <span class="token class-name">LocalNotification</span><span class="token punctuation">(</span><br>            identifier<span class="token punctuation">:</span> identifier<span class="token punctuation">,</span><br>            title<span class="token punctuation">:</span> title<span class="token punctuation">,</span><br>            body<span class="token punctuation">:</span> body<span class="token punctuation">,</span><br>            timeInterval<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// seconds from now; zero doesn't work</span><br>            repeats<span class="token punctuation">:</span> <span class="token boolean">false</span><br>        <span class="token punctuation">)</span><br>        <span class="token class-name">Task</span> <span class="token punctuation">{</span><br>            <span class="token keyword">await</span> <span class="token class-name">LocalNotificationManager</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><br>                notification<span class="token punctuation">:</span> notification<br>            <span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><h3 id="localnotificationmanager-class">LocalNotificationManager class</h3><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">NotificationCenter</span><br><br><span class="token attribute atrule">@MainActor</span> <span class="token comment">// so changes to @Published properties occur on the main thread</span><br><span class="token keyword">class</span> <span class="token class-name">LocalNotificationManager</span><span class="token punctuation">:</span> <span class="token class-name">NSObject</span><span class="token punctuation">,</span> <span class="token class-name">ObservableObject</span> <span class="token punctuation">{</span><br>    <span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> granted<span class="token punctuation">:</span> <span class="token class-name">Bool</span><span class="token operator">?</span><br>    <span class="token comment">// @Published var nextView: NextView?</span><br>    <span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> pendingRequests<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">UNNotificationRequest</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br><br>    <span class="token keyword">static</span> <span class="token keyword">let</span> shared <span class="token operator">=</span> <span class="token class-name">LocalNotificationManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>    <span class="token keyword">let</span> notificationCenter <span class="token operator">=</span> <span class="token class-name">UNUserNotificationCenter</span><span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>    <span class="token keyword">private</span> <span class="token keyword">override</span> <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>        <span class="token comment">// This allows presenting notifications scheduled by this app</span><br>        <span class="token comment">// while it is in the foreground.</span><br>        <span class="token comment">// Without this, local notifications sent while</span><br>        <span class="token comment">// the app is in the foreground will not be presented.</span><br>        notificationCenter<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">func</span> <span class="token function-definition function">authorize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span><br>        <span class="token keyword">try</span> <span class="token keyword">await</span> notificationCenter<span class="token punctuation">.</span><span class="token function">requestAuthorization</span><span class="token punctuation">(</span><br>            options<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>alert<span class="token punctuation">,</span> <span class="token punctuation">.</span>badge<span class="token punctuation">,</span> <span class="token punctuation">.</span>sound<span class="token punctuation">]</span><br>        <span class="token punctuation">)</span><br><br>        <span class="token comment">// This defines a category of actions.</span><br>        <span class="token comment">// When a notification that uses the category is long-pressed,</span><br>        <span class="token comment">// a button for each action is displayed.</span><br>        <span class="token comment">// See the timeIntervalButton computed property</span><br>        <span class="token comment">// in NotificationListView.swift which uses the category this defines.</span><br>        <span class="token function">registerActions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>        <span class="token keyword">await</span> <span class="token function">updateGranted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">func</span> <span class="token function-definition function">openSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token class-name">UIApplication</span><span class="token punctuation">.</span>openSettingsURLString<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token keyword">if</span> <span class="token class-name">UIApplication</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">canOpenURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                <span class="token class-name">Task</span> <span class="token punctuation">{</span><br>                    <span class="token keyword">await</span> <span class="token class-name">UIApplication</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><br>                <span class="token punctuation">}</span><br>            <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">func</span> <span class="token function-definition function">removeAllRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        notificationCenter<span class="token punctuation">.</span><span class="token function">removeAllPendingNotificationRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        pendingRequests<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">func</span> <span class="token function-definition function">removeRequest</span><span class="token punctuation">(</span>withIdentifier identifier<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        notificationCenter<span class="token punctuation">.</span><span class="token function">removePendingNotificationRequests</span><span class="token punctuation">(</span><br>            withIdentifiers<span class="token punctuation">:</span> <span class="token punctuation">[</span>identifier<span class="token punctuation">]</span><br>        <span class="token punctuation">)</span><br>        <span class="token keyword">if</span> <span class="token keyword">let</span> index <span class="token operator">=</span> pendingRequests<span class="token punctuation">.</span><span class="token function">firstIndex</span><span class="token punctuation">(</span><br>            <span class="token keyword">where</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token short-argument">$0</span><span class="token punctuation">.</span>identifier <span class="token operator">==</span> identifier <span class="token punctuation">}</span><br>        <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            pendingRequests<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>at<span class="token punctuation">:</span> index<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">func</span> <span class="token function-definition function">schedule</span><span class="token punctuation">(</span>notification<span class="token punctuation">:</span> <span class="token class-name">LocalNotification</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> content <span class="token operator">=</span> <span class="token class-name">UNMutableNotificationContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        content<span class="token punctuation">.</span>title <span class="token operator">=</span> notification<span class="token punctuation">.</span>title<br>        <span class="token keyword">if</span> <span class="token keyword">let</span> subtitle <span class="token operator">=</span> notification<span class="token punctuation">.</span>subtitle <span class="token punctuation">{</span><br>            content<span class="token punctuation">.</span>subtitle <span class="token operator">=</span> subtitle<br>        <span class="token punctuation">}</span><br>        content<span class="token punctuation">.</span>body <span class="token operator">=</span> notification<span class="token punctuation">.</span>body<br>        content<span class="token punctuation">.</span>sound <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token keyword">default</span><br>        <span class="token keyword">if</span> <span class="token keyword">let</span> userInfo <span class="token operator">=</span> notification<span class="token punctuation">.</span>userInfo <span class="token punctuation">{</span><br>            content<span class="token punctuation">.</span>userInfo <span class="token operator">=</span> userInfo<br>        <span class="token punctuation">}</span><br>        <span class="token keyword">if</span> <span class="token keyword">let</span> categoryIdentifier <span class="token operator">=</span> notification<span class="token punctuation">.</span>categoryIdentifier <span class="token punctuation">{</span><br>            content<span class="token punctuation">.</span>categoryIdentifier <span class="token operator">=</span> categoryIdentifier<br>        <span class="token punctuation">}</span><br><br>        <span class="token keyword">let</span> trigger<span class="token punctuation">:</span> <span class="token class-name">UNNotificationTrigger</span><span class="token operator">!</span><br><br>        <span class="token keyword">switch</span> notification<span class="token punctuation">.</span>scheduleType <span class="token punctuation">{</span><br>        <span class="token keyword">case</span> <span class="token punctuation">.</span>calendar<span class="token punctuation">:</span><br>            <span class="token keyword">guard</span> <span class="token keyword">let</span> dateComponents <span class="token operator">=</span> notification<span class="token punctuation">.</span>dateComponents <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span><br>            trigger <span class="token operator">=</span> <span class="token class-name">UNCalendarNotificationTrigger</span><span class="token punctuation">(</span><br>                dateMatching<span class="token punctuation">:</span> dateComponents<span class="token punctuation">,</span><br>                repeats<span class="token punctuation">:</span> notification<span class="token punctuation">.</span>repeats<br>            <span class="token punctuation">)</span><br><br>        <span class="token keyword">case</span> <span class="token punctuation">.</span>timeInterval<span class="token punctuation">:</span><br>            <span class="token keyword">guard</span> <span class="token keyword">let</span> timeInterval <span class="token operator">=</span> notification<span class="token punctuation">.</span>timeInterval <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span><br>            trigger <span class="token operator">=</span> <span class="token class-name">UNTimeIntervalNotificationTrigger</span><span class="token punctuation">(</span><br>                timeInterval<span class="token punctuation">:</span> timeInterval<span class="token punctuation">,</span><br>                repeats<span class="token punctuation">:</span> notification<span class="token punctuation">.</span>repeats<br>            <span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br><br>        <span class="token keyword">let</span> request <span class="token operator">=</span> <span class="token class-name">UNNotificationRequest</span><span class="token punctuation">(</span><br>            identifier<span class="token punctuation">:</span> notification<span class="token punctuation">.</span>identifier<span class="token punctuation">,</span><br>            content<span class="token punctuation">:</span> content<span class="token punctuation">,</span><br>            trigger<span class="token punctuation">:</span> trigger<br>        <span class="token punctuation">)</span><br>        <span class="token keyword">try</span><span class="token operator">?</span> <span class="token keyword">await</span> notificationCenter<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><br><br>        <span class="token keyword">await</span> <span class="token function">updatePendingRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">func</span> <span class="token function-definition function">updateGranted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> settings <span class="token operator">=</span> <span class="token keyword">await</span> notificationCenter<span class="token punctuation">.</span><span class="token function">notificationSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        granted <span class="token operator">=</span> settings<span class="token punctuation">.</span>authorizationStatus <span class="token operator">==</span> <span class="token punctuation">.</span>authorized<br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">func</span> <span class="token function-definition function">updatePendingRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span><br>        pendingRequests <span class="token operator">=</span> <span class="token keyword">await</span> notificationCenter<span class="token punctuation">.</span><span class="token function">pendingNotificationRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">extension</span> <span class="token class-name">LocalNotificationManager</span><span class="token punctuation">:</span> <span class="token class-name">UNUserNotificationCenterDelegate</span> <span class="token punctuation">{</span><br>    <span class="token comment">// The actions described here will appear as buttons</span><br>    <span class="token comment">// in a notification if:</span><br>    <span class="token comment">// 1) The notification has a categoryIdentifier of "snooze".</span><br>    <span class="token comment">//    See the timeIntervalButton computed property</span><br>    <span class="token comment">//    in NotificationListView.swift.</span><br>    <span class="token comment">// 2) The user long-presses on the notification.</span><br>    <span class="token comment">// These buttons will be difficult for users to discover, so include</span><br>    <span class="token comment">// text in the notification that encourages users to long-press for options.</span><br>    <span class="token keyword">func</span> <span class="token function-definition function">registerActions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">// These are example actions that we are not currently used.</span><br>        <span class="token comment">// Later when we send notifications related to resident questions,</span><br>        <span class="token comment">// we will change this to contain all the possible question answers.</span><br>        <span class="token keyword">let</span> snooze10Action <span class="token operator">=</span> <span class="token class-name">UNNotificationAction</span><span class="token punctuation">(</span><br>            identifier<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"snooze10"</span></span><span class="token punctuation">,</span><br>            title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Snooze for 10 seconds"</span></span><br>        <span class="token punctuation">)</span><br>        <span class="token keyword">let</span> snooze60Action <span class="token operator">=</span> <span class="token class-name">UNNotificationAction</span><span class="token punctuation">(</span><br>            identifier<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"snooze60"</span></span><span class="token punctuation">,</span><br>            title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Snooze for one minute"</span></span><br>        <span class="token punctuation">)</span><br>        <span class="token keyword">let</span> snoozeCategory <span class="token operator">=</span> <span class="token class-name">UNNotificationCategory</span><span class="token punctuation">(</span><br>            identifier<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"snooze"</span></span><span class="token punctuation">,</span><br>            actions<span class="token punctuation">:</span> <span class="token punctuation">[</span>snooze10Action<span class="token punctuation">,</span> snooze60Action<span class="token punctuation">]</span><span class="token punctuation">,</span><br>            intentIdentifiers<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br>        <span class="token punctuation">)</span><br>        <span class="token comment">// The identifier values above become the value of the</span><br>        <span class="token comment">// actionIdentifier property on the response object</span><br>        <span class="token comment">// when the corresponding button is tapped.</span><br>        notificationCenter<span class="token punctuation">.</span><span class="token function">setNotificationCategories</span><span class="token punctuation">(</span><span class="token punctuation">[</span>snoozeCategory<span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// This is called *before* each notification is displayed.</span><br>    <span class="token comment">// It indicates *how* the user should be alerted.</span><br>    <span class="token keyword">func</span> <span class="token function-definition function">userNotificationCenter</span><span class="token punctuation">(</span><br>        <span class="token omit keyword">_</span><span class="token punctuation">:</span> <span class="token class-name">UNUserNotificationCenter</span><span class="token punctuation">,</span><br>        willPresent <span class="token omit keyword">_</span><span class="token punctuation">:</span> <span class="token class-name">UNNotification</span><br>    <span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token operator">-></span> <span class="token class-name">UNNotificationPresentationOptions</span> <span class="token punctuation">{</span><br>        <span class="token keyword">await</span> <span class="token function">updatePendingRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>banner<span class="token punctuation">,</span> <span class="token punctuation">.</span>sound<span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// This is called *after* each notification is displayed.</span><br>    <span class="token keyword">func</span> <span class="token function-definition function">userNotificationCenter</span><span class="token punctuation">(</span><br>        <span class="token omit keyword">_</span><span class="token punctuation">:</span> <span class="token class-name">UNUserNotificationCenter</span><span class="token punctuation">,</span><br>        didReceive <span class="token omit keyword">_</span><span class="token punctuation">:</span> <span class="token class-name">UNNotificationResponse</span><br>    <span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span><br>        <span class="token comment">/*<br>         // This is example code that shows a way to handle<br>         // snoozing a notification so it appears again later.<br>         // We way want to place other code here in the future<br>         // that handles clicking buttons in a notification in a different<br>         // way such as treating them as answers to a resident question.<br><br>         let content = response.notification.request.content<br>         if let value = content.userInfo["nextView"] as? String {<br>             // nextView is a published property that is used<br>             // in the "sheet" view modifier in NotificationsListView<br>             // to display a specified view in a sheet.<br>             // Alternatively, it could be used to navigate to a given view.<br>             nextView = NextView(rawValue: value)<br>         }<br><br>         // If the user long-presses the notification and<br>         // then tapped one of the snooze buttons ...<br>         let snoozeInterval: Double =<br>             response.actionIdentifier == "snooze10" ? 10 :<br>             response.actionIdentifier == "snooze60" ? 60 :<br>             0<br>         if snoozeInterval != 0 {<br>             // Create and schedule a new notification request<br>             // that will notify the user again later.<br>             let content = response.notification.request.content<br>             let newContent = content.mutableCopy() as! UNMutableNotificationContent<br>             let newTrigger = UNTimeIntervalNotificationTrigger(<br>                 timeInterval: snoozeInterval,<br>                 repeats: false<br>             )<br>             let request = UNNotificationRequest(<br>                 identifier: UUID().uuidString,<br>                 content: newContent,<br>                 trigger: newTrigger<br>             )<br><br>             do {<br>                 try await notificationCenter.add(request)<br>                 await updatePendingRequests()<br>             } catch {<br>                 EMRLogger.shared.logError(<br>                     error<br>                 )<br>             }<br>         }<br>         */</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><h3 id="example-app">Example App</h3><p>For an example of sending local notifications using the utility type defined above, see the <a href="https://github.com/mvolkmann/NotificationsDemo?v=1.0.20" rel="noopener" target="_blank">NotificationsDemo</a> project in GitHub.</p><h2 id="remote-notifications">Remote Notifications</h2><p>TODO: Add this content.</p></article>