<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Document-based Apps</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#steps">Steps</a></li><li><a href="#result">Result</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p>SwiftUI document-based apps &quot;are apps that let users create, edit, and share documents such as text files.&quot;</p><p>The information below was derived form the Hacking With Swift article at <a href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-create-a-document-based-app-using-filedocument-and-documentgroup?v=1.1.0" rel="noopener" target="_blank">How to create a document-based app using FileDocument and DocumentGroup</a>.</p><h2 id="steps" tabindex="-1">Steps</h2><p>In this example we are building a way to create Lua source files in a SwiftUI app.</p><p>The steps to create such a document-based app are:</p><ol><li><p>Add the <code>.icns</code> file to the project.</p></li><li><p>Define a custom file extension for your documents. If the type is known outside of your app, add an entry in the &quot;Imported Type Identifiers&quot; section. If the type is unique to your app, add an entry in the &quot;Exported Type Identifiers&quot; section. The form fields in each section are the same. Then add an entry in the &quot;Document Types&quot; section.</p><p><img alt="Xcode Custom File Type" style="width: 100%" src="/blog/assets/xcode-custom-file-type.png?v=1.1.0" title="Xcode Custom File Type"></p></li><li><p>Optionally create an icon for your file type. Create an image that is 1024 x 1024. Browse <a href="https://cloudconvert.com/png-to-icns?v=1.1.0" rel="noopener" target="_blank">cloudconvert</a>, click the &quot;Select File&quot; button, select your file, select &quot;ICNS&quot; in the &quot;Convert to&quot; dropdown, and click the &quot;Convert&quot; button. When it completes, click the &quot;Download&quot; button. Within the &quot;Icons&quot; section, click the &quot;+&quot; button, select your <code>.icns</code> file, and click the &quot;Add&quot; button.</p></li><li><p>In the struct that conforms to <code>App</code>, in the computed property <code>body</code>, replace the following:</p><pre class="language-swift"><code class="language-swift"><span class="token class-name">WindowGroup</span> <span class="token punctuation">{</span><br>    <span class="token class-name">ContentView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre><p>with this:</p><pre class="language-swift"><code class="language-swift"><span class="token class-name">DocumentGroup</span><span class="token punctuation">(</span>newDocument<span class="token punctuation">:</span> <span class="token class-name">TextFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> file <span class="token keyword">in</span><br>    <span class="token class-name">ContentView</span><span class="token punctuation">(</span>document<span class="token punctuation">:</span> file<span class="token punctuation">.</span>$document<span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Define a struct that conforms to the <a href="https://developer.apple.com/documentation/swiftui/filedocument?v=1.1.0" rel="noopener" target="_blank">FileDocument</a> protocol. This will hold all the data associated with each document using one or more properties. For example, for basic text documents we could create the file <code>TextFile.swift</code> containing the following:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">SwiftUI</span><br><span class="token keyword">import</span> <span class="token class-name">UniformTypeIdentifiers</span><br><br><span class="token keyword">extension</span> <span class="token class-name">UTType</span> <span class="token punctuation">{</span><br>    <span class="token comment">// If you defined an "Imported Type Identifier" use "importedAs" here.</span><br>    <span class="token comment">// If you defined an "Exported Type Identifier" use "exportedAs" here.</span><br>    <span class="token keyword">static</span> <span class="token keyword">let</span> luaSource <span class="token operator">=</span> <span class="token class-name">UTType</span><span class="token punctuation">(</span>importedAs<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"org.lua"</span></span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">struct</span> <span class="token class-name">LuaFile</span><span class="token punctuation">:</span> <span class="token class-name">FileDocument</span> <span class="token punctuation">{</span><br>    <span class="token keyword">static</span> <span class="token keyword">let</span> fileExtension <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"lua"</span></span><br>    <span class="token keyword">static</span> <span class="token keyword">var</span> readableContentTypes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">UTType</span><span class="token punctuation">.</span>luaSource<span class="token punctuation">]</span><br>    <span class="token keyword">static</span> <span class="token keyword">let</span> defaultCode <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"""<br>    x = 3<br>    y = 4<br>    if x >= y then<br>      color = "green"<br>    else<br>      color = "red"<br>    end<br>    -- color = x >= y and "red" or "green"<br><br>    greeting = "Hello!"<br>    """</span></span><br><br>    <span class="token keyword">var</span> code <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span><br><br>    <span class="token comment">// This creates a document containing the given code.</span><br>    <span class="token keyword">init</span><span class="token punctuation">(</span>initialCode<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> defaultCode<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        code <span class="token operator">=</span> initialCode<br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// This creates a document containing previously saved code.</span><br>    <span class="token keyword">init</span><span class="token punctuation">(</span>configuration<span class="token punctuation">:</span> <span class="token class-name">ReadConfiguration</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token keyword">let</span> data <span class="token operator">=</span> configuration<span class="token punctuation">.</span>file<span class="token punctuation">.</span>regularFileContents <span class="token punctuation">{</span><br>            code <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">(</span>decoding<span class="token punctuation">:</span> data<span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> UTF8<span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>            <span class="token keyword">throw</span> <span class="token class-name">CocoaError</span><span class="token punctuation">(</span><span class="token punctuation">.</span>fileReadCorruptFile<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// This is called when the system wants to save code in a file.</span><br>    <span class="token comment">// TODO: How can the file name be specified?</span><br>    <span class="token keyword">func</span> <span class="token function-definition function">fileWrapper</span><span class="token punctuation">(</span>configuration<span class="token punctuation">:</span> <span class="token class-name">WriteConfiguration</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token operator">-></span> <span class="token class-name">FileWrapper</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token class-name">Data</span><span class="token punctuation">(</span>code<span class="token punctuation">.</span>utf8<span class="token punctuation">)</span><br>        <span class="token keyword">return</span> <span class="token class-name">FileWrapper</span><span class="token punctuation">(</span>regularFileWithContents<span class="token punctuation">:</span> data<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br> <span class="token punctuation">}</span></code></pre></li><li><p>Add a view for editing the current document. This can be a custom UI that is suitable for the struct defined above. For a text document it could be as simple as a <code>TextEditor</code> view. For example:</p><pre class="language-swift"><code class="language-swift"><span class="token attribute atrule">@Binding</span> <span class="token keyword">var</span> luaFile<span class="token punctuation">:</span> <span class="token class-name">LuaFile</span><br><br><span class="token operator">...</span><br><br><span class="token class-name">TextEditor</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> $luaFile<span class="token punctuation">.</span>text<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">autocapitalization</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token keyword">none</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">disableAutocorrection</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">lineLimit</span><span class="token punctuation">(</span>lines<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span><br>        maxWidth<span class="token punctuation">:</span> <span class="token punctuation">.</span>infinity<span class="token punctuation">,</span><br>        maxHeight<span class="token punctuation">:</span> <span class="token class-name">CGFloat</span><span class="token punctuation">(</span>lines <span class="token operator">*</span> lineHeight<span class="token punctuation">)</span><br>    <span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">border</span><span class="token punctuation">(</span><span class="token punctuation">.</span>gray<span class="token punctuation">)</span></code></pre></li><li><p>Change the project settings to indicate that it will use the system document browser.</p><ol><li>Select the top entry in the Project Navigator.</li><li>Select the main target.</li><li>Select the &quot;Info&quot; tab.</li><li>Hover over an existing row and click the &quot;+&quot; button.</li><li>Select &quot;Supports Document Browser&quot;.</li><li>Set the value to &quot;YES&quot;.</li></ol></li></ol><h2 id="result" tabindex="-1">Result</h2><p>The app in the screenshots below can be found at <a href="https://github.com/mvolkmann/SwiftUICallsC?v=1.1.0" rel="noopener" target="_blank">SwiftUICallsC</a>. It demonstrates embedding the Lua interpreter in a SwiftUI app. Each document contains Lua code that is executed by tapping the &quot;Execute&quot; button.</p><p>When users run the app they are presented with a document picker screen. There are three tabs at the bottom labelled &quot;Recents&quot;, &quot;Shared&quot;, and &quot;Browse&quot;. The &quot;Recents&quot; tab displays thumbnail buttons for recently accessed documents. Initially there will not be any. In the screenshot below, two documents named &quot;Complex&quot; and &quot;Simple&quot; have already been created.</p><p><img alt="SwiftUI Document-Based App Recents" style="width: 50%" src="/blog/assets/SwiftUI-document-based-1.png?v=1.1.0" title="SwiftUI Document-Based App Recents"></p><p>The &quot;Browse&quot; tab displays a &quot;Create Document&quot; button along with thumbnail buttons for all documents already created.</p><p><img alt="SwiftUI Document-Based App Browse" style="width: 50%" src="/blog/assets/SwiftUI-document-based-2.png?v=1.1.0" title="SwiftUI Document-Based App Browse"></p><p>Clicking the &quot;Create Document&quot; button or the button for an existing document advances to the view passed to <code>DocumentGroup</code> inside the struct that conforms to <code>App</code>.</p><p><img alt="SwiftUI Document-Based App Document" style="width: 50%" src="/blog/assets/SwiftUI-document-based-3.png?v=1.1.0" title="SwiftUI Document-Based App Document"></p><p>To return to the document picker screen, tap the &quot;&lt;&quot; button in the upper-left.</p><p>To rename a document, long press it, select &quot;Rename&quot;, and replace the current name.</p><pre><code>
</code></pre></article>