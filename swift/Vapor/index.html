<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Vapor</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#installing">Installing</a></li><li><a href="#project-creation">Project Creation</a></li><li><a href="#server-running">Server Running</a></li><li><a href="#defining-routes">Defining Routes</a></li><li><a href="#returning-json">Returning JSON</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p><a href="https://vapor.codes?v=1.0.20" rel="noopener" target="_blank">Vapor</a> is a web server framework for macOS that is written in Swift.</p><h2 id="installing" tabindex="-1">Installing</h2><ol><li>Install <a href="https://brew.sh?v=1.0.20" rel="noopener" target="_blank">Homebrew</a>.</li><li>Enter <code>brew install vapor</code></li></ol><h2 id="project-creation" tabindex="-1">Project Creation</h2><p>To create a Vapor project, enter <code>vapor new {project-name}</code></p><h2 id="server-running" tabindex="-1">Server Running</h2><p>To run the server, enter <code>vapor run</code>. The server listens on port 8080 by default. To verify that it is working, browse localhost:8080 which outputs &quot;It works!&quot; or browse localhost:8080/hello which outputs &quot;Hello, world!&quot;.</p><p>There does not seem to be support for listening for code changes and automatically restarting the server (like nodemon in Node.js).</p><h2 id="defining-routes" tabindex="-1">Defining Routes</h2><p>To define new routes (or endpoints), edit <code>Sources/App/routes.swift</code>. The <code>route</code> function defined here is called by the <code>configure</code> function that is defined in <code>Sources/App/configure.swift</code>. The <code>configure</code> function is called by <code>Sources/Run/main.swift</code>.</p><p>The route helper methods that map to HTTP methods are <code>get</code>, <code>post</code>, <code>patch</code>, <code>put</code>, and <code>delete</code>. The route helper method <code>on</code> accepts an HTTP method as a parameter.</p><p>The following code is from the <code>routes.swift</code> file. It demonstrates defining routes that use both path parameters and query parameters.</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Vapor</span><br><br><span class="token keyword">func</span> <span class="token function-definition function">routes</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> app<span class="token punctuation">:</span> <span class="token class-name">Application</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span><br>    <span class="token comment">// route is /</span><br>    app<span class="token punctuation">.</span><span class="token keyword">get</span> <span class="token punctuation">{</span> <span class="token omit keyword">_</span> <span class="token keyword">in</span><br>        <span class="token string-literal"><span class="token string">"It works!"</span></span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// route is /hello</span><br>    <span class="token comment">// Return type of the function passed to `app.get`</span><br>    <span class="token comment">// specifies the kind of data returned.</span><br>    app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"hello"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token omit keyword">_</span> <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token keyword">in</span><br>        <span class="token string-literal"><span class="token string">"Hello, world!"</span></span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// This demonstrates using path parameters.</span><br>    <span class="token comment">// route example is /greet/Tami</span><br>    <span class="token comment">// The `get` method takes any number of string arguments</span><br>    <span class="token comment">// that each represent a path part that can be</span><br>    <span class="token comment">// constant (like "greet") or variable (like ":name").</span><br>    <span class="token comment">// "*" matches any value.</span><br>    <span class="token comment">// "**" matches any number of path parts with any values.</span><br>    <span class="token comment">// (Can "**" only be used as the last argument?)</span><br>    app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"greet"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">":name"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> req <span class="token operator">-></span> <span class="token class-name">String</span> <span class="token keyword">in</span><br>        <span class="token comment">// This demonstrates getting the value of a variable path parameter.</span><br>        <span class="token comment">// Variable path parameters will never be nil,</span><br>        <span class="token comment">// so a forced unwrap is safe.</span><br>        <span class="token keyword">guard</span> <span class="token keyword">let</span> name <span class="token operator">=</span> req<span class="token punctuation">.</span>parameters<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"name"</span></span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>            <span class="token keyword">throw</span> <span class="token class-name">Abort</span><span class="token punctuation">(</span><span class="token punctuation">.</span>badRequest<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">"Hello, </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">name</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">!"</span></span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// This demonstrates using query parameters.</span><br>    app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"divide"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> req <span class="token operator">-></span> <span class="token class-name">Double</span> <span class="token keyword">in</span><br>        <span class="token keyword">guard</span> <span class="token keyword">let</span> dividend<span class="token punctuation">:</span> <span class="token class-name">Double</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"dividend"</span></span><span class="token punctuation">]</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>            <span class="token keyword">throw</span> <span class="token class-name">Abort</span><span class="token punctuation">(</span><span class="token punctuation">.</span>badRequest<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">guard</span> <span class="token keyword">let</span> divisor<span class="token punctuation">:</span> <span class="token class-name">Double</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"divisor"</span></span><span class="token punctuation">]</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>            <span class="token keyword">throw</span> <span class="token class-name">Abort</span><span class="token punctuation">(</span><span class="token punctuation">.</span>badRequest<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">return</span> dividend <span class="token operator">/</span> divisor<br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// This demonstrates another approach for using query parameters.</span><br>    <span class="token comment">// The struct below describes the supported query parameters.</span><br>    <span class="token comment">// They can be required or optional (by using `?`).</span><br>    <span class="token keyword">struct</span> <span class="token class-name">Divide</span><span class="token punctuation">:</span> <span class="token class-name">Content</span> <span class="token punctuation">{</span><br>        <span class="token keyword">var</span> dividend<span class="token punctuation">:</span> <span class="token class-name">Double</span><br>        <span class="token keyword">var</span> divisor<span class="token punctuation">:</span> <span class="token class-name">Double</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// This uses the struct above to decode the query parameters.</span><br>    app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"divide2"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> req <span class="token operator">-></span> <span class="token class-name">Double</span> <span class="token keyword">in</span><br>        <span class="token keyword">let</span> query <span class="token operator">=</span> <span class="token keyword">try</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">Divide</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span><br>        <span class="token keyword">return</span> query<span class="token punctuation">.</span>dividend <span class="token operator">/</span> query<span class="token punctuation">.</span>divisor<br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><h2 id="returning-json" tabindex="-1">Returning JSON</h2><p>The following code is from the <code>routes.swift</code> file. It demonstrates returning JSON.</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Vapor</span><br><br><span class="token keyword">func</span> <span class="token function-definition function">routes</span><span class="token punctuation">(</span><span class="token omit keyword">_</span> app<span class="token punctuation">:</span> <span class="token class-name">Application</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">{</span><br>    <span class="token comment">// The Content protocol combines</span><br>    <span class="token comment">// Decodable, Encodable, and RequestDecodable.</span><br>    <span class="token keyword">struct</span> <span class="token class-name">Address</span><span class="token punctuation">:</span> <span class="token class-name">Content</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> street<span class="token punctuation">:</span> <span class="token class-name">String</span><br>        <span class="token keyword">let</span> city<span class="token punctuation">:</span> <span class="token class-name">String</span><br>        <span class="token keyword">let</span> state<span class="token punctuation">:</span> <span class="token class-name">String</span><br>        <span class="token keyword">let</span> zip<span class="token punctuation">:</span> <span class="token class-name">Int</span><br>    <span class="token punctuation">}</span><br><br>    app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"address"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token omit keyword">_</span> <span class="token operator">-></span> <span class="token class-name">Address</span> <span class="token keyword">in</span><br>        <span class="token class-name">Address</span><span class="token punctuation">(</span><br>            street<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"123 Some Lane"</span></span><span class="token punctuation">,</span><br>            city<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Somewhere"</span></span><span class="token punctuation">,</span><br>            state<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"CA"</span></span><span class="token punctuation">,</span><br>            zip<span class="token punctuation">:</span> <span class="token number">12345</span><br>        <span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"addresses"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token omit keyword">_</span> <span class="token operator">-></span> <span class="token punctuation">[</span><span class="token class-name">Address</span><span class="token punctuation">]</span> <span class="token keyword">in</span><br>        <span class="token keyword">let</span> a1 <span class="token operator">=</span> <span class="token class-name">Address</span><span class="token punctuation">(</span><br>            street<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"123 Some Lane"</span></span><span class="token punctuation">,</span><br>            city<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Somewhere"</span></span><span class="token punctuation">,</span><br>            state<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"CA"</span></span><span class="token punctuation">,</span><br>            zip<span class="token punctuation">:</span> <span class="token number">12345</span><br>        <span class="token punctuation">)</span><br>        <span class="token keyword">let</span> a2 <span class="token operator">=</span> <span class="token class-name">Address</span><span class="token punctuation">(</span><br>            street<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"456 Some Street"</span></span><span class="token punctuation">,</span><br>            city<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Nowhere"</span></span><span class="token punctuation">,</span><br>            state<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"CA"</span></span><span class="token punctuation">,</span><br>            zip<span class="token punctuation">:</span> <span class="token number">98765</span><br>        <span class="token punctuation">)</span><br>        <span class="token keyword">return</span> <span class="token punctuation">[</span>a1<span class="token punctuation">,</span> a2<span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre></article>