<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Core Data</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#%22use-core-data%22-option">"Use Core Data" Option</a></li><li><a href="#defining-entities">Defining Entities</a></li><li><a href="#entity-codegen">Entity Codegen</a></li><li><a href="#%40fetchrequest-vs.-viewmodel">@FetchRequest vs. ViewModel</a><ol><li><a href="#using-%40fetchrequest">Using @FetchRequest</a></li><li><a href="#using-a-viewmodel">Using a ViewModel</a></li></ol></li><li><a href="#entity-objects">Entity Objects</a></li><li><a href="#fetching-entities">Fetching Entities</a></li><li><a href="#starting-over">Starting Over</a></li><li><a href="#cloudkit-integration">CloudKit Integration</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p>Core Data is an object/graph persistence framework. It supports many features including data validation, undo/redo, and lazy loading. By default it stores data using SQLite.</p><p>Apps that use Core Data will not run in Preview mode. The Simulator must be used instead.</p><p>One way to setup use of Core Data is to check the &quot;Use Core Data&quot; checkbox on the options panel when creating a new project. This adds all the setup code and UI code for a simple app that allows creating, deleting, and listing <code>Item</code> entities. The app can be modified to work with other kinds of entities.</p><p>Another approach is to uncheck the &quot;Use Core Data&quot; checkbox and set up use of Core Data manually. The steps to do this are shown later.</p><h2 id="%22use-core-data%22-option" tabindex="-1">&quot;Use Core Data&quot; Option</h2><p>When the &quot;Use Core Data&quot; checkbox is checked, the generated files configure the use of Core Data. The file <code>{app-name}App.swift</code> registers an &quot;environment&quot; with the main <code>ContentView</code> that uses a <code>PersistenceController</code> instance defined in <code>Persistence.swift</code> and made available through a static <code>shared</code> property. The main view defined in <code>ContentView.swift</code> has access to this and uses the <code>@FetchRequest</code> property wrapper to get <code>Item</code> objects from the persistent store. The <code>Item</code> type is defined in <code>{app-name}.xcdatamodeld</code> and has a single attribute <code>timestamp</code>.</p><p>The generated app is fully functional. It displays a list of items that each have a timestamp. Tap an item to get to a page that displays detail about just that item. To delete an item, swipe it left and click the &quot;Delete&quot; button that appears. To add an item with the current timestamp, click the &quot;+&quot; button at the top. To delete items without swiping them, click the &quot;Edit&quot; button at the top. This displays a red circle containing a minus sign to left of each item. Click those to delete items. When finished, click the &quot;Done&quot; button at the top that replaced the &quot;Edit&quot; button. From here you can edit the code to provide your own CRUD functionality.</p><h2 id="defining-entities" tabindex="-1">Defining Entities</h2><p>To define Core Data entity types, click the <code>{app-name}.xcdatamodeld</code> file in the Navigator pane. This will display an entity editor.</p><p>If the &quot;Use Core Data&quot; option was checked, consider deleting the provided <code>Item</code> entity and any code that is specific to it.</p><p>Create a model file by right-clicking in the Navigator and selecting &quot;New File...&quot;. For the template, scroll down to &quot;Core Data&quot; and select &quot;Data Model&quot;. For most projects only one of these files is needed and the default name of &quot;Model.xcdatamodeld&quot; is fine.</p><p>Entities are similar to tables in a relational database. Add entities to the model by clicking the &quot;Add Entity&quot; button at the bottom. This will create an empty entity named &quot;Entity&quot;. Double-click the name and change it. These become the names of generated class definitions, so they should begin with an uppercase letter. It is recommended to give them names that end in &quot;Entity&quot; so it is clear in code that uses them that they are Core Data entities. The generated classes inherit from <code>NSManagedObject</code>.</p><p>For each entity, click the &quot;Module&quot; drop-down inside the Inspector on the right, select &quot;Current Product Module&quot;. TODO: Is this really desirable? What is the benefit?</p><p>Add attributes to each entity by clicking the &quot;+&quot; at the bottom of the attribute list. Each attribute is given a default name of &quot;attribute&quot;. Double-click the name and change it. Some names, such as &quot;description&quot; and &quot;for&quot;, are not allowed. Select a type from a drop-down list of primitive types. The type &quot;Data&quot; is for byte buffers.</p><p>Optionally sort the attributes. They can be sorted on their name or type by clicking on the &quot;Attribute&quot; or &quot;Type&quot; column heading.</p><p>By default each attribute is optional. For any that are required, select the attribute and uncheck the &quot;Optional&quot; checkbox in the inspector.</p><p>Optionally specify default values for each attribute. Select an attribute and enter a value for &quot;Default Value&quot; in the inspector.</p><p>Optionally specify validation criteria for each attribute. Select an attribute and enter values for &quot;Validation&quot; in the inspector.</p><p>Optionally add relationships between entities. Each relationship specifies a Relationship name, Destination, Type, and Delete Rule. The &quot;Type&quot; in the Inspector can be &quot;To One&quot; or &quot;To Many&quot;.</p><p>The &quot;Delete Rule&quot; in the Inspector can be &quot;Nullify&quot;, &quot;Cascade&quot;, or &quot;Deny&quot;.</p><p>&quot;Nullify&quot; means instances can be deleted without also deleting related entities. References to deleted entities are set to <code>nil</code>.</p><p>&quot;Cascade&quot; means instances can be deleted and related entities will also be deleted.</p><p>&quot;Deny&quot; means instances with related entities cannot be deleted.</p><p>Specify inverse relationships for most relationships. For example, &quot;PersonEntity&quot; can have an &quot;owns&quot; relationship &quot;To Many&quot; &quot;DogEntity&quot; and &quot;DogEntity&quot; can have an &quot;ownedBy&quot; relationship &quot;To One&quot; &quot;PersonEntity&quot;.</p><p>Optionally view the entities and their relationships as a graph. To switch between viewing entities and their relationships in &quot;table&quot; or &quot;graph&quot; style, click the buttons in the lower-right labelled &quot;Editor Style&quot;. In graph view it may be necessary to toggle the relationships in each entity by clicking the triangle to the left of &quot;Relationships&quot; in order to see all of them.</p><p>If you see the error &quot;cannot find type 'SomeEntityName' in scope&quot;, close and reopen the project in Xcode. In some cases, such as renaming entities, it is necessary to clear existing data and start over. To do this:</p><ul><li>clean the build folder by pressing cmd-shift-k</li><li>quit out of Xcode</li><li>cd to ~/Library/Developer/Xcode/DerivedData</li><li>run the <code>rm -rf</code> command on the directory for the project</li><li>restart Xcode</li></ul><h2 id="entity-codegen" tabindex="-1">Entity Codegen</h2><p>When an entity is selected in the Core Data model editor, the Inspector displays its configuration options. One of these is &quot;Codegen&quot; that has a default value of &quot;Class Definition&quot;. This means that Xcode will automatically generate a class definition for the entity. Typically this is the desired option.</p><p>By default, the source files for generated entity classes do not appear in the Navigator. However, they can be viewed by selecting Product ... Show Build Folder in Finder. The source files can be found in the ridiculously deep directory structure Build/Intermediates.noindex/{app-name}.build/Debug-iphonesimulator/ {app-name}.build/DerivedSources/CoreDataGenerated/Model directory.</p><p>There are two generated files for each entity. <code>{entity-name}+CoreDataClass.swift</code> defines the class and should not be modified. <code>{entity-name}+CoreDataProperties.swift</code> defines extensions to the class and can be safely modified to add computed properties and methods.</p><p>Choosing a different value for the entity &quot;Codegen&quot; enables generating entity sources files that appear in the Navigator. The &quot;Manual/None&quot; option means that Xcode will not automatically generate either of the files described above. The &quot;Category/Extension&quot; option means that Xcode will generate the <code>{entity-name}+CoreDataClass.swift</code> files, but not the <code>{entity-name}+CoreDataProperties.swift</code> files. TODO: Why does this also generate &quot;Class&quot; files?</p><p>To request generation of source files for entities whose &quot;Codegen&quot; option is set to a value other than &quot;Class Definition&quot;:</p><ul><li>Select Editor ... Create NSManagedObject Subclass...</li><li>Select a model and click &quot;Next&quot;. Most projects only have one model.</li><li>Select the entities for which code should be generated and click &quot;Next&quot;.</li><li>Select the project subdirectory where the source files should be written. TODO: It seems this is ignored and the files are always written to the top project directory.</li><li>Click &quot;Create&quot;.</li></ul><p>The generated &quot;Class&quot; files define a class for an entity that inherits from <code>NSManagedObject</code>. These file should not be modified.</p><p>The generated &quot;Properties&quot; files define extensions to the entity that include a <code>fetchRequest</code> method. This fetches all the instances of the entity, properties that correspond to the entity attributes, and methods for adding and removing other kinds of entities that have a relationship to this one. Theses file can be modified to add computed properties and methods.</p><h2 id="%40fetchrequest-vs.-viewmodel" tabindex="-1">@FetchRequest vs. ViewModel</h2><p>There are two popular ways for views to access data from Core Data. One is to use <code>@FetchRequest</code>. The other is to define a ViewModel class that views can use which abstracts the use of Core Data away from them.</p><h3 id="using-%40fetchrequest" tabindex="-1">Using @FetchRequest</h3><p>TODO: Add this based on code in your SwiftUI-GiftTrack project.</p><h3 id="using-a-viewmodel" tabindex="-1">Using a ViewModel</h3><p>Here are the steps to define and use a ViewModel for accessing data in Core Data.</p><ul><li><p>Create a view model class.</p><p>This can be defined in a file named &quot;ViewModel.swift&quot;. It can define a class named &quot;ViewModel&quot; that inherits from <code>ObservableObject</code> which comes from the Combine framework.</p></li><li><p>Declare a <code>container</code> constant property as follows:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">let</span> container<span class="token punctuation">:</span> <span class="token class-name">NSPersistentContainer</span></code></pre></li><li><p>Declare a <code>context</code> variable property as follows:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">var</span> context<span class="token punctuation">:</span> <span class="token class-name">NSManagedObjectContext</span> <span class="token punctuation">{</span> container<span class="token punctuation">.</span>viewContext <span class="token punctuation">}</span></code></pre></li><li><p>Declare a published array property to hold all the instances of each entity type as follows:</p><pre class="language-swift"><code class="language-swift"><span class="token attribute atrule">@Published</span> <span class="token keyword">var</span> people<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">PersonEntity</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></code></pre></li><li><p>If Xcode doesn't recognize the entity types, close the project and reopen it.</p></li><li><p>Define an initializer as follows:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// "Model" here must be the name of the "Data Model" file.</span><br>    container <span class="token operator">=</span> <span class="token class-name">NSPersistentContainer</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Model"</span></span><span class="token punctuation">)</span><br><br>    container<span class="token punctuation">.</span>loadPersistentStores <span class="token punctuation">{</span> <span class="token omit keyword">_</span><span class="token punctuation">,</span> error <span class="token keyword">in</span><br>        <span class="token keyword">if</span> <span class="token keyword">let</span> error <span class="token operator">=</span> error <span class="token punctuation">{</span><br>            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"error loading Core Data:"</span></span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>            <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">fetchPeople</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>            <span class="token comment">// Possibly also fetch other kinds of entities here.</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Define a method for each entity type that fetches all of its instances. The <code>List</code> view is useful for displaying them in a list.</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">func</span> <span class="token function-definition function">fetchPeople</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// "PersonEntity" here must be the name of the entity type.</span><br>    <span class="token keyword">let</span> request <span class="token operator">=</span> <span class="token class-name">NSFetchRequest</span><span class="token operator">&lt;</span><span class="token class-name">PersonEntity</span><span class="token operator">></span><span class="token punctuation">(</span>entityName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"PersonEntity"</span></span><span class="token punctuation">)</span><br>    <span class="token comment">// Optionally specify how the instances should be sorted.</span><br>    request<span class="token punctuation">.</span>sortDescriptors <span class="token operator">=</span> <span class="token punctuation">[</span><br>        <span class="token class-name">NSSortDescriptor</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"name"</span></span><span class="token punctuation">,</span> ascending<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><br>    <span class="token punctuation">]</span><br>    <span class="token keyword">do</span> <span class="token punctuation">{</span><br>        <span class="token comment">// people here must be the name of the</span><br>        <span class="token comment">// @Published property declared above.</span><br>        people <span class="token operator">=</span> <span class="token keyword">try</span> context<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span><br>        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"fetchPeople error:"</span></span><span class="token punctuation">,</span> error<span class="token punctuation">.</span>localizedDescription<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Optionally add filtering to the <code>request</code> object above.</p><p>TODO: Describe filter options here!</p></li><li><p>Define a method to save changes to any data in the context.</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">func</span> <span class="token function-definition function">saveContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">do</span> <span class="token punctuation">{</span><br>        <span class="token keyword">try</span> context<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span><br>        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"saveContext error:"</span></span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Define a method for each entity type that the UI can call to add a new entity instance.</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">func</span> <span class="token function-definition function">addPerson</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token class-name">PersonEntity</span><span class="token punctuation">(</span>context<span class="token punctuation">:</span> context<span class="token punctuation">)</span><br>    <span class="token comment">// Set all the attributes of the new entity instance.</span><br>    person<span class="token punctuation">.</span>name <span class="token operator">=</span> name<br>    <span class="token function">saveContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    people<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><br>    people<span class="token punctuation">.</span>sort <span class="token punctuation">{</span> <span class="token punctuation">(</span><span class="token short-argument">$0</span><span class="token punctuation">.</span>name <span class="token operator">??</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token short-argument">$1</span><span class="token punctuation">.</span>name <span class="token operator">??</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Define a method for each entity type that the UI can call to delete an entity instance.</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">func</span> <span class="token function-definition function">deletePeople</span><span class="token punctuation">(</span>indexSet<span class="token punctuation">:</span> <span class="token class-name">IndexSet</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">for</span> index <span class="token keyword">in</span> indexSet <span class="token punctuation">{</span><br>        context<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>people<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><br>        people<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>at<span class="token punctuation">:</span> index<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>    <span class="token function">saveContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre></li><li><p>In each view that needs to access entity data, declare a property with the <code>@StateObject</code> property wrapper that has a type of <code>ViewModel</code>. Do not declare this to be <code>private</code> because it will be passed in from a parent view.</p><pre class="language-swift"><code class="language-swift"><span class="token attribute atrule">@StateObject</span> <span class="token keyword">var</span> vm<span class="token punctuation">:</span> <span class="token class-name">ViewModel</span></code></pre></li><li><p>To add an entity instance, call an &quot;add&quot; method defined in <code>ViewModel.swift</code>.</p><pre class="language-swift"><code class="language-swift">vm<span class="token punctuation">.</span><span class="token function">addPerson</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> name<span class="token punctuation">)</span></code></pre></li><li><p>To delete an entity instance, call a &quot;delete&quot; method defined in <code>ViewModel.swift</code>. Often this is done with the <code>onDelete</code> view modifier on a <code>ForEach</code> because that provides an <code>IndexSet</code> of selected indexes.</p><pre class="language-swift"><code class="language-swift"><span class="token punctuation">.</span><span class="token function">onDelete</span><span class="token punctuation">(</span>perform<span class="token punctuation">:</span> vm<span class="token punctuation">.</span>deletePerson<span class="token punctuation">)</span></code></pre></li><li><p>To update an entity instance directly modify the attributes of an existing entity and then call the <code>saveContext</code> method</p><pre class="language-swift"><code class="language-swift">person<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Some New Name"</span></span><br>vm<span class="token punctuation">.</span><span class="token function">savePeople</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></li></ul><h2 id="entity-objects" tabindex="-1">Entity Objects</h2><p>Core Data entity objects have many properties and methods.</p><p>Each attribute is represented by a property that can be directly accessed and modified. Changes are not persisted unless <code>context.save()</code> is called.</p><p>Each relationship is represented by a property.</p><p>Properties for &quot;To One&quot; relationships have an optional type matching the referenced entity type. For example, <code>DogEntity</code> with an <code>ownedBy</code> relationship to a <code>PersonEntity</code> has an <code>ownedBy</code> property with a type of <code>PersonEntity?</code>. This can be directly set to a <code>PersonEntity</code> or <code>nil</code>. For example, <code>someDog.ownedBy = somePerson</code> or <code>someDog.ownedBy = nil</code>.</p><p>Properties for &quot;To Many&quot; relationships have a type of optional <code>NSSet</code>. For example, <code>PersonEntity</code> with an <code>owns</code> relationship to <code>DogEntity</code> instances has an <code>owns</code> property whose type is <code>NSSet?</code>. There are also <code>addToOwns</code> and <code>removeFromOwns</code> methods on the entity that take a <code>DogEntity</code> and add to or remove from the <code>NSSet</code>. For example, <code>somePerson.addToOwns(someDog)</code> or <code>somePerson.removeFromOwns(someDog)</code>.</p><p>TODO: How can all instances of a given entity type be deleted?</p><h2 id="fetching-entities" tabindex="-1">Fetching Entities</h2><p>To fetch entities from an <code>NSManagedObjectContext</code>, create an <code>NSFetchRequest</code> that identifies an entity type. Optionally specify how the fetched entity instances should be sorted. Also, optionally specify filtering to be applied so that only a subset of the the entity instances will be fetched.</p><p>For details on the syntax used to specify filtering, see <a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Predicates/Articles/pSyntax.html?v=1.0.20" rel="noopener" target="_blank">Predicate Format String Syntax</a>.</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">let</span> request <span class="token operator">=</span> <span class="token class-name">NSFetchRequest</span><span class="token operator">&lt;</span><span class="token class-name">PersonEntity</span><span class="token operator">></span><span class="token punctuation">(</span>entityName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"PersonEntity"</span></span><span class="token punctuation">)</span><br><br><span class="token comment">// Sort in ascending order on the "name" property.</span><br>request<span class="token punctuation">.</span>sortDescriptors <span class="token operator">=</span> <span class="token punctuation">[</span><br>    <span class="token class-name">NSSortDescriptor</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"name"</span></span><span class="token punctuation">,</span> ascending<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><br><span class="token punctuation">]</span><br><br><span class="token comment">// Filter so only entities with a name beginning with "T" are fetched.</span><br>request<span class="token punctuation">.</span>predicate <span class="token operator">=</span> <span class="token class-name">NSPredicate</span><span class="token punctuation">(</span>format<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"name beginswith %@"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"T"</span></span><span class="token punctuation">)</span><br><br><span class="token keyword">do</span> <span class="token punctuation">{</span><br>    people <span class="token operator">=</span> <span class="token keyword">try</span> context<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><br><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span><br>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"fetchPeople error:"</span></span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre><h2 id="starting-over" tabindex="-1">Starting Over</h2><p>The easiest way to delete the data an app has stored in Core Data and start over with a clean slate is to delete the app from the Simulator or a device and reinstall it.</p><h2 id="cloudkit-integration" tabindex="-1">CloudKit Integration</h2><p>The contents of a Core Data database can be automatically synchronized with a CloudKit database in iCloud.</p><p>When the database is &quot;private&quot; (the default), the data is shared between all devices owned by a single user. When the database is &quot;public&quot;, the data is shared between all users and all devices. When the database is &quot;shared&quot;, the data is shared only with specific users.</p><p>For a working example, see this <a href="https://github.com/mvolkmann/swiftui-cloudkit-core-data?v=1.0.20" rel="noopener" target="_blank">GitHub project</a>.</p><p>Both Core Data and CloudKit support storing structured data, but they use different terminology.</p><table><thead><tr><th>Topic</th><th>Core Data</th><th>CloudKit</th></tr></thead><tbody><tr><td>objects</td><td><code>NSManagedObject</code></td><td><code>CKRecord</code></td></tr><tr><td>models</td><td><code>NSManagedObjectModel</code></td><td><code>Schema</code></td></tr><tr><td>stores</td><td><code>NSPersistentStore</code></td><td><code>CKRecordZone</code> or <code>CKDatabase</code></td></tr></tbody></table><p>Conversions between these types are performed automatically by <code>NSPersistentCloudKitContainer</code>. The file <code>Model.swift</code> in the example app, creates a container of this type and ties it to the model defined in the file <code>Model.xcdatamodeld</code>.</p><p>To combine the use of Core Data and CloudKit:</p><ol><li>Create a new app and check the &quot;Use Core Data&quot; and &quot;Host in CloudKit&quot; checkboxes.</li><li>Add the &quot;iCloud&quot; capability.</li><li>Under &quot;Services&quot;, check the &quot;CloudKit&quot; checkbox.</li><li>Under &quot;Containers&quot;, click the &quot;+&quot; button and enter a container name that is &quot;iCloud.&quot; plus your reverse internet domain followed by a period and the app name.</li><li>Add the &quot;Background Modes&quot; capability.</li><li>Check the &quot;Remote notifications&quot; checkbox.</li><li>Add source files similar to those in the example app linked above.</li></ol><p>CloudKit prefixes all record and field names with &quot;CD_&quot;, which is an abbreviation for &quot;Core Data&quot;. A system record named &quot;Users&quot; is created by default. These records cannot be queried.</p><p>By default, a private database is created. This is restricted to the current app user, but is shared across all of their devices.</p><p>To enable querying records from the CloudKit Dashboard website:</p><ol><li>Browse the CloudKit Dashboard at <a href="https://icloud.developer.apple.com/dashboard/">https://icloud.developer.apple.com/dashboard/</a>.</li><li>Click the big &quot;CloudKit Database&quot; button.</li><li>Select a CloudKit database from the dropdown at the top.</li><li>In the left nav under &quot;Schema&quot;, click &quot;Indexes&quot;.</li><li>For each record type, select it, click &quot;Add Basic Index&quot;, select &quot;recordName&quot; from the dropdown, verify that an &quot;Index Type&quot; of &quot;Queryable&quot; is selected, click &quot;Add Basic Index&quot; again, select &quot;modifiedTimestamp&quot; from the dropdown, verify that an &quot;Index Type&quot; of &quot;Queryable&quot; is selected, and click the &quot;Save Changes&quot; button.</li><li>Under &quot;Data&quot; in the left nav, click &quot;Records&quot;.</li><li>In the Database dropdown, select &quot;Private Database&quot;.</li><li>In the Zone dropdown, select the zone created for you by <code>NSPersistentCloudKitDatabase</code> which is named &quot;com.apple.coredata.cloudkit.zone&quot;, not &quot;_defaultZone&quot;.</li><li>In the &quot;Record Type&quot; dropdown, select a record name.</li><li>Click the &quot;Query Records&quot; button. Note that after adding records in the app it can take a minute until they appear in the CloudKit Dashboard.</li><li>To create a new record, click the &quot;+&quot; button after the &quot;Records&quot; heading, select a record type from the &quot;Type&quot; dropdown, select &quot;Create New Record&quot;, enter a record name in the &quot;CD_entityName&quot; input, enter attribute values in the remaining inputs, and click the &quot;Save&quot; button. Relationship attribute values must be set to the unique id string of record to which they refer.</li><li>To modify record attributes, click a record name (blue link), edit data in the inspector panel on the right, click the &quot;Save&quot; button. To undo changes before saving them, click the &quot;Reload&quot; button.</li><li>To see changes in the record table, re-run the query.</li><li>To delete a record, click a record name (blue link), click the &quot;Delete&quot; button, and confirm by clicking another &quot;Delete&quot; button.</li></ol></article>