<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>App Reviews</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#resources">Resources</a></li><li><a href="#appreview-type">AppReview Type</a></li><li><a href="#automatic-prompt">Automatic Prompt</a></li><li><a href="#review-button">Review Button</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p>Users can submit app reviews that include 1-5 starts and text. They can do this by finding the app in the App Store and tapping &quot;Write a Review&quot;. In addition, an app can ask the user to provide a review. This post describes how to implement such requests in an app.</p><p>Regardless of the number of times the an app requests a review, the system will only prompt the user up to three times per year. This is not enforced when running locally during development.</p><p>If a user opens the Settings app, selects &quot;App Store&quot;, and toggles off &quot;In-App Ratings &amp; Reviews&quot; then they will never see app review requests.</p><p>Apple provides these basic guidelines:</p><ul><li>Make the request at a time that does not interrupt a task the user is attempting to complete.</li><li>Avoid making a request immediately after the app launches.</li><li>Avoid making a request as a result of a user action.</li></ul><p>Presumably this leaves making the request based on a timer.</p><p>For example, in the &quot;Feature Weather&quot; app I could only request a review after the user has visited all four screens and looked at weather in a city other than their own. After that I could only ask for another review after a new version of the app is installed and all these same steps are performed again.</p><p>For testing the app review logic, you could make the triggering activity be opening an &quot;info&quot; sheet a given number of times.</p><h2 id="resources" tabindex="-1">Resources</h2><ul><li>Apple Developer page <a href="https://developer.apple.com/documentation/storekit/requesting_app_store_reviews?v=1.0.21" rel="noopener" target="_blank">Requesting App Store reviews</a></li><li>Stewart Lynch YouTube video <a href="https://www.youtube.com/watch?v=fLR7E2579Dg?v=1.0.21" rel="noopener" target="_blank">App Review Request iOS 16</a></li></ul><h2 id="appreview-type" tabindex="-1">AppReview Type</h2><p>The following code is derived from the excellent Stewart Lynch YouTube video <a href="https://www.youtube.com/watch?v=fLR7E2579Dg?v=1.0.21" rel="noopener" target="_blank">App Review Request iOS 16</a>.</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">SwiftUI</span><br><br><span class="token keyword">struct</span> <span class="token class-name">AppReview</span> <span class="token punctuation">{</span><br>    <span class="token comment">// We only want to prompt for an app review if the user</span><br>    <span class="token comment">// has visited all the screens in the app multiple times.</span><br>    <span class="token comment">// That way they should know enough about the app</span><br>    <span class="token comment">// to leave an informed review.</span><br>    <span class="token attribute atrule">@AppStorage</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"chartVisits"</span></span><span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token keyword">var</span> chartVisits <span class="token operator">=</span> <span class="token number">0</span><br>    <span class="token attribute atrule">@AppStorage</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"currentVisits"</span></span><span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token keyword">var</span> currentVisits <span class="token operator">=</span> <span class="token number">0</span><br>    <span class="token attribute atrule">@AppStorage</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"forecastVisits"</span></span><span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token keyword">var</span> forecastVisits <span class="token operator">=</span> <span class="token number">0</span><br>    <span class="token attribute atrule">@AppStorage</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"heatMapVisits"</span></span><span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token keyword">var</span> heatMapVisits <span class="token operator">=</span> <span class="token number">0</span><br>    <span class="token attribute atrule">@AppStorage</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"settingsVisits"</span></span><span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token keyword">var</span> settingsVisits <span class="token operator">=</span> <span class="token number">0</span><br><br>    <span class="token comment">// Once we have asked the user to leave a review,</span><br>    <span class="token comment">// we only want to ask again if they have installed a new version.</span><br>    <span class="token attribute atrule">@AppStorage</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"lastReviewedAppVersion"</span></span><span class="token punctuation">)</span> <span class="token keyword">var</span> lastReviewedAppVersion <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span><br><br>    <span class="token comment">// Singleton</span><br>    <span class="token keyword">static</span> <span class="token keyword">let</span> shared <span class="token operator">=</span> <span class="token class-name">AppReview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token keyword">private</span> <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br><br>    <span class="token keyword">private</span> <span class="token keyword">let</span> triggerTarget <span class="token operator">=</span> <span class="token number">3</span><br><br>    <span class="token keyword">private</span> <span class="token keyword">var</span> appVersion<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> infoDict <span class="token operator">=</span> <span class="token class-name">Bundle</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span>infoDictionary<span class="token operator">!</span><br>        <span class="token keyword">let</span> key <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"CFBundleShortVersionString"</span></span><br>        <span class="token keyword">return</span> infoDict<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token keyword">as</span><span class="token operator">?</span> <span class="token class-name">String</span> <span class="token operator">??</span> <span class="token string-literal"><span class="token string">""</span></span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">clearVisits</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        chartVisits <span class="token operator">=</span> <span class="token number">0</span><br>        currentVisits <span class="token operator">=</span> <span class="token number">0</span><br>        forecastVisits <span class="token operator">=</span> <span class="token number">0</span><br>        heatMapVisits <span class="token operator">=</span> <span class="token number">0</span><br>        settingsVisits <span class="token operator">=</span> <span class="token number">0</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">var</span> haveNewVersion<span class="token punctuation">:</span> <span class="token class-name">Bool</span> <span class="token punctuation">{</span><br>        appVersion <span class="token operator">!=</span> lastReviewedAppVersion<br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// For debugging</span><br>    <span class="token keyword">func</span> <span class="token function-definition function">printVisits</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"currentVisits ="</span></span><span class="token punctuation">,</span> currentVisits<span class="token punctuation">)</span><br>        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"forecastVisits ="</span></span><span class="token punctuation">,</span> forecastVisits<span class="token punctuation">)</span><br>        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"chartVisits ="</span></span><span class="token punctuation">,</span> chartVisits<span class="token punctuation">)</span><br>        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"heatMapVisits ="</span></span><span class="token punctuation">,</span> heatMapVisits<span class="token punctuation">)</span><br>        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"settingsVisits ="</span></span><span class="token punctuation">,</span> settingsVisits<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">func</span> <span class="token function-definition function">reviewURL</span><span class="token punctuation">(</span>appId<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token constant">URL</span><span class="token operator">?</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> string <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"https://apps.apple.com/app/id</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">appId</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">?action=write-review"</span></span><br>        <span class="token keyword">return</span> <span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> string<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">var</span> shouldRequest<span class="token punctuation">:</span> <span class="token class-name">Bool</span> <span class="token punctuation">{</span><br>        <span class="token keyword">guard</span> haveNewVersion <span class="token keyword">else</span> <span class="token punctuation">{</span><br>            <span class="token function">clearVisits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>            <span class="token keyword">return</span> <span class="token boolean">false</span><br>        <span class="token punctuation">}</span><br><br>        <span class="token comment">// printVisits()</span><br>        <span class="token keyword">let</span> target <span class="token operator">=</span> <span class="token number">3</span><br>        <span class="token keyword">let</span> usedEnough <span class="token operator">=</span><br>            chartVisits <span class="token operator">>=</span> target <span class="token operator">&amp;&amp;</span><br>            currentVisits <span class="token operator">>=</span> target <span class="token operator">&amp;&amp;</span><br>            forecastVisits <span class="token operator">>=</span> target <span class="token operator">&amp;&amp;</span><br>            heatMapVisits <span class="token operator">>=</span> target <span class="token operator">&amp;&amp;</span><br>            settingsVisits <span class="token operator">>=</span> <span class="token number">1</span><br>        <span class="token comment">// print("usedEnough =", usedEnough)</span><br>        <span class="token keyword">if</span> usedEnough <span class="token punctuation">{</span><br>            lastReviewedAppVersion <span class="token operator">=</span> appVersion<br>            <span class="token function">clearVisits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">return</span> usedEnough<br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><h2 id="automatic-prompt" tabindex="-1">Automatic Prompt</h2><p>After the user has used a sufficient number of app features, it's a good idea to wait a few seconds and then display a dialog that prompts for a review. The following code does this:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function-definition function">appReview</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">guard</span> <span class="token class-name">AppReview</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span>shouldRequest <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span><br><br>    <span class="token class-name">Task</span> <span class="token punctuation">{</span><br>        <span class="token comment">// Wait 3 seconds before requesting an app review.</span><br>        <span class="token keyword">try</span> <span class="token keyword">await</span> <span class="token class-name">Task</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><br>            until<span class="token punctuation">:</span> <span class="token punctuation">.</span>now <span class="token operator">+</span> <span class="token punctuation">.</span><span class="token function">seconds</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            clock<span class="token punctuation">:</span> <span class="token punctuation">.</span>suspending<br>        <span class="token punctuation">)</span><br>        <span class="token function">requestReview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>Call the <code>appReview</code> function after every visit to an app feature that is being tracked. For example:</p><pre class="language-swift"><code class="language-swift"><span class="token attribute atrule">@AppStorage</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"chartVisits"</span></span><span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token keyword">var</span> chartVisits <span class="token operator">=</span> <span class="token number">0</span><br><span class="token attribute atrule">@AppStorage</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"currentVisits"</span></span><span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token keyword">var</span> currentVisits <span class="token operator">=</span> <span class="token number">0</span><br><span class="token attribute atrule">@AppStorage</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"forecastVisits"</span></span><span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token keyword">var</span> forecastVisits <span class="token operator">=</span> <span class="token number">0</span><br><span class="token attribute atrule">@AppStorage</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"heatMapVisits"</span></span><span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token keyword">var</span> heatMapVisits <span class="token operator">=</span> <span class="token number">0</span><br><span class="token attribute atrule">@AppStorage</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"settingsVisits"</span></span><span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token keyword">var</span> settingsVisits <span class="token operator">=</span> <span class="token number">0</span><br><br><span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> selectedTab<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token omit keyword">_</span> <span class="token keyword">in</span><br>    <span class="token keyword">switch</span> selectedTab <span class="token punctuation">{</span><br>    <span class="token keyword">case</span> <span class="token string-literal"><span class="token string">"chart"</span></span><span class="token punctuation">:</span> chartVisits <span class="token operator">+=</span> <span class="token number">1</span><br>    <span class="token keyword">case</span> <span class="token string-literal"><span class="token string">"current"</span></span><span class="token punctuation">:</span> currentVisits <span class="token operator">+=</span> <span class="token number">1</span><br>    <span class="token keyword">case</span> <span class="token string-literal"><span class="token string">"forecast"</span></span><span class="token punctuation">:</span> forecastVisits <span class="token operator">+=</span> <span class="token number">1</span><br>    <span class="token keyword">case</span> <span class="token string-literal"><span class="token string">"heatmap"</span></span><span class="token punctuation">:</span> heatMapVisits <span class="token operator">+=</span> <span class="token number">1</span><br>    <span class="token comment">// settingsVisits is incremented when a gear icon is tapped.</span><br>    <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token keyword">break</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token function">appReview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre><h2 id="review-button" tabindex="-1">Review Button</h2><p>When the user is asked to leave a review they can tap &quot;Not Now&quot; to opt out. Later they may want to change their review or leave a review for the first time. It's a good idea to provide a button they can tap to do so rather than requiring them to find the app in the App Store and leave a review there.</p><p>The following code adds a button for leaving a review only if the user has been asked to leave a review based on having used a sufficient number of app features.</p><pre class="language-swift"><code class="language-swift"><span class="token comment">// This is the 10-digit app id seen in the App Store Connect URL for the app.</span><br><span class="token keyword">let</span> appId <span class="token operator">=</span> <span class="token number">1234567890</span><br><br><span class="token keyword">let</span> appReview <span class="token operator">=</span> <span class="token class-name">AppReview</span><span class="token punctuation">.</span>shared<br><span class="token keyword">if</span> <span class="token operator">!</span>appReview<span class="token punctuation">.</span>haveNewVersion <span class="token punctuation">{</span><br>    <span class="token comment">// This only works on a real device, not in the Simulator.</span><br>    <span class="token keyword">if</span> <span class="token keyword">let</span> url <span class="token operator">=</span> appReview<span class="token punctuation">.</span><span class="token function">reviewURL</span><span class="token punctuation">(</span>appId<span class="token punctuation">:</span> appId<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token class-name">Link</span><span class="token punctuation">(</span>destination<span class="token punctuation">:</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Write a Review"</span></span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>        <span class="token punctuation">.</span><span class="token function">buttonStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>borderedProminent<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre></article>