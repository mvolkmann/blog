<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>SwiftData</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#projects">Projects</a></li><li><a href="#models">Models</a></li><li><a href="#containers">Containers</a></li><li><a href="#creating-data">Creating Data</a></li><li><a href="#retrieving-data">Retrieving Data</a></li><li><a href="#updating-data">Updating Data</a></li><li><a href="#deleting-data">Deleting Data</a></li><li><a href="#migration">Migration</a></li><li><a href="#%40observable-and-%40bindable">@Observable and @Bindable</a></li><li><a href="#example-project">Example Project</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p><a href="https://developer.apple.com/xcode/swiftdata/?v=1.0.21" rel="noopener" target="_blank">SwiftData</a> was added in iOS 17. From Apple,</p><blockquote><p>SwiftData makes it easy to persist data using declarative code. You can query and filter data using regular Swift code. And it’s designed to integrate seamlessly with SwiftUI.</p></blockquote><h2 id="projects" tabindex="-1">Projects</h2><p>To create a new project that uses SwiftData:</p><ul><li>Select File ... New ... Project...</li><li>In the dialog that appears, select &quot;App&quot;.</li><li>Click the &quot;Next&quot; button.</li><li>Enter a &quot;Product Name&quot;.</li><li>For the Interface, select &quot;SwiftUI&quot;.</li><li>For the Language, select &quot;Swift&quot;.</li><li>For the Storage, select &quot;SwiftData&quot;.</li><li>Optionally check the checkbox for &quot;Host in CloudKit&quot; to enable sharing the data between devices. When not checked, the data will only be stored in the device where the app runs.</li><li>Click the &quot;Next&quot; button.</li><li>Select the directory where the project will be stored.</li><li>Click the &quot;Create&quot; button.</li></ul><p>The new project will contain the following files:</p><ul><li><code>Item.swift</code> - an example model definition where the only property is <code>timestamp</code></li><li><code>ContentView.swift</code> - a <code>View</code> subtype that supports creating, retrieving, and deleting <code>Item</code> instances</li><li><code>Assets.xcassets</code> - an asset file that contains placeholders for <code>AccentColor</code> and <code>AppIcon</code></li><li><code>{project-name}App.swift</code> - an <code>App</code> subtype that creates a model container for <code>Item</code> instances and displays a <code>ContentView</code></li></ul><h2 id="models" tabindex="-1">Models</h2><p>An example model is provided in <code>Item.swift</code>. Define additional models in new <code>.swift</code> files. Optionally delete <code>Item.swift</code> if not needed.</p><p>To define a model, add the <code>@Model</code> macro to a <code>class</code> definition. This macro cannot be applied to <code>struct</code> definitions. The macro causes the class to conform to the <a href="https://developer.apple.com/documentation/SwiftData/PersistentModel?v=1.0.21" rel="noopener" target="_blank">PersistentModel</a> protocol.</p><p>Declarations can be added class properties to customize how they are persisted. For example:</p><pre class="language-swift"><code class="language-swift"><span class="token comment">// Add a uniqueness constraint to a property.</span><br><span class="token comment">// If a persisted object exists with the same value for this attribute,</span><br><span class="token comment">// an "upsert" is performed instead of an insert.</span><br><span class="token comment">// No error is thrown.</span><br><span class="token attribute atrule">@Attribute</span><span class="token punctuation">(</span><span class="token punctuation">.</span>unique<span class="token punctuation">)</span> <span class="token keyword">var</span> id<span class="token punctuation">:</span> int<br><br><span class="token comment">// Change the name of an existing property after data has been persisted.</span><br><span class="token comment">// Existing and future persisted objects will continue using the original name,</span><br><span class="token comment">// but code can be changed to use the new name (creationDate in this case.)</span><br><span class="token attribute atrule">@Attribute</span><span class="token punctuation">(</span>originalName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"creation_date"</span></span><span class="token punctuation">)</span> <span class="token keyword">var</span> creationDate<span class="token punctuation">:</span> <span class="token class-name">Date</span><br><br><span class="token comment">// If an object is deleted, also delete the objects</span><br><span class="token comment">// referrred to by this property (cascading delete).</span><br><span class="token comment">// If a referenced object is deleted,</span><br><span class="token comment">// persisted references to it will automatically be removed.</span><br><span class="token attribute atrule">@Relationship</span><span class="token punctuation">(</span><span class="token punctuation">.</span>cascade<span class="token punctuation">)</span> <span class="token keyword">var</span> cars<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Car</span><span class="token punctuation">]</span><br><br><span class="token comment">// It is also possible to specify the `min` and `max` occurrences</span><br><span class="token comment">// allowed in a relationship.</span><br><br><span class="token comment">// Do not persist this property.</span><br><span class="token comment">// These properties should have a default value that is</span><br><span class="token comment">// used when objects are fetched using SwiftData.</span><br><span class="token attribute atrule">@Transient</span> <span class="token keyword">var</span> socialSecurityNumber <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span></code></pre><p>TODO: Watch the session “Model your schema with SwiftData” session.</p><h2 id="containers" tabindex="-1">Containers</h2><p>Create a container to manage persistence.</p><p>For example:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">let</span> container <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">ModelContainer</span><span class="token punctuation">(</span><br>  <span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token class-name">Car</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>  configurations<span class="token punctuation">:</span> <span class="token class-name">ModelConfiguration</span><span class="token punctuation">(</span>url<span class="token punctuation">:</span> <span class="token function">URL</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"some-path"</span></span><span class="token punctuation">)</span> <span class="token comment">// optional</span><br><span class="token punctuation">)</span></code></pre><p>To create a container at the top of the view hierarchy:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">MyApp</span><span class="token punctuation">:</span> <span class="token class-name">App</span> <span class="token punctuation">{</span><br>  <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">Scene</span> <span class="token punctuation">{</span><br>    <span class="token class-name">WindowGroup</span> <span class="token punctuation">{</span><br>    <span class="token class-name">ContentView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><br>  <span class="token punctuation">.</span><span class="token function">modelContainer</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token class-name">Car</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre><p>To access the container in a view:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">SwiftData</span><br><span class="token keyword">import</span> <span class="token class-name">SwiftUI</span><br><br><span class="token keyword">struct</span> <span class="token class-name">ContentView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>  <span class="token attribute atrule">@Environment</span><span class="token punctuation">(</span><span class="token punctuation">\</span><span class="token punctuation">.</span>modelContent<span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token keyword">var</span> context<br>  <span class="token operator">...</span><br><span class="token punctuation">}</span></code></pre><p>To get the context outside the view hierarchy:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">SwiftData</span><br><br><span class="token keyword">let</span> context <span class="token operator">=</span> container<span class="token punctuation">.</span>mainContext<br><span class="token comment">// or</span><br><span class="token keyword">let</span> context <span class="token operator">=</span> <span class="token class-name">ModelContext</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span></code></pre><p>The <code>ModelContext</code> object has an <code>autosaveEnabled</code> property that defaults to <code>true</code>. When this is <code>true</code>, there is no need to call the <code>save</code> method after creating, updating, or deleting persisted objects because it happens automatically. An alternative approach is to set <code>autosaveEnabled</code> to <code>false</code> and manually call the <code>save</code> method after a batch of changes are made.</p><p>Also see the <a href="https://developer.apple.com/documentation/swiftdata/modelcontext/transaction(block:)?v=1.0.21" rel="noopener" target="_blank">transaction</a> and <a href="https://developer.apple.com/documentation/swiftdata/modelcontext/rollback()?v=1.0.21" rel="noopener" target="_blank">rollback</a> methods.</p><h2 id="creating-data" tabindex="-1">Creating Data</h2><p>To create and persist an object, create it using an initializer of a <code>class</code> that is decorated with the <a href="?v=1.0.21" rel="noopener" target="_blank">Model</a> macro and pass the object to the <a href="https://developer.apple.com/documentation/swiftdata/modelcontext?v=1.0.21" rel="noopener" target="_blank">ModelContext</a> <code>insert</code> method. For example:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">let</span> todo <span class="token operator">=</span> <span class="token class-name">Todo</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"some new title"</span></span><span class="token punctuation">)</span><br>context<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span></code></pre><h2 id="retrieving-data" tabindex="-1">Retrieving Data</h2><p>A view can specify the data it needs using the <a href="https://developer.apple.com/documentation/swiftdata/query?v=1.0.21" rel="noopener" target="_blank">Query</a> property wrapper. Any time persisted data matching the query changes, the view will update.</p><p>The <code>Query</code> property wrapper supports many initializers that accept the following:</p><ul><li><code>filter</code>: a <a href="https://developer.apple.com/documentation/foundation/predicate?v=1.0.21" rel="noopener" target="_blank">Predicate</a> object that describes criteria for the objects to return</li><li><code>sort</code>: a <code>KeyPath</code> or array of <a href="https://developer.apple.com/documentation/foundation/sortdescriptor?v=1.0.21" rel="noopener" target="_blank">SortDescriptor</a> objects that describe how the returned objects should be sorted</li><li><code>order</code>: a <a href="https://developer.apple.com/documentation/foundation/sortorder?v=1.0.21" rel="noopener" target="_blank">SortOrder</a> enum value of <code>.forward</code> or <code>.reverse</code></li><li><code>animation</code>: an <a href="https://developer.apple.com/documentation/SwiftUI/Animation?v=1.0.21" rel="noopener" target="_blank">Animation</a> to apply when the data changes</li></ul><p>For example, the following query fetches <code>Todo</code> objects sorted on their title, returning only those not completed:</p><pre class="language-swift"><code class="language-swift"><span class="token attribute atrule">@Query</span><span class="token punctuation">(</span><br>    filter<span class="token punctuation">:</span> <span class="token other-directive property">#Predicate</span><span class="token operator">&lt;</span><span class="token class-name">Todo</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token short-argument">$0</span><span class="token punctuation">.</span>completed <span class="token operator">==</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    sort<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token class-name">Todo</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span><br>    order<span class="token punctuation">:</span> <span class="token punctuation">.</span>forward<span class="token punctuation">,</span><br>    animation<span class="token punctuation">:</span> <span class="token punctuation">.</span>spring<br><span class="token punctuation">)</span></code></pre><p>To fetch data outside of a <code>Query</code>, create and use a <code>Predicate</code> and a <a href="https://developer.apple.com/documentation/swiftdata/fetchdescriptor?v=1.0.21" rel="noopener" target="_blank">FetchDescriptor</a>. For example:</p><pre class="language-swift"><code class="language-swift"><span class="token comment">// Can't use ! operator here.</span><br><span class="token keyword">let</span> predicate <span class="token operator">=</span> <span class="token other-directive property">#Predicate</span><span class="token operator">&lt;</span><span class="token class-name">Todo</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token short-argument">$0</span><span class="token punctuation">.</span>completed <span class="token operator">==</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><br><span class="token keyword">let</span> descriptor <span class="token operator">=</span> <span class="token class-name">FetchDescriptor</span><span class="token punctuation">(</span><br>    predicate<span class="token punctuation">:</span> predicate<span class="token punctuation">,</span><br>    sortBy<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">SortDescriptor</span><span class="token punctuation">(</span><span class="token punctuation">\</span><span class="token class-name">Todo</span><span class="token punctuation">.</span>created<span class="token punctuation">,</span> order<span class="token punctuation">:</span> <span class="token punctuation">.</span>reverse<span class="token punctuation">)</span><span class="token punctuation">]</span><br><span class="token keyword">let</span> uncompletedTodos <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">?</span> context<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span>descriptor<span class="token punctuation">)</span></code></pre><h2 id="updating-data" tabindex="-1">Updating Data</h2><p>To update the properties of persisted objects, directly modify their properties. For example:</p><pre class="language-swift"><code class="language-swift">todo<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"some new title"</span></span></code></pre><p>SwiftData will detect and persist the change with no further action on your part</p><h2 id="deleting-data" tabindex="-1">Deleting Data</h2><p>To delete persisted objects, pass them to the <a href="https://developer.apple.com/documentation/swiftdata/modelcontext?v=1.0.21" rel="noopener" target="_blank">ModelContext</a> <code>delete</code> method. For example:</p><pre class="language-swift"><code class="language-swift">context<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>todos<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><p>The delete method can also be passed a model type and a predicate in order to delete multiple objects in a single call.</p><h2 id="migration" tabindex="-1">Migration</h2><p>When the object schema being persisted needs to change after data has already been persisted, migration is necessary. To do this, define a <a href="https://developer.apple.com/documentation/swiftdata/versionedschema?v=1.0.21" rel="noopener" target="_blank">VersionedSchema</a> for each version of the schema and define a <a href="https://developer.apple.com/documentation/swiftdata/schemamigrationplan?v=1.0.21" rel="noopener" target="_blank">SchemaMigrationPlan</a> that holds an ordered array of the <code>VersionSchema</code> obejcts.</p><p>Migrations can used a &quot;lightweight&quot; stage (no additional code) or a &quot;custom&quot; stage (for more complex changes).</p><h2 id="%40observable-and-%40bindable" tabindex="-1">@Observable and @Bindable</h2><p>This section is not really related to SwiftData.</p><p>The <a href="https://developer.apple.com/documentation/observation/observable-swift.macro?v=1.0.21" rel="noopener" target="_blank">Observable</a> macro provides a new way to define view models. It is a useful alternative to the <code>Model</code> macro for sharing data between views that is not persisted.</p><p>The <a href="https://developer.apple.com/documentation/swiftui/bindable?v=1.0.21" rel="noopener" target="_blank">Bindable</a> property wrapper provides a new way to access view models. Both are new in iOS 17.</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Observation</span><br><span class="token keyword">import</span> <span class="token class-name">SwiftUI</span><br><br><span class="token attribute atrule">@Observable</span><br><span class="token keyword">class</span> <span class="token class-name">MyViewModel</span> <span class="token punctuation">{</span><br>    <span class="token comment">// No longer need @Published on each property.</span><br>    <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span><br><span class="token punctuation">}</span><br><br><span class="token keyword">struct</span> <span class="token class-name">ContentView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>    <span class="token attribute atrule">@Bindable</span> <span class="token keyword">var</span> model <span class="token operator">=</span> <span class="token class-name">MyViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>        <span class="token class-name">VStack</span> <span class="token punctuation">{</span><br>            <span class="token class-name">TextField</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Name"</span></span><span class="token punctuation">,</span> text<span class="token punctuation">:</span> $model<span class="token punctuation">.</span>name<span class="token punctuation">)</span><br>                <span class="token punctuation">.</span><span class="token function">textFieldStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>roundedBorder<span class="token punctuation">)</span><br>            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Hello, </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">model<span class="token punctuation">.</span>name</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">!"</span></span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p><code>Observable</code> objects can be passed to views that accept them as <code>Bindable</code> properties.</p><p>For example, the code above can be modified as follows:</p><pre class="language-swift"><code class="language-swift"><span class="token comment">// Add this view definition.</span><br><span class="token keyword">struct</span> <span class="token class-name">Greet</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>    <span class="token attribute atrule">@Bindable</span> <span class="token keyword">var</span> model <span class="token operator">=</span> <span class="token class-name">MyViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>    <span class="token comment">// Note that we do not need to define an initializer</span><br>    <span class="token comment">// in order to pass in "model".</span><br><br>    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Hello, </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">model<span class="token punctuation">.</span>name</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">!"</span></span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Replace the following:</span><br><span class="token comment">// Text("Hello, \(model.name)!")</span><br><span class="token comment">// With this:</span><br><span class="token class-name">Greet</span><span class="token punctuation">(</span>model<span class="token punctuation">:</span> model<span class="token punctuation">)</span></code></pre><h2 id="example-project" tabindex="-1">Example Project</h2><p>See <a href="https://github.com/mvolkmann/SwiftDataDemo?v=1.0.21" rel="noopener" target="_blank">SwiftDataDemo</a>.</p></article>