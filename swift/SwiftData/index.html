<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>SwiftData</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#projects">Projects</a></li><li><a href="#models">Models</a></li><li><a href="#containers">Containers</a></li><li><a href="#fetching-data">Fetching Data</a></li><li><a href="#%40observable-and-%40bindable">@Observable and @Bindable</a></li><li><a href="#example-project">Example Project</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p><a href="SwiftData?v=1.0.21" rel="noopener" target="_blank">https://developer.apple.com/xcode/swiftdata/</a> was added in iOS 17.</p><blockquote><p>SwiftData makes it easy to persist data using declarative code. You can query and filter data using regular Swift code. And it’s designed to integrate seamlessly with SwiftUI.</p></blockquote><h2 id="projects" tabindex="-1">Projects</h2><p>To create a new project that uses SwiftData:</p><ul><li>Select File ... New ... Project...</li><li>In the dialog that appears, select &quot;App&quot;.</li><li>Click the &quot;Next&quot; button.</li><li>Enter a &quot;Product Name&quot;.</li><li>For the Interface, select &quot;SwiftUI&quot;.</li><li>For the Language, select &quot;Swift&quot;.</li><li>For the Storage, select &quot;SwiftData&quot;.</li><li>Optionally check the checkbox for &quot;Host in CloudKit&quot; to enable sharing the data between devices. When not checked, the data will only be stored in the device where the app runs.</li><li>Click the &quot;Next&quot; button.</li><li>Select the directory where the project will be stored.</li><li>Click the &quot;Create&quot; button.</li></ul><p>This creates a project containing the following files:</p><ul><li><code>Item.swift</code> - an example model definition where the only property is <code>timestamp</code></li><li><code>ContentView.swift</code> - a <code>View</code> subtype that supports creating, retrieving, and deleting <code>Item</code> instances</li><li><code>Assets.xcassets</code> - an asset file that contains placeholders for <code>AccentColor</code> and <code>AppIcon</code></li><li><code>{project-name}App.swift</code> - an <code>App</code> subtype that creates a model container for <code>Item</code> instances and displays a <code>ContentView</code></li></ul><h2 id="models" tabindex="-1">Models</h2><p>An example model is provided in <code>Item.swift</code>. Define additional models in new <code>.swift</code> files. Optionally delete <code>Item.swift</code> if not needed.</p><p>To define a model, add the <code>@Model</code> macro to a <code>class</code> definition. I suspect it needs to be a <code>class</code> instead of a <code>struct</code> to support updating existing data.</p><p>Declarations can be added class properties to customize how they are persisted. For example:</p><pre class="language-swift"><code class="language-swift"><span class="token attribute atrule">@Attribute</span><span class="token punctuation">(</span><span class="token punctuation">.</span>unique<span class="token punctuation">)</span> <span class="token keyword">var</span> id<span class="token punctuation">:</span> int<br><br><span class="token attribute atrule">@Relationship</span><span class="token punctuation">(</span><span class="token punctuation">.</span>cascade<span class="token punctuation">)</span> <span class="token keyword">var</span> cars<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Car</span><span class="token punctuation">]</span> <span class="token comment">// for cascading deletes</span><br><br><span class="token attribute atrule">@Transient</span> <span class="token keyword">var</span> socialSecurityNumber <span class="token comment">// to prevent from being persisted</span></code></pre><p>TODO: Watch the session “Model your schema with SwiftData” session.</p><h2 id="containers" tabindex="-1">Containers</h2><p>Create a container to manage persistence.</p><p>For example:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">let</span> container <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">ModelContainer</span><span class="token punctuation">(</span><br>  <span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token class-name">Car</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>  configurations<span class="token punctuation">:</span> <span class="token class-name">ModelConfiguration</span><span class="token punctuation">(</span>url<span class="token punctuation">:</span> <span class="token function">URL</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"some-path"</span></span><span class="token punctuation">)</span> <span class="token comment">// optional</span><br><span class="token punctuation">)</span></code></pre><p>To create a container at the top of the view hierarchy:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">MyApp</span><span class="token punctuation">:</span> <span class="token class-name">App</span> <span class="token punctuation">{</span><br>  <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">Scene</span> <span class="token punctuation">{</span><br>    <span class="token class-name">WindowGroup</span> <span class="token punctuation">{</span><br>    <span class="token class-name">ContentView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><br>  <span class="token punctuation">.</span><span class="token function">modelContainer</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token class-name">Car</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre><p>To access the container in a view:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">SwiftData</span><br><span class="token keyword">import</span> <span class="token class-name">SwiftUI</span><br><br><span class="token keyword">struct</span> <span class="token class-name">ContentView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>  <span class="token attribute atrule">@Environment</span><span class="token punctuation">(</span><span class="token punctuation">\</span><span class="token punctuation">.</span>modelContent<span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token keyword">var</span> context<br>  <span class="token operator">...</span><br><span class="token punctuation">}</span></code></pre><p>To get the context outside the view hierarchy:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">SwiftData</span><br><br><span class="token keyword">let</span> context <span class="token operator">=</span> container<span class="token punctuation">.</span>mainContext<br><span class="token comment">// or</span><br><span class="token keyword">let</span> context <span class="token operator">=</span> <span class="token class-name">ModelContext</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span></code></pre><h2 id="fetching-data" tabindex="-1">Fetching Data</h2><p>To fetch specific data, create and use a predicate:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">let</span> predicate <span class="token operator">=</span> <span class="token other-directive property">#Predicate</span><span class="token operator">&lt;</span><span class="token class-name">Person</span><span class="token operator">></span> <span class="token punctuation">{</span><br>  <span class="token short-argument">$0</span><span class="token punctuation">.</span>state <span class="token operator">==</span> “<span class="token constant">MO</span>” <span class="token operator">&amp;&amp;</span> <span class="token short-argument">$0</span><span class="token punctuation">.</span>alive<br><span class="token punctuation">}</span><br><span class="token keyword">let</span> people <span class="token operator">=</span> <span class="token keyword">try</span> context<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span>predicate<span class="token punctuation">)</span></code></pre><p>To fetch sorted people:</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">let</span> descriptor <span class="token operator">=</span></code></pre><h2 id="%40observable-and-%40bindable" tabindex="-1">@Observable and @Bindable</h2><p>The <a href="https://developer.apple.com/documentation/observation/observable-swift.macro?v=1.0.21" rel="noopener" target="_blank">Observable</a> macro provides a new way to define view models. The <a href="https://developer.apple.com/documentation/swiftui/bindable?v=1.0.21" rel="noopener" target="_blank">Bindable</a> property wrapper provides a new way to access view models. Both are new in iOS 17.</p><pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Observation</span><br><span class="token keyword">import</span> <span class="token class-name">SwiftUI</span><br><br><span class="token attribute atrule">@Observable</span><br><span class="token keyword">class</span> <span class="token class-name">MyViewModel</span> <span class="token punctuation">{</span><br>    <span class="token comment">// No longer need @Published on each property.</span><br>    <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span><br><span class="token punctuation">}</span><br><br><span class="token keyword">struct</span> <span class="token class-name">ContentView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>    <span class="token attribute atrule">@Bindable</span> <span class="token keyword">var</span> model <span class="token operator">=</span> <span class="token class-name">MyViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span><br>        <span class="token class-name">VStack</span> <span class="token punctuation">{</span><br>            <span class="token class-name">TextField</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Name"</span></span><span class="token punctuation">,</span> text<span class="token punctuation">:</span> $model<span class="token punctuation">.</span>name<span class="token punctuation">)</span><br>                <span class="token punctuation">.</span><span class="token function">textFieldStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>roundedBorder<span class="token punctuation">)</span><br>            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Hello, </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">model<span class="token punctuation">.</span>name</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">!"</span></span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><h2 id="example-project" tabindex="-1">Example Project</h2><p>See <a href="https://github.com/mvolkmann/SwiftDataDemo?v=1.0.21" rel="noopener" target="_blank">SwiftDataDemo</a>.</p></article>