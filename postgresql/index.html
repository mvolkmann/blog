<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>PostgreSQL</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#installing">Installing</a></li><li><a href="#getting-started">Getting Started</a></li><li><a href="#pgadmin">pgAdmin</a></li><li><a href="#supported-column-types">Supported Column Types</a></li><li><a href="#unorganized-content">Unorganized Content</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p><a href="https://www.postgresql.org?v=1.1.1" rel="noopener" target="_blank">PostgreSQL</a> claims to be &quot;the world's most advanced open source relational database&quot;. It is implemented in C. PostgreSQL runs on all common operating systems. It was originally created by Michael Stonebraker and his team at the University of California, Berkeley, in the 1980s.</p><p>Pros of PostgreSQL include:</p><ul><li>open source and free</li><li>advanced SQL compliance</li><li>very extensible through custom functions, operators, data types, and procedural languages</li><li>supports arrays, JSON, XML, and hstore (key/value pairs)</li><li>strong ACID (Atomicity, Consistency, Isolation, Durability) compliance</li><li>excellent performance for read-heavy and write-heavy workloads</li><li>extensive documentation</li></ul><p>Cons of PostgreSQL include:</p><ul><li>can be resource intensive</li><li>configuration and management can be somewhat complex</li><li>doesnâ€™t natively support automatic sharding or scaling across distributed nodes</li></ul><h2 id="installing" tabindex="-1">Installing</h2><p>To install PostgreSQL in macOS, use Homebrew with the command <code>brew install postgresql</code>.</p><p>To build PostgreSQL from source:</p><ol><li>Download and unzip.</li><li>cd to the unzipped directory.</li><li>Enter <code>./configure</code></li><li>Enter <code>make</code></li><li>Enter <code>sudo make install</code></li></ol><p>If an installer is used, a default user named &quot;postgres&quot; is created and it prompts for a password to assign to the user during the install. All the commands are installed in <code>/usr/local/bin</code>. Add <code>-Upostgres</code> to all commands to run as that user. It seems that the server is always running when installed this way.</p><h2 id="getting-started" tabindex="-1">Getting Started</h2><p>To create the initial files required by the database server, enter</p><pre class="language-bash"><code class="language-bash">initdb <span class="token parameter variable">-D</span> /usr/local/pgsql/data</code></pre><p>To start the database server, enter</p><pre class="language-bash"><code class="language-bash">pg_ctl <span class="token parameter variable">-D</span> /usr/local/pgsql/data <span class="token parameter variable">-l</span> logfile start</code></pre><p>To stop the database server, enter</p><pre class="language-bash"><code class="language-bash">pg_ctl <span class="token parameter variable">-D</span> /usr/local/pgsql/data stop <span class="token parameter variable">-m</span> fast</code></pre><p>To create a database, enter <code>createdb {db-name}</code>.</p><p>To delete a database, enter <code>dropdb {db-name}</code>.</p><p>To list the existing databases, enter <code>psql -l</code>.</p><p>To enter interactive mode for a given database, enter art for a given database <code>psql -d {db-name}</code>.</p><p>In interactive mode:</p><ul><li><p>To list all the current roles (users), enter <code>select * from pg_roles;</code></p></li><li><p>To list all the tables in the current database, enter <code>\d</code>.</p></li><li><p>To create a table within a database, enter</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> {<span class="token keyword">table</span><span class="token operator">-</span>name} <span class="token punctuation">(</span>{col<span class="token operator">-</span>name} {col<span class="token operator">-</span><span class="token keyword">type</span>}<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>For example:</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> dog <span class="token punctuation">(</span>id bigserial <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span> name <span class="token keyword">text</span><span class="token punctuation">,</span> breed <span class="token keyword">text</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>To add a row to a table, enter an <code>insert</code> command like <code>insert into dogs (name, breed) values ('Comet', 'whippet');</code></p></li><li><p>To execute a query, enter a command like:</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> \<span class="token operator">*</span> <span class="token keyword">from</span> pets <span class="token keyword">where</span> breed <span class="token operator">=</span> <span class="token string">'whippet'</span><span class="token punctuation">;</span></code></pre><p>Don't forget the semicolon at the end.</p></li><li><p>To quit interactive mode, enter <code>\q</code>.</p></li></ul><p>To execute a single SQL statement, enter <code>psql -d {db-name} -c '{stmt}'</code> For example, <code>psql -d pets -c 'select \* from dogs'</code></p><p>To execute SQL statements in a file, enter <code>psql -d {db-name} -f {file-path}</code></p><h2 id="pgadmin" tabindex="-1">pgAdmin</h2><p>pgAdmin is a popular GUI tool for working with PostgreSQL databases. It can be found at <a href="https://www.pgadmin.org/">https://www.pgadmin.org/</a>. For macOS on Apple Silico (AMD), I downloaded the installer <code>pgadmin4-8.12-arm64.dmg</code> and double-clicked it to install.</p><h2 id="supported-column-types" tabindex="-1">Supported Column Types</h2><ul><li>boolean or bool</li><li>char(n)</li><li>varchar(n)</li><li>text</li><li>smallint</li><li>int</li><li>serial (integer with autoincrement)</li><li>bigserial (longer integer with autoincrement)</li><li>float(n)</li><li>real or float8</li><li>numeric or numeric(p, s) where p is the total number of digits and s is the number after the decimal point</li><li>date</li><li>time</li><li>timestamp</li><li>timestamptz - a timezone-aware timestamp</li><li>interval - a period of time</li><li>array (ex. an array of int values is int[])</li><li>json (text)</li><li>jsonb (binary)</li><li>uuid</li><li>for geometric data: box, line, point, lseg, polygon</li><li>inet</li><li>macaddr</li></ul><h2 id="unorganized-content" tabindex="-1">Unorganized Content</h2><p>To create a user/role</p><ul><li>createuser<ul><li>will prompt for name of role to add and whether the role should be a superuser</li></ul></li></ul><p>To change the password of a user</p><ul><li>psql -Upostgres -dtemplate1</li><li>alter user {username} with password '{new-password}';</li><li>\q</li></ul><p>To make the &quot;postgres&quot; user able to create tables</p><ul><li>psql -d some-database</li><li>\password postgres</li><li>Enter new password like &quot;postgres&quot;.</li><li>alter role postgres with superuser;</li><li>alter role postgres with createdb;</li><li>ctrl-d</li></ul><p>To start interactive mode</p><ul><li>psql -U{username} {database-name}<ul><li>username can be &quot;postgres&quot;</li></ul></li></ul><p>To delete a database</p><ul><li>dropdb -U{username} {db-name}</li></ul><p>To use a database in interactive mode</p><ul><li>psql -U{username} {db-name}<ul><li>for example, XAdemo</li></ul></li></ul><p>To list all the public (non-system) tables</p><ul><li>select * from pg_tables where schemaname='public';</li></ul><p>More on interactive mode</p><ul><li>prompt<ul><li>begins with the database name</li><li>ends in =# if you are the database superuser, otherwise ends in =&gt;</li></ul></li><li>see schemas that will be searched - show search_path;</li><li>change schemas that will be searched - set search_path to {comma-separated-schema-list}<ul><li>for example, set search_path=sal;</li></ul></li><li>help - ? or \h{command}</li><li>include - \i{file}<ul><li>reads SQL from the given file</li></ul></li><li>list all databases - \l</li><li>list public tables - \d or \z</li><li>list system tables - \dS<ul><li>for example, the system table pg_tables</li></ul></li><li>list columns in a table - \d {table-name}</li><li>version<ul><li>to see version of PostgreSQL, enter &quot;select version();&quot;</li></ul></li><li>exit - \q</li><li>see <a href="http://www.postgresql.org/docs/6.4/static/app-psql.htm">http://www.postgresql.org/docs/6.4/static/app-psql.htm</a> for more</li></ul><p>Auto-incrementing keys</p><ul><li>approach #1 CREATE TABLE foo ( id SERIAL PRIMARY KEY, ... other columns ... )</li><li>approach #2 CREATE SEQUENCE fooSeq; CREATE TABLE foo ( id INTEGER NOT NULL PRIMARY KEY DEFAULT nextval('fooSeq'), ... other columns ... )</li></ul><p>To dump the database to a file:</p><ul><li>from a terminal window<ul><li>pg_dump -Upostgres {dbname} &gt; {outfile}<ul><li>postgres password is postgres</li></ul></li><li>outfile will contain all SQL commands necessary to recreate the database in its current state</li><li>to recreate the database elsewhere<ul><li>use dropdb to delete the previous database (see &quot;To delete a database&quot;)</li><li>use createdb to recreate an empty database (see &quot;To create a database&quot;)</li><li>use psql to run the commands in outfile (see &quot;Run commands in a file&quot;)</li></ul></li></ul></li><li>from pgAdmin III<ul><li>right-click a table name</li><li>select &quot;Backup...&quot;</li><li>press &quot;...&quot; to specify the file where it will be saved</li><li>select &quot;PLAIN&quot;</li><li>select &quot;Only data&quot;</li><li>press &quot;OK&quot;</li><li>press &quot;Done&quot;</li></ul></li></ul></article>