<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Deno</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#differences-from-node.js">Differences from Node.js</a></li><li><a href="#pros">Pros</a></li><li><a href="#cons">Cons</a></li><li><a href="#installing-deno">Installing deno</a></li><li><a href="#options">Options</a></li><li><a href="#conventions">Conventions</a></li><li><a href="#permission-flags">Permission Flags</a></li><li><a href="#example-script">Example Script</a></li><li><a href="#command-summary">Command Summary</a></li><li><a href="#repls">REPLs</a></li><li><a href="#running">Running</a></li><li><a href="#watching">Watching</a></li><li><a href="#vs-code">VS Code</a></li><li><a href="#linting">Linting</a></li><li><a href="#code-formatting">Code Formatting</a></li><li><a href="#getting-information">Getting Information</a></li><li><a href="#generating-documentation">Generating Documentation</a></li><li><a href="#debugging">Debugging</a></li><li><a href="#testing">Testing</a></li><li><a href="#bundling">Bundling</a></li><li><a href="#installing-programs">Installing Programs</a></li><li><a href="#shell-completions">Shell Completions</a></li><li><a href="#libraries">Libraries</a></li><li><a href="#built-ins">Built-ins</a></li><li><a href="#imports">Imports</a></li><li><a href="#import-maps">Import Maps</a></li><li><a href="#lock-files">Lock Files</a></li><li><a href="#standard-library">Standard Library</a></li><li><a href="#third-party-modules">Third Party Modules</a></li><li><a href="#deno.land">deno.land</a></li><li><a href="#using-node-packages">Using Node Packages</a></li><li><a href="#deno-global-variable">Deno Global Variable</a></li><li><a href="#environment-variables">Environment Variables</a></li><li><a href="#parsing-command-line-arguments">Parsing command line arguments</a></li><li><a href="#databases">Databases</a></li><li><a href="#mongodb">MongoDB</a></li><li><a href="#basic-http-server">Basic HTTP server</a></li><li><a href="#rest-server-with-oak">REST Server with oak</a></li><li><a href="#websockets">WebSockets</a></li><li><a href="#tidbits">Tidbits</a></li></ol></nav></aside><article><p><img alt="Deno logo" style="width: 30%" src="/blog/assets/deno-logo.svg" title="Deno logo"></p><h2 id="overview">Overview</h2><p><a href="https://deno.land/" rel="noopener" target="_blank">Deno</a> is a &quot;secure runtime for JavaScript and TypeScript&quot;. The name comes from moving the last two letters of &quot;Node&quot; to the front. Originally it was pronounced &quot;den O&quot;, but was later changed to &quot;D no&quot; like the pet dinosaur in the Flintstones cartoon.</p><p>Ryan Dahl created both <a href="https://nodejs.org/" rel="noopener" target="_blank">Node.js</a> and Deno. In June 2018, he gave a talk at JSConf EU 2018 titled &quot;<a href="https://www.youtube.com/watch?v=M3BM9TB-8yA&vl=en" rel="noopener" target="_blank">10 Things I Regret About Node.js</a>. A prototype of Deno was presented during this talk.</p><p>Version 1.0 of Deno was released on May 13, 2020. It is open source and uses the MIT license.</p><p>The Deno core team, in order of commits, consists of Ryan Dahl (Google), Bartek Iwa≈Ñczuk Bert Belder (StrongLoop), Kitson Kelly (Thoughtworks), and Luca Casonato.</p><p>Deno is secure by default. The environment, file system, and network can only be accessed if explicitly enabled. Compare this to other programming languages/environments like Node.js, Python, and Java where there are no restrictions on what application or library code can do. All of those are insecure by default.</p><p>I believe the Deno security model is its most significant feature! With Deno you never have to worry that some library you are using, or a library used by a library, might do something bad that you didn't want to allow. You can run an app with no permissions and see what errors are generated. For example, suppose you see the following error message:</p><pre class="language-text"><code class="language-text">error: Uncaught PermissionDenied: read access to "pets.db",<br>run again with the --allow-read flag</code></pre><p>You can then decide whether you app should be reading that file before running it again with permission granted. The permission flags are covered in more detail later.</p><p>Deno has builtin support for TypeScript. It automatically compiles TypeScript code to JavaScript before running it, making it unnecessary to define a build process to do this.</p><p>The <code>deno</code> command supports many sub-commands for common tasks including running programs, starting a REPL, linting code, formatting code, displaying code documentation, getting information on dependencies, and bundling code.</p><p>Both Node.js and Deno are built on the Chrome V8 JavaScript engine which is implemented in C++. Node.js is primarily implemented in C++. Deno was originally implemented in Go and later changed to Rust. It is also partially implemented in JavaScript. To learn why Deno internals use JavaScript instead of TypeScript, see this <a href="https://docs.google.com/document/d/1_WvwHl7BXUPmoiSeD8G83JmS8ypsTPqed4Btkqkn_-4/preview" rel="noopener" target="_blank">Design Doc</a>.</p><p>Event handling in Node.js is provided by the <a href="https://libuv.org/" rel="noopener" target="_blank">libuv</a> C++ library. In Deno this is provided by the <a href="https://tokio.rs/" rel="noopener" target="_blank">Tokio</a> Rust library.</p><p>Deno supports WebAssembly (WASM). Many programming languages can be compiled to WASM, including <a href="https://emscripten.org/" rel="noopener" target="_blank">C</a>, C++, C#, Go, Java, Kotlin, <a href="https://github.com/iodide-project/pyodide" rel="noopener" target="_blank">Python</a>, Prolog, Ruby, <a href="https://rustwasm.github.io/" rel="noopener" target="_blank">Rust</a>, Scheme, Swift, and others. The resulting WASM code can then be called from JavaScript or TypeScript code. TODO: Try this with Python!</p><p>To get started with Deno and find documentation, see the <a href="https://deno.land/manual" rel="noopener" target="_blank">Deno Manual</a>. The <a href="https://discord.gg/deno" rel="noopener" target="_blank">Deno Discord channel</a> is another great resource.</p><h2 id="differences-from-node.js">Differences from Node.js</h2><ol><li>Deno uses ES modules by default. Node.js can use ES modules, but defaults to CommonJS.</li><li>Deno uses URLs for loading remote dependencies rather than relative paths in the <code>node_modules</code> directory. These can come from any URL, not just from npm.</li><li>Deno uses built-in resource fetching rather than relying on npm to install packages.</li><li>Deno has built-in TypeScript support with caching of compiled source files.</li><li>Deno has built-in support for Web APIs like the Fetch API and functions from the <code>window</code> object.</li><li>Deno requires file system and network access to be explicitly enabled.</li><li>Deno APIs utilize Promises, ES6, and TypeScript features.</li><li>All asynchronous actions in Deno return a Promise rather than use callbacks.</li><li>Deno provides a large standard library with no external dependencies.</li><li>Deno uses message passing channels to invoke privileged system APIs.</li><li>Deno programs stop when an uncaught error is encountered, such as failing to catch a rejected promise.</li></ol><h2 id="pros">Pros</h2><ul><li>Deno has unique support for building secure applications that are limited in their ability to read/write files and access network resources.</li><li>Deno has built-in support for TypeScript which makes using it easier because it removes the need to install the TypeScript compiler and configure a build process.</li><li>Deno supports modern JavaScript features that are not yet implemented in other JavaScript environments. Examples include the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining" rel="noopener" target="_blank">optional chaining operator</a> (<code>?.</code>), the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing_operator" rel="noopener" target="_blank">nullish coalescing operator</a> (<code>??</code>), and <a href="https://github.com/tc39/proposal-top-level-await" rel="noopener" target="_blank">top-level <code>await</code></a>.</li><li>Deno includes many development tools to support common activities such as linting, code formatting, running tests, and bundling code into a single file. This removes the need to select, install, and configure tools for these.</li></ul><h2 id="cons">Cons</h2><ul><li>The number of libraries that are compatible with Deno is far less that the number of Node.js libraries. Many Node.js libraries cannot be used directly by Deno because that use APIs that Deno cannot make secure.</li><li>Knowledge of existing Node.js libraries often doesn't help when implementing an application in Deno and time must be spent finding and learning how to use an alternate library.</li><li>Deno is currently slower than Node.js for some tasks.</li></ul><h2 id="installing-deno">Installing <code>deno</code></h2><p>Deno is installed as a single executable file. To install it:</p><ul><li>for Windows, use Chocolately: <code>choco install deno</code></li><li>for macOS, use Homebrew: <code>brew install deno</code></li><li>for Linux, use curl: <code>curl -fsSL https://deno.land/x/install/install.sh | sh</code></li></ul><p>For more install options, see the <a href="https://deno.land/" rel="noopener" target="_blank">main Deno website</a>.</p><h2 id="options">Options</h2><p>To get help on <code>deno</code> options, enter <code>deno help</code>, <code>deno --help</code>, or <code>deno -h</code>. This includes the Deno version, the Deno manual URL, third party module URLs, the issue tracker URL, basic command examples, basic options, a brief description of each subcommand, and a description of environment variables that affect Deno.</p><p>To get help on a subcommand such as &quot;run&quot;, enter <code>deno run --help</code>.</p><p>To get the version of <code>deno</code> that is installed, enter <code>deno -V</code>. To also get the versions of V8 and TypeScript that <code>deno</code> uses, enter <code>deno --version</code>.</p><h2 id="conventions">Conventions</h2><p>The <code>.js</code> and <code>.ts</code> files in the standard library use underscores rather than dashes to separate multiple words in file names.</p><h2 id="permission-flags">Permission Flags</h2><p>Deno supports the following permission flags:</p><ul><li><code>-A</code> or <code>--allow-all</code><br>This allow all permissions, disabling all security.</li><li><code>--allow-env</code><br>This allows getting and setting environment variables.</li><li><code>--allow-hrtime</code><br>This allows use of high-resolution time measurement which can be used in timing attacks and fingerprinting. Without this permission, functions that return times such as <code>performance.now</code> return values in milliseconds instead of a more precise value.</li><li><code>--allow-net=&lt;allow-net&gt;</code><br>This allows network access. A comma-separated list of domains can optionally be specified to restrict network access to only those domains. For example, <code>--allow-net=bitbucket.org,github.com,gitlab.com</code>.</li><li><code>--allow-plugin</code><br>This allows plugins implemented as Rust binaries to be loaded. JavaScript code can then invoke plugin code using OPs. For an example, see <a href="https://denolib.gitbook.io/guide/codebase-basics/example-adding-a-deno-api" rel="noopener" target="_blank">here</a>. Keep in mind that plugins are not limited by the normal Deno security restrictions. Plugins are currently an unstable feature.</li><li><code>--allow-read=&lt;allow-read&gt;</code><br>This allows read access to the file system. A comma-separated list of directories or files can optionally be specified to restrict reads to only those directories and files.</li><li><code>--allow-run</code><br>This allow running subprocesses outside of the Deno sandbox, which means they do not have security restrictions.</li><li><code>--allow-write=&lt;allow-write&gt;</code><br>This allows write access to the file system. A comma-separated list of directories or files can optionally be specified to restrict writes to only those directories and files.</li></ul><p>What other programming language / runtime can make the security guarantees that Deno makes? I don't know of any.</p><p>A Deno program can check for permission flags and take different actions based on whether specific flags and values are present. For example:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> status <span class="token operator">=</span> <span class="token keyword">await</span> Deno<span class="token punctuation">.</span>permissions<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'write'</span><span class="token punctuation">,</span> path<span class="token operator">:</span> <span class="token string">'/tmp'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">if</span> <span class="token punctuation">(</span>status<span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">'granted'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Permission was granted on the command line.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> status <span class="token operator">=</span> <span class="token keyword">await</span> Deno<span class="token punctuation">.</span>permissions<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'write'</span><span class="token punctuation">,</span> path<span class="token operator">:</span> <span class="token string">'/tmp'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>status<span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">'granted'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Permission was granted interactively.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Permission was denied interactively.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>The permissions API is currently experimental, so this must be run with the <code>--unstable</code> flag.</p><p>If the program is not also run with <code>--allow-write=/tmp</code>, the user will be prompted with the following and the program will wait for the user to press the &quot;g&quot; or &quot;d&quot; key:</p><pre class="language-text"><code class="language-text">‚ö†Ô∏è Deno requests write access to "/tmp". Grant? [g/d (g = grant, d = deny)]</code></pre><p>The <code>Deno.permissions.revoke</code> function removes a permission. This is useful when actions that require the permission have completed and you wish to ensure that those actions cannot be performed again for the remainder of the program.</p><h2 id="example-script">Example Script</h2><p>Here's an example Deno script to whet your appetite. It prompts for a U.S. ZIP code and uses the <a href="https://openweathermap.org/api" rel="noopener" target="_blank">OpenWeather API</a> to get the city name, current temperature, and current wind speed. It was inspired by a <a href="https://www.youtube.com/watch?v=3MapKMsioTo" rel="noopener" target="_blank">talk</a> given by Luca Casonato at an ING Tech Meetup on November 5, 2020.</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>bold<span class="token punctuation">,</span> cyan<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://deno.land/std@0.79.0/fmt/colors.ts'</span><span class="token punctuation">;</span><br><br><span class="token keyword">function</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token parameter">label<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span><br>  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">bold</span><span class="token punctuation">(</span><span class="token function">cyan</span><span class="token punctuation">(</span>label <span class="token operator">+</span> <span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">try</span> <span class="token punctuation">{</span><br>  <span class="token comment">// Web browsers implement the "prompt" function</span><br>  <span class="token comment">// to prompt a user for input using a modal dialog.</span><br>  <span class="token comment">// Deno implements this to prompt in a terminal.</span><br>  <span class="token keyword">const</span> zipCode <span class="token operator">=</span> <span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">'U.S. ZIP code:'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>zipCode<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'A ZIP code must be entered.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    Deno<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// exits program with a status code</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">// Deno supports top level await.</span><br>  <span class="token keyword">const</span> secrets <span class="token operator">=</span> <span class="token keyword">await</span> Deno<span class="token punctuation">.</span><span class="token function">readTextFile</span><span class="token punctuation">(</span><span class="token string">'secrets.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span><span class="token constant">API_KEY</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>secrets<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> url <span class="token operator">=</span><br>    <span class="token string">'https://api.openweathermap.org/data/2.5/weather'</span> <span class="token operator">+</span><br>    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">?zip=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>zipCode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;units=imperial&amp;appid=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">API_KEY</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> json <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// This API includes JSON error messages in the response body.</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'\nCity'</span><span class="token punctuation">,</span> json<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'Temperature'</span><span class="token punctuation">,</span> json<span class="token punctuation">.</span>main<span class="token punctuation">.</span>temp <span class="token operator">+</span> <span class="token string">'¬∞F'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'Wind speed'</span><span class="token punctuation">,</span> json<span class="token punctuation">.</span>wind<span class="token punctuation">.</span>speed <span class="token operator">+</span> <span class="token string">' mph'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// console methods accept a subset of CSS styling.</span><br>  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'%c'</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>message<span class="token punctuation">,</span> <span class="token string">'color: red'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>To check the code for issues, enter <code>deno lint</code>.</p><p>To format the code, enter <code>deno fmt</code>.</p><p>Assuming Deno is installed and you have the file <code>secrets.json</code> that contains your OpenWeather API key, the following command runs the script. Note the permission flags that are required. They only allow reading from a specific file and sending network requests to a specific domain.</p><pre class="language-bash"><code class="language-bash">deno run --allow-read<span class="token operator">=</span>secrets.json --allow-net<span class="token operator">=</span>api.openweathermap.org weather.ts</code></pre><p>Here is a sample session, minus the colors:</p><pre class="language-text"><code class="language-text">U.S. ZIP code: 12345<br><br>City: Schenectady<br>Temperature: 40.64¬∞F<br>Wind speed: 11.41 mph</code></pre><p>Repeatedly typing that long command to run this would be tedious. We could write a shell script to run it, but Deno can do that for us. Just recall the command, change the &quot;run&quot; subcommand to &quot;install&quot;, and execute it. This writes a shell script to <code>$HOME/.deno/bin</code> with the same name as your source file. It will contain the <code>deno run</code> command with all its options. To give the script a different name, specify the name using the <code>--name</code> (or <code>-n</code>) flag. As long as that &quot;bin&quot; directory is in your <code>PATH</code>, it can now be executed by just entering the script name.</p><h2 id="command-summary">Command Summary</h2><p>Deno commands start with <code>deno</code> followed by a command name and options. Here's a summary of the commands. Details will be provided later.</p><table><thead><tr><th>Command</th><th>Description</th></tr></thead><tbody><tr><td><code>bundle</code></td><td>bundles a module and its dependencies into a single file</td></tr><tr><td><code>cache</code></td><td>caches dependencies</td></tr><tr><td><code>completions</code></td><td>generates shell completions</td></tr><tr><td><code>doc</code></td><td>displays documentation for a given module</td></tr><tr><td><code>eval</code></td><td>evaluates a string of JS/TS code</td></tr><tr><td><code>fmt</code></td><td>formats source files</td></tr><tr><td><code>help</code></td><td>displays help on <code>deno</code> commands and environment variables</td></tr><tr><td><code>info</code></td><td>displays information about the cache or source files, including dependencies</td></tr><tr><td><code>install</code></td><td>installs a script as an executable</td></tr><tr><td><code>lint</code></td><td>identifies issues in source files</td></tr><tr><td><code>repl</code></td><td>starts a Read Eval Print Loop</td></tr><tr><td><code>run</code></td><td>runs a script from a file or URL</td></tr><tr><td><code>test</code></td><td>runs tests</td></tr><tr><td><code>types</code></td><td>displays information about built-in types; can use in your code</td></tr><tr><td><code>upgrade</code></td><td>upgrades <code>deno</code></td></tr></tbody></table><p>Some commands and flags are considered experimental and may change in the future. It in order to use those, the <code>--unstable</code> flag must be included until they become stable.</p><p>For an example of using the <code>install</code> command, see the &quot;Watching&quot; section.</p><h2 id="repls">REPLs</h2><p>A Read Eval Print Loop (REPL) tool is great for learning about the features of a programming language or runtime. The command <code>deno repl</code> or just <code>deno</code> starts a terminal-based REPL. It supports tab completion and syntax highlighting.</p><p>There are also web-based REPLs. One is <a href="https://deno-playground.now.sh/" rel="noopener" target="_blank">Deno Playground</a>. This supports code formatting and sharing code with others. Another less attractive option is <a href="https://deno.town/" rel="noopener" target="_blank">deno.town</a>, which doesn't support code formatting or sharing code.</p><h2 id="running">Running</h2><p>To run a Deno program, enter a command like the following, passing it a JavaScript or TypeScript file:</p><pre class="language-bash"><code class="language-bash">deno run src/main.ts</code></pre><p>Deno also supports running a script at a URL. For example, the following outputs a welcome message including a dinosaur unicode character:</p><pre class="language-bash"><code class="language-bash">deno run https://deno.land/std/examples/welcome.ts</code></pre><p>The following command runs a simple HTTP file server that serves all files in and below the current directory on port 1234.</p><pre class="language-bash"><code class="language-bash">deno run --allow-net --allow-read <span class="token punctuation">\</span><br>  https://deno.land/std/http/file_server.ts --port <span class="token number">1234</span></code></pre><p>Browsing localhost:1234 serves the file <code>index.html</code> in the current directory.</p><p>To get help on command line options for <code>file_server.ts</code>, enter the following:</p><pre class="language-bash"><code class="language-bash">deno run --allow-net --allow-read https://deno.land/std/http/file_server.ts --help</code></pre><h2 id="watching">Watching</h2><p>To run in watch mode so the script is restarted when any source file (<code>.js</code>, <code>.json</code>, or <code>.ts</code>) in and below the current directory changes, add the currently unstable <code>--watch</code> option. For example:</p><pre class="language-bash"><code class="language-bash">deno run --allow-net --unstable --watch my_server.ts</code></pre><p>When a file change is detected, the program is restarted, but no output is generated to indicate that this happened.</p><p>Another more full-featured option for watching files that is similar to <a href="https://nodemon.io/" rel="noopener" target="_blank">nodemon</a> is <a href="https://github.com/denosaurs/denon" rel="noopener" target="_blank">denon</a>.</p><p>To install denon:</p><ul><li>enter <code>deno install -Af --unstable https://deno.land/x/denon/denon.ts</code></li><li>add <code>$HOME/.deno/bin</code> to your <code>PATH</code> environment variable</li></ul><p>Use the <code>denon</code> command in place of the <code>deno</code> command with the same options and arguments. For example:</p><pre class="language-bash"><code class="language-bash">denon run --allow-net my_server.ts</code></pre><h2 id="vs-code">VS Code</h2><p>The &quot;Deno&quot; VS Code extension provides:</p><ul><li>intellisense</li><li>ES module imports</li><li>import URL completion</li><li>import maps</li><li>diagnostics with quick fixes</li><li>optional use of <code>deno fmt</code> for code formatting</li><li>TypeScript type definitions</li></ul><p>Install and configure this extension.</p><p>Most likely you will want this extension to only run on <code>.js</code> and <code>.ts</code> files that contain Deno code. Rather than configure this extension with global settings, create a <code>.vscode</code> directory at the top of each Deno project directory. Then create the file <code>settings.json</code> inside it with the following content:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"deno.enable"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>  <span class="token property">"deno.import_intellisense_origins"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"https://deno.land"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>    <span class="token property">"https://deno.land/x"</span><span class="token operator">:</span> <span class="token boolean">true</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token property">"deno.lint"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>  <span class="token property">"deno.unstable"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>  <span class="token property">"[javascript]"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"editor.defaultFormatter"</span><span class="token operator">:</span> <span class="token string">"denoland.vscode-deno"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token property">"[typescript]"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"editor.defaultFormatter"</span><span class="token operator">:</span> <span class="token string">"denoland.vscode-deno"</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>Enabling <code>deno.unstable</code> is required to use <code>deno lint</code>.</p><p>This should use <code>deno fmt</code> to format <code>.js</code> and <code>.ts</code> files in the project, but this is not working for me. See this <a href="https://github.com/denoland/vscode_deno/issues/267" rel="noopener" target="_blank">issue</a>.</p><h2 id="linting">Linting</h2><p>To lint all <code>.js</code> and <code>.ts</code> files in and below the current directory, enter <code>deno lint --unstable</code>.</p><p>To see a list of the rules checked by <code>deno lint</code>, enter <code>deno lint --rules --unstable</code>. This includes all of the rules in the <a href="https://eslint.org/docs/rules/" rel="noopener" target="_blank">eslint:recommended</a> set and many of the rules in the <a href="https://www.npmjs.com/package/@typescript-eslint/eslint-plugin#supported-rules" rel="noopener" target="_blank">plugin:@typescript-eslint/recommended</a> set. See this <a href="https://github.com/denoland/deno_lint/issues/556" rel="noopener" target="_blank">issue</a>.</p><p>To prevent the linter from running on a file, add the following comment at the top:</p><pre class="language-js"><code class="language-js"><span class="token comment">// deno-lint-ignore-file</span></code></pre><p>To prevent the linter from checking specific rules on a file, add the following comment at the top:</p><pre class="language-js"><code class="language-js"><span class="token comment">// deno-lint-ignore-file rule1 rule2 rule3</span></code></pre><p>To prevent the linter from checking specific rules on a specific line, add the following comment before the line:</p><pre class="language-js"><code class="language-js"><span class="token comment">// deno-lint-ignore rule1 rule2 rule3</span></code></pre><h2 id="code-formatting">Code Formatting</h2><p>To format all <code>.js</code>, <code>.json</code>, and <code>.ts</code> files in and below the current directory, enter <code>deno fmt</code>. This uses <a href="https://github.com/dprint/dprint" rel="noopener" target="_blank">dprint</a> (implemented in Rust) rather than Prettier. The primary reason for this choice is that dprint is significantly faster.</p><p>Some noticeable changes dprint makes include:</p><ul><li>adds semicolons where missing</li><li>changes single quotes to double</li><li>adds trailing commas after last items when they do not all fit on a single line (applies to imports, function parameters, function arguments, array literals, and object literals)</li></ul><p>While dprint is configurable, the <code>deno fmt</code> command currently ignores dprint configuration files.</p><p>To prevent formatting a statement, precede it with the comment <code>// deno-fmt-ignore</code>. To prevent formatting an entire file, add the comment <code>// deno-fmt-ignore-file</code> at the top.</p><p>There is discussion about making the formatting configurable, but it seems to not currently be configurable.</p><p>If the formatting performed by <code>deno fmt</code> is not to your liking, Prettier can be used instead.</p><h2 id="getting-information">Getting Information</h2><p>To get the locations of cache directories used by Deno, enter <code>deno info</code>. This provides the cache directory, the subdirectory where remote modules are cached, and the subdirectory where the output of the TypeScript compiler is stored.</p><p>To install a remote module and see a list of its dependencies, enter <code>deno info {module-url}</code>.</p><h2 id="generating-documentation">Generating Documentation</h2><p>The <code>deno doc</code> command writes documentation for builtin types and local source files to stdout.</p><p>For example, to see documentation on the <code>Deno.read</code> function, enter <code>deno doc --builtin Deno.read</code>. To see documentation for the local source file <code>demo.ts</code>, enter <code>deno doc demo.ts</code>.</p><p>When run on source files, it only generates documentation on things that are exported, such as variables, functions, classes, and types. It takes a very simple approach. For variables, including constants, only their name is output. For functions, their signature is output. For classes, their constructor signature, fields, and method signatures are output. Each of these are followed by the text of the <code>/** comment */</code> that precedes it. It does not perform any special parsing or formatting of <a href="https://jsdoc.app/" rel="noopener" target="_blank">JSDoc</a> comments and it does not generate HTML files.</p><h2 id="debugging">Debugging</h2><p>Deno programs can be debugged using the Chrome DevTools Debugger. It supports source maps which enables stepping through TypeScript code while actually running JavaScript code produced by the compiler. The steps to use the debugger are:</p><ol><li>Start the script by entering <code>deno run -A --inspect-brk some_name.ts</code></li><li>Browse <code>chrome://inspect</code></li><li>Click the &quot;inspect&quot; link at the bottom of the Chrome window to open another Chrome window.</li><li>Typically the source file of a dependency rather than the main script will be displayed. Click the table for the main script to view its source code. If there is no tab for it, use the file explorer on the left to navigate to it under &quot;file://&quot;.</li><li>Click line numbers to toggle breakpoints.</li><li>Click the buttons in the upper-right to resume execution (play triangle), step over (curved arrow over dot), step in (down arrow), step out (up arrow), step (right arrow), deactivate all breakpoints (slash through breakpoint symbol), and toggle pausing on exceptions (stop sign with equal sign).</li><li>Examine local and global variables under the &quot;Scope&quot; section on the right.</li><li>Create watches under the &quot;Watch&quot; section on the right.</li><li>Examine the call stack under the &quot;Call Stack&quot; section on the right.</li><li>To restart execution, click the &quot;reload&quot; link back in the original Chrome window.</li></ol><p><img alt="Chrome debugger window #1" style="width: 40%" src="/blog/assets/deno-chrome-debugger-1.png" title="Chrome debugger window #1"> <img alt="Chrome debugger window #2" style="width: 90%" src="/blog/assets/deno-chrome-debugger-2.png" title="Chrome debugger window #2"></p><p>VS Code also supports debugging Deno programs. The steps to do this are:</p><ol><li><p>Create a <code>.vscode</code> directory in the top project directory.</p></li><li><p>Create the file <code>.vscode/launch.json</code> with the following content:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.2.0"</span><span class="token punctuation">,</span><br>  <span class="token property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Deno"</span><span class="token punctuation">,</span><br>      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"pwa-node"</span><span class="token punctuation">,</span><br>      <span class="token property">"request"</span><span class="token operator">:</span> <span class="token string">"launch"</span><span class="token punctuation">,</span><br>      <span class="token property">"cwd"</span><span class="token operator">:</span> <span class="token string">"${workspaceFolder}"</span><span class="token punctuation">,</span><br>      <span class="token property">"runtimeExecutable"</span><span class="token operator">:</span> <span class="token string">"deno"</span><span class="token punctuation">,</span><br>      <span class="token property">"runtimeArgs"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"run"</span><span class="token punctuation">,</span> <span class="token string">"-A"</span><span class="token punctuation">,</span> <span class="token string">"--inspect-brk"</span><span class="token punctuation">,</span> <span class="token string">"${file}"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token property">"attachSimplePort"</span><span class="token operator">:</span> <span class="token number">9229</span><span class="token punctuation">,</span><br>      <span class="token property">"outputCapture"</span><span class="token operator">:</span> <span class="token string">"std"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Open the main script file in VS Code.</p></li><li><p>Select Run ... Start Debugging or press F5.</p></li><li><p>If prompted to select an environment, select &quot;Deno&quot;.</p></li><li><p>Use the debugger control buttons at the top.</p></li><li><p>Use the left-nav debugger content including the sections labelled &quot;VARIABLES&quot;, &quot;WATCH&quot;, &quot;CALL STACK&quot;, &quot;LOADED SCRIPTS&quot;, and &quot;BREAKPOINTS&quot;.</p></li><li><p>To exit from the debugger, click the red square in the debug controls, select Run ... Stop Debugging, or press shift-F5.</p></li></ol><p><img alt="VS Code debugger" style="width: 90%" src="/blog/assets/deno-vs-code-debugger.png" title="VS Code debugger"></p><p>Currently it reports the following error when importing modules from URLs:</p><pre class="language-text"><code class="language-text">Could not load source '{file-system-path/some-name.ts}': Unable to retrieve source content.</code></pre><p>See this <a href="https://github.com/denoland/vscode_deno/issues/233" rel="noopener" target="_blank">issue</a>.</p><h2 id="testing">Testing</h2><p>Deno has built-in support for unit tests, documented <a href="https://deno.land/manual/testing" rel="noopener" target="_blank">here</a>.</p><p>Here is a simple module defined in <code>statistics.ts</code>:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">average</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>numbers<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span>length<span class="token punctuation">}</span> <span class="token operator">=</span> numbers<span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token operator">...</span>numbers<span class="token punctuation">)</span> <span class="token operator">/</span> length<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>numbers<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> numbers<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token operator">=></span> acc <span class="token operator">+</span> n<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>Here is a file that provides tests for the <code>average</code> function.</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>assertEquals<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://deno.land/std/testing/asserts.ts'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>average<span class="token punctuation">,</span> sum<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./statistics.ts'</span><span class="token punctuation">;</span><br><br>Deno<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'average'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token function">average</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token function">average</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token function">average</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token function">average</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>Deno<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>To run all the tests in the current directory, enter <code>deno test</code>.</p><p>The assertion functions provided by the <code>testing/assert.ts</code> module include:</p><ul><li><code>assert</code> checks for truthy value</li><li><code>assertEquals</code> and <code>assertNotEquals</code> check for deep equality</li><li><code>assertExists</code> checks for not <code>null</code> or <code>undefined</code></li><li><code>assertMatch</code> and <code>assertNotMatch</code></li><li><code>assertObjectMatch</code> checks for object being a subset of another deeply</li><li><code>assertStrictEquals</code> and <code>assertNotStrictEquals</code> checks for same reference</li><li><code>assertArrayIncludes</code> and <code>assertStringIncludes</code></li><li><code>assertThrows</code> and <code>assertThrowsAsync</code></li><li><code>fail</code></li><li><code>unreachable</code></li></ul><p>Adding <code>.only</code> or <code>.skip</code> after <code>Deno.test</code> is not supported, but there is <a href="https://github.com/denoland/deno/issues/5197" rel="noopener" target="_blank">discussion</a> about adding them.</p><p>In addition, test code can import and throw <code>AssertionError</code>.</p><p>The <code>equal</code> function checks for deep equality and returns a boolean rather than throwing.</p><p>To run the tests and report test coverage, enter <code>deno test --coverage --unstable</code>. This outputs any uncovered source lines.</p><h2 id="bundling">Bundling</h2><p>The <code>deno bundle</code> command bundles all the dependencies of a program into a single file. It takes a <code>.js</code> or <code>.ts</code> file as input and produces a <code>.js</code> file. To bundle the program <code>demo.js</code> into <code>demob.js</code>, enter <code>deno bundle demo.js demob.js</code>. To run the bundled version, enter <code>deno run demob.js</code>. See this <a href="https://github.com/denoland/deno/issues/8211" rel="noopener" target="_blank">issue</a>.</p><p>Some bundles can be run in web browsers. However, this command does not modify the use of top level <code>await</code>, so code that uses that feature will only run in browsers that support it.</p><h2 id="installing-programs">Installing Programs</h2><p>The <code>deno install</code> command creates an executable shell script that runs a given Deno program. Any required permission options must be included in this command. By default the script is placed in <code>$HOME/.deno/bin</code> and has the same name as the input source file with no file extension. To change the name of the executable created, specify the name with the <code>--name</code> or <code>-n</code> option. To change the location of the executable, specify it with the <code>--root</code> option or set the environment variable <code>DENO_INSTALL_ROOT</code>.</p><p>The generated script uses the <code>deno run</code> command to execute the program just as you would when running it yourself.</p><p>Bundling and installing a Deno application is not a good solution for distributed apps to users. In order for users to run the app they would need to:</p><ul><li>get the <code>.js</code> file created by the <code>bundle</code> command</li><li>get the script created by the <code>install</code> command</li><li>modify the script to refer to the file path of the copied <code>.js</code> file</li><li>install Deno</li><li>run the script using the same shell that was specified in the <code>install</code> command</li></ul><p>A better solution using <code>deno compile</code> is coming soon.</p><h2 id="shell-completions">Shell Completions</h2><p>The <code>deno completions</code> command generates shell-specific commands that define completions for <code>deno</code> subcommands and their options. The supported shells are zsh, bash, fish, powershell, and elvish.</p><p>For example, to generate completions for the bash shell enter the following command:</p><pre class="language-bash"><code class="language-bash">deno completions <span class="token function">bash</span> <span class="token operator">></span> /usr/local/etc/bash_completion.d/deno.bash</code></pre><p>To cause these completions to be activated in every new bash shell session, add the following in <code>~/.bash_profile</code>:</p><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">source</span> /usr/local/etc/bash_completion.d/deno.bash</code></pre><p>After starting a new bash shell, type <code>deno</code> following by a space and press the tab key twice to see all the possible completions. They will include flags like <code>--help</code> and <code>--version</code>. They will also include commands like <code>fmt</code>, <code>install</code>, <code>lint</code>, <code>run</code>, and <code>test</code>. After completing the command to <code>deno run</code> followed by a space, press tab twice to see all the possible flags including <code>--allow-net</code>, <code>--allow-read</code>, <code>--allow-write</code>, <code>--inspect-brk</code>, <code>--unstable</code>, and <code>--watch</code>.</p><p>To generate completions for the fish shell and enable their use enter the following command:</p><pre class="language-bash"><code class="language-bash">deno completions fish <span class="token operator">></span> <span class="token environment constant">$HOME</span>/.config/fish/completions/deno.fish</code></pre><p>No additional steps are needed in order for the completions to be activated in every new fish shell session. After starting a new fish shell, type <code>deno</code> followed by a space and press the tab key once to see all the possible completions. Use the down and up arrow keys to select a completion and continue typing. To see the allowed flags for a command, type one <code>-</code> and press tab. Once again, use the down and up arrow keys to select one.</p><h2 id="libraries">Libraries</h2><p>Deno library code comes from three categories. The &quot;Runtime API&quot; defines built-in things that are available without importing. The &quot;Standard Library&quot; defines things that are maintained by the Deno team. &quot;Third Party Modules&quot; are maintained by other developers. The main Deno website at <a href="https://deno.land/" rel="noopener" target="_blank">deno.land</a> has links to documentation for all three categories at the top of the page.</p><h2 id="built-ins">Built-ins</h2><p>For documentation on the built-in functions, see the <a href="https://doc.deno.land/builtin/stable" rel="noopener" target="_blank">Runtime API</a>.</p><p>These include the following from the Web API:</p><ul><li><p>variables</p><ul><li><p><code>console</code>: an object with the same methods as in browsers including <code>debug</code>, <code>dir</code>, <code>error</code>, <code>info</code>, <code>log</code>, <code>table</code>, and <code>warn</code></p><p><code>console.table(object)</code> draws table border lines in the terminal.</p><p>The other methods can style their output using the following CSS properties:</p><ul><li><code>color</code> with any CSS color value like a name or hex value preceded by <code>#</code></li><li><code>background-color</code> with a color value</li><li><code>font-style</code> with values like <code>normal</code> and <code>italic</code></li><li><code>font-weight</code> with values like <code>normal</code> and <code>bold</code></li><li><code>text-decoration-color</code> with a color value (not widely supported by terminals)</li><li><code>text-decoration-line</code> with values like <code>none</code>, <code>underline</code>, and <code>line-through</code></li></ul><p>To use CSS properties, pass two or more strings to the method. The first string contains the text to output and <code>%c</code> at each location where the styling should change. Supply one CSS string for each occurrence of <code>%c</code> in the first string.</p><p>For example:</p><pre class="language-js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><br>  <span class="token string">'%cHello, %cWorld!'</span><span class="token punctuation">,</span><br>  <span class="token string">'color: red; background-color: yellow; font-style: italic'</span><span class="token punctuation">,</span><br>  <span class="token string">'color: blue; font-weight: bold'</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p><code>window</code> - global object like in web browsers</p><p>The properties of this object include:</p><ul><li>global variables <code>console</code> and <code>Deno</code></li><li>global constructor functions for various events</li><li>all the global functions listed below</li><li>all the global classes listed below</li></ul></li></ul></li><li><p>functions</p><ul><li><p><code>fetch</code> for sending HTTP requests</p></li><li><p><code>alert</code>, <code>confirm</code>, and <code>prompt</code></p><p>These write to stdout and read from stdin. All of them pause execution and wait for the user to reply. <code>alert</code> and <code>prompt</code> wait for the enter/return key. <code>confirm</code> waits for the &quot;y&quot; or &quot;n&quot; key.</p></li><li><p><code>setTimeout</code> and <code>clearTimeout</code></p></li><li><p><code>setInterval</code> and <code>clearInterval</code></p></li><li><p><code>addEventListener</code>, <code>removeEventListener</code>, and <code>dispatchEvent</code></p></li><li><p><code>atob</code> and <code>btoa</code> for converting to and from Base64 encoding</p></li></ul></li><li><p>classes</p><ul><li><code>Event</code></li><li><code>EventTarget</code></li><li><code>File</code></li><li><code>FormData</code></li><li><code>Headers</code></li><li><code>Request</code></li><li><code>Response</code></li><li><code>URL</code></li><li><code>URLSearchParams</code></li><li><code>WebSocket</code></li><li><code>Window</code></li><li><code>Worker</code></li></ul></li></ul><p>To capture performance data for a section of code, begin the section with <code>performance.mark('some-name');</code> and end the section with <code>performance.measure('some-name');</code>.</p><p>Here is an example of dispatching and listening for custom events:</p><pre class="language-ts"><code class="language-ts"><span class="token comment">// ProgressEvent extends EventTarget, not Event.</span><br><span class="token comment">// But the first parameter of an EventListener is supposed to be an Event.</span><br><span class="token comment">// @ts-ignore</span><br><span class="token keyword">const</span> listener <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token operator">:</span> ProgressEvent<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token parameter"><span class="token keyword">void</span></span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token comment">// Report on the progress.</span><br>  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'loaded ='</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>loaded<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>loaded <span class="token operator">>=</span> event<span class="token punctuation">.</span>total<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'myCustomEvent'</span><span class="token punctuation">,</span> listener<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">clearInterval</span><span class="token punctuation">(</span>intervalId<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'myCustomEvent'</span><span class="token punctuation">,</span> listener<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">let</span> loaded <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> intervalId <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token comment">// Do some work.</span><br>  loaded <span class="token operator">+=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// report that 10% of the work is done</span><br>  <span class="token keyword">const</span> event <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProgressEvent</span><span class="token punctuation">(</span><span class="token string">'myCustomEvent'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>    lengthComputable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>    loaded<span class="token punctuation">,</span><br>    total<span class="token operator">:</span> <span class="token number">100</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">dispatchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="imports">Imports</h2><p>Deno source files import other files as ES modules using the <code>import</code> statement, not the <code>require</code> function like in Node.js. The file to import can be specified with a relative file path, an absolute file path, or a URL. In all cases a file, not just a directory, must be specified. Unlike in Node.js, the filename <code>index.js</code> is not treated as the default filename and a file extension must be included. When a <code>.ts</code> file is imported, it is automatically compiled to JavaScript.</p><p>Potential issues with importing modules from URLs include the ability to:</p><ul><li>run code without a connection to the internet</li><li>run code if the owner of a remote module removes or breaks it</li><li>be confident the code won't do something malicious</li></ul><p>Deno addresses all of these concerns. The first two are covered by the fact that Deno caches remote modules when they are initially downloaded. Subsequent runs of your code use cached copies of the remote modules. New versions must be explicitly requested with the <code>--reload</code> option. The last concern is addressed by the Deno security model. No code can read/write files, access network resources, access environment variables, or run subprocesses unless given permission using the <code>--allow-*</code> flags.</p><p>A version can optionally be specified in <code>import</code> URLs. For example:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>blue<span class="token punctuation">,</span> green<span class="token punctuation">,</span> red<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://deno.land/std@0.79.0/fmt/colors.ts'</span><span class="token punctuation">;</span></code></pre><p>When a URL with no version is imported, the newest version is used. But after the import is executed, the program will continue to use that version, not checking for new versions, unless it is run with the <code>--reload</code> flag.</p><p>File URLs for libraries maintained in GitHub contain tag names, so creating tags that are version numbers is great way to make multiple versions compatible with Deno imports. To see the URL to use, select a file, select a tag, click the &quot;Raw&quot; button, and note the URL in the address bar.</p><p>Deno does not use <code>npm</code> to install modules. Instead, <code>import</code> statements can specify module URLs that reference network resources such as those in GitHub.</p><p>Imported files are cached by saving them in the directory specified in the <code>DENO_DIR</code> environment variable rather than in a <code>node_modules</code> directory. The directory is shared between all Deno projects rather and using a separate directory for each project as is done in Node.js. This saves disk space and avoids needing to re-download and re-compile previously used libraries for new projects.</p><p>If the <code>DENO_DIR</code> environment variable is not set, the files are saved in an OS-specific location.</p><ul><li>Windows: <code>%LOCALAPPDATA%/deno</code></li><li>macOS: <code>\$HOME/Library/Caches/deno</code></li><li>Linux: <code>\$XDG_CACHE_HOME/deno</code> or <code>\$HOME/.cache/deno</code></li></ul><p>Downloaded dependencies are placed in the <code>deps</code> subdirectory. JavaScript files created by compiling TypeScript files are placed in the <code>gen</code> subdirectory. The <code>gen</code> directory contains a <code>file</code> directory for <code>.js</code> files generated from <code>.ts</code> files in the file system and a <code>https</code> directory for <code>.js</code> files generated from downloaded <code>.ts</code> files.</p><p>Dependencies are not cataloged in a <code>package.json</code> file, which is not used at all. The many subcommands of the <code>deno</code> command make npm scripts, implemented in a <code>package.json</code> file, less necessary.</p><p>Spreading library URLs throughout the source files of a project can be undesirable, especially of some are repeated in multiple files. An alternate approach is to create a file like <code>src/deps.ts</code> (recommended name) containing lines like the following:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token punctuation">{</span>name1<span class="token punctuation">,</span> name2<span class="token punctuation">,</span> name3<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://domain1/pkg1@v1/filename1.ts'</span><span class="token punctuation">;</span><br><span class="token keyword">export</span> <span class="token punctuation">{</span>name4<span class="token punctuation">,</span> name5<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://domain2/pkg2@v2/filename2.ts'</span><span class="token punctuation">;</span></code></pre><p>Then import from this file with lines like the following:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>name1<span class="token punctuation">,</span> name3<span class="token punctuation">,</span> name4<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./deps.ts'</span><span class="token punctuation">;</span></code></pre><p>TODO: Isn't it odd to then have every source file only import from this one file?</p><h2 id="import-maps">Import Maps</h2><p>Imports maps are currently an experimental feature that only work if the <code>--unstable</code> flag is included. They define a mapping from keywords to URLs and allow the keywords to be used in place of URLs in <code>import</code> statements. The mapping is specified in a JSON file which is referenced by the <code>--importmap</code> option.</p><p>For example, the file <code>import_map.json</code> could contain:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"imports"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"date-fns"</span><span class="token operator">:</span> <span class="token string">"https://cdn.deno.land/date_fns/versions/v2.15.0/raw/index.js"</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>A script in the file <code>demo.js</code> can import these as follows:</p><pre class="language-js"><code class="language-js"><span class="token comment">// Example function calls take directly from https://date-fns.org/.</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>format<span class="token punctuation">,</span> formatDistance<span class="token punctuation">,</span> formatRelative<span class="token punctuation">,</span> subDays<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'date-fns'</span><span class="token punctuation">;</span><br><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"'Today is a' iiii"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// example output: Today is a Monday</span><br><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">formatDistance</span><span class="token punctuation">(</span><span class="token function">subDays</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// output: 3 days ago</span><br><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">formatRelative</span><span class="token punctuation">(</span><span class="token function">subDays</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// example output: last Friday at 7:26 p.m.</span></code></pre><p>To run this, enter the following:</p><pre class="language-bash"><code class="language-bash">deno run --import-map<span class="token operator">=</span>import_map.json --unstable demo.js</code></pre><h2 id="lock-files">Lock Files</h2><p>It is useful to record the version of each dependency being used so the same versions can be downloaded by multiple developers and in CI/CD environments. A lock file does just this. Assuming all dependencies are exported from the file <code>src/deps.ts</code>, enter the following command to create a lock file named <code>lock.json</code>.</p><pre class="language-bash"><code class="language-bash">deno cache --lock<span class="token operator">=</span>lock.json --lock-write src/deps.ts</code></pre><p>Add the lock file to version control.</p><p>To install all the dependency versions specified in a lock file, enter the following command:</p><pre class="language-bash"><code class="language-bash">deno cache --reload --lock<span class="token operator">=</span>lock.json src/deps.ts</code></pre><p>The cached files continue to be used without checking whether dependencies have been updated. To update the cached files to their latest versions, enter <code>deno cache --reload</code>.</p><p>To update a single module to a specific version, enter a command like the following:</p><pre class="language-bash"><code class="language-bash">deno cache --reload<span class="token operator">=</span>https://some-domain/some-module@version main.ts</code></pre><p>After doing this, the lock file can be updated by entering the command for creating it that was described earlier.</p><p>To run a Deno program using only cached modules, preventing any new downloads, enter a command like the following:</p><pre class="language-bash"><code class="language-bash">deno run --lock<span class="token operator">=</span>lock.json --cached-only main.ts</code></pre><p>This will fail if any source file imports a module with a URL that has not previously been cached.</p><h2 id="standard-library">Standard Library</h2><p>The Deno <a href="https://deno.land/std" rel="noopener" target="_blank">Standard Library</a> is modeled after that of the Go programming language. It is implemented in TypeScript. The Deno core team maintains and reviews it, providing more quality assurance than using third-party libraries. These modules are not installed by default and are downloaded and cached the first time a script that uses them is run.</p><p>Highlights from the Deno standard library are described in the following table:</p><table><thead><tr><th>Module</th><th>Description</th></tr></thead><tbody><tr><td>archive</td><td>tars and untars files</td></tr><tr><td>bytes</td><td>operates on Uint8Array values</td></tr><tr><td>datetime</td><td>parses date strings, formats <code>Date</code> objects, and extracts data from them</td></tr><tr><td>encoding</td><td>deals with many data encodings such as base32, binary, csv, toml, and yaml</td></tr><tr><td>flags</td><td>command line argument parser</td></tr><tr><td>fmt</td><td>formatted output (<code>sprintf</code>) including colors and styles</td></tr><tr><td>fs</td><td>file system manipulation</td></tr><tr><td>hash</td><td>creates hashes (ex. md5) and applies them to data</td></tr><tr><td>http</td><td>for implementing HTTP servers</td></tr><tr><td>io</td><td>reading from and writing to streams, including reading by lines</td></tr><tr><td>log</td><td>logging with debug, info, warning, error, and critical levels</td></tr><tr><td>mime</td><td>reads and writes multipart form data</td></tr><tr><td>node</td><td>compatibility layer for the Node.js standard library (partially implemented)</td></tr><tr><td>path</td><td>manipulates file paths; currently on generates RegExps from glob expressions</td></tr><tr><td>permissions</td><td>gets permission flag strings and grants permissions (see <code>Deno.permissions</code> first)</td></tr><tr><td>signal</td><td>generates and listens for OS signals such as SIGINT (ctrl-c)</td></tr><tr><td>testing</td><td>assertions for implementing unit tests</td></tr><tr><td>textproto</td><td><code>TextProtoReader</code> class for reading from a <code>BufReader</code></td></tr><tr><td>uuid</td><td>generates and validates unique identifiers</td></tr><tr><td>wasi</td><td>implements the WebAssembly System Interface</td></tr><tr><td>ws</td><td>for implementing WebSocket servers</td></tr></tbody></table><p>TODO: Is <code>datetime</code> being renamed to <code>date</code>? See <a href="https://github.com/denoland/deno/issues/8594">https://github.com/denoland/deno/issues/8594</a>.</p><p>These libraries typically contain a <code>mod.ts</code> file that defines what is exported.</p><p>To see documentation for a standard library source file, browse <a href="https://deno.land/" rel="noopener" target="_blank">deno.land</a>, click &quot;Standard Library&quot; at the top, click the name of the library (such as <code>fs</code>), click a <code>.ts</code> source file (such as <code>mod.ts</code>), and click &quot;View Documentation&quot;.</p><p>For example, the <code>fs</code> library provides the following functions:</p><ul><li><code>copy</code> copies a file or directory</li><li><code>exists</code> tests whether a file or directory exists</li><li><code>move</code> moves a file or directory</li><li><code>walk</code> recursively walks the files in a directory</li><li>and more</li></ul><p>The <code>fmt</code> library provides the following functions:</p><ul><li><code>printf</code> prints formatted output</li><li>functions to output text with a specific style including <code>bold</code>, <code>dim</code>, <code>hidden</code>, <code>inverse</code>, <code>italic</code>, <code>strikethrough</code>, and <code>underline</code></li><li>functions to output text in a color including <code>black</code>, <code>blue</code>, <code>cyan</code>, <code>gray</code>, <code>green</code>, <code>magenta</code>, <code>red</code>, <code>white</code>, <code>yellow</code>, and <code>rgb8</code> (for custom colors)</li><li><code>bg</code> versions of the color functions to set the background color</li><li><code>bright</code> versions of the color functions</li><li><code>bgBright</code> versions of the color functions to set a bright background color</li></ul><p>To write to stdout with colors, similar to the npm package &quot;chalk&quot;:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span><br>  bgYellow<span class="token punctuation">,</span><br>  blue<span class="token punctuation">,</span><br>  green<span class="token punctuation">,</span><br>  italic<span class="token punctuation">,</span><br>  red<span class="token punctuation">,</span><br>  underline<br><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://deno.land/std/fmt/colors.ts'</span><span class="token punctuation">;</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><br>  <span class="token function">bgYellow</span><span class="token punctuation">(</span><span class="token function">red</span><span class="token punctuation">(</span><span class="token string">'one'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token function">italic</span><span class="token punctuation">(</span><span class="token function">green</span><span class="token punctuation">(</span><span class="token string">'two'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token function">underline</span><span class="token punctuation">(</span><span class="token function">blue</span><span class="token punctuation">(</span><span class="token string">'three'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The <code>io</code> library provides functions for input/output. For example, to read from a file one line at a time:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>readLines<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://deno.land/std/io/mod.ts'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> path <span class="token keyword">from</span> <span class="token string">'https://deno.land/std/path/mod.ts'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> filename <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>Deno<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'my-file.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> reader <span class="token operator">=</span> <span class="token keyword">await</span> Deno<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> line <span class="token keyword">of</span> <span class="token function">readLines</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h2 id="third-party-modules">Third Party Modules</h2><p>Many third party modules are registered at <a href="https://deno.land/x" rel="noopener" target="_blank">deno.land/x</a>. The code for these modules originates from a public GitHub repository. When a module is added to <code>deno.land/x</code>, an immutable copy is made in an S3 bucket and it is served from there. As of 12/3/2020 there were 1342 modules here.</p><p>To add your own modules to <code>deno.land/x</code>, browse the site and click the &quot;Add a module&quot; button under &quot;How do I add a module&quot;. Apply a git tag to each version. These tags are used as version numbers in import URLs.</p><p>One example is the <code>case</code> module which provides many functions that convert multi-word strings where words are separated by spaces into another string. Follow the instructions to add a &quot;Branch or tag creation&quot; webhook to your repository.</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> c <span class="token keyword">from</span> <span class="token string">'https://deno.land/x/case@v2.1.0/mod.ts'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> s <span class="token operator">=</span> <span class="token string">'one FINE day'</span><span class="token punctuation">;</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'camel:'</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">camelCase</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// oneFineDay</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'constant:'</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">constantCase</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ONE_FINE_DAY</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dot:'</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">dotCase</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// one.fine.day</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'header:'</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">headerCase</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// One-Fine-Day</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'lower:'</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">lowerCase</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// one fine day</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'lowerFirst:'</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">lowerFirstCase</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// one FINE day</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'normal:'</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">normalCase</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// one fine day</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'param:'</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">paramCase</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// one-fine-day</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'pascal:'</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">pascalCase</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// OneFineDay</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'path:'</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">pathCase</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// one/fine/day</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'sentence:'</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">sentenceCase</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// One fine day</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'snake:'</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">snakeCase</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// one_fine_day</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'swap:'</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">swapCase</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ONE fine DAY</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'title:'</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">titleCase</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// One Fine Day</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'upper:'</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">upperCase</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ONE FINE DAY</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'upperFirst:'</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">upperFirstCase</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// One FINE day</span></code></pre><p>Another site for third party Deno modules is <a href="https://nest.land/" rel="noopener" target="_blank">nest.land</a>. This is a free repository of Deno modules that uses <a href="https://www.arweave.org/" rel="noopener" target="_blank">Arweave</a> to permanently store them using Blockchain. As of 11/30/2020 there were 196 registered modules here.</p><h2 id="deno.land">deno.land</h2><p>The site <code>https://deno.land/x</code> hosts a curated collection of third-party modules that work with Deno. As of 11/23/2020 it contained 1,302 modules. Examples include lodash, date_fns, ramda, xstate, ky (HTTP client), and i18next (internationalization framework).</p><h2 id="using-node-packages">Using Node Packages</h2><p>Node packages that only use Node.js APIs that have been polyfilled by Deno have a possibility of being usable in Deno programs. For example, <a href="https://www.npmjs.com/package/lodash" rel="noopener" target="_blank">lodash</a> can be used. To do this:</p><ol><li>Create a <code>package.json</code> file by entering <code>npm init</code>.</li><li>Install Node package with the <code>npm install</code> command to add them in a <code>node_modules</code> subdirectory.</li><li>Require them with the code like the following.</li></ol><pre class="language-js"><code class="language-js"><span class="token comment">// use_node.js</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>createRequire<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://deno.land/std@0.79.0/node/module.ts'</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> require <span class="token operator">=</span> <span class="token function">createRequire</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> _ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> scores <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'first score ='</span><span class="token punctuation">,</span> _<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span>scores<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 87</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'last score ='</span><span class="token punctuation">,</span> _<span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span>scores<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 94</span></code></pre><p>To run this, enter <code>deno run --allow-env --allow-read --unstable use_node.js</code>.</p><p>Deno provides polyfills for some Node packages. See the list at <a href="https://deno.land/std@0.79.0/node#supported-builtins" rel="noopener" target="_blank">Supported Builtins</a>. Use the <code>require</code> function to load these. For example, to load the <code>path</code> polyfill:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>createRequire<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://deno.land/std@0.79.0/node/module.ts'</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> require <span class="token operator">=</span> <span class="token function">createRequire</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="deno-global-variable">Deno Global Variable</h2><p>When a script is run with <code>deno run</code>, the <code>Deno</code> global variable is made available. It has a large number of properties, most of which are functions. Examples include:</p><p>TODO: Do something with this list! args - array of command-line arguments Buffer chdir chmod chmodSync chown chownSync close connect copy copyFile copyFileSync create createSync cwd execPath exit File inspect iter iterSync listen mainModule mkdir mkdirSync open openSync pid - process id ppid - parent process id read readAll readAllSync readDir readDirSync readFile readFileSync readLink readLinkSync readSync readTextFile readTextFileSync realPath realPathSync remove removeSync rename renameSync run stderr stdin stdout test watchFs write writeAll writeAllSync writeFile writeFileSync writeSync writeTextFile writeTextFileSync</p><p><code>build</code> - an object with <code>arch</code>, <code>env</code>, <code>os</code>, <code>target</code>, and <code>vendor</code> properties</p><p><code>env</code> - an object with the functions <code>delete</code>, <code>get</code>, <code>set</code>, and <code>toObject</code></p><p><code>errors</code> - an object whose properties are the following error constructor functions which can be used to create errors thrown by your code:</p><ul><li><code>AddrInUse</code></li><li><code>AddrNotAvailable</code></li><li><code>AlreadyExists</code></li><li><code>BadResource</code></li><li><code>BrokenPipe</code></li><li><code>Busy</code></li><li><code>ConnectionAborted</code></li><li><code>ConnectionRefused</code></li><li><code>ConnectionReset</code></li><li><code>Http</code></li><li><code>Interrupted</code></li><li><code>InvalidData</code></li><li><code>NotConnected</code></li><li><code>NotFound</code></li><li><code>NotSupported</code></li><li><code>PermissionDenied</code></li><li><code>TimedOut</code></li><li><code>UnexpectedEof</code></li><li><code>WriteZero</code></li></ul><p><code>version</code> - an object with the properties <code>deno</code>, <code>typescript</code>, and <code>v8</code> whose values are all version numbers</p><p>To write and read text files:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token string">'This is a story\nbout a man named Jed'</span><span class="token punctuation">;</span><br><span class="token keyword">try</span> <span class="token punctuation">{</span><br>  <span class="token keyword">await</span> Deno<span class="token punctuation">.</span><span class="token function">writeTextFile</span><span class="token punctuation">(</span><span class="token string">'demo.txt'</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> Deno<span class="token punctuation">.</span><span class="token function">readTextFile</span><span class="token punctuation">(</span><span class="token string">'demo.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// handle errors</span><br><span class="token punctuation">}</span></code></pre><h2 id="environment-variables">Environment Variables</h2><p>The <code>Deno.env</code> variable provides methods to get, set, and delete environment variables. Using these requires the <code>--allow-env</code> flag.</p><table><thead><tr><th>Operation</th><th>Function</th></tr></thead><tbody><tr><td>get</td><td><code>Deno.env.get(&quot;name&quot;)</code></td></tr><tr><td>set</td><td><code>Deno.env.set(&quot;name&quot;, &quot;value&quot;)</code></td></tr><tr><td>delete</td><td><code>Deno.env.delete(&quot;name&quot;)</code></td></tr></tbody></table><p>The shell in which the Deno program runs is no affected by the <code>set</code> or <code>delete</code> methods.</p><p>For example:</p><pre class="language-js"><code class="language-js">Deno<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'COLOR'</span><span class="token punctuation">,</span> <span class="token string">'yellow'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> color <span class="token operator">=</span> Deno<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'COLOR'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// yellow</span><br>Deno<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'COLOR'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>color <span class="token operator">=</span> Deno<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'COLOR'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span></code></pre><h2 id="parsing-command-line-arguments">Parsing command line arguments</h2><p>There are several Deno modules for parsing command line arguments. The standard library provides the <a href="https://deno.land/std/flags" rel="noopener" target="_blank">flags</a> module. Third party options include <a href="https://deno.land/x/yargs@v16.1.1-deno" rel="noopener" target="_blank">yargs</a> and <a href="https://github.com/c4spar/deno-cliffy" rel="noopener" target="_blank">Cliffy</a>.</p><p>The <code>flags</code> module provides a <code>parse</code> function that gathers command line flags into an object and returns it. Default values can be specified for each flag. Additional values after <code>--</code> are gathered into an array stored in the key &quot;_&quot;.</p><p>An options method to be called with unsupported flags, named <code>unknown</code>, can be supplied. These flags will still be added to the returned object unless this method returns <code>false</code>.</p><p>Here is an example of using the <code>flags</code> module in the file <code>flags_demo.js</code>. It recognizes the flags &quot;alpha&quot;, &quot;beta&quot;, and &quot;gamma&quot;. The value of the &quot;alpha&quot; flag is coerced to a boolean. The values of the &quot;beta&quot; and &quot;gamma&quot; flags are treated as strings. There is no support for treating flag values as numbers, but they can be converted to numbers after being parsed.</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>parse<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://deno.land/std@0.79.0/flags/mod.ts'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><br>  boolean<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'alpha'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>  string<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'beta'</span><span class="token punctuation">,</span> <span class="token string">'gamma'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    alpha<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>    beta<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><br>    gamma<span class="token operator">:</span> <span class="token string">'Greek'</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token function">unknown</span><span class="token punctuation">(</span><span class="token parameter">flag</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'unsupported flag'</span><span class="token punctuation">,</span> flag<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span>Deno<span class="token punctuation">.</span>args<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span><br>console<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>When this is run with the command <code>deno run flags_demo.js --alpha=foo --beta=19 --delta -- foo bar</code> it outputs the following:</p><pre class="language-text"><code class="language-text">unsupported flag ---delta<br>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê<br>‚îÇ (idx) ‚îÇ   0   ‚îÇ   1   ‚îÇ Values  ‚îÇ<br>‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§<br>‚îÇ   _   ‚îÇ "foo" ‚îÇ "bar" ‚îÇ         ‚îÇ<br>‚îÇ alpha ‚îÇ       ‚îÇ       ‚îÇ  true   ‚îÇ<br>‚îÇ beta  ‚îÇ       ‚îÇ       ‚îÇ  "19"   ‚îÇ<br>‚îÇ gamma ‚îÇ       ‚îÇ       ‚îÇ "Greek" ‚îÇ<br>‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</code></pre><p>Here is the same example of using the <code>yargs</code> module in the file <code>yargs_demo.ts</code>. It also supports &quot;aliases&quot; which enable shorthand options (ex. <code>--alpha</code> or <code>-a</code>).</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> yargs <span class="token keyword">from</span> <span class="token string">'https://deno.land/x/yargs/deno.ts'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>Arguments<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://deno.land/x/yargs/deno-types.ts'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token function">yargs</span><span class="token punctuation">(</span>Deno<span class="token punctuation">.</span>args<span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'alpha'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>    alias<span class="token operator">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span><br>    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>    description<span class="token operator">:</span> <span class="token string">'first greek'</span><span class="token punctuation">,</span><br>    <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">'boolean'</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'beta'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>    alias<span class="token operator">:</span> <span class="token string">'b'</span><span class="token punctuation">,</span><br>    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><br>    description<span class="token operator">:</span> <span class="token string">'second greek'</span><span class="token punctuation">,</span><br>    <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">'number'</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'gamma'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>    alias<span class="token operator">:</span> <span class="token string">'g'</span><span class="token punctuation">,</span><br>    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">'Greek'</span><span class="token punctuation">,</span><br>    description<span class="token operator">:</span> <span class="token string">'third greek'</span><span class="token punctuation">,</span><br>    <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">'string'</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">strict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>argv<span class="token punctuation">;</span> <span class="token comment">// only allow described options</span><br><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>When this is run with the command <code>deno run yargs_demo.ts --alpha=foo --beta=19 --gamma=delta -- foo bar</code> it outputs the following:</p><pre class="language-text"><code class="language-text">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê<br>‚îÇ (idx) ‚îÇ   0   ‚îÇ   1   ‚îÇ   Values   ‚îÇ<br>‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§<br>‚îÇ   _   ‚îÇ "foo" ‚îÇ "bar" ‚îÇ            ‚îÇ<br>‚îÇ alpha ‚îÇ       ‚îÇ       ‚îÇ   false    ‚îÇ<br>‚îÇ   a   ‚îÇ       ‚îÇ       ‚îÇ   false    ‚îÇ<br>‚îÇ beta  ‚îÇ       ‚îÇ       ‚îÇ     19     ‚îÇ<br>‚îÇ   b   ‚îÇ       ‚îÇ       ‚îÇ     19     ‚îÇ<br>‚îÇ gamma ‚îÇ       ‚îÇ       ‚îÇ  "delta"   ‚îÇ<br>‚îÇ   g   ‚îÇ       ‚îÇ       ‚îÇ  "delta"   ‚îÇ<br>‚îÇ  $0   ‚îÇ       ‚îÇ       ‚îÇ "deno run" ‚îÇ<br>‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</code></pre><p>The yargs module supports using the <code>--help</code> flag to output help on the supported flags. For example, <code>deno run yargs_demo.ts --help</code> outputs the following:</p><pre class="language-text"><code class="language-text">Options:<br>      --help     Show help                                             [boolean]<br>      --version  Show version number                                   [boolean]<br>  -a, --alpha    first greek                          [boolean] [default: false]<br>  -b, --beta     second greek                              [number] [default: 1]<br>  -g, --gamma    third greek                         [string] [default: "Greek"]</code></pre><h2 id="databases">Databases</h2><p>The most popular Deno library for working with relational databases is <a href="https://deno.land/x/cotton" rel="noopener" target="_blank">Cotton</a>. It supports MySQL, PostgreSQL, and SQLite.</p><p>For more details on SQLite, see <a href="/blog/sqlite">here</a>.</p><p>Cotton supports <a href="https://deno.land/x/cotton@v0.7.4/docs/guide/query-builder.md" rel="noopener" target="_blank">query builder</a> functions that enable creating SQL statements with function calls as an alternative to manually creating SQL statement strings.</p><p>Cotton also supports <a href="https://deno.land/x/cotton@v0.7.4/docs/guide/model.md" rel="noopener" target="_blank">object-relational mapping</a> that maps a JavaScript class to a database table.</p><p>Finally, Cotton supports <a href="https://deno.land/x/cotton@v0.7.4/docs/guide/migrations.md" rel="noopener" target="_blank">database migrations</a> for making a series of changes to a database schema in a repeatable way.</p><p>Here's an example using <a href="https://www.sqlite.org/index.html" rel="noopener" target="_blank">SQLite</a>.</p><ol><li>Install SQLite by downloading a version from the <a href="https://www.sqlite.org/download.html" rel="noopener" target="_blank">SQLite Download Page</a>.</li><li>Create a pets database by entering <code>sqlite3 pets.db</code> This starts an interactive session, indicated by the <code>sqlite&gt;</code> prompt.</li><li>Create a &quot;dogs&quot; table by entering <code>create table dogs(id integer primary key autoincrement, name string, breed string);</code></li><li>Add a row to the &quot;dogs&quot; table by entering <code>insert into dogs values('Comet', 'Whippet');</code></li><li>Query the &quot;dogs&quot; table by entering <code>select \* from dogs;</code></li></ol><p>Here is a Deno program in a file named <code>cotton_demo.js</code> that interacts with the pets database.</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>connect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://deno.land/x/cotton/mod.ts'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">'sqlite'</span><span class="token punctuation">,</span> database<span class="token operator">:</span> <span class="token string">'pets.db'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Delete all rows from the dogs table.</span><br><span class="token comment">//await db.table("dogs").delete().execute();</span><br><span class="token comment">//await db.table("dogs").delete().where('name', '*').execute();</span><br><span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'delete from dogs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Add new rows to the dogs table.</span><br><span class="token keyword">const</span> initialDogs <span class="token operator">=</span> <span class="token punctuation">[</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Maisey'</span><span class="token punctuation">,</span> breed<span class="token operator">:</span> <span class="token string">'Treeing Walker Coonhound'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Ramsay'</span><span class="token punctuation">,</span> breed<span class="token operator">:</span> <span class="token string">'Native American Indian Dog'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Oscar'</span><span class="token punctuation">,</span> breed<span class="token operator">:</span> <span class="token string">'German Shorthaired Pointer'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Comet'</span><span class="token punctuation">,</span> breed<span class="token operator">:</span> <span class="token string">'Whippet'</span><span class="token punctuation">}</span><br><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token comment">// Note that building a query is separate from executing it.</span><br><span class="token keyword">const</span> query <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'dogs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>initialDogs<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'sql ='</span><span class="token punctuation">,</span> query<span class="token punctuation">.</span><span class="token function">toSQL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// to see what it will execute</span><br><span class="token keyword">await</span> query<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">await</span> db<br>  <span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'dogs'</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'Oscar'</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Oscar Wilde'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Using a SQL string</span><br><span class="token keyword">let</span> dogs <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'select * from dogs order by name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dogs ='</span><span class="token punctuation">,</span> dogs<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Using query builder</span><br>dogs <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'dogs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dogs ='</span><span class="token punctuation">,</span> dogs<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Using "where"</span><br><span class="token keyword">const</span> <span class="token punctuation">[</span>comet<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'dogs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'Comet'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'comet ='</span><span class="token punctuation">,</span> comet<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Using pagination</span><br>dogs <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'dogs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2nd page of dogs with 2 per page ='</span><span class="token punctuation">,</span> dogs<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>To run this, enter the following command which is very specific about which files should be readable and writable:</p><pre class="language-bash"><code class="language-bash">deno run <span class="token punctuation">\</span><br>  --allow-read<span class="token operator">=</span>pets.db,pets.db-journal <span class="token punctuation">\</span><br>  --allow-write<span class="token operator">=</span>pets.db,pets.db-journal <span class="token punctuation">\</span><br>  cotton_demo.js</code></pre><p>An alternative supported by Cotton is to define model classes that map to tables, create instances of those classes, and interact with the database using the model classes and instances. Each model class must have a property that is mapped to the primary key of its table and that column must use autoincrement.</p><p>Here is an example that mimics most of the previous example using a model class:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span><br>  Column<span class="token punctuation">,</span><br>  connect<span class="token punctuation">,</span><br>  DataType<span class="token punctuation">,</span><br>  Model<span class="token punctuation">,</span><br>  Primary<br><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://deno.land/x/cotton/mod.ts'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">'sqlite'</span><span class="token punctuation">,</span> database<span class="token operator">:</span> <span class="token string">'pets.db'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> manager <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">getManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// If no table name is passed to @Model, it will default to</span><br><span class="token comment">// the lowercase version of the class name, "dog" in this case.</span><br>@<span class="token function">Model</span><span class="token punctuation">(</span><span class="token string">'dogs'</span><span class="token punctuation">)</span><br><span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span><br>  <span class="token comment">// This class cannot have a constructor because Cotton</span><br>  <span class="token comment">// requires being able to create instances with new Dog().</span><br><br>  @<span class="token function">Primary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  id<span class="token operator">!</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// The docs say "Cotton is smart enough to determine the data type</span><br>  <span class="token comment">// of that particular column using TypeScript types.</span><br>  <span class="token comment">// However, you can still customize your column types</span><br>  <span class="token comment">// by passing the type option."</span><br>  <span class="token comment">// But omitting this gives the error</span><br>  <span class="token comment">// "Column '${propertyKey}' must have a type!"</span><br>  @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">type</span><span class="token operator">:</span> DataType<span class="token punctuation">.</span>String<span class="token punctuation">}</span><span class="token punctuation">)</span><br>  name<span class="token operator">!</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span><br><br>  @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">type</span><span class="token operator">:</span> DataType<span class="token punctuation">.</span>String<span class="token punctuation">}</span><span class="token punctuation">)</span><br>  breed<span class="token operator">!</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Delete all rows from the dogs table.</span><br><span class="token comment">// The query builder doesn't support deleting all rows from a table</span><br><span class="token comment">// because it is a dangerous thing to do in production.</span><br><span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'delete from dogs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Add new rows to the dogs table.</span><br><span class="token keyword">const</span> initialDogs <span class="token operator">=</span> <span class="token punctuation">[</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Maisey'</span><span class="token punctuation">,</span> breed<span class="token operator">:</span> <span class="token string">'Treeing Walker Coonhound'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Ramsay'</span><span class="token punctuation">,</span> breed<span class="token operator">:</span> <span class="token string">'Native American Indian Dog'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Oscar'</span><span class="token punctuation">,</span> breed<span class="token operator">:</span> <span class="token string">'German Shorthaired Pointer'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Comet'</span><span class="token punctuation">,</span> breed<span class="token operator">:</span> <span class="token string">'Whippet'</span><span class="token punctuation">}</span><br><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">{</span>name<span class="token punctuation">,</span> breed<span class="token punctuation">}</span> <span class="token keyword">of</span> initialDogs<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> dog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  dog<span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span><br>  dog<span class="token punctuation">.</span>breed <span class="token operator">=</span> breed<span class="token punctuation">;</span><br>  <span class="token keyword">await</span> manager<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">await</span> manager<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>Dog<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'Oscar'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Oscar Wilde'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> dogs <span class="token operator">=</span> <span class="token keyword">await</span> manager<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>Dog<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dogs ='</span><span class="token punctuation">,</span> dogs<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> comet <span class="token operator">=</span> <span class="token keyword">await</span> manager<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>Dog<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'Comet'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'comet ='</span><span class="token punctuation">,</span> comet<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Because this code uses decorators, the following options must be present in a <code>tsconfig.json</code> file:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"experimentalDecorators"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>    <span class="token property">"emitDecoratorMetadata"</span><span class="token operator">:</span> <span class="token boolean">true</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>It seems that Cotton does not currently support creating or executing for prepared statements? See this <a href="https://github.com/rahmanfadhil/cotton/issues/32" rel="noopener" target="_blank">issue</a>.</p><h2 id="mongodb">MongoDB</h2><p>One option for working with MongoDB databases in Deno is <a href="https://deno.land/x/mongo@v0.20.0" rel="noopener" target="_blank">deno_mongo</a>. Another option is <a href="https://eveningkid.github.io/denodb-docs/" rel="noopener" target="_blank">denodb</a> which aims to works with many databases. It uses deno_mongo under the hood for MongoDB databases, but I wasn't able to get it to work. See this <a href="https://github.com/eveningkid/denodb/issues/152" rel="noopener" target="_blank">issue</a> and this <a href="https://github.com/eveningkid/denodb/commit/abed3063dd92436ceb4f124227daee5ee6604b2d#commitcomment-44634400" rel="noopener" target="_blank">temporary fix</a>.</p><p>Here is an example of using deno_mongo:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>MongoClient<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://deno.land/x/mongo/mod.ts'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MongoClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://127.0.0.1:27017'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">interface</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span><br>  _id<span class="token operator">:</span> <span class="token punctuation">{</span>$oid<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span><br>  breed<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">const</span> db <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token string">'animals'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> dogsColl <span class="token operator">=</span> db<span class="token punctuation">.</span>collection<span class="token operator">&lt;</span>Dog<span class="token operator">></span><span class="token punctuation">(</span><span class="token string">'dogs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Delete all the documents in the dogs collection.</span><br><span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token keyword">await</span> dogsColl<span class="token punctuation">.</span><span class="token function">deleteMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span>_id<span class="token operator">:</span> <span class="token punctuation">{</span>$ne<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'deleted'</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Insert one dog.</span><br><span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token keyword">await</span> dogsColl<span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  name<span class="token operator">:</span> <span class="token string">'Snoopy'</span><span class="token punctuation">,</span><br>  breed<span class="token operator">:</span> <span class="token string">'Beagle'</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'inserted id ='</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Insert many dogs.</span><br><span class="token keyword">const</span> initialDogs <span class="token operator">=</span> <span class="token punctuation">[</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Maisey'</span><span class="token punctuation">,</span> breed<span class="token operator">:</span> <span class="token string">'Treeing Walker Coonhound'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Ramsay'</span><span class="token punctuation">,</span> breed<span class="token operator">:</span> <span class="token string">'Native American Indian Dog'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Oscar'</span><span class="token punctuation">,</span> breed<span class="token operator">:</span> <span class="token string">'German Shorthaired Pointer'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Comet'</span><span class="token punctuation">,</span> breed<span class="token operator">:</span> <span class="token string">'Whippet'</span><span class="token punctuation">}</span><br><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token keyword">await</span> dogsColl<span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span>initialDogs<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Update one of the dogs.</span><br><span class="token keyword">const</span> <span class="token punctuation">{</span>matchedCount<span class="token punctuation">,</span> modifiedCount<span class="token punctuation">,</span> upsertedId<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> dogsColl<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><br>  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token punctuation">{</span>$eq<span class="token operator">:</span> <span class="token string">'Oscar'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span>$<span class="token keyword">set</span><span class="token operator">:</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Oscar Wilde'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Get all the documents in the dogs collection.</span><br><span class="token keyword">const</span> dogs <span class="token operator">=</span> <span class="token keyword">await</span> dogsColl<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token punctuation">{</span>$ne<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dogs ='</span><span class="token punctuation">,</span> <span class="token keyword">await</span> dogs<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Get the number of documents in the dogs collection.</span><br>count <span class="token operator">=</span> <span class="token keyword">await</span> dogsColl<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'count ='</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="basic-http-server">Basic HTTP server</h2><p>Here is a very basic HTTP server that only uses the standard library.</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>serve<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://deno.land/std/http/server.ts'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">serve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>port<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'listening on port'</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> req <span class="token keyword">of</span> server<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'req is'</span><span class="token punctuation">,</span> req<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'got request for'</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>method<span class="token punctuation">,</span> req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  req<span class="token punctuation">.</span><span class="token function">respond</span><span class="token punctuation">(</span><span class="token punctuation">{</span>body<span class="token operator">:</span> <span class="token string">'Hello World\n'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>Here is a more advanced HTTP server written in TypeScript. Typically one would use a framework such as oak (covered below) for this, but it demonstrates what is possible using only the standard library. It supports two operations, &quot;add&quot; and &quot;multiply&quot;, that are invoked with requests like these:</p><pre class="language-text"><code class="language-text">GET http://localhost:1234/add?n1=2&n2=3 returns 5<br>GET http://localhost:1234/multiply?n1=3&n2=4 returns 12</code></pre><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span><br>  Response<span class="token punctuation">,</span><br>  serve<span class="token punctuation">,</span><br>  Server<span class="token punctuation">,</span><br>  ServerRequest<br><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://deno.land/std/http/server.ts'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>decode<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://deno.land/std/encoding/utf8.ts'</span><span class="token punctuation">;</span><br><br><span class="token keyword">type</span> StringToString <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> server<span class="token operator">:</span> Server <span class="token operator">=</span> <span class="token function">serve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>port<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'listening on port'</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getBodyJson</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token operator">:</span> ServerRequest</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getBodyText</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> contentType <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>contentType <span class="token operator">!==</span> <span class="token string">'application/json'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Content-Type </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>contentType<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is not valid for JSON</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getBodyText</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token operator">:</span> ServerRequest</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span> <span class="token punctuation">{</span><br>  <span class="token comment">// Deno makes heavy use of the Uint8Array type.</span><br>  <span class="token keyword">const</span> buf<span class="token operator">:</span> Uint8Array <span class="token operator">=</span> <span class="token keyword">await</span> Deno<span class="token punctuation">.</span><span class="token function">readAll</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token function">decode</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">getQueryParams</span><span class="token punctuation">(</span><br>  <span class="token parameter">req<span class="token operator">:</span> ServerRequest<span class="token punctuation">,</span><br>  <span class="token operator">...</span>names<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><br><span class="token punctuation">)</span><span class="token operator">:</span> StringToString <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> host <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'host'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// URL and URLSearchParams are Web APIs.</span><br>  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">'http://'</span> <span class="token operator">+</span> host <span class="token operator">+</span> req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> searchParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>search<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> params<span class="token operator">:</span> StringToString <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> name <span class="token keyword">of</span> names<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> value <span class="token operator">=</span> searchParams<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'missing query parameter '</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    params<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">return</span> params<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token operator">:</span> ServerRequest</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getQueryParams</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token string">'n1'</span><span class="token punctuation">,</span> <span class="token string">'n2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token function">Number</span><span class="token punctuation">(</span>n1<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">Number</span><span class="token punctuation">(</span>n2<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// This just demonstrates getting a JSON body.</span><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">echoJson</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token operator">:</span> ServerRequest</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getBodyJson</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token operator">:</span> ServerRequest</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getQueryParams</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token string">'n1'</span><span class="token punctuation">,</span> <span class="token string">'n2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token function">Number</span><span class="token punctuation">(</span>n1<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">Number</span><span class="token punctuation">(</span>n2<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">shout</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token operator">:</span> ServerRequest</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getBodyText</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> body<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">type</span> <span class="token function-variable function">Handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token operator">:</span> ServerRequest</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> routeHandlers<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> Handler<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>add<span class="token punctuation">,</span> echoJson<span class="token punctuation">,</span> multiply<span class="token punctuation">,</span> shout<span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">function</span> <span class="token function">getFirstPathPart</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token operator">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>path<span class="token punctuation">]</span> <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> req<span class="token operator">:</span> ServerRequest <span class="token keyword">of</span> server<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>method<span class="token punctuation">,</span> req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// This assumes that we can determine the route</span><br>  <span class="token comment">// based on the first path part and does not</span><br>  <span class="token comment">// support routes that use path parts as parameters.</span><br>  <span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token function">getFirstPathPart</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> handler <span class="token operator">=</span> routeHandlers<span class="token punctuation">[</span>route<span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>handler<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">try</span> <span class="token punctuation">{</span><br>      <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      req<span class="token punctuation">.</span><span class="token function">respond</span><span class="token punctuation">(</span><span class="token punctuation">{</span>body<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      req<span class="token punctuation">.</span><span class="token function">respond</span><span class="token punctuation">(</span><span class="token punctuation">{</span>body<span class="token operator">:</span> e<span class="token punctuation">.</span>message<span class="token punctuation">,</span> status<span class="token operator">:</span> <span class="token number">400</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>    req<span class="token punctuation">.</span><span class="token function">respond</span><span class="token punctuation">(</span><span class="token punctuation">{</span>body<span class="token operator">:</span> <span class="token string">'unsupported route '</span> <span class="token operator">+</span> route<span class="token punctuation">,</span> status<span class="token operator">:</span> <span class="token number">400</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><h2 id="rest-server-with-oak">REST Server with oak</h2><p>There are many HTTP server libraries for Deno. Currently the most popular is <a href="https://oakserver.github.io/oak/" rel="noopener" target="_blank">oak</a>. It is inspired by the Koa package for Node.js.</p><p>Other HTTP server libraries to consider include <a href="https://github.com/zhmushan/abc" rel="noopener" target="_blank">abc</a> and <a href="https://deno.land/x/drash@v1.3.0" rel="noopener" target="_blank">drash</a>.</p><p>Here is an example of implementing a REST server in oak that supports CRUD operations on dog objects.</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>Application<span class="token punctuation">,</span> Router<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://deno.land/x/oak/mod.ts'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>v4<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://deno.land/std/uuid/mod.ts'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token constant">PORT</span> <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> dogs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createDog</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token keyword">await</span> context<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span>breed<span class="token punctuation">,</span> name<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> body<span class="token punctuation">.</span>value<span class="token punctuation">;</span><br>  <span class="token keyword">const</span> id <span class="token operator">=</span> v4<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  dogs<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>id<span class="token punctuation">,</span> breed<span class="token punctuation">,</span> name<span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>  context<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> id<span class="token punctuation">;</span><br>  context<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">201</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">deleteAllDogs</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  dogs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">deleteDog</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span>id<span class="token punctuation">}</span> <span class="token operator">=</span> context<span class="token punctuation">.</span>params<span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>dogs<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">delete</span> dogs<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span><br>    context<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span> <span class="token comment">// Why necessary?</span><br>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>    context<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">getAllDogs</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  context<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">getDog</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span>id<span class="token punctuation">}</span> <span class="token operator">=</span> context<span class="token punctuation">.</span>params<span class="token punctuation">;</span><br>  <span class="token keyword">const</span> dog <span class="token operator">=</span> dogs<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>dog<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    context<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>    context<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">updateDog</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span>id<span class="token punctuation">}</span> <span class="token operator">=</span> context<span class="token punctuation">.</span>params<span class="token punctuation">;</span><br>  <span class="token keyword">const</span> dog <span class="token operator">=</span> dogs<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>dog<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token keyword">await</span> context<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    dogs<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> body<span class="token punctuation">.</span>value<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server.js updateDog: not found'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    context<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>router<br>  <span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'/dog'</span><span class="token punctuation">,</span> deleteAllDogs<span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'/dog/:id'</span><span class="token punctuation">,</span> deleteDog<span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/dog'</span><span class="token punctuation">,</span> getAllDogs<span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/dog/:id'</span><span class="token punctuation">,</span> getDog<span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/dog'</span><span class="token punctuation">,</span> createDog<span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/dog/:id'</span><span class="token punctuation">,</span> updateDog<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// patch is also supported.</span><br><br><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Application</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Request logging</span><br>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>app<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'listen'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'listening on port'</span><span class="token punctuation">,</span> <span class="token constant">PORT</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">{</span>port<span class="token operator">:</span> <span class="token constant">PORT</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Here is client code that sends requests to this REST server.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token constant">URL_PREFIX</span> <span class="token operator">=</span> <span class="token string">'http://localhost:1234/dog'</span><span class="token punctuation">;</span><br><br><span class="token keyword">function</span> <span class="token function">addDog</span><span class="token punctuation">(</span><span class="token parameter">dog</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token constant">URL_PREFIX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span> headers<span class="token punctuation">,</span> body<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">deleteAllDogs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token constant">URL_PREFIX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>method<span class="token operator">:</span> <span class="token string">'DELETE'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">deleteDog</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token constant">URL_PREFIX</span> <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> id<span class="token punctuation">,</span> <span class="token punctuation">{</span>method<span class="token operator">:</span> <span class="token string">'DELETE'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getAllDogs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token constant">URL_PREFIX</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getDogById</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token constant">URL_PREFIX</span> <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">getDogByName</span><span class="token punctuation">(</span><span class="token parameter">dogs<span class="token punctuation">,</span> name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">dog</span> <span class="token operator">=></span> dog<span class="token punctuation">.</span>name <span class="token operator">===</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">updateDog</span><span class="token punctuation">(</span><span class="token parameter">dog</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token constant">URL_PREFIX</span> <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> dog<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token punctuation">{</span>method<span class="token operator">:</span> <span class="token string">'PUT'</span><span class="token punctuation">,</span> headers<span class="token punctuation">,</span> body<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">await</span> <span class="token function">deleteAllDogs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">await</span> <span class="token function">addDog</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Maisey'</span><span class="token punctuation">,</span> breed<span class="token operator">:</span> <span class="token string">'Treeing Walker Coonhound'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">await</span> <span class="token function">addDog</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Ramsay'</span><span class="token punctuation">,</span> breed<span class="token operator">:</span> <span class="token string">'Native American Indian Dog'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">await</span> <span class="token function">addDog</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Oscar'</span><span class="token punctuation">,</span> breed<span class="token operator">:</span> <span class="token string">'German Shorthaired Pointer'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">await</span> <span class="token function">addDog</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Comet'</span><span class="token punctuation">,</span> breed<span class="token operator">:</span> <span class="token string">'Whippet'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">await</span> <span class="token function">addDog</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Snoopy'</span><span class="token punctuation">,</span> breed<span class="token operator">:</span> <span class="token string">'Beagle'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token constant">URL_PREFIX</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> dogs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getAllDogs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dogs ='</span><span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> oscar <span class="token operator">=</span> <span class="token function">getDogByName</span><span class="token punctuation">(</span>dogs<span class="token punctuation">,</span> <span class="token string">'Oscar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'client.js x: oscar ='</span><span class="token punctuation">,</span> oscar<span class="token punctuation">)</span><span class="token punctuation">;</span><br>oscar<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Oscar Wilde'</span><span class="token punctuation">;</span><br><span class="token keyword">await</span> <span class="token function">updateDog</span><span class="token punctuation">(</span>oscar<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> res2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">deleteDog</span><span class="token punctuation">(</span><span class="token function">getDogByName</span><span class="token punctuation">(</span>dogs<span class="token punctuation">,</span> <span class="token string">'Snoopy'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'client.js x: res2 ='</span><span class="token punctuation">,</span> res2<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>dogs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getAllDogs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'after delete, dogs ='</span><span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'client.js x: oscar ='</span><span class="token punctuation">,</span> <span class="token keyword">await</span> <span class="token function">getDogById</span><span class="token punctuation">(</span>oscar<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Deno server libraries do not yet seem to support generating OpenAPI (Swagger) documentation. One module that claims to support this is <a href="https://deno.land/x/deno_swagger_doc@releasev1.0.0" rel="noopener" target="_blank">deno_swagger_doc</a>, but I wasn't able to get it to work. See this <a href="https://github.com/singhcool/deno-swagger-doc/issues/8" rel="noopener" target="_blank">issue</a>.</p><h2 id="websockets">WebSockets</h2><p>Deno has built-in support for WebSockets. To demonstrate this, we'll build a simple app where multiple browser clients can connect to a WebSocket server. Each client renders an empty <code>svg</code> element. Clicking on the <code>svg</code> adds a circle in that location on every connected client. This could be the start of a game.</p><p><img alt="Deno WebSocket demo" style="width: 30%" src="/blog/assets/deno-websocket-demo.png" title="Deno WebSocket demo"></p><p>Here is the server code:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>serve<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://deno.land/std/http/server.ts'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>acceptWebSocket<span class="token punctuation">,</span> WebSocket<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://deno.land/std/ws/mod.ts'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> clients<span class="token operator">:</span> WebSocket<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">addClient</span><span class="token punctuation">(</span><span class="token parameter">sock<span class="token operator">:</span> WebSocket</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  clients<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sock<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// For every new event coming from this client ...</span><br>  <span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> event <span class="token keyword">of</span> sock<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Send the event to all connected clients.</span><br>    clients<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">client</span> <span class="token operator">=></span> client<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>event <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">const</span> <span class="token constant">PORT</span> <span class="token operator">=</span> <span class="token string">'1234'</span><span class="token punctuation">;</span><br><span class="token comment">// For every client connection request .wss..</span><br><span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">const</span> req <span class="token keyword">of</span> <span class="token function">serve</span><span class="token punctuation">(</span><span class="token string">':'</span> <span class="token operator">+</span> <span class="token constant">PORT</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span>conn<span class="token punctuation">,</span> r<span class="token operator">:</span> bufReader<span class="token punctuation">,</span> w<span class="token operator">:</span> bufWriter<span class="token punctuation">,</span> headers<span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">;</span><br>  <span class="token keyword">try</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> sock <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">acceptWebSocket</span><span class="token punctuation">(</span><span class="token punctuation">{</span>conn<span class="token punctuation">,</span> bufReader<span class="token punctuation">,</span> bufWriter<span class="token punctuation">,</span> headers<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">addClient</span><span class="token punctuation">(</span>sock<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">failed to accept WebSocket: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">await</span> req<span class="token punctuation">.</span><span class="token function">respond</span><span class="token punctuation">(</span><span class="token punctuation">{</span>status<span class="token operator">:</span> <span class="token number">400</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>Here is the client code that can be opened in a web browser:</p><pre class="language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><br>      <span class="token selector">body</span> <span class="token punctuation">{</span><br>        <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br><br>      <span class="token selector">circle</span> <span class="token punctuation">{</span><br>        <span class="token property">fill</span><span class="token punctuation">:</span> yellow<span class="token punctuation">;</span><br>        <span class="token property">stroke</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span><br>        <span class="token property">stroke-width</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br><br>      <span class="token selector">svg</span> <span class="token punctuation">{</span><br>        <span class="token property">background-color</span><span class="token punctuation">:</span> linen<span class="token punctuation">;</span><br>        <span class="token property">height</span><span class="token punctuation">:</span> 400px<span class="token punctuation">;</span><br>        <span class="token property">width</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>      <span class="token keyword">function</span> <span class="token function">addCircle</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> radius</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">const</span> svg <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'svg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">const</span> circle <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElementNS</span><span class="token punctuation">(</span><br>          <span class="token string">'http://www.w3.org/2000/svg'</span><span class="token punctuation">,</span><br>          <span class="token string">'circle'</span><br>        <span class="token punctuation">)</span><span class="token punctuation">;</span><br>        circle<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'cx'</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        circle<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'cy'</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        circle<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">,</span> radius<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        svg<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>circle<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br><br>      <span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:1234'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      ws<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'opened WebSocket'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>      ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token keyword">const</span> message <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span><br>        <span class="token keyword">const</span> <span class="token punctuation">[</span>shape<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> size<span class="token punctuation">]</span> <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>shape <span class="token operator">===</span> <span class="token string">'circle'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          <span class="token function">addCircle</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>          <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'unsupported shape '</span> <span class="token operator">+</span> shape<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>      <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>      <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">const</span> <span class="token constant">RADIUS</span> <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span><br>        <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">circle </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>clientX<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>clientY<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">RADIUS</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>        ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/2000/svg<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>handleClick(event)<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h2 id="tidbits">Tidbits</h2><p>To determine if the current file was executed as the main script, check the value of the boolean <code>import.meta.main</code>.</p></article>