<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>SQLite</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#installing">Installing</a></li><li><a href="#cli-tool">CLI Tool</a></li><li><a href="#file-input">File Input</a></li><li><a href="#dot-commands">Dot Commands</a></li><li><a href="#column-types">Column Types</a></li><li><a href="#write-ahead-logging-(wal)">Write-Ahead Logging (WAL)</a></li><li><a href="#javascript-support">JavaScript Support</a></li><li><a href="#python-support">Python Support</a></li><li><a href="#vs-code-support">VS Code Support</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p><a href="https://www.sqlite.org/?v=1.1.1" rel="noopener" target="_blank">SQLite</a> claims to be &quot;the most used database engine in the world&quot;. It is a relational database implemented in C. It runs on all common operating systems and mobile devices. Its creator, D. Richard Hipp, pronounces it &quot;es queue el ite&quot;.</p><p>Pros of SQLite include:</p><ul><li>open source and free</li><li>no external dependencies</li><li>small code footprint</li><li>zero configuration required</li><li>full SQL support</li><li>databases stored in a single, binary file which makes them easy to back up</li><li>includes a command-line interface (CLI)</li><li>simple API</li><li>atomic transactions</li><li>fast performance</li><li>wide operating system support</li><li>wide programming language support</li><li>targeted at small databases (great for mobile applications)</li><li>supports multiple, concurrent readers</li></ul><p>Cons of SQLite include:</p><ul><li>doesn't support databases larger than 281 terabytes (There are other limits on things like string length, number of columns in a table, and number of tables, but these are all quite high.)</li><li>only supports a single writer (locks entire database during writes) so not good for multi-user applications</li><li>no support for stored procedures</li><li>no built-in data encryption</li></ul><p>See <a href="https://www.sqlite.org/whentouse.html?v=1.1.1" rel="noopener" target="_blank">Appropriate Uses For SQLite</a>. This contains the following advice and much more:</p><ul><li>&quot;Avoid using SQLite in situations where the same database will be accessed directly (without an intervening application server) and simultaneously from many computers over a network.&quot;</li><li>&quot;SQLite supports an unlimited number of simultaneous readers, but it will only allow one writer at any instant in time. For many situations, this is not a problem. Writers queue up. Each application does its database work quickly and moves on, and no lock lasts for more than a few dozen milliseconds. But there are some applications that require more concurrency, and those applications may need to seek a different solution.&quot;</li></ul><h2 id="installing" tabindex="-1">Installing</h2><p>SQLite can be downloaded from <a href="https://www.sqlite.org/download.html?v=1.1.1" rel="noopener" target="_blank">here</a>. In macOS it can be installed using Homebrew by entering <code>brew install sqlite</code>.</p><p>For help, enter <code>sqlite3 --help</code>.</p><h2 id="cli-tool" tabindex="-1">CLI Tool</h2><p>To start the SQLite CLI, enter <code>sqlite3</code> optionally followed by a file path to a database file. This displays a <code>sqlite&gt;</code> prompt where you can enter SQL commands (terminated by a semicolon) and &quot;dot commands&quot; that begin with a period.</p><p>For example, here is a sample session that creates a <code>pets</code> database that contains tables for <code>dogs</code> and <code>cats</code>.</p><pre class="language-text"><code class="language-text">$ sqlite3 pets.db<br>sqlite> create table dogs(id integer primary key autoincrement, name string, breed string, age integer);<br>sqlite> create table cats(id integer primary key autoincrement, name string, breed string, remaining_lives integer);<br>sqlite> .schema (displays the schema for each table)<br>sqlite> insert into dogs (name, breed, age) values('Comet', 'Whippet', 4);<br>sqlite> select * from dogs;<br>sqlite> .exit<br>$ ls *.db</code></pre><p>The file <code>pets.db</code> exist now as long as at least one table was defined.</p><h2 id="file-input" tabindex="-1">File Input</h2><p>SQL commands can be read from a file. For example, if the file <code>schema.txt</code> commands SQL commands then the command <code>sqlite3 demo.db &lt; schema.txt</code> will execute the commands using the database <code>demo.db</code>.</p><h2 id="dot-commands" tabindex="-1">Dot Commands</h2><p>The most commonly used dot commands are described in the following table:</p><table><thead><tr><th>Action</th><th>Command</th></tr></thead><tbody><tr><td>change working directory</td><td><code>.cd {directory}</code></td></tr><tr><td>close current database and open new one</td><td><code>.open {file-path}.db</code></td></tr><tr><td>attach an additional database</td><td><code>attach database &quot;{file-path}&quot; as {name};</code></td></tr><tr><td>list names and paths of attached databases</td><td><code>.databases</code></td></tr><tr><td>list tables in current database</td><td><code>.tables</code></td></tr><tr><td>drop a table</td><td><code>drop table if exists {table-name}</code></td></tr><tr><td>upsert</td><td><code>insert into table-name (col1, col2) values (val1, val2) on conflict(name) do update set col2 = val2;</code></td></tr><tr><td>show database schema</td><td><code>.schema</code></td></tr><tr><td>show table schema</td><td><code>.schema {table-name}</code></td></tr><tr><td>configure showing/hiding # of rows changed by SQL</td><td><code>.changes {on | off}</code></td></tr><tr><td>export table to CSV file</td><td><code>.headers on</code><br><code>.mode csv</code><br><code>.once {file-path}</code><br><code>select * from {table-name}</code><br><code>.system {file-path}</code></td></tr><tr><td>import CSV file into a table</td><td><code>.import {file-path} {table-name}</code></td></tr><tr><td>execute shell command</td><td><code>.shell {command}</code></td></tr><tr><td>show current configuration settings</td><td><code>.show</code></td></tr><tr><td>exit</td><td><code>.exit</code> or <code>.quit</code></td></tr></tbody></table><p>When multiple databases are attached, the tables in all of them are accessible and reporting commands such as <code>.tables</code> report on all the databases.</p><p>By default, output from <code>select</code> statements uses <code>list</code> mode where each record is output on a single line with <code>|</code> characters separating column values.</p><p>Here is an example of <code>list</code> mode output:</p><pre class="language-text"><code class="language-text">Maisey|Treeing Walker Coonhound|11<br>Ramsay|Native American Indian Dog|8</code></pre><p>The <code>.mode {mode}</code> command can be used to change this output. Supported modes include <code>list</code>, <code>csv</code>, <code>line</code>, and <code>column</code>.</p><p>Here is an example of <code>csv</code> mode output:</p><pre class="language-text"><code class="language-text">Maisey,"Treeing Walker Coonhound",11<br>Ramsay,"Native American Indian Dog",8</code></pre><p>Here is an example of <code>line</code> mode output:</p><pre class="language-text"><code class="language-text"> name = Maisey<br>breed = Treeing Walker Coonhound<br>  age = 11<br><br> name = Ramsay<br>breed = Native American Indian Dog<br>  age = 8</code></pre><p>Here is an example of <code>column</code> mode output:</p><pre class="language-text"><code class="language-text">id name   breed                    age<br>-- ------ ------------------------ ---<br>1  Maisey Treeing Walker Coonhound 11<br>2  Ramsay Native American Indian D 8</code></pre><h2 id="column-types" tabindex="-1">Column Types</h2><p>SQLite supports a small set of column types that include:</p><ul><li>integer</li><li>real</li><li>numeric (for boolean, decimal, date, and datetime values)</li><li>text</li><li>blob</li></ul><p>Use the numeric type for boolean values where 0 is false and 1 is true.</p><p>Use the text type for ISO date strings.</p><p>Use the integer type for storing seconds or milliseconds since the epoch (1970-01-01 00:00:00 UTC).</p><h2 id="write-ahead-logging-(wal)" tabindex="-1">Write-Ahead Logging (WAL)</h2><p>By default SQLite performs atomic commits and rollbacks using a &quot;rollback journal&quot;. At any point in time there is either one writer or none. In WAL mode, readers block the single writer and the writer block readers.</p><p>WAL is a new option that is significantly faster. Readers and the writer no longer block each other.</p><p>Some of the disadvantages of WAL include:</p><ul><li>The virtual file system must support shared-memory primitives, so WAL is not an option on every computer.</li><li>All processes that access the database must run on the same computer as the database.</li></ul><p>To enable WAL mode, start the server as follows:</p><pre class="language-bash"><code class="language-bash">sqlite3 <span class="token punctuation">{</span>name<span class="token punctuation">}</span>.db <span class="token string">'PRAGMA journal_mode=WAL;'</span></code></pre><p>For more detail, see <a href="https://www.sqlite.org/wal.html?v=1.1.1" rel="noopener" target="_blank">Write-Ahead Logging</a>.</p><h2 id="javascript-support" tabindex="-1">JavaScript Support</h2><p>There are many client libraries in npm for working with SQLite databases. A recommended library is <a href="https://github.com/JoshuaWise/better-sqlite3?v=1.1.1" rel="noopener" target="_blank">better-sqlite3</a>. To install this, enter <code>npm install better-sqlite3</code>. To use TypeScript types, enter <code>npm install @types/better-sqlite3</code>.</p><p>The example code below demonstrates using this with TypeScript.</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> sqlite <span class="token keyword">from</span> <span class="token string">'better-sqlite3'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> type <span class="token punctuation">{</span>RunResult<span class="token punctuation">,</span> Statement<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'better-sqlite3'</span><span class="token punctuation">;</span><br><br><span class="token comment">// Open existing database file or creating if missing.</span><br><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">sqlite</span><span class="token punctuation">(</span><span class="token string">'gift-track.db'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// This pragma must be enabled in order to</span><br><span class="token comment">// check foreign key constraints and perform cascading deletes.</span><br>db<span class="token punctuation">.</span><span class="token function">pragma</span><span class="token punctuation">(</span><span class="token string">'foreign_key = true'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Delete the tables if they already exist.</span><br>db<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'drop table if exists gifts'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>db<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'drop table if exists people'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>db<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'drop table if exists occasions'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Create tables.</span><br><br>db<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><br>  <span class="token string">'create table people ('</span> <span class="token operator">+</span><br>    <span class="token string">'id integer primary key autoincrement, '</span> <span class="token operator">+</span><br>    <span class="token string">'name string, '</span> <span class="token operator">+</span><br>    <span class="token string">'month integer, '</span> <span class="token operator">+</span><br>    <span class="token string">'day integer, '</span> <span class="token operator">+</span><br>    <span class="token string">'year integer, '</span> <span class="token operator">+</span><br>    <span class="token string">'unique (name collate nocase))'</span> <span class="token comment">// case insensitive</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>db<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><br>  <span class="token string">'create table occasions ('</span> <span class="token operator">+</span><br>    <span class="token string">'id integer primary key autoincrement, '</span> <span class="token operator">+</span><br>    <span class="token string">'name string, '</span> <span class="token operator">+</span><br>    <span class="token string">'month integer, '</span> <span class="token operator">+</span><br>    <span class="token string">'day integer, '</span> <span class="token operator">+</span><br>    <span class="token string">'year integer, '</span> <span class="token operator">+</span><br>    <span class="token string">'unique (name collate nocase))'</span> <span class="token comment">// case insensitive</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>db<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><br>  <span class="token string">'create table gifts ('</span> <span class="token operator">+</span><br>    <span class="token string">'id integer primary key autoincrement, '</span> <span class="token operator">+</span><br>    <span class="token string">'description string, '</span> <span class="token operator">+</span><br>    <span class="token string">'location string, '</span> <span class="token operator">+</span><br>    <span class="token string">'name string, '</span> <span class="token operator">+</span><br>    <span class="token string">'occasionId integer, '</span> <span class="token operator">+</span><br>    <span class="token string">'personId integer, '</span> <span class="token operator">+</span><br>    <span class="token string">'price numeric, '</span> <span class="token operator">+</span><br>    <span class="token string">'url string, '</span> <span class="token operator">+</span><br>    <span class="token string">'unique (name collate nocase), '</span> <span class="token operator">+</span> <span class="token comment">// case insensitive</span><br>    <span class="token comment">// If an occasion is deleted, also delete gifts associated with it.</span><br>    <span class="token string">'constraint fk_occasion foreign key '</span> <span class="token operator">+</span><br>    <span class="token string">'  (occasionId) references occasions(id) on delete cascade '</span> <span class="token operator">+</span><br>    <span class="token comment">// If a person is deleted, also delete gifts their gifts.</span><br>    <span class="token string">'constraint fk_person foreign key '</span> <span class="token operator">+</span><br>    <span class="token string">'  (personId) references people(id) on delete cascade '</span> <span class="token operator">+</span><br>    <span class="token string">')'</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Create prepared statements.</span><br><br>insertPersonPS <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><br>  <span class="token string">'insert into people (name, month, day, year) values (?, ?, ?, ?)'</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span><br>getAllPeoplePS <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string">'select * from people'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>getPersonPS <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string">'select * from people where id = ?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>updatePersonPS <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><br>  <span class="token string">'update people set name=?, month=?, day=?, year=? where id = ?'</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span><br>deletePersonPS <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string">'delete from people where id = ?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Execute prepared statements.</span><br><br>type Person <span class="token operator">=</span> <span class="token punctuation">{</span><br>  id<span class="token operator">?</span><span class="token operator">:</span> number<span class="token punctuation">;</span><br>  <span class="token literal-property property">name</span><span class="token operator">:</span> string<span class="token punctuation">;</span><br>  month<span class="token operator">?</span><span class="token operator">:</span> number<span class="token punctuation">;</span><br>  day<span class="token operator">?</span><span class="token operator">:</span> number<span class="token punctuation">;</span><br>  year<span class="token operator">?</span><span class="token operator">:</span> number<span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token comment">// Insert a person.</span><br><span class="token keyword">const</span> <span class="token literal-property property">person</span><span class="token operator">:</span> Person <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Mark'</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">month</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">day</span><span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">year</span><span class="token operator">:</span> <span class="token number">1961</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">try</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token literal-property property">result</span><span class="token operator">:</span> RunResult <span class="token operator">=</span> insertPersonPS<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span> <span class="token comment">// synchronous</span><br>    person<span class="token punctuation">.</span>name<span class="token punctuation">,</span><br>    person<span class="token punctuation">.</span>month<span class="token punctuation">,</span><br>    person<span class="token punctuation">.</span>day<span class="token punctuation">,</span><br>    person<span class="token punctuation">.</span>year<br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  person<span class="token punctuation">.</span>id <span class="token operator">=</span> result<span class="token punctuation">.</span>lastInsertRowid <span class="token keyword">as</span> number<span class="token punctuation">;</span><br><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> isDuplicate <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'UNIQUE constraint failed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">throw</span> isDuplicate<br>    <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'duplicate person name '</span> <span class="token operator">+</span> person<span class="token punctuation">.</span>name<span class="token punctuation">)</span><br>    <span class="token operator">:</span> e<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Get all the people.</span><br><span class="token keyword">const</span> people <span class="token operator">=</span> <span class="token punctuation">(</span>getAllPeoplePS<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> unknown<span class="token punctuation">)</span> <span class="token keyword">as</span> Person<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br><span class="token comment">// Update a person.</span><br>updatePersonPS<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><br>  person<span class="token punctuation">.</span>name<span class="token punctuation">,</span><br>  person<span class="token punctuation">.</span>month<span class="token punctuation">,</span><br>  person<span class="token punctuation">.</span>day<span class="token punctuation">,</span><br>  person<span class="token punctuation">.</span>year<span class="token punctuation">,</span><br>  person<span class="token punctuation">.</span>id<br><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Delete a person.</span><br>deletePersonPS<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="python-support" tabindex="-1">Python Support</h2><p>Python has built-in support for SQLite. For details, see <a href="/blog/python/sqlite-in-python/">here</a>.</p><h2 id="vs-code-support" tabindex="-1">VS Code Support</h2><p>See the VS Code extension <a href="https://marketplace.visualstudio.com/items?itemName=alexcvzz.vscode-sqlite?v=1.1.1" rel="noopener" target="_blank">SQLite</a>. To use this:</p><ul><li>Open the Command Palette and enter &quot;SQLite: Open Database&quot;.</li><li>Select a database from the drop-down list.</li><li>In the Explorer view, expand the &quot;SQLite Explorer&quot; section.</li><li>Select a database to see a list of tables inside it.</li><li>Select a table to see its column names and types.</li><li>Click the triangle to the right a table name to see the rows inside it.</li><li>Click one of the buttons in the upper-right to export the table data as CSV, HTML, or JSON.</li><li>Click the new document icon in the &quot;SQLite Explorer&quot; section to enter a query.</li><li>Open the Command Palette and enter &quot;SQLite: Run Query&quot; to run the query.</li></ul></article>