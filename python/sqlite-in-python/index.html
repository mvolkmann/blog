<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>SQLite in Python</h2><aside></aside><article><p>For details on SQLite, see <a href="/blog/sqlite">here</a>.</p><p>Python has built-in support for <a href="https://www.sqlite.org/?v=1.0.16" rel="noopener" target="_blank">SQLite</a> databases provided by the package <code>sqlite3</code>. Here is an example program that performs many common operations.</p><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> sqlite3  <span class="token comment"># included with Python</span><br><br><span class="token comment"># Connect to a database and create it if it doesn't exist.</span><br><span class="token comment"># The database is in a binary file and is not human-readable.</span><br>conn <span class="token operator">=</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'pets.db'</span><span class="token punctuation">)</span><br><br><span class="token comment"># All database operations occur on a cursor.</span><br>c <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span><br><br><span class="token comment"># Uncomment this to start with an empty table.</span><br>c<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'drop table if exists dogs'</span><span class="token punctuation">)</span><br><br><span class="token comment"># Create a table.</span><br><span class="token comment"># An object id column named "oid" is automatically added.</span><br>c<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''<br>    create table if not exists dogs (<br>      name text,<br>      breed text,<br>      age integer<br>    )<br>'''</span><span class="token punctuation">)</span><br><br><span class="token keyword">def</span> <span class="token function">add_dog</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span><span class="token punctuation">:</span><br>    <span class="token comment"># Names preceded by a colon are keys in</span><br>    <span class="token comment"># the dict passed as the second argument.</span><br>    <span class="token comment"># The value of the "oid" column is auto-incremented.</span><br>    c<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'insert into dogs values (:name, :breed, :age)'</span><span class="token punctuation">,</span> dog<span class="token punctuation">)</span><br><br><span class="token keyword">def</span> <span class="token function">get_dogs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><br>    <span class="token comment"># Selecting * does not get the "oid" column.</span><br>    <span class="token comment"># It must be explicitly requested.</span><br>    c<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'select *, oid from dogs'</span><span class="token punctuation">)</span><br>    <span class="token keyword">return</span> c<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># returns list of tuples, one per record</span><br><br><span class="token keyword">def</span> <span class="token function">print_dogs</span><span class="token punctuation">(</span>label<span class="token punctuation">,</span> dogs<span class="token punctuation">)</span><span class="token punctuation">:</span><br>    <span class="token keyword">print</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><br>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span><span class="token punctuation">:</span><br>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">'Name'</span><span class="token punctuation">:</span><span class="token format-spec">12</span><span class="token punctuation">}</span></span><span class="token string">  </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">'Breed'</span><span class="token punctuation">:</span><span class="token format-spec">30</span><span class="token punctuation">}</span></span><span class="token string">  </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">'Age'</span><span class="token punctuation">:</span><span class="token format-spec">3</span><span class="token punctuation">}</span></span><span class="token string">  </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">'OID'</span><span class="token punctuation">:</span><span class="token format-spec">3</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><br>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">'-'</span><span class="token operator">*</span><span class="token number">12</span><span class="token punctuation">:</span><span class="token format-spec">12</span><span class="token punctuation">}</span></span><span class="token string">  </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">'-'</span><span class="token operator">*</span><span class="token number">30</span><span class="token punctuation">:</span><span class="token format-spec">30</span><span class="token punctuation">}</span></span><span class="token string">  </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">'-'</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token format-spec">3</span><span class="token punctuation">}</span></span><span class="token string">  </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">'-'</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token format-spec">3</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><br>        <span class="token keyword">for</span> dog <span class="token keyword">in</span> dogs<span class="token punctuation">:</span><br>            name<span class="token punctuation">,</span> breed<span class="token punctuation">,</span> age<span class="token punctuation">,</span> oid <span class="token operator">=</span> dog<br>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'  </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token format-spec">12</span><span class="token punctuation">}</span></span><span class="token string">  </span><span class="token interpolation"><span class="token punctuation">{</span>breed<span class="token punctuation">:</span><span class="token format-spec">30</span><span class="token punctuation">}</span></span><span class="token string">  </span><span class="token interpolation"><span class="token punctuation">{</span>age<span class="token punctuation">:</span><span class="token format-spec">3</span><span class="token punctuation">}</span></span><span class="token string">  </span><span class="token interpolation"><span class="token punctuation">{</span>oid<span class="token punctuation">:</span><span class="token format-spec">3</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><br>    <span class="token keyword">else</span><span class="token punctuation">:</span><br>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'  empty'</span><span class="token punctuation">)</span><br>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>dogs <span class="token operator">=</span> get_dogs<span class="token punctuation">(</span><span class="token punctuation">)</span><br>print_dogs<span class="token punctuation">(</span><span class="token string">'initial dogs'</span><span class="token punctuation">,</span> dogs<span class="token punctuation">)</span><br><br><span class="token comment"># If the table is empty, add some rows.</span><br><span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span><br>    add_dog<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Maisey'</span><span class="token punctuation">,</span> <span class="token string">'breed'</span><span class="token punctuation">:</span> <span class="token string">'Treeing Walker Coonhound'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">11</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br>    add_dog<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Ramsay'</span><span class="token punctuation">,</span> <span class="token string">'breed'</span><span class="token punctuation">:</span> <span class="token string">'Native American Indian Dog'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br>    add_dog<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Oscar'</span><span class="token punctuation">,</span> <span class="token string">'breed'</span><span class="token punctuation">:</span> <span class="token string">'German Shorthaired Pointer'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br>    add_dog<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Comet'</span><span class="token punctuation">,</span> <span class="token string">'breed'</span><span class="token punctuation">:</span> <span class="token string">'Whippet'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br>    print_dogs<span class="token punctuation">(</span><span class="token string">'dogs after inserts'</span><span class="token punctuation">,</span> get_dogs<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><br><span class="token comment"># Get the oid for Oscar.</span><br>c<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'select oid from dogs where name="Oscar"'</span><span class="token punctuation">)</span><br><span class="token builtin">tuple</span> <span class="token operator">=</span> c<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># returns tuple where first element is oid</span><br><span class="token keyword">if</span> <span class="token builtin">tuple</span> <span class="token operator">!=</span> <span class="token boolean">None</span><span class="token punctuation">:</span>  <span class="token comment"># If None is returned, Oscar was not found.</span><br>    oid <span class="token operator">=</span> <span class="token builtin">tuple</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><br>    <span class="token comment"># Update Oscar's name and age.</span><br>    c<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'update dogs set name="Oscar Wilde", age=4 where oid='</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>oid<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    print_dogs<span class="token punctuation">(</span><span class="token string">'dogs after update'</span><span class="token punctuation">,</span> get_dogs<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><br>    <span class="token comment"># Delete Oscar.</span><br>    c<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'delete from dogs where oid='</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>oid<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    print_dogs<span class="token punctuation">(</span><span class="token string">'dogs after delete'</span><span class="token punctuation">,</span> get_dogs<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><br>conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># saves changes</span><br>conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></article>