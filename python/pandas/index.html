<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>pandas library</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#abbreviations">Abbreviations</a></li><li><a href="#loading-data">Loading Data</a></li><li><a href="#data-types">Data Types</a></li><li><a href="#getting-data">Getting Data</a></li><li><a href="#modifying-data">Modifying Data</a></li><li><a href="#creating-new-dataframes">Creating New DataFrames</a></li><li><a href="#aggregating-data">Aggregating Data</a></li><li><a href="#writing-data">Writing Data</a></li><li><a href="#creating-other-representations">Creating Other Representations</a></li><li><a href="#processing-large-datasets">Processing Large Datasets</a></li><li><a href="#outstanding-questions">Outstanding Questions</a></li></ol></nav></aside><article><h2 id="overview">Overview</h2><p><a href="https://pandas.pydata.org/?v={{pkg.version}}" rel="noopener" target="_blank">pandas</a> is a Python library for data analysis. For details, see the <a href="https://pandas.pydata.org/docs/reference/?v={{pkg.version}}" rel="noopener" target="_blank">API Reference</a>.</p><p>To install pandas, enter <code>pip install pandas</code>. To see the version that is installed, print <code>pd.__version__</code>. To see the version of pandas, all of its dependencies, and more, enter <code>pd.show_versions()</code> in a Python environment.</p><p>To import the pandas library, use <code>import pandas as pd</code>. By convention, &quot;pd&quot; is the name used to refer to the library in code.</p><p>Pandas provides two primary data structures. The <code>Series</code> class is used to represent a series of data values and can be thought of as a single-column spreadsheet. The <code>DataFrame</code> class is used to represent a table of data values and can be thought of as a multi-column spreadsheet. <code>DataFrame</code> objects hold their data in a collection of <code>Series</code> objects.</p><p>While <code>Series</code> and <code>DataFrame</code> objects do not store their data in a Numpy array, a NumPy array can easily be created from them using their <code>to_numpy</code> methods. <code>Series</code> and <code>DataFrame</code> objects can be created from a NumPy array by invoking their constructors with the <code>data</code> argument set to a NumPy array.</p><h2 id="abbreviations">Abbreviations</h2><p>In the tables that follow, some abbreviations are used for arguments.</p><ul><li>Column name values below are abbreviated as <code>cn</code>.</li><li>Row index values below are abbreviated as <code>ri</code>.</li><li>Column index values below are abbreviated as <code>ci</code>.</li><li>Row start indexes (<code>rsi</code>) and column start indexes (<code>csi</code>) are inclusive and default to zero.</li><li>Row end indexes (<code>rei</code>) and column end indexes (<code>cei</code>) are exclusive and default to length.</li></ul><h2 id="loading-data">Loading Data</h2><p>A <code>DataFrame</code> can be created from many sources.</p><p>To create a <code>DataFrame</code> from a Python list of dict objects:</p><pre class="language-python"><code class="language-python">dogs_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Maisey'</span><span class="token punctuation">,</span> <span class="token string">'breed'</span><span class="token punctuation">:</span> <span class="token string">'Treeing Walker Coonhound'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Oscar'</span><span class="token punctuation">,</span> <span class="token string">'breed'</span><span class="token punctuation">:</span> <span class="token string">'German Shorthaired Pointer'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Ramsay'</span><span class="token punctuation">,</span> <span class="token string">'breed'</span><span class="token punctuation">:</span> <span class="token string">'Native American Indian Dog'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Comet'</span><span class="token punctuation">,</span> <span class="token string">'breed'</span><span class="token punctuation">:</span> <span class="token string">'Whippet'</span><span class="token punctuation">}</span><br><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><p>To create a <code>DataFrame</code> from a CSV file</p><pre class="language-python"><code class="language-python"><span class="token comment"># If the first line contains column names ...</span><br>df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'file-name.csv'</span><span class="token punctuation">)</span> <span class="token comment"># from comma-separated</span><br>df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'file-name.csv'</span><span class="token punctuation">,</span> delimiter<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">)</span> <span class="token comment"># for tab-separate</span><br><br><span class="token comment"># If the first line contains data rather than column names ...</span><br>df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'file-name.csv'</span><span class="token punctuation">,</span> names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'colName1'</span><span class="token punctuation">,</span> <span class="token string">'colName2'</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br><br><span class="token comment"># Read only specific columns ...</span><br>df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'file-name.csv'</span><span class="token punctuation">,</span> usecols<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'cn1'</span><span class="token punctuation">,</span> <span class="token string">'cn2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br><br><span class="token comment"># Specify data types for some columns ...</span><br>df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'file-name.csv'</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'cn1'</span><span class="token punctuation">:</span> <span class="token string">'type1'</span><span class="token punctuation">,</span> <span class="token string">'cn2'</span><span class="token punctuation">:</span> <span class="token string">'type2'</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token comment"># A common type is 'category'.</span></code></pre><p>To create a <code>DataFrame</code> from an Excel spreadsheet:</p><pre class="language-python"><code class="language-python">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'file-name.xlsx'</span><span class="token punctuation">,</span> sheet_name<span class="token operator">=</span><span class="token string">'name'</span><span class="token punctuation">)</span></code></pre><p>To create a <code>DataFrame</code> from clipboard contents, such as copying from a selected Excel or Numbers range:</p><pre class="language-python"><code class="language-python">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_clipboard<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>To create a <code>DataFrame</code> from a NumPy array:</p><pre class="language-python"><code class="language-python">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>data<span class="token operator">=</span>numpy_array<span class="token punctuation">)</span></code></pre><h2 id="data-types">Data Types</h2><p>When pandas creates <code>Series</code> and <code>DataFrame</code> objects from Python data it converts Python string and number types to its own types.</p><table><thead><tr><th>Python type</th><th>pandas type</th></tr></thead><tbody><tr><td>str</td><td>object</td></tr><tr><td>int</td><td>int64</td></tr><tr><td>float</td><td>float64</td></tr></tbody></table><p>For more detail, see <a href="https://pbpython.com/pandas_dtypes.html?v={{pkg.version}}" rel="noopener" target="_blank">Overview of Pandas Data Types</a>.</p><h2 id="getting-data">Getting Data</h2><p>Note that these just return data. To print it, pass the result to the <code>print</code> function.</p><table><thead><tr><th>Operation</th><th>Code</th></tr></thead><tbody><tr><td>get column names</td><td><code>df.columns</code></td></tr><tr><td>get column names as a list</td><td><code>list(df.columns)</code></td></tr><tr><td>get column data types</td><td><code>df.dtypes</code></td></tr><tr><td>get cell value</td><td><code>df.at[ri, cn]</code> or <code>df.iloc[ri, ci]</code></td></tr><tr><td>get all rows <sub><a href="#fn1">1</a></sub></td><td><code>df</code></td></tr><tr><td>get first n rows</td><td><code>df.head(n)</code> where n defaults to 5</td></tr><tr><td>get last n rows</td><td><code>df.tail(n)</code> where n defaults to 5</td></tr><tr><td>get one row</td><td><code>df.iloc[ri]</code></td></tr><tr><td>get row range with all columns</td><td><code>df[rsi:rei]</code> or <code>df.iloc[rsi:rei]</code></td></tr><tr><td>get row range with a subset of columns by name</td><td><code>df.iloc[rsi:rei, ['cn1', 'cn2', ...]]</code></td></tr><tr><td>get row range with a subset of columns by index range</td><td><code>df.iloc[rsi:rei, csi:cei]</code></td></tr><tr><td>get row range with a subset of columns by index list</td><td><code>df.iloc[rsi:rei, [ci1, ci2, ...]]</code></td></tr><tr><td>get row index values</td><td><code>df.index</code></td></tr><tr><td>get one column as a <code>Series</code> object</td><td><code>df.cn</code> or <code>df[cn]</code></td></tr><tr><td>get one column of specified rows</td><td><code>df[col_name][rsi:rei]</code></td></tr><tr><td>get multiple columns in specified order</td><td><code>df[[cn1, cn2, ...]]</code></td></tr><tr><td>get rows matching criteria</td><td><code>df.loc[criteria]</code></td></tr><tr><td>get statistics of numeric columns<br>including count, min, max, mean, and std</td><td><code>df.describe()</code></td></tr><tr><td>display <code>DataFrame</code> memory usage</td><td><code>df.info(memory_usage='deep')</code></td></tr></tbody></table><p><a name="fn1">1</a>: By default the number of rows displayed is limited. To remove the limit <code>pd.set_option('display.max_rows', None)</code>.</p><p>Criteria use logical operators like <code>==</code>, <code>!=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, and <code>&gt;</code>. Criteria can also use bitwise operators for and (<code>&amp;</code>), or (<code>|</code>), and not (<code>~</code>).</p><p>The example below gets all rows where the <code>name</code> column contains the letter &quot;a&quot; and the <code>breed</code> column consists of three words.</p><pre class="language-python"><code class="language-python">df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>df<span class="token punctuation">.</span>breed<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre><p>In the code above, <code>df.breed.str.split(' ')</code> returns a <code>Series</code> object. The <code>Series</code> <code>apply</code> method creates a new <code>Series</code> that contains the results of calling the <code>len</code> function on each value in the original <code>Series</code>.</p><p>The example below gets all rows where the <code>breed</code> column does not contain the word &quot;Dog&quot;.</p><pre class="language-python"><code class="language-python">df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token operator">~</span>df<span class="token punctuation">.</span>breed<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token string">'Dog'</span><span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre><p>The example below uses a regular expression to get rows where the breed starts with &quot;w&quot; or &quot;W&quot; (case insensitive).</p><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> re<br>df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df<span class="token punctuation">.</span>breed<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token string">'^W'</span><span class="token punctuation">,</span> regex<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> flags<span class="token operator">=</span>re<span class="token punctuation">.</span>I<span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre><p>The example below gets all rows where the <code>breed</code> column value is &quot;Vizsla&quot; or &quot;Weimaraner&quot;.</p><pre class="language-python"><code class="language-python">df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df<span class="token punctuation">.</span>breed<span class="token punctuation">.</span>isin<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Vizsla'</span><span class="token punctuation">,</span> <span class="token string">'Weimaraner'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><p>Lookups by a specific column can be made faster by setting that column as the index. This changes the column to no longer be seen as a normal column. For example:</p><pre class="language-python"><code class="language-python">df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><br>start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># to show that lookup by index is faster</span><br>dog <span class="token operator">=</span> df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">'Comet'</span><span class="token punctuation">]</span><br><span class="token comment"># When the "name" column is not the index, do the lookup this way.</span><br><span class="token comment">#dog = df[df['name'] == 'Comet']</span><br>end <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'elapsed ='</span><span class="token punctuation">,</span> end <span class="token operator">-</span> start<span class="token punctuation">)</span></code></pre><p>To treat <code>Series</code> values as strings, add <code>.str</code>. For example, <code>df.name.str</code>.</p><p>To iterate over all rows:</p><pre class="language-python"><code class="language-python"><span class="token keyword">for</span> index<span class="token punctuation">,</span> row <span class="token keyword">in</span> df<span class="token punctuation">.</span>iterrows<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><br>    <span class="token comment"># Use index and row (a Series object) here.</span></code></pre><h2 id="modifying-data">Modifying Data</h2><table><thead><tr><th>Operation</th><th>Code</th></tr></thead><tbody><tr><td>set cell value by column name</td><td><code>df.at[ri, cn] = value</code></td></tr><tr><td>set cell value by column index</td><td><code>df.iat[ri, ci] = value</code></td></tr><tr><td>conditionally set cell value</td><td><code>df.loc[criteria, cn] = value</code></td></tr><tr><td>conditionally set multiple cell values</td><td><code>df.loc[criteria, [cn1, cn2]] = [value1, value2]</code></td></tr><tr><td>add column computed from others</td><td><code>df['new_cn'] = expression</code></td></tr><tr><td>add column that is sum of others <sub><a href="#fn2">2</a></sub></td><td><code>df['my sum'] = df.iloc[:, si:ei].sum(axis=1)</code></td></tr><tr><td>delete columns</td><td><code>df = df.drop(columns=['cn1', 'cn2', ...])</code></td></tr><tr><td>delete columns and ignore errors if not present</td><td><code>df = df.drop(columns=['cn1', 'cn2', ...], errors='ignore')</code></td></tr><tr><td>reorder and remove columns</td><td><code>df = df[['cn1', 'cn2', ...]]</code></td></tr><tr><td>rename specific columns</td><td><code>df = df.rename({'old-cn1': 'new-cn1', ...}, axis='columns')</code></td></tr><tr><td>rename all columns (must specify all names)</td><td><code>df.columns = cn1, cn2, ...</code></td></tr><tr><td>convert strings to numbers in a column <sub><a href="#fn3">3</a></sub></td><td><code>df.cn = pd.to_numeric(df.cn, errors='coerce').fillna(0, downcast='infer')</code></td></tr><tr><td>convert strings to numbers in all columns</td><td><code>df = df.apply(pd.to_numeric, errors='coerce').fillna(0, downcast='infer')</code></td></tr></tbody></table><p><a name="fn2">2</a>: The first slice (colon) with no number on either side means &quot;all rows&quot;. The second slice specifies a column range. Specifying <code>axis=1</code> means horizontal and <code>axis=0</code> means vertical.</p><p><a name="fn3">3</a>: <code>errors='coerce'</code> changes non-numeric strings to NaN and <code>.fillna(0)</code> changes NaN values to zero.</p><p>Suppose we want to change the &quot;name&quot; column value to be uppercase for all rows where the &quot;breed&quot; column value is &quot;Whippet&quot;.</p><pre class="language-python"><code class="language-python">df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df<span class="token punctuation">.</span>breed <span class="token operator">==</span> <span class="token string">'Whippet'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>Suppose we want to add a column named &quot;name length&quot; that holds the length of each &quot;name&quot; value.</p><pre class="language-python"><code class="language-python">df<span class="token punctuation">[</span><span class="token string">'name length'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">)</span></code></pre><p>Suppose we have the columns <code>width</code>, <code>depth</code>, and <code>height</code> that represent refrigerator dimensions and we want to add a new <code>volume</code> column.</p><pre class="language-python"><code class="language-python">df<span class="token punctuation">[</span><span class="token string">'volume'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">.</span>width <span class="token operator">*</span> df<span class="token punctuation">.</span>depth <span class="token operator">*</span> df<span class="token punctuation">.</span>height</code></pre><h2 id="creating-new-dataframes">Creating New DataFrames</h2><p>When a new <code>DataFrame</code> is created from an existing one the new one shares memory with original. So changes to the underlying data affect both <code>DataFrame</code>s.</p><p>By default new <code>DataFrame</code>s retain the same index values at the original. To reset the index values, <code>new_df = new_df.reset_index(drop=True)</code> or <code>new_df.reset_index(drop=True, inplace=True)</code>. Including <code>drop=True</code> removes the original index column.</p><table><thead><tr><th>Operation</th><th>Code</th></tr></thead><tbody><tr><td>change column datatype <sub><a href="#fn4">4</a></sub></td><td><code>df = df['cn'].astype(type)</code></td></tr><tr><td>sort on one column</td><td><code>df.sort_values('cn', ascending=Bool)</code></td></tr><tr><td>sort on multiple columns</td><td><code>df.sort_values(['cn1', 'cn2'], ascending=[Bool1, Bool2])</code></td></tr><tr><td>transpose</td><td><code>df.T</code></td></tr></tbody></table><p><a name="fn4">4</a>: When the values of a column can be used to segregate rows into categories and the number of distinct categories is small compared to the number of rows, set the type to 'category'. This allows the data to be stored more efficiently because those column values can be replaced internally with integers. It also supports custom sort orders such as 'small' &lt; 'medium' &lt; 'large'.</p><p>To sort in place, add <code>inplace=True</code>.</p><h2 id="aggregating-data">Aggregating Data</h2><p>The <code>DataFrame</code> <code>groupby</code> method is used to aggregate data. It automatically sorts groups alphabetically. Statistics are often computed from the aggregated data using the methods <code>count</code>, <code>sum</code>, and <code>mean</code>.</p><p>For example, suppose we have a <code>DataFrame</code> where each row represents a dog and the columns are &quot;name&quot;, &quot;breed&quot;, and &quot;weight&quot;. We can find the number of dogs from each breed and the average weight of each breed as follows.</p><pre class="language-python"><code class="language-python"><span class="token comment"># Group data by breed and compute the</span><br><span class="token comment"># mean of every numeric column within each breed.</span><br>df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'breed'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><br><br><span class="token comment"># Group data by breed and compute the</span><br><span class="token comment"># mean of only the "weight" column within each breed.</span><br>df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'breed'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'weight'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>df<span class="token punctuation">[</span><span class="token string">'count'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment"># create new column to hold counts</span><br><span class="token comment"># Group data by breed and compute the count of each breed.</span><br>df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'breed'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'count'</span><span class="token punctuation">]</span></code></pre><p>We can aggregate across multiple columns. For example:</p><pre class="language-python"><code class="language-python">players <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><span class="token string">'sport'</span><span class="token punctuation">:</span> <span class="token string">'hockey'</span><span class="token punctuation">,</span> <span class="token string">'team'</span><span class="token punctuation">:</span> <span class="token string">'Oilers'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Wayne Gretzky'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><span class="token string">'sport'</span><span class="token punctuation">:</span> <span class="token string">'hockey'</span><span class="token punctuation">,</span> <span class="token string">'team'</span><span class="token punctuation">:</span> <span class="token string">'Oilers'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Marty McSorley'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><span class="token string">'sport'</span><span class="token punctuation">:</span> <span class="token string">'hockey'</span><span class="token punctuation">,</span> <span class="token string">'team'</span><span class="token punctuation">:</span> <span class="token string">'Oilers'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Grant Fuhr'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><span class="token string">'sport'</span><span class="token punctuation">:</span> <span class="token string">'hockey'</span><span class="token punctuation">,</span> <span class="token string">'team'</span><span class="token punctuation">:</span> <span class="token string">'Bruins'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Phil Esposito'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><span class="token string">'sport'</span><span class="token punctuation">:</span> <span class="token string">'hockey'</span><span class="token punctuation">,</span> <span class="token string">'team'</span><span class="token punctuation">:</span> <span class="token string">'Bruins'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Bobby Orr'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><span class="token string">'sport'</span><span class="token punctuation">:</span> <span class="token string">'baseball'</span><span class="token punctuation">,</span> <span class="token string">'team'</span><span class="token punctuation">:</span> <span class="token string">'Cardinals'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Bob Gibson'</span><span class="token punctuation">}</span><br><span class="token punctuation">]</span><span class="token punctuation">)</span><br>players<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'sport'</span><span class="token punctuation">,</span> <span class="token string">'team'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>The output is:</p><pre class="language-text"><code class="language-text">   sport      team<br>baseball Cardinals    1<br>hockey   Bruins       2<br>         Oilers       3</code></pre><p>To get the number of players for each team in the <code>DataFrame</code>, use <code>players.team.value_counts()</code> which outputs:</p><pre class="language-text"><code class="language-text">Oilers       3<br>Bruins       2<br>Cardinals    1<br>Name: team, dtype: int64</code></pre><p>To get only the top counts, in this case the top 2, use <code>players.team.value_counts().nlargest(2)</code> which outputs:</p><pre class="language-text"><code class="language-text">Oilers    3<br>Bruins    2<br>Name: team, dtype: int64</code></pre><p>To get all the rows for players on the teams with the highest number of players, use <code>players[players.team.isin(counts.nlargest(2).index)]</code>. This gives all the rows where the team is &quot;Oilers&quot; or &quot;Bruins&quot;.</p><h2 id="writing-data">Writing Data</h2><p>To create a CSV file from a <code>DataFrame</code>:</p><pre class="language-python"><code class="language-python">df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span> <span class="token comment"># comma-separated</span><br>df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token comment"># to omit index column</span><br>df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">)</span> <span class="token comment"># tab-separated</span></code></pre><p>To create an Excel file from a <code>DataFrame</code>:</p><pre class="language-python"><code class="language-python">df<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><br>df<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token comment"># to omit index column</span></code></pre><h2 id="creating-other-representations">Creating Other Representations</h2><table><thead><tr><th>Operation</th><th>Code</th></tr></thead><tbody><tr><td>create NumPy array</td><td><code>df.to_numpy()</code></td></tr></tbody></table><h2 id="processing-large-datasets">Processing Large Datasets</h2><p>Some datasets are too large to fit in memory. One way to work around this limitation is to process the data in chunks of rows. To demonstrate this, we will use data from the <a href="https://www.kaggle.com/tmdb/tmdb-movie-metadata?v={{pkg.version}}" rel="noopener" target="_blank">TMBD 5000 Movie Dataset</a>. This is found at the <a href="https://www.kaggle.com/datasets?v={{pkg.version}}" rel="noopener" target="_blank">Kaggle</a> website which is a good source for public datasets.</p><p>For example:</p><pre class="language-python"><code class="language-python"><span class="token comment"># Create a new, empty DataFrame.</span><br>subset_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">)</span><br><br><span class="token comment"># Process a large CSV file this many rows at a time.</span><br>row_count <span class="token operator">=</span> <span class="token number">100</span><br><span class="token keyword">for</span> df <span class="token keyword">in</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'./movies/tmdb_5000_movies.csv'</span><span class="token punctuation">,</span> chunksize<span class="token operator">=</span>row_count<span class="token punctuation">)</span><span class="token punctuation">:</span><br>    <span class="token comment"># Only keep rows for movies with a high "vote_average".</span><br>    filtered_df <span class="token operator">=</span> df<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'vote_average'</span><span class="token punctuation">]</span> <span class="token operator">>=</span> <span class="token number">8</span><span class="token punctuation">]</span><br>    subset_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>subset_df<span class="token punctuation">,</span> filtered_df<span class="token punctuation">]</span><span class="token punctuation">)</span><br><br><span class="token comment"># Now only the retained rows are available in subset_df</span><br><span class="token comment"># and we can operate on that.</span></code></pre><h2 id="outstanding-questions">Outstanding Questions</h2><ul><li>Is a DataFrame a collection of Series objects?</li><li>Do DataFrame methods always return a new DataFrame?</li><li>Do the new DataFrame objects share Series and cells with ones they were created from?</li></ul></article>