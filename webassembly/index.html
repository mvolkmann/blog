<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>WebAssembly</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a><ol><li><a href="#numeric-instructions">Numeric Instructions</a></li><li><a href="#%3F-instructions">? Instructions</a></li><li><a href="#parametric-instructions">Parametric Instructions</a></li></ol></li><li><a href="#choice-of-programming-language">Choice of Programming Language</a></li><li><a href="#vs-code">VS Code</a></li><li><a href="#text-format">Text Format</a></li><li><a href="#wasm-instructions">WASM Instructions</a></li><li><a href="#variable-instructions">Variable Instructions</a></li><li><a href="#memory-instructions">Memory Instructions</a></li><li><a href="#control-instructions">Control Instructions</a></li><li><a href="#demos">Demos</a></li><li><a href="#wasm-pack">wasm-pack</a></li><li><a href="#ssvmup">ssvmup</a></li></ol></nav></aside><article><h2 id="overview">Overview</h2><p>WebAssembly (abbreviated WASM) is a binary instruction format for a stack-based virtual machine.</p><p>WASM code can be run in modern web browsers including Chrome, Edge, Firefox, and Safari (not Internet Explorer). It can also be run outside of web browsers using WASM3, Wasmtime, or WAMR.</p><p>There are two primary reasons to run WASM code from a web browser. The first is that it typically executes much faster than equivalent code written in JavaScript. The second is that it enables writing code in any language that can be compiled to WASM as an alternative to JavaScript.</p><p>The primary reason to run WASM code outside a web browser is that it enables targeting any platform that supports WASM. This is similar to the rationale for using Java, whose virtual machine is supported by many platforms.</p><p>WASM can also be compiled to native executables that run on x86 and ARM processors.</p><h2 id="choice-of-programming-language">Choice of Programming Language</h2><p>Code from many programming languages can be compiled to WASM. Currently full support is only available for C, C++, and Rust. Experimental support is available for C#, Go, Java, Kotlin, Python, Swift, TypeScript, and a few other less commonly used languages.</p><p>In order to run WASM code in a web browser, the runtime of the source language must be included. Rust is a great choice for targeting WASM because it has a very small runtime compared to options like Python, so it downloads faster. One reason Rust is able to ship a small runtime is that it does not need to include garbage collection code.</p><p>A reason to prefer Rust over languages like C and C++ is that the Rust compiler makes certain kinds of error impossible, such as those related to memory management and access.</p><p>Tools for compiling Rust code to WebAssembly include <a href="https://rustwasm.github.io/wasm-pack/?v=1.0.10" rel="noopener" target="_blank">wasm-pack</a> and <a href="https://www.secondstate.io/articles/ssvmup/?v=1.0.10" rel="noopener" target="_blank">ssvmup</a> The ssvmup tool was inspired by wasm-pack and has explicit support for Deno. Also see the support for Rust in the <a href="https://parceljs.org/rust.html?v=1.0.10" rel="noopener" target="_blank">Parcel bundler</a>!</p><p>From <a href="https://rustwasm.github.io/book/game-of-life/implementing.html?v=1.0.10" rel="noopener" target="_blank">Implementing Conway's Game of Life</a>, &quot;As a general rule of thumb, a good JavaScript/WebAssembly interface design is often one where large, long-lived data structures are implemented as Rust types that live in the WebAssembly linear memory, and are exposed to JavaScript as opaque handles. JavaScript calls exported WebAssembly functions that take these opaque handles, transform their data, perform heavy computations, query the data, and ultimately return a small, copy-able result. By only returning the small result of the computation, we avoid copying and/or serializing everything back and forth between the JavaScript garbage-collected heap and the WebAssembly linear memory.&quot;</p><h2 id="vs-code">VS Code</h2><p>VS Code has several extensions for working with WASM code. The most popular is &quot;WebAssembly&quot; with the description &quot;WebAssembly Toolkit for VSCode&quot;.</p><h2 id="text-format">Text Format</h2><p>WASM has a binary format and a text (intermediate form) format. Files in the binary format have the extension <code>.wasm</code>. Files in the text format have the extension <code>.wat</code>. The text format has two styles, linear and S-expressions. The linear format places instructions on separate lines. The S-expression format uses parentheses, similar to LISP, representing a tree of nodes. The first value in each expression indicates the node type. The remaining values are attributes or child nodes.</p><p>A <code>.wat</code> file can be compile to a <code>.wasm</code> file using the <code>wat2wasm</code> tool. A <code>.wasm</code> file can be de-compiled to a <code>.wat</code> file using the <code>wasm2wat</code> tool. Note that this outputs the linear style. Also see <code>.wast</code> files that are for writing tests.</p><p>It is also possible write code in another language such as Rust and compile it to WASM.</p><p>Every <code>.wat</code> file contains a single, top-level S-expression that defines a module. Modules define sets of functions. Function definitions have the syntax <code>(func {signature} {locals} {body})</code>. The signature defines the function name, its parameter types, and its return type. Locals defines local variable names and types. Body is a list of instructions that implement the function.</p><p>Currently only for types are supported. These match number types from Rust, including <code>i32</code>, <code>i64</code>, <code>f32</code>, and <code>f64</code>. Other types such as strings and structs currently must be serialized into these number types and deserialized from them. Tools such as wasm_bindgen for Rust can do this for you.</p><p>Parameters and local variables are access by their position in the signature (zero-based index), not by name. The <code>local.get {index}</code> instruction gets a value and places it on the stack. To change the value of a local variable, use the instruction <code>(local.set {index} {value})</code>. Function calls get their arguments from the stack. When a function exists, its return value is the top value on the stack.</p><p>In functions that do not return a value, the return type is omitted.</p><p>Here is an example that defines a function that takes two numbers and returns their sum.</p><ol><li>Create the file <code>add.wat</code> containing the following:</li></ol><pre class="language-text"><code class="language-text">(module<br>  (func $add (param $lhs i32) (param $rhs i32) (result i32)<br>    local.get $lhs<br>    local.get $rhs<br>    i32.add)<br>  (export "add" (func $add))<br>)</code></pre><p>To compile this code ...</p><ol><li><p>Install WebAssembly Binary Toolkit (WABT). This includes a set of command line tools including wat2wasm, wasm2wat, wasm-validate, and wasm-interp. In macOS this can be installed using Homebrew by entering <code>brew install wabt</code>.</p></li><li><p>Enter <code>wat2wasm</code> to create the binary file <code>add.wasm</code>.</p></li><li><p>Create the JavaScript file <code>index.js</code> that loads the <code>add.wasm</code> and calls the function it defines:</p></li></ol><pre class="language-js"><code class="language-js">WebAssembly<span class="token punctuation">.</span><span class="token function">instantiateStreaming</span><span class="token punctuation">(</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'add.wasm'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">m</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> sum <span class="token operator">=</span> m<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'sum ='</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'result'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> sum<span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ol><li>Create the HTML file <code>index.html</code> that includes <code>index.js</code>:</li></ol><pre class="language-html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>index.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>sum = <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>result<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><ol><li><p>Start a local HTTP file server.</p></li><li><p>Browse localhost:????.</p></li></ol><p>To call this code from JavaScript running in a web browser ...</p><h2 id="wasm-instructions">WASM Instructions</h2><p>The tables below summarizes the supported WASM instructions. For more detail, see the <a href="https://github.com/sunfishcode/wasm-reference-manual/blob/master/WebAssembly.md?v=1.0.10" rel="noopener" target="_blank">WASM Reference Manual</a>.</p><p>The tables use the following abbreviations for substitutions in instruction names:</p><ul><li><code>mm</code> and <code>nn</code> can be <code>32</code> or <code>64</code></li><li><code>sx</code> can be <code>u</code> or <code>s</code></li></ul><h3 id="numeric-instructions">Numeric Instructions</h3><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code>abs</code></td><td>absolute value</td></tr><tr><td><code>add</code></td><td>add</td></tr><tr><td><code>and</code></td><td>and</td></tr><tr><td><code>ceil</code></td><td>ceiling</td></tr><tr><td><code>clz</code></td><td>count leading zeros</td></tr><tr><td><code>copysign</code></td><td>copy sign</td></tr><tr><td><code>ctz</code></td><td>count training zeros</td></tr><tr><td><code>div_{sx}</code></td><td>divide</td></tr><tr><td><code>div</code></td><td>divide</td></tr><tr><td><code>eq</code></td><td>equal</td></tr><tr><td><code>eqz</code></td><td>equal to zero</td></tr><tr><td><code>floor</code></td><td>floor</td></tr><tr><td><code>ge_{sx}</code></td><td>greater than or equal</td></tr><tr><td><code>ge</code></td><td>greater than or equal</td></tr><tr><td><code>gt_{sx}</code></td><td>greater than</td></tr><tr><td><code>le_{sx}</code></td><td>less than or equal</td></tr><tr><td><code>le</code></td><td>less than or equal</td></tr><tr><td><code>lt_{sx}</code></td><td>less than</td></tr><tr><td><code>max</code></td><td>maximum</td></tr><tr><td><code>min</code></td><td>minimum</td></tr><tr><td><code>mul</code></td><td>multiply</td></tr><tr><td><code>ne</code></td><td>not equal</td></tr><tr><td><code>nearest</code></td><td>round?</td></tr><tr><td><code>neg</code></td><td>negate</td></tr><tr><td><code>or</code></td><td>or</td></tr><tr><td><code>popcnt</code></td><td>population count (# of 1 bits)</td></tr><tr><td><code>rem_{sx}</code></td><td>remainder</td></tr><tr><td><code>rotl</code></td><td>rotate left</td></tr><tr><td><code>rotr</code></td><td>rotate right</td></tr><tr><td><code>shl</code></td><td>shift left</td></tr><tr><td><code>shr_{xx}</code></td><td>shift right</td></tr><tr><td><code>sqrt</code></td><td>square root</td></tr><tr><td><code>sub</code></td><td>subtract</td></tr><tr><td><code>trunc</code></td><td>truncate</td></tr><tr><td><code>xor</code></td><td>exclusive or</td></tr></tbody></table><h3 id="%3F-instructions">? Instructions</h3><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code>convert</code></td><td>convert integer to floating point</td></tr><tr><td><code>demote</code></td><td>demote f64 to f32</td></tr><tr><td><code>extend</code></td><td>?</td></tr><tr><td><code>promote</code></td><td>?</td></tr><tr><td><code>reinterpret</code></td><td>?</td></tr><tr><td><code>trunc_sat</code></td><td>?</td></tr><tr><td><code>trunc</code></td><td>truncate</td></tr><tr><td><code>wrap</code></td><td>?</td></tr></tbody></table><h3 id="parametric-instructions">Parametric Instructions</h3><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code>drop</code></td><td>?</td></tr><tr><td><code>select</code></td><td>?</td></tr></tbody></table><h2 id="variable-instructions">Variable Instructions</h2><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code>local.get {local-id}</code></td><td>get local variable onto stack</td></tr><tr><td><code>local.set {local-id}</code></td><td>set local variable from stack</td></tr><tr><td><code>local.tee {local-id}</code></td><td>?</td></tr><tr><td><code>global.get {local-id}</code></td><td>get global variable onto stack</td></tr><tr><td><code>global.set {local-id}</code></td><td>set global variable from stack</td></tr></tbody></table><h2 id="memory-instructions">Memory Instructions</h2><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code>i{nn}.load {mem}</code></td><td></td></tr><tr><td><code>i{nn}.load8_{sx} {mem}</code></td><td></td></tr><tr><td><code>i{nn}.load16_{sx} {mem}</code></td><td></td></tr><tr><td><code>i64.load32_{sx} {mem}</code></td><td></td></tr><tr><td><code>i{nn}.store {mem}</code></td><td></td></tr><tr><td><code>i{nn}.store8 {mem}</code></td><td></td></tr><tr><td><code>i{nn}.store16 {mem}</code></td><td></td></tr><tr><td><code>i64.store32 {mem}</code></td><td></td></tr><tr><td><code>f{nn}.load {mem}</code></td><td></td></tr><tr><td><code>f{nn}.store {mem}</code></td><td></td></tr><tr><td><code>memory.grow</code></td><td></td></tr><tr><td><code>memory.size</code></td><td></td></tr></tbody></table><h2 id="control-instructions">Control Instructions</h2><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code>nop</code></td><td>no operation</td></tr><tr><td><code>unreachable</code></td><td></td></tr><tr><td><code>block {block-type} {instr}* end</code></td><td>code block</td></tr><tr><td><code>loop {block-type} {instr}* end</code></td><td>loop</td></tr><tr><td><code>if {block-type} {instr}* else {instr}* end</code></td><td>conditional</td></tr><tr><td><code>br {label-id}</code></td><td></td></tr><tr><td><code>br_if {label-id}</code></td><td></td></tr><tr><td><code>br_table vec({label-id}) {label-id}</code></td><td></td></tr><tr><td><code>return</code></td><td>return from function</td></tr><tr><td><code>call {function-id}</code></td><td>call function</td></tr><tr><td><code>call_indirect {type-id}</code></td><td></td></tr><tr><td><code>end</code></td><td>ends a function body, global initialization, element segment, or data segement</td></tr></tbody></table><h2 id="demos">Demos</h2><ul><li><a href="https://github.com/mvolkmann/wasm-bind-demo">https://github.com/mvolkmann/wasm-bind-demo</a></li><li><a href="https://github.com/mvolkmann/wasm-demo">https://github.com/mvolkmann/wasm-demo</a></li><li><a href="https://github.com/mvolkmann/wasm-rust-linear-memory">https://github.com/mvolkmann/wasm-rust-linear-memory</a></li></ul><h2 id="wasm-pack">wasm-pack</h2><p>To install wasm-pack in Linux or macOS, enter the following:</p><pre class="language-bash"><code class="language-bash">cargo <span class="token function">install</span> wasm-pack</code></pre><p>To create a project that uses wasm-pack::</p><ol><li><p><code>wasm-pack new my-wasm</code></p><p>TODO: Describe what this puts in Cargo.toml.</p></li><li><p><code>cd my-wasm</code></p></li><li><p><code>wasm-pack build --target web</code></p><p>TODO: Describe the files this produces.</p></li><li><p>Create the following <code>index.html</code> file:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>WASM Demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>      <span class="token keyword">import</span> <span class="token punctuation">{</span><span class="token keyword">default</span> <span class="token keyword">as</span> wasm<span class="token punctuation">,</span> greet<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./pkg/my_wasm.js'</span><span class="token punctuation">;</span><br>      <span class="token function">wasm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">module</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre></li><li><p>Start a local HTTP file server. There are many ways to do this, including using Deno. TODO: Is there any reason to use wasm-server instead because it supports the WASM MIME type? TODO: Maybe this is no longer an issue. To run a simple Deno HTTP file server:</p><ol><li>Install <a href="https://deno.land/#installation?v=1.0.10" rel="noopener" target="_blank">Deno</a>.</li><li>Enter <code>deno install --allow-net --allow-read https://deno.land/std@0.83.0/http/file_server.ts</code></li><li>Enter <code>file_server .</code></li><li>Browse <code>localhost:4507</code></li></ol></li></ol><h2 id="ssvmup">ssvmup</h2><p>To compile a <code>.rs</code> file to WebAssembly:</p><ol><li><p>Install ssvmup by entering the following command (one time only):</p><pre class="language-bash"><code class="language-bash"><span class="token function">curl</span> https://raw.githubusercontent.com/second-state/ssvmup/master/installer/init.sh -sSf <span class="token operator">|</span> <span class="token function">sh</span></code></pre></li><li><p>Create a new Rust library (referred to as a &quot;crate&quot;) by entering <code>cargo new --lib my-crate</code></p></li><li><p><code>cd my-crate</code></p></li><li><p>Edit <code>src/lib.rs</code> and add code there. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">wasm_bindgen<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span><br><br><span class="token attribute attr-name">#[wasm_bindgen]</span><br><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">factorial</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">u64</span> <span class="token punctuation">{</span><br>    <span class="token keyword">match</span> x <span class="token punctuation">{</span><br>        <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">=></span> <span class="token number">1</span><span class="token punctuation">,</span><br>        _ <span class="token operator">=></span> x <span class="token operator">*</span> <span class="token function">factorial</span><span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Edit the generated <code>Cargo.toml</code> file which is similar to a Node.js <code>package.json</code> file. For example:</p><pre class="language-toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">package</span><span class="token punctuation">]</span><br><span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">"my-crate"</span><br><span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"0.1.0"</span><br><span class="token key property">authors</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"R. Mark Volkmann &lt;me@gmail.com>"</span><span class="token punctuation">]</span><br><span class="token key property">edition</span> <span class="token punctuation">=</span> <span class="token string">"2018"</span><br><span class="token key property">description</span> <span class="token punctuation">=</span> <span class="token string">"sample project using ssvmup"</span><br><span class="token key property">license</span> <span class="token punctuation">=</span> <span class="token string">"MIT/Apache-2.0"</span><br><span class="token comment">#repository = "https://github.com/mvolkmann/my-crate"</span><br><br><span class="token punctuation">[</span><span class="token table class-name">lib</span><span class="token punctuation">]</span><br><span class="token comment"># cdylib exports a C-style interface for a Rust dynamic library.</span><br><span class="token key property">crate-type</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"cdylib"</span><span class="token punctuation">]</span><br><br><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><br><span class="token key property">wasm-bindgen</span> <span class="token punctuation">=</span> <span class="token string">"=0.2.61"</span></code></pre></li><li><p>Enter <code>ssvmup build --target deno</code> This creates a <code>pkg</code> directory containing <code>package.json</code>, a <code>.wasm</code> file, and a <code>.js</code> file that reads the <code>.wasm</code> file and prepares it for use in JavaScript code.</p></li><li><p>Copy the generated <code>pkg</code> directory to the directory containing the Deno code that wishes to use it.</p></li><li><p>Import the exported functions with a line like the following:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>factorial<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./pkg/my_crate.js'</span><span class="token punctuation">;</span></code></pre></li><li><p>Call the imported functions.</p><pre class="language-js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">factorial</span><span class="token punctuation">(</span><span class="token number">4n</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "n" suffix makes it BitInt</span></code></pre></li></ol></article>