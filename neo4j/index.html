<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Neo4j</h2><aside><nav class="toc"><ol><li><a href="#installing">Installing</a></li><li><a href="#neo4j-desktop-application">Neo4j Desktop application</a></li><li><a href="#neo4j-browser-application">Neo4j Browser application</a></li><li><a href="#creating-and-deleting-nodes">Creating and deleting nodes</a></li><li><a href="#creating-and-deleting-edges">Creating and deleting edges</a></li><li><a href="#querying">Querying</a></li><li><a href="#cleaning-up">Cleaning up</a></li><li><a href="#creating-and-restoring-backups">Creating and restoring backups</a></li><li><a href="#accessing-from-a-web-app">Accessing from a web app</a></li></ol></nav></aside><article><p><a href="https://neo4j.com/?v=1.0.17" rel="noopener" target="_blank">Neo4j</a> is a graph database. It was first released in February 2010. There are free and commercial versions. The free version is limited to run on a single node and does not provide hot backups.</p><p>Data is stored as collections of &quot;nodes&quot; that are attached by &quot;edges&quot;. Both nodes and edges can have associated labels and properties. Each node and edge can only have one label which is rendered in diagrams, but they can have any number of properties. Properties can be indexed to support faster searches, but they are not indexed by default. Schemas can optionally be defined to specify the properties that an be specified for each node and edge type.</p><p>Neo4j is implemented in Java, but there are drivers that support accessing Neo4j databases from many programming languages. Officially supported languages include C# (.Net), Go, Java, JavaScript, and Python. Community supported languages include C/C++, Clojure, Erlang, PHP, R, and Ruby.</p><p>&quot;Cypher&quot; is the query language used to obtain data from a Neo4j database. A good summary of Cypher syntax can be found at <a href="https://neo4j.com/docs/cypher-refcard/4.1/?v=1.0.17" rel="noopener" target="_blank">Neo4j Cypher Refcard</a>.</p><p><a href="https://github.com/neo4j-contrib/neovis.js/?v=1.0.17" rel="noopener" target="_blank">neovis.js</a> is a JavaScript library for visualizing the result of Cypher queries in a web browser. It connects to a running Neo4j database instance and renders live data updates. See this <a href="https://github.com/neo4j-contrib/neovis.js/issues/141?v=1.0.17" rel="noopener" target="_blank">issue</a>.</p><h2 id="installing">Installing</h2><p>To install Neo4j:</p><ul><li>Browse <a href="https://neo4j.com/?v=1.0.17" rel="noopener" target="_blank">https://neo4j.com/</a>.</li><li>Click the &quot;GET STARTED&quot; button.</li><li>Click the &quot;Download Neo4j Desktop&quot; button.</li><li>Click the &quot;Download&quot; button.</li><li>Enter the requested information and click the &quot;Download Desktop&quot; button.</li><li>Save the installer file. On macOS, the file name is neo4j-desktop-1.3.10.dmg.</li><li>Save the &quot;Neo4j Desktop Activation Key&quot; that is displayed.</li><li>Double-click the installer file and follow the OS-specific steps.</li></ul><h2 id="neo4j-desktop-application">Neo4j Desktop application</h2><p>To run the Neo4j Desktop application:</p><ul><li>Locate the folder where it was installed.</li><li>Double-click its icon.</li><li>First time only, you will be prompted to paste the &quot;Neo4j Desktop Activation Key&quot;.</li></ul><p><img src="/blog/assets/neo4j-desktop-app.png" alt="Neo4j Desktop app"></p><p>To create a new database:</p><ul><li>Click the large rectangle labeled &quot;+ Add Database&quot;.</li><li>Click &quot;Create a Local Database&quot;.</li><li>Enter a name and password for the database.</li><li>Click the &quot;Create&quot; button.</li></ul><p>To start a database, click its &quot;Start&quot; button.</p><h2 id="neo4j-browser-application">Neo4j Browser application</h2><p>To open a database in a Neo4j Browser window, click its &quot;Open&quot; button in the Neo4j Desktop application. This is somewhat similar to a Jupyter notebook in that it consists of a vertical series of cells into which code can be entered. New code can be entered in the top cell.</p><p><img src="/blog/assets/neo4j-browser.png" alt="Neo4j Browser"></p><p>Icons in the upper-right corner of each cell can be clicked to initiate the following actions:</p><ul><li>save as a favorite (star)</li><li>save as a project file (floppy)</li><li>pin to top (pushpin)</li><li>change to occupy the full screen (opposing arrows)</li><li>collapse to a single line (caret)</li><li>rerun (circle with arrowhead)</li><li>close (X)</li></ul><p><img alt="Neo4j Browser icons" class="keep-size" src="/blog/assets/neo4j-browser-icons.png?v=1.0.17"></p><p>To execute the code in a cell, click the blue play icon (triangle) on the right side of the cell or press ctrl-enter (cmd-return on macOS).</p><h2 id="creating-and-deleting-nodes">Creating and deleting nodes</h2><p>To create nodes in a Neo4j browser window, enter a Cypher command like the following:</p><pre class="language-text"><code class="language-text">create (Mark:Person {name:'Mark Volkmann', born:1961}),<br>  (Tami:Person {name:'Tami Volkmann', born:1961}),<br>  (Amanda:Person {name:'Amanda Nelson', born:1985}),<br>  (Jeremy:Person {name:'Jeremy Volkmann', born:1987});</code></pre><p>This creates four nodes that have the label <code>Person</code> and the properties <code>name</code> and <code>born</code>. The semicolon at the end is only necessary to enter multiple commands in the same cell.</p><p>To view these <code>Person</code> nodes, enter <code>match (p:Person) return p</code>. By default the selected view type is &quot;Graph&quot; which renders a circle for each <code>Person</code> node. Hover over a node to see the values for its <code>id</code>, <code>born</code>, and <code>name</code> properties.</p><p>To view only the <code>Person</code> nodes that are born in 1970 or later, enter the following Cypher command:</p><pre class="language-text"><code class="language-text">match (p:Person)<br>where p.born >= 1970<br>return p;</code></pre><p>To view only the name property of the <code>Person</code> nodes, enter the following Cypher command:</p><pre class="language-text"><code class="language-text">match (person:Person) return person.name</code></pre><p>To delete nodes, enter a Cypher command like the following:</p><pre class="language-text"><code class="language-text">match (p:Person) where p.born &lt; 1980 detach delete p</code></pre><p>To re-run a previous query, possibly with modifications:</p><ul><li>Click the query which copies it to the top cell.</li><li>Optionally modify it.</li><li>Execute it.</li></ul><h2 id="creating-and-deleting-edges">Creating and deleting edges</h2><p>To create edges (relationships) between nodes, enter a Cypher command like the following:</p><pre class="language-text"><code class="language-text">match (Mark:Person{name: 'Mark Volkmann'})<br>match (Tami:Person{name: 'Tami Volkmann'})<br>match (Amanda:Person{name: 'Amanda Nelson'})<br>match (Jeremy:Person{name: 'Jeremy Volkmann'})<br>with Mark, Tami, Amanda, Jeremy<br>create (Mark)-[:married {year:1981}]->(Tami),<br>  (Mark)-[:father]->(Amanda),<br>  (Mark)-[:father]->(Jeremy),<br>  (Tami)-[:mother]->(Amanda),<br>  (Tami)-[:mother]->(Jeremy);</code></pre><p>The edges created here have the labels &quot;married&quot;, &quot;father&quot;, and &quot;mother&quot;. The edge with the &quot;married&quot; label has the property &quot;year&quot;. The edges with the &quot;father&quot; and &quot;mother&quot; labels do not have any properties.</p><p>To view all the instances of a specific node type, along with connecting lines for their edges, enter a Cypher command like the following:</p><pre class="language-text"><code class="language-text">match (p:Person) return p</code></pre><p><img alt="Neo4j Person relationships" class="keep-size" src="/blog/assets/neo4j-person-relationships.png?v=1.0.17"></p><p>The nodes in the diagram can be dragged to new positions in order to manually change their layout.</p><p>To export a diagram as CSV, JSON, PNG, or SVG, click the download icon in the upper-right corner of its cell and select one of those formats.</p><p><img alt="Neo4j Browser export menu" class="keep-size" src="/blog/assets/neo4j-browser-export-menu.png?v=1.0.17"></p><p>In addition to displaying query results as a &quot;Graph&quot;, they can also be viewed as a &quot;Table&quot;, &quot;Text&quot;, or &quot;Code&quot; by clicking the corresponding buttons on the left side of the cell.</p><p><img alt="Neo4j Browser views" class="keep-size" src="/blog/assets/neo4j-browser-views.png?v=1.0.17"></p><p>To temporarily hide a node, click its circle and then click the icon containing an eye with a minus sign.</p><p><img alt="Neo4j node selected" class="keep-size" src="/blog/assets/neo4j-node-selected.png?v=1.0.17"></p><p>To get only the nodes that have a specific relationship, enter a Cypher query like the following:</p><pre class="language-text"><code class="language-text">match (p1:Person)-[m:father]->(p2:Person) return p1, m, p2</code></pre><p><img alt="Neo4j father edges" class="keep-size" src="/blog/assets/neo4j-father-edges.png?v=1.0.17"></p><p>Let's make this more interesting by adding <code>Dog</code> nodes and relationships between them and their <code>Person</code> owners.</p><pre class="language-text"><code class="language-text">create (Maisey:Dog {name:'Maisey', breed:'Treeing Walker Coonhound'}),<br>  (Ramsay:Dog {name:'Ramsay', breed:'Native American Indian Dog'}),<br>  (Oscar:Dog {name:'Oscar', breed:'German Shorthaired Pointer'}),<br>  (Comet:Dog {name:'Comet', breed:'Whippet'});<br><br>match (Mark:Person{name: 'Mark Volkmann'}),<br>  (Tami:Person{name: 'Tami Volkmann'}),<br>  (Amanda:Person{name: 'Amanda Nelson'}),<br>  (Jeremy:Person{name: 'Jeremy Volkmann'}),<br>  (Maisey:Dog{name: 'Maisey'}),<br>  (Ramsay:Dog{name: 'Ramsay'}),<br>  (Oscar:Dog{name: 'Oscar'}),<br>  (Comet:Dog{name: 'Comet'})<br>with Mark, Tami, Amanda, Jeremy, Maisey, Ramsay, Oscar, Comet<br>create (Mark)-[:owns {role:'secondary'}]->(Comet),<br>  (Tami)-[:owns {role:'primary'}]->(Comet),<br>  (Amanda)-[:owns {role:'primary'}]->(Maisey),<br>  (Amanda)-[:owns {role:'primary'}]->(Oscar),<br>  (Jeremy)-[:owns {role:'primary'}]->(Ramsay);</code></pre><p>To delete edges, enter a Cypher command like the following:</p><pre class="language-text"><code class="language-text">match (p:Person)-[o:owns]->(d:Dog) delete o</code></pre><p>This deletes all the &quot;own&quot; edges between a <code>Person</code> and a <code>Dog</code>.</p><h2 id="querying">Querying</h2><p>To view all the nodes we have created, along with the edges between them, enter the following Cypher command:</p><pre class="language-text"><code class="language-text">match (n) return n</code></pre><p><img alt="Neo4j all nodes" class="keep-size" src="/blog/assets/neo4j-all-nodes.png?v=1.0.17"></p><p>Queries can be more specific. For example:</p><pre class="language-text"><code class="language-text">match (p:Person) where p.name starts with 'Amanda' return p</code></pre><p>This only renders the <code>Person</code> node for Amanda Volkmann. To also render the nodes connect via an edge, click the node to display a ring around it and then click the graph icon in the ring.</p><p><img alt="Neo4j Amanda with ring" class="keep-size" src="/blog/assets/neo4j-amanda-ring.png?v=1.0.17"></p><p>The resulting displays is as follows:</p><p><img alt="Neo4j Amanda with links" class="keep-size" src="/blog/assets/neo4j-amanda-with-links.png?v=1.0.17"></p><p>Queries on labels are more efficient that queries on properties, but adding indexes to properties reduces the performance difference.</p><h2 id="cleaning-up">Cleaning up</h2><p>To delete every node and the edges between them, enter the following Cypher command:</p><pre class="language-text"><code class="language-text">match (n) detach delete n</code></pre><p>To verify that everything has been deleted, enter the following Cypher command:</p><pre class="language-text"><code class="language-text">match (n) return n</code></pre><h2 id="creating-and-restoring-backups">Creating and restoring backups</h2><p>TODO: How do you install the <code>neo4j-admin</code> command?</p><p>To create a backup of a Neo4j database, execute a command like the following:</p><pre class="language-bash"><code class="language-bash">neo4j-admin backup --backup-dir<span class="token operator">=</span><span class="token punctuation">{</span>some-directory<span class="token punctuation">}</span> --database<span class="token operator">=</span><span class="token punctuation">{</span>db-name<span class="token punctuation">}</span></code></pre><p>To restore a Neo4j database from a backup, execute a command like the following:</p><pre class="language-bash"><code class="language-bash">neo4j-admin restore --from<span class="token operator">=</span><span class="token punctuation">{</span>some-directory<span class="token punctuation">}</span> --database<span class="token operator">=</span><span class="token punctuation">{</span>db-name<span class="token punctuation">}</span></code></pre><p>TODO: It is possible that different commands are required when using TODO: the community version of Neo4j instead of the enterprise version.</p><p>For more detail, see <a href="https://neo4j.com/docs/operations-manual/current/backup/?v=1.0.17" rel="noopener" target="_blank">Backup</a>.</p><h2 id="accessing-from-a-web-app">Accessing from a web app</h2><p>The npm package <a href="https://github.com/neo4j-contrib/neovis.js?v=1.0.17" rel="noopener" target="_blank">neovis.js</a> supports rendering diagrams based on Neo4j Cypher queries. This builds on the npm package <a href="https://visjs.github.io/vis-network/docs/network/?v=1.0.17" rel="noopener" target="_blank">vis-network</a> for the visualization implementation.</p><p>For detailed documentation on options, see <a href="https://visjs.github.io/vis-network/docs/network/?v=1.0.17" rel="noopener" target="_blank">vis.js</a>.</p><p>Here is an example of a simple web page that renders the <code>Person</code> and <code>Dog</code> nodes created earlier.</p><pre class="language-html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width,initial-scale=1<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>neovis Demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><br>      <span class="token selector">#vis</span> <span class="token punctuation">{</span><br>        <span class="token property">background-color</span><span class="token punctuation">:</span> linen<span class="token punctuation">;</span><br>        <span class="token property">height</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neovis.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>      <span class="token keyword">const</span> cyphers <span class="token operator">=</span> <span class="token punctuation">[</span><br>        <span class="token string">'match (p1:Person)-[r:married]->(p2:Person) return p1, r, p2'</span><span class="token punctuation">,</span><br>        <span class="token string">'match (p1:Person)-[f:father]->(p2:Person) return p1, f, p2'</span><span class="token punctuation">,</span><br>        <span class="token string">'match (p1:Person)-[m:mother]->(p2:Person) return p1, m, p2'</span><span class="token punctuation">,</span><br>        <span class="token string">'match (p:Person)-[o:owns]->(d:Dog) return p,o,d'</span><br>      <span class="token punctuation">]</span><span class="token punctuation">;</span><br>      <span class="token keyword">const</span> thickness <span class="token operator">=</span> <span class="token string">'weight'</span><span class="token punctuation">;</span><br>      <span class="token keyword">let</span> vis<span class="token punctuation">;</span><br><br>      <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span><br>        container_id<span class="token operator">:</span> <span class="token string">'vis'</span><span class="token punctuation">,</span><br>        server_url<span class="token operator">:</span> <span class="token string">'bolt://localhost:7687'</span><span class="token punctuation">,</span><br>        server_user<span class="token operator">:</span> <span class="token string">'neo4j'</span><span class="token punctuation">,</span><br>        server_password<span class="token operator">:</span> <span class="token string">'neo4j19'</span><span class="token punctuation">,</span><br>        labels<span class="token operator">:</span> <span class="token punctuation">{</span><br>          Dog<span class="token operator">:</span> <span class="token punctuation">{</span><br>            caption<span class="token operator">:</span> <span class="token string">'name'</span><span class="token punctuation">,</span><br>            font<span class="token operator">:</span> <span class="token punctuation">{</span><br>              color<span class="token operator">:</span> <span class="token string">'blue'</span><span class="token punctuation">,</span><br>              face<span class="token operator">:</span> <span class="token string">'fantasy'</span><span class="token punctuation">,</span><br>              size<span class="token operator">:</span> <span class="token number">12</span><br>            <span class="token punctuation">}</span><span class="token punctuation">,</span><br>            image<span class="token operator">:</span> <span class="token string">'./dog-icon.png'</span><br>          <span class="token punctuation">}</span><span class="token punctuation">,</span><br>          Person<span class="token operator">:</span> <span class="token punctuation">{</span><br>            caption<span class="token operator">:</span> <span class="token string">'name'</span><span class="token punctuation">,</span><br>            font<span class="token operator">:</span> <span class="token punctuation">{</span><br>              color<span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span><br>              face<span class="token operator">:</span> <span class="token string">'sans-serif'</span><span class="token punctuation">,</span><br>              size<span class="token operator">:</span> <span class="token number">14</span><br>            <span class="token punctuation">}</span><span class="token punctuation">,</span><br>            image<span class="token operator">:</span> <span class="token string">'./person-icon.png'</span><br>          <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><span class="token punctuation">,</span><br>        relationships<span class="token operator">:</span> <span class="token punctuation">{</span><br>          father<span class="token operator">:</span> <span class="token punctuation">{</span>thickness<span class="token punctuation">}</span><span class="token punctuation">,</span><br>          married<span class="token operator">:</span> <span class="token punctuation">{</span>thickness<span class="token punctuation">}</span><span class="token punctuation">,</span><br>          mother<span class="token operator">:</span> <span class="token punctuation">{</span>thickness<span class="token punctuation">}</span><span class="token punctuation">,</span><br>          owns<span class="token operator">:</span> <span class="token punctuation">{</span>thickness<span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br>        <span class="token comment">//initial_cypher: ''</span><br>      <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>      window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        vis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NeoVis<span class="token punctuation">.</span>default</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        vis<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> cypher <span class="token keyword">of</span> cyphers<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          vis<span class="token punctuation">.</span><span class="token function">updateWithCypher</span><span class="token punctuation">(</span>cypher<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>      <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><br><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vis<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>This produces a page like the following:</p><p><img alt="neovis page" class="keep-size" src="/blog/assets/neovis-page.png?v=1.0.17"></p><p>Hover over a node or edge to see its properties in a popup.</p></article>