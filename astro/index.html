<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Astro</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#top-benefits">Top Benefits</a></li><li><a href="#projects">Projects</a><ol><li><a href="#configuration">Configuration</a></li></ol></li><li><a href="#vs-code">VS Code</a></li><li><a href="#prettier">Prettier</a></li><li><a href="#directory-structure">Directory Structure</a></li><li><a href="#pages">Pages</a></li><li><a href="#astro-components">Astro Components</a><ol><li><a href="#slots">Slots</a></li></ol></li><li><a href="#builtin-components">Builtin Components</a></li><li><a href="#shorthand-attributes">Shorthand Attributes</a></li><li><a href="#naming-conventions">Naming Conventions</a></li><li><a href="#styling">Styling</a></li><li><a href="#layouts">Layouts</a></li><li><a href="#imports">Imports</a><ol><li><a href="#path-aliases">Path Aliases</a></li></ol></li><li><a href="#images">Images</a></li><li><a href="#icons">Icons</a></li><li><a href="#dynamic-routes">Dynamic Routes</a></li><li><a href="#event-handling">Event Handling</a></li><li><a href="#content-collections">Content Collections</a><ol><li><a href="#references">References</a></li><li><a href="#sanitizing-content">Sanitizing Content</a></li><li><a href="#pagination">Pagination</a></li><li><a href="#incremental-content-caching">Incremental Content Caching</a></li></ol></li><li><a href="#astro.glob">Astro.glob</a></li><li><a href="#content-management-systems-(cms)">Content Management Systems (CMS)</a></li><li><a href="#mdx">MDX</a></li><li><a href="#other-frameworks">Other Frameworks</a><ol><li><a href="#react">React</a></li><li><a href="#svelte">Svelte</a></li><li><a href="#alpine">Alpine</a><ol><li><a href="#defining-functions">Defining Functions</a></li><li><a href="#alpine-example">Alpine Example</a></li></ol></li><li><a href="#component-communication">Component Communication</a></li></ol></li><li><a href="#sharing-state-(nanostores)">Sharing State (nanostores)</a><ol><li><a href="#store-setup">Store Setup</a></li><li><a href="#persistence">Persistence</a></li><li><a href="#store-creation">Store Creation</a></li><li><a href="#react-component">React Component</a></li><li><a href="#svelte-component">Svelte Component</a></li><li><a href="#astro-component">Astro Component</a></li><li><a href="#page-component">Page Component</a></li></ol></li><li><a href="#directives">Directives</a></li><li><a href="#dev-toolbar">Dev Toolbar</a></li><li><a href="#custom-404-page">Custom 404 Page</a></li><li><a href="#view-transitions">View Transitions</a></li><li><a href="#prefetching">Prefetching</a></li><li><a href="#middleware">Middleware</a></li><li><a href="#cookies">Cookies</a></li><li><a href="#table-of-contents">Table of Contents</a></li><li><a href="#api-endpoints">API Endpoints</a><ol><li><a href="#form-submits">Form Submits</a></li></ol></li><li><a href="#htmx">HTMX</a></li><li><a href="#internationalization">Internationalization</a></li><li><a href="#tailwind-typography-plugin">Tailwind Typography Plugin</a></li><li><a href="#bun-instead-of-node">Bun instead of Node</a></li><li><a href="#starlight">Starlight</a></li><li><a href="#resources">Resources</a></li><li><a href="#unorganized-content">Unorganized Content</a></li></ol></nav></aside><article><style>figcaption {
    margin-top: 0.5rem;
    text-align: center;
  }
  img {
    border: 1px solid gray;
  }
  .row {
    display: flex;
    align-items: center;
  }</style><div class="row"><figure style="width: 40%"><img alt="Astro logo" style="border: 0" src="/blog/assets/astro-logo.svg?v=1.1.1"><figcaption>Astro logo</figcaption></figure><figure style="width: 20%"><img alt="Houston" style="border: 0" src="/blog/assets/astro-houston.png?v=1.1.1"><figcaption>Houston,<br>the Astro mascot</figcaption></figure></div><h2 id="overview" tabindex="-1">Overview</h2><p><a href="https://astro.build?v=1.1.1" rel="noopener" target="_blank">Astro</a> is a free, open-source (MIT license) framework that is &quot;the web framework for content-driven websites&quot;. It can be used to generate static sites, build server-side rendered (SSR) sites, and define API endpoints.</p><p>A major focus of Astro is shipping less JavaScript code to browsers and doing more work on the server side.</p><p>Astro supports using many kinds of UI components including Astro, Alpine, Lit, Preact, React, SolidJS, Svelte, Vue, WebComponents, and more.</p><p>Astro uses the <a href="https://docs.astro.build/en/concepts/islands/?v=1.1.1" rel="noopener" target="_blank">Islands architecture</a>. Jason Miller (creator of the Preact framework) describes this approach as a way to &quot;render HTML pages on the server, and inject placeholders or slots around highly dynamic regions that can then be hydrated on the client into small self-contained widgets, reusing their server-rendered initial HTML.&quot; Each island is a bit of JavaScript-enabled interactivity and the water around them is static HTML.</p><p>Astro allows each &quot;island&quot; to use a different web UI frameworks, combining them into in a single web application.</p><p>Astro supports SSR adapters for Cloudflare, Netlify, Node, and Vercel.</p><p>Astro provides integrations with Tailwind for CSS styling and a few other packages.</p><p>Astro provides file-based routing that is specified by the files and directories under the <code>src/pages</code> directory. For example, the URL path <code>/foo/bar</code> refers to the page defined in the file <code>src/pages/foo/bar.astro</code>.</p><p>Astro was created by <a href="http://fredkschott.com/about/?v=1.1.1" rel="noopener" target="_blank">Fred K. Schott</a>. Fred previously worked on WebComponents at Google and was on the Polymer team. He also created <a href="https://www.snowpack.dev?v=1.1.1" rel="noopener" target="_blank">Snowpack</a>, &quot;a lightning-fast frontend build tool&quot;, that is no longer maintained. The functionality of Snowpack was superseded by <a href="https://vitejs.dev?v=1.1.1" rel="noopener" target="_blank">Vite</a> which is used as the build tool in Astro.</p><p>Development of Astro is managed by &quot;The Astro Technology Company&quot; which was founded in January 2022 with $7M in seed funding.</p><h2 id="top-benefits" tabindex="-1">Top Benefits</h2><p>The top benefits of using Astro include:</p><ul><li>sends less JavaScript code (zero by default) to browsers resulting in faster startup</li><li>file-based routing simplifies mapping pages and endpoints to URLs</li><li>provides image optimization</li><li>makes static site generation (SSG) easy</li><li>supports server-side rendering (SSR) of pages</li><li>optimizes static content by confining dynamic behavior to &quot;islands&quot;</li><li>supports TypeScript for providing intellisense and detecting errors while writing code</li><li>can describe pages, components, and content with Markdown</li><li>provides a simple syntax for defining Astro components that leans into web fundamentals (HTML, CSS, and JavaScript)</li><li>can use components implemented in all the popular web frameworks</li><li>can use content collections to easily generate static pages from data at build time</li><li>integrates with many popular content management systems (CMS)</li><li>supports implementing API endpoints in JavaScript or TypeScript</li><li>integrates with Alpine, MDX, React, Svelte, Tailwind, and more</li><li>simplifies installing and configuring integrations</li><li>has a Discord channel that is very active and helpful</li></ul><p>The top issues with using Astro include:</p><ul><li>primitive support for client-side interactivity (but combining the use of Alpine provides excellent support)</li><li>fewer available component libraries than with other frameworks</li></ul><h2 id="projects" tabindex="-1">Projects</h2><p>To create an Astro project, enter <code>npm create astro@latest</code>. This will prompt for the following:</p><ul><li><p>permission to install create-astro</p></li><li><p>&quot;Where should we created your new project?&quot;</p><p>Enter the name of a new subdirectory to be created. To create the project in the current directory, enter only &quot;.&quot;. To enter a relative path, begin with &quot;./&quot;.</p></li><li><p>&quot;How would you like to start your new project?&quot;</p><p>The options are &quot;Include sample files&quot;, &quot;Use blog template&quot;, and &quot;Empty&quot;.</p></li><li><p>&quot;Install dependencies?&quot; Yes or No</p><p>Press return to accept the default of &quot;Yes&quot;.</p></li><li><p>&quot;Do you plan to write TypeScript?&quot; Yes or No</p><p>Press return to accept the default of &quot;Yes&quot;.</p></li><li><p>&quot;How strict should TypeScript be? Strict, Strictest, or Relaxed</p><p>The default is &quot;Strict&quot;, but its best to select &quot;Strictest&quot;.</p></li><li><p>&quot;Initialize a new git repository? Yes or No</p></li></ul><p><img alt="Astro create project" style="width: 70%" src="/blog/assets/astro-create-project.png?v=1.1.1"></p><p>Once the project is created, follow the instructions that are output.</p><ul><li><code>cd</code> to the newly created directory.</li><li>Optionally add the Tailwind integration for Tailwind CSS styling by entering <code>npx astro add tailwind</code>.</li><li>Enter <code>npm start</code> or <code>npm run dev</code> to start a local server. Both do the same thing.</li><li>Browse localhost:4321 (the default port).</li></ul><p>The Astro logo is a rocket. Astro uses 4321 for the default port because it is like a countdown sequence for a rocket launch.</p><p>Hot reloading is automatically configured so saved changes are automatically reflected in the browser.</p><p>To check for issues in the project code, enter <code>npx astro check</code> or <code>npm run astro check</code>. This will output errors, warnings, and hints.</p><p>To build the site for production, enter <code>npm run build</code>. This runs <code>astro check</code> and stops if there are any errors. Then it runs <code>astro build</code> which creates a <code>dist</code> directory containing all the files needed to deploy the site. The output lists all the generated files.</p><p>To preview the built site, enter <code>npm run preview</code> and browse localhost:4321.</p><p>To see a list of the available &quot;astro&quot; commands, enter <code>npm run astro</code>.</p><p>To open the Astro documentation in the default web browser, enter <code>npm run astro docs</code>. For help on a specific topic, click in the search input or press the slash key to move focus there. Then enter a topic.</p><h3 id="configuration" tabindex="-1">Configuration</h3><p>The file <code>astro.config.mjs</code> defines Astro configuration options including adapters (like node) and integrations (like Tailwind).</p><p>While this file can be manually modified, it is easier and less error prone to add adapters and integrations using the <code>npx astro add {name}</code> command which installs an adapter or integration and updates the <code>astro.config.mjs</code> file.</p><p>The following example configuration file adds the use of the node adapter and the mdx and tailwind integrations.</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>defineConfig<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'astro/config'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> mdx <span class="token keyword">from</span> <span class="token string">'@astrojs/mdx'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> node <span class="token keyword">from</span> <span class="token string">'@astrojs/node'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> tailwind <span class="token keyword">from</span> <span class="token string">'@astrojs/tailwind'</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  integrations<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">mdx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">tailwind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>  output<span class="token operator">:</span> <span class="token string">'server'</span><span class="token punctuation">,</span> <span class="token comment">// defaults to 'static'</span><br>  adapter<span class="token operator">:</span> <span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    mode<span class="token operator">:</span> <span class="token string">'standalone'</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The values for <code>output</code> and <code>adapter</code> shown above result from adding an adapter with the command <code>npx astro add {adapter-name}</code>. In this case the adapter name was &quot;node&quot;.</p><p>The <code>output</code> property can be set to the following values:</p><table><thead><tr><th><code>output</code> value</th><th>Meaning</th></tr></thead><tbody><tr><td><code>'static'</code></td><td>All pages are generated at build time. (default)</td></tr><tr><td><code>'hybrid'</code></td><td>All pages default to being generated at build time.</td></tr><tr><td><code>'server'</code></td><td>All pages default to being generated on the server when requested.</td></tr></tbody></table><p>Perhaps a better name for &quot;hybrid&quot; would have been &quot;ssg&quot; (at build time) and a better name for &quot;server&quot; would have been &quot;ssr&quot; (on request).</p><p>In &quot;hybrid&quot; mode, to cause a specific page to NOT be generated at build time, add the following line in the component script:</p><pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">const</span> prerender <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></code></pre><p>In &quot;server&quot; mode, to cause a specific page to be generated at build time, add the following line in the component script:</p><pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">const</span> prerender <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></code></pre><p>If a page for a dynamic route that is to be generated at build time does not export a <code>getStaticPaths</code> function, the following error message will be output by <code>npm run build</code>: &quot;[GetStaticPathsRequired] <code>getStaticPaths()</code> function is required for dynamic routes.&quot;</p><p>If a page for a dynamic route that is to be generated on the server when requested does define a <code>getStaticPaths</code> function, it will be ignored and the following warning message will be output by <code>npm run build</code>: &quot;[WARN] [router] getStaticPaths() ignored in dynamic page /src/pages/{path}/[{param}].astro.&quot;</p><p>When <code>output</code> is set to &quot;server&quot; or &quot;hybrid&quot;, a server adapter must be installed. Otherwise running <code>npm run build</code> will output the error message &quot;[NoAdapterInstalled] Cannot use <code>output: 'server'</code> or <code>output: 'hybrid'</code> without an adapter. Please install and configure the appropriate server adapter for your final deployment.&quot;</p><p>Astro maintains SSR adapters for Cloudflare, Netlify, Node, and Vercel. There are also community-maintained SSR adapters for AWS, Deno, and more.</p><p>For an excellent video on Astro rendering options, see <a href="https://www.youtube.com/watch?v=aIHRjloFASU?v=1.1.1" rel="noopener" target="_blank">Choosing between SSR, SSG, and dynamic rendering in Astro</a>.</p><h2 id="vs-code" tabindex="-1">VS Code</h2><p>If you use VS Code as your editor, consider installing these extensions:</p><ul><li><p><a href="https://marketplace.visualstudio.com/items?itemName=astro-build.astro-vscode?v=1.1.1" rel="noopener" target="_blank">Astro</a> from astro.build</p><p>This provides language support for <code>.astro</code> files using the Astro language server. It includes syntax highlighting, intellisense code completions, Emmet completions in HTML and CSS code actions for quick fixes, code formatting (using Prettier), code folding, and more.</p></li><li><p><a href="https://marketplace.visualstudio.com/items?itemName=astro-build.houston?v=1.1.1" rel="noopener" target="_blank">Houston</a> from astro.build</p><p>Houston is the Astro mascot.</p><p>This extension provides a color theme using Astro colors which include &quot;cool blues, minty greens, and soft purples&quot;.</p><p>This extension also adds a &quot;HOUSTON&quot; section to the Explorer pane which becomes visible after restarting VS Code. This displays the mascot with a smiley face if the project has no errors. If there are errors, it displays a frowning face, sad face, or crying face depending on the number of errors.</p><p>Error messages are displayed in the &quot;Problems&quot; panel. When this panel is not visible, it can be displayed by selecting &quot;Problems: Focus on Problems View&quot; from the command palette. It can also be toggled by pressing ctrl-shift-m (cmd-shift-m on macOS).</p></li><li><p><a href="https://marketplace.visualstudio.com/items?itemName=unifiedjs.vscode-mdx?v=1.1.1" rel="noopener" target="_blank">MDX</a> from unified</p><p>This provides language support for <code>.mdx</code> files.</p></li><li><p><a href="https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode?v=1.1.1" rel="noopener" target="_blank">Prettier - Code Formatter</a> from <a href="http://prettier.io">prettier.io</a></p><p>This formats code using <a href="https://prettier.io?v=1.1.1" rel="noopener" target="_blank">Prettier</a>.</p><p>To configure code formatting, open any <code>.astro</code> file, open the Command Palette, and enter &quot;Format Document&quot;. It will prompt for configuring this and automatically do so.</p></li><li><p><a href="https://marketplace.visualstudio.com/items?itemName=bradlc.vscode-tailwindcss?v=1.1.1" rel="noopener" target="_blank">Tailwind CSS Intellisense</a> from <a href="http://tailwindcss.com">tailwindcss.com</a></p><p>This provides autocomplete, syntax highlighting, and linting for Tailwind CSS classes. When entering Tailwind class names for colors, it provides color preview swatches.</p></li></ul><h2 id="prettier" tabindex="-1">Prettier</h2><p>The steps to configure an Astro project to use Prettier are:</p><ul><li><p>Enter <code>npm install -D prettier-plugin-astro</code></p></li><li><p>Create the file <code>.prettierrc</code> at the root of the project.</p><p>Some suggested options are shown here. The only one that is required is <code>plugins</code>.</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"arrowParens"</span><span class="token operator">:</span> <span class="token string">"avoid"</span><span class="token punctuation">,</span><br>  <span class="token property">"astroAllowShorthand"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>  <span class="token property">"bracketSpacing"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>  <span class="token property">"singleQuote"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>  <span class="token property">"trailingComma"</span><span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span><br>  <span class="token property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"prettier-plugin-astro"</span><span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Add the following script in <code>package.json</code>.</p><pre class="language-json"><code class="language-json"><span class="token property">"format"</span><span class="token operator">:</span> <span class="token string">"prettier --write '{public,src}/**/*.{astro,css,html,js,ts}'"</span><span class="token punctuation">,</span></code></pre></li></ul><p>To format all the files in the project, enter <code>npm run format</code>.</p><h2 id="directory-structure" tabindex="-1">Directory Structure</h2><p>The <code>public</code> directory holds assets such as audio, images, and video that will be served as-is and not affected by any optimizations.</p><p>Common subdirectories of the <code>src</code> directory are described in the table below. The only special names are <code>pages</code> and <code>content</code>. There are common names used for the others, but they are not enforced.</p><table><thead><tr><th>Directory Name</th><th>Purpose</th></tr></thead><tbody><tr><td><code>src/components</code></td><td>This contains component source files that can be used in page components.</td></tr><tr><td><code>src/content</code></td><td>This holds collections of content files.</td></tr><tr><td><code>src/images</code></td><td>This holds images that will be used with the provided <code>Image</code> component in order to optimized them.</td></tr><tr><td><code>src/layouts</code></td><td>This holds component source files that typically provide boilerplate HTML used by pages.</td></tr><tr><td><code>src/pages</code></td><td>This contains component source files that represent complete pages of the app or API endpoints. Initially only <code>index.astro</code> is present.</td></tr><tr><td><code>src/styles</code></td><td>This contains CSS files that define global styling.</td></tr></tbody></table><p>For site-wide constants, consider creating the file <code>src/constants.ts</code> that export the constants. In files that need the constants, import them from this file.</p><h2 id="pages" tabindex="-1">Pages</h2><p>Pages are defined by files in the <code>src/pages</code> directory.</p><p>Think of pages like oceans and components like islands in the islands architecture. Islands are where interactivity can reside. Examining the source of a page containing islands reveals that Astro uses custom elements named &quot;<code>astro-island</code>&quot;.</p><p>Pages can be described by Astro (<code>.astro</code>), HTML (<code>.html</code>), Markdown (<code>.md</code>), and MDX (<code>.mdx</code>) files. Pages cannot be described by components from frameworks like React and Svelte because those are potential sources of interactivity. But pages can render those kinds of components.</p><p>In a sense, Astro can be thought of as a compiler that compiles page files into HTML files.</p><p>The URL path of a page is determined by its subdirectory path and file name.</p><p>For example, the file <code>src/pages/demo/colors.md</code> defines the page at the URL path <code>/demo/colors/</code>.</p><p><img alt="Astro colors page" style="width: 25%" src="/blog/assets/astro-colors-page.png?v=1.1.1"></p><pre class="language-md"><code class="language-md"><span class="token front-matter-block"><span class="token punctuation">---</span><br><span class="token front-matter yaml language-yaml"><span class="token key atrule">layout</span><span class="token punctuation">:</span> ../layouts/Layout.astro</span><br><span class="token punctuation">---</span></span><br><br><span class="token title important"><span class="token punctuation">#</span> Colors</span><br><br><span class="token list punctuation">-</span> red<br><span class="token list punctuation">-</span> green<br><span class="token list punctuation">-</span> blue</code></pre><p>The front matter property <code>layout</code> specifies the path to a layout component that provides the HTML boilerplate for the page. This can include <code>link</code> tags that refer to CSS files used to style the page.</p><p>This same page can be implemented as an Astro component in the file <code>src/pages/demo/colors.astro</code> as follows:</p><pre class="language-js"><code class="language-js"><span class="token operator">--</span><span class="token operator">-</span><br><span class="token keyword">import</span> Layout <span class="token keyword">from</span> <span class="token string">"../../layouts/Layout.astro"</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"green"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token operator">--</span><span class="token operator">-</span><br><br><span class="token operator">&lt;</span>Layout<span class="token operator">></span><br>  <span class="token operator">&lt;</span>h1<span class="token operator">></span>Colors<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><br>  <span class="token operator">&lt;</span>ul<span class="token operator">></span><br>    <span class="token punctuation">{</span>colors<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">color</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token punctuation">{</span>color<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">}</span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span><br><span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">></span></code></pre><p>Unlike with many other web frameworks, Astro does not require specifying a key for repeated elements like the <code>li</code> elements above. This is because Astro generates the elements at build-time and doesn't use client-side JavaScript to add, modify, and delete them based on changes to collections.</p><p>A page can return the result of calling <code>Astro.redirect({url})</code> to redirect to another page.</p><h2 id="astro-components" tabindex="-1">Astro Components</h2><p>Astro components are defined in source files with a <code>.astro</code> file extension. These describe HTML that will be rendered on the server. This can contain three sections:</p><ul><li><p>optional component script</p><p>This section begins and ends with lines that only contain three dashes, referred to as &quot;code fences&quot;. This is is the same syntax that is used in Markdown files for &quot;front matter&quot;.</p><p>Write JavaScript code inside the code fences. If TypeScript was enabled for the project, it can be used here.</p><p>The code in component scripts only runs at build time or during SSR. It is not sent to browsers. Output from <code>console.log</code> calls in component scripts appears where the server is running, not in the browser.</p><p>Place code that should run in the browser inside a <code>script</code> tag that appears after the component script.</p><p>Code in a component script can:</p><ul><li><p>import other files with ESM syntax</p></li><li><p>declare types, such as the type of the props it accepts</p><p>For example:</p><pre class="language-ts"><code class="language-ts"><span class="token comment">// This can be defined with either "type" or "interface".</span><br><span class="token keyword">type</span> <span class="token class-name">Props</span> <span class="token punctuation">{</span><br>  prop1<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// optional prop</span><br>  prop2<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> <span class="token comment">// required prop</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></li><li><p>use destructuring to get the values of props</p><p>For example:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> <span class="token punctuation">{</span>prop1 <span class="token operator">=</span> <span class="token string">'default value'</span><span class="token punctuation">,</span> prop2<span class="token punctuation">}</span> <span class="token operator">=</span> Astro<span class="token punctuation">.</span>props <span class="token keyword">as</span> Props<span class="token punctuation">;</span></code></pre></li><li><p>declare variables that can be used in the HTML that follows</p></li><li><p>declare functions that can be called in the HTML that follows</p></li><li><p>use the Fetch API with top-level <code>await</code> to get data from API endpoints</p></li></ul></li><li><p>HTML to be rendered</p><p>This section uses a JSX-like syntax. Unlike JSX, this content is not pure XML. For example, it an contain unclosed elements like <code>!doctype</code> and self closing elements like <code>br</code> and <code>hr</code>.</p><p>A root element is not required, but the fragment syntax from React is supported (<code>&lt;&gt;...&lt;/&gt;</code>).</p><p>To insert the value of a JavaScript expression, use <code>{expression}</code>. This can appear in element attribute values and content.</p><p>Conditional logic uses the same syntax as in React. For example, <code>{condition &amp;&amp; HTML}</code> or <code>{condition ? HTML1 : HTML2}</code>.</p><p>Iteration also uses the same approach as in React. For example, <code>{collection.map(element =&gt; HTML)}</code>.</p><p>Expressions in curly braces are not reactive. <code>.astro</code> files are rendered on the server only one time.</p></li><li><p>optional <code>style</code> tag</p><p>This defines CSS rules that are scoped to this component.</p></li></ul><p>For a good example of defining a reusable, customizable <code>Button</code> component, see <a href="https://github.com/coding-in-public/astro-component-example-btn/blob/main/src/components/Button.astro?v=1.1.1" rel="noopener" target="_blank">astro-component-example-btn</a>. This uses TypeScript to describe all the supported props which provides intellisense and error checking.</p><p>An Astro component can render another instances of itself recursively using <code>&lt;Astro.self {props} /&gt;</code>.</p><h3 id="slots" tabindex="-1">Slots</h3><p>The HTML of a component can contain a <code>slot</code> element which marks where content will be inserted. For example, the following component in <code>src/components/Border.astro</code> contains a <code>slot</code> element.</p><pre class="language-js"><code class="language-js"><span class="token operator">--</span><span class="token operator">-</span><br><span class="token keyword">interface</span> <span class="token class-name">Props</span> <span class="token punctuation">{</span><br>  color<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">const</span> <span class="token punctuation">{</span> color <span class="token operator">=</span> <span class="token string">"black"</span> <span class="token punctuation">}</span> <span class="token operator">=</span> Astro<span class="token punctuation">.</span>props<span class="token punctuation">;</span><br><br><span class="token keyword">const</span> style <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">borderColor</span><span class="token operator">:</span> color<span class="token punctuation">,</span><br>  <span class="token literal-property property">boxShadow</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">5px 5px 5px </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>color<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token operator">--</span><span class="token operator">-</span><br><br><span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"border"</span> <span class="token punctuation">{</span>style<span class="token punctuation">}</span><span class="token operator">></span><br>  <span class="token operator">&lt;</span>slot <span class="token operator">/</span><span class="token operator">></span><br><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br><br><span class="token operator">&lt;</span>style<span class="token operator">></span><br>  <span class="token punctuation">.</span>border <span class="token punctuation">{</span><br>    border<span class="token operator">-</span>width<span class="token operator">:</span> 3px<span class="token punctuation">;</span><br>    border<span class="token operator">-</span>radius<span class="token operator">:</span> 1rem<span class="token punctuation">;</span><br>    <span class="token literal-property property">display</span><span class="token operator">:</span> inline<span class="token operator">-</span>block<span class="token punctuation">;</span><br>    <span class="token literal-property property">padding</span><span class="token operator">:</span> 1rem<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">></span></code></pre><p>The <code>slot</code> element can include content to be used when none is provided. For example, the <code>&lt;slot /&gt;</code> element above can be replaced by <code>&lt;slot&gt;Press Me&lt;/slot&gt;</code>.</p><p>This <code>Border</code> component can be used as follows. Note how content is included.</p><p><img alt="Astro component with slot" style="border: none; width: 30%" src="/blog/assets/astro-component-with-slot.png?v=1.1.1"></p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Border</span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>red<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  What is with this code?<br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span><br>  Oh my, looks like I wrote it.<br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span><br>  What was I thinking?<br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Border</span><span class="token punctuation">></span></span></code></pre><h2 id="builtin-components" tabindex="-1">Builtin Components</h2><p>Astro provides the following components:</p><ul><li><p><code>&lt;Code code={codeString} lang=&quot;{lang}&quot; /&gt;</code></p><p>This renders source code with syntax highlighting provided by <a href="https://github.com/shikijs/shiki#?v=1.1.1" rel="noopener" target="_blank">Shiki </a>. Shiki &quot;generates HTML that looks exactly like your code in VS Code&quot;.</p><p>This component takes the optional props <code>theme</code>, <code>inline</code>, and <code>wrap</code>.</p><p>Import this component with:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>Code<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'astro:components'</span><span class="token punctuation">;</span></code></pre><p>Render this component with:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span> <span class="token attr-name">code</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{codeString.trim()}<span class="token punctuation">"</span></span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>js<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre><p>Add styling with:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name"><span class="token namespace">is:</span>global</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><br>  <span class="token selector">.astro-code</span> <span class="token punctuation">{</span><br>    <span class="token property">padding</span><span class="token punctuation">:</span> 1rem<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><p>For more detail see <a href="https://docs.astro.build/en/reference/api-reference/#code-" target="_blank">Code</a>.</p></li><li><p><code>&lt;Content /&gt;</code></p><p>This renders the content of a content collection entry. See the <a href="#content-collections">Content Collections</a> section.</p></li><li><p><code>&lt;Debug name={value} /&gt;</code></p><p>This renders a red bar with white text that displays &quot;DEBUG&quot; followed by the given name, followed by a black bar with white text that displays the given value. It is alternative to <code>console.log</code> that seems worse.</p><p>For more detail see <a href="https://docs.astro.build/en/reference/api-reference/#debug-" target="_blank">Debug</a>.</p></li><li><p><code>&lt;Fragment set:html={htmlString} /&gt;</code></p><p>This renders multiple HTML elements without a wrapping element. This component does not need to be imported.</p></li><li><p><code>&lt;Image /&gt;</code></p><p>This renders an optimized images. This component does not need to be imported. See the <a href="#images">Images</a> section.</p></li><li><p><code>&lt;Picture /&gt;</code></p><p>This is an alternative to the <code>Image</code> component that displays a responsive image selected from possible formats and sizes.</p><p>For example:</p><pre class="language-html"><code class="language-html">---<br>import { Picture } from 'astro:assets';<br>import myDog from "../images/dog.png";<br>---<br><br>&lt;Picture alt="my dog" src={myDog} formats={["webp", "avif"]} width={400} /></code></pre><p>For more detail see <a href="https://docs.astro.build/en/guides/images/#picture-" target="_blank">Picture</a>.</p></li><li><p><code>&lt;Prism /&gt;</code></p><p>This is an alternative to the <code>Code</code> component that the uses the <a href="https://prismjs.com?v=1.1.1" rel="noopener" target="_blank">Prism</a> library. It must be installed with <code>npm install @astrojs/prism</code>.</p><p>Download a theme CSS file from <a href="https://github.com/PrismJS/prism-themes/tree/master/themes?v=1.1.1" rel="noopener" target="_blank">PrismJS/prism-themes</a> and import it. For example:</p><pre class="language-html"><code class="language-html">import "../styles/prism-gruvbox-dark.css";</code></pre><p>Import this component with:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>Prism<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@astrojs/prism'</span><span class="token punctuation">;</span></code></pre><p>Render this component with:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Prism</span> <span class="token attr-name">code</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{codeString.trim()}<span class="token punctuation">"</span></span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>js<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre><p>For more detail see <a href="https://docs.astro.build/en/reference/api-reference/#prism-" target="_blank">Prism</a>.</p></li><li><p><code>&lt;ViewTransitions /&gt;</code></p><p>This enables the use of view transitions. See the <a href="#view-transitions">View Transitions</a> section.</p></li></ul><h2 id="shorthand-attributes" tabindex="-1">Shorthand Attributes</h2><p>Astro supports shorthand syntax for attributes like Svelte. For example, <code>&lt;Layout title={title}&gt;</code> can be written as <code>&lt;Layout {title}&gt;</code>.</p><h2 id="naming-conventions" tabindex="-1">Naming Conventions</h2><p>Files under the <code>src/pages</code> directory have lowercase names because their names are used in URL paths.</p><p>Files under the <code>src/components</code> directory have PascalCase names because their names become UI component names.</p><h2 id="styling" tabindex="-1">Styling</h2><p>As described above, components defined in <code>.astro</code> files can include a <code>style</code> tag that defines CSS rules that are scoped to the component.</p><p>Global styles can be defined in three ways.</p><p>The first option is to add a <code>link</code> tag to the <code>head</code> section of the HTML that refers to a CSS file.</p><p>The second option is to include a <code>&lt;style is:global&gt;</code> tag in a layout source file that is used by many pages.</p><p>The third option is to define a file like <code>global.css</code> in the <code>src</code> or <code>src/styles</code> directory and include it in all the page components that wish to use it as follows.</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token string">'../styles/global.css'</span><span class="token punctuation">;</span></code></pre><p>TODO: Is the third option the only one that supports hot reload of the browser when styles are modified?</p><h2 id="layouts" tabindex="-1">Layouts</h2><p>By convention, the <code>src/layouts</code> directory contains <code>.astro</code> files that describe common content that should wrap around the content of pages. Any number of layout components can be defined. Each page can choose the layout component it wishes to wrap its content inside.</p><p>Layout components can do all the things other components can do including taking props, importing files, and using other components.</p><p>For example, the file <code>src/layouts/Layout.astro</code> could contain the following. Note the use of <code>&lt;slot /&gt;</code> to specify where content will be inserted into the layout. Only one <code>slot</code> element can be used and named slots are not supported.</p><pre class="language-js"><code class="language-js"><span class="token operator">--</span><span class="token operator">-</span><br><span class="token keyword">interface</span> <span class="token class-name">Props</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">title</span><span class="token operator">:</span> string<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><span class="token keyword">const</span> <span class="token punctuation">{</span> title <span class="token punctuation">}</span> <span class="token operator">=</span> Astro<span class="token punctuation">.</span>props<span class="token punctuation">;</span><br><span class="token operator">--</span><span class="token operator">-</span><br><br><span class="token operator">&lt;</span><span class="token operator">!</span>doctype html<span class="token operator">></span><br><span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">></span><br>  <span class="token operator">&lt;</span>head<span class="token operator">></span><br>    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"UTF-8"</span> <span class="token operator">/</span><span class="token operator">></span><br>    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"description"</span> content<span class="token operator">=</span><span class="token string">"Astro description"</span> <span class="token operator">/</span><span class="token operator">></span><br>    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"viewport"</span> content<span class="token operator">=</span><span class="token string">"width=device-width"</span> <span class="token operator">/</span><span class="token operator">></span><br>    <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"icon"</span> type<span class="token operator">=</span><span class="token string">"image/svg+xml"</span> href<span class="token operator">=</span><span class="token string">"/favicon.svg"</span> <span class="token operator">/</span><span class="token operator">></span><br>    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"generator"</span> content<span class="token operator">=</span><span class="token punctuation">{</span>Astro<span class="token punctuation">.</span>generator<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><br>    <span class="token operator">&lt;</span>title<span class="token operator">></span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span><br>  <span class="token operator">&lt;</span>body<span class="token operator">></span><br>    <span class="token operator">&lt;</span>slot <span class="token operator">/</span><span class="token operator">></span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span><br><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span><br><span class="token operator">&lt;</span>style is<span class="token operator">:</span>global<span class="token operator">></span><br>  html <span class="token punctuation">{</span><br>    font<span class="token operator">-</span>family<span class="token operator">:</span> system<span class="token operator">-</span>ui<span class="token punctuation">,</span> sans<span class="token operator">-</span>serif<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">></span></code></pre><p>This layout can be used in a page <code>.astro</code> file as follows. Attribute syntax is used to pass props to components. Note how the <code>title</code> prop value is passed to the <code>Layout</code> component.</p><pre class="language-js"><code class="language-js"><span class="token operator">--</span><span class="token operator">-</span><br><span class="token keyword">import</span> Layout <span class="token keyword">from</span> <span class="token string">"../layouts/Layout.astro"</span><span class="token punctuation">;</span><br><span class="token operator">--</span><span class="token operator">-</span><br><br><span class="token operator">&lt;</span>Layout title<span class="token operator">=</span><span class="token string">"My Page"</span><span class="token operator">></span><br>  <span class="token operator">&lt;</span>main<span class="token operator">></span><br>    <span class="token operator">&lt;</span>h1<span class="token operator">></span>My Page<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>main<span class="token operator">></span><br><span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">></span></code></pre><p>Layouts can be nested. For example, a page component <code>MyPage</code> can wrap itself in <code>LayoutInner</code> which wraps itself in <code>LayoutOuter</code>.</p><h2 id="imports" tabindex="-1">Imports</h2><p>Astro supports importing many kinds of file in JavaScript code. The supported file types include:</p><ul><li>Astro components (.astro)</li><li>CSS (.css)</li><li>CSS Modules (.module.css)</li><li>Images (.svg, .jpg, .png, etc.)</li><li>JavaScript (.js, .mjs)</li><li>JSON (.json)</li><li>JSX (.jsx, .tsx)</li><li>Markdown (.md, .markdown, etc.)</li><li>NPM Packages</li><li>TypeScript (.ts)</li><li>Other kinds of assets (TODO: audio and video?)</li></ul><p>For example, the following line imports a JSON file with the path <code>src/data/dogs.json</code> from a <code>.astro</code> file in the <code>src/pages</code> directory:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> dogs <span class="token keyword">from</span> <span class="token string">'../data/dogs.json'</span><span class="token punctuation">;</span></code></pre><h3 id="path-aliases" tabindex="-1">Path Aliases</h3><p>Import paths can be relative to the current file, be absolute from the root directory of the project, or using a path alias defined in <code>tsconfig.json</code>.</p><p>For example, when inside the file <code>src/components/shopping/PetShop.astro</code>, the file <code>src/images/animals/dog.png</code> can be imported in these ways:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> dogImage <span class="token keyword">from</span> <span class="token string">'../../images/animals/dog.png'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> dogImage <span class="token keyword">from</span> <span class="token string">'/src/images/animals/dog.png'</span><span class="token punctuation">;</span></code></pre><p>Path aliases can be defined in <code>tsconfig.json</code> to simplify importing files from commonly used directories. For example:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"extends"</span><span class="token operator">:</span> <span class="token string">"astro/tsconfigs/strictest"</span><span class="token punctuation">,</span><br>  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"baseUrl"</span><span class="token operator">:</span> <span class="token string">"./src"</span><span class="token punctuation">,</span><br>    <span class="token property">"paths"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>      <span class="token property">"@components/*"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"components/*"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token property">"@images/*"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"images/*"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token property">"@layouts/*"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"layouts/*"</span><span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>This enables replacing an import like</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> Layout <span class="token keyword">from</span> <span class="token string">'../../../layouts/Layout.astro'</span><span class="token punctuation">;</span></code></pre><p>with this:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> Layout <span class="token keyword">from</span> <span class="token string">'@layouts/Layout.astro'</span><span class="token punctuation">;</span></code></pre><h2 id="images" tabindex="-1">Images</h2><p>Images can be placed under the <code>public</code> directory, typically in <code>public/images</code>. These can be referenced using a path string that is relative to the <code>public</code> directory. For example, <code>&lt;img alt=&quot;logo&quot; src=&quot;/images/logo.png&quot; /&gt;</code> searches from the <code>public</code> directory. Astro will server images files placed under the <code>public</code> directory as-is and will not provide image optimization.</p><p>In order to take advantage of image optimizations, place images under the <code>src/images</code> directory, import them into JavaScript code, and render them using the provided <code>Image</code> component. The <code>Image</code> component does not wait until it scrolls into view before loading the image.</p><p>For example:</p><pre class="language-ts"><code class="language-ts"><span class="token operator">--</span><span class="token operator">-</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> Image <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"astro:assets"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> logo <span class="token keyword">from</span> <span class="token string">"../images/logo.png"</span><span class="token punctuation">;</span><br><span class="token operator">--</span><span class="token operator">-</span><br><br><span class="token operator">&lt;</span>Image alt<span class="token operator">=</span><span class="token string">"logo"</span> src<span class="token operator">=</span><span class="token punctuation">{</span>logo<span class="token punctuation">}</span> height<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">200</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span></code></pre><p>Content collection files can also use optimized images. This is described the &quot;Content Collections&quot; section.</p><p>For static sites, optimized images are generated concurrently at build time.</p><p>From the documentation at <a href="https://docs.astro.build/en/guides/images/?v=1.1.1" rel="noopener" target="_blank">Images</a>, The <code>Image</code> component &quot;can transform a local or authorized remote image's dimensions, file type, and quality for control over your displayed image. The resulting <code>&lt;img&gt;</code> tag includes <code>alt</code>, <code>loading</code>, and <code>decoding</code> attributes and infers image dimensions to avoid Cumulative Layout Shift (CLS).&quot;</p><p>Astro will also optimize remote images if the following appears in the <code>astro.config.mjs</code> file:</p><pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token literal-property property">image</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">domains</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'astro.build'</span><span class="token punctuation">]</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Astro image optimization includes:</p><ul><li>adding <code>img</code> element attributes like <code>decoding=&quot;async&quot;</code> and <code>loading=&quot;lazy&quot;</code>.</li><li>generating WEBP versions of images to reduce file sizes (All major web browsers support the WEBP format.)</li><li>adding attributes required to take advantage of services like Cloudinary</li></ul><p>More image optimization is performed in production builds than when running in dev mode.</p><p>For pages that are generated at build time (SSG) and use the <code>Image</code> component, optimized <code>.webp</code> files are created in the <code>dist</code> directory.</p><p>This mostly removes the need to use tools like Squoosh to optimize images.</p><p>Image optimization is performed by the <a href="https://github.com/lovell/sharp?v=1.1.1" rel="noopener" target="_blank">sharp</a> package.</p><p>The <a href="https://docs.astro.build/en/guides/images/#picture-?v=1.1.1" rel="noopener" target="_blank">Picture</a> component can be used in place of the <code>Image</code> component to render an appropriate image from a selection of multiple formats and sizes.</p><h2 id="icons" tabindex="-1">Icons</h2><p><a href="https://www.astroicon.dev?v=1.1.1" rel="noopener" target="_blank">Astro Icon</a> provides access to many icon sets.</p><p>To install the &quot;Astro Icon&quot; integration, enter <code>npx astro add astro-icon</code>.</p><p>To see the available icon sets, browse <a href="https://icon-sets.iconify.design?v=1.1.1" rel="noopener" target="_blank">icon sets</a>.</p><p>To install an icon set, enter <code>npm i -D @iconify-json/{set-name}</code>. Some valid icon set names include &quot;fa6-solid&quot; (Fontawesome), &quot;material-symbols&quot;, &quot;mdi&quot;, &quot;solar&quot;, &quot;tdesign&quot;, and many more.</p><p>To use an icon, import the <code>Icon</code> component in the component script as follows:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>Icon<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'astro-icon/components'</span><span class="token punctuation">;</span></code></pre><p>Then render an icon with with something like the following:</p><pre class="language-text"><code class="language-text"><icon name="fa6-solid:hat-wizard" size="{60}" title="wizard hat"></code></pre><p>The <code>Icon</code> component can als render SVG files found in the <code>src/icons</code> directory. For example, if the file <code>src/icons/heart.svg</code> exists, it can be rendered with the following. Note that there is no icon set name prefix on the icon name.</p><pre class="language-text"><code class="language-text"><icon name="heart" size="{60}" title="heart"></code></pre><h2 id="dynamic-routes" tabindex="-1">Dynamic Routes</h2><p>Dynamic routes are routes defined under the <code>pages</code> directory with directory or file names that contain a variable name inside square brackets. These can be used for both pages and API endpoints.</p><p>For example, the following page defined in <code>src/pages/index.astro</code> contains links to pages that are provided by a dynamic route.</p><pre class="language-js"><code class="language-js"><span class="token operator">--</span><span class="token operator">-</span><br><span class="token keyword">import</span> Layout <span class="token keyword">from</span> <span class="token string">'../layouts/Layout.astro'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"green"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token operator">--</span><span class="token operator">-</span><br><br><span class="token operator">&lt;</span>Layout<span class="token operator">></span><br>  <span class="token punctuation">{</span><br>    colors<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">color</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><br>      <span class="token operator">&lt;</span>div<span class="token operator">></span><br>        <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>color<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">{</span>color<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><br>      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br>    <span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><br><span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">></span></code></pre><p>Rather than create a <code>.astro</code> file for each color, we can create the file <code>[color].astro</code> shown below. This file is used to render each of the color pages.</p><pre class="language-js"><code class="language-js"><span class="token operator">--</span><span class="token operator">-</span><br><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getStaticPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"green"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> colors<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">color</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span> color <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Astro.params contains matched segments of a dynamic route</span><br><span class="token comment">// where directory names under the "pages" directory</span><br><span class="token comment">// are surrounded by square brackets.</span><br><span class="token keyword">const</span> <span class="token punctuation">{</span> color <span class="token punctuation">}</span> <span class="token operator">=</span> Astro<span class="token punctuation">.</span>params<span class="token punctuation">;</span><br><span class="token operator">--</span><span class="token operator">-</span><br><br><span class="token operator">&lt;</span>Layout<span class="token operator">></span><br>  <span class="token operator">&lt;</span>h1<span class="token operator">></span><br>    You selected <span class="token operator">&lt;</span>span style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">color: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>color<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">{</span>color<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">.</span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><br><span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">></span></code></pre><p>The <code>getStaticPaths</code> function is required when not using SSR so Astro knows the pages it should generate at build time. This function is not used when SSR is enabled.</p><p>Note how the <code>colors</code> array is defined inside the <code>getStaticPaths</code> function. If defined outside that function, it will not be visible. The reason is that the <code>getStaticPaths</code> function gets hoisted into its own scope. That prevents it from accessing most things outside the function. This is a limitation that the Astro team hopes remove in the future.</p><p>Often the <code>getStaticPaths</code> function needs to iterate over documents in a content collection represented by <code>CollectionEntry</code> objects. In this case it can be written similar to the following:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getStaticPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> dogs<span class="token operator">:</span> CollectionEntry<span class="token operator">&lt;</span><span class="token string">'dogs'</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getCollection</span><span class="token punctuation">(</span><span class="token string">'dogs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> dogs<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>dog <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>params<span class="token operator">:</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> dog<span class="token punctuation">.</span>data<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p><code>ContentCollection</code> objects have the following properties:</p><ul><li><code>body</code> - body text of the document</li><li><code>collection</code> - name of the collection to which the document belongs</li><li><code>data</code> - object whose properties are the front matter variables in the document</li><li><code>id</code> - file name of the document with the file extension</li><li><code>render</code> - an async function that returns a component that renders the body content, converting Markdown to HTML</li><li><code>slug</code> - file name of the document without the file extension</li></ul><p>Running <code>npm run build</code> generates the <code>dist</code> directory which will contain the following files and more:</p><ul><li><code>dist/blue/index.html</code></li><li><code>dist/green/index.html</code></li><li><code>dist/red/index.html</code></li></ul><p>The <code>getStaticPaths</code> function is only required if SSR is not enabled. One way to enable SSR is to install the node adapter by entering <code>npx astro add node</code>. This changes the <code>astro.config.mjs</code> file to use <code>output: &quot;server&quot;</code>.</p><p>When SSR is enabled, running <code>npm run build</code> will not generate HTML files for dynamic routes. Instead, the HTML for dynamic routes will be generated when requested by a client.</p><p>When a dynamic route such as <code>[name].astro</code> is used to render a content collection document and no matching document is found, it can use code like the following in the component script to treat this like a &quot;404 Not Found&quot; error:</p><pre class="language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>document<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">404</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Dynamic route file names can contain an ellipsis to use <a href="https://docs.astro.build/en/core-concepts/routing/#rest-parameters?v=1.1.1" rel="noopener" target="_blank">rest parameters</a>. For example, the file <code>src/pages/zoo/[...path].astro</code> can match the paths <code>/zoo</code>, <code>/zoo/cats</code>, and <code>/zoo/cats/panther</code>.</p><h2 id="event-handling" tabindex="-1">Event Handling</h2><p>Code in the component script section is only run on the server-side. This means functions defined there cannot be used for client-side event handling.</p><p>One way specify client-side JavaScript code is to place it in a script tag within the HTML section. For example:</p><pre class="language-js"><code class="language-js"><span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"my-btn"</span><span class="token operator">></span>Press Me<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><br><br><span class="token operator">&lt;</span>script<span class="token operator">></span><br>  <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'got click'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">const</span> myBtn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'my-btn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  myBtn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> handleClick<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><h2 id="content-collections" tabindex="-1">Content Collections</h2><p>Astro supports describing and retrieving collections of data from files that are in a subdirectory the <code>src/content</code> directory. Each subdirectory represents a different collection. The files can use the Markdown, MDX, YAML, or JSON format. All files in a collection must use the same format.</p><p>An analogy can be made between content collections and relational database tables. Each <code>src/content</code> subdirectory is like a database table. Each file in these subdirectories is like a row in a database table. Content collections are like databases without SQL where the only supported queries are retrieving a single document or all documents in a collection.</p><p>Modifying data in a database through API calls made from a web app can result in different data being subsequently rendered. However, modifying content collection documents during runtime will not result in different data being rendered. Think of content collection documents as being static rather than dynamic. So databases or CMSes should be used instead of content collections when dynamic updates are required.</p><p>The following steps can be taken to define and render a collection of dogs.</p><ul><li><p>Create the directory <code>src/content</code>.</p></li><li><p>Create the file <code>config.ts</code> in this directory.</p><p>This file defines each of the collections. It uses <a href="/blog/topics/#/blog/zod" target="_blank">Zod</a> to describe and validate the schema of each collection. The schema defines which front matter properties are valid and provides a type-safe way to use the data. Editors like VS Code use the types to provide intellisense.</p><p>For example, the following describes a single collection named &quot;dogs&quot;.</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>defineCollection<span class="token punctuation">,</span> z<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'astro:content'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> dogs <span class="token operator">=</span> <span class="token function">defineCollection</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  type<span class="token operator">:</span> <span class="token string">'content'</span><span class="token punctuation">,</span> <span class="token comment">// or 'data' when not using Markdown or MDX</span><br>  schema<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    <span class="token comment">// The return value from z.string() can be saved in a variable</span><br>    <span class="token comment">// and used on multiple properties to avoid calling it repeatedly.</span><br>    name<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    breed<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> collections <span class="token operator">=</span> <span class="token punctuation">{</span>dogs<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>To include references to optimized images, change the schema property as follows:</p><pre class="language-ts"><code class="language-ts"><span class="token function-variable function">schema</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>image<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span><br>  z<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    name<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    breed<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    photo<span class="token operator">:</span> <span class="token function">image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>This enables the <code>photo</code> property to be used in an <code>Image</code> component as the value if the <code>src</code> attribute.</p></li><li><p>Create the directory <code>src/content/dogs</code>.</p></li><li><p>Create one content file for each dog inside this directory.</p><p>Here is an example Markdown file:</p><pre class="language-md"><code class="language-md"><span class="token front-matter-block"><span class="token punctuation">---</span><br><span class="token front-matter yaml language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> Comet<br><span class="token key atrule">breed</span><span class="token punctuation">:</span> Whippet<br><span class="token key atrule">website</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//www.akc.org/dog<span class="token punctuation">-</span>breeds/whippet/</span><br><span class="token punctuation">---</span></span><br><br>He loves the following:<br><br><span class="token list punctuation">-</span> pool balls<br><span class="token list punctuation">-</span> basketballs<br><span class="token list punctuation">-</span> frisbees</code></pre><p>Note the use of front matter to describe properties of this instance. String values of front matter properties do not need to be delimited with quotes.</p><p>When only the front matters is needed and no content, the YAML and JSON formats can be used instead.</p><p>Here is an example YAML file:</p><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">---</span><br><span class="token key atrule">name</span><span class="token punctuation">:</span> Comet<br><span class="token key atrule">breed</span><span class="token punctuation">:</span> Whippet<br><span class="token key atrule">website</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//www.akc.org/dog<span class="token punctuation">-</span>breeds/whippet/</code></pre><p>Here is an example JSON file:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Comet"</span><span class="token punctuation">,</span><br>  <span class="token property">"breed"</span><span class="token operator">:</span> <span class="token string">"Whippet"</span><span class="token punctuation">,</span><br>  <span class="token property">"website"</span><span class="token operator">:</span> <span class="token string">"https://www.akc.org/dog-breeds/whippet/"</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Access the collection in a component.</p><p>For example:</p><p><img alt="Astro Dogs" style="width: 50%" src="/blog/assets/astro-dogs.png?v=1.1.1"></p><pre class="language-js"><code class="language-js"><span class="token operator">--</span><span class="token operator">-</span><br><span class="token keyword">import</span> Layout <span class="token keyword">from</span> <span class="token string">"../../layouts/Layout.astro"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> Dog <span class="token keyword">from</span> <span class="token string">"../../components/Dog.astro"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> getCollection<span class="token punctuation">,</span> type CollectionEntry <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"astro:content"</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token literal-property property">dogs</span><span class="token operator">:</span> CollectionEntry<span class="token operator">&lt;</span><span class="token string">"dogs"</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getCollection</span><span class="token punctuation">(</span><span class="token string">"dogs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token operator">--</span><span class="token operator">-</span><br><br><span class="token operator">&lt;</span>Layout title<span class="token operator">=</span><span class="token string">"Dogs I Know"</span><span class="token operator">></span><br>  <span class="token operator">&lt;</span>main <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"m-4"</span><span class="token operator">></span><br>    <span class="token punctuation">{</span> dogs<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">dog</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>Dog <span class="token punctuation">{</span>dog<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">}</span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>main<span class="token operator">></span><br><span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">></span></code></pre><p>The <code>getCollection</code> function accepts a second argument that is a function used to filter the entries. It is passed <code>data</code> objects one at a time and should return a boolean value indicating whether the corresponding <code>CollectionEntry</code> object should be included in the result array.</p></li><li><p>Create the <code>Dog</code> component:</p><p><img alt="Astro Dog component" style="width: 30%" src="/blog/assets/astro-content-collections-comet.png?v=1.1.1"></p><pre class="language-ts"><code class="language-ts"><span class="token operator">--</span><span class="token operator">-</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">type</span> <span class="token class-name">CollectionEntry</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"astro:content"</span><span class="token punctuation">;</span><br><br><span class="token keyword">interface</span> <span class="token class-name">Props</span> <span class="token punctuation">{</span><br>  dog<span class="token operator">:</span> CollectionEntry<span class="token operator">&lt;</span><span class="token string">"dogs"</span><span class="token operator">></span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">const</span> <span class="token punctuation">{</span> dog <span class="token punctuation">}</span> <span class="token operator">=</span> Astro<span class="token punctuation">.</span>props<span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token punctuation">{</span> breed<span class="token punctuation">,</span> image<span class="token punctuation">,</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> dog<span class="token punctuation">.</span>data<span class="token punctuation">;</span><br><span class="token comment">// This gets a component that will render</span><br><span class="token comment">// the content of the dog CollectionEntry.</span><br><span class="token keyword">const</span> <span class="token punctuation">{</span> Content <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> dog<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token operator">--</span><span class="token operator">-</span><br><br><span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span><br><span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"my-4"</span><span class="token operator">></span><br>  <span class="token operator">&lt;</span>p <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"font-bold"</span><span class="token operator">></span><span class="token punctuation">{</span>name<span class="token punctuation">}</span> <span class="token keyword">is</span> a <span class="token punctuation">{</span>breed<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><br>  <span class="token operator">&lt;</span>Content <span class="token operator">/</span><span class="token operator">></span><br>  <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token punctuation">{</span>website<span class="token punctuation">}</span><span class="token operator">></span>American Kennel Club<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><br><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span></code></pre></li></ul><p>For a more complete example of using content collections, see the project <a href="https://github.com/mvolkmann/astro-examples/tree/main/content-collections?v=1.1.1" rel="noopener" target="_blank">content-collections</a>. This displays a component for each NFL team on the initial page. Clicking the component for any team navigates to a detail page using view transitions.</p><p><img alt="Astro content collections NFL home" style="width: 49%" src="/blog/assets/astro-content-collections-nfl-home.png?v=1.1.1"> <img alt="Astro content collections NFL detail" style="width: 49%" src="/blog/assets/astro-content-collections-nfl-detail.png?v=1.1.1"></p><p>The file <code>src/content/config.ts</code> which defines the schema for the for collection documents contains the following:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>defineCollection<span class="token punctuation">,</span> z<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'astro:content'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> nfl <span class="token operator">=</span> <span class="token function">defineCollection</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  type<span class="token operator">:</span> <span class="token string">'content'</span><span class="token punctuation">,</span> <span class="token comment">// 'content' for Markdown; 'data' for YAML and JSON</span><br>  schema<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    city<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    name<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    conference<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    logoUrl<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    headCoach<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    established<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> collections <span class="token operator">=</span> <span class="token punctuation">{</span>nfl<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>The file <code>src/content/nfl/kansas-city-chiefs.md</code> is one example of the content files described by the schema above. It contains the following:</p><pre class="language-md"><code class="language-md"><span class="token front-matter-block"><span class="token punctuation">---</span><br><span class="token front-matter yaml language-yaml"><span class="token key atrule">city</span><span class="token punctuation">:</span> Kansas City<br><span class="token key atrule">name</span><span class="token punctuation">:</span> Chiefs<br><span class="token key atrule">conference</span><span class="token punctuation">:</span> AFC West<br><span class="token key atrule">logoUrl</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//res.cloudinary.com/nflleague/image/private/f_auto/league/ujshjqvmnxce8m4obmvs<br><span class="token key atrule">headCoach</span><span class="token punctuation">:</span> Andy Reid<br><span class="token key atrule">established</span><span class="token punctuation">:</span> <span class="token number">1960</span></span><br><span class="token punctuation">---</span></span><br><br>After losing to the Raiders on Christmas Day, the Chiefs ...</code></pre><p>When using a service like Netlify or Vercel to host an Astro app, pushing changes to the GitHub repository of the app will trigger a new build and deployment of the app. If content collection documents were added, modified, or deleted, this will result in changes to the deployed static pages.</p><h3 id="references" tabindex="-1">References</h3><p>A content collection document can contain properties that refer to one or more other documents in the same or a different collection. For example, a document describing one football team in a collection named &quot;nfl&quot; can refer to other teams with the following property defined in <code>src/content/config.ts</code>:</p><pre class="language-ts"><code class="language-ts">relatedTeams<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token function">reference</span><span class="token punctuation">(</span><span class="token string">'nfl'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">optional</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Here is a document that includes this optional property:</p><pre class="language-md"><code class="language-md"><span class="token front-matter-block"><span class="token punctuation">---</span><br><span class="token front-matter yaml language-yaml"><span class="token key atrule">city</span><span class="token punctuation">:</span> Arizona<br><span class="token key atrule">name</span><span class="token punctuation">:</span> Cardinals<br><span class="token key atrule">conference</span><span class="token punctuation">:</span> NFC West<br><span class="token key atrule">logoUrl</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//static.www.nfl.com/image/private/f_auto/league/u9fltoslqdsyao8cpm0k<br><span class="token key atrule">headCoach</span><span class="token punctuation">:</span> Jonathan Gannon<br><span class="token key atrule">established</span><span class="token punctuation">:</span> <span class="token number">1920</span><br><span class="token key atrule">relatedIds</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'atlanta-falcons'</span><span class="token punctuation">,</span> <span class="token string">'baltimore-ravens'</span><span class="token punctuation">,</span> <span class="token string">'buffalo-bills'</span><span class="token punctuation">]</span></span><br><span class="token punctuation">---</span></span></code></pre><p>A component can access related documents with the <a href="https://docs.astro.build/en/reference/api-reference/#getentries?v=1.1.1" rel="noopener" target="_blank">getEntries</a> function. For example:</p><pre class="language-ts"><code class="language-ts"><span class="token operator">--</span><span class="token operator">-</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>getEntries<span class="token punctuation">,</span> <span class="token keyword">type</span> <span class="token class-name">CollectionEntry</span><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'astro:content'</span><span class="token punctuation">;</span><br><br><span class="token keyword">interface</span> <span class="token class-name">Props</span> <span class="token punctuation">{</span><br>  team<span class="token operator">:</span> CollectionEntry<span class="token operator">&lt;</span><span class="token string">'nfl'</span><span class="token operator">></span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">const</span> <span class="token punctuation">{</span>team<span class="token punctuation">}</span> <span class="token operator">=</span> Astro<span class="token punctuation">.</span>props<span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token punctuation">{</span>relatedTeams<span class="token punctuation">}</span> <span class="token operator">=</span> team<span class="token punctuation">.</span>data<span class="token punctuation">;</span><br><span class="token keyword">const</span> relatedEntries <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getEntries</span><span class="token punctuation">(</span>relatedTeams <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token operator">--</span><span class="token operator">-</span><br><br><span class="token operator">&lt;</span>ul<span class="token operator">></span><br>  <span class="token punctuation">{</span>relatedEntries<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><br>    <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token punctuation">{</span>entry<span class="token punctuation">.</span>data<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span><br>  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><br><span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span></code></pre><h3 id="sanitizing-content" tabindex="-1">Sanitizing Content</h3><p>The content below the front matter in collection documents is not sanitized. If there is a possibility that the content might contain something that causes a Cross Site Scripting (XSS) attack (such as <code>script</code> tags), then a different approach should be taken to render the content.</p><p>One approach is the install the npm packages sanitize-html, @types/sanitize-html, and marked. In the component script of the Astro component that renders the content, add the following:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> marked <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'marked'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> sanitizeHtml <span class="token keyword">from</span> <span class="token string">'sanitize-html'</span><span class="token punctuation">;</span><br><span class="token operator">...</span><br><span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token function">sanitizeHtml</span><span class="token punctuation">(</span>collectionEntry<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> html <span class="token operator">=</span> marked<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Then instead of rendering <code>&lt;Content /&gt;</code>, render <code>&lt;div set:html={html} /&gt;</code>.</p><p>If the styling is less that desirable, consider applying the <code>prose</code> CSS class from the @tailwindcss/typography plugin.</p><h3 id="pagination" tabindex="-1">Pagination</h3><p>Astro provides help for implementing pagination of content collections. For details, see <a href="https://docs.astro.build/en/core-concepts/routing/#pagination?v=1.1.1" rel="noopener" target="_blank">Routing - Pagination</a>.</p><p>The project <a href="https://github.com/mvolkmann/astro-examples/tree/main/content-collections?v=1.1.1" rel="noopener" target="_blank">content-collections</a> provides a good example. The file <code>src/pages/[...page].astro</code>, shown below, defines the pages for the URLs &quot;/&quot; (first page) and &quot;/{page-number}&quot; (all pages after the first). The URL &quot;/all&quot; navigates to the page that shows all the teams.</p><p><img alt="Astro Pagination" style="width: 100%" src="/blog/assets/astro-pagination.png?v=1.1.1"></p><pre class="language-js"><code class="language-js"><span class="token operator">--</span><span class="token operator">-</span><br><span class="token keyword">import</span> type <span class="token punctuation">{</span> InferGetStaticPropsType<span class="token punctuation">,</span> GetStaticPaths <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'astro'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>getCollection<span class="token punctuation">,</span> getEntry<span class="token punctuation">,</span> type CollectionEntry<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'astro:content'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> TeamSmall <span class="token keyword">from</span> <span class="token string">'../components/TeamSmall.astro'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> Layout <span class="token keyword">from</span> <span class="token string">'../layouts/Layout.astro'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">'../styles/global.css'</span><span class="token punctuation">;</span><br><br>type Props <span class="token operator">=</span> InferGetStaticPropsType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> getStaticPaths<span class="token operator">></span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> getStaticPaths <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>paginate<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> <span class="token literal-property property">teams</span><span class="token operator">:</span> CollectionEntry<span class="token operator">&lt;</span><span class="token string">'nfl'</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getCollection</span><span class="token punctuation">(</span><span class="token string">'nfl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> pages <span class="token operator">=</span> teams<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">team</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><br>        <span class="token punctuation">{</span> <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">slug</span><span class="token operator">:</span> team<span class="token punctuation">.</span>slug <span class="token punctuation">}</span> <span class="token punctuation">}</span><br>    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> <span class="token function">paginate</span><span class="token punctuation">(</span>pages<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">pageSize</span><span class="token operator">:</span> <span class="token number">8</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span> satisfies GetStaticPaths<span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token punctuation">{</span> page <span class="token punctuation">}</span> <span class="token operator">=</span> Astro<span class="token punctuation">.</span>props <span class="token keyword">as</span> Props<span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token punctuation">{</span> currentPage<span class="token punctuation">,</span> data<span class="token punctuation">,</span> lastPage<span class="token punctuation">,</span> url <span class="token punctuation">}</span> <span class="token operator">=</span> page<span class="token punctuation">;</span><br><span class="token keyword">const</span> nextUrl <span class="token operator">=</span> url<span class="token punctuation">.</span>next<span class="token punctuation">;</span><br><span class="token keyword">const</span> prevUrl <span class="token operator">=</span> url<span class="token punctuation">.</span>prev<span class="token punctuation">;</span><br><br><span class="token comment">// Get entries to render on the current page.</span><br><span class="token keyword">const</span> promises <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">getEntry</span><span class="token punctuation">(</span><span class="token string">'nfl'</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>params<span class="token punctuation">.</span>slug<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> entries <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token operator">--</span><span class="token operator">-</span><br><br><span class="token operator">&lt;</span>Layout<span class="token operator">></span><br>  <span class="token operator">&lt;</span>main <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"bg-black h-full min-h-screen p-8"</span><span class="token operator">></span><br>    <span class="token operator">&lt;</span>h1<span class="token operator">></span>Page <span class="token punctuation">{</span>currentPage<span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token punctuation">{</span>lastPage<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><br>    <span class="token operator">&lt;</span>p<span class="token operator">></span>The teams appear alphabetically by their city<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><br>    <span class="token operator">&lt;</span>nav<span class="token operator">></span><br>      <span class="token operator">&lt;</span>a <span class="token keyword">class</span><span class="token operator">:</span>list<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">disabled</span><span class="token operator">:</span> currentPage <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span> href<span class="token operator">=</span><span class="token string">"/"</span><span class="token operator">></span>First<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><br>      <span class="token operator">&lt;</span>a <span class="token keyword">class</span><span class="token operator">:</span>list<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">disabled</span><span class="token operator">:</span> <span class="token operator">!</span>prevUrl<span class="token punctuation">}</span><span class="token punctuation">}</span> href<span class="token operator">=</span><span class="token punctuation">{</span>prevUrl<span class="token punctuation">}</span><span class="token operator">></span>Previous<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><br>      <span class="token operator">&lt;</span>a <span class="token keyword">class</span><span class="token operator">:</span>list<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">disabled</span><span class="token operator">:</span> <span class="token operator">!</span>nextUrl<span class="token punctuation">}</span><span class="token punctuation">}</span> href<span class="token operator">=</span><span class="token punctuation">{</span>nextUrl<span class="token punctuation">}</span><span class="token operator">></span>Next<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><br>      <span class="token operator">&lt;</span>a <span class="token keyword">class</span><span class="token operator">:</span>list<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">disabled</span><span class="token operator">:</span> currentPage <span class="token operator">===</span> lastPage<span class="token punctuation">}</span><span class="token punctuation">}</span><br>        href<span class="token operator">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lastPage<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span><span class="token operator">></span>Last<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><br>      <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"/all"</span><span class="token operator">></span>All<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>nav<span class="token operator">></span><br>    <span class="token operator">&lt;</span>section <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"gap-4 grid grid-cols-4"</span><span class="token operator">></span><br>      <span class="token punctuation">{</span>entries<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">entry</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>TeamSmall team<span class="token operator">=</span><span class="token punctuation">{</span>entry<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">}</span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">></span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>main<span class="token operator">></span><br><span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">></span></code></pre><p>The code above uses the <a href="https://docs.astro.build/en/reference/api-reference/#getentry?v=1.1.1" rel="noopener" target="_blank">getEntry</a> function to retrieve a specific content collection entry.</p><p>An entry can have a property whose value is an array of ids for related entries within the same collection. To retrieve those, pass the array to the <a href="https://docs.astro.build/en/reference/api-reference/#getentries?v=1.1.1" rel="noopener" target="_blank">getEntries</a> function.</p><h3 id="incremental-content-caching" tabindex="-1">Incremental Content Caching</h3><p>Build times for projects that generate pages from large content collection can be significantly reduced by enabling an experimental feature that avoids doing work for documents that have not changed since the last build. To enable it, add the following to the object passed to the <code>defineConfig</code> function in <code>astro.config.mjs</code>:</p><pre class="language-js"><code class="language-js">  <span class="token literal-property property">experimental</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">contentCollectionCache</span><span class="token operator">:</span> <span class="token boolean">true</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><p>Currently this only caches specific modules related to content collections and adds files in the <code>node_modules/.astro</code> directory. In the future this may also cache the generated <code>.html</code> files.</p><p>Unfortunately, I could not get this feature to work. From a comment in the Discord channel, &quot;It's still quite early and very experimental, so I wouldn't be surprised if there's a lot of edge cases where it doesn't work.&quot;</p><h2 id="astro.glob" tabindex="-1">Astro.glob</h2><p>The <a href="https://docs.astro.build/en/guides/imports/#astroglob?v=1.1.1" rel="noopener" target="_blank">Astro.glob</a> function provides another way to access the content of a collection of Markdown files.</p><p>For example, the Markdown files from the NFL content collection example above can be moved to the <code>src/data/nfl</code> directory.</p><p>The following is an example of one of these Markdown files:</p><pre class="language-md"><code class="language-md"><span class="token front-matter-block"><span class="token punctuation">---</span><br><span class="token front-matter yaml language-yaml"><span class="token key atrule">city</span><span class="token punctuation">:</span> Kansas City<br><span class="token key atrule">name</span><span class="token punctuation">:</span> Chiefs<br><span class="token key atrule">conference</span><span class="token punctuation">:</span> AFC West<br><span class="token key atrule">logoUrl</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//res.cloudinary.com/nflleague/image/private/f_auto/league/ujshjqvmnxce8m4obmvs<br><span class="token key atrule">headCoach</span><span class="token punctuation">:</span> Andy Reid<br><span class="token key atrule">established</span><span class="token punctuation">:</span> <span class="token number">1960</span></span><br><span class="token punctuation">---</span></span><br><br>After losing to the Raiders on Christmas Day, the Chiefs ...</code></pre><p>The following Astro component reads and renders the data in these Markdown files:</p><p><img alt="Astro.glob demo" style="width: 100%" src="/blog/assets/astro-glob-demo.png?v=1.1.1"></p><pre class="language-js"><code class="language-js"><span class="token operator">--</span><span class="token operator">-</span><br><span class="token keyword">const</span> teams <span class="token operator">=</span> <span class="token keyword">await</span> Astro<span class="token punctuation">.</span><span class="token function">glob</span><span class="token punctuation">(</span><span class="token string">"../data/nfl/*.md"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token operator">--</span><span class="token operator">-</span><br><br>teams<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> Content<span class="token punctuation">,</span> frontmatter <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><br>  <span class="token operator">&lt;</span>div<span class="token operator">></span><br>    <span class="token operator">&lt;</span>h2<span class="token operator">></span><span class="token punctuation">{</span>frontmatter<span class="token punctuation">.</span>name<span class="token punctuation">}</span> <span class="token punctuation">{</span>frontmatter<span class="token punctuation">.</span>city<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span><br>    <span class="token operator">&lt;</span>Content <span class="token operator">/</span><span class="token operator">></span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>Using <code>Astro.glob</code> is a bit easier than using content collections. But content collections have many advantages including handling references between documents, property validation with <a href="/blog/topics/#/blog/zod" target="_blank">Zod</a>, pagination support, and incremental content caching.</p><p>The <code>Astro.glob</code> function can also read JSON files. For example, suppose each of the NFL <code>.md</code> files were instead <code>.json</code> files like the following:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"city"</span><span class="token operator">:</span> <span class="token string">"Kansas City"</span><span class="token punctuation">,</span><br>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Chiefs"</span><span class="token punctuation">,</span><br>  <span class="token property">"conference"</span><span class="token operator">:</span> <span class="token string">"AFC West"</span><span class="token punctuation">,</span><br>  <span class="token property">"logoUrl"</span><span class="token operator">:</span> <span class="token string">"https://res.cloudinary.com/nflleague/image/private/f_auto/league/ujshjqvmnxce8m4obmvs"</span><span class="token punctuation">,</span><br>  <span class="token property">"headCoach"</span><span class="token operator">:</span> <span class="token string">"Andy Reid"</span><span class="token punctuation">,</span><br>  <span class="token property">"established"</span><span class="token operator">:</span> <span class="token number">1960</span><span class="token punctuation">,</span><br>  <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"After losing to the Raiders on Christmas Day, the Chiefs ..."</span><br><span class="token punctuation">}</span></code></pre><p>The following Astro component reads and renders the data in these JSON files:</p><pre class="language-js"><code class="language-js"><span class="token operator">--</span><span class="token operator">-</span><br><span class="token keyword">const</span> teams <span class="token operator">=</span> <span class="token keyword">await</span> Astro<span class="token punctuation">.</span><span class="token function">glob</span><span class="token punctuation">(</span><span class="token string">"../data/nfl/*.json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token operator">--</span><span class="token operator">-</span><br><br>teams<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> city<span class="token punctuation">,</span> content<span class="token punctuation">,</span> logoUrl<span class="token punctuation">,</span> name <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><br>  <span class="token operator">&lt;</span>div<span class="token operator">></span><br>    <span class="token operator">&lt;</span>h2<span class="token operator">></span><span class="token punctuation">{</span>name<span class="token punctuation">}</span> <span class="token punctuation">{</span>city<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span><br>    <span class="token operator">&lt;</span>img alt<span class="token operator">=</span><span class="token string">"team logo"</span> src<span class="token operator">=</span><span class="token punctuation">{</span>logoUrl<span class="token punctuation">}</span> width<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">50</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><br>    <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">{</span>content<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h2 id="content-management-systems-(cms)" tabindex="-1">Content Management Systems (CMS)</h2><p>Astro can fetch content from many kinds of CMSes. These typically provide a better content authoring experience for non-technical users than editing Markdown files.</p><p>The content from CMSes is not treated the same as content collection Markdown files. Different code that is specific to the CMS must be written to access and render the content.</p><p>Astro has integrations for the following CMSes including CloudCannon, Contentful, Netlify, Sanity, Storyblok, Strapi, Wordpress, and many more.</p><p>For general details, see <a href="https://docs.astro.build/en/guides/cms/?v=1.1.1" rel="noopener" target="_blank">Use a CMS with Astro</a>.</p><p>For details on using the Strapi CMS, see the YouTube video <a href="https://www.youtube.com/watch?v=pVJCROlsIp4?v=1.1.1" rel="noopener" target="_blank">Getting Started with Astro and Strapi</a> and the associated article <a href="https://strapi.io/blog/how-to-build-a-blog-with-astro-strapi-and-tailwind-css?v=1.1.1" rel="noopener" target="_blank">How to Build a Blog with Astro, Strapi, and Tailwind CSS</a>.</p><h2 id="mdx" tabindex="-1">MDX</h2><p>The MDX integration adds the following features to Markdown:</p><ul><li><p>ability to define JavaScript variables whose values come from JavaScript expressions</p></li><li><p>ability to insert the values of front matter properties and JavaScript variables into the content using curly braces</p></li><li><p>ability to render components implemented in any of the supported frameworks</p></li></ul><p>Rendered components can add interactivity to what would otherwise be static content.</p><p>MDX files have the <code>.mdx</code> file extension.</p><p>MDX syntax differs from Markdown syntax in a few ways that are described at <a href="https://github.com/micromark/mdx-state-machine#72-deviations-from-markdown?v=1.1.1" rel="noopener" target="_blank">Deviations from Markdown</a>.</p><p>To install the MDX integration in an Astro project, enter <code>npx astro add mdx</code>.</p><p>Here is an example of a page described by a <code>.mdx</code> file that demonstrates inserting front matter properties and JavaScript variables.</p><pre class="language-md"><code class="language-md"><span class="token front-matter-block"><span class="token punctuation">---</span><br><span class="token front-matter yaml language-yaml"><span class="token key atrule">layout</span><span class="token punctuation">:</span> ../layouts/Layout.astro<br><span class="token key atrule">player</span><span class="token punctuation">:</span> Mark<br><span class="token key atrule">score</span><span class="token punctuation">:</span> <span class="token number">19</span></span><br><span class="token punctuation">---</span></span><br><br>This page is described by <span class="token bold"><span class="token punctuation">**</span><span class="token content">MDX</span><span class="token punctuation">**</span></span>.<br><br>The score for {frontmatter.player} is {frontmatter.score}.<br><br>export const twoPi = (Math.PI \* 2).toFixed(4);<br><br>2 is approximately {twoPi}.</code></pre><p>Here is a component definition in the file <code>src/components/Greet.astro</code>:</p><pre class="language-js"><code class="language-js"><span class="token operator">--</span><span class="token operator">-</span><br><span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> Astro<span class="token punctuation">.</span>props<span class="token punctuation">;</span><br><span class="token operator">--</span><span class="token operator">-</span><br><br><span class="token operator">&lt;</span>p <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"text-bold text-red-500"</span><span class="token operator">></span>Hello<span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span></code></pre><p>Here is MDX in the file <code>src/content/dogs/comet.mdx</code> that imports and renders the <code>Greet</code> component.</p><pre class="language-md"><code class="language-md"><span class="token front-matter-block"><span class="token punctuation">---</span><br><span class="token front-matter yaml language-yaml"><span class="token key atrule">layout</span><span class="token punctuation">:</span> ../layouts/Layout.astro<br><span class="token key atrule">name</span><span class="token punctuation">:</span> Comet<br><span class="token key atrule">breed</span><span class="token punctuation">:</span> Whippet<br><span class="token key atrule">website</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//www.akc.org/dog<span class="token punctuation">-</span>breeds/whippet/</span><br><span class="token punctuation">---</span></span><br><br>import Greet from "../../components/Greet.astro";<br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Greet</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{frontmatter.name}</span> <span class="token punctuation">/></span></span><br><br>He loves the following:<br><br><span class="token list punctuation">-</span> pool balls<br><span class="token list punctuation">-</span> basketballs<br><span class="token list punctuation">-</span> frisbees<br><br>Learn about the <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{frontmatter.website}</span><span class="token punctuation">></span></span>{frontmatter.breed}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>.</code></pre><h2 id="other-frameworks" tabindex="-1">Other Frameworks</h2><p>Astro supports using components from many other frameworks including Alpine, Lit, Preact, React, SolidJS, Svelte, Vue, WebComponents, and more.</p><h3 id="react" tabindex="-1">React</h3><p>Let's walk through the steps to use a <a href="https://react.dev?v=1.1.1" rel="noopener" target="_blank">React</a> component.</p><ol><li><p>Install the React integration by entering <code>npx astro add react</code>.</p></li><li><p>Define a React component in the <code>src/components</code> directory.</p><p>For example, here is the file <code>Counter.tsx</code>:</p><pre class="language-html"><code class="language-html">import {type FC, useState} from 'react';<br><br>interface Props {<br>  label?: string;<br>  start?: number;<br>}<br><br>const Counter: FC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Props</span><span class="token punctuation">></span></span> = ({label = '', start = 0}) => {<br>  const [count, setCount] = useState(start);<br><br>  return (<br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value css language-css"><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token property">display</span><span class="token punctuation">:</span></span></span></span> <span class="token attr-name">'flex',</span> <span class="token attr-name"><span class="token namespace">alignItems:</span></span> <span class="token attr-name">'center',</span> <span class="token attr-name"><span class="token namespace">gap:</span></span> <span class="token attr-name">'1rem'}}</span><span class="token punctuation">></span></span><br>      {label &amp;&amp; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>{label}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>}<br>      &lt;button disabled={count &lt;= 0} onClick={() => setCount(c => c - 1)}><br>        -<br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>{count}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>      &lt;button onClick={() => setCount(c => c + 1)}>+<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>  );<br>};<br><br>export default Counter;</code></pre></li><li><p>Use the new component in another component or page.</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">"@components/Counter.tsx"</span><span class="token punctuation">;</span><br><span class="token operator">...</span><br><span class="token operator">&lt;</span>Counter label<span class="token operator">=</span><span class="token string">"Tally"</span> start<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">}</span> client<span class="token operator">:</span>load <span class="token operator">/</span><span class="token operator">></span></code></pre><p>There are five provided <code>client</code> directives that tell Astro that a non-Astro component requires client-side JavaScript code to be loaded. The <code>client</code> directives differ in when the JavaScript will be loaded. When not applied, JavaScript for non-Astro components is not loaded.</p><p><code>client</code> directives cannot be applied to Astro components. However, <code>script</code> tags in Astro components are always included in clients.</p><table><thead><tr><th>Directive</th><th>When JS is loaded</th></tr></thead><tbody><tr><td><code>client:idle</code></td><td>when browser is idle</td></tr><tr><td><code>client:load</code></td><td>immediately</td></tr><tr><td><code>client:media</code></td><td>when a CSS media query condition is met</td></tr><tr><td><code>client:only</code></td><td>after page load with no SSR</td></tr><tr><td><code>client:visible</code></td><td>when component becomes visible</td></tr></tbody></table><p>Integrations can add support for custom <code>client</code> directives.</p></li></ol><p>For more detail on using React components in Astro, see <a href="https://docs.astro.build/en/guides/integrations-guide/react/?v=1.1.1" rel="noopener" target="_blank">React integration</a>.</p><h3 id="svelte" tabindex="-1">Svelte</h3><p>Let's walk through the steps to use a <a href="https://svelte.dev?v=1.1.1" rel="noopener" target="_blank">Svelte</a> component.</p><ol><li><p>Install the Svelte integration by entering <code>npx astro add svelte</code>.</p></li><li><p>Define a Svelte component in the <code>src/components</code> directory.</p><p>For example, here is the file <code>Counter.svelte</code>:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">export</span> <span class="token keyword">let</span> label <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br>  <span class="token keyword">export</span> <span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">let</span> count <span class="token operator">=</span> start<span class="token punctuation">;</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>row<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  {#if label}<br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>{label}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>  {/if}<br>  &lt;button disabled={count &lt;= 0} on:click={() => count--}>-<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>{count}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>  &lt;button on:click={() => count++}>+<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><br>  <span class="token selector">.row</span> <span class="token punctuation">{</span><br>    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span><br>    <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><br>    <span class="token property">gap</span><span class="token punctuation">:</span> 1rem<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre></li><li><p>Use the new component in another component or page.</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">"@components/Counter.svelte"</span><span class="token punctuation">;</span><br><span class="token operator">...</span><br><span class="token operator">&lt;</span>Counter label<span class="token operator">=</span><span class="token string">"Tally"</span> start<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">}</span> client<span class="token operator">:</span>load <span class="token operator">/</span><span class="token operator">></span></code></pre></li></ol><p>For more detail on using Svelte components in Astro, see <a href="https://docs.astro.build/en/guides/integrations-guide/svelte/?v=1.1.1" rel="noopener" target="_blank">Svelte integration</a>.</p><h3 id="alpine" tabindex="-1">Alpine</h3><p>The <a href="https://alpinejs.dev?v=1.1.1" rel="noopener" target="_blank">Alpine</a> JavaScript library can be used in Astro components to add interactivity. This is an alternative to implementing interactive components using another framework such as React, Svelte, or Vue.</p><p>To install the Alpine integration, enter <code>npx astro add alpinejs</code>.</p><p>However, Astro components are always rendered at build time or on the server (SSR). Unlike with frameworks like React and Svelte, it is not possible for runtime changes to their props to trigger them to re-render.</p><p>One alternative is to register event listeners that directly update the DOM. This is considerably more tedious and error prone than implementing components in a framework like Svelte.</p><p>A better alternative is to update the Alpine <code>x-data</code> objects that supply data to the components that need to update. For an example of this approach, see <a href="https://github.com/mvolkmann/astro-examples/tree/main/alpine-demo?v=1.1.1" rel="noopener" target="_blank">alpine-demo</a></p><h4 id="defining-functions" tabindex="-1">Defining Functions</h4><p>Often Astro components that use Alpine need to call custom JavaScript functions. But where should the functions be defined?</p><p>Alpine CANNOT call functions defined in these ways:</p><ul><li><p>component script section</p><p>Code that appears here is only available at build time or on the server during SSR.</p><p>For example, this WILL NOT make the <code>demo</code> function available to Alpine.</p><pre class="language-js"><code class="language-js"><span class="token operator">--</span><span class="token operator">-</span><br><span class="token keyword">function</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'in demo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><span class="token operator">--</span><span class="token operator">-</span></code></pre></li><li><p><code>&lt;script&gt;</code> with no attributes</p><p>Vite performs tree shaking and will not recognize function calls made in Alpine directives. This will result in the removal of function definitions that appear in plain <code>script</code> tags.</p><p>For example, this WILL NOT make the <code>demo</code> function available to Alpine.</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">function</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'in demo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre></li><li><p><code>&lt;script type=&quot;module&quot;&gt;</code></p><p>Module scripts create their own scope, so functions defined in these are not visible outside unless they are exported and then imported into another <code>script</code>. But <code>import</code> statements can only appear in other module scripts.</p><p>For example, this WILL NOT make the <code>demo</code> function available to Alpine.</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">function</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'in demo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre></li></ul><p>Alpine CAN call functions defined in these ways:</p><ul><li><p><code>&lt;script defer&gt;</code></p><p>From MDN, the <code>defer</code> attribute &quot;is set to indicate to a browser that the script is meant to be executed after the document has been parsed, but before firing DOMContentLoaded.&quot;</p><p>Vite does not perform tree shaking of functions defined in this kind of <code>script</code> tag.</p><p>For example, this WILL make the <code>demo</code> function available to Alpine.</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">defer</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">function</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'in demo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre></li><li><p><code>&lt;script is:inline&gt;</code></p><p>The <code>is:inline</code> directive tells Astro include this <code>script</code> as-is in the DOM. Astro will not bundle this JavaScript or remove duplicates.</p><p>Vite does not perform tree shaking of functions defined in this kind of <code>script</code> tag.</p><p>For example, this WILL make the <code>demo</code> function available to Alpine.</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name"><span class="token namespace">is:</span>inline</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">function</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'in demo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre></li><li><p><code>globalThis</code></p><p>Functions attached to the global object are available everywhere. To avoid polluting the global namespace with a large number of function names, consider attaching one object to the global object that holds all the functions.</p><p>For example, this WILL make the <code>ns.demo</code> function available to Alpine and can be called with <code>ns.demo()</code>.</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name"><span class="token namespace">is:</span>inline</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  globalThis<span class="token punctuation">.</span>ns <span class="token operator">=</span> <span class="token punctuation">{</span><br>    <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'in demo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre></li><li><p>dynamic imports</p><p>Dynamic imports can be used to import functions defined in other source files.</p><p>For example, here is the file <code>src/my-module.js</code>.</p><pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'in demo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>This WILL make the <code>demo</code> function available to Alpine.</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name"><span class="token namespace">is:</span>inline</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'/src/my-module.js'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">module</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      demo <span class="token operator">=</span> module<span class="token punctuation">.</span>demo<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error importing my-module.js:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>Regardless of the number of times a component containing this <code>script</code> tag is used, the browser will only load the file <code>my-module.js</code> one time.</p></li><li><p><code>&lt;script src=&quot;{path}&quot;&gt;</code></p><p>With this approach, functions are defined in a separate source file. For example, here is the file <code>src/components/my-script.js</code>.</p><pre class="language-js"><code class="language-js">globalThis<span class="token punctuation">.</span>ns <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'in demo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>This WILL make the <code>ns.demo</code> function available to Alpine and can be called with <code>ns.demo()</code>. Regardless of the number of times a component containing this <code>script</code> tag is used, the browser will only load the file <code>my-script.js</code> one time.</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./my-script.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre></li></ul><p>From the Astro docs at <a href="https://docs.astro.build/en/reference/directives-reference/#isinline?v=1.1.1" rel="noopener" target="_blank">is:inline</a>, &quot;The <code>is:inline</code> directive is implied whenever any attribute other than <code>src</code> is used on a <code>&lt;script&gt;</code> or <code>&lt;style&gt;</code> tag.&quot;</p><p>An issue with scripts that are &quot;inline&quot; is that no deduplication is performed on them. If an Astro component contains inline scripts, they will appear in the DOM once for every usage of the component.</p><h4 id="alpine-example" tabindex="-1">Alpine Example</h4><p>Now let's walk through the steps to use <a href="https://alpinejs.dev?v=1.1.1" rel="noopener" target="_blank">Alpine</a> in Astro. Alpine is a much lighter weight framework than frameworks like React, Svelte and Vue. But Alpine is still quite capable.</p><ol><li><p>Install the Alpine integration by entering <code>npx astro add alpinejs</code>.</p></li><li><p>Define an Astro component that uses Alpine in the <code>src/components</code> directory.</p><p>For example, here is the file <code>Counter.astro</code>:</p><pre class="language-js"><code class="language-js"><span class="token operator">--</span><span class="token operator">-</span><br><span class="token keyword">interface</span> <span class="token class-name">Props</span> <span class="token punctuation">{</span><br>  label<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span><br>  start<span class="token operator">?</span><span class="token operator">:</span> number<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">const</span> <span class="token punctuation">{</span> label <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span> start <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token operator">=</span> Astro<span class="token punctuation">.</span>props<span class="token punctuation">;</span><br><span class="token operator">--</span><span class="token operator">-</span><br><br><span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"row"</span> x<span class="token operator">-</span>data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">{ count: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>start<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> }</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span><span class="token operator">></span><br>  <span class="token punctuation">{</span>label <span class="token operator">&amp;&amp;</span><br>  <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">{</span>label<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br>  <span class="token punctuation">}</span><br>  <span class="token operator">&lt;</span>button <span class="token operator">:</span>disabled<span class="token operator">=</span><span class="token string">"count &lt;= 0"</span> @click<span class="token operator">=</span><span class="token string">"count--"</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><br>  <span class="token operator">&lt;</span>div x<span class="token operator">-</span>text<span class="token operator">=</span><span class="token string">"count"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br>  <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"count++"</span><span class="token operator">></span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><br><br>  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> This demonstrates calling client<span class="token operator">-</span>side <span class="token constant">JS</span> code<br>       <span class="token keyword">in</span> Alpine event handling<span class="token punctuation">.</span> <span class="token operator">--</span><span class="token operator">></span><br>  <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"demo"</span><span class="token operator">></span>Click Me<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><br><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br><br><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> The is<span class="token operator">:</span>inline directive opts out <span class="token keyword">of</span> Astro processing<br>     and includes the script tag <span class="token keyword">as</span><span class="token operator">-</span>is<span class="token punctuation">.</span>  See detail below<span class="token punctuation">.</span><br>     <span class="token constant">A</span> workaround is to attach the <span class="token keyword">function</span> to the window object<span class="token punctuation">.</span>  <span class="token operator">--</span><span class="token operator">></span><br><span class="token operator">&lt;</span>script is<span class="token operator">:</span>inline<span class="token operator">></span><br>  <span class="token keyword">function</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Demo time!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><br><br><span class="token operator">&lt;</span>style<span class="token operator">></span><br>  <span class="token punctuation">.</span>row <span class="token punctuation">{</span><br>    <span class="token literal-property property">display</span><span class="token operator">:</span> flex<span class="token punctuation">;</span><br>    align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span><br>    <span class="token literal-property property">gap</span><span class="token operator">:</span> 1rem<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">></span></code></pre></li><li><p>Use the new component in another component or page.</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">"@components/Counter.astro"</span><span class="token punctuation">;</span><br><span class="token operator">...</span><br><span class="token operator">&lt;</span>Counter label<span class="token operator">=</span><span class="token string">"Tally"</span> start<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span></code></pre><p>Unlike with Svelte and other components, Astro components that use Alpine do not need a <code>client:*</code> directive in order to have client-side interactivity.</p></li></ol><p>For more detail on using Alpine in Astro, see <a href="https://docs.astro.build/en/guides/integrations-guide/alpinejs/?v=1.1.1" rel="noopener" target="_blank">Alpine integration</a>.</p><h3 id="component-communication" tabindex="-1">Component Communication</h3><p>Server-side generated (SSG) components which include all <code>.astro</code> files cannot pass functions to other components. This prevents server-side rendered (SSR) components (implemented with frameworks like React, Svelte, and Vue) that are rendered from an SSG component from returning data to the SSG component.</p><p>When this kind of inter-component communication is needed, all the components involved must be SSR components.</p><p>A workaround for this limitation is to use the Alpine <code>x-data</code> directive.</p><p>In the following example, the file <code>src/pages/index.astro</code> defines a value for <code>score</code> using <code>x-data</code>. The file <code>src/components/Demo.astro</code> is rendered by the previous file. It has access to <code>x-data</code> defined on any element to which it is a descendant in the DOM tree. It can also define it's own <code>x-data</code> properties. In this case is defines a <code>double</code> function which doubles the value of the <code>score</code> property. This change will be visible back in <code>index.astro</code>.</p><p><code>src/pages/index.astro</code></p><pre class="language-js"><code class="language-js"><span class="token operator">--</span><span class="token operator">-</span><br><span class="token keyword">import</span> Demo <span class="token keyword">from</span> <span class="token string">"../components/Demo.astro"</span><span class="token punctuation">;</span><br><span class="token operator">--</span><span class="token operator">-</span><br><br><span class="token operator">&lt;</span>html<span class="token operator">></span><br>  <span class="token operator">&lt;</span>body x<span class="token operator">-</span>data<span class="token operator">=</span><span class="token string">"{score: 19}"</span><span class="token operator">></span><br>    <span class="token operator">&lt;</span>p<span class="token operator">></span>index score <span class="token operator">=</span> <span class="token operator">&lt;</span>span x<span class="token operator">-</span>text<span class="token operator">=</span><span class="token string">"score"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><br>    <span class="token operator">&lt;</span>Demo <span class="token operator">/</span><span class="token operator">></span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span><br><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span></code></pre><p><code>src/components/Demo.astro</code></p><pre class="language-js"><code class="language-js"><span class="token operator">&lt;</span>div x<span class="token operator">-</span>data<span class="token operator">=</span><span class="token string">"{ double() { score *= 2; } }"</span><span class="token operator">></span><br>  <span class="token operator">&lt;</span>p<span class="token operator">></span>Demo score <span class="token operator">=</span> <span class="token operator">&lt;</span>span x<span class="token operator">-</span>text<span class="token operator">=</span><span class="token string">"score"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><br>  <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"double"</span><span class="token operator">></span>Double it<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><br><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span></code></pre><p>A downside of this approach is that because the data is not passed using props, it is not clear what data the <code>Demo</code> component might be using. It has access to all the data in the <code>x-data</code> objects of all ancestor elements.</p><p>Also, if the nesting of components that use <code>x-data</code> becomes somewhat deep, the danger of unintentional name clashes in <code>x-data</code> property names increases.</p><h2 id="sharing-state-(nanostores)" tabindex="-1">Sharing State (nanostores)</h2><p>The recommended way to share state (data) between components is to use the <a href="https://github.com/nanostores/nanostores?v=1.1.1" rel="noopener" target="_blank">nanostores</a> library. This library is not specific to Astro and can be used with many web frameworks. It is very lightweight, adding less that 1KB to the project. nanostores are somewhat similar to Svelte stores.</p><p>To install the nanostores library in an Astro project, enter <code>npm install nanostores</code>.</p><p>There are three kinds of stores:</p><ul><li>&quot;atom&quot; stores hold a single data value which can be of any type including boolean, number, string, array, or object. When the value is an object, the entire value can be modified, but not individual properties.</li><li>&quot;map&quot; stores hold multiple named properties. This is typically used for objects rather than using an atom store.</li><li>&quot;computed&quot; stores compute their value based on the values of other stores.</li></ul><p>One limitation is that nanostores cannot be passed as props to components.</p><h3 id="store-setup" tabindex="-1">Store Setup</h3><p>Let's walk through an example of using an atom nanostore to share a number value between three components that are implemented in React, Svelte, and Astro. The three components have identical functionality. Each component renders a count whose value comes from an atom store. Minus and plus buttons enable changing the count value. Changing the value from any component affects the value displayed in all of them since they all use the same nanostore.</p><p><img alt="Astro nanostores Counters" style="width: 50%" src="/blog/assets/astro-nanostores-counters.png?v=1.1.1"></p><p>To install the nanostores library, enter <code>npm install nanostores</code>.</p><p>To use nanostores in React components, also enter <code>npm install nanostores @nanostores/react</code>.</p><p>To add support for the Alpine library which is used in the Astro component, enter <code>npx astro add alpinejs</code>.</p><h3 id="persistence" tabindex="-1">Persistence</h3><p>For sharing state across page transitions, see <a href="https://github.com/nanostores/persistent?v=1.1.1" rel="noopener" target="_blank">@nanostores/persistent</a>.</p><p>To install this, enter <code>npm install nanostores @nanostores/persistent</code>.</p><p>To use this to define stores, import it as follows:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>persistentAtom<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nanostores/persistent'</span><span class="token punctuation">;</span></code></pre><p>To make an atom store persistent, change <code>const myStore = atom(value);</code> to the following:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> myStore <span class="token operator">=</span> <span class="token function">persistentAtom</span><span class="token punctuation">(</span><span class="token string">'someName'</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">encode</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span>stringify<span class="token punctuation">,</span><br>  <span class="token literal-property property">decode</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span>parse<br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="store-creation" tabindex="-1">Store Creation</h3><p>Here is the code the creates the nanostore defined in the file <code>src/stores.ts</code>. It also defines a helper function that is needed by the Astro component.</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>atom<span class="token punctuation">,</span> computed<span class="token punctuation">,</span> map<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'nanostores'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> score <span class="token operator">=</span> <span class="token function">atom</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// @ts-ignore</span><br>globalThis<span class="token punctuation">.</span>stores <span class="token operator">=</span> <span class="token punctuation">{</span><br>  count<span class="token operator">:</span> <span class="token function">atom</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><h3 id="react-component" tabindex="-1">React Component</h3><p>Here is a React component that uses the <code>count</code> nanostore defined in the file <code>src/components/Counter.tsx</code>.</p><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">{</span><span class="token keyword">type</span> <span class="token class-name"><span class="token constant">FC</span></span><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>useStore<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nanostores/react'</span><span class="token punctuation">;</span><br><br><span class="token keyword">interface</span> <span class="token class-name">Props</span> <span class="token punctuation">{</span><br>  label<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">const</span> Counter<span class="token operator">:</span> <span class="token constant">FC</span><span class="token operator">&lt;</span>Props<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>label <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token comment">// @ts-ignore</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span> <span class="token operator">=</span> globalThis<span class="token punctuation">.</span>stores<span class="token punctuation">;</span><br>  <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">useStore</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token punctuation">(</span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>display<span class="token operator">:</span> <span class="token string">'flex'</span><span class="token punctuation">,</span> alignItems<span class="token operator">:</span> <span class="token string">'center'</span><span class="token punctuation">,</span> gap<span class="token operator">:</span> <span class="token string">'1rem'</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"><br>      </span><span class="token punctuation">{</span>label <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>label<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">}</span><span class="token plain-text"><br>      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">disabled</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>value <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">}</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> count<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>value <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"><br>        -<br>      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"><br>      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"><br>      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> count<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>value <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">+</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"><br>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> Counter<span class="token punctuation">;</span></code></pre><h3 id="svelte-component" tabindex="-1">Svelte Component</h3><p>Here is a Svelte component that uses the <code>count</code> nanostore defined in the file <code>src/components/Counter.svelte</code>.</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span> <span class="token operator">=</span> globalThis<span class="token punctuation">.</span>stores<span class="token punctuation">;</span><br><br>  <span class="token keyword">export</span> <span class="token keyword">let</span> label <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>row<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  {#if label}<br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>{label}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>  {/if}<br>  <span class="token comment">&lt;!-- In Svelte, add $ prefix to get the value of a nanostore. --></span><br>  &lt;button disabled={$count &lt;= 0} on:click={() => count.set($count - 1)}>-<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>{$count}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>  &lt;button on:click={() => count.set($count + 1)}>+<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><br>  <span class="token selector">.row</span> <span class="token punctuation">{</span><br>    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span><br>    <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><br>    <span class="token property">gap</span><span class="token punctuation">:</span> 1rem<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><h3 id="astro-component" tabindex="-1">Astro Component</h3><p>Here is an Astro component that uses the <code>count</code> nanostore defined in the file <code>src/components/Counter.astro</code>.</p><pre class="language-js"><code class="language-js"><span class="token operator">--</span><span class="token operator">-</span><br><span class="token keyword">interface</span> <span class="token class-name">Props</span> <span class="token punctuation">{</span><br>  label<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">const</span> <span class="token punctuation">{</span>label <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">}</span> <span class="token operator">=</span> Astro<span class="token punctuation">.</span>props<span class="token punctuation">;</span><br><span class="token operator">--</span><span class="token operator">-</span><br><br><span class="token operator">&lt;</span>div<br>  <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"row"</span><br>  x<span class="token operator">-</span>data<br>  x<span class="token operator">-</span>init<span class="token operator">=</span><span class="token string">"counterSetup($data)"</span><br>  x<span class="token operator">-</span>effect<span class="token operator">=</span><span class="token string">"setCount(Number(count))"</span><br><span class="token operator">></span><br>  <span class="token punctuation">{</span>label <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">{</span>label<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span> <span class="token punctuation">}</span><br>  <span class="token operator">&lt;</span>button <span class="token operator">:</span>disabled<span class="token operator">=</span><span class="token string">"count &lt;= 0"</span> @click<span class="token operator">=</span><span class="token string">"count--"</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><br>  <span class="token operator">&lt;</span>div x<span class="token operator">-</span>text<span class="token operator">=</span><span class="token string">"count"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br>  <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"count++"</span><span class="token operator">></span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><br><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br><br><span class="token operator">&lt;</span>script is<span class="token operator">:</span>inline<span class="token operator">></span><br>  <span class="token comment">// This updates an Alpine x-data property</span><br>  <span class="token comment">// every time a related store value changes.</span><br>  <span class="token keyword">function</span> <span class="token function">sync</span><span class="token punctuation">(</span><span class="token parameter">store<span class="token punctuation">,</span> data<span class="token punctuation">,</span> property</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=></span> data<span class="token punctuation">[</span>property<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">function</span> <span class="token function">counterSetup</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span> <span class="token operator">=</span> stores<span class="token punctuation">;</span><br>    <span class="token function">sync</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token string">'count'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    data<span class="token punctuation">.</span>setCount <span class="token operator">=</span> count<span class="token punctuation">.</span>set<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><br><br><span class="token operator">&lt;</span>style<span class="token operator">></span><br>  <span class="token punctuation">.</span>row <span class="token punctuation">{</span><br>    <span class="token literal-property property">display</span><span class="token operator">:</span> flex<span class="token punctuation">;</span><br>    align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span><br>    <span class="token literal-property property">gap</span><span class="token operator">:</span> 1rem<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">></span></code></pre><h3 id="page-component" tabindex="-1">Page Component</h3><p>Here is an Astro page that uses all three of the components defined above. This is defined in the file <code>src/pages/index.astro</code>.</p><pre class="language-html"><code class="language-html">---<br>import Layout from '../layouts/Layout.astro';<br>import Counter1 from '../components/Counter.tsx';<br>import Counter2 from '../components/Counter.svelte';<br>import Counter3 from '../components/Counter.astro';<br>---<br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">import</span> <span class="token string">'/src/stores.js'</span><span class="token punctuation">;</span> <span class="token comment">// sets a global variable</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Layout</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>nanostores Demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><br><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>main</span> <span class="token attr-name">x-data</span> <span class="token attr-name">x-init</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>topSetup($data)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>    <span class="token comment">&lt;!-- Using client:only instead of client:load addresses<br>         a timing issue with setting globalThis.stores. --></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Counter1</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>React<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">client:</span>only</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>react<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Counter2</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Svelte<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">client:</span>only</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>svelte<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token comment">&lt;!-- client:* directives cannot be applied to Astro components. --></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Counter3</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Astro<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Layout</span><span class="token punctuation">></span></span></code></pre><h2 id="directives" tabindex="-1">Directives</h2><p>In addition to the <code>client:</code> directives described in the previous section, Astro supports these directives:</p><table><thead><tr><th>Directive</th><th>Action</th></tr></thead><tbody><tr><td><code>class:list={[...]}</code></td><td>converts an array of CSS class names into a string of class names</td></tr><tr><td><code>define:vars</code></td><td>applied to <code>style</code> or <code>script</code> elements to provide access to the values of front matter variables</td></tr><tr><td><code>is:inline</code></td><td>disables Astro processing of <code>style</code> and <code>script</code> elements leaving them as-is</td></tr><tr><td><code>is:global</code></td><td>applied to a <code>style</code> element to make the styles global rather than scoped to the current component</td></tr><tr><td><code>is:raw</code></td><td>treats descendant elements and interpolations as text</td></tr><tr><td><code>set:html={string}</code></td><td>injects a string of HTML into the element</td></tr><tr><td><code>set:text</code></td><td>injects a string of text into the element</td></tr></tbody></table><p>If a value in the <code>class:list</code> array is an object, the keys must be class names and the values must be Boolean expressions that determine whether the class name should be included. If a value is array, it is flattened into the surrounding array. If a value is <code>false</code>, <code>undefined</code>, or <code>null</code>, it is skipped.</p><p>For example:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nav</span><span class="token punctuation">></span></span><br>  &lt;a class:list={{disabled: currentPage === 1}} href="/">First<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name"><span class="token namespace">class:</span>list</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{{disabled:</span> <span class="token attr-name">!prevUrl}}</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{prevUrl}</span><span class="token punctuation">></span></span>Previous<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name"><span class="token namespace">class:</span>list</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{{disabled:</span> <span class="token attr-name">!nextUrl}}</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{nextUrl}</span><span class="token punctuation">></span></span>Next<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><br>  &lt;a class:list={{disabled: currentPage === lastPage}}<br>    href={`/${lastPage}`}>Last<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nav</span><span class="token punctuation">></span></span></code></pre><p>The <code>define:vars</code> directive turns front matter variables into CSS variables. For example, here is an Astro component defined in <code>src/components/Text.astro</code>:</p><pre class="language-md"><code class="language-md"><span class="token front-matter-block"><span class="token punctuation">---</span><br><span class="token front-matter yaml language-yaml">const <span class="token punctuation">{</span> bg<span class="token punctuation">,</span> fg <span class="token punctuation">}</span> = Astro.props;</span><br><span class="token punctuation">---</span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token punctuation">/></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name"><span class="token namespace">define:</span>vars</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{{</span> <span class="token attr-name">bg,</span> <span class="token attr-name">fg</span> <span class="token attr-name">}}</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><br>  <span class="token selector">.text</span> <span class="token punctuation">{</span><br>    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--bg<span class="token punctuation">,</span> yellow<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--fg<span class="token punctuation">,</span> black<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span><br>    <span class="token property">padding</span><span class="token punctuation">:</span> 0.5rem<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><p>This component can be used as follows:</p><p><img alt="Astro define:vars" style="border: none; width: 20%" src="/blog/assets/astro-define-vars.png?v=1.1.1"></p><pre class="language-html"><code class="language-html">---<br>import Text from "../components/Text.astro";<br>---<br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Text</span><span class="token punctuation">></span></span>First<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Text</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Text</span> <span class="token attr-name">fg</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>white<span class="token punctuation">"</span></span> <span class="token attr-name">bg</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blue<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Second<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Text</span><span class="token punctuation">></span></span></code></pre><p>Applying the <code>is:inline</code> directive to a <code>style</code> or <code>script</code> element has the following effects:</p><ul><li>will be rendered exactly where it is authored</li><li>styles will be global and not scoped to the component</li><li>will not be bundled into an external file</li><li>will appear as many times as it is rendered, rather than just once</li><li>will not have its <code>import</code>, <code>@import</code>, and <code>url()</code> references resolved relative to the <code>.astro</code> file</li><li>tree shaking will not remove functions that Astro thinks are not called (important when functions are called from Alpine event handling attributes)</li></ul><p>If the string value of <code>set:html</code> comes from an untrusted source, use a sanitizer such as sanitize-html to avoid cross site scripting attacks (XSS). This directive can be applied to a <code>Fragment</code> component when a wrapping element is not needed. If the value is a <code>Promise</code>, Astro will wait for it to resolve and use the result as the HTML to insert.</p><p>The string value of <code>set:text</code> is automatically escaped, replacing certain characters such as <code>&quot;</code> with a character entity such as <code>&amp;quot;</code>.</p><h2 id="dev-toolbar" tabindex="-1">Dev Toolbar</h2><p>When running in dev mode, Astro provides a Dev Toolbar in a dark gray oval that is centered at the bottom of the browser window. It is partially hidden from view until the mouse hovers over it.</p><p><img alt="Astro Dev Toolbar" style="border: none; width: 30%" src="/blog/assets/astro-dev-toolbar.png?v=1.1.1"></p><p>The toolbar contains the following four buttons:</p><ul><li><p>Menu (Astro icon)</p><p>This provides options to &quot;Report a Bug&quot;, provide &quot;Feedback&quot;, view &quot;Documentation&quot;, and join the &quot;Community&quot; (on Discord). It also features some optional integrations. The &quot;View all&quot; link opens a browser tab for viewing all available integrations.</p><p>The &quot;Copy debug info&quot; button in the upper-right copies information to the clipboard that is useful when reporting a bug. This includes the version of Astro, version of Node, operating system, package manager (ex. npm), the adapter in use (ex. @astrojs/node), and a list of the installed integrations. The copied text can be pasted into a bug report.</p></li><li><p>Inspect (arrow icon)</p><p>This enables inspecting interactive components that are marked with a <code>client:*</code> directive. These directives can only be applied to non-Astro components.</p><p>Click this button to display an outline around all the interactive components on the page. Hover over one to get a dialog that shows:</p><ul><li>the specific <code>client:*</code> directive that was applied</li><li>the props that were passed to the component</li><li>a link that be clicked to open the source file for the component in VS Code</li></ul></li><li><p>Audit (document icon)</p><p>This scans the page for accessibility issues. Elements that have issues are given a purple outline. Hover over them to see a dialog that describes the issues.</p></li><li><p>Settings (gear icon)</p><p>This displays a dialog for modifying settings. There are currently only two settings, &quot;Verbose logging&quot; and &quot;Disable notifications&quot;, both of which are off by default.</p></li></ul><p>To close any dialog displayed by the Dev Toolbar, press the escape key.</p><p>If having access to the Dev Toolbar is not desired, it can be disabled by entering <code>npx astro preferences disable devToolbar</code>. It can be enabled again by entering <code>npx astro preferences enable devToolbar</code>.</p><h2 id="custom-404-page" tabindex="-1">Custom 404 Page</h2><p>To create a custom 404 page, add the file <code>src/pages/404.astro</code>. This page can import and use layouts and other components just like any other page.</p><p>The following is an example.</p><p><img alt="Astro 404 page" style="width: 30%" src="/blog/assets/astro-404-page.png?v=1.1.1"></p><pre class="language-html"><code class="language-html">---<br>import Layout from "../layouts/Layout.astro";<br>---<br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Layout</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>main</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><br>      The Web site you seek<br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span><br>      cannot be located, but<br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span><br>      countless more exist.<br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><br>      No content was found at<br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>path<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Layout</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">const</span> span <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>span<span class="token punctuation">)</span> span<span class="token punctuation">.</span>textContent <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname<span class="token punctuation">;</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><br>  <span class="token selector">main</span> <span class="token punctuation">{</span><br>    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span><br>    <span class="token property">flex-direction</span><span class="token punctuation">:</span> column<span class="token punctuation">;</span><br>    <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><br>    <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><br>    <span class="token property">gap</span><span class="token punctuation">:</span> 3rem<span class="token punctuation">;</span><br><br>    <span class="token property">height</span><span class="token punctuation">:</span> 100vh<span class="token punctuation">;</span><br>    <span class="token property">width</span><span class="token punctuation">:</span> 100vw<span class="token punctuation">;</span><br><br>    <span class="token property">background-color</span><span class="token punctuation">:</span> linen<span class="token punctuation">;</span><br>    <span class="token property">color</span><span class="token punctuation">:</span> cornflowerblue<span class="token punctuation">;</span><br>    <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token selector">p</span> <span class="token punctuation">{</span><br>    <span class="token property">font-size</span><span class="token punctuation">:</span> 1.5rem<span class="token punctuation">;</span><br>    <span class="token property">margin</span><span class="token punctuation">:</span> 1rem 0<span class="token punctuation">;</span><br>    <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token selector">#path</span> <span class="token punctuation">{</span><br>    <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><h2 id="view-transitions" tabindex="-1">View Transitions</h2><p>Astro supports adding <a href="https://docs.astro.build/en/guides/view-transitions/?v=1.1.1" rel="noopener" target="_blank">view transitions</a> that are applied when navigating from one page to another. This includes clicking links implemented with <code>&lt;a&gt;</code> elements, triggering the browser forward and back buttons, and submitting forms. For more control over when transitions occur, see <a href="https://docs.astro.build/en/guides/view-transitions/#router-control?v=1.1.1" rel="noopener" target="_blank">router control</a>.</p><p>This feature is built on the Web <a href="https://developer.mozilla.org/en-US/docs/Web/API/View_Transitions_API?v=1.1.1" rel="noopener" target="_blank">View Transitions API</a>. As of December 2023, the only major web browsers that support this are Chrome and Edge. Polyfills are provided to support view transitions in browsers that do not yet support the View Transitions API.</p><p>Astro disables all view transitions when the CSS media feature &quot;prefer-reduce-motion&quot; is enabled. This is based on an operating system specific setting. For example, in macOS this is configured in the Settings app under Accessibility ... Display ... Reduce motion.</p><p>For basic fade out, fade in transitions between all pages, modify the layout files used by all the pages as follows. This specifies the transition that should occur when leaving a page.</p><pre class="language-html"><code class="language-html">---<br>import { ViewTransitions } from "astro:transitions";<br>...<br><br>---<br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><br>    ...<br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ViewTransitions</span> <span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><br>  ...<br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>The <code>ViewTransitions</code> component must appear as a child of the <code>head</code> element for <em>any</em> transitions to occur, including custom transitions.</p><p>The built-in transitions include:</p><ul><li><p><code>fade</code></p><p>The current page fades out and new page fades in.</p></li><li><p><code>initial</code></p><p>This uses the browser default transition.</p></li><li><p><code>slide</code></p><p>The current page slides out to the left and new page slides in from the right. The opposite occurs when navigating back to the previous page.</p></li><li><p><code>none</code></p><p>This disables transition animations. It is typically applied to the <code>html</code> element to disable all transition animations for the entire page.</p></li></ul><p>To specify a page-level transition other than the default, add the <code>transition:animate</code> directive to the <code>body</code> element of each page. If all pages use a common layout, this can be applied in that layout component. For example, the following will configure a slide transition where going forward causes the current page to slide out to the left and the new page to slide in from the right. Going back triggers the opposite transitions.</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>p-4<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">transition:</span>animate</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{slide({</span> <span class="token attr-name"><span class="token namespace">duration:</span></span> <span class="token attr-name">'1s'</span> <span class="token attr-name">})}</span><span class="token punctuation">></span></span></code></pre><p>To specify a transition on a specific element (which can be the root element of a page), add the <code>transition:animate=&quot;{transition-type}&quot;</code> directive. For example, <code>&lt;main transition:animate=&quot;slide&quot;&gt;</code>.</p><p>To transition certain elements on a page but not the whole page, add <code>transition:animate=&quot;none&quot;</code> to the <code>html</code> element and <code>transition:animate=&quot;{transition-name}&quot;</code> to specific elements.</p><p>To customize the transition, pass a configuration object to the transition function. For example, <code>&lt;main transition:animate={slide({ duration: '2s' })}&gt;</code>.</p><p>When identical <code>Image</code> components are on both the current page and the next page and they have the <code>transition:name</code> directive, one will morph into the other through the view transition. This is especially useful when the image size of each of the pages differs.</p><p>For example:</p><pre class="language-html"><code class="language-html">import whippet from "../images/whippet.webp"; ... --- ...<br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>whippet<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{whippet}<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">transition:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>whippet<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>...</code></pre><p>When identical <code>audio</code> and <code>video</code> elements are on both the current page and the next page and they are playing and they have the <code>transition:name</code> and <code>transition:persist</code> directives, they will continue playing without interruption through the view transition.</p><p>For example:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>audio</span><br>  <span class="token attr-name">controls</span><br>  <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/sample.mp3<span class="token punctuation">"</span></span><br>  <span class="token attr-name"><span class="token namespace">transition:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>my-audio<span class="token punctuation">"</span></span><br>  <span class="token attr-name"><span class="token namespace">transition:</span>persist</span><br><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>audio</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">controls</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>200<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">transition:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>my-video<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">transition:</span>persist</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/bunny-video.mp4<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>video/mp4<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">></span></span></code></pre><p>To define a custom transition, create an object that conforms to the <code>TransitionDirectionalAnimations</code> interface which requires <code>forwards</code> and <code>backwards</code> properties. Those properties must be objects that conform to the <code>TransitionAnimation</code> interface which requires <code>old</code> and <code>new</code> properties.</p><p>For example: TODO: This is not quite working yet. See astro-examples/view-transitions/src/layouts/SpinLayout.astro.</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> spinAnim <span class="token operator">=</span> <span class="token punctuation">{</span><br>  old<span class="token operator">:</span> <span class="token punctuation">{</span><br>    name<span class="token operator">:</span> <span class="token string">'spinOut'</span><span class="token punctuation">,</span><br>    duration<span class="token operator">:</span> <span class="token string">'1s'</span><span class="token punctuation">,</span><br>    easing<span class="token operator">:</span> <span class="token string">'linear'</span><span class="token punctuation">,</span><br>    fillMode<span class="token operator">:</span> <span class="token string">'forwards'</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token keyword">new</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    name<span class="token operator">:</span> <span class="token string">'spinIn'</span><span class="token punctuation">,</span><br>    duration<span class="token operator">:</span> <span class="token string">'1s'</span><span class="token punctuation">,</span><br>    easing<span class="token operator">:</span> <span class="token string">'linear'</span><span class="token punctuation">,</span><br>    fillMode<span class="token operator">:</span> <span class="token string">'backwards'</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> spin <span class="token operator">=</span> <span class="token punctuation">{</span><br>  forwards<span class="token operator">:</span> spinAnim<span class="token punctuation">,</span><br>  backwards<span class="token operator">:</span> spinAnim<br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>For more detail, see <a href="https://docs.astro.build/en/guides/view-transitions/?v=1.1.1" rel="noopener" target="_blank">View Transitions</a>. Also, check out <a href="https://github.com/martrapp/astro-vt-bot#readme?v=1.1.1" rel="noopener" target="_blank">astro-vt-bot</a>.</p><h2 id="prefetching" tabindex="-1">Prefetching</h2><p>Prefetching is the act of loading resources that will be needed to render a page before navigating to that page. In Astro, this can be triggered by hovering over link, clicking a link, or merely scrolling a link into view.</p><p>Prefetching is automatically enabled when view transitions are enabled. That is done by including the <code>&lt;ViewTransitions /&gt;</code> component in the <code>head</code> section of the HTML.</p><p>When not using view transitions, prefetching can be enabled by adding the following in <code>astro.config.mjs</code>:</p><pre class="language-js"><code class="language-js"><span class="token literal-property property">prefetch</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span></code></pre><p>Then add the <code>data-astro-prefetch</code> to each <code>a</code> element where prefetching should be performed.</p><p>The default prefetching strategy is &quot;hover&quot;. To use the &quot;tap&quot; or &quot;viewport&quot; strategy, set the value of the <code>data-astro-prefetch</code> attribute to one of those values.</p><p>To change the default prefetch strategy, change the <code>prefetch</code> value in <code>astro.config.mjs</code> to the following:</p><pre class="language-js"><code class="language-js"><span class="token literal-property property">prefetch</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">defaultStrategy</span><span class="token operator">:</span> <span class="token string">'some-strategy'</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>To make all anchor tags use prefetching my default, removing the need to add the <code>data-astro-prefetch</code> attribute to them, change the <code>prefetch</code> value in <code>astro.config.mjs</code> to the following:</p><pre class="language-js"><code class="language-js"><span class="token literal-property property">prefetch</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">prefetchAll</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>Prefetching the page at a specified URL path can be triggered manually in client scripts. For example, this might be done in response to a button click, rather than relying on interaction with an anchor tag. For example:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> prefetch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'astro:prefetch'</span><span class="token punctuation">;</span><br><span class="token operator">...</span><br><span class="token function">prefetch</span><span class="token punctuation">(</span><span class="token string">'/some/path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>For more detail, see <a href="https://docs.astro.build/en/guides/prefetch/#enable-prefetching?v=1.1.1" rel="noopener" target="_blank">Prefetch</a>.</p><h2 id="middleware" tabindex="-1">Middleware</h2><p>Astro supports defining a middleware function named <code>onRequest</code> in the file <code>src/middleware.ts</code> that is called before each page transition. This function can:</p><ul><li>set properties on the <code>local</code> object that every page can access with <code>Astro.locals</code></li><li>verify whether the user is authorized to visit the target URL</li><li>modify the HTML to be rendered</li></ul><p>The following example demonstrates each of the actions described above.</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>defineMiddleware<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'astro:middleware'</span><span class="token punctuation">;</span><br><br><span class="token comment">// This is state that lives across page transitions.</span><br><span class="token keyword">let</span> score <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> securePaths <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'/secret'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> onRequest <span class="token operator">=</span> <span class="token function">defineMiddleware</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  score<span class="token operator">++</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span>locals<span class="token punctuation">,</span> url<span class="token punctuation">}</span> <span class="token operator">=</span> context<span class="token punctuation">;</span><br>  locals<span class="token punctuation">.</span>score <span class="token operator">=</span> score<span class="token punctuation">;</span><br>  locals<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'My Title'</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span>headers<span class="token punctuation">}</span> <span class="token operator">=</span> response<span class="token punctuation">;</span><br><br>  <span class="token comment">// Consider checking the requested content type to</span><br>  <span class="token comment">// determine the kind of response that should be returned.</span><br>  <span class="token keyword">const</span> contentType <span class="token operator">=</span> headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'contentType ='</span><span class="token punctuation">,</span> contentType<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>securePaths<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>pathname<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Check for authentication.</span><br>    <span class="token keyword">const</span> authorization <span class="token operator">=</span> headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'Authorization'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>authorization<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">/*<br>      // This response triggers prompting for credentials<br>      // using HTTP basic authentication.<br>      return new Response('Unauthorized', {<br>        status: 401,<br>        headers: {<br>          'Cache-Control': 'no-cache, no-store, must-revalidate',<br>          'WWW-Authenticate': 'Basic realm="Secure Area"'<br>        }<br>      });<br>      */</span><br><br>      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">'Unauthorized'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>        <span class="token comment">// status: 401, // "Forbidden"; will not redirect to Location</span><br>        status<span class="token operator">:</span> <span class="token number">302</span><span class="token punctuation">,</span> <span class="token comment">// "See Other"; will redirect to Location</span><br>        headers<span class="token operator">:</span> <span class="token punctuation">{</span><br>          <span class="token string-property property">'Cache-Control'</span><span class="token operator">:</span> <span class="token string">'no-cache, no-store, must-revalidate'</span><span class="token punctuation">,</span><br>          Location<span class="token operator">:</span> url<span class="token punctuation">.</span>origin <span class="token operator">+</span> <span class="token string">'/unauthorized'</span> <span class="token comment">// a defined page</span><br>        <span class="token punctuation">}</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">/*<br>  // Optionally modify the HTML being returned.<br>  const html = await response.text();<br>  const modifiedHtml = html; // make some change<br>  return new Response(modifiedHtml, {<br>    headers: response.headers,<br>    status: 200<br>  });<br>  */</span><br><br>  <span class="token keyword">return</span> response<span class="token punctuation">;</span> <span class="token comment">// unaltered</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="cookies" tabindex="-1">Cookies</h2><p>Cookies provide one way for an Astro page to share data with other pages in the same app.</p><p>One downside of using cookies is the legal requirement to prompt users for permission to store them.</p><p>Here is a page defined in <code>src/pages/index.astro</code> that sets a cookie based on user input using Alpine.</p><p><img alt="Astro cookies home" style="width: 70%" src="/blog/assets/astro-cookies-home.png?v=1.1.1"></p><pre class="language-js"><code class="language-js"><span class="token operator">--</span><span class="token operator">-</span><br><span class="token keyword">import</span> Layout <span class="token keyword">from</span> <span class="token string">'../layouts/Layout.astro'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> cookie <span class="token operator">=</span> Astro<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'score'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> score <span class="token operator">=</span> cookie<span class="token operator">?.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token number">0</span><span class="token punctuation">;</span><br><span class="token operator">--</span><span class="token operator">-</span><br><br><span class="token operator">&lt;</span>Layout<span class="token operator">></span><br>  <span class="token operator">&lt;</span>div x<span class="token operator">-</span>data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">{score: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>score<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span> x<span class="token operator">-</span>effect<span class="token operator">=</span><span class="token string">"ns.setScore(Number(score))"</span><span class="token operator">></span><br>    <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"range"</span> min<span class="token operator">=</span><span class="token string">"0"</span> max<span class="token operator">=</span><span class="token string">"10"</span> x<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"score"</span> <span class="token operator">/</span><span class="token operator">></span><br>    <span class="token operator">&lt;</span>span x<span class="token operator">-</span>text<span class="token operator">=</span><span class="token string">"score"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br>  <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"/report"</span><span class="token operator">></span>Report<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><br><span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">></span><br><br><span class="token operator">&lt;</span>script<span class="token operator">></span><br>  <span class="token comment">// @ts-ignore</span><br>  globalThis<span class="token punctuation">.</span>ns <span class="token operator">=</span> <span class="token punctuation">{</span><br>	  <span class="token function">setScore</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">score</span><span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	    <span class="token keyword">const</span> ms <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span> <span class="token comment">// 5 minutes</span><br>	    <span class="token keyword">const</span> expires <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> ms<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUTCString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	    document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">score=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>score<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">; expires=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expires<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><br><br><span class="token operator">&lt;</span>style<span class="token operator">></span><br>  input<span class="token punctuation">[</span>type<span class="token operator">=</span><span class="token string">'range'</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">width</span><span class="token operator">:</span> 20rem<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">></span></code></pre><p>Here is a page defined in <code>src/pages/report.astro</code> that gets the cookie and displays its value.</p><p><img alt="Astro cookies report" style="width: 15%" src="/blog/assets/astro-cookies-report.png?v=1.1.1"></p><pre class="language-js"><code class="language-js"><span class="token operator">--</span><span class="token operator">-</span><br><span class="token keyword">import</span> Layout <span class="token keyword">from</span> <span class="token string">'../layouts/Layout.astro'</span><span class="token punctuation">;</span><br><br><span class="token comment">// If the output mode is "static", this will output the following warning:</span><br><span class="token comment">// [WARN] `Astro.request.headers` is not available in "static" output mode.</span><br><span class="token comment">// To enable header access, enable SSR.</span><br><span class="token keyword">const</span> cookie <span class="token operator">=</span> Astro<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'score'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> score <span class="token operator">=</span> cookie<span class="token operator">?.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token number">0</span><span class="token punctuation">;</span><br><span class="token operator">--</span><span class="token operator">-</span><br><br><span class="token operator">&lt;</span>Layout<span class="token operator">></span><br>  <span class="token operator">&lt;</span>div<span class="token operator">></span>score <span class="token operator">=</span> <span class="token punctuation">{</span>score<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br>  <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"/"</span><span class="token operator">></span>Home<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><br><span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">></span></code></pre><h2 id="table-of-contents" tabindex="-1">Table of Contents</h2><p>The markdown plugin <a href="https://github.com/remarkjs/remark-toc?v=1.1.1" rel="noopener" target="_blank">remark-toc</a> can automatically generate a table of contents for Markdown files based on headings. It will render a hyperlink for each heading that can be clicked to jump to it.</p><p>To use this plugin:</p><ol><li><p>Enter <code>npm install remark-toc</code></p></li><li><p>Add the following in <code>astro.config.mjs</code>:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>defineConfig<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'astro/config'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> remarkToc <span class="token keyword">from</span> <span class="token string">'remark-toc'</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  markdown<span class="token operator">:</span> <span class="token punctuation">{</span><br>    remarkPlugins<span class="token operator">:</span> <span class="token punctuation">[</span>remarkToc<span class="token punctuation">]</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Add <code># Table of Contents</code> to each Markdown file that should include a table of contents to indicate where it should inserted.</p></li></ol><p>Options can be provided to this plugin. To do so, change the <code>remarkPlugins</code> configuration value to something like the following:</p><pre class="language-ts"><code class="language-ts">remarkPlugins<span class="token operator">:</span> <span class="token punctuation">[</span><br>  <span class="token punctuation">[</span><br>    remarkToc<span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      maxDepth<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span><br>      ordered<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>      tight<span class="token operator">:</span> <span class="token boolean">false</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><p>The supported options include:</p><ul><li><p><code>heading</code></p><p>This is a case-insensitive regular expression that matches headings that specify where the TOC should be inserted. It defaults to <code>&quot;(table[ -]of[ -])?contents?|toc&quot;</code>. This matches &quot;table of contents&quot;, &quot;table-of-contents&quot;, &quot;contents&quot;, and &quot;toc&quot;.</p></li><li><p><code>maxDepth</code></p><p>This is the maximum heading level to be included in the TOC. It defaults to <code>6</code>. For example, a value of 2 will only include headings with <code>#</code> and <code>##</code>.</p></li><li><p><code>ordered</code></p><p>This is a Boolean value that indicates whether the TOC should be wrapped in an <code>ol</code> element (<code>true</code>) or a <code>ul</code> element (<code>false</code>). It defaults to <code>false</code>.</p></li><li><p><code>parents</code></p><p>This does not seem useful.</p></li><li><p><code>prefix</code></p><p>This does not seem useful.</p></li><li><p><code>skip</code></p><p>This is a regular expression that matches all headings that should not appear in the TOC. By default no headings are skipped.</p></li><li><p><code>tight</code></p><p>When set to <code>true</code> this reduces the vertical space between lines in the TOC. Set this to <code>false</code> to add space. This defaults to <code>true</code>.</p></li></ul><p>Here is the beginning of a Markdown file for which a table of contents will be generated.</p><pre class="language-md"><code class="language-md"><span class="token title important"><span class="token punctuation">##</span> Table of Contents</span><br><br>The National Football League (NFL) ...<br><br><span class="token title important"><span class="token punctuation">##</span> AFC East</span><br><br><span class="token title important"><span class="token punctuation">###</span> Miami Dolphins</span><br><br><span class="token title important"><span class="token punctuation">###</span> Buffalo Bills</span><br><br><span class="token title important"><span class="token punctuation">###</span> New York Jets</span><br><br><span class="token title important"><span class="token punctuation">###</span> New England Patriots</span><br><br><span class="token title important"><span class="token punctuation">##</span> AFC North</span><br><br><span class="token title important"><span class="token punctuation">###</span> Baltimore Ravens</span><br><br><span class="token title important"><span class="token punctuation">###</span> Cleveland Browns</span><br><br><span class="token title important"><span class="token punctuation">###</span> Pittsburgh Steelers</span><br><br><span class="token title important"><span class="token punctuation">###</span> Cincinnati Bengals</span></code></pre><p>Here is the table of contents that is rendered.</p><p><img alt="Astro remark-toc plugin" style="width: 40%" src="/blog/assets/astro-remark-toc.png?v=1.1.1"></p><h2 id="api-endpoints" tabindex="-1">API Endpoints</h2><p>Endpoint functions can be invoked at build time or run time. They are defined in <code>.js</code> and <code>.ts</code> files under the <code>src/pages</code> directory. Consider placing these files in a subdirectory named &quot;api&quot;.</p><p>All <code>.js</code> and <code>.ts</code> files in an Astro project are only used on the server side, never in browsers.</p><p>For endpoints that return JSON, consider including <code>.json</code> at the end of the file name. For example, <code>dogs.json.ts</code>.</p><p>Endpoint URLs are defined by file-based routing, just like UI pages.</p><p>Endpoints are not UI pages. It seems odd that they are defined in the <code>pages</code> directory rather than in a dedicated directory like <code>apis</code> or <code>endpoints</code>. Perhaps a future version of Astro will make this change.</p><p>Endpoints can return data in any format including JSON and HTML (perhaps for use with HTMX). However, currently endpoints cannot use Astro components to generate HTML. That capability is planned for the future. For now, see the HTMX section below which uses Astro pages as endpoints.</p><p>Endpoints can be defined by dynamic routes where directory names under the &quot;pages&quot; directory are surrounded by square brackets. <code>Astro.params</code> contains the matched segments of a dynamic route and can be used in endpoint functions to access those matches.</p><p><code>Astro.request</code> holds a standard <code>Request</code> object. Endpoint functions can use it to get the request method, URL, headers, and body.</p><p><code>Astro.url</code> is a standard <code>URL</code> object created from the value of <code>Astro.request.url</code>. It contains properties that holds parts of the URL including <code>origin</code> and <code>pathname</code>.</p><p><code>Astro.response</code> holds a standard <code>ResponseInit</code> object. Endpoint functions can use it to set the response <code>status</code>, <code>statusText</code>, and <code>headers</code>.</p><p><code>Astro.cookies</code> is an object with methods that endpoint functions can use to test for (<code>has</code>), <code>get</code>, <code>set</code>, and <code>delete</code> cookies.</p><p>The following code in the file <code>src/pages/pets/dog.json.ts</code> demonstrates creating an endpoint that returns JSON created from data found in the collection defined in the previous section.</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>getCollection<span class="token punctuation">,</span> <span class="token keyword">type</span> <span class="token class-name">CollectionEntry</span><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'astro:content'</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token constant">GET</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> dogs<span class="token operator">:</span> CollectionEntry<span class="token operator">&lt;</span><span class="token string">'dogs'</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getCollection</span><span class="token punctuation">(</span><span class="token string">'dogs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> data <span class="token operator">=</span> dogs<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>dog <span class="token operator">=></span> dog<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>For better type checking and intellisense in editors like VS Code, define endpoint functions as follows:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span>APIRoute<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'astro'</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">GET</span><span class="token operator">:</span> <span class="token function-variable function">APIRoute</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token operator">...</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>API endpoints are defined by the functions <code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>PATCH</code>, and <code>DELETE</code>. Each of this take an <code>APIContext</code> object that contains the following properties:</p><ul><li><code>params</code>: an object containing properties that match the dynamic segments of the route.</li><li><code>props</code>: an object containing properties supplied by the getStaticPaths function (only available in server-side rendering)</li><li><code>request</code>: a Request object that contains the method, url, headers, and body</li><li><code>clientAddress</code></li><li><code>cookies</code></li><li><code>generator</code></li><li><code>locals</code></li><li><code>redirect</code></li><li><code>site</code></li><li><code>url</code></li></ul><p>To demonstrate defining endpoints that support CRUD operations we will see code that performs these on a collection of todo objects. Each object has the properties <code>id</code>, <code>text</code>, and <code>completed</code>.</p><p>We need to share the collection of todos between two source files. One way to accomplish this is to create a source file that creates and exports the collection. This file can be imported by other source files that need to access the collection. The following file in <code>src/pages/todo-state.ts</code> does this.</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">type</span> <span class="token class-name">Todo</span> <span class="token operator">=</span> <span class="token punctuation">{</span><br>  id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span><br>  text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span><br>  completed<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> todoMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token punctuation">,</span> Todo<span class="token operator">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The endpoints defined in <code>src/pages/todos.ts</code> do two things:</p><ul><li>retrieve all the todos as a JSON array</li><li>create a new todo, returning its JSON</li></ul><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span>APIContext<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'astro'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>todoMap<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./todos-state.ts'</span><span class="token punctuation">;</span><br><br><span class="token keyword">let</span> lastId <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// used by addTodo and POST functions</span><br><br><span class="token comment">// Add some initial todos.</span><br><span class="token keyword">function</span> <span class="token function">addTodo</span><span class="token punctuation">(</span>text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> todo <span class="token operator">=</span> <span class="token punctuation">{</span>id<span class="token operator">:</span> <span class="token operator">++</span>lastId<span class="token punctuation">,</span> text<span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>  todoMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>todo<span class="token punctuation">.</span>id<span class="token punctuation">,</span> todo<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><span class="token function">addTodo</span><span class="token punctuation">(</span><span class="token string">'buy milk'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token function">addTodo</span><span class="token punctuation">(</span><span class="token string">'cut grass'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token constant">GET</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> todos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>todoMap<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>todos<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>    headers<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token constant">POST</span><span class="token punctuation">(</span><span class="token punctuation">{</span>request<span class="token punctuation">}</span><span class="token operator">:</span> APIContext<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> todo <span class="token operator">=</span> <span class="token keyword">await</span> request<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>todo<span class="token punctuation">.</span>completed <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> todo<span class="token punctuation">.</span>completed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token operator">++</span>lastId<span class="token punctuation">;</span><br>  todo<span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span><br>  todoMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> todo<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>status<span class="token operator">:</span> <span class="token number">201</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>The endpoints defined in <code>src/pages/todos/[id].ts</code> do four things:</p><ul><li>retrieve a todo as JSON</li><li>update a todo with JSON</li><li>patch a todo with JSON</li><li>delete a todo</li></ul><p>Files with square brackets in the name define dynamic routes where path parameters are used. In this case the path parameter is the id of a todo.</p><p>Dynamic routes can be used for both pages and API endpoints.</p><p>Dynamic routes require enabling SSR. One way to do this is to add the node adapter by entering <code>npx astro add node</code>.</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span>APIContext<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'astro'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>todoMap<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../todos-state.ts'</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token constant">GET</span><span class="token punctuation">(</span><span class="token punctuation">{</span>params<span class="token punctuation">}</span><span class="token operator">:</span> APIContext<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span>id<span class="token punctuation">}</span> <span class="token operator">=</span> params<span class="token punctuation">;</span><br>  <span class="token keyword">const</span> idNumber <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> todo <span class="token operator">=</span> todoMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>idNumber<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>    headers<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token constant">PUT</span><span class="token punctuation">(</span><span class="token punctuation">{</span>params<span class="token punctuation">,</span> request<span class="token punctuation">}</span><span class="token operator">:</span> APIContext<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span>id<span class="token punctuation">}</span> <span class="token operator">=</span> params<span class="token punctuation">;</span><br>  <span class="token keyword">const</span> idNumber <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> todo <span class="token operator">=</span> <span class="token keyword">await</span> request<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  todo<span class="token punctuation">.</span>id <span class="token operator">=</span> idNumber<span class="token punctuation">;</span> <span class="token comment">// ensures the id matches the path parameter</span><br>  <span class="token keyword">const</span> exists <span class="token operator">=</span> todoMap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>idNumber<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>exists<span class="token punctuation">)</span> todoMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>idNumber<span class="token punctuation">,</span> todo<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> status <span class="token operator">=</span> exists <span class="token operator">?</span> <span class="token number">200</span> <span class="token operator">:</span> <span class="token number">404</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>status<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token constant">PATCH</span><span class="token punctuation">(</span><span class="token punctuation">{</span>params<span class="token punctuation">,</span> request<span class="token punctuation">}</span><span class="token operator">:</span> APIContext<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span>id<span class="token punctuation">}</span> <span class="token operator">=</span> params<span class="token punctuation">;</span><br>  <span class="token keyword">const</span> idNumber <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> updates <span class="token operator">=</span> <span class="token keyword">await</span> request<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  updates<span class="token punctuation">.</span>id <span class="token operator">=</span> idNumber<span class="token punctuation">;</span> <span class="token comment">// ensures the id matches the path parameter</span><br>  <span class="token keyword">let</span> todo <span class="token operator">=</span> todoMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>idNumber<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>todo<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    todo <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">...</span>todo<span class="token punctuation">,</span> <span class="token operator">...</span>updates<span class="token punctuation">}</span><span class="token punctuation">;</span><br>    todoMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>idNumber<span class="token punctuation">,</span> todo<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">const</span> status <span class="token operator">=</span> todo <span class="token operator">?</span> <span class="token number">200</span> <span class="token operator">:</span> <span class="token number">404</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>status<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token constant">DELETE</span><span class="token punctuation">(</span><span class="token punctuation">{</span>params<span class="token punctuation">,</span> request<span class="token punctuation">}</span><span class="token operator">:</span> APIContext<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span>id<span class="token punctuation">}</span> <span class="token operator">=</span> params<span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>id<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">'missing "id" parameter'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>status<span class="token operator">:</span> <span class="token number">400</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> idNumber <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> status <span class="token operator">=</span> todoMap<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>idNumber<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">200</span> <span class="token operator">:</span> <span class="token number">404</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>status<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>When starting the server, include the <code>--host</code> option to enable using <code>localhost</code> in URLs that hit the endpoints. For example, the <code>dev</code> and <code>start</code> scripts in <code>package.json</code> should match the following:</p><pre class="language-json"><code class="language-json">    <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"astro dev --host"</span><span class="token punctuation">,</span><br>    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"astro dev --host"</span><span class="token punctuation">,</span></code></pre><p>For more detail, see <a href="https://docs.astro.build/en/core-concepts/endpoints/#server-endpoints-api-routes?v=1.1.1" rel="noopener" target="_blank">Server Endpoints (API Routes)</a>.</p><h3 id="form-submits" tabindex="-1">Form Submits</h3><p>Form submits can be handled by an Astro page or an API endpoint. Using an Astro page is ideal when no server-side processing is needed. Using an API endpoint enables server-side processing and redirecting to another Astro page. Let's examine both cases.</p><p>Here is an Astro page defined in <code>src/pages/index.astro</code> that renders a <code>form</code>.</p><p><img alt="Astro form submission" style="width: 40%" src="/blog/assets/astro-form-submission.png?v=1.1.1"></p><pre class="language-js"><code class="language-js"><span class="token operator">--</span><span class="token operator">-</span><br><span class="token keyword">import</span> Layout <span class="token keyword">from</span> <span class="token string">"../layouts/Layout.astro"</span><span class="token punctuation">;</span><br><br><span class="token comment">// Choose one of the following lines.</span><br><span class="token comment">// const action = "/api/form-handler"; // uses API endpoint</span><br><span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token string">"/form-handler"</span><span class="token punctuation">;</span> <span class="token comment">// uses another page</span><br><span class="token operator">--</span><span class="token operator">-</span><br><br><span class="token operator">&lt;</span>Layout<span class="token operator">></span><br>  <span class="token operator">&lt;</span>form action<span class="token operator">=</span><span class="token punctuation">{</span>action<span class="token punctuation">}</span> method<span class="token operator">=</span><span class="token string">"POST"</span><span class="token operator">></span><br>    <span class="token operator">&lt;</span>div<span class="token operator">></span><br>      <span class="token operator">&lt;</span>label <span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"name"</span><span class="token operator">></span>Name<span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span><br>      <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> name<span class="token operator">=</span><span class="token string">"name"</span> required size<span class="token operator">=</span><span class="token string">"20"</span> <span class="token operator">/</span><span class="token operator">></span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br>    <span class="token operator">&lt;</span>div<span class="token operator">></span><br>      <span class="token operator">&lt;</span>label <span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"age"</span><span class="token operator">></span>Age<span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span><br>      <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"number"</span> name<span class="token operator">=</span><span class="token string">"age"</span> required <span class="token operator">/</span><span class="token operator">></span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br>    <span class="token operator">&lt;</span>div<span class="token operator">></span><br>      <span class="token operator">&lt;</span>button<span class="token operator">></span>Submit<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span><br><span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">></span><br><br><span class="token operator">&lt;</span>style<span class="token operator">></span><br>  form <span class="token punctuation">{</span><br>    <span class="token literal-property property">display</span><span class="token operator">:</span> flex<span class="token punctuation">;</span><br>    flex<span class="token operator">-</span>direction<span class="token operator">:</span> column<span class="token punctuation">;</span><br>    <span class="token literal-property property">gap</span><span class="token operator">:</span> 1rem<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  input<span class="token punctuation">[</span>type<span class="token operator">=</span><span class="token string">"number"</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">width</span><span class="token operator">:</span> 3rem<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">></span></code></pre><p>Here is a page defined in <code>src/pages/form-handler.astro</code> that can handle a form submission using POST or a redirect from an API endpoint using GET.</p><p><img alt="Astro form submission result" style="width: 40%" src="/blog/assets/astro-form-submission-result.png?v=1.1.1"></p><pre class="language-js"><code class="language-js"><span class="token operator">--</span><span class="token operator">-</span><br><span class="token keyword">import</span> Layout <span class="token keyword">from</span> <span class="token string">"../layouts/Layout.astro"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> categorizeByAge <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../categorize.ts"</span><span class="token punctuation">;</span><br><br><span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token punctuation">{</span> request <span class="token punctuation">}</span> <span class="token operator">=</span> Astro<span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token punctuation">{</span> method <span class="token punctuation">}</span> <span class="token operator">=</span> request<span class="token punctuation">;</span><br><br><span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">"GET"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// This is used by the redirect in src/pages/api/form-handler.ts.</span><br>  message <span class="token operator">=</span> Astro<span class="token punctuation">.</span>url<span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">"missing message"</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">"POST"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// This is used when the form action is "/form-handler".</span><br>  <span class="token keyword">try</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> request<span class="token punctuation">.</span><span class="token function">formData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> name <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> category <span class="token operator">=</span> <span class="token function">categorizeByAge</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    message <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>category<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    message <span class="token operator">=</span> error <span class="token keyword">instanceof</span> <span class="token class-name">Error</span> <span class="token operator">?</span> error<span class="token punctuation">.</span>message <span class="token operator">:</span> <span class="token string">"unknown error"</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><span class="token operator">--</span><span class="token operator">-</span><br><br><span class="token operator">&lt;</span>Layout<span class="token operator">></span><br>  <span class="token operator">&lt;</span>h1<span class="token operator">></span>Age Assessment<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><br>  <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">{</span>message<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><br><span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">></span></code></pre><p>Here is an API endpoint defined in the file <code>src/pages/api/form-handler.ts</code>.</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> type <span class="token punctuation">{</span>APIContext<span class="token punctuation">,</span> APIRoute<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'astro'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>categorizeByAge<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../categorize.ts'</span><span class="token punctuation">;</span><br><br><span class="token comment">// This is used when the form action is "/api/form-handler".</span><br><span class="token comment">// This requires SSR configuration.</span><br><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">POST</span><span class="token operator">:</span> APIRoute <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><br>  redirect<span class="token punctuation">,</span><br>  request<br><span class="token punctuation">}</span><span class="token operator">:</span> APIContext<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>Response<span class="token operator">></span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> request<span class="token punctuation">.</span><span class="token function">formData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> name <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> category <span class="token operator">=</span> <span class="token function">categorizeByAge</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>category<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/form-handler?message=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token number">302</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>Here is the <code>categorizeByAge</code> function defined in <code>src/categorize.ts</code>.</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">categorizeByAge</span><span class="token punctuation">(</span>age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>age <span class="token operator">&lt;=</span> <span class="token number">12</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">'a child'</span><span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>age <span class="token operator">&lt;=</span> <span class="token number">19</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">'a teenager'</span><span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>age <span class="token operator">&lt;=</span> <span class="token number">65</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">'an adult'</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token string">'a senior'</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h2 id="htmx" tabindex="-1">HTMX</h2><p>Astro added support for &quot;page partials&quot; which make it more natural to use HTMX. These render HTML with only <code>body</code> element content. The <code>&lt;!doctype html&gt;</code>, <code>html</code>, <code>head</code> (and its contents), and <code>body</code> elements are not output.</p><p>To indicate that an Astro component should be rendered as a partial, add the following in its component script:</p><pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">const</span> partial <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></code></pre><p>For an example app that combines Astro and HTMX, see <a href="https://github.com/mvolkmann/astro-htmx-todo-app?v=1.1.1" rel="noopener" target="_blank">astro-htmx-todo-app</a>. This uses Astro page as endpoints.</p><p><img alt="Astro HTMX Todo app" style="width: 70%" src="/blog/assets/astro-htmx-todo-app.png?v=1.1.1"></p><p>HTTP requests can be triggered by interacting with any HTML element and use any HTTP verb. These requests can target an Astro page. The component script in the page can determine which verb was used and respond accordingly.</p><p>Another option to consider is implementing Astro endpoints that are invoked using HTMX and having those use <code>hx-redirect</code> to redirect to a specific Astro page that generates the HTML to be returned.</p><h2 id="internationalization" tabindex="-1">Internationalization</h2><p>Astro supports <a href="https://docs.astro.build/en/guides/internationalization/?v=1.1.1" rel="noopener" target="_blank">internationalization</a>.</p><p>The Astro approach is it to duplicate each component for each supported language and store them in directories whose names are language codes. This is a bad approach because any changes require modifying multiple files.</p><p>TODO: Describe how to use this.</p><h2 id="tailwind-typography-plugin" tabindex="-1">Tailwind Typography Plugin</h2><p>The Tailwind <a href="https://tailwindcss.com/docs/typography-plugin?v=1.1.1" rel="noopener" target="_blank">@tailwindcss/typography</a> plugin &quot;provides a set of &quot;prose&quot; classes you can use to add beautiful typographic defaults to any vanilla HTML you don't control, like HTML rendered from Markdown, or pulled from a CMS.&quot;</p><p>There are a large number of provided CSS classes whose names all begin with &quot;prose&quot;. These control the font size, text color, and more. See the documentation linked above for details.</p><p>To install and configure this plugin:</p><ul><li><p>Enter <code>npx astro add tailwind</code></p></li><li><p>Enter <code>npm install -D @tailwindcss/typography</code></p></li><li><p>Edit <code>tailwind.config.mjs</code> and add the following to the <code>plugins</code> array:</p><pre class="language-text"><code class="language-text">require('@tailwindcss/typography')</code></pre></li></ul><p>To use this plugin, add <code>prose</code> CSS classes to specific HTML elements that contain the elements to be styled.</p><p>The large screenshot below demonstrates how many features of Markdown are styled by this plugin.</p><p><img alt="Astro Tailwind Typography" style="width: 70%" src="/blog/assets/astro-tailwind-typography.png?v=1.1.1"></p><p>The following files from an Astro project produce the screenshot above.</p><p><i>src/layouts/Layout.astro</i></p><p>Note the use of the CSS class <code>prose</code> and the <code>slot</code> element that marks where content will be inserted.</p><pre class="language-html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><br>      <span class="token selector">body</span> <span class="token punctuation">{</span><br>        <span class="token property">padding</span><span class="token punctuation">:</span> 1rem<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>prose<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p><i>src/pages/index.md</i></p><p>Note the reference to the layout above using a front matter property.</p><pre class="language-md"><code class="language-md"><span class="token front-matter-block"><span class="token punctuation">---</span><br><span class="token front-matter yaml language-yaml"><span class="token key atrule">layout</span><span class="token punctuation">:</span> ../layouts/Layout.astro</span><br><span class="token punctuation">---</span></span><br><br><span class="token title important"><span class="token punctuation">#</span> Tailwind Typography Demo</span><br><br>This demonstrates use of the Tailwind plugin<br><span class="token url">[<span class="token content">@tailwindcss/typography</span>](<span class="token url">https://tailwindcss.com/docs/typography-plugin</span>)</span>.<br><br><span class="token blockquote punctuation">></span> The official Tailwind CSS Typography plugin provides<br><span class="token blockquote punctuation">></span> a set of prose classes you can use to add beautiful<br><span class="token blockquote punctuation">></span> typographic defaults to any vanilla HTML you dont control,<br><span class="token blockquote punctuation">></span> like HTML rendered from Markdown, or pulled from a CMS.<br><br><span class="token title important"><span class="token punctuation">##</span> Colors</span><br><br>These are some <span class="token italic"><span class="token punctuation">_</span><span class="token content">basic</span><span class="token punctuation">_</span></span> colors.<br><br><span class="token list punctuation">-</span> red<br><span class="token list punctuation">-</span> green<br><span class="token list punctuation">-</span> blue<br><br><span class="token title important"><span class="token punctuation">##</span> Seasons</span><br><br>These are the <span class="token bold"><span class="token punctuation">**</span><span class="token content">seasons</span><span class="token punctuation">**</span></span> in a year.<br><br><span class="token list punctuation">1.</span> Winter<br><span class="token list punctuation">1.</span> Spring<br><span class="token list punctuation">1.</span> Summer<br><span class="token list punctuation">1.</span> Fall<br><br><span class="token title important"><span class="token punctuation">##</span> Dogs</span><br><br>These are some dogs I know.<br><br><span class="token table"><span class="token table-header-row"><span class="token punctuation">|</span><span class="token table-header important"> Name  </span><span class="token punctuation">|</span><span class="token table-header important"> Breed                      </span><span class="token punctuation">|</span><br></span><span class="token table-line"><span class="token punctuation">|</span> <span class="token punctuation">-----</span> <span class="token punctuation">|</span> <span class="token punctuation">--------------------------</span> <span class="token punctuation">|</span><br></span><span class="token table-data-rows"><span class="token punctuation">|</span><span class="token table-data"> Comet </span><span class="token punctuation">|</span><span class="token table-data"> Whippet                    </span><span class="token punctuation">|</span><br><span class="token punctuation">|</span><span class="token table-data"> Oscar </span><span class="token punctuation">|</span><span class="token table-data"> German Shorthaired Pointer </span><span class="token punctuation">|</span><br></span></span><br><span class="token title important"><span class="token punctuation">##</span> Tasks</span><br><br><span class="token list punctuation">-</span> [x] buy milk<br><span class="token list punctuation">-</span> [ ] cut grass<br><br><span class="token title important"><span class="token punctuation">##</span> Code</span><br><br><span class="token code"><span class="token punctuation">```</span><span class="token code-language">js</span><br><span class="token code-block language-js"><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">n1<span class="token punctuation">,</span> n2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> n1 <span class="token operator">+</span> n2<span class="token punctuation">;</span><br><span class="token punctuation">}</span></span><br><span class="token punctuation">```</span></span></code></pre><h2 id="bun-instead-of-node" tabindex="-1">Bun instead of Node</h2><p>Astro provides the following caution about using Bun instead of Node to execute <code>astro</code> commands and run the Astro server: &quot;Using Bun with Astro may reveal rough edges. Some integrations may not work as expected.&quot;</p><p>To create an Astro project using Bun:</p><ul><li><p>Enter <code>bunx create-astro@latest {project-name}</code>.</p></li><li><p><code>cd</code> to the new project directory.</p></li><li><p>Add Bun type definitions by entering <code>bun add -d bun-types</code>.</p></li><li><p>Edit <code>tsconfig.json</code> and add the following:</p><pre class="language-json"><code class="language-json"> <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>  <span class="token property">"types"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"bun-types"</span><span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Start the development server with <code>bunx --bun astro dev</code>.</p></li><li><p>Build the site with <code>bunx --bun astro build</code>.</p></li><li><p>Preview the built site with <code>bunx --bun astro preview</code>.</p></li></ul><p>Using Bun instead of Node provides better performance. It also enables using all the features of Bun such as SQLite support. The following Astro page demonstrates this.</p><pre class="language-js"><code class="language-js"><span class="token operator">--</span><span class="token operator">-</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> Database <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"bun:sqlite"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> Layout <span class="token keyword">from</span> <span class="token string">"../layouts/Layout.astro"</span><span class="token punctuation">;</span><br><br>type Todo <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">id</span><span class="token operator">:</span> number<span class="token punctuation">;</span><br>  <span class="token literal-property property">text</span><span class="token operator">:</span> string<span class="token punctuation">;</span><br>  <span class="token literal-property property">completed</span><span class="token operator">:</span> number<span class="token punctuation">;</span> <span class="token comment">// 0 or 1 for SQLite compatibility</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Database</span><span class="token punctuation">(</span><span class="token string">"todos.db"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">create</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> query <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"select * from todos;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> todos <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> Todo<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token operator">--</span><span class="token operator">-</span><br><br><span class="token operator">&lt;</span>Layout<span class="token operator">></span><br>  <span class="token operator">&lt;</span>h1<span class="token operator">></span>Astro <span class="token keyword">with</span> Bun<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><br>  <span class="token punctuation">{</span> todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">todo</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><br>    <span class="token operator">&lt;</span>div<span class="token operator">></span><br>      <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"checkbox"</span> checked<span class="token operator">=</span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span>completed <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><br>      <span class="token operator">&lt;</span>span<span class="token operator">></span><span class="token punctuation">{</span>todo<span class="token punctuation">.</span>text<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br>  <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><br><span class="token operator">&lt;</span><span class="token operator">/</span>Layout<span class="token operator">></span></code></pre><p>For more details, see <a href="https://docs.astro.build/en/recipes/bun/?v=1.1.1" rel="noopener" target="_blank">Using Bun with Astro</a>.</p><h2 id="starlight" tabindex="-1">Starlight</h2><p><a href="https://starlight.astro.build?v=1.1.1" rel="noopener" target="_blank">Starlight</a> is a documentation theme built on Astro.</p><p>TODO: Describe how to use this.</p><h2 id="resources" tabindex="-1">Resources</h2><ul><li><a href="https://astro.build?v=1.1.1" rel="noopener" target="_blank">Astro Home Page</a></li><li><a href="https://www.youtube.com/watch?v=XoIHKO6AkoM?v=1.1.1" rel="noopener" target="_blank">Astro Quick Start Course</a> by Traversy Media</li></ul><h2 id="unorganized-content" tabindex="-1">Unorganized Content</h2><p>Summarize the steps to deploy an Astro project to Netlify and Vercel.</p><p>See the commercial CloudCannon CMS (<a href="https://cloudcannon.com">https://cloudcannon.com</a>) which uses Astro content collection documents.</p></article>