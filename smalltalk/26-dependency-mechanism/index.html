<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Dependency Mechanism</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#messages">Messages</a></li><li><a href="#example">Example</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p>Any object in Smalltalk can depend on another object and be notified when by it when something signficant occurs. For example, multiple objects may want to be notified when a particular property in some object is modified.</p><p>This is supported by the &quot;dependency mechanism&quot; which is implemented by a set of methods in the <code>Object</code> class.</p><p>Each object maintains a collection of other objects that depend on it.</p><h2 id="messages" tabindex="-1">Messages</h2><p>To add a dependent to an object, send it the message <code>#addDependent:</code> with an argument that is the dependent object to be added.</p><p>To query an object for a collection of its dependents, send it the message <code>#dependents</code>.</p><p>To remove a dependent from an object, send it the message <code>#removeDependent:</code> with an argument that is the dependent object to be removed.</p><p>To signal that a &quot;change&quot; has occurred in an object and trigger each of its dependents to be notified, set it the message <code>#changed</code>, <code>#changed:</code> or <code>#changed:with:</code>.</p><p>The <code>changed</code> method only indicates that some unspecified change occurred. This method is implemented as <code>self changed: self</code>, which calls the method described below.</p><p>The <code>changed:</code> method takes an argument named <code>aspectSymbol</code> that specifies the kind of change that occurred. Typically the argument is a symbol. In Cuis Smalltalk this method is implemented as <code>self triggerEvent: #changed: with: aspectSymbol</code>.</p><p>The <code>changed:with:</code> method takes an argument that specifies the kind of change that occurred and an object descibes the change. Cuis Smalltalk does not support this.</p><p>Each of the &quot;changed&quot; methods causes the message <code>#update:</code> to be sent to each of the dependents.</p><h2 id="example" tabindex="-1">Example</h2><p>Let's walk though a simple example. First we will define a <code>Temperature</code> class that maintains a Celcius temperature and notifies dependents when the temperature changes.</p><pre class="language-smalltalk"><code class="language-smalltalk">Object subclass<span class="token punctuation">:</span> <span class="token symbol">#Temperature</span><br>    instanceVariableNames<span class="token punctuation">:</span> <span class="token string">'celcius'</span><br>    classVariableNames<span class="token punctuation">:</span> <span class="token string">''</span><br>    poolDictionaries<span class="token punctuation">:</span> <span class="token string">''</span><br>    category<span class="token punctuation">:</span> <span class="token string">'Demo'</span><br><br>initialize<br>    celcius <span class="token operator">:=</span> <span class="token number">0</span><br><br>celcius<span class="token punctuation">:</span> aNumber<br>    celcius <span class="token operator">:=</span> aNumber<span class="token punctuation">.</span><br>    <span class="token keyword">self</span> changed<span class="token punctuation">:</span> aNumber<span class="token punctuation">.</span><br><br>celcius<br>    <span class="token operator">^</span> celcius</code></pre><p>Next we will define a <code>Water</code> class that maintains the state of the water (<code>#ice</code>, <code>#liquid</code>, or <code>#gas</code>) depending on the temperature. We could define many classes whose instances depend on the temperature. The <code>update:</code> method is responsible for updating the <code>state</code> when it is informed of a temperature change.</p><pre class="language-smalltalk"><code class="language-smalltalk">Object subclass<span class="token punctuation">:</span> <span class="token symbol">#Water</span><br>    instanceVariableNames<span class="token punctuation">:</span> <span class="token string">'state'</span><br>    classVariableNames<span class="token punctuation">:</span> <span class="token string">''</span><br>    poolDictionaries<span class="token punctuation">:</span> <span class="token string">''</span><br>    category<span class="token punctuation">:</span> <span class="token string">'Demo'</span><br><br>initialize<br>    state <span class="token operator">:=</span> <span class="token symbol">#liquid</span><br><br>state<br>    <span class="token operator">^</span> state<br><br>update<span class="token punctuation">:</span> temperature<br>    state <span class="token operator">:=</span> <span class="token boolean">true</span> caseOf<span class="token punctuation">:</span> <span class="token punctuation">{</span><br>        <span class="token punctuation">[</span>temperature <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token symbol">#ice</span><span class="token punctuation">]</span><span class="token punctuation">.</span><br>        <span class="token punctuation">[</span>temperature <span class="token operator">>=</span> <span class="token number">100</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token symbol">#gas</span><span class="token punctuation">]</span><br>    <span class="token punctuation">}</span> otherwise<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token symbol">#liquid</span><span class="token punctuation">]</span></code></pre><p>Finally, here is some example code that demonstrates using the <code>Temperature</code> and <code>Water</code> classes.</p><pre class="language-smalltalk"><code class="language-smalltalk">t <span class="token operator">:=</span> Temperature <span class="token keyword">new</span><span class="token punctuation">.</span><br>w <span class="token operator">:=</span> Water <span class="token keyword">new</span><span class="token punctuation">.</span><br>w state print<span class="token punctuation">.</span> <span class="token comment">"#liquid"</span><br>t addDependent<span class="token punctuation">:</span> w<span class="token punctuation">.</span><br>t celcius<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">.</span><br>w state<span class="token punctuation">.</span> <span class="token comment">"#ice"</span></code></pre></article>