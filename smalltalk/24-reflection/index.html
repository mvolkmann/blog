<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Reflection</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#getting-keywords-from-selectors">Getting Keywords from Selectors</a></li><li><a href="#operating-on-all-instances">Operating on All Instances</a></li><li><a href="#sending-messages">Sending Messages</a></li><li><a href="#finding-the-method-for-a-selector">Finding the Method for a Selector</a></li><li><a href="#finding-methods-by-example">Finding Methods by Example</a></li><li><a href="#questions">Questions</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p>Smalltalk provides many methods for getting information about classes and objects. The following table lists some of them.</p><table><thead><tr><th>Method</th><th>Answers</th></tr></thead><tbody><tr><td><code>object class</code></td><td>the class of <code>object</code></td></tr><tr><td><code>object instVarNamed: #varName</code></td><td>the value of an instance variable in <code>object</code></td></tr><tr><td><code>object instVarNamed: #varName</code> put: newValue</td><td>sets value of an instance variable in <code>object</code> and answers new value</td></tr><tr><td><code>object class = SomeClass</code></td><td>answers <code>Boolean</code> indicating if <code>object</code> is an instance of the class <code>SomeClass</code> (not one of its subclasses)</td></tr><tr><td><code>object isKindOf: SomeClass</code></td><td>answers <code>Boolean</code> indicating if <code>object</code> is an instance of the class <code>SomeClass</code> or one of its subclasses</td></tr><tr><td><code>object respondsTo: #selector</code></td><td>answers <code>Boolean</code> indicating if the object responds to a given method selector</td></tr><tr><td><code>SomeClass name</code></td><td>the name of the class as a <code>String</code></td></tr><tr><td><code>Smalltalk allClasses</code></td><td>an <code>Array</code> of all classes defined in the current image</td></tr><tr><td><code>Smalltalk allClassesImplementing: #selector</code></td><td>an <code>Array</code> of all classes that implement a given selector</td></tr><tr><td><code>SystemOrganization categoryOfElement: #SomeClass</code></td><td>name of the class category to which a given class belongs</td></tr><tr><td><code>SomeClass allClassVarNames</code></td><td>a <code>Set</code> of class variable names defined in this class</td></tr><tr><td><code>SomeClass allSelectors</code></td><td>an <code>IdentitySet</code> of all message selectors (as <code>Symbol</code> objects) supported by this class, including selectors in superclasses</td></tr><tr><td><code>SomeClass lookupSelector: #selector</code></td><td>the matching <code>CompiledMethod</code>, indicating where it is found</td></tr><tr><td><code>SomeClass allInstances</code></td><td>an <code>Array</code> of all existing instances of this class</td></tr><tr><td><code>SomeClass allInstVarNames</code></td><td>an <code>Array</code> of instance variable names defined in this class</td></tr><tr><td><code>SomeClass allInstVarNamesEverywhere</code></td><td>an <code>Array</code> of instance variable names defined in this class and inherited classes</td></tr><tr><td><code>SomeClass allMethodsInCategory: 'some-category'</code></td><td>an <code>Array</code> of instance methods in a given category, including those defined in this class and inherited</td></tr><tr><td><code>SomeClass allSubclasses</code></td><td>an <code>OrderedCollection</code> of subclasses</td></tr><tr><td><code>SomeClass superclass</code></td><td>a <code>Class</code> that is the superclass of this class</td></tr><tr><td><code>SomeClass withAllSuperclasses</code></td><td>an <code>OrderedCollection</code> containing all superclasses of this class going up the hierarchy</td></tr><tr><td><code>SomeClass allSuperclasses</code></td><td>an <code>OrderedCollection</code> of superclasses</td></tr><tr><td><code>SomeClass selectors</code></td><td>an <code>Array</code> of all instance method selectors (as <code>Symbol</code> objects) of this class</td></tr><tr><td><code>SomeClass class</code></td><td>the <code>Metaclass</code> subclass of this class</td></tr><tr><td><code>SomeClass class selectors</code></td><td>an <code>Array</code> of all class method selectors (as <code>Symbol</code> objects) of this class</td></tr><tr><td><code>SomeClass class allMethodsInCategory: 'some-category'</code></td><td>an <code>Array</code> of class methods in a given category, including those defined in this class and inherited</td></tr><tr><td><code>CodeListPackages installedPackages</code></td><td>an <code>Array</code> of <code>CodePackage</code> objects (appear in System Browser class category pane)</td></tr><tr><td><code>thisContext sender</code></td><td>a <code>MethodContext</code> describing the method that invoked the current one</td></tr><tr><td><code>someMethodContext receiver</code></td><td>the object that sent the message that invoked the <code>MethodContext</code></td></tr><tr><td><code>someMethodContext selector</code></td><td>the selector <code>Symbol</code> of the message that invoked the <code>MethodContext</code></td></tr><tr><td><code>someSelector keywords</code></td><td>an <code>Array</code> of the keywords in the selector</td></tr></tbody></table><h2 id="getting-keywords-from-selectors" tabindex="-1">Getting Keywords from Selectors</h2><p>The following examples demonstrate getting keywords from a message selector:</p><pre class="language-smalltalk"><code class="language-smalltalk"><span class="token symbol">#foo</span> keywords<span class="token punctuation">.</span> <span class="token comment">"#('foo')"</span><br><span class="token symbol">#foo</span><span class="token punctuation">:</span>bar<span class="token punctuation">:</span>baz<span class="token punctuation">:</span> keywords<span class="token punctuation">.</span> <span class="token comment">"#('foo:' 'bar:' 'baz:')"</span></code></pre><h2 id="operating-on-all-instances" tabindex="-1">Operating on All Instances</h2><p>To run code on every instance of a given class, send the <code>allInstancesDo:</code> message to the class.</p><p>For example, to delete all instances of a given class, run <code>SomeClass allInstancesDo: [:obj | obj delete]</code>.</p><h2 id="sending-messages" tabindex="-1">Sending Messages</h2><p>See the &quot;Dynamic Messages&quot; section in the &quot;Messages&quot; page. This describes how to use <code>perform:</code> to send messages to objects where the selector is a <code>Symbol</code>.</p><h2 id="finding-the-method-for-a-selector" tabindex="-1">Finding the Method for a Selector</h2><p>There isn't a provided method that finds the nearest class in the inheritance hierarchy that implements a method with a given selector. I added the following method to do that. It is in the <code>Behavior</code> class in the method category &quot;*TypeCheck&quot;, so it is saved in the TypeCheck package.</p><pre class="language-smalltalk"><code class="language-smalltalk">lookupClassImplementingSelector<span class="token punctuation">:</span> selectorSymbol<br>    <span class="token comment">"Look up the given selector in my methodDictionary.<br>    Return the class that implements it if found.<br>    Otherwise chase the superclass chain and try again.<br>    Return nil if no implementing class is found."</span><br>    <span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">class</span> <span class="token punctuation">|</span></span><br><br>    class <span class="token operator">:=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><br>    <span class="token punctuation">[</span>class <span class="token operator">==</span> <span class="token keyword">nil</span><span class="token punctuation">]</span> whileFalse<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>        class includesSelector<span class="token punctuation">:</span> selectorSymbol <span class="token punctuation">:</span><span class="token punctuation">:</span> ifTrue<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">^</span> class<span class="token punctuation">]</span><span class="token punctuation">.</span><br>        class <span class="token operator">:=</span> class superclass<br>    <span class="token punctuation">]</span><span class="token punctuation">.</span><br>    <span class="token operator">^</span> <span class="token keyword">nil</span></code></pre><h2 id="finding-methods-by-example" tabindex="-1">Finding Methods by Example</h2><p>The Squeak development environment provides a way to find methods by example using the &quot;Method Finder&quot; tool (a.k.a. Selector Browser).</p><p><img alt="Squeak Selector Browser" style="width: 85%" src="/blog/assets/squeak-selector-browser.png?v=1.1.1"></p><p>I implemented similar functionality in Cuis, minus the GUI. See <a href="https://github.com/mvolkmann/Cuis-Smalltalk-FindByExample" target="_blank">Cuis-Smalltalk-FindByExample</a>. It's amazing how fast this is!</p><p><img alt="Cuis Smalltalk Method Finder" style="width: 85%" src="/blog/assets/cuis-smalltalk-method-finder.png?v=1.1.1"></p><p>For example, evaluating the following in a Workspace:</p><pre class="language-smalltalk"><code class="language-smalltalk">Finder methodsByExample<span class="token punctuation">:</span> <span class="token symbol">#</span><span class="token punctuation">(</span><span class="token symbol">#</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token number">2.5</span><span class="token punctuation">)</span></code></pre><p>prints the following in the Transcript:</p><pre class="language-text"><code class="language-text">The following methods on #(1 2 3 4) with no arguments return 2.5:<br>- average<br>- mean</code></pre><p>There are more examples in the README.</p><h2 id="questions" tabindex="-1">Questions</h2><p>TODO: Why does <code>allClassVarNames</code> return a <code>Set</code> when <code>allInstVarNames</code> returns an <code>Array</code>? TODO: Is there a way to get all the message categories used by a class?</p></article>