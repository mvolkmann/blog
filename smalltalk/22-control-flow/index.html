<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Control Flow</h2><aside><nav class="toc"><ol><li><a href="#conditional-logic">Conditional Logic</a></li><li><a href="#iteration">Iteration</a></li></ol></nav></aside><article><p>Smalltalk does not provide special syntax for conditional logic and iteration. Instead, control flow is provided through message passing.</p><h3 id="conditional-logic" tabindex="-1">Conditional Logic</h3><p>The <code>Boolean</code> class in the <code>Kernel-Objects</code> category contains the methods <code>#ifTrue:</code>, <code>#ifFalse:</code>, <code>#ifTrue:ifFalse:</code>, and <code>#ifFalse:ifTrue:</code>. For example:</p><pre class="language-smalltalk"><code class="language-smalltalk">result <span class="token operator">:=</span> a <span class="token operator">&lt;</span> b ifTrue<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'less'</span><span class="token punctuation">]</span> ifFalse<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'more'</span><span class="token punctuation">]</span><span class="token punctuation">.</span></code></pre><p>The values for <code>ifTrue</code> and <code>ifFalse</code> can be literal values, variables, or blocks with no parameters. The messages listed above just send the <code>value</code> message to the argument value. Typically the <code>value</code> message is used to evaluate a no-arg block. However, the <code>Object</code> class defines the <code>value</code> method to just return <code>self</code>, which is what enables any kind of object to be used.</p><p>When blocks are used, the compiler is able to optimized the code by inlining the code within the block and avoiding the need to send the <code>value</code> message. So it is more efficient to use blocks. TODO: But does it make a difference if the value is a literal like a number or string?</p><p>The <code>Object</code> instance method <code>caseOf:</code> is similar to the <code>switch</code> statement in other programming languages. The argument for <code>caseOf:</code> is a dynamic array of <code>Association</code> elements where the keys and values are both blocks. It can optionally take an <code>otherwise:</code> argument whose value is a block that evaluates to the value to use if none if the cases are matched. If <code>otherwise:</code> is not used and no match is found, the error &quot;Case not found, and not otherwise clause&quot; is raised.</p><p>For example:</p><pre class="language-smalltalk"><code class="language-smalltalk">color <span class="token operator">:=</span> <span class="token symbol">#blue</span><span class="token punctuation">.</span><br><br>assessment <span class="token operator">:=</span> color caseOf<span class="token punctuation">:</span> <span class="token punctuation">{</span><br>    <span class="token punctuation">[</span><span class="token symbol">#red</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token string">'hot'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><br>    <span class="token punctuation">[</span><span class="token symbol">#green</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token string">'warm'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><br>    <span class="token punctuation">[</span><span class="token symbol">#blue</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token string">'cold'</span><span class="token punctuation">]</span><br><span class="token punctuation">}</span><span class="token punctuation">.</span><br><br>assessment <span class="token operator">:=</span> color caseOf<span class="token punctuation">:</span> <span class="token punctuation">{</span><br>    <span class="token punctuation">[</span><span class="token symbol">#red</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token string">'hot'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><br>    <span class="token punctuation">[</span><span class="token symbol">#green</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token string">'warm'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><br>    <span class="token punctuation">[</span><span class="token symbol">#blue</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token string">'cold'</span><span class="token punctuation">]</span><br><span class="token punctuation">}</span> otherwise<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'unknown'</span><span class="token punctuation">]</span><span class="token punctuation">.</span></code></pre><p>Using <code>caseOf:</code> requires a sequential search for a matching value. If there are a large number of cases, consider using a <code>Dictionary</code> that is initialized one time outside the methods that use it. The values can be blocks containing arbitrary code. For example:</p><pre class="language-smalltalk"><code class="language-smalltalk">colorToAssessment <span class="token operator">:=</span> Dictionary newFrom<span class="token punctuation">:</span> <span class="token punctuation">{</span><br>    <span class="token symbol">#red</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token string">'hot'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><br>    <span class="token symbol">#green</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token string">'warm'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><br>    <span class="token symbol">#blue</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token string">'cold'</span><span class="token punctuation">]</span><br><span class="token punctuation">}</span><span class="token punctuation">.</span><br><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><br>assessment <span class="token operator">:=</span> colorToAssessment at<span class="token punctuation">:</span> color<span class="token punctuation">.</span></code></pre><p>The <code>Association</code> objects in the collection passed to the <code>caseOf:</code> method must have keys and values that are both blocks. Often the blocks just contain a single literal value such as a number, symbol, or string. We can define new instance methods in the <code>Object</code> class that are similar to <code>caseOf:</code> and <code>caseOf:otherwise:</code>, but do not require the <code>Association</code> keys and values to be blocks.</p><pre class="language-smalltalk"><code class="language-smalltalk">switchOn<span class="token punctuation">:</span> assocColl<br>    <span class="token comment">"The elements of assocColl are associations. Answer the evaluated value<br>    of the first association in assocCol whose evaluated key equals the receiver.<br>    If no match is found, signal an error.<br>    This differs from caseOf: in that the keys and values<br>    of the associations are not required to be blocks."</span><br><br>    <span class="token operator">^</span> <span class="token keyword">self</span> switchOn<span class="token punctuation">:</span> assocColl otherwise<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token keyword">self</span> caseError <span class="token punctuation">]</span><br><br>switchOn<span class="token punctuation">:</span> assocColl otherwise<span class="token punctuation">:</span> aBlock<br>    <span class="token comment">"The elements of assocColl must be associations. Answer the evaluated value<br>    of the first association in assocCol whose evaluated key equals the receiver.<br>    If no match is found, answer the result of evaluating aBlock.<br>    This differs from caseOf: in that the keys and values<br>    of the associations are not required to be blocks."</span><br><br>    assocColl associationsDo<span class="token punctuation">:</span><br>        <span class="token punctuation">[</span> <span class="token block-arguments"><span class="token variable">:assoc</span> <span class="token punctuation">|</span></span> <span class="token punctuation">(</span>assoc key value <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">)</span> ifTrue<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token operator">^</span>assoc value value <span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">.</span><br>    <span class="token operator">^</span> aBlock value</code></pre><p>The following code demonstrates using the <code>switchOn:otherwise:</code> method.</p><pre class="language-smalltalk"><code class="language-smalltalk">command <span class="token operator">:=</span> <span class="token symbol">#pause</span><span class="token punctuation">.</span><br><br>message <span class="token operator">:=</span> command switchOn<span class="token punctuation">:</span> <span class="token punctuation">{</span><br>    <span class="token symbol">#start</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">'Starting the system'</span><span class="token punctuation">.</span><br>    <span class="token symbol">#pause</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">'Pausing the system'</span><span class="token punctuation">.</span><br>    <span class="token symbol">#resume</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">'Resuming the system'</span><span class="token punctuation">.</span><br>    <span class="token symbol">#stop</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">'Stopping the system'</span><span class="token punctuation">.</span><br><span class="token punctuation">}</span> otherwise<span class="token punctuation">:</span> <span class="token string">'Unsupported command'</span><span class="token punctuation">.</span><br><br>message print<span class="token punctuation">.</span></code></pre><p>The &quot;switch&quot; methods defined above are defined in the package <a href="https://github.com/mvolkmann/Cuis-Smalltalk-Switch" target="_blank">Cuis-Smalltalk-Switch</a>.</p><p>Using nested <code>#ifTrue:ifFalse:</code> messages can be verbose and requires having the correct number of closing square brackets at the end. For example, the following assigns a string to a variable based on the temperature:</p><pre class="language-smalltalk"><code class="language-smalltalk">assessment <span class="token operator">:=</span><br>    temperature <span class="token operator">></span> <span class="token number">80</span> ifTrue<span class="token punctuation">:</span> <span class="token string">'hot'</span> ifFalse<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>    temperature <span class="token operator">&lt;</span> <span class="token number">40</span> ifTrue<span class="token punctuation">:</span> <span class="token string">'cold'</span> ifFalse<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>    <span class="token string">'warm'</span><span class="token punctuation">]</span><span class="token punctuation">]</span></code></pre><p>Another option is to send the message <code>#caseOf:</code> to <code>true</code>. This avoids using nested <code>ifFalse:</code> messages and counting square brackets. For example:</p><pre class="language-smalltalk"><code class="language-smalltalk">assessment <span class="token operator">:=</span> <span class="token boolean">true</span> caseOf<span class="token punctuation">:</span> <span class="token punctuation">{</span><br>    <span class="token punctuation">[</span>temperature <span class="token operator">></span> <span class="token number">80</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token string">'hot'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><br>    <span class="token punctuation">[</span>temperature <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token string">'cold'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><br><span class="token punctuation">}</span> otherwise<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'warm'</span><span class="token punctuation">]</span><span class="token punctuation">.</span></code></pre><p>Another option, suggested by Lauren Pullen, is to add an instance method like <code>cond:</code> to the <code>ArrayedCollection</code> class. It can be defined as follows:</p><pre class="language-smalltalk"><code class="language-smalltalk">cond<span class="token punctuation">:</span> defaultBlock<br>    <span class="token comment">"Mimic the Common Lisp/Scheme COND with a Smalltalk twist."</span><br>    <span class="token keyword">self</span> associationsDo<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token block-arguments"><span class="token variable">:assoc</span> <span class="token punctuation">|</span></span><br>        assoc key value ifTrue<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">^</span>assoc value value<span class="token punctuation">]</span><br>    <span class="token punctuation">]</span><span class="token punctuation">.</span><br>    <span class="token operator">^</span> defaultBlock value<span class="token punctuation">.</span></code></pre><p>The following code demonstrates using the <code>cond:</code> method.</p><pre class="language-smalltalk"><code class="language-smalltalk">condition <span class="token operator">:=</span> <span class="token punctuation">{</span><br>    <span class="token punctuation">[</span>temperature <span class="token operator">></span> <span class="token number">80</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token string">'hot'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><br>    <span class="token punctuation">[</span>temperature <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">]</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token string">'cold'</span><span class="token punctuation">]</span><br><span class="token punctuation">}</span> cond<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'warm'</span><span class="token punctuation">]</span><span class="token punctuation">.</span></code></pre><p>Moving the logic to its own function, perhaps in the &quot;private&quot; category, can make the code less verbose and more clear. When a block uses the <code>^</code> operator to return a value, the containing method exits and returns that value. For example:</p><pre class="language-smalltalk"><code class="language-smalltalk">assessTemperature<span class="token punctuation">:</span> aNumber<br>    aNumber <span class="token operator">></span> <span class="token number">80</span> ifTrue<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">^</span><span class="token string">'hot'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><br>    aNumber <span class="token operator">&lt;</span> <span class="token number">40</span> ifTrue<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">^</span><span class="token string">'cold'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><br>    <span class="token operator">^</span><span class="token string">'warm'</span></code></pre><p>Many classes define methods that return a <code>Boolean</code> value that is useful for conditional logic. Some examples include:</p><table><thead><tr><th>Class</th><th>Instance Method</th></tr></thead><tbody><tr><td><code>Character</code></td><td><code>isAlphaNumeric</code></td></tr><tr><td><code>Character</code></td><td><code>isDigit</code></td></tr><tr><td><code>Character</code></td><td><code>isLetter</code></td></tr><tr><td><code>Character</code></td><td><code>isLineSeparator</code></td></tr><tr><td><code>Character</code></td><td><code>isLowercase</code></td></tr><tr><td><code>Character</code></td><td><code>isPathSeparator</code></td></tr><tr><td><code>Character</code></td><td><code>isSeparator</code></td></tr><tr><td><code>Character</code></td><td><code>isUppercase</code></td></tr><tr><td><code>Character</code></td><td><code>isVowel</code></td></tr><tr><td><code>Collection</code></td><td><code>isEmpty</code></td></tr><tr><td><code>Color</code></td><td><code>isDark</code></td></tr><tr><td><code>Color</code></td><td><code>isLight</code></td></tr><tr><td><code>Color</code></td><td><code>isTransparent</code></td></tr><tr><td><code>Date</code></td><td><code>isLeapYear</code></td></tr><tr><td><code>Exception</code></td><td><code>isResumable</code></td></tr><tr><td><code>Integer</code></td><td><code>isPowerOfTwo</code></td></tr><tr><td><code>Integer</code></td><td><code>isPrime</code></td></tr><tr><td><code>Interval</code></td><td><code>isEmpty</code></td></tr><tr><td><code>Number</code></td><td><code>isDivisbleBy:</code></td></tr><tr><td><code>Number</code></td><td><code>isEven</code></td></tr><tr><td><code>Number</code></td><td><code>isNaN</code></td></tr><tr><td><code>Number</code></td><td><code>isOdd</code></td></tr><tr><td><code>Number</code></td><td><code>isZero</code></td></tr><tr><td><code>Object</code></td><td><code>isArray</code></td></tr><tr><td><code>Object</code></td><td><code>isBlock</code></td></tr><tr><td><code>Object</code></td><td><code>isCharacter</code></td></tr><tr><td><code>Object</code></td><td><code>isCollection</code></td></tr><tr><td><code>Object</code></td><td><code>isFloat</code></td></tr><tr><td><code>Object</code></td><td><code>isFraction</code></td></tr><tr><td><code>Object</code></td><td><code>isInteger</code></td></tr><tr><td><code>Object</code></td><td><code>isInterval</code></td></tr><tr><td><code>Object</code></td><td><code>isMemberOf</code></td></tr><tr><td><code>Object</code></td><td><code>isNumber</code></td></tr><tr><td><code>Object</code></td><td><code>isPinned</code></td></tr><tr><td><code>Object</code></td><td><code>isPoint</code></td></tr><tr><td><code>Object</code></td><td><code>isString</code></td></tr><tr><td><code>Object</code></td><td><code>isSymbol</code></td></tr><tr><td><code>Point</code></td><td><code>isZero</code></td></tr><tr><td><code>ProtoObject</code></td><td><code>isNil</code></td></tr><tr><td><code>String</code></td><td><code>isEmpty</code></td></tr><tr><td><code>SystemDictionary</code></td><td><code>isHeadless</code></td></tr><tr><td><code>SystemVersion</code></td><td><code>isCuis</code></td></tr><tr><td><code>SystemVersion</code></td><td><code>isPharo</code></td></tr><tr><td><code>SystemVersion</code></td><td><code>isSqueak</code></td></tr></tbody></table><h3 id="iteration" tabindex="-1">Iteration</h3><p>The <code>Integer</code> class described in the &quot;Basic Data Types&quot; section provides several methods for iteration.</p><p>The <code>timesRepeat:</code> method evaluates a block a given number of times. For example, the following code prints the string <code>'Ho'</code> three times on separate lines:</p><pre class="language-smalltalk"><code class="language-smalltalk"><span class="token number">3</span> timesRepeat<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'Ho'</span> print<span class="token punctuation">]</span></code></pre><p>The <code>to:do:</code> and <code>to:by:do:</code> methods evaluate a block for each <code>Integer</code> value in a range with an optional step (<code>by:</code>) size. For example, the following code prints the numbers 1, 3, 5, 7, and 9 on separate lines.</p><pre class="language-smalltalk"><code class="language-smalltalk"><span class="token number">1</span> to<span class="token punctuation">:</span> <span class="token number">10</span> by<span class="token punctuation">:</span> <span class="token number">2</span> do<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token block-arguments"><span class="token variable">:n</span> <span class="token punctuation">|</span></span> n print<span class="token punctuation">]</span></code></pre><p>An alternative is to first create an <code>Interval</code> object and then send it the <code>#do:</code> message to evaluate a block argument for each value in the <code>Interval</code>. For example:</p><pre class="language-smalltalk"><code class="language-smalltalk">interval <span class="token operator">:=</span> <span class="token number">1</span> to<span class="token punctuation">:</span> <span class="token number">10</span> by<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">.</span><br>interval do<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token block-arguments"><span class="token variable">:n</span> <span class="token punctuation">|</span></span> n print<span class="token punctuation">]</span></code></pre><p>See the &quot;Blocks&quot; section for messages that use a <code>BlockClosure</code> as an iteration condition. The methods include <code>whileTrue</code>, <code>whileTrue:</code>, <code>whileFalse</code>, <code>whileFalse:</code>, <code>whileNotNil:</code>, and <code>whileNil:</code>.</p><p>See the &quot;Collections&quot; section for messages that iterate over a collection.</p></article>