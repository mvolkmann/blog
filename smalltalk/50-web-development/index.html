<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Web Development</h2><aside><nav class="toc"><ol><li><a href="#basic-example">Basic Example</a></li><li><a href="#sending-http-requests">Sending HTTP Requests</a></li><li><a href="#implementing-an-http-server">Implementing an HTTP Server</a></li><li><a href="#webclient-issues">WebClient Issues</a></li></ol></nav></aside><article><p>One package for implementing a web server is <a href="https://github.com/Cuis-Smalltalk/Cuis-Smalltalk-Dev/blob/master/Packages/Features/WebClient.pck.st" target="_blank">WebClient</a>. To install this, open a Workspace, enter <code>Feature require: 'WebClient'</code>, and &quot;Do it&quot;. This adds many classes in the &quot;WebClient - Core&quot; category including <code>WebClient</code>, <code>WebRequest</code>, <code>WebResponse</code>, <code>WebServer</code>, and <code>WebSocket</code>. In addition, to send and receive requests with JSON bodies, open a Workspace, enter <code>Feature require: 'Json'</code>, and &quot;Do it&quot;.</p><p>Also see the <a href="https://github.com/SeasideSt/Seaside" target="_blank">Seaside</a> and <a href="https://github.com/zeroflag/Teapot" target="_blank">Teapot</a> frameworks.</p><p>See the <a href="https://book.seaside.st/book" target="_blank">Seaside Book</a>.</p><h2 id="basic-example" tabindex="-1">Basic Example</h2><p>Here is a very simple use of the WebServer class that can be installed with <code>Feature require: 'WebClient'</code>. Create the class <code>BasicWebServer</code> as follows:</p><pre class="language-smalltalk"><code class="language-smalltalk">Object subclass<span class="token punctuation">:</span> <span class="token symbol">#BasicWebServer</span><br>    instanceVariableNames<span class="token punctuation">:</span> <span class="token string">'server'</span><br>    classVariableNames<span class="token punctuation">:</span> <span class="token string">''</span><br>    poolDictionaries<span class="token punctuation">:</span> <span class="token string">''</span><br>    category<span class="token punctuation">:</span> <span class="token string">'Volkmann'</span></code></pre><p>Add the following instance methods:</p><pre class="language-smalltalk"><code class="language-smalltalk">initialize<br>    server <span class="token operator">:=</span> WebServer <span class="token keyword">new</span><span class="token punctuation">.</span><br>    server addService<span class="token punctuation">:</span> <span class="token string">'/'</span> action<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token block-arguments"><span class="token variable">:req</span> <span class="token punctuation">|</span></span> req send200Response<span class="token punctuation">:</span> <span class="token string">'Hello, World!'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><br><br>start<br>    server listenOn<span class="token punctuation">:</span> <span class="token number">3000</span><br><br>stop<br>    server destroy</code></pre><p>Create and start the web server with:</p><pre class="language-smalltalk"><code class="language-smalltalk">server <span class="token operator">:=</span> BasicWebServer <span class="token keyword">new</span><span class="token punctuation">.</span><br>server start<span class="token punctuation">.</span></code></pre><p>Browse localhost:3000 to see &quot;Hello, World!&quot;.</p><p>Stop the web server with <code>server stop</code>.</p><p>Restart it with <code>server start</code>.</p><h2 id="sending-http-requests" tabindex="-1">Sending HTTP Requests</h2><p>The <code>WebClient</code> class defines class methods that send HTTP requests. For example:</p><pre class="language-smalltalk"><code class="language-smalltalk">res <span class="token operator">:=</span> WebClient httpGet<span class="token punctuation">:</span> <span class="token string">'https://pokeapi.co/api/v2/pokemon/pikachu'</span><span class="token punctuation">.</span></code></pre><p>The variable <code>res</code> above will refer to a <code>WebResponse</code> object. This has many instance variables including:</p><ul><li><code>code</code> - status code such as 200</li><li><code>content</code> - response body</li><li><code>headers</code> - an <code>OrderedCollection</code> of <code>Association</code> objects that describe the HTTP response headers such as <code>content-type</code> with a value like <code>text/html; charset=utf-8</code> or <code>application/json; charset=utf-8</code></li><li><code>protocol</code> - such as the <code>String</code> <code>HTTP/1.1</code></li><li><code>status</code> - such as the <code>String</code> <code>HTTP/1.1 200 OK</code></li><li><code>url</code> - the URL to which the request was sent</li></ul><h2 id="implementing-an-http-server" tabindex="-1">Implementing an HTTP Server</h2><p>To start a web server, create a <code>WebServer</code> instance and send it the <code>listenOn:</code> message. this starts a Smalltalk process called &quot;WebServers's listener process&quot;. To kill it, open a &quot;Process Browser&quot;, select the process, and press cmd-t (Terminate).</p><p>See the class <code>MyWebServer</code> in the <code>Volkmann</code> package. The <code>handleDog:</code> method defines CRUD endpoints. TODO: Provide more detail about defining endpoints.</p><h2 id="webclient-issues" tabindex="-1">WebClient Issues</h2><ul><li>It doesn't support paths containing path parameters.</li><li>It doesn't support query parameters.</li><li>It doesn't support PATCH requests.</li></ul></article>