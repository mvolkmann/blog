<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Databases</h2><aside><nav class="toc"><ol><li><a href="#installing">Installing</a></li></ol></nav></aside><article><h2 id="installing" tabindex="-1">Installing</h2><p>To install Cuis Smalltalk support for ODBC:</p><ul><li>Clone the Git repository at <a href="https://github.com/Cuis-Smalltalk/DatabaseSupport">https://github.com/Cuis-Smalltalk/DatabaseSupport</a>.</li><li>Open a &quot;File List&quot; window.</li><li>Navigate to the &quot;DatabaseSupport&quot; directory.</li><li>Select the file <code>ODBC_pck.st</code>.</li><li>Click the &quot;install package&quot; button.</li></ul><p>This adds the class category &quot;ODBC&quot;.</p><p>This package requires the <code>libodbc</code> external library. To install this in macOS, install Homebrew and enter <code>brew install unixodbc</code>. This installs the file <code>libodbc.2.dylib</code>.</p><p>Add the following in <code>.bashrc</code> or <code>.zshrc</code>:</p><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">DYLD_LIBRARY_PATH</span><span class="token operator">=</span><span class="token string">"/usr/local/lib"</span></code></pre><p>To access SQLite databases in macOS, enter <code>brew install sqliteodbc</code>.</p><p>Create the file <code>/usr/local/etc/odbc.ini</code> or <code>~/.odbc.ini</code>. Add the following contents:</p><pre class="language-text"><code class="language-text">[TodoDSN]<br>Description = SQLite ODBC Driver<br>Driver = /usr/local/lib/libsqlite3odbc.dylib<br>Database = /Users/volkmannm/Documents/dev/lang/smalltalk/Cuis-Smalltalk-Dev-UserFiles/todos.db<br>Timeout = 2000</code></pre><p>Test the connection by entering <code>isql TodoDSN</code> and <code>select * from todos;</code>.</p><p>See the example code in the <code>dsn:user:password:query:</code> class method of the <code>ODBCConnection</code> class.</p><p>Open a Browser, select the ODBC class category, select the ODBCConnection class, click the &quot;class&quot; button, and see the sample code in the class method <code>dsn:user:password:query:</code>.</p><p>This fails on the line <code>conn := ODBCConnection dsn: dsn user: user password: password.</code> The error is &quot;External module not found&quot;.</p><p>TODO: Try using the ODBC package to access many kinds of databases including TODO: SQLite, PostgreSQL, and MongoDB.</p><p>I sent the following to the Cuis mailing list on 9/23/2023:</p><p>I'm learning how to access databases from Cuis Smalltalk. Here's what I've done so far:</p><ul><li>Clone the Git repository at <a href="https://github.com/Cuis-Smalltalk/DatabaseSupport">DatabaseSupport</a>.</li><li>Open a &quot;File List&quot; window.</li><li>Navigate to the &quot;DatabaseSupport&quot; directory.</li><li>Select the file <code>ODBC_pck.st</code>.</li><li>Click the &quot;install package&quot; button.</li><li>Try the sample code in the class method dsn:user:password:query: of the ODBCConnection class in the ODBC class category.</li></ul><p>This line gives an error:</p><pre class="language-smalltalk"><code class="language-smalltalk">conn <span class="token operator">:=</span> ODBCConnection dsn<span class="token punctuation">:</span> dsn user<span class="token punctuation">:</span> user password<span class="token punctuation">:</span> password<span class="token punctuation">.</span></code></pre><p>The error is &quot;External module not found&quot;. I'm running in macOS. I suspect it is trying to find the file /usr/local/lib/libodbc.dylib or libodc.2.dylib. Those files exist on my machine. Do I need to do something to let Cuis know where to find those files?</p><p>The line where this fails is</p><pre class="language-text"><code class="language-text">&lt;cdecl: int16 'SQLAllocEnv' (SQLHENV*)&gt;</code></pre><p>Am I supposed to set an environment variable in order for this to work?</p></article>