<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Startup Scripts</h2><aside><nav class="toc"><ol><li><a href="#when-to-use">When To Use</a></li><li><a href="#startup-script-example">Startup Script Example</a></li><li><a href="#package-example">Package Example</a></li></ol></nav></aside><article><p>It is helpful to have a way to configure an image with.</p><ul><li>specific preferences set settings</li><li>tool windows open at specfied locations with specified sizes</li><li>desired packages loaded</li></ul><p>There is more than one way to accomplish this. One way is to write and use a startup script. Another way is to create and load a package.</p><h2 id="when-to-use" tabindex="-1">When To Use</h2><p>The ability to easily configure a new image is useful when new versions of Cuis Smalltalk are released or just to create an image for a specific project. A new base image can be opened and configured. Once this is done, open the World menu and select &quot;Save Image as...&quot; to save the image under a new name.</p><p>Starting future sessions using the saved image will be much faster than starting the base image using a startup script. The reason is that the saved image will already contain all the packages installed by the startup script. Loading packages during startup is relative time consuming.</p><h2 id="startup-script-example" tabindex="-1">Startup Script Example</h2><p>The following is an example script in a file named <code>cuis</code>.</p><pre class="language-bash"><code class="language-bash"><span class="token shebang important">#!/usr/bin/env zsh</span><br><span class="token assign-left variable">CUIS_DIR</span><span class="token operator">=</span><span class="token variable">$SMALLTALK_DIR</span>/Cuis-Smalltalk-Dev<br><span class="token assign-left variable">VM</span><span class="token operator">=</span><span class="token variable">$CUIS_DIR</span>/CuisVM.app/Contents/MacOS/Squeak<br><span class="token assign-left variable">IMAGE</span><span class="token operator">=</span><span class="token variable">$CUIS_DIR</span>/CuisImage/base-copy.image<br><span class="token variable">$VM</span> <span class="token variable">$IMAGE</span> <span class="token parameter variable">-s</span> setup.st</code></pre><p>To run headless, change the last line to the following:</p><pre class="language-bash"><code class="language-bash"><span class="token variable">$VM</span> <span class="token parameter variable">-headless</span> <span class="token variable">$IMAGE</span> <span class="token parameter variable">-s</span> setup.st</code></pre><p>The following is an example of what can appear in the file <code>setup.st</code> which contains Smalltalk code:</p><pre class="language-smalltalk"><code class="language-smalltalk"><span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">world</span> <span class="token punctuation">|</span></span><br>Utilities setAuthorName<span class="token punctuation">:</span> <span class="token string">'R. Mark Volkmann'</span> initials<span class="token punctuation">:</span> <span class="token string">'rmv'</span><span class="token punctuation">.</span><br>world <span class="token operator">:=</span> UISupervisor ui<span class="token punctuation">.</span><br><span class="token punctuation">[</span><br>    Display fullScreenMode<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">.</span><br>    <span class="token punctuation">(</span>Delay forSeconds<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span> wait<span class="token punctuation">.</span><br>    UISupervisor whenUIinSafeState<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>        <span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">area</span> <span class="token variable">browser</span> <span class="token variable">children</span> <span class="token variable">extent</span> <span class="token variable">taskbarHeight</span> <span class="token variable">workspace</span> <span class="token punctuation">|</span></span><br><br>        <span class="token comment">"Delete all submorphs of the WorldMorph except the taskbar."</span><br>        children <span class="token operator">:=</span> world submorphs reject<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token block-arguments"><span class="token variable">:aMorph</span> <span class="token punctuation">|</span></span> aMorph is<span class="token punctuation">:</span> <span class="token symbol">#TaskbarMorph</span><span class="token punctuation">]</span><span class="token punctuation">.</span><br>        children do<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token block-arguments"><span class="token variable">:child</span> <span class="token punctuation">|</span></span> child delete<span class="token punctuation">]</span><span class="token punctuation">.</span><br><br>        <span class="token comment">"Set some preferences."</span><br>        <span class="token comment">"Preferences at: #defaultFontSize put: 14."</span><br>        Preferences at<span class="token punctuation">:</span> <span class="token symbol">#defaultFontSize</span> put<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">.</span><br><br>        <span class="token comment">"Get the usable area not including the taskbar."</span><br>        taskbarHeight <span class="token operator">:=</span> UISupervisor ui taskbar morphHeight<span class="token punctuation">.</span><br>        area <span class="token operator">:=</span> RealEstateAgent maximumUsableArea<br>            extendBy<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token operator">@</span> taskbarHeight negated<span class="token punctuation">.</span><br>        extent <span class="token operator">:=</span> area extent <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">.</span> <span class="token comment">"quarter of world"</span><br><br>        <span class="token comment">"Open a System Browser in the upper-left."</span><br>        browser <span class="token operator">:=</span> Browser open<span class="token punctuation">.</span><br>        browser<br>            <span class="token comment">"morphPosition: 0 @ 0;<br>            morphExtent: extent."</span><br>            morphPosition<span class="token punctuation">:</span> extent x <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">@</span> <span class="token number">0</span><span class="token punctuation">;</span><br>            morphExtent<span class="token punctuation">:</span> extent x <span class="token operator">@</span> area extent y<span class="token punctuation">.</span><br><br>        <span class="token comment">"Open an Installed Packages window lower-left."</span><br>        cplw <span class="token operator">:=</span> CodePackageListWindow open<span class="token punctuation">:</span> CodePackageList <span class="token keyword">new</span><span class="token punctuation">.</span><br>        cplw morphPosition<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token operator">@</span> extent y<span class="token punctuation">;</span> morphExtent<span class="token punctuation">:</span> extent<span class="token punctuation">.</span><br><br>        <span class="token comment">"Open a Workspace in the upper-right."</span><br>        workspace <span class="token operator">:=</span> Workspace open<span class="token punctuation">.</span><br>        workspace<br>            morphPosition<span class="token punctuation">:</span> extent x <span class="token operator">@</span> <span class="token number">0</span><span class="token punctuation">;</span><br>            morphExtent<span class="token punctuation">:</span> extent<span class="token punctuation">.</span><br>        workspace model actualContents<span class="token punctuation">:</span> <span class="token string">'1 + 2.<br>''testing'' print.'</span><span class="token punctuation">.</span><br><br>        <span class="token comment">"Open a Transcript in the lower-right."</span><br>        TranscriptWindow openTranscript<br>            morphPosition<span class="token punctuation">:</span> extent<span class="token punctuation">;</span><br>            morphExtent<span class="token punctuation">:</span> extent<span class="token punctuation">.</span><br><br>        Feature require<span class="token punctuation">:</span> <span class="token string">'JSON'</span><span class="token punctuation">.</span><br>        Feature require<span class="token punctuation">:</span> <span class="token string">'UI-MetaProperties'</span><span class="token punctuation">.</span><br>        Feature require<span class="token punctuation">:</span> <span class="token string">'WebClient'</span><span class="token punctuation">.</span><br>        <span class="token comment">"Load my package which defines the Object method logAs: and much more."</span><br>        Feature require<span class="token punctuation">:</span> <span class="token string">'Volkmann'</span><span class="token punctuation">.</span><br><br>        <span class="token comment">"browser activateWindow."</span> <span class="token comment">"brings to front"</span><br><br>        <span class="token comment">"Add buttons in upper-left to toggle full screen mode."</span><br>        <span class="token comment">"WHY DOES THIS FAIL IN SCRIPT, BUT NOT FROM WORKSPACE?"</span><br>        <span class="token comment">"(Delay forSeconds: 1) wait.<br>        VFullScreenButtons new."</span><br>    <span class="token punctuation">]</span><br><span class="token punctuation">]</span> fork</code></pre><p>To use this script:</p><ul><li>Set the environment variable <code>SMALLTALK_DIR</code> to the directory path where Cuis Smalltalk was installed.</li><li>Make a copy of the base image file that has a name like <code>Cuis7.1-6541.image</code> and name the copy <code>base-copy.image</code>.</li><li>Make a copy of the base changes file that has a name like <code>Cuis7.1-6541.changes</code> and name the copy <code>base-copy.changes</code>.</li><li>Create the file <code>setup.st</code> (described later) in the same directory as this script.</li><li>Open a terminal window.</li><li><code>cd</code> to the directory containing this script.</li><li>Enter <code>./cuis</code> to launch the VM in your preferred starting state.</li></ul><h2 id="package-example" tabindex="-1">Package Example</h2><p>I created the package <a href="https://github.com/mvolkmann/Cuis-Smalltalk-RMVSetup" target="_blank">Cuis-Smalltalk-RMVSetup</a> which configures an image according to my preferences.</p><p>This adds the class <code>RMVSetup</code> in the class category <code>RMVSetup</code>. The class has the class method <code>initialize</code>, the class method <code>openWindows</code>, and no instance methods.</p><p>To apply this to an image, open a Workspace and enter <code>Feature require: #RMVSetup</code>.</p><p>This runs the <code>initialize</code> method which calls the <code>openWindows</code> method. The code for each of these methods is show below. You may wish to create a similar repository containing this code and customize it according to your preferences.</p><pre class="language-smalltalk"><code class="language-smalltalk">initialize<br>    <span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">filePath</span> <span class="token variable">stream</span> <span class="token punctuation">|</span></span><br><br>    <span class="token comment">"Set preferences."</span><br>    Utilities setAuthorName<span class="token punctuation">:</span> <span class="token string">'R. Mark Volkmann'</span> initials<span class="token punctuation">:</span> <span class="token string">'rmv'</span><span class="token punctuation">.</span><br>    Preferences name<span class="token punctuation">:</span> <span class="token symbol">#showAssignmentAsLeftArrow</span> category<span class="token punctuation">:</span> <span class="token symbol">#programming</span> value<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">.</span><br>    Preferences saveToDisk<span class="token punctuation">:</span> <span class="token symbol">#showAssignmentAsLeftArrow</span><span class="token punctuation">.</span><br>    WindowManager openAtCursor<span class="token punctuation">.</span><br><br>    <span class="token comment">"Add World background image."</span><br>    Preferences at<span class="token punctuation">:</span> <span class="token symbol">#backgroundEffect</span> put<span class="token punctuation">:</span> <span class="token symbol">#tile</span><span class="token punctuation">.</span><br>    filePath <span class="token operator">:=</span> <span class="token string">'../Cuis-Smalltalk-RMVSetup/altitude1600.jpg'</span><span class="token punctuation">.</span><br>    stream <span class="token operator">:=</span> filePath asFileEntry readStream<span class="token punctuation">.</span><br>    <span class="token keyword">self</span> runningWorld backgroundImageData<span class="token punctuation">:</span> stream binary contentsOfEntireFile<span class="token punctuation">.</span><br><br>    <span class="token keyword">self</span> openWindows<span class="token punctuation">.</span></code></pre><pre class="language-smalltalk"><code class="language-smalltalk">openWindows<br>    <span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">browser1</span> <span class="token variable">browser2</span> <span class="token variable">browserWidth</span> <span class="token variable">browserX</span> <span class="token variable">cpl</span> <span class="token variable">cplHeight</span> <span class="token variable">filled</span> <span class="token variable">height</span> <span class="token variable">taskbarHeight</span> <span class="token variable">transcript</span> <span class="token variable">transcriptHeight</span> <span class="token variable">workspace</span> <span class="token variable">world</span> <span class="token variable">worldHeight</span> <span class="token variable">worldWidth</span> <span class="token variable">x</span> <span class="token punctuation">|</span></span><br><br>    <span class="token comment">"Get sizes that will be used to position and size some window."</span><br>    world <span class="token operator">:=</span> UISupervisor ui<span class="token punctuation">.</span><br>    worldWidth <span class="token operator">:=</span> world morphExtent x<span class="token punctuation">.</span><br>    worldHeight <span class="token operator">:=</span> world morphExtent y<span class="token punctuation">.</span><br>    taskbarHeight <span class="token operator">:=</span> world taskbar morphExtent y<span class="token punctuation">.</span><br><br>    <span class="token comment">"Open, position, and size a System Browser."</span><br>    browser1 <span class="token operator">:=</span> Smalltalk browse<span class="token punctuation">.</span><br>    browserWidth <span class="token operator">:=</span> browser1 morphExtent x<span class="token punctuation">.</span><br>    browserX <span class="token operator">:=</span> <span class="token punctuation">(</span>worldWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>browserWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><br>    browser1 morphPosition<span class="token punctuation">:</span> browserX <span class="token operator">@</span> <span class="token number">0</span><span class="token punctuation">.</span><br>    browser1 morphExtent<span class="token punctuation">:</span> browserWidth <span class="token operator">@</span> worldHeight<span class="token punctuation">.</span><br><br>    <span class="token comment">"Open, position, and size a Workspace."</span><br>    workspace <span class="token operator">:=</span> Workspace open<span class="token punctuation">.</span><br>    workspace morphExtent<span class="token punctuation">:</span> browserWidth <span class="token operator">@</span> <span class="token punctuation">(</span>worldHeight <span class="token operator">*</span> <span class="token number">0.7</span><span class="token punctuation">)</span><span class="token punctuation">.</span><br>    x <span class="token operator">:=</span> browserX <span class="token operator">+</span> browserWidth<span class="token punctuation">.</span><br>    filled <span class="token operator">:=</span> x <span class="token operator">+</span> browserWidth <span class="token operator">></span> worldWidth<span class="token punctuation">.</span><br>    filled ifTrue<span class="token punctuation">:</span> <span class="token punctuation">[</span> x <span class="token operator">:=</span> worldWidth <span class="token operator">-</span> browserWidth <span class="token punctuation">]</span><span class="token punctuation">.</span><br>    x <span class="token operator">+</span> browserWidth <span class="token operator">></span> worldWidth ifTrue<span class="token punctuation">:</span> <span class="token punctuation">[</span> x <span class="token operator">:=</span> worldWidth <span class="token operator">-</span> browserWidth <span class="token punctuation">]</span><span class="token punctuation">.</span><br>    workspace morphPosition<span class="token punctuation">:</span> x <span class="token operator">@</span> <span class="token number">0</span><span class="token punctuation">.</span><br><br>    <span class="token comment">"Open, position, and size a Transcript."</span><br>    transcript <span class="token operator">:=</span> Transcript open<span class="token punctuation">.</span><br>    transcriptHeight <span class="token operator">:=</span> worldHeight <span class="token operator">*</span> <span class="token number">0.3</span><span class="token punctuation">.</span><br>    transcript morphExtent<span class="token punctuation">:</span> browserWidth <span class="token operator">@</span> transcriptHeight<span class="token punctuation">.</span><br>    transcript morphPosition<span class="token punctuation">:</span> x <span class="token operator">@</span> <span class="token punctuation">(</span>worldHeight <span class="token operator">-</span> transcriptHeight<span class="token punctuation">)</span><span class="token punctuation">.</span><br>    Transcript clearAll<span class="token punctuation">.</span><br><br>    <span class="token comment">"Open, position, and size another System Browser."</span><br>    browser2 <span class="token operator">:=</span> Smalltalk browse<span class="token punctuation">.</span><br>    <span class="token comment">"Making the x position no less than 30 leaves a vertical strip of the World visible<br>    so that can be clicked to open the World menu."</span><br>    browser2 morphPosition<span class="token punctuation">:</span> <span class="token punctuation">(</span>browserX <span class="token operator">-</span> browserWidth max<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">@</span> <span class="token number">0</span><span class="token punctuation">.</span><br>    height <span class="token operator">:=</span> filled ifTrue<span class="token punctuation">:</span> <span class="token punctuation">[</span> worldHeight <span class="token operator">-</span> taskbarHeight <span class="token punctuation">]</span> ifFalse<span class="token punctuation">:</span> worldHeight<span class="token punctuation">.</span><br>    browser2 morphExtent<span class="token punctuation">:</span> browserWidth <span class="token operator">@</span> height<span class="token punctuation">.</span><br><br>    <span class="token comment">"Open, position, and size an Installed Packages window."</span><br>    cpl <span class="token operator">:=</span> CodePackageList open<span class="token punctuation">.</span><br>    cplHeight <span class="token operator">:=</span> cpl morphExtent y<span class="token punctuation">.</span><br>    cpl morphPosition<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token operator">@</span> <span class="token punctuation">(</span>worldHeight <span class="token operator">-</span> cplHeight <span class="token operator">-</span> taskbarHeight<span class="token punctuation">)</span><span class="token punctuation">.</span><br><br>    browser1 activateWindow<span class="token punctuation">.</span></code></pre></article>