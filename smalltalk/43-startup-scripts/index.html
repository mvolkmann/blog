<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Startup Scripts</h2><aside></aside><article><p>Startup scripts automate starting an image with:</p><ul><li>preferred settings</li><li>tool windows open at specfied locations with specified sizes</li><li>loaded packages</li></ul><p>The following is an example script in a file named <code>cuis</code>.</p><pre class="language-bash"><code class="language-bash"><span class="token shebang important">#!/usr/bin/env zsh</span><br><span class="token assign-left variable">CUIS_DIR</span><span class="token operator">=</span><span class="token variable">$SMALLTALK_DIR</span>/Cuis-Smalltalk-Dev<br><span class="token assign-left variable">VM</span><span class="token operator">=</span><span class="token variable">$CUIS_DIR</span>/CuisVM.app/Contents/MacOS/Squeak<br><span class="token assign-left variable">IMAGE</span><span class="token operator">=</span><span class="token variable">$CUIS_DIR</span>/CuisImage/base-copy.image<br><span class="token variable">$VM</span> <span class="token variable">$IMAGE</span> <span class="token parameter variable">-s</span> env-setup.st</code></pre><p>The following is an example of what can appear in the file <code>env-setup.st</code> which contains Smalltalk code:</p><pre class="language-smalltalk"><code class="language-smalltalk"><span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">world</span> <span class="token punctuation">|</span></span><br>Utilities setAuthorName<span class="token punctuation">:</span> <span class="token string">'R. Mark Volkmann'</span> initials<span class="token punctuation">:</span> <span class="token string">'rmv'</span><span class="token punctuation">.</span><br>world <span class="token operator">:=</span> UISupervisor ui<span class="token punctuation">.</span><br><span class="token punctuation">[</span><br>    Display fullScreenMode<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">.</span><br>    <span class="token punctuation">(</span>Delay forSeconds<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span> wait<span class="token punctuation">.</span><br>    UISupervisor whenUIinSafeState<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>        <span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">area</span> <span class="token variable">browser</span> <span class="token variable">children</span> <span class="token variable">extent</span> <span class="token variable">taskbarHeight</span> <span class="token variable">workspace</span> <span class="token punctuation">|</span></span><br><br>        <span class="token comment">"Delete all submorphs of the WorldMorph except the taskbar."</span><br>        children <span class="token operator">:=</span> world submorphs reject<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token block-arguments"><span class="token variable">:aMorph</span> <span class="token punctuation">|</span></span> aMorph is<span class="token punctuation">:</span> <span class="token symbol">#TaskbarMorph</span><span class="token punctuation">]</span><span class="token punctuation">.</span><br>        children do<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token block-arguments"><span class="token variable">:child</span> <span class="token punctuation">|</span></span> child delete<span class="token punctuation">]</span><span class="token punctuation">.</span><br><br>        <span class="token comment">"Set some preferences."</span><br>        <span class="token comment">"Preferences at: #defaultFontSize put: 14."</span><br>        Preferences at<span class="token punctuation">:</span> <span class="token symbol">#defaultFontSize</span> put<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">.</span><br><br>        <span class="token comment">"Get the usable area not including the taskbar."</span><br>        taskbarHeight <span class="token operator">:=</span> UISupervisor ui taskbar morphHeight<span class="token punctuation">.</span><br>        area <span class="token operator">:=</span> RealEstateAgent maximumUsableArea<br>            extendBy<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token operator">@</span> taskbarHeight negated<span class="token punctuation">.</span><br>        extent <span class="token operator">:=</span> area extent <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">.</span> <span class="token comment">"quarter of world"</span><br><br>        <span class="token comment">"Open a System Browser in the upper-left."</span><br>        browser <span class="token operator">:=</span> Browser open<span class="token punctuation">.</span><br>        browser<br>            <span class="token comment">"morphPosition: 0 @ 0;<br>            morphExtent: extent."</span><br>            morphPosition<span class="token punctuation">:</span> extent x <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">@</span> <span class="token number">0</span><span class="token punctuation">;</span><br>            morphExtent<span class="token punctuation">:</span> extent x <span class="token operator">@</span> area extent y<span class="token punctuation">.</span><br><br>        <span class="token comment">"Open an Installed Packages window lower-left."</span><br>        cplw <span class="token operator">:=</span> CodePackageListWindow open<span class="token punctuation">:</span> CodePackageList <span class="token keyword">new</span><span class="token punctuation">.</span><br>        cplw morphPosition<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token operator">@</span> extent y<span class="token punctuation">;</span> morphExtent<span class="token punctuation">:</span> extent<span class="token punctuation">.</span><br><br>        <span class="token comment">"Open a Workspace in the upper-right."</span><br>        workspace <span class="token operator">:=</span> Workspace open<span class="token punctuation">.</span><br>        workspace<br>            morphPosition<span class="token punctuation">:</span> extent x <span class="token operator">@</span> <span class="token number">0</span><span class="token punctuation">;</span><br>            morphExtent<span class="token punctuation">:</span> extent<span class="token punctuation">.</span><br>        workspace model actualContents<span class="token punctuation">:</span> <span class="token string">'1 + 2.<br>''testing'' print.'</span><span class="token punctuation">.</span><br><br>        <span class="token comment">"Open a Transcript in the lower-right."</span><br>        TranscriptWindow openTranscript<br>            morphPosition<span class="token punctuation">:</span> extent<span class="token punctuation">;</span><br>            morphExtent<span class="token punctuation">:</span> extent<span class="token punctuation">.</span><br><br>        Feature require<span class="token punctuation">:</span> <span class="token string">'JSON'</span><span class="token punctuation">.</span><br>        Feature require<span class="token punctuation">:</span> <span class="token string">'UI-MetaProperties'</span><span class="token punctuation">.</span><br>        Feature require<span class="token punctuation">:</span> <span class="token string">'WebClient'</span><span class="token punctuation">.</span><br>        <span class="token comment">"Load my package which defines the Object method logAs: and much more."</span><br>        Feature require<span class="token punctuation">:</span> <span class="token string">'Volkmann'</span><span class="token punctuation">.</span><br><br>        <span class="token comment">"browser activateWindow."</span> <span class="token comment">"brings to front"</span><br><br>        <span class="token comment">"Add buttons in upper-left to toggle full screen mode."</span><br>        <span class="token comment">"WHY DOES THIS FAIL IN SCRIPT, BUT NOT FROM WORKSPACE?"</span><br>        <span class="token comment">"(Delay forSeconds: 1) wait.<br>        VFullScreenButtons new."</span><br>    <span class="token punctuation">]</span><br><span class="token punctuation">]</span> fork</code></pre><p>To use this script:</p><ul><li>Set the environment variable <code>SMALLTALK_DIR</code> to the directory path where Cuis Smalltalk was installed.</li><li>Make a copy of the base image file that has a name like <code>Cuis7.1-6541.image</code> and name the copy <code>base-copy.image</code>.</li><li>Make a copy of the base changes file that has a name like <code>Cuis7.1-6541.changes</code> and name the copy <code>base-copy.changes</code>.</li><li>Create the file <code>env-setup.st</code> (described later) in the same directory as this script.</li><li>Open a terminal window.</li><li><code>cd</code> to the directory containing this script.</li><li>Enter <code>./cuis</code> to launch the VM in your preferred starting state.</li></ul></article>