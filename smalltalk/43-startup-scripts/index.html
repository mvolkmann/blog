<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Startup Scripts</h2><aside><nav class="toc"><ol><li><a href="#when-to-use">When To Use</a></li><li><a href="#startup-script-example">Startup Script Example</a></li><li><a href="#package-example">Package Example</a></li></ol></nav></aside><article><p>It is helpful to have a way to configure an image with.</p><ul><li>specific preferences set settings</li><li>tool windows open at specified locations with specified sizes</li><li>desired packages loaded</li></ul><p>There is more than one way to accomplish this. One way is to write and use a startup script. Another way is to create and load a package.</p><h2 id="when-to-use" tabindex="-1">When To Use</h2><p>The ability to easily configure a new image is useful when new versions of Cuis Smalltalk are released or just to create an image for a specific project. A new base image can be opened and configured. Once this is done, open the World menu and select &quot;Save Image as...&quot; to save the image under a new name.</p><p>Starting future sessions using the saved image will be much faster than starting the base image using a startup script. The reason is that the saved image will already contain all the packages installed by the startup script. Loading packages during startup is relative time consuming.</p><h2 id="startup-script-example" tabindex="-1">Startup Script Example</h2><p>The following is an example script in a file named <code>cuis</code>.</p><pre class="language-bash"><code class="language-bash"><span class="token shebang important">#!/usr/bin/env zsh</span><br><span class="token assign-left variable">CUIS_DIR</span><span class="token operator">=</span><span class="token variable">$SMALLTALK_DIR</span>/Cuis-Smalltalk-Dev<br><span class="token assign-left variable">VM</span><span class="token operator">=</span><span class="token variable">$CUIS_DIR</span>/CuisVM.app/Contents/MacOS/Squeak<br><span class="token assign-left variable">IMAGE</span><span class="token operator">=</span><span class="token variable">$CUIS_DIR</span>/CuisImage/base-copy.image<br><span class="token variable">$VM</span> <span class="token variable">$IMAGE</span> <span class="token parameter variable">-s</span> setup.st</code></pre><p>To run headless, change the last line to the following:</p><pre class="language-bash"><code class="language-bash"><span class="token variable">$VM</span> <span class="token parameter variable">-headless</span> <span class="token variable">$IMAGE</span> <span class="token parameter variable">-s</span> setup.st</code></pre><p>The following is an example of what can appear in the file <code>setup.st</code> which contains Smalltalk code:</p><pre class="language-smalltalk"><code class="language-smalltalk"><span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">world</span> <span class="token punctuation">|</span></span><br>Utilities setAuthorName<span class="token punctuation">:</span> <span class="token string">'R. Mark Volkmann'</span> initials<span class="token punctuation">:</span> <span class="token string">'rmv'</span><span class="token punctuation">.</span><br>world <span class="token operator">:=</span> UISupervisor ui<span class="token punctuation">.</span><br><span class="token punctuation">[</span><br>    Display fullScreenMode<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">.</span><br>    <span class="token punctuation">(</span>Delay forSeconds<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span> wait<span class="token punctuation">.</span><br>    UISupervisor whenUIinSafeState<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>        <span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">area</span> <span class="token variable">browser</span> <span class="token variable">children</span> <span class="token variable">extent</span> <span class="token variable">taskbarHeight</span> <span class="token variable">workspace</span> <span class="token punctuation">|</span></span><br><br>        <span class="token comment">"Delete all submorphs of the WorldMorph except the taskbar."</span><br>        children <span class="token operator">:=</span> world submorphs reject<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token block-arguments"><span class="token variable">:aMorph</span> <span class="token punctuation">|</span></span> aMorph is<span class="token punctuation">:</span> <span class="token symbol">#TaskbarMorph</span><span class="token punctuation">]</span><span class="token punctuation">.</span><br>        children do<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token block-arguments"><span class="token variable">:child</span> <span class="token punctuation">|</span></span> child delete<span class="token punctuation">]</span><span class="token punctuation">.</span><br><br>        <span class="token comment">"Set some preferences."</span><br>        <span class="token comment">"Preferences at: #defaultFontSize put: 14."</span><br>        Preferences at<span class="token punctuation">:</span> <span class="token symbol">#defaultFontSize</span> put<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">.</span><br><br>        <span class="token comment">"Get the usable area not including the taskbar."</span><br>        taskbarHeight <span class="token operator">:=</span> UISupervisor ui taskbar morphHeight<span class="token punctuation">.</span><br>        area <span class="token operator">:=</span> RealEstateAgent maximumUsableArea<br>            extendBy<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token operator">@</span> taskbarHeight negated<span class="token punctuation">.</span><br>        extent <span class="token operator">:=</span> area extent <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">.</span> <span class="token comment">"quarter of world"</span><br><br>        <span class="token comment">"Open a System Browser in the upper-left."</span><br>        browser <span class="token operator">:=</span> Browser open<span class="token punctuation">.</span><br>        browser<br>            <span class="token comment">"morphPosition: 0 @ 0;<br>            morphExtent: extent."</span><br>            morphPosition<span class="token punctuation">:</span> extent x <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">@</span> <span class="token number">0</span><span class="token punctuation">;</span><br>            morphExtent<span class="token punctuation">:</span> extent x <span class="token operator">@</span> area extent y<span class="token punctuation">.</span><br><br>        <span class="token comment">"Open an Installed Packages window lower-left."</span><br>        cplw <span class="token operator">:=</span> CodePackageListWindow open<span class="token punctuation">:</span> CodePackageList <span class="token keyword">new</span><span class="token punctuation">.</span><br>        cplw morphPosition<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token operator">@</span> extent y<span class="token punctuation">;</span> morphExtent<span class="token punctuation">:</span> extent<span class="token punctuation">.</span><br><br>        <span class="token comment">"Open a Workspace in the upper-right."</span><br>        workspace <span class="token operator">:=</span> Workspace open<span class="token punctuation">.</span><br>        workspace<br>            morphPosition<span class="token punctuation">:</span> extent x <span class="token operator">@</span> <span class="token number">0</span><span class="token punctuation">;</span><br>            morphExtent<span class="token punctuation">:</span> extent<span class="token punctuation">.</span><br>        workspace model actualContents<span class="token punctuation">:</span> <span class="token string">'1 + 2.<br>''testing'' print.'</span><span class="token punctuation">.</span><br><br>        <span class="token comment">"Open a Transcript in the lower-right."</span><br>        TranscriptWindow openTranscript<br>            morphPosition<span class="token punctuation">:</span> extent<span class="token punctuation">;</span><br>            morphExtent<span class="token punctuation">:</span> extent<span class="token punctuation">.</span><br><br>        Feature require<span class="token punctuation">:</span> <span class="token string">'JSON'</span><span class="token punctuation">.</span><br>        Feature require<span class="token punctuation">:</span> <span class="token string">'UI-MetaProperties'</span><span class="token punctuation">.</span><br>        Feature require<span class="token punctuation">:</span> <span class="token string">'WebClient'</span><span class="token punctuation">.</span><br>        <span class="token comment">"Load my package which defines the Object method logAs: and much more."</span><br>        Feature require<span class="token punctuation">:</span> <span class="token string">'Volkmann'</span><span class="token punctuation">.</span><br><br>        <span class="token comment">"browser activateWindow."</span> <span class="token comment">"brings to front"</span><br><br>        <span class="token comment">"Add buttons in upper-left to toggle full screen mode."</span><br>        <span class="token comment">"WHY DOES THIS FAIL IN SCRIPT, BUT NOT FROM WORKSPACE?"</span><br>        <span class="token comment">"(Delay forSeconds: 1) wait.<br>        VFullScreenButtons new."</span><br>    <span class="token punctuation">]</span><br><span class="token punctuation">]</span> fork</code></pre><p>To use this script:</p><ul><li>Set the environment variable <code>SMALLTALK_DIR</code> to the directory path where Cuis Smalltalk was installed.</li><li>Make a copy of the base image file that has a name like <code>Cuis7.1-6541.image</code> and name the copy <code>base-copy.image</code>.</li><li>Make a copy of the base changes file that has a name like <code>Cuis7.1-6541.changes</code> and name the copy <code>base-copy.changes</code>.</li><li>Create the file <code>setup.st</code> (described later) in the same directory as this script.</li><li>Open a terminal window.</li><li><code>cd</code> to the directory containing this script.</li><li>Enter <code>./cuis</code> to launch the VM in your preferred starting state.</li></ul><h2 id="package-example" tabindex="-1">Package Example</h2><p>I created the package <a href="https://github.com/mvolkmann/Cuis-Smalltalk-RMVSetup" target="_blank">Cuis-Smalltalk-RMVSetup</a> which defines the class <code>RMVSetup</code> in the class category <code>RMVSetup</code>. which configures an image according to my preferences.</p><p>To install this package, clone the repository, open a Workspace, enter <code>Feature require: #RMVSetup</code>, and &quot;Do it&quot;. This results in the following window:</p><p><img alt="Cuis-Smalltalk-RMVSetup" style="width: 100%" src="/blog/assets/cuis-smalltalk-rmvsetup.png?v=1.1.1"></p><p>Installing the package runs the class method <code>initialize</code> which calls the class method <code>openWindows</code>. The code for each of these methods is shown below. You may wish to create a similar package containing this code and customize it according to your preferences.</p><pre class="language-smalltalk"><code class="language-smalltalk">initialize<br>    <span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">filePath</span> <span class="token variable">stream</span> <span class="token punctuation">|</span></span><br><br>    <span class="token comment">"Set preferences."</span><br>    Utilities setAuthorName<span class="token punctuation">:</span> <span class="token string">'R. Mark Volkmann'</span> initials<span class="token punctuation">:</span> <span class="token string">'rmv'</span><span class="token punctuation">.</span><br>    Preferences name<span class="token punctuation">:</span> <span class="token symbol">#showAssignmentAsLeftArrow</span> category<span class="token punctuation">:</span> <span class="token symbol">#programming</span> value<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">.</span><br>    Preferences saveToDisk<span class="token punctuation">:</span> <span class="token symbol">#showAssignmentAsLeftArrow</span><span class="token punctuation">.</span><br>    WindowManager openAtCursor<span class="token punctuation">.</span><br><br>    <span class="token comment">"Add World background image."</span><br>    Preferences at<span class="token punctuation">:</span> <span class="token symbol">#backgroundEffect</span> put<span class="token punctuation">:</span> <span class="token symbol">#tile</span><span class="token punctuation">.</span><br>    filePath <span class="token operator">:=</span> <span class="token string">'../Cuis-Smalltalk-RMVSetup/altitude1600.jpg'</span><span class="token punctuation">.</span><br>    stream <span class="token operator">:=</span> filePath asFileEntry readStream<span class="token punctuation">.</span><br>    <span class="token keyword">self</span> runningWorld backgroundImageData<span class="token punctuation">:</span> stream binary contentsOfEntireFile<span class="token punctuation">.</span><br><br>    <span class="token keyword">self</span> openWindows<span class="token punctuation">.</span></code></pre><pre class="language-smalltalk"><code class="language-smalltalk">openWindows<br>    <span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">browser</span> <span class="token punctuation">|</span></span><br><br>    browser <span class="token operator">:=</span> Browser open<br>        moveTo<span class="token punctuation">:</span> <span class="token symbol">#worldCenter</span><span class="token punctuation">;</span><br>        moveTo<span class="token punctuation">:</span> <span class="token symbol">#worldTop</span><span class="token punctuation">;</span><br>        fullHeight<span class="token punctuation">.</span><br><br>    Browser open<br>        moveLeftOf<span class="token punctuation">:</span> browser<span class="token punctuation">;</span><br>        moveTo<span class="token punctuation">:</span> <span class="token symbol">#worldTop</span><span class="token punctuation">;</span><br>        fullHeightMinusTaskbar<span class="token punctuation">.</span><br><br>    Workspace open<br>        percentHeight<span class="token punctuation">:</span> <span class="token number">0.7</span><span class="token punctuation">;</span><br>        moveRightOf<span class="token punctuation">:</span> browser<span class="token punctuation">;</span><br>        moveTo<span class="token punctuation">:</span> <span class="token symbol">#worldTop</span><span class="token punctuation">.</span><br><br>    Transcript open<br>        percentHeight<span class="token punctuation">:</span> <span class="token number">0.3</span><span class="token punctuation">;</span><br>        moveRightOf<span class="token punctuation">:</span> browser<span class="token punctuation">;</span><br>        moveTo<span class="token punctuation">:</span> <span class="token symbol">#worldBottom</span><span class="token punctuation">.</span><br>    Transcript clearAll<span class="token punctuation">.</span><br><br>    MessageNames open<br>        moveTo<span class="token punctuation">:</span> <span class="token symbol">#worldRight</span><span class="token punctuation">;</span><br>        moveTo<span class="token punctuation">:</span> <span class="token symbol">#worldTop</span><span class="token punctuation">.</span><br><br>    CodePackageList open<br>        moveTo<span class="token punctuation">:</span> <span class="token symbol">#worldLeft</span><span class="token punctuation">;</span><br>        moveTo<span class="token punctuation">:</span> <span class="token symbol">#taskbarTop</span><span class="token punctuation">.</span><br><br>    browser activateWindow<span class="token punctuation">.</span></code></pre><p>The following instance methods <code>moveTo:</code>, <code>moveLeftOf:</code>, <code>moveRightOf:</code>, <code>fullHeight</code>, <code>fullHeightMinusTaskbar</code>, and <code>percentHeight</code> were added to the <code>SystemWindow</code> class by the <code>Cuis-Smalltalk-RMVSetup</code> package.</p><pre class="language-smalltalk"><code class="language-smalltalk">fullHeight<br>    <span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">world</span> <span class="token punctuation">|</span></span><br><br>    world <span class="token operator">:=</span> UISupervisor ui<span class="token punctuation">.</span><br>    <span class="token keyword">self</span> morphExtent<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">self</span> morphExtent x<span class="token punctuation">)</span> <span class="token operator">@</span> <span class="token punctuation">(</span>world morphExtent y<span class="token punctuation">)</span><span class="token punctuation">.</span><br><br>fullHeightMinusTaskbar<br>    <span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">taskbarHeight</span> <span class="token variable">world</span> <span class="token punctuation">|</span></span><br><br>    world <span class="token operator">:=</span> UISupervisor ui<span class="token punctuation">.</span><br>    taskbarHeight <span class="token operator">:=</span> world taskbar morphExtent y<span class="token punctuation">.</span><br>    <span class="token keyword">self</span> morphExtent<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">self</span> morphExtent x<span class="token punctuation">)</span> <span class="token operator">@</span> <span class="token punctuation">(</span>world morphExtent y <span class="token operator">-</span> taskbarHeight<span class="token punctuation">)</span><span class="token punctuation">.</span><br><br>moveLeftOf<span class="token punctuation">:</span> aWindow<br>    <span class="token comment">"Move this window to the left of aWindow and guarantee<br>    that it will not extend past the left edge of the World."</span><br>    <span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">newX</span> <span class="token variable">newY</span> <span class="token variable">position</span> <span class="token punctuation">|</span></span><br><br>    position <span class="token operator">:=</span> aWindow morphPosition<span class="token punctuation">.</span><br>    newX <span class="token operator">:=</span> position x <span class="token operator">-</span> extent x max<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">.</span><br>    newY <span class="token operator">:=</span> position y<span class="token punctuation">.</span><br>    <span class="token keyword">self</span> morphPosition<span class="token punctuation">:</span> newX <span class="token operator">@</span> newY<span class="token punctuation">.</span><br><br>moveRightOf<span class="token punctuation">:</span> aWindow<br>    <span class="token comment">"Move this window to the right of aWindow and guarantee<br>    that it will not extend past the right edge of the World."</span><br>    <span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">newX</span> <span class="token variable">newY</span> <span class="token variable">position</span> <span class="token variable">world</span> <span class="token variable">worldWidth</span> <span class="token punctuation">|</span></span><br><br>    world <span class="token operator">:=</span> UISupervisor ui<span class="token punctuation">.</span><br>    worldWidth <span class="token operator">:=</span> world morphExtent x<span class="token punctuation">.</span><br>    position <span class="token operator">:=</span> aWindow morphPosition<span class="token punctuation">.</span><br>    newX <span class="token operator">:=</span> position x <span class="token operator">+</span> aWindow morphExtent x min<span class="token punctuation">:</span> <span class="token punctuation">(</span>worldWidth <span class="token operator">-</span> extent x<span class="token punctuation">)</span><span class="token punctuation">.</span><br>    newY <span class="token operator">:=</span> position y<span class="token punctuation">.</span><br>    <span class="token keyword">self</span> morphPosition<span class="token punctuation">:</span> newX <span class="token operator">@</span> newY<span class="token punctuation">.</span><br><br>moveRightOf<span class="token punctuation">:</span> aWindow<br>    <span class="token comment">"Move this window to the right of aWindow and guarantee<br>    that it will not extend past the right edge of the World."</span><br>    <span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">newX</span> <span class="token variable">newY</span> <span class="token variable">position</span> <span class="token variable">world</span> <span class="token variable">worldWidth</span> <span class="token punctuation">|</span></span><br><br>    world <span class="token operator">:=</span> UISupervisor ui<span class="token punctuation">.</span><br>    worldWidth <span class="token operator">:=</span> world morphExtent x<span class="token punctuation">.</span><br>    position <span class="token operator">:=</span> aWindow morphPosition<span class="token punctuation">.</span><br>    newX <span class="token operator">:=</span> position x <span class="token operator">+</span> aWindow morphExtent x min<span class="token punctuation">:</span> <span class="token punctuation">(</span>worldWidth <span class="token operator">-</span> extent x<span class="token punctuation">)</span><span class="token punctuation">.</span><br>    newY <span class="token operator">:=</span> position y<span class="token punctuation">.</span><br>    <span class="token keyword">self</span> morphPosition<span class="token punctuation">:</span> newX <span class="token operator">@</span> newY<span class="token punctuation">.</span><br><br>percentHeight<span class="token punctuation">:</span> aNumber<br>    <span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">world</span> <span class="token punctuation">|</span></span><br><br>    aNumber <span class="token operator">&lt;=</span> <span class="token number">0</span> ifTrue<span class="token punctuation">:</span> <span class="token punctuation">[</span> Error signal<span class="token punctuation">:</span> <span class="token string">'aNumber cannot be zero or less.'</span> <span class="token punctuation">]</span><span class="token punctuation">.</span><br>    aNumber <span class="token operator">></span> <span class="token number">1</span> ifTrue<span class="token punctuation">:</span> <span class="token punctuation">[</span> Error signal<span class="token punctuation">:</span> <span class="token string">'aNumber cannot be greater than one.'</span> <span class="token punctuation">]</span><span class="token punctuation">.</span><br><br>    world <span class="token operator">:=</span> UISupervisor ui<span class="token punctuation">.</span><br>    <span class="token keyword">self</span> morphExtent<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">self</span> morphExtent x<span class="token punctuation">)</span> <span class="token operator">@</span> <span class="token punctuation">(</span>world morphExtent y <span class="token operator">*</span> aNumber<span class="token punctuation">)</span><span class="token punctuation">.</span></code></pre></article>