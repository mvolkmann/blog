<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Messages</h2><aside><nav class="toc"><ol><li><a href="#message-cascades">Message Cascades</a></li><li><a href="#tab-completions">Tab Completions</a></li><li><a href="#dynamic-messages">Dynamic Messages</a></li></ol></nav></aside><article><p>The only mechanism for communicating with an object is to send it a message. A message is a combination of a selector (or message name) and arguments. Messages are always sent to a explicit receiver.</p><p>Method lookup begins by searching for the selector in the <code>methodDict</code> of the receiver. If a match is not found there, the search continues upward in each of the superclasses. If a match is found, it is added to a method lookup cache. This removes the need to search the inheritance hierarchy for every message send and significantly improves performance.</p><p>When inside an instance method, to send a message to the current object, use the pseudo-variable <code>self</code> as the receiver. To send a message to the superclass of the current object, use the pseudo-variable <code>super</code> as the receiver. The difference between <code>self</code> and <code>super</code> is where method lookup begins. With <code>self</code> it begins in the class of the current object and with <code>super</code> it begins in the superclass of that.</p><p>If Smalltalk were to add the ability to specify the parameter and return types of methods, it would just be specifying the set of messages to which compatible objects can respond. This is not done, so compatibility is determined at run-time.</p><p>Arguments in messages are always passed by reference, not by value.</p><p>In Smalltalk documentation, selectors are preceded by <code>#</code> to indicate that they are symbols. But the <code>#</code> is not included when actually sending a message.</p><p>A method is code found in a class that responds to a message.</p><p>Smalltalk supports three types of messages:</p><ul><li><p>unary</p><p>These message do not take any arguments. Their names are alphanumeric and begin lowercase. For example, in <code>5 factorial</code>, <code>#factorial</code> is a unary message.</p></li><li><p>binary</p><p>These message take a single argument and have names that use a restricted set of characters that make them look like operators in other programming languages. Binary message names can only contain one or more of the following characters: <code>+ - * / \ ~ &lt; &gt; = @ % | &amp; ? ,</code></p><p>For example, in <code>a * b</code>, <code>#*</code> is a binary message. This sends the message <code>#*</code> to the object <code>a</code>, passing it the argument <code>b</code>.</p><p>The binary message <code>=</code> tests whether two objects are equal, meaning one can be used in place of the other. Each class can define this method to decide how their objects should be compared. If they do not define <code>=</code>, an implementation will be found in the inheritance hierarchy. The <code>Object</code> class defines <code>=</code> to be the same as <code>==</code>.</p><p>The <code>ProtoObject</code> class defines the binary instance methods <code>==</code> and <code>~~</code>. <code>==</code> tests whether two objects are the same objects in memory (identity). <code>~~</code> tests whether two objects are different objects in memory.</p></li><li><p>keyword</p><p>These messages take one or more arguments that are each preceded by a keyword. Each keyword is alphanumeric, begins lowercase, and ends in a colon. For example, <code>#at:put</code> is a keyword message in the <code>OrderedCollection</code> class which is the superclass of the <code>Array</code> class.</p><p>The following code creates an array of colors and then changes the second element from <code>'green'</code> to <code>'yellow'</code>:</p><pre class="language-smalltalk"><code class="language-smalltalk">colors <span class="token operator">:=</span> <span class="token symbol">#</span><span class="token punctuation">(</span><span class="token string">'red'</span> <span class="token string">'green'</span> <span class="token string">'blue'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><br>colors at<span class="token punctuation">:</span> <span class="token number">2</span> put<span class="token punctuation">:</span> <span class="token string">'yellow'</span><span class="token punctuation">.</span></code></pre><p>The parts of a keyword message must be specified in the order in which they appear in the corresponding method definition. It's possible define additional methods that support other orders, but that is not typically done.</p></li></ul><p>When multiple messages of these types are combined in a single expression, the order of evaluation is:</p><ul><li>all unary messages from left to right</li><li>all binary messages from left to right</li><li>all keyword messages from left to right</li></ul><p>For example, in <code>2 raisedTo: 1 + 3 factorial</code>, the order is <code>#factorial</code>, <code>#+</code>, and <code>#raisedTo</code>.</p><p>The evaluation order can be changed by adding parentheses. For example:</p><pre class="language-smalltalk"><code class="language-smalltalk">a <span class="token operator">:=</span> <span class="token number">2</span><span class="token punctuation">.</span><br>b <span class="token operator">:=</span> <span class="token number">3</span><span class="token punctuation">.</span><br>c <span class="token operator">:=</span> <span class="token number">4</span><span class="token punctuation">.</span><br>x <span class="token operator">:=</span> a <span class="token operator">+</span> b <span class="token operator">*</span> c<span class="token punctuation">.</span> <span class="token comment">"20"</span><br>y <span class="token operator">:=</span> a <span class="token operator">+</span> <span class="token punctuation">(</span>b <span class="token operator">*</span> c<span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token comment">"24"</span></code></pre><p>Parentheses are never needed around unary messages since those are always evaluated before binary and keyword messages.</p><p>If a message is sent to an object and no compatible method is found, the following popup will appear:</p><p><img alt="Unknown Selector popup" style="width: 50%" src="/blog/assets/smalltalk-unknown-selector.png?v=1.1.1"></p><p>If the selector was incorrectly typed, any implemented selector can be selected from this popup.</p><p>If the selector is confirmed or if such a message is sent from runnning code, the following Debugger window will appear:</p><p><img alt="Debugger MessageNotUnderstood" src="/blog/assets/smalltalk-message-not-understood.png?v=1.1.1"></p><p>One option is to implement the missing method. To do this:</p><ul><li>Click the &quot;Create&quot; button.</li><li>In the popup that appears, select the class within the inheritance hierarchy where the method will be added.</li><li>In the next popup that appears, select a method category for the new method.</li><li>Initially the method implementation will only contain <code>self shouldBeImplemented</code>.</li><li>Modify the implementation as desired.</li><li>Press cmd-s to save it.</li><li>Optionally click the &quot;Proceed&quot; button to resume execution with calling the new method.</li></ul><h2 id="message-cascades" tabindex="-1">Message Cascades</h2><p>To send multiple messages to the same object, add a semicolon after all but the last message.</p><p>The following code sends multiple messages to the <code>Transcript</code> class:</p><pre class="language-smalltalk"><code class="language-smalltalk">Transcript show<span class="token punctuation">:</span> <span class="token string">'first line'</span><span class="token punctuation">;</span> newLine<span class="token punctuation">;</span> show<span class="token punctuation">:</span> <span class="token string">'second line'</span></code></pre><p>The following code sends the <code>#add:</code> message to an <code>OrderedCollection</code> object three times. Each cascade can be written on a separate line for readability.</p><pre class="language-smalltalk"><code class="language-smalltalk"><span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">fruits</span> <span class="token punctuation">|</span></span><br>fruits <span class="token operator">:=</span> OrderedCollection <span class="token keyword">new</span><span class="token punctuation">.</span><br>fruits<br>    add<span class="token punctuation">:</span> <span class="token string">'apple'</span><span class="token punctuation">;</span><br>    add<span class="token punctuation">:</span> <span class="token string">'banana'</span><span class="token punctuation">;</span><br>    add<span class="token punctuation">:</span> <span class="token string">'cherry'</span><span class="token punctuation">.</span></code></pre><p>The value of a message cascade is the object returned by the last message. If the method invoked by the last message does not return the initial receiver object and you want the cascade to return that, end the cascade with <code>; yourself</code>.</p><p>For example, the last expression above that uses a message cascade to send the message <code>#add:</code> three times. The result is <code>'cherry'</code>. Adding <code>; yourself</code> to the end of that expression changes it to result in the value of <code>fruits</code>.</p><h2 id="tab-completions" tabindex="-1">Tab Completions</h2><p>When entering code to send a message, completion hints are provided if at least the first letter in the message name is typed and the tab key is pressed. For example, entering <code>7 s</code> and pressing the tab key shows possible completions of <code>shallowCopy</code>, <code>sqrt</code>, and more. Use the up and down arrow keys to select a completion and press the return key to accept it.</p><p>To enable completions without typing any characters in the name, enter <code>Preferences at: #spaceTabOpensAutoCompletion put: true</code> in a Workspace and &quot;Do it&quot;. For example, with this preference set, you can enter <code>'test'</code> followed by a space and press the tab key to get completion hints.</p><p>Matching messages found anywhere in the inheritance hierarchy appear in black. If there are no matching messages, it will show all known selectors that match in any class in blue. The reason is that you can send any message to any object. Even if the object has no matching method anywhere in its inheritance hierarchy, it could still respond by handling it in a <code>doesNotUnderstand:</code> method. Personally I do not find this helpful and wish it did not show those messages.</p><h2 id="dynamic-messages" tabindex="-1">Dynamic Messages</h2><p>The <code>#perform:</code> message and its variations can be sent to any class or object to send a message specified by the symbol that follows <code>perform:</code>. This is useful in situations where the message to send must be determined at run-time.</p><p>Another alternative it to use the <code>MessageSend</code> class. The class methods <code>:receiver:selector</code>, <code>:receiver:selector:argument:</code>, and <code>:receiver:selector:arguments:</code> return an object that describes a message send. The object can be passed around and the actual send can be triggered later.</p><p>For example, the following sets of expressions are equivalent:</p><pre class="language-smalltalk"><code class="language-smalltalk"><span class="token comment">"These demostrates sending a unary message. Each gives the result 2."</span><br><span class="token number">4</span> sqrt<span class="token punctuation">.</span><br><span class="token number">4</span> perform<span class="token punctuation">:</span> <span class="token symbol">#sqrt</span><span class="token punctuation">.</span><br><span class="token punctuation">(</span>MessageSend receiver<span class="token punctuation">:</span> <span class="token number">4</span> selector<span class="token punctuation">:</span> <span class="token symbol">#sqrt</span><span class="token punctuation">)</span> value<span class="token punctuation">.</span><br><br><span class="token comment">"These demonstrate sending a binary message. Each gives the result 6."</span><br><span class="token number">2</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">.</span><br><span class="token number">2</span> perform<span class="token punctuation">:</span> <span class="token symbol">#*</span> with<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">.</span><br><span class="token punctuation">(</span>MessageSend receiver<span class="token punctuation">:</span> <span class="token number">2</span> selector<span class="token punctuation">:</span> <span class="token symbol">#*</span> argument<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">)</span> value<span class="token punctuation">.</span><br><br><span class="token comment">"These demonstrate sending a keyword message. Each gives the result 4."</span><br><span class="token string">'foobarbaz'</span> findString<span class="token punctuation">:</span> <span class="token string">'BAR'</span> startingAt<span class="token punctuation">:</span> <span class="token number">1</span> caseSensitive<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">.</span><br><span class="token string">'foobarbaz'</span><br>    perform<span class="token punctuation">:</span> <span class="token symbol">#findString</span><span class="token punctuation">:</span>startingAt<span class="token punctuation">:</span>caseSensitive<span class="token punctuation">:</span><br>    with<span class="token punctuation">:</span> <span class="token string">'BAR'</span> with<span class="token punctuation">:</span> <span class="token number">1</span> with<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">.</span><br><span class="token punctuation">(</span>MessageSend<br>    receiver<span class="token punctuation">:</span> <span class="token string">'foobarbaz'</span><br>    selector<span class="token punctuation">:</span> <span class="token symbol">#findString</span><span class="token punctuation">:</span>startingAt<span class="token punctuation">:</span>caseSensitive<span class="token punctuation">:</span><br>    arguments<span class="token punctuation">:</span> <span class="token symbol">#</span><span class="token punctuation">(</span><span class="token string">'BAR'</span> <span class="token number">1</span> <span class="token boolean">false</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span> value<span class="token punctuation">.</span></code></pre><p>To provide more than three keyword arguments with <code>perform</code>, send the <code>#perform:withArguments</code> message.</p></article>