<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Objects</h2><aside><nav class="toc"><ol><li><a href="#creating-objects">Creating Objects</a></li><li><a href="#immutability">Immutability</a></li></ol></nav></aside><article><p>Code and data are both represented by objects. Code can be described by a method or block, both of which are kinds of objects.</p><p>Objects are created by sending a message to a class. In addition, some kinds of objects, such as numbers, strings, and arrays, can be created from a literal syntax.</p><p>Every class supports the class method <code>new</code>, which creates and returns a new instance of the class. If the class defines the instance method <code>initialize</code>, the <code>new</code> method will call it. The <code>initialize</code> method typically initializes each of the instance variables of the object.</p><p>Classes are also represented by objects. Every class object inherits from <code>Class</code>, which inherits from <code>ClassDescription</code>, which inherits from <code>Behavior</code>. The <code>Behavior</code> class defines the instance method <code>new</code> which contains the following:</p><pre class="language-smalltalk"><code class="language-smalltalk">    <span class="token operator">^</span> <span class="token keyword">self</span> basicNew initialize<span class="token punctuation">.</span></code></pre><p>Every class also supports the method <code>basicNew</code> which is similar to the <code>new</code> method, but does not call the instance method <code>initialize</code>.</p><p>Let's look at an example <code>Rect</code> class with instance variables <code>height</code> and <code>width</code>.</p><p>We can define the class method <code>height:width:</code> that provides an alternate way to create objects as follows:</p><pre class="language-smalltalk"><code class="language-smalltalk">height<span class="token punctuation">:</span> aHeight width<span class="token punctuation">:</span> aWidth<br>    <span class="token operator">^</span><span class="token keyword">self</span> <span class="token keyword">new</span> setHeight<span class="token punctuation">:</span> aHeight width<span class="token punctuation">:</span> aWidth</code></pre><p>We can then define the following instance methods:</p><pre class="language-smalltalk"><code class="language-smalltalk">initialize<br>    <span class="token keyword">super</span> initialize<span class="token punctuation">.</span><br>    height <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">.</span><br>    width <span class="token operator">:=</span> <span class="token number">1</span><br><br>setHeight<span class="token punctuation">:</span> aHeight width<span class="token punctuation">:</span> aWidth<br>    height <span class="token operator">:=</span> aHeight<span class="token punctuation">.</span><br>    width <span class="token operator">:=</span> aWidth<br><br>area<br>    <span class="token operator">^</span>height <span class="token operator">*</span> width</code></pre><p>The <code>setHeight:width:</code> method should be in the &quot;private&quot; category to indicate that it is not meant to invoked from outside this class.</p><p>We can use the <code>Rectangle</code> class as follows:</p><pre class="language-smalltalk"><code class="language-smalltalk">r1 <span class="token operator">:=</span> Rect <span class="token keyword">new</span><span class="token punctuation">.</span><br>Transcript show<span class="token punctuation">:</span> r1 area<span class="token punctuation">.</span> <span class="token comment">"1"</span><br><br>r2 <span class="token operator">:=</span> Rect height<span class="token punctuation">:</span> <span class="token number">2</span> width<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">.</span><br>Transcript show<span class="token punctuation">:</span> r2 area<span class="token punctuation">.</span> <span class="token comment">"6"</span></code></pre><p>To determine the class of an object, send it the <code>#class</code> unary message. For example, <code>19 class</code> returns <code>SmallInteger</code>.</p><p>Variables defined in a Workspace hold references to their object values. It may be necessary to close a Workspace in order to trigger garbage collection of those objects.</p><p>Some classes such as <code>Morph</code> implement a <code>delete</code> method. To delete all instances of such classes, enter the following in Workspace and &quot;Do it&quot;:</p><pre class="language-smalltalk"><code class="language-smalltalk">SomeClass allInstancesDo<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token block-arguments"><span class="token variable">:obj</span> <span class="token punctuation">|</span></span> obj delete <span class="token punctuation">]</span></code></pre><h2 id="creating-objects" tabindex="-1">Creating Objects</h2><p>TODO: This section repeats a lot of information that was covered above!</p><p>New objects can be created by sending the message <code>#new</code> or <code>#basicNew</code> to a class. Those methods are defined in the <code>Behavior</code> class and are available on every object because:</p><ul><li><code>Object</code> is a subclass of <code>ProtoObject</code>.</li><li>The metaclass of <code>ProtoObject</code> is <code>Class</code> (<code>ProtoObject class superclass -&gt; Class</code>).</li><li><code>Class</code> is a subclass of <code>ClassDescription</code>.</li><li><code>ClassDescription</code> is a subclass of <code>Behavior</code>.</li></ul><p>The diagram below shows the classes involved when sending the message <code>#new</code> to a class. <code>Circle</code> is a subclass of <code>Shape</code> which is a subclass of <code>Object</code> which is a subclass of <code>ProtoObject</code>. The asterisks in the diagram are placeholders for the class associated with an arrow. For example, sending the message <code>#superclass</code> to <code>Circle</code> gives <code>Shape</code> and sending the message <code>#class</code> to <code>Circle</code> gives <code>Circle class</code>.</p><p><img alt="Smalltalk class hierarchy:" style="width: 100%" src="/blog/assets/SmalltalkClassHierarchy.png?v=1.1.1"></p><p>Here are some important facts about the diagram above:</p><ul><li>Every class is represented by an object which is an instance of its own metaclass.</li><li>Metaclasses do not have names are referred to as &quot;{class-name} class&quot;. For example, the metaclass of the <code>Circle</code> class is referred to as <code>Circle class</code>.</li><li>There is only one instance of each metaclass.</li><li>The superclass of all metaclasses it <code>Metaclass</code>.</li><li><code>Metaclass</code> is subclass of <code>ClassDescription</code> which is a subclass of <code>Behavior</code> which is a subclass of <code>Object</code>.</li><li>The <code>Behavior</code> class defines the <code>new</code> method and many others including <code>allInstances</code>, <code>allSubclasses</code>, <code>allSuperclasses</code>, <code>instVarNames</code>, and <code>methodDictionary</code>.</li></ul><p>Let's walk through the steps to find the <code>new</code> method when evaluating <code>circle := Circle new</code>.</p><ul><li>Look in <code>Circle class</code>.</li><li>Look in <code>Shape class</code>.</li><li>Look in <code>Object class</code>.</li><li>Look in <code>ProtoObject class</code>.</li><li>Look in <code>Class class</code>.</li><li>Look in <code>ClassDescription class</code>.</li><li>Look in <code>Behavior class</code> where it is found.</li></ul><p>TODO: Discuss what a &quot;metaclass&quot; is and how there methods become available.</p><p>The <code>new</code> method in <code>Behavior</code> sends the <code>#basicNew</code> to the class from which an instance is being created, which initializes all the instance variables to <code>nil</code>. Then it sends the <code>#initialize</code> message to the new instance.</p><p>The <code>basicNew</code> method cannot be overridden in subclasses to do something different, but the <code>new</code> method can be overridden.</p><p>TODO: Describe why the class <code>ProtoObject</code> exists.</p><p>The class <code>ProtoObject</code> is a subclass of itself. TODO: What does this mean?</p><p><code>Object</code> is a superclass of nearly every other class. There are a small number of classes that are subclasses of <code>ProtoObject</code> and not subclasses of <code>Object</code>. These include <code>BreakingMethodWrapper</code>, <code>MessageCatcher</code>, and <code>ProtoCatcher</code>.</p><h2 id="immutability" tabindex="-1">Immutability</h2><p>A class can enforce the immutability of its object by simply not implementing any methods that change its instance variable.</p><p>Another option is to use the &quot;Immutability&quot; package so attempts to change any instance variable of a given object wll result in a &quot;ModificationForbidden&quot; window opening that contains a stack trace which indicates where the attempt was made.</p><p>To install the &quot;Immutability&quot; package, enter <code>Feature require: 'Immutability'</code> and &quot;Do it&quot;. Among other things, this package adds the instance method <code>beImmutable</code> to the <code>Object</code> class.</p><p>To enforce a specific object to be immutable, send it the <code>#beImmutable</code> message. For example the <code>Rectangle</code> class described above could have the following class method for creating new instances:</p><pre class="language-smalltalk"><code class="language-smalltalk">height<span class="token punctuation">:</span> aHeight width<span class="token punctuation">:</span> aWidth<br>    <span class="token operator">^</span><span class="token keyword">self</span> <span class="token keyword">new</span> setHeight<span class="token punctuation">:</span> aHeight width<span class="token punctuation">:</span> aWidth<span class="token punctuation">;</span> beImmutable<span class="token punctuation">;</span> yourself</code></pre><p>Note the use of <code>yourself</code> to return the current object rather than the return value of the <code>beImmutable</code> method.</p></article>