<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Streams</h2><aside><nav class="toc"><ol><li><a href="#file-i%2Fo">File I/O</a></li></ol></nav></aside><article><p>TODO: Add information about working with streams that are not necessarily associated with a file.</p><h2 id="file-i%2Fo" tabindex="-1">File I/O</h2><p>To create a file, send the <code>#asFileEntry</code> message to a string that contains the file name. The file is assumed to be in the <code>\*-UserFiles</code> directory. For example:</p><pre class="language-smalltalk"><code class="language-smalltalk">fileEntry <span class="token operator">:=</span> <span class="token string">'demo.txt'</span> asFileEntry<span class="token punctuation">.</span></code></pre><p>To write to a text file, overwriting any previous contents:</p><pre class="language-smalltalk"><code class="language-smalltalk">fileEntry forceWriteStreamDo<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token block-arguments"><span class="token variable">:fileStream</span> <span class="token punctuation">|</span></span><br>    fileStream nextPutAll<span class="token punctuation">:</span> <span class="token string">'line #1'</span><span class="token punctuation">.</span><br>    fileStream newLine<span class="token punctuation">.</span><br>    fileStream nextPutAll<span class="token punctuation">:</span> <span class="token string">'line #2'</span><br><span class="token punctuation">]</span><span class="token punctuation">.</span></code></pre><p>Another way to obtain a stream for writing and reading a file at a given path is the following:</p><pre class="language-smalltalk"><code class="language-smalltalk">stream <span class="token operator">:=</span> FileStream fileNamed<span class="token punctuation">:</span> <span class="token string">'some-file-path'</span></code></pre><p>To read the entire contents of a text file into a string:</p><pre class="language-smalltalk"><code class="language-smalltalk">contents <span class="token operator">:=</span> fileEntry fileContents<span class="token punctuation">.</span></code></pre><p>To write serialized objects to a file:</p><pre class="language-smalltalk"><code class="language-smalltalk">fileEntry writeStreamDo<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token block-arguments"><span class="token variable">:fileStream</span> <span class="token punctuation">|</span></span><br>    <span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">refStream</span> <span class="token punctuation">|</span></span><br>    refStream <span class="token operator">:=</span> ReferenceStream on<span class="token punctuation">:</span> fileStream<span class="token punctuation">.</span><br>    refStream nextPut<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">.</span><br>    refStream nextPut<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">.</span><br>    refStream nextPut<span class="token punctuation">:</span> <span class="token string">'text'</span><span class="token punctuation">.</span><br>    refStream nextPut<span class="token punctuation">:</span> <span class="token symbol">#</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><br><span class="token punctuation">]</span><span class="token punctuation">.</span></code></pre><p>TODO: Do ReferenceStreams support circular object references?</p><p>To read serialized objects from a file:</p><pre class="language-smalltalk"><code class="language-smalltalk">fileEntry readStreamDo<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token block-arguments"><span class="token variable">:fileStream</span> <span class="token punctuation">|</span></span><br>    <span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">object</span> <span class="token variable">refStream</span> <span class="token punctuation">|</span></span><br>    refStream <span class="token operator">:=</span> ReferenceStream on<span class="token punctuation">:</span> fileStream<span class="token punctuation">.</span><br>    <span class="token punctuation">[</span> refStream atEnd <span class="token punctuation">]</span> whileFalse<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>        object <span class="token operator">:=</span> refStream next<span class="token punctuation">.</span><br>        object print <span class="token comment">"writes to Transcript"</span><br>    <span class="token punctuation">]</span><br><span class="token punctuation">]</span></code></pre><p>To delete a file:</p><pre class="language-smalltalk"><code class="language-smalltalk">fileEntry delete<span class="token punctuation">.</span></code></pre><p>TODO: Harvest more information about file system operations from this video. <a href="https://youtu.be/stMoWMlLVzk?si=_3rmJFPkZ2g4ZIIV" target="_blank">squeak smalltalk tutorial: file handling part 1</a>.</p></article>