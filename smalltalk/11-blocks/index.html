<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Blocks</h2><aside><nav class="toc"><ol><li><a href="#block-value">Block Value</a></li><li><a href="#non-local-returns">Non-local Returns</a></li><li><a href="#block-arguments">Block Arguments</a></li><li><a href="#block-variables">Block Variables</a></li><li><a href="#blocks-as-closures">Blocks as Closures</a></li><li><a href="#blocks-for-iteration">Blocks for Iteration</a></li><li><a href="#error-handling">Error Handling</a></li><li><a href="#time-to-run">Time to Run</a></li><li><a href="#running-in-another-process">Running in Another Process</a></li><li><a href="#partial-application">Partial Application</a></li></ol></nav></aside><article><p>A block is closure (anonymous function) that can have parameters and contain many expressions. They are instances of the class <code>BlockClosure</code>. Their execution is deferred until they are sent a message like <code>value</code>.</p><p>Blocks are surrounded by square brackets which is appropriate because real life blocks are typically rectangular.</p><p>Blocks are first class in that they can be saved in variables, passed as arguments to methods and other blocks, returned from methods and other blocks, and can be evaluated multiple times. For example:</p><pre class="language-smalltalk"><code class="language-smalltalk">noArgBlock <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><br>singleArgBlock <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token block-arguments"><span class="token variable">:a</span> <span class="token punctuation">|</span></span> a <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><br>multipleArgBlock <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token block-arguments"><span class="token variable">:a</span> <span class="token variable">:b</span> <span class="token punctuation">|</span></span> a <span class="token operator">*</span> b<span class="token punctuation">]</span><span class="token punctuation">.</span></code></pre><h2 id="block-value" tabindex="-1">Block Value</h2><p>The value of the block is the value of its last expression.</p><p>Blocks take zero or more positional arguments, which is something methods cannot do. Parameter names appear at the beginning of a block and each name is preceded by a colon. This syntax mirrors that of specifying arguments in keyword messages where each keyword is followed by a colon. It also simplifies parsing because it enables determining whether a block has any parameters without backtracking. The parameter list is separated from the expressions by a vertical bar.</p><p>Blocks support several messages that evaluate the block whose names begin with <code>value</code>. These messages enable providing zero to four arguments. For blocks with more than four parameters, send the message <code>#valueWithArguments:</code> and an array holding all the arguments. For example:</p><pre class="language-smalltalk"><code class="language-smalltalk">noArgBlock value<span class="token punctuation">.</span><br>singleArgBlock value<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">.</span><br>multiArgBlock value<span class="token punctuation">:</span> <span class="token number">1</span> value<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">.</span><br>multiArgBlock value<span class="token punctuation">:</span> <span class="token number">1</span> value<span class="token punctuation">:</span> <span class="token number">2</span> value<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">.</span><br>multiArgBlock value<span class="token punctuation">:</span> <span class="token number">1</span> value<span class="token punctuation">:</span> <span class="token number">2</span> value<span class="token punctuation">:</span> <span class="token number">3</span> value<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">.</span><br>multiArgBlock valueWithArguments<span class="token punctuation">:</span> <span class="token symbol">#</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span></code></pre><h2 id="non-local-returns" tabindex="-1">Non-local Returns</h2><p>If a block uses the caret operator (<code>^</code>) to return a value, the containing method will exit and return that value. This is referred to as a &quot;non-local return&quot;. Few programming languages support this. Languages that do include Common Lisp, Prolog, Ruby, Scala, Scheme, and Smalltalk.</p><p>Let's explore this with the following methods in a class named <code>BlockTest</code>.</p><pre class="language-smalltalk"><code class="language-smalltalk">takeBlock1<span class="token punctuation">:</span> aBlock<br>    <span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">result</span> <span class="token punctuation">|</span></span><br><br>    <span class="token string">'entered takeBlock1'</span> print<span class="token punctuation">.</span><br>    result <span class="token operator">:=</span> <span class="token keyword">self</span> takeBlock2<span class="token punctuation">:</span> aBlock<span class="token punctuation">.</span><br>    <span class="token string">'exiting takeBlock1'</span> print<span class="token punctuation">.</span><br>    <span class="token operator">^</span> result<span class="token punctuation">.</span><br><br>takeBlock2<span class="token punctuation">:</span> aBlock<br>    <span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">result</span> <span class="token punctuation">|</span></span><br><br>    <span class="token string">'entered takeBlock2'</span> print<span class="token punctuation">.</span><br>    result <span class="token operator">:=</span> aBlock value<span class="token punctuation">.</span><br>    <span class="token string">'exiting takeBlock2'</span> print<span class="token punctuation">.</span><br>    <span class="token operator">^</span> result<span class="token punctuation">.</span></code></pre><p>We can evaluate the <code>takeBlock1</code> method as follows:</p><pre class="language-smalltalk"><code class="language-smalltalk">BlockTest <span class="token keyword">new</span> takeBlock1<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token number">19</span> <span class="token punctuation">]</span><span class="token punctuation">.</span></code></pre><p>This will return <code>19</code> and output the following to the Transcript:</p><pre class="language-text"><code class="language-text">entered takeBlock1<br>entered takeBlock2<br>exiting takeBlock2<br>exiting takeBlock1</code></pre><p>Now let's do the same thing, but add a caret inside the block so we have a non-local return.</p><pre class="language-smalltalk"><code class="language-smalltalk">BlockTest <span class="token keyword">new</span> takeBlock1<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token operator">^</span> <span class="token number">19</span> <span class="token punctuation">]</span><span class="token punctuation">.</span></code></pre><p>This will also return <code>19</code>, but it will only write the following to the Transcript:</p><pre class="language-text"><code class="language-text">entered takeBlock1<br>entered takeBlock2</code></pre><p>This happens because the caret inside the block causes execution to skip the remainder of the code in the <code>takeBlock2</code> and <code>takeBlock1</code> methods and return to the expression where the block was initially used.</p><p>Use of non-local returns is generally discouraged because they can make the code harder to understand. However, they are sometimes used in scenarios such as implementing control structures and handling errors.</p><h2 id="block-arguments" tabindex="-1">Block Arguments</h2><p>A block must be passed the same number of arguments as it has parameters. If a block is passed fewer or more arguments than it accepts, a Debug window will open.</p><h2 id="block-variables" tabindex="-1">Block Variables</h2><p>Blocks can declare and use temporary (local) variables just like a method.</p><p>For example:</p><pre class="language-smalltalk"><code class="language-smalltalk">average <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token block-arguments"><span class="token variable">:a</span> <span class="token variable">:b</span> <span class="token punctuation">|</span></span><br>    <span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">sum</span> <span class="token punctuation">|</span></span><br>    sum <span class="token operator">:=</span> a <span class="token operator">+</span> b<span class="token punctuation">.</span><br>    sum <span class="token operator">/</span> <span class="token number">2.0</span><br><span class="token punctuation">]</span></code></pre><h2 id="blocks-as-closures" tabindex="-1">Blocks as Closures</h2><p>Blocks are closures, meaning that they can access in-scope variables defined outside them. For example:</p><pre class="language-smalltalk"><code class="language-smalltalk">n <span class="token operator">:=</span> <span class="token number">19</span><span class="token punctuation">.</span><br>b <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token block-arguments"><span class="token variable">:a</span> <span class="token punctuation">|</span></span> a <span class="token operator">+</span> n<span class="token punctuation">]</span><span class="token punctuation">.</span><br>b value<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment">"result is 21"</span></code></pre><h2 id="blocks-for-iteration" tabindex="-1">Blocks for Iteration</h2><p>To use a block as an iteration condition, use the methods <code>whileTrue</code>, <code>whileTrue:</code>, <code>whileFalse</code>, <code>whileFalse:</code>, <code>whileNotNil:</code>, and <code>whileNil:</code> that are defined in the <code>BlockClosure</code> class. Note that these are not methods in the <code>Boolean</code> class.</p><p>For example, the following code prints the integer values 1 through 10 in the Transcript:</p><pre class="language-smalltalk"><code class="language-smalltalk"><span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">counter</span> <span class="token punctuation">|</span></span><br>counter <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">.</span><br><span class="token punctuation">[</span>counter <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">]</span> whileTrue<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>    counter print<span class="token punctuation">.</span><br>    counter <span class="token operator">:=</span> counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">.</span><br><span class="token punctuation">]</span><span class="token punctuation">.</span></code></pre><p>The following code does the same using the <code>whileTrue</code> method.</p><pre class="language-smalltalk"><code class="language-smalltalk">counter <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">.</span><br><span class="token punctuation">[</span><br>    counter print<span class="token punctuation">.</span><br>    counter <span class="token operator">:=</span> counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">.</span><br>    counter <span class="token operator">&lt;=</span> <span class="token number">10</span><br><span class="token punctuation">]</span> whileTrue<span class="token punctuation">.</span></code></pre><p>Send <code>#whileFalse</code> without an argument to a block to evaluate the block repeatedly until it answers <code>true</code>.</p><p>A block can call itself if it passes itself in as an argument. For example:</p><pre class="language-smalltalk"><code class="language-smalltalk">fact <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token block-arguments"><span class="token variable">:block</span> <span class="token variable">:n</span> <span class="token punctuation">|</span></span><br>    n <span class="token operator">=</span> <span class="token number">1</span><br>        ifTrue<span class="token punctuation">:</span> <span class="token number">1</span><br>        ifFalse<span class="token punctuation">:</span> <span class="token punctuation">[</span>n <span class="token operator">*</span> <span class="token punctuation">(</span>block value<span class="token punctuation">:</span> block value<span class="token punctuation">:</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><br><span class="token punctuation">]</span><span class="token punctuation">.</span><br><br>fact value<span class="token punctuation">:</span> fact value<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token comment">"gives 120"</span></code></pre><p>Send <code>#repeat</code> to a block to evaluate it repeated unit the block explicitly returns a value, which causes the containing method to exit and return that value.</p><h2 id="error-handling" tabindex="-1">Error Handling</h2><p>See the &quot;Exception Handing&quot; section for details on how blocks can be used to execute code that may raise an exception and exceptions can be handled.</p><h2 id="time-to-run" tabindex="-1">Time to Run</h2><p>To evaluate a block by sending it <code>#value</code> AND determine how long it took to execute, send the block <code>#millisecondsToRun</code>. For example:</p><pre class="language-smalltalk"><code class="language-smalltalk">block <span class="token operator">:=</span> <span class="token punctuation">[</span> <span class="token number">1</span> to<span class="token punctuation">:</span> <span class="token number">1000</span> do<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token block-arguments"><span class="token variable">:i</span> <span class="token punctuation">|</span></span> i print <span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">.</span><br>ms <span class="token operator">:=</span> block millisecondsToRun<span class="token punctuation">.</span></code></pre><p>One way to measure the time required to evaluate a set of expressions not contained in a block is to:</p><ul><li>precede the expressions with <code>startTime := Time now.</code></li><li>follow the expressions with <code>durationNanos := (Time now - startTime) totalNanoSeconds.</code></li></ul><h2 id="running-in-another-process" tabindex="-1">Running in Another Process</h2><p>The Squeak VM is single-threaded, like JavaScript. Processes do not run in separate threads and instead use cooperative multitasking.</p><p>Some Smalltalk implementations also support execute code in a new thread. The Squeak VM does not support this.</p><p>Processes yield control to other processes by sending certain messages to the <code>Delay</code>, performing I/O, or performing another blocking operation.</p><p>The order in which processes execute is affected by their priority. The default priority is 40, the lowest is 10, and the highest is 80. The <code>priority:</code> method is used to set the priority of a <code>Process</code> to a value other than the default. This method ensures that the value actually used is in the range of the lowest to the highest allowed.</p><p>The following table summaries the instance methods in the <code>BlockClosure</code> class that execute a block in a new process.</p><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody><tr><td><code>fork</code></td><td>creates new process that executes block at default priority</td></tr><tr><td><code>forkNamed:</code></td><td>creates new process with given name that executes block at default priority</td></tr><tr><td><code>forkAt:</code></td><td>creates new process that executes block at given priority</td></tr><tr><td><code>forkAt:named:</code></td><td>creates new process with given name that executes block at given priority</td></tr><tr><td><code>forkAndWait</code></td><td>creates new process that executes block and blocks current process until it finishes</td></tr><tr><td><code>newProcess</code></td><td>creates new process that will execute block when <code>#resume</code> message is sent to it</td></tr><tr><td><code>newProcessWith:</code></td><td>creates new process that will execute block with arguments in array argument</td></tr></tbody></table><p>All the methods above must be used with a block that takes no arguments except <code>newProcessWith:</code>.</p><p>When a new process is not given a name, it defaults to &quot;unnamed&quot;.</p><p>To see long-running processes and optionally terminate them, open the World menu and select Open ... Process Browser. To terminate a process, select it and press cmd-t (or right-click and select &quot;Terminate&quot;).</p><p>To give a name to the process returned by <code>newProcess</code> or <code>newProcessWith:</code>, send the message <code>#name:</code> to it with a <code>String</code> argument.</p><p>The following code demonstrates using each of the methods described above.</p><pre class="language-smalltalk"><code class="language-smalltalk"><span class="token comment">"This prints one, three, and two."</span><br><span class="token string">'one'</span> print<span class="token punctuation">.</span><br><span class="token punctuation">[</span><span class="token string">'two'</span> print<span class="token punctuation">]</span> fork<span class="token punctuation">.</span><br><span class="token string">'three'</span> print<span class="token punctuation">.</span><br><br><span class="token comment">"This prints one, two, and three."</span><br><span class="token string">'one'</span> print<span class="token punctuation">.</span><br><span class="token punctuation">[</span><span class="token string">'two'</span> print<span class="token punctuation">]</span> forkAndWait<span class="token punctuation">.</span><br><span class="token string">'three'</span> print<span class="token punctuation">.</span><br><br>process <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token block-arguments"><span class="token variable">:a</span> <span class="token variable">:b</span> <span class="token punctuation">|</span></span><br>    <span class="token punctuation">(</span>Delay forSeconds<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">)</span> wait<span class="token punctuation">.</span><br>    <span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> print<span class="token punctuation">.</span> <span class="token comment">"prints 5"</span><br><span class="token punctuation">]</span> newProcessWith<span class="token punctuation">:</span> <span class="token symbol">#</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><br>process name<span class="token punctuation">:</span> <span class="token string">'addition'</span><span class="token punctuation">.</span><br>process resume<span class="token punctuation">.</span></code></pre><p>The <code>fork</code> method is useful for blocks of long-running code that would otherwise prevent UI updates. The following code iterates through the numbers 1 to 5, prints each number, and delays for one second.</p><pre class="language-smalltalk"><code class="language-smalltalk">delay <span class="token operator">:=</span> Delay forSeconds<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">.</span><br><span class="token number">1</span> to<span class="token punctuation">:</span> <span class="token number">5</span> do<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token block-arguments"><span class="token variable">:n</span> <span class="token punctuation">|</span></span><br>    n print<span class="token punctuation">.</span><br>    delay wait<span class="token punctuation">.</span><br><span class="token punctuation">]</span><span class="token punctuation">.</span></code></pre><p>This code does not produce the desired result. UI updates, including writing to the Transcript, are blocked until the code completes. Nothing appears in the Transcript for five seconds and then all the numbers appear at once.</p><p>To fix this, we can wrap the entire iteration loop in a block and send <code>#fork</code> to it so it runs in a new process. This avoids blocking UI updates and allows one number per second to appear in the Transcript.</p><pre class="language-smalltalk"><code class="language-smalltalk">delay <span class="token operator">:=</span> Delay forSeconds<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">.</span><br><span class="token punctuation">[</span> <span class="token number">1</span> to<span class="token punctuation">:</span> <span class="token number">5</span> do<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token block-arguments"><span class="token variable">:n</span> <span class="token punctuation">|</span></span><br>    n print<span class="token punctuation">.</span><br>    delay wait<span class="token punctuation">.</span><br><span class="token punctuation">]</span><span class="token punctuation">]</span> fork<span class="token punctuation">.</span></code></pre><h2 id="partial-application" tabindex="-1">Partial Application</h2><p>Partial application is the ability to pass a subset of the arguments required by a function to the function and get a new function that takes the remaining arguments.</p><p>Currying is similar, but only passes a single argument to the function.</p><p>The Smalltalk <code>BlockClosure</code> class supports a limited form of currying, handling up to four arguments. But it does not support partial application.</p><p>The following code demonstrates using currying with the <code>BlockClosure</code> class:</p><pre class="language-smalltalk"><code class="language-smalltalk">add2Numbers <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token block-arguments"><span class="token variable">:a</span> <span class="token variable">:b</span> <span class="token punctuation">|</span></span> a <span class="token operator">+</span> b<span class="token punctuation">]</span><span class="token punctuation">.</span><br>add2Numbers value<span class="token punctuation">:</span> <span class="token number">2</span> value<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">.</span> <span class="token comment">"5"</span><br>block <span class="token operator">:=</span> add2Numbers withFirstArg<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">.</span><br>block argumentCount<span class="token punctuation">.</span> <span class="token comment">"1"</span><br>block value<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">.</span> <span class="token comment">"5"</span><br><br>add3Numbers <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token block-arguments"><span class="token variable">:a</span> <span class="token variable">:b</span> <span class="token variable">:c</span> <span class="token punctuation">|</span></span> a <span class="token operator">+</span> b <span class="token operator">+</span> c<span class="token punctuation">]</span><span class="token punctuation">.</span><br>block1 <span class="token operator">:=</span> add3Numbers withFirstArg<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">.</span><br>block2 <span class="token operator">:=</span> block1 withFirstArg<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">.</span><br><span class="token comment">"The withFirstArg: method always returns a block.<br> Send it the #value message to get the final value."</span><br><span class="token punctuation">(</span>block2 withFirstArg<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">)</span> value<span class="token punctuation">.</span></code></pre><p>We can implement unlimited currying and partial application. The <code>PartialBlock</code> class defined below does this.</p><p>Here are examples of using it:</p><pre class="language-smalltalk"><code class="language-smalltalk">pb <span class="token operator">:=</span> PartialBlock block<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token block-arguments"><span class="token variable">:a</span> <span class="token variable">:b</span> <span class="token punctuation">|</span></span> a <span class="token operator">+</span> b<span class="token punctuation">]</span><span class="token punctuation">.</span><br><span class="token comment">"All arguments supplied."</span><br>pb valueWithArguments<span class="token punctuation">:</span> <span class="token symbol">#</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token comment">"5"</span><br><br><span class="token comment">"Single argument supplied"</span><span class="token punctuation">.</span><br>pb2 <span class="token operator">:=</span> pb value<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">.</span> <span class="token comment">"a new PartialBlock"</span><br>pb2 value<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">.</span> <span class="token comment">"5"</span><br><br>pb <span class="token operator">:=</span> PartialBlock block<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token block-arguments"><span class="token variable">:a</span> <span class="token variable">:b</span> <span class="token variable">:c</span> <span class="token punctuation">|</span></span> a <span class="token operator">+</span> b <span class="token operator">+</span> c<span class="token punctuation">]</span><span class="token punctuation">.</span><br><br><span class="token comment">"Partial arguments supplied."</span><br>pb3 <span class="token operator">:=</span> pb valueWithArguments<span class="token punctuation">:</span> <span class="token symbol">#</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token comment">"a new PartialBlock"</span><br><span class="token comment">"Remaining arguments supplied."</span><br>pb3 valueWithArguments<span class="token punctuation">:</span> <span class="token symbol">#</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token comment">"9"</span><span class="token operator">!</span></code></pre><p>Here is the defintion of the <code>PartialBlock</code> class:</p><pre class="language-smalltalk"><code class="language-smalltalk">Object subclass<span class="token punctuation">:</span> <span class="token symbol">#PartialBlock</span><br>    instanceVariableNames<span class="token punctuation">:</span> <span class="token string">'arguments block'</span><br>    classVariableNames<span class="token punctuation">:</span> <span class="token string">''</span><br>    poolDictionaries<span class="token punctuation">:</span> <span class="token string">''</span><br>    category<span class="token punctuation">:</span> <span class="token string">'Volkmann'</span><br><br><span class="token comment">"class method in private category"</span><br>block<span class="token punctuation">:</span> aBlock arguments<span class="token punctuation">:</span> anArray<br>    <span class="token operator">^</span> <span class="token keyword">self</span> <span class="token keyword">new</span><br>        setBlock<span class="token punctuation">:</span> aBlock<br>        arguments<span class="token punctuation">:</span> anArray<br><br><span class="token comment">"class method in instance creation category"</span><br>block<span class="token punctuation">:</span> aBlock<br>    <span class="token operator">^</span> <span class="token keyword">self</span> <span class="token keyword">new</span> setBlock<span class="token punctuation">:</span> aBlock<br><br><span class="token comment">"instance method in private category"</span><br>setBlock<span class="token punctuation">:</span> aBlock<br>    block <span class="token operator">:=</span> aBlock<span class="token punctuation">.</span><br>    arguments <span class="token operator">:=</span> <span class="token symbol">#</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br><span class="token comment">"instance method in private category"</span><br>setBlock<span class="token punctuation">:</span> aBlock arguments<span class="token punctuation">:</span> anArray<br>    block <span class="token operator">:=</span> aBlock<span class="token punctuation">.</span><br>    arguments <span class="token operator">:=</span> anArray<br><br><span class="token comment">"instance method in evaluating category"</span><br>value<span class="token punctuation">:</span> anObject<br>    <span class="token operator">^</span> <span class="token keyword">self</span> valueWithArguments<span class="token punctuation">:</span> <span class="token punctuation">{</span> anObject <span class="token punctuation">}</span><br><br><span class="token comment">"instance method in evaluating category"</span><br>valueWithArguments<span class="token punctuation">:</span> anArray<br>    <span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">args</span> <span class="token punctuation">|</span></span><br>    <span class="token punctuation">(</span>anArray isMemberOf<span class="token punctuation">:</span> Array<span class="token punctuation">)</span> ifFalse<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>        <span class="token keyword">self</span> error<span class="token punctuation">:</span> <span class="token string">'valueWithArguments: requires an Array'</span><br>    <span class="token punctuation">]</span><span class="token punctuation">.</span><br>    args <span class="token operator">:=</span> arguments <span class="token operator">,</span> anArray<span class="token punctuation">.</span><br>    anArray size <span class="token operator">=</span> <span class="token keyword">self</span> argumentCount ifTrue<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>        <span class="token operator">^</span> block valueWithArguments<span class="token punctuation">:</span> args<br>    <span class="token punctuation">]</span><span class="token punctuation">.</span><br>    anArray size <span class="token operator">></span> <span class="token keyword">self</span> argumentCount ifTrue<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>        <span class="token keyword">self</span> error<span class="token punctuation">:</span> <span class="token string">'too many arguments'</span><br>    <span class="token punctuation">]</span><span class="token punctuation">.</span><br>    <span class="token operator">^</span> PartialBlock<br>        block<span class="token punctuation">:</span> block<br>        arguments<span class="token punctuation">:</span> args<br><br><span class="token comment">"instance method in accessing category"</span><br>argumentCount<br>    <span class="token operator">^</span> block argumentCount <span class="token operator">-</span> arguments size</code></pre></article>