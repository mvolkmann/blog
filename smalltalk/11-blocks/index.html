<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Blocks</h2><aside></aside><article><p>A block is closure (anonymous function) that can have parameters and contain many expressions. They are represented by the class <code>BlockClosure</code>.</p><p>The value of the block is the value of its last expression. If a block uses the caret operator (<code>^</code>) to return a value, the containing method will exit and return that value.</p><p>Blocks take zero or more positional arguments, which is something methods cannot do. Parameter names appear at the beginning of a block and each name is preceded by a colon. (This syntax was most likely chosen to simplify parsing because it enables determining whether a block has any parameters without backtracking.) The parameter list is separated from the expressions by a vertical bar.</p><p>Blocks can be saved in variables, passed as arguments to methods and other blocks, returned from methods and other blocks, and can be evaluated multiple times. For example:</p><pre class="language-smalltalk"><code class="language-smalltalk">noArgBlock <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><br>singleArgBlock <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token block-arguments"><span class="token variable">:a</span> <span class="token punctuation">|</span></span> a <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><br>multipleArgBlock <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token block-arguments"><span class="token variable">:a</span> <span class="token variable">:b</span> <span class="token punctuation">|</span></span> a <span class="token operator">*</span> b<span class="token punctuation">]</span><span class="token punctuation">.</span></code></pre><p>Blocks support several messages that evaluate the block whose names begin with <code>value</code>. These messages enable providing zero to four arguments. For blocks with more than four parameters, send the message <code>#valueWithArguments:</code> and an array holding all the arguments. For example:</p><pre class="language-smalltalk"><code class="language-smalltalk">noArgBlock value<span class="token punctuation">.</span><br>singleArgBlock value<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">.</span><br>multiArgBlock value<span class="token punctuation">:</span> <span class="token number">1</span> value<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">.</span><br>multiArgBlock value<span class="token punctuation">:</span> <span class="token number">1</span> value<span class="token punctuation">:</span> <span class="token number">2</span> value<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">.</span><br>multiArgBlock value<span class="token punctuation">:</span> <span class="token number">1</span> value<span class="token punctuation">:</span> <span class="token number">2</span> value<span class="token punctuation">:</span> <span class="token number">3</span> value<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">.</span><br>multiArgBlock valueWithArguments<span class="token punctuation">:</span> <span class="token symbol">#</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span></code></pre><p>A block must be passed the same number of arguments as it has parameters. If a block is passed fewer or more arguments than it accepts, a Debug window will open.</p><p>Blocks can declare and use temporary (local) variables just like a method.</p><p>For example:</p><pre class="language-smalltalk"><code class="language-smalltalk">average <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token block-arguments"><span class="token variable">:a</span> <span class="token variable">:b</span> <span class="token punctuation">|</span></span><br>    <span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">sum</span> <span class="token punctuation">|</span></span><br>    sum <span class="token operator">:=</span> a <span class="token operator">+</span> b<span class="token punctuation">.</span><br>    sum <span class="token operator">/</span> <span class="token number">2.0</span></code></pre><p>Blocks are closures, meaning that they can access variables defined outside them. For example:</p><pre class="language-smalltalk"><code class="language-smalltalk">n <span class="token operator">:=</span> <span class="token number">19</span><span class="token punctuation">.</span><br>b <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token block-arguments"><span class="token variable">:a</span> <span class="token punctuation">|</span></span> a <span class="token operator">+</span> n<span class="token punctuation">]</span><span class="token punctuation">.</span><br>b value<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment">"result is 21"</span></code></pre><p>To use a block as an iteration condition, use the methods <code>whileTrue</code>, <code>whileFalse</code>, <code>whileNotNil</code>, and <code>whileNil</code> that are defined in the <code>BlockClosure</code> class. Note that these are not methods on the <code>Boolean</code> class.</p><p>For example, the following code prints the integer values 1 through 10 in the Transcript:</p><pre class="language-smalltalk"><code class="language-smalltalk"><span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">counter</span> <span class="token punctuation">|</span></span><br>counter <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">.</span><br><span class="token punctuation">[</span>counter <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">]</span> whileTrue<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>    counter print<span class="token punctuation">.</span><br>    counter <span class="token operator">:=</span> counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">.</span><br><span class="token punctuation">]</span><span class="token punctuation">.</span></code></pre><p>A block can call itself if it passes itself in as an argument. For example:</p><pre class="language-smalltalk"><code class="language-smalltalk">fact <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token block-arguments"><span class="token variable">:block</span> <span class="token variable">:n</span> <span class="token punctuation">|</span></span><br>    n <span class="token operator">=</span> <span class="token number">1</span><br>        ifTrue<span class="token punctuation">:</span> <span class="token number">1</span><br>        ifFalse<span class="token punctuation">:</span> <span class="token punctuation">[</span>n <span class="token operator">*</span> <span class="token punctuation">(</span>block value<span class="token punctuation">:</span> block value<span class="token punctuation">:</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><br><span class="token punctuation">]</span><span class="token punctuation">.</span><br><br>fact value<span class="token punctuation">:</span> fact value<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token comment">"gives 120"</span></code></pre></article>