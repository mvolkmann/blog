<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Exception Handling</h2><aside><nav class="toc"><ol><li><a href="#context">Context</a></li></ol></nav></aside><article><p>Exceptions are described by a specific kind of exception object that can hold data describing the problem. To throw/raise an exception object, sent it the message <code>#signal:</code> with a <code>String</code> argument description.</p><p>Exceptions that are thrown by code in a block can be caught and handled. Unhandled exceptions result in a Debug window being opened that contains a stack trace.</p><p>Smalltalk seems to use the words &quot;exception&quot; and &quot;error&quot; interchangably.</p><p>The following code demonstrates catching an exception that is thrown by code in a block that divides a number by zero. It opens an Inspector window to examine details of the exception object.</p><pre class="language-smalltalk"><code class="language-smalltalk"><span class="token punctuation">[</span><span class="token number">3</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">]</span> on<span class="token punctuation">:</span> ZeroDivide do<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token block-arguments"><span class="token variable">:ex</span> <span class="token punctuation">|</span></span> ex inspect<span class="token punctuation">]</span><span class="token punctuation">.</span></code></pre><p>The class of the exception object is <code>ZeroDivide</code>. Its instance variables include:</p><ul><li><code>messageText</code>: <code>nil</code></li><li><code>receiver</code>: <code>3</code></li><li><code>selector</code>: <code>#/</code></li><li><code>arguments</code>: <code>#(0)</code></li></ul><p>To throw a generic <code>Exception</code>:</p><pre class="language-smalltalk"><code class="language-smalltalk">Error signal<span class="token punctuation">:</span> <span class="token string">'some message'</span></code></pre><p>Smalltalk provides many subclasses of the <code>Exception</code> class. Examples include <code>ArithmeticError</code>, <code>AssertionFailure</code>, <code>Error</code>, <code>Halt</code>, <code>MessageNotUnderstood</code>, <code>NotYetImplemented</code>, and <code>ZeroDivide</code>.</p><p>To define a custom exception, create a class that is a subclass of the <code>Exception</code> class or one of its subclasses such as <code>Error</code>. The custom class can include instance variables and methods that are specific to that exception. For example:</p><pre class="language-smalltalk"><code class="language-smalltalk">Error subclass<span class="token punctuation">:</span> <span class="token symbol">#OutOfBoundsException</span><br>    instanceVariableNames<span class="token punctuation">:</span> <span class="token string">'lowerBound upperBound'</span><br>    classVariableNames<span class="token punctuation">:</span> <span class="token string">''</span><br>    poolDictionaries<span class="token punctuation">:</span> <span class="token string">''</span><br>    category<span class="token punctuation">:</span> <span class="token string">'Volkmann'</span></code></pre><p>The following class method is used to create an instance:</p><pre class="language-smalltalk"><code class="language-smalltalk">lower<span class="token punctuation">:</span> lowerNumber upper<span class="token punctuation">:</span> upperNumber<br>    <span class="token operator">^</span><span class="token keyword">self</span> <span class="token keyword">new</span> setLower<span class="token punctuation">:</span> lowerNumber upper<span class="token punctuation">:</span> upperNumber</code></pre><p>The following instance method is used by the class method above:</p><pre class="language-smalltalk"><code class="language-smalltalk">setLower<span class="token punctuation">:</span> lowerNumber upper<span class="token punctuation">:</span> upperNumber<br>    <span class="token keyword">super</span> initialize<span class="token punctuation">.</span><br>    lowerBound <span class="token operator">:=</span> lowerNumber<span class="token punctuation">.</span><br>    upperBound <span class="token operator">:=</span> upperNumber</code></pre><p>If an exception subclass defines class methods that create a new instance, make sure to call <code>super initialize</code> as shown above.</p><p>To throw a custom exception send the class, or an instance of it, the <code>#signal:</code> message. For example, the following instance method can be defined in a class that has a <code>score</code> instance variable:</p><pre class="language-smalltalk"><code class="language-smalltalk">score<span class="token punctuation">:</span> aNumber<br>    <span class="token temporary-variables"><span class="token punctuation">|</span> <span class="token variable">ex</span> <span class="token punctuation">|</span></span><br>    ex <span class="token operator">:=</span> OutOfBoundsException lower<span class="token punctuation">:</span> lowerBound upper<span class="token punctuation">:</span> upperBound<span class="token punctuation">.</span><br>    aNumber <span class="token operator">&lt;</span>  lowerBound ifTrue<span class="token punctuation">:</span> <span class="token punctuation">[</span> ex signal<span class="token punctuation">:</span> <span class="token string">'too low'</span> <span class="token punctuation">]</span><span class="token punctuation">.</span><br>    aNumber <span class="token operator">></span> upperBound ifTrue<span class="token punctuation">:</span> <span class="token punctuation">[</span> ex signal<span class="token punctuation">:</span> <span class="token string">'too high'</span> <span class="token punctuation">]</span><span class="token punctuation">.</span><br>    score <span class="token operator">:=</span> aNumber</code></pre><p>To catch an exceptions that may be thrown by a method, send a message that invokes the method inside a block and send the <code>#on:do:</code> message to the block. Sending the message <code>#messageText</code> to an exception object returns the message text of the exception.</p><p>For example:</p><pre class="language-smalltalk"><code class="language-smalltalk"><span class="token punctuation">[</span>s <span class="token operator">:=</span> Game <span class="token keyword">new</span> score<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">]</span> on<span class="token punctuation">:</span> OutOfBoundsException do<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token block-arguments"><span class="token variable">:ex</span> <span class="token punctuation">|</span></span><br>    ex messageText print<span class="token punctuation">.</span><br><span class="token punctuation">]</span></code></pre><h2 id="context" tabindex="-1">Context</h2><p>TODO: Supposedly the value of <code>thisContext</code> is captured in exeception objects, TODO: but I don't see this happening. Is it supposed to be the value of the TODO: <code>signalContext</code> instance variable? I see that getting set to <code>nil</code>.</p></article>