<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Fastify</h2><aside></aside><article><p><a href="https://www.fastify.io?v=1.1.0" rel="noopener" target="_blank">Fastify</a> is a web server framework for Node.js that is an alternative to Express.</p><p>Benefits include:</p><ul><li>one of the fastest Node-based web servers</li><li>supports JSON Schema for validating requests</li><li>uses Pino for logging</li><li>maintains a TypeScript type declaration file so usage can be type checked</li><li>provides a good developer experience</li></ul><p>To install Fastify in a project, enter <code>npm install fastify</code>.</p><p>To enable serving static files, enter <code>npm install fastify-static</code>.</p><p>To enable accessing environment-specific environment files, enter <code>npm install dotenv</code>. Then create a <code>.env</code> file that defines environment variables with lines like <code>MONGO_URL=some-url</code>. A different version of this file can be created for each environment, such as dev, test, stage, and production.</p><p>To run the server in watch mode, install <code>nodemon</code> by entering <code>npm install -g nodemon</code>. Then run the app using the <code>nodemon</code> command instead of <code>node</code>.</p><p>To use ECMAScript Modules (ESM), edit <code>package.json</code> and add the line <code>&quot;type&quot;: &quot;module&quot;,</code>. This enables using the following syntax to import a JavaScript file from another one:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">'./some-name.js'</span><span class="token punctuation">;</span> <span class="token comment">// file extension is required</span></code></pre><p>Set MONGO_URL to mongodb+srv://{username}:{password}@cluster0.3efbd.mongodb.net/myFirstDatabase?retryWrites=true&amp;w=majority</p><p>Here is code for an example server.</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> dotenv <span class="token keyword">from</span> <span class="token string">'dotenv'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>fastify<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'fastify'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> fastifyStatic <span class="token keyword">from</span> <span class="token string">'fastify-static'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>fileURLToPath<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'url'</span><span class="token punctuation">;</span><br><br><span class="token comment">// Normally these names are defined by Node.js.</span><br><span class="token comment">// But when "type" is set to "module" in package.json,</span><br><span class="token comment">// these go away.</span><br><span class="token keyword">const</span> __filename <span class="token operator">=</span> <span class="token function">fileURLToPath</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> __dirname <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token constant">PORT</span> <span class="token operator">=</span> <span class="token number">1919</span><span class="token punctuation">;</span><br><br><span class="token comment">// Load environment variables from the .env file into process.env.</span><br><span class="token comment">// For example, process.env.MONGO_URL.</span><br>dotenv<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">fastify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">startApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">try</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Serve static files from the "public" directory.</span><br>    app<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>fastifyStatic<span class="token punctuation">,</span> <span class="token punctuation">{</span><br>      <span class="token literal-property property">root</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'public'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Define "/" route.</span><br>    app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> reply</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      reply<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token string">'bar'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// sets Content-Type to application/json</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'listening on port'</span><span class="token punctuation">,</span> <span class="token constant">PORT</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token function">startApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></article>