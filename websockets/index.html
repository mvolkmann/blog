<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>WebSockets</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#use-cases">Use Cases</a></li><li><a href="#issues">Issues</a></li><li><a href="#demo-client">Demo Client</a></li><li><a href="#demo-server">Demo Server</a></li><li><a href="#running-demo">Running Demo</a></li><li><a href="#bun-and-hono">Bun and Hono</a></li><li><a href="#alternatives">Alternatives</a></li></ol></nav></aside><article><style>img {
    border: 1px solid gray;
  }</style><p><img alt="WebSocket logo" style="border: none; width: 30%" src="/blog/assets/websocket-logo.svg?v=1.1.1"></p><h2 id="overview" tabindex="-1">Overview</h2><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_client_applications?v=1.1.1" rel="noopener" target="_blank">WebSockets</a> are a standardized protocol for two-way communication between clients and servers using TCP. They are widely supported by web browsers.</p><p>For one-way communication from servers to clients, consider using <a href="/blog/topics/#/blog/server-sent-events/" target="_blank">Server-Sent Events</a> (SSE). WebSockets support text and binary data, whereas SSE only supports UTF-8 text. When only text is needed, SSE is a good option because the required code is a bit easier to write than the code for WebSockets.</p><p>WebSockets require upgrading an existing HTTP connection. For details, see the MDN page <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Protocol_upgrade_mechanism?v=1.1.1" rel="noopener" target="_blank">Protocal upgrade mechanism</a>.</p><p>Many WebSocket libraries for server-side programming languages/environments exist. The example below demonstrates using the highly popular Node.js library <a href="https://github.com/websockets/ws?v=1.1.1" rel="noopener" target="_blank">ws</a>.</p><p>All the example code below can be found in the GitHub repository <a href="https://github.com/mvolkmann/websocket-examples?v=1.1.1" rel="noopener" target="_blank">websocket-examples</a>.</p><h2 id="use-cases" tabindex="-1">Use Cases</h2><p>Common uses of WebSockets include:</p><ul><li>live data feeds such as weather and sports updates</li><li>gathering and displaying information about server-side progress</li><li>client-side logging of server-side activity</li></ul><h2 id="issues" tabindex="-1">Issues</h2><p>WebSockets do not provide automatic reconnection. If a WebSocket connection is closed, perhaps due to a network issue, clients will not automatically attempt to reconnect to the server. Additional code must be written to poll the server and reconnect.</p><p>Some WebSocket libraries such as <a href="https://socket.io?v=1.1.1" rel="noopener" target="_blank">Socket.IO</a> provide reconnection support. This is also a built-in feature of Server-Sent Events (SSE).</p><h2 id="demo-client" tabindex="-1">Demo Client</h2><p>The following code is an example client HTML file that connects to the WebSocket server and receives messages. Note the use of the class <code>WebSocket</code>.</p><pre class="language-js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">></span><br><span class="token operator">&lt;</span>html<span class="token operator">></span><br>  <span class="token operator">&lt;</span>head<span class="token operator">></span><br>    <span class="token operator">&lt;</span>title<span class="token operator">></span>WebSocket Demo<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span><br>    <span class="token operator">&lt;</span>script<span class="token operator">></span><br>      <span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:3001'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      ws<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ws open'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello from client!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">;</span><br>      ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">received "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>        <span class="token comment">// Either the client or the server can close the connection.</span><br>        <span class="token comment">// ws.send('stop'); // ask server to close the WebSocket</span><br>        ws<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// close WebSocket from client</span><br>      <span class="token punctuation">}</span><span class="token punctuation">;</span><br>      ws<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token parameter">error</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ws error:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">;</span><br>      ws<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ws closed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span><br>  <span class="token operator">&lt;</span>body<span class="token operator">></span><br>    <span class="token operator">&lt;</span>h1<span class="token operator">></span>WebSockets Demo<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><br>    <span class="token operator">&lt;</span>p<span class="token operator">></span>See output <span class="token keyword">in</span> DevTools Console<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span><br><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span></code></pre><h2 id="demo-server" tabindex="-1">Demo Server</h2><p>The following server code uses Node.js, the <a href="https://expressjs.com?v=1.1.1" rel="noopener" target="_blank">Express</a> framework, and the <a href="https://www.npmjs.com/package/ws?v=1.1.1" rel="noopener" target="_blank">ws</a> WebSocket library. It also uses <a href="https://nodemon.io?v=1.1.1" rel="noopener" target="_blank">nodemon</a> to automatically restart the server when its code is modified, which is useful during iterative development and debugging.</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> express <span class="token keyword">from</span> <span class="token string">'express'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> WebSocket <span class="token keyword">from</span> <span class="token string">'ws'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/greet'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Create a WebSocket server.</span><br><span class="token keyword">const</span> wsServer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket<span class="token punctuation">.</span>Server</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">3001</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// When a client connects ...</span><br>wsServer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span> <span class="token parameter">ws</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  ws<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'WebSocket is open.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Listen for messages from the client.</span><br>  ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> message <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span><br>    <span class="token comment">// console.log('server.js onmessage: event =', event);</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">received "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token operator">===</span> <span class="token string">'stop'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      ws<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>      ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello from server!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">/*<br>    // Broadcast the message to all the clients.<br>    // wsServer.clients is not an Array, so you cannot use a for-of loop.<br>    wsServer.clients.forEach(client => {<br>      const isOpen = client.readyState === WebSocket.OPEN;<br><br>      // To send to all open clients,<br>      // including the one that sent the message ...<br>      if (isOpen) client.send(message);<br><br>      // To send to all open clients<br>      // except the one that sent the message ...<br>      //const isSelf = client === ws;<br>      //if (isOpen &amp;&amp; !isSelf) client.send(message);<br>    });<br>    */</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>  ws<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token parameter">error</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'WebSocket error:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>  ws<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'WebSocket is closed.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'listening on port'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The following <code>package.json</code> file can be used to start the server.</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"node-websockets"</span><span class="token punctuation">,</span><br>  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span><br>  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"nodemon src/server.js"</span><span class="token punctuation">,</span><br>    <span class="token property">"format"</span><span class="token operator">:</span> <span class="token string">"prettier --write '**/*.{css,html,js,ts,tsx}'"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"express"</span><span class="token operator">:</span> <span class="token string">"^4.18.2"</span><span class="token punctuation">,</span><br>    <span class="token property">"ws"</span><span class="token operator">:</span> <span class="token string">"^7.4.5"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"nodemon"</span><span class="token operator">:</span> <span class="token string">"^2.0.7"</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><h2 id="running-demo" tabindex="-1">Running Demo</h2><p>To run this demo, enter <code>npm install</code>, enter <code>npm run dev</code>, browse localhost:3000, open the browser DevTools, and view the Console output.</p><p>The following screenshot shows the request and response HTTP headers for the WebSocket connection.</p><p><img alt="WebSockets DevTools Network tab Headers" style="width: 100%" src="/blog/assets/websockets-node-devtools-network-headers.png?v=1.1.1"></p><p>The following screenshot shows the messages for the WebSocket connection.</p><p><img alt="WebSockets DevTools Network tab Messages" style="width: 70%" src="/blog/assets/websockets-node-devtools-network-messages.png?v=1.1.1"></p><h2 id="bun-and-hono" tabindex="-1">Bun and Hono</h2><p>The following code is an example client HTML file that connects to the WebSocket server and receives messages. It differs from the previous example in that it automatically attempts to reconnect to the WebSocket server if the connection is closed.</p><p><img alt="WebSocket reconnecting" style="width: 50%" src="/blog/assets/websocket-reconnecting.png?v=1.1.1"></p><pre class="language-js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">></span><br><span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">></span><br>  <span class="token operator">&lt;</span>head<span class="token operator">></span><br>    <span class="token operator">&lt;</span>title<span class="token operator">></span>WebSocket Demo<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span><br>    <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span><span class="token string">"styles.css"</span> <span class="token operator">/</span><span class="token operator">></span><br>    <span class="token operator">&lt;</span>script<br>      src<span class="token operator">=</span><span class="token string">"https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"</span><br>      integrity<span class="token operator">=</span><span class="token string">"sha384-U7nmwYozlJwxnpCeC+X+JOS3WWNqSfJKSgSs/VAaek8V0QOo5txs7K1MYuKpjzkI"</span><br>      crossorigin<span class="token operator">=</span><span class="token string">"anonymous"</span><br>    <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><br>    <span class="token operator">&lt;</span>script<span class="token operator">></span><br>      <span class="token keyword">let</span> ws<span class="token punctuation">;</span><br><br>      <span class="token keyword">function</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'attempting WebSocket connection'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:3001'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>        ws<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'WebSocket connection was opened'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>          ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello from client!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>        ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>          <span class="token keyword">const</span> received <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'received'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>          received<span class="token punctuation">.</span>textContent <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>        ws<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token parameter">error</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ws error:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>        ws<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'WebSocket connection was closed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token comment">// Attempt to reconnect after two seconds.</span><br>          <span class="token function">setTimeout</span><span class="token punctuation">(</span>connect<span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br><br>      <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      <span class="token keyword">function</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">// Either the client or the server can close the connection.</span><br>        <span class="token comment">// ws.send('stop'); // ask server to close the WebSocket</span><br>        ws<span class="token operator">?.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// close WebSocket from client</span><br>      <span class="token punctuation">}</span><br><br>      <span class="token keyword">function</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">const</span> form <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">;</span><br>        ws<span class="token operator">?.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        form<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span><br>  <span class="token operator">&lt;</span>body x<span class="token operator">-</span>data<span class="token operator">=</span><span class="token string">"{message: ''}"</span><span class="token operator">></span><br>    <span class="token operator">&lt;</span>h1<span class="token operator">></span>WebSockets Demo<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><br>    <span class="token operator">&lt;</span>form @submit<span class="token punctuation">.</span>prevent<span class="token operator">=</span><span class="token string">"send(event, message)"</span><span class="token operator">></span><br>      <span class="token operator">&lt;</span>label<span class="token operator">></span><br>        Message<br>        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> x<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"message"</span> <span class="token operator">/</span><span class="token operator">></span><br>      <span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span><br>      <span class="token operator">&lt;</span>button<span class="token operator">></span>Send<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span><br>    <span class="token operator">&lt;</span>div<span class="token operator">></span><br>      <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"close()"</span><span class="token operator">></span>Close WebSocket Connection<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br>    <span class="token operator">&lt;</span>fieldset<span class="token operator">></span><br>      <span class="token operator">&lt;</span>legend<span class="token operator">></span>Last Message Received<span class="token operator">&lt;</span><span class="token operator">/</span>legend<span class="token operator">></span><br>      <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"received"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>fieldset<span class="token operator">></span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span><br><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span></code></pre><p>The following server code uses Bun and the <a href="https://hono.dev?v=1.1.1" rel="noopener" target="_blank">Hono</a> framework. The client code remains the same.</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>Hono<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'hono'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span>Context<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'hono'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>serveStatic<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'hono/bun'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hono</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/*'</span><span class="token punctuation">,</span> <span class="token function">serveStatic</span><span class="token punctuation">(</span><span class="token punctuation">{</span>root<span class="token operator">:</span> <span class="token string">'./public'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/greet'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>c<span class="token operator">:</span> Context<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> c<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'Hello Bun!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> wsServer <span class="token operator">=</span> Bun<span class="token punctuation">.</span><span class="token function">serve</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token comment">// The WebSocket port defaults to 3000 which conflicts with the HTTP server.</span><br>  port<span class="token operator">:</span> <span class="token number">3001</span><span class="token punctuation">,</span><br>  <span class="token function">fetch</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> server<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Upgrade the request to support WebSockets.</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>server<span class="token punctuation">.</span><span class="token function">upgrade</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// no Response</span><br>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">'WebSockets upgrade failed'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>status<span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  websocket<span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token function">open</span><span class="token punctuation">(</span>ws<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'WebSocket is open.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token comment">// TODO: Why is this never called?</span><br>    <span class="token function">drain</span><span class="token punctuation">(</span>ws<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'WebSocket is ready to receive more data.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token function">message</span><span class="token punctuation">(</span>ws<span class="token punctuation">,</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">received "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token operator">===</span> <span class="token string">'stop'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        ws<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>        ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Thank you for sending "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">".</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token comment">// See WebSocket protocol status codes at</span><br>    <span class="token comment">// https://datatracker.ietf.org/doc/html/rfc6455#section-7.4</span><br>    <span class="token comment">// 1000 is normal closure.</span><br>    <span class="token comment">// 1005 is used when the client closes the WebSocket.</span><br>    <span class="token function">close</span><span class="token punctuation">(</span>ws<span class="token punctuation">,</span> code<span class="token punctuation">,</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'WebSocket closed with code'</span><span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">WebSocket closed with message "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'WebSocket server is listening on port'</span><span class="token punctuation">,</span> wsServer<span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> app<span class="token punctuation">;</span></code></pre><p>The following <code>package.json</code> file can be used to start the Bun server.</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"bun-websockets"</span><span class="token punctuation">,</span><br>  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span><br>  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"bun run --watch src/server.ts"</span><span class="token punctuation">,</span><br>    <span class="token property">"format"</span><span class="token operator">:</span> <span class="token string">"prettier --write '**/*.{css,html,js,ts,tsx}'"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"hono"</span><span class="token operator">:</span> <span class="token string">"^3.12.6"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"@types/bun"</span><span class="token operator">:</span> <span class="token string">"latest"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token property">"peerDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"typescript"</span><span class="token operator">:</span> <span class="token string">"^5.0.0"</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><h2 id="alternatives" tabindex="-1">Alternatives</h2><p>In scenarios where data only needs to be sent from servers to clients, consider using <a href="/blog/topics/#/blog/long-polling/" target="_blank">Long Polling</a>. or <a href="/blog/topics/#/blog/server-sent-events" target="_blank">Server-Sent Events</a>.</p></article>