<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Rust</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#installing">Installing</a></li><li><a href="#built-in-scalar-types">Built-in Scalar Types</a></li><li><a href="#built-in-compound-types">Built-in Compound Types</a></li><li><a href="#compiling-code">Compiling Code</a></li><li><a href="#formatting-code">Formatting Code</a></li><li><a href="#webassembly">WebAssembly</a></li></ol></nav></aside><article><p><img alt="Deno logo" style="width: 20%" src="/blog/assets/rust-logo.png" title="Rust logo"></p><h2 id="overview">Overview</h2><p><a href="https://www.rust-lang.org/" rel="noopener" target="_blank">Rust</a> is a programming language for building reliable and efficient software.</p><p>Features of Rust include:</p><ul><li>fast</li><li>memory-efficient</li><li>rich, static type system with type inference</li><li>ownership model to guarantee memory-safety and thread-safety</li></ul><h2 id="installing">Installing</h2><p>Rust is installed using the <a href="" rel="noopener" target="_blank">rustup</a> tool.</p><p>To install rustup in macOS, install <a href="" rel="noopener" target="_blank">homebrew</a> and then enter <code>brew install rustup</code>.</p><p>To install rustup in Linux (or macOS), enter the following command:</p><pre class="language-bash"><code class="language-bash"><span class="token function">curl</span> --proto <span class="token string">'=https'</span> --tlsv1.2 -sSf https://sh.rustup.rs <span class="token operator">|</span> <span class="token function">sh</span></code></pre><p>To install rustup in Windows, use <a href="https://chocolatey.org/" rel="noopener" target="_blank">Chocolately</a> or <a href="https://scoop.sh/" rel="noopener" target="_blank">Scoop</a>.</p><p>After installing rustup, enter <code>rustup-init</code>. This configures the use of Rust in the bash and zsh shells. When using the fish shell, add the following in <code>.config/fish/config.fish</code>:</p><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">set</span> -x <span class="token environment constant">PATH</span> <span class="token environment constant">$PATH</span> <span class="token environment constant">$HOME</span>/.cargo/bin</code></pre><p>Verify installation by entering <code>rustc --version</code>.</p><h2 id="built-in-scalar-types">Built-in Scalar Types</h2><p>Rust defines four scalar (primitive) types which are boolean, character, integer, and floating-point.</p><p>The boolean type name is <code>bool</code>. Its only values are <code>true</code> and <code>false</code>.</p><p>The character type name is <code>char</code>. Its values are Unicode values of up to four bytes. TODO: Does every character use all four bytes?</p><p>The signed integer type names are <code>i{n}</code> where <code>{n}</code> is the number of bits which can be 8, 16, 32, 64, 128 or <code>size</code> which corresponds to either 32 or 64 depending on the processor architecture. The default type for literal integers is <code>i32</code> regardless of the processor.</p><p>Literal integer values can use the underscore character to separate thousands, millions, and so on. For example, the population of the U.S. in 2020 was approximately 330_676_544. Hex values begin with <code>0x</code>, octal values begin with <code>0o</code>, and binary values begin with <code>0b</code>.</p><p>The unsigned integer types are the same, but start with <code>u</code> instead of <code>i</code>.</p><p>Floating-point type names are <code>f{n}</code> where <code>{n}</code> is 32 or 64. The default type for literal floats is <code>f64</code> regardless of the processor.</p><h2 id="built-in-compound-types">Built-in Compound Types</h2><p>Rust defines two compound (non-primitive) types which are tuple and array.</p><p>A tuple is a fixed-length list of values that can be of different types. The syntax for a tuple type is <code>(type1, type2, ...)</code>. The syntax for a tuple value is <code>(value1, value2, ...)</code>. Individual values can be accessed by index or destructuring.</p><p>For example:</p><pre class="language-rust"><code class="language-rust">TODO<span class="token punctuation">:</span> ADD THIS</code></pre><p>An array is a fixed-length list of values that have the same type. The syntax for an array type is <code>[type, length]</code>. The syntax for an array value is <code>[value1, value2, ...]</code>. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> rgb <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"green"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token comment">// A Rust string is a "compound collection", covered later.</span><br><span class="token keyword">let</span> sevens <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// same as [7, 7, 7, 7, 7]</span><br>```<br><br>Elements of an array can <span class="token keyword">be</span> accessed using<br>square brackets and zero<span class="token operator">-</span>based indexes<span class="token punctuation">.</span><br>For example<span class="token punctuation">,</span> `rgb<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>` is <span class="token string">"green"</span><span class="token punctuation">.</span><br><br>A vector is a variable<span class="token operator">-</span>length list of values<span class="token punctuation">.</span><br>TODO<span class="token punctuation">:</span> Do they all have the same <span class="token keyword">type</span><span class="token operator">?</span><br><br>## Collections<br><br>Rust defines three kinds of collections that hold a variable number of values<span class="token punctuation">.</span><br>These include strings<span class="token punctuation">,</span> vectors<span class="token punctuation">,</span> and hash maps<span class="token punctuation">.</span><br><br>Strings are collections of characters<span class="token punctuation">.</span><br>Vectors are collections of any kind of value<span class="token punctuation">.</span><br>Hash maps hold key<span class="token operator">/</span>value pairs <span class="token keyword">where</span> the keys and values can <span class="token keyword">be</span> any <span class="token keyword">type</span><span class="token punctuation">.</span><br><br>## Operators<br><br>Rust supports common operators including<span class="token punctuation">:</span><br><br><span class="token operator">-</span> arithmetic<span class="token punctuation">:</span> `<span class="token operator">+</span>`<span class="token punctuation">,</span> `<span class="token operator">-</span>`<span class="token punctuation">,</span> `\<span class="token operator">*</span>`<span class="token punctuation">,</span> `<span class="token operator">/</span>`<span class="token punctuation">,</span> `<span class="token operator">%</span>` <span class="token punctuation">(</span><span class="token keyword">mod</span><span class="token punctuation">)</span><br><br>## Variables<br><br>Variables are immutable by default<span class="token punctuation">.</span><br>For variables that hold non<span class="token operator">-</span>primitive values<span class="token punctuation">,</span><br>even their fields cannot <span class="token keyword">be</span> mutated<span class="token punctuation">.</span><br><br>The `<span class="token keyword">mut</span>` keyword marks a variable <span class="token keyword">as</span> mutable<span class="token punctuation">.</span><br><br>A variable declaration has the syntax `<span class="token keyword">let</span> name<span class="token punctuation">:</span> <span class="token keyword">type</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>`<br><span class="token keyword">where</span> the value is optional<span class="token punctuation">.</span><br>However<span class="token punctuation">,</span> a value must <span class="token keyword">be</span> assigned before the variable is referenced<span class="token punctuation">.</span><br>The colon and the <span class="token keyword">type</span> can <span class="token keyword">be</span> omitted <span class="token keyword">if</span> it can <span class="token keyword">be</span> inferred from the value<span class="token punctuation">.</span><br><br>## Conditional Logic<br><br>## Iteration<br><br>## Custom Types<br><br>## Traits<br><br>## Hello World<br><br>The following is a Rust Hello World program<span class="token punctuation">:</span><br><br>```rust<br><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Hello World!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h2 id="compiling-code">Compiling Code</h2><p>To compile a <code>.rs</code> file, enter <code>rustc {name}.rs</code>. This creates an executable with the same name and no file extension. For example <code>rustc hello.rs</code> creates <code>hello</code>. To run the executable, enter <code>./</code> followed by the name. For example, <code>./hello</code>.</p><h2 id="formatting-code">Formatting Code</h2><p>The most popular code formatting tool for Rust is <a href="" rel="noopener" target="_blank">rustfmt</a>. To install this, enter <code>cargo install rustfmt</code>. TODO: Is this installed by default by rustup?</p><p>To run it on all <code>.rs</code> files in the current directory, enter <code>rustfmt *.rs</code>.</p><h2 id="webassembly"><a name="webassembly">WebAssembly</a></h2><p>Tools for compiling Rust code to WebAssembly include <a href="https://rustwasm.github.io/wasm-pack/" rel="noopener" target="_blank">wasm-pack</a> and <a href="https://www.secondstate.io/articles/ssvmup/" rel="noopener" target="_blank">ssvmup</a> The last update to wasm-pack was on February 7, 2020, so this project may be abandoned. The ssvmup tool was inspired by wasm-pack and has explicit support for Deno.</p><p>To compile a <code>.rs</code> file to WebAssembly:</p><ol><li><p>Install ssvmup by entering the following command (one time only):</p><pre class="language-bash"><code class="language-bash"><span class="token function">curl</span> https://raw.githubusercontent.com/second-state/ssvmup/master/installer/init.sh -sSf <span class="token operator">|</span> <span class="token function">sh</span></code></pre></li><li><p>Create a new Rust library (referred to as a &quot;crate&quot;) by entering <code>cargo new --lib my-crate</code></p></li><li><p><code>cd my-crate</code></p></li><li><p>Edit <code>src/lib.rs</code> and add code there. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> wasm_bindgen<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span><br><br><span class="token attribute attr-name">#[wasm_bindgen]</span><br><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">factorial</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> u64<span class="token punctuation">)</span> <span class="token punctuation">-></span> u64 <span class="token punctuation">{</span><br>    <span class="token keyword">match</span> x <span class="token punctuation">{</span><br>        <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">=></span> <span class="token number">1</span><span class="token punctuation">,</span><br>        _ <span class="token operator">=></span> x <span class="token operator">*</span> <span class="token function">factorial</span><span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Edit the generated <code>Cargo.toml</code> file which is similar to a Node.js <code>package.json</code> file. For example:</p><pre class="language-toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">package</span><span class="token punctuation">]</span><br><span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">"my-crate"</span><br><span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"0.1.0"</span><br><span class="token key property">authors</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"R. Mark Volkmann &lt;me@gmail.com>"</span><span class="token punctuation">]</span><br><span class="token key property">edition</span> <span class="token punctuation">=</span> <span class="token string">"2018"</span><br><span class="token key property">description</span> <span class="token punctuation">=</span> <span class="token string">"sample project using ssvmup"</span><br><span class="token key property">license</span> <span class="token punctuation">=</span> <span class="token string">"MIT/Apache-2.0"</span><br><span class="token comment">#repository = "https://github.com/mvolkmann/my-crate"</span><br><br><span class="token punctuation">[</span><span class="token table class-name">lib</span><span class="token punctuation">]</span><br><span class="token key property">crate-type</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"cdylib"</span><span class="token punctuation">]</span><br><br><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><br><span class="token key property">wasm-bindgen</span> <span class="token punctuation">=</span> <span class="token string">"=0.2.61"</span></code></pre></li><li><p>Enter <code>ssvmup build --target deno</code><br>This creates a <code>pkg</code> directory containing <code>package.json</code>, a <code>.wasm</code> file, and a <code>.js</code> file that reads the <code>.wasm</code> file and prepares it for use in JavaScript code.</p></li><li><p>Copy the generated <code>pkg</code> directory to the directory containing the Deno code that wishes to use it.</p></li><li><p>Import the exported functions with a line like the following:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>factorial<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./pkg/my_crate.js'</span><span class="token punctuation">;</span></code></pre></li><li><p>Call the imported functions.</p><pre class="language-js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">factorial</span><span class="token punctuation">(</span><span class="token number">4n</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "n" suffix makes it BitInt</span></code></pre></li></ol></article>