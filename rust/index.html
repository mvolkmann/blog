<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Rust</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#why-use-rust">Why use Rust</a></li><li><a href="#why-use-another-programming-language">Why use another programming language</a></li><li><a href="#installing">Installing</a></li><li><a href="#learning-resources">Learning Resources</a></li><li><a href="#terminology">Terminology</a></li><li><a href="#rust-playground">Rust Playground</a></li><li><a href="#compiling-and-running">Compiling and Running</a></li><li><a href="#vs-code">VS Code</a></li><li><a href="#toml">TOML</a></li><li><a href="#cargo">Cargo</a></li><li><a href="#naming-conventions">Naming Conventions</a></li><li><a href="#syntax-highlights">Syntax Highlights</a></li><li><a href="#comments">Comments</a></li><li><a href="#attributes">Attributes</a></li><li><a href="#formatted-print">Formatted Print</a></li><li><a href="#variables">Variables</a></li><li><a href="#ownership-model">Ownership Model</a></li><li><a href="#lifetimes">Lifetimes</a></li><li><a href="#enums">Enums</a></li><li><a href="#error-handling">Error Handling</a></li><li><a href="#generics">Generics</a></li><li><a href="#built-in-types">Built-in Types</a><ol><li><a href="#built-in-scalar-types">Built-in Scalar Types</a></li><li><a href="#primitive-compound-types">Primitive Compound Types</a></li><li><a href="#collections">Collections</a><ol><li><a href="#strings">Strings</a></li><li><a href="#vectors">Vectors</a></li><li><a href="#sets">Sets</a></li><li><a href="#maps">Maps</a></li></ol></li></ol></li><li><a href="#slices">Slices</a></li><li><a href="#conditional-logic">Conditional Logic</a></li><li><a href="#iteration-(looping)">Iteration (Looping)</a></li><li><a href="#functions">Functions</a></li><li><a href="#iterators">Iterators</a></li><li><a href="#regular-expressions">Regular Expressions</a></li><li><a href="#operators">Operators</a></li><li><a href="#ranges">Ranges</a></li><li><a href="#structs">Structs</a></li><li><a href="#dereference">Dereference</a></li><li><a href="#type-aliases">Type Aliases</a></li><li><a href="#traits">Traits</a></li><li><a href="#macros">Macros</a></li><li><a href="#tests">Tests</a></li><li><a href="#standard-io">Standard IO</a></li><li><a href="#file-io">File IO</a></li><li><a href="#command-line-arguments">Command-line Arguments</a></li><li><a href="#modules">Modules</a></li><li><a href="#crates">Crates</a></li><li><a href="#creating-and-using-a-library">Creating and Using a Library</a></li><li><a href="#cross-compiling">Cross-compiling</a></li><li><a href="#smart-pointers">Smart Pointers</a></li><li><a href="#threads">Threads</a></li><li><a href="#futures-and-async%2Fawait">Futures and async/await</a></li><li><a href="#async-std">async-std</a></li><li><a href="#tokio">Tokio</a></li><li><a href="#standard-library">Standard Library</a></li><li><a href="#databases">Databases</a></li><li><a href="#sending-http-requests">Sending HTTP Requests</a></li><li><a href="#http-servers">HTTP Servers</a><ol><li><a href="#actix-web">Actix-web</a></li><li><a href="#rocket">Rocket</a></li><li><a href="#tide">Tide</a></li><li><a href="#warp">Warp</a></li></ol></li></ol></nav></aside><article><p><img alt="Rust logo" style="width: 20%" src="/blog/assets/rust-logo.png?v=1.1.1" title="Rust logo"> <img alt="Rust mascot" style="width: 30%" src="/blog/assets/rustacean-ferris-crab.png?v=1.1.1" title="Rust mascot, Ferris the crab"></p><h2 id="overview" tabindex="-1">Overview</h2><p><a href="https://www.rust-lang.org/?v=1.1.1" rel="noopener" target="_blank">Rust</a> is a programming language with the goal of &quot;empowering everyone to build reliable and efficient software.&quot;</p><p>Features of Rust include:</p><ul><li>performance on par with C/C++</li><li>memory-efficiency</li><li>ownership model that guarantees memory-safety and thread-safety</li><li>rich, static type system with type inference</li><li>targets <a href="https://llvm.org?v=1.1.1" rel="noopener" target="_blank">LLVM</a> to enable Rust programs to run on a wide variety of platforms</li><li>ability to call and be called by languages that support the C Application Binary Interface (ABI) with no overhead (includes C, C++, Go, Java, Python, and Ruby)</li><li>functional - Functions can be stored in variables, passed to functions, and returned from functions.</li><li>somewhat object-oriented - Structs can have fields and methods (like classes). These can be public or private, providing encapsulation. Structs can implement traits which are like interfaces. Traits can be used as types which achieves polymorphism. Structs can have fields whose types are other struct types which achieves composition, but they cannot inherit from other structs.</li><li>self-hosted (implemented in itself) since 2011</li></ul><p>Rust was created at Mozilla by Graydon Hoare, with contributions from Dave Herman, Brendan Eich, and others. It was formally announced in 2010. Version 1.0 was released in May 2015. A new point release is made every six weeks.</p><p>From <a href="https://doc.rust-lang.org/edition-guide/editions/?v=1.1.1" rel="noopener" target="_blank">rust-lang.org</a>, &quot;Every two or three years, we'll be producing a new edition of Rust. Each edition brings together the features that have landed into a clear package, with fully updated documentation and tooling.&quot;</p><p>The <a href="https://foundation.rust-lang.org?v=1.1.1" rel="noopener" target="_blank">Rust Foundation</a> was announced in February 2021. It is &quot;an independent non-profit organization to steward the Rust programming language and ecosystem.&quot; The initial member companies include AWS, Google, Huawei, Microsoft, and Mozilla.</p><p>Rust developers are referred to as &quot;Rustaceans&quot; which is derived from the word &quot;crustaceans&quot;. Rust mascot is Ferris the crab, a crustacean. The name is fitting because ferrous metals are subject to rust. Images of Ferris can be found at <a href="https://rustacean.net/?v=1.1.1" rel="noopener" target="_blank">rustacean.net</a>.</p><h2 id="why-use-rust" tabindex="-1">Why use Rust</h2><p><strong>Performance:</strong></p><p>The best way to get software performance is to use a &quot;systems&quot; language like C, C++, or Rust. One reason these languages are fast is because they do not provide automatic garbage collection, which is slow and can run at unpredictable times. Systems languages also allow control over whether data is on the stack (faster, but data must have a fixed size) or on the heap (slower, but data can vary in size).</p><p><strong>Safety:</strong></p><p>Software written in systems languages typically must take great care to avoid memory and threading issues. Memory issues include dangling pointers (accessing memory after it has been freed), memory leaks (failing to free memory that is no longer needed), and double frees (freeing memory more than once). These result in unpredictable behavior. Threading issues include race conditions where the order in which code runs is unpredictable, leading to somewhat random results. Rust addresses both of these issues, resulting in code that is less likely to contain bugs.</p><p><strong>Immutable by default:</strong></p><p>A large source of software errors involves incorrect assumptions about where data is modified. Making variables immutable by default and requiring explicit indication of functions that are allowed to modify data significantly reduces these errors.</p><p><strong>Ownership model:</strong></p><p>Manual garbage collection, where developers are responsibly for allocating and freeing memory, is error prone. Automatic garbage collection is relatively slow and requires runtime support which consumes memory. Rust does not use either form of garbage collection. It instead enforces an ownership model where code is explicit about the single scope that currently owns each piece of data. Unless ownership is transferred to another scope, when that scope ends the data is safely freed because no other scope can possibly be using the data. The &quot;borrow checker&quot; in the Rust compiler enforces this at compile time.</p><p><strong>Zero-Cost Abstractions:</strong></p><p>Rust strives for zero-cost abstractions characterized by this quote from Bjarne Stroustrup, the creator of C++: &quot;What you don't use, you don't pay for. And further: What you do use, you couldn't hand code any better.&quot; Rust supports many abstractions that make code more clear, but are optimized by the compiler so there is little to no impact on performance or the amount of machine code that is generated. One example is the use of generic functions that are compiled to separate versions for each concrete type with which they are used. This eliminates the need for runtime dynamic dispatch and is referred to as &quot;monomorphism&quot;.</p><p><strong>Control over number sizes:</strong></p><p>One way to achieve performance in computationally intensive tasks is to store collections of numbers in contiguous memory for fast access and specify the number of bytes used by each number. Rust supports a wide variety of number types for integer and floating point values of specific sizes.</p><p><strong>WebAssembly:</strong></p><p>WebAssembly (abbreviated WASM) is a binary instruction format for a stack-based virtual machine that is supported by modern web browsers (currently Chrome, Edge, Firefox, and Safari). WASM code typically executes faster than equivalent code written in JavaScript. Code from many programming languages can be compiled to WASM. In 2021 full support is only available for C, C++, and Rust. Experimental support is available for C#, Go, Java, Kotlin, Python, Swift, TypeScript, and a few other less commonly used languages.</p><p>In order to run WASM code in a web browser, the runtime of the source language must be included. Rust is a great choice for targeting WASM because it has a very small runtime compared to options like Python, so it downloads faster.</p><p><strong>Complexity Tradeoff</strong> Systems languages tend to be more complex that non-systems languages, requiring more time to learn and more time to write software in them. Rust is no exception. But many developers choose to use Rust in spite of this in order to gain the benefits described above. On the positive side, the Rust compiler catches many errors that would only be discovered at runtime with other systems languages. The Rust compiler also provides very detailed error messages that often include suggestions on how to correct the errors.</p><h2 id="why-use-another-programming-language" tabindex="-1">Why use another programming language</h2><p><strong>Not Performance Critical:</strong></p><p>If programming languages that provided automatic memory management (such as JavaScript/TypeScript, Python, and Go) are fast enough for the target application, and garbage collection pauses are not an issue, the effort required to learn and use Rust may be hard to justify. For many developers, this is the case for everything they write.</p><p><strong>Learning Curve:</strong></p><p>The learning curve for Rust is quite high. It may be too much effort to bring an entire team up to speed on using it. Just learning how to use strings in Rust is a challenge. Developers must constantly think about which scope &quot;owns&quot; each piece of data and decide whether values or references should be passed to functions. They must think about whether values have sizes that are known at compile-time. Generic types are used heavily (for example, in error handling), and often generic types are nested.</p><p><strong>Incompatible Libraries:</strong></p><p>If an application needs to use non-Rust libraries that are difficult to use from Rust, it may be better to use a more compatible programming language.</p><p><strong>Processor Target:</strong></p><p>If the target platform uses a processor type that is not a target of LLVM, Rust cannot currently produce code that will run on it.</p><p><strong>Compiler Speed:</strong></p><p>The Rust compiler is notoriously slow, but it has been getting faster. Slow compile times can negatively affect developer flow because they make it difficult to quickly try alternate coding approaches. The introduction of multiple companies participating in the newly formed &quot;Rust Foundation&quot; will likely lead to improvements in this area. Testing new and modified functions with unit tests rather than in the context of an application that uses them can reduce the time to test changes.</p><h2 id="installing" tabindex="-1">Installing</h2><p>It is recommended to install Rust using the <a href="https://github.com/rust-lang/rustup/blob/master/README.md?v=1.1.1" rel="noopener" target="_blank">rustup</a> tool. This enables having multiple versions of Rust installed and switching between them.</p><p>To install rustup in macOS:</p><ol><li>Install &quot;Command Line Tools for Xcode&quot; from <a href="https://developer.apple.com/downloads/more?v=1.1.1" rel="noopener" target="_blank">developer.apple.com</a> (requires a free Apple ID)</li><li>Install <a href="?v=1.1.1" rel="noopener" target="_blank">homebrew</a>.</li><li>Enter <code>brew install rustup</code></li></ol><p>Enter the following command to install rustup in Linux (or macOS):</p><pre class="language-bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">--proto</span> <span class="token string">'=https'</span> <span class="token parameter variable">--tlsv1.2</span> <span class="token parameter variable">-sSf</span> https://sh.rustup.rs <span class="token operator">|</span> <span class="token function">sh</span></code></pre><p>To install rustup in Windows, use <a href="https://chocolatey.org/?v=1.1.1" rel="noopener" target="_blank">Chocolately</a> or <a href="https://scoop.sh/?v=1.1.1" rel="noopener" target="_blank">Scoop</a>.</p><p>For more details, see <a href="https://forge.rust-lang.org/infra/other-installation-methods.html?v=1.1.1" rel="noopener" target="_blank">Other Rust Installation Methods</a>.</p><p>After installing rustup, enter <code>rustup-init</code>. This installs many toolchain items including <code>cargo</code> (build/run tool), <code>clippy</code> (linter), <code>rust-docs</code> (documentation), <code>rust-std</code> (standard library), <code>rustc</code> (compiler), and <code>rustfmt</code> (code formatter). It also configures the use of Rust in the bash and zsh shells. When using the fish shell, add the following in <code>.config/fish/config.fish</code>:</p><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">set</span> <span class="token parameter variable">-x</span> <span class="token environment constant">PATH</span> <span class="token environment constant">$PATH</span> <span class="token environment constant">$HOME</span>/.cargo/bin</code></pre><p>Verify the installation by entering <code>rustc --version</code> which should output the version of the <code>rustc</code> command that is installed.</p><p>Once installed, to update the versions of all the Rust tools enter <code>rustup update</code>.</p><h2 id="learning-resources" tabindex="-1">Learning Resources</h2><p>Resources for learning Rust include:</p><ul><li><p><a href="https://cheats.rs?v=1.1.1" rel="noopener" target="_blank">Rust Language Cheat Sheet</a></p></li><li><p><a href="https://docs.microsoft.com/en-us/learn/paths/rust-first-steps/?v=1.1.1" rel="noopener" target="_blank">Take your first steps with Rust</a> from Microsoft</p></li><li><p><code>rustup doc</code> command</p><p>This displays local documentation that is installed along with Rust in the default web browser. It can be read even when offline. This includes links to the following:</p><ul><li>API documentation<br>Tip: When reading API documentation, if a &quot;Go to latest version&quot; link appears in the page header, indicating you are not looking at the latest version of the documentation, click it to see the latest.</li><li>&quot;The Rust Programming Language&quot; book</li><li>&quot;Rust by Example&quot; book</li><li>&quot;The Rust Reference&quot; book which is more detailed than &quot;The Rust Programming Language&quot; book</li><li>&quot;The Cargo Book&quot; book</li><li>and much more</li></ul></li><li><p><a href="https://www.rust-lang.org/?v=1.1.1" rel="noopener" target="_blank">Rust website</a></p></li><li><p><a href="https://doc.rust-lang.org/book/?v=1.1.1" rel="noopener" target="_blank">The Rust Programming Language</a> book</p><p>This is a free, open source book. A print copy can be purchased from <a href="https://nostarch.com/Rust2018?v=1.1.1" rel="noopener" target="_blank">No Starch Press</a>.</p></li><li><p><a href="https://doc.rust-lang.org/stable/reference/?v=1.1.1" rel="noopener" target="_blank">The Rust Reference</a></p><p>This is &quot;the primary reference for the Rust programming language&quot;.</p></li><li><p><a href="https://rust-lang-nursery.github.io/rust-cookbook/?v=1.1.1" rel="noopener" target="_blank">Rust Cookbook</a></p><p>This is a &quot;collection of simple examples that demonstrate good practices to accomplish common programming tasks&quot;.</p></li><li><p><a href="https://doc.rust-lang.org/stable/rust-by-example/?v=1.1.1" rel="noopener" target="_blank">Rust by Example</a></p><p>This is a free, online set of examples in many categories.</p></li><li><p><a href="https://doc.rust-lang.org/std/index.html?v=1.1.1" rel="noopener" target="_blank">Rust Standard Library</a> API documentation</p></li><li><p><a href="https://www.oreilly.com/library/view/programming-rust-2nd/9781492052586/?v=1.1.1" rel="noopener" target="_blank">Programming Rust</a> book (O'Reilly)</p></li><li><p><a href="https://www.manning.com/livevideo/rust-in-motion?a_aid=cnichols&a_bid=6a993c2e?v=1.1.1" rel="noopener" target="_blank">Rust in Motion</a> video course (Manning)</p></li><li><p><a href="https://www.youtube.com/watch?v=Az3jBd4xdF4&list=PLLqEtX6ql2EyPAZ1M2_C0GgVd4A-_L4_5?v=1.1.1" rel="noopener" target="_blank">Doug Milford Rust Tutorial series</a> YouTube videos</p></li><li><p><a href="https://www.youtube.com/watch?v=WnWGO-tLtLA&t=2s?v=1.1.1" rel="noopener" target="_blank">Jon Gjengset Crust of Rust</a> YouTube videos</p></li><li><p><a href="https://www.youtube.com/watch?v=WnWGO-tLtLA&t=2s?v=1.1.1" rel="noopener" target="_blank">Ryan Levick Introduction to Rust</a> YouTube videos</p></li><li><p><a href="https://github.com/rust-lang/rustlings?v=1.1.1" rel="noopener" target="_blank">Rustlings</a></p><p>This &quot;contains small exercises to get you used to reading and writing Rust code&quot;.</p></li><li><p><a href="https://exercism.io/tracks/rust?v=1.1.1" rel="noopener" target="_blank">exercism Rust track</a></p><p>This provides &quot;code practice and mentorship for everyone&quot;. The exercism site includes exercises across 52 languages.</p></li><li><p><a href="https://github.com/ctjhoa/rust-learning?v=1.1.1" rel="noopener" target="_blank">rust-learning</a></p><p>This includes &quot;a bunch of links to blog posts, articles, videos, etc for learning Rust.&quot;</p></li></ul><h2 id="terminology" tabindex="-1">Terminology</h2><p>TODO: Add more terminology in this section? ownership, borrow checker, ...</p><ul><li><a href="#cargo">Cargo</a><ul><li>a command-line utility for building and running Rust programs</li></ul></li><li><a href="https://github.com/rust-lang/rust-clippy?v=1.1.1" rel="noopener" target="_blank">Clippy</a><ul><li>a code linter with over 400 checks for correctness, style, complexity, an performance</li></ul></li><li><a href="#crates">crate</a><ul><li>a Rust program (binary) or library</li><li>contains a tree of modules</li></ul></li><li><a href="https://crates.io/?v=1.1.1" rel="noopener" target="_blank">crates.io</a><ul><li>repository of Rust crates, similar to npm for JavaScript</li></ul></li><li><a href="#enums">enum</a><ul><li>a named type whose values come from a list of named variants</li><li>in Rust, these variants can have associated data</li><li>a key feature of Rust error handling</li></ul></li><li>future<ul><li>represents the result of an operation that will complete in the future, similar to a JavaScript <code>Promise</code></li></ul></li><li>generic<ul><li>a parameterized type that enables storing and using multiple types of data</li></ul></li><li>lifetime<ul><li>the time period during which a variable can be accesses, starting when it is created and ending when it is freed (a.k.a dropped)</li><li>often associated with the scope of a particular code block</li></ul></li><li><a href="#macros">macro</a><ul><li>a function-like construct whose name ends in <code>!</code> and generates code at compile-time</li></ul></li><li><a href="#modules">module</a><ul><li>a set of related values such as constants and functions</li></ul></li><li>package<ul><li><code>cargo</code> feature for building, testing, and sharing crates</li><li>a set of crates described by a <code>Cargo.toml</code> file</li><li>contains any number of binaries and 0 or 1 library</li></ul></li><li>panic<ul><li>represents an unrecoverable error that causes a program to terminate, print a stack trace, and print an error message</li></ul></li><li><a href="#structs">struct</a><ul><li>a named collection of fields similar to a class in other languages</li><li>can have associated functions and methods</li></ul></li><li><a href="#traits">trait</a><ul><li>a named collection of constants, function signatures, and optional default implementations</li><li>similar to interfaces in other languages</li></ul></li><li><a href="#toml">TOML</a><ul><li>a configuration file format used by Cargo</li><li>stands for Tom's Obvious, Minimal Language</li></ul></li></ul><h2 id="rust-playground" tabindex="-1">Rust Playground</h2><p>To try Rust code online, browse the <a href="https://play.rust-lang.org/?v=1.1.1" rel="noopener" target="_blank">Rust Playground</a>. This includes access to the top 100 most downloaded crates (libraries) from <a href="https://crates.io/?v=1.1.1" rel="noopener" target="_blank">crates.io</a> and crates from the <a href="https://rust-lang-nursery.github.io/rust-cookbook/?v=1.1.1" rel="noopener" target="_blank">Rust Cookbook</a>.</p><p>A good use for the Rust Playground is to copy code examples from this blog post into it and run them. Then make changes to the code to try variations and expand your knowledge.</p><p>The example code shown in the screenshot below will be more clear after structs and traits are explained.</p><p><img alt="Rust Playground" style="width: 100%" src="/blog/assets/rust-playground.png?v=1.1.1" title="Rust Playground"></p><p>All of the code must be entered in a single editor pane, simulating being in the single source file <code>main.rs</code>.</p><p>Press the ellipsis after the &quot;RUN&quot; button to open a popup with the following options:</p><ul><li>&quot;Run&quot; to build and run the code (<code>cargo run</code>)</li><li>&quot;Build&quot; to only build the code (<code>cargo build</code>)</li><li>&quot;Test&quot; to build the code and run the tests (<code>cargo test</code>)<br>Test functions must be preceded by <code>#[test]</code> and no <code>main</code> function can be present.</li><li>&quot;ASM&quot; to build the code and show the generated assembly code</li><li>&quot;LLVM IR&quot; to build the code and show the generated LLVM intermediate representation (IR)</li><li>&quot;MIR&quot; to build the code and show the generated mid-level intermediate representation (MIR)</li><li>&quot;WASM&quot; to build a WebAssembly module for use in web browsers</li></ul><p>The &quot;RUN&quot; button will change to the last selected option so it can be re-executed by simply pressing the button.</p><p>Press the &quot;DEBUG&quot; button to open a popup for choosing between &quot;Debug&quot; and &quot;Release&quot; build modes. A debug build completes in less time because it performs less optimization.</p><p>Press the &quot;STABLE&quot; button to open a popup for choosing a Rust version which can be &quot;Stable channel&quot; (default), &quot;Beta channel&quot;, or &quot;Nightly channel&quot;. The button text changes to indicate the selected version.</p><p>Press the ellipsis after the version button to open a popup with the following options:</p><ul><li>&quot;Edition&quot; sets the Rust edition to 2018 (default) or 2015</li><li>&quot;Backtrace&quot; to disable (default) or enable display of backtraces when a panic occurs which slows performance a bit.</li></ul><p>Press the &quot;SHARE&quot; button to open a panel on the right side containing the following links:</p><ul><li>&quot;Permalink to the playground&quot; changes the URL to one which will recall the current code, set to run with the currently selected version of Rust.</li><li>&quot;Direct link to the gist&quot; navigates to the URL of the GitHub Gist where the code is stored. The code can be viewed, but not executed from here.</li><li>&quot;Embed code in link&quot; changes the URL to one which includes a base 64 encoded copy of the code as a query parameter. This is only appropriate for small code samples due to URL length limits.</li><li>&quot;Open a new thread in the Rust user forum&quot; does what the link implies, making it easy to ask questions about a code sample. Use this frequently while learning!</li><li>&quot;Open an issue on the Rust GitHub repository&quot; makes it easy to report a bug in Rust.</li></ul><p>Press the &quot;TOOLS&quot; button to open a popup with the following options:</p><ul><li>&quot;Rustfmt&quot; formats the code using the <code>rustfmt</code> tool.</li><li>&quot;Clippy&quot; runs the Clippy code linter with over 400 checks for correctness, style, complexity, an performance.</li><li>&quot;Miri&quot; runs the program using the <a href="https://github.com/rust-lang/miri?v=1.1.1" rel="noopener" target="_blank">Miri interpreter</a> which is an experimental interpreter for Rust's mid-level intermediate representation (MIR). It can detect some bugs not detected by pressing the &quot;RUN&quot; button.</li><li>&quot;Expand macros&quot; displays the code in the right panel with all the macro calls expanded in order to see what they actually do. For example, try this with a <code>main</code> function that just calls the <code>println!</code> macro to print &quot;Hello&quot;.</li></ul><p>Press the &quot;CONFIG&quot; button to open a popup with the following options:</p><ul><li>&quot;Style&quot; enables switching between &quot;SIMPLE&quot; (no line numbers) and &quot;ADVANCED&quot; (line numbers).</li><li>&quot;Keybinding&quot; enables choosing between keybindings supported by the <a href="https://github.com/ajaxorg/ace?v=1.1.1" rel="noopener" target="_blank">Ace</a> (Cloud9) editor which is used by this tool. Options include ace, emacs, sublime, vim, and vscode.</li><li>&quot;Theme&quot; enables choosing between 30+ themes including cobalt, github, solarized light, solarized dark.</li><li>&quot;Pair Characters&quot; automatically inserts closing <code>)</code>, <code>}</code>, and <code>]</code> characters after the <code>(</code>, <code>{</code>, and <code>[</code> characters are typed.</li><li>&quot;Orientation&quot; enables choosing how panes are arranged. Options include Horizontal, Vertical, and Automatic which chooses based on window size.</li><li>Advanced options control generated assembly code.</li></ul><p>There doesn't seem to be a way to select a font for the code.</p><p>Configuration options are saved in browser Local Storage so they can be applied to future sessions. The most recently entered code is also saved in Local Storage, but previously entered code is not retained.</p><h2 id="compiling-and-running" tabindex="-1">Compiling and Running</h2><p>Rust source files have a <code>.rs</code> file extension.</p><p>Here are the steps to compile a Rust source file that defines a <code>main</code> function, create an executable with the same name and no file extension, and run the executable:</p><ul><li>open a terminal (or Windows Command Prompt),</li><li>cd to the directory containing the <code>.rs</code> file</li><li>enter <code>rustc name.rs</code></li><li>in macOS or Linux, enter <code>./name</code></li><li>in Windows, enter <code>name</code></li></ul><p>For example, the following is a Rust Hello World program:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Hello World!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>Calls to names that end in <code>!</code>, like <code>println!</code>, are calls to a <a href="#macros">macro</a> rather than a function.</p><p>Typically the <code>rustc</code> command is not used directly. Instead the <code>cargo</code> command, described in the <a href="#cargo">Cargo</a> section, is used to run <code>rustc</code> and the resulting executable.</p><h2 id="vs-code" tabindex="-1">VS Code</h2><p>If VS Code is being used to edit Rust code, there are two main extensions to consider: &quot;Rust&quot; and &quot;Rust-analyzer&quot;. Both offer similar features which include:</p><ul><li>syntax highlighting</li><li>code completion</li><li>code formatting</li><li>type documentation on hover</li><li>linting with error indicators and the ability to apply suggestions</li><li>code snippets</li><li>rename refactoring</li><li>debugging</li><li>running build tasks</li></ul><p>To enable Rust code formatting, add the following in <code>settings.json</code> where FORMATTER is &quot;rust-lang.rust&quot; for the Rust extension and &quot;matklad.rust-analyzer&quot; for the &quot;Rust-analyzer&quot; extension.</p><pre class="language-json"><code class="language-json">  <span class="token property">"[rust]"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"editor.defaultFormatter"</span><span class="token operator">:</span> FORMATTER<span class="token punctuation">,</span><br>    <span class="token property">"editor.insertSpaces"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>    <span class="token property">"editor.tabSize"</span><span class="token operator">:</span> <span class="token number">4</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><p>By default Rust-analyzer displays inferred types inline in code, which can be beneficial but is also verbose and distracting. This can be disabled in Settings by searching for &quot;rust analyzer&quot; and unchecking &quot;Rust-analyzer &gt; Inlay Hints: Type Hints&quot;. Inferred types can still be displayed by hovering over a variable.</p><p>These extensions only work properly if the root folder of a Rust project is opened and it contains a <code>Cargo.toml</code> file. See the <a href="#cargo">Cargo</a> section for details on creating this.</p><h2 id="toml" tabindex="-1"><a name="toml">TOML</a></h2><p><a href="https://github.com/toml-lang/toml?v=1.1.1" rel="noopener" target="_blank">TOML</a> is a configuration file format that maps to a hash table. The Rust Cargo tool uses this format for <code>Cargo.toml</code> configuration files.</p><p>Each key/value pair is described by a line with the syntax <code>key = value</code>. Keys are not surrounded by any delimiters.</p><p>Supported value data types include string, integer, float, boolean, datetime, array (an ordered list of values), and table (a collection of key/value pairs). String values are surrounded by double quotes. Datetime values have the format <code>yyyy-mm-ddThh:mm:ss</code>. The time portion can be omitted or be followed by a time zone which is <code>Z</code> for UTC or <code>+hh:mm</code> for a specific offset. Array elements are surrounded by square brackets and separated by commas.</p><p>Comments begin with the <code>#</code> character and extend to the end of the line.</p><p>Sections and sub-sections are indicated by lines containing a name enclosed in square brackets. Think of these like keys whose values are objects.</p><p>Here is the default <code>Cargo.toml</code> file that is created by the command <code>cargo new project-name</code> which we will learn about in the next section:</p><pre class="language-toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">package</span><span class="token punctuation">]</span><br><span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">"delete-me"</span><br><span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"0.1.0"</span><br><span class="token key property">authors</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"R. Mark Volkmann &lt;r.mark.volkmann@gmail.com>"</span><span class="token punctuation">]</span><br><span class="token key property">edition</span> <span class="token punctuation">=</span> <span class="token string">"2018"</span><br><br><span class="token comment"># See more keys and their definitions at</span><br><span class="token comment"># https://doc.rust-lang.org/cargo/reference/manifest.html</span><br><br><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span></code></pre><h2 id="cargo" tabindex="-1"><a name="cargo">Cargo</a></h2><p>The <code>cargo</code> command is a CLI tool that is installed with Rust. While using it is not required, it is highly recommended.</p><p>For help, enter <code>cargo --help</code> or just <code>cargo</code>.</p><p>The following table describes the <code>cargo</code> subcommands:</p><table><thead><tr><th>Subcommand</th><th>Description</th></tr></thead><tbody><tr><td><code>bench</code></td><td>runs benchmarks for the project which are special kinds of tests</td></tr><tr><td><code>build</code></td><td>builds the project in the <code>target</code> directory</td></tr><tr><td><code>check</code></td><td>verifies that the project builds successfully,<br>without generating code</td></tr><tr><td><code>clean</code></td><td>deletes the <code>target</code> directory</td></tr><tr><td><code>clippy</code></td><td>runs all project source files through the Clippy linter</td></tr><tr><td><code>doc</code></td><td>generates documentation for the current project</td></tr><tr><td><code>fmt</code></td><td>formats all project source files using <code>rustfmt</code></td></tr><tr><td><code>init</code></td><td>creates a new Rust project in the current directory</td></tr><tr><td><code>install</code></td><td>installs the project executable, by default in <code>~/.cargo/bin</code></td></tr><tr><td><code>new</code></td><td>creates a new Rust project in a new subdirectory</td></tr><tr><td><code>publish</code></td><td>publishes the project crate in the <a href="https://crates.io?v=1.1.1" rel="noopener" target="_blank">crates.io</a> registry</td></tr><tr><td><code>run</code> or <code>r</code></td><td>builds and runs the project</td></tr><tr><td><code>search <i>name</i></code></td><td>searches the <a href="https://crates.io?v=1.1.1" rel="noopener" target="_blank">crates.io</a> registry for matching crates</td></tr><tr><td><code>test</code> or <code>t</code></td><td>runs the project tests</td></tr><tr><td><code>uninstall</code></td><td>removes the project executable, by default from <code>~/.cargo/bin</code></td></tr><tr><td><code>update</code></td><td>updates dependencies in the <code>Cargo.lock</code> file</td></tr></tbody></table><p>The most commonly used <code>cargo</code> subcommands are described in more detail below.</p><p>The <code>cargo new</code> command creates a new directory containing a Rust project that is initialized as a new Git repository. It contains a <code>Cargo.toml</code> configuration file that specifies the project name, version, authors, the Rust edition to use, and a list of dependencies. The created directory also contains a <code>src</code> directory containing a single file. When the <code>--lib</code> switch is not included, the file is <code>main.rs</code> which is a simple hello world program. When the <code>--lib</code> switch is included, the file is <code>lib.rs</code> which contains a simple unit test.</p><p>In Node.js, project source files can use dependencies listed in their <code>package.json</code> file AND also their dependencies recursively. But Rust project source files can only use dependencies listed in their <code>Cargo.toml</code> file. This has the benefit that a dependency can drop one of its dependencies without breaking apps that use it because a Rust application or library must explicitly list all of its dependencies.</p><p>The <code>cargo run</code> command builds and runs the project. It also downloads dependencies listed in the <code>Cargo.toml</code> file, and their dependencies recursively, that have not yet been downloaded. This command can be slow when run for the first time in a new project or if new dependencies have been added since the last time it was run.</p><p>To pass command-line arguments to a program, specify them after <code>--</code>.<br>For example, <code>cargo run -- arg1 arg2</code></p><p>To watch project files for changes and automatically run a <code>cargo</code> command when they do, enter <code>cargo install cargo-watch</code> one time and then enter <code>cargo watch -x <i>subcommand</i></code>. If the <code>-x</code> option is omitted, the subcommand defaults to <code>check</code>, not <code>run</code>. Typically the desired subcommand is <code>run</code>.</p><p>The <code>cargo build</code> command creates a non-optimized executable in the <code>target/debug</code> directory. To create an optimized, production build, enter <code>cargo build --release</code> which creates an executable in the <code>target/release</code> directory.</p><h2 id="naming-conventions" tabindex="-1">Naming Conventions</h2><p>In general, names of types use <code>PascalCase</code> and names of values use <code>snake_case</code>. The compiler outputs warnings when the naming conventions described in the table below are not followed.</p><table><thead><tr><th>Item</th><th>Naming Convention</th></tr></thead><tbody><tr><td>constants</td><td><code>SCREAMING_SNAKE_CASE</code></td></tr><tr><td>constructor functions</td><td><code>snake_case</code></td></tr><tr><td>crates</td><td><code>snake_case</code> or <code>kebab-case</code></td></tr><tr><td><a href="https://doc.rust-lang.org/cargo/reference/features.html?v=1.1.1" rel="noopener" target="_blank">crate features</a></td><td>no convention</td></tr><tr><td>enums</td><td><code>PascalCase</code></td></tr><tr><td>enum variants</td><td><code>PascalCase</code></td></tr><tr><td>file names</td><td><code>snake_case</code> or <code>kebab-case</code></td></tr><tr><td>functions</td><td><code>snake_case</code></td></tr><tr><td>lifetimes</td><td><code>'lowercase</code></td></tr><tr><td>macros</td><td><code>snake_case!</code></td></tr><tr><td>methods</td><td><code>snake_case</code></td></tr><tr><td>modules</td><td><code>snake_case</code></td></tr><tr><td>statics</td><td><code>SCREAMING_SNAKE_CASE</code></td></tr><tr><td>structs</td><td><code>PascalCase</code></td></tr><tr><td>traits</td><td><code>PascalCase</code></td></tr><tr><td>type parameters (generics)</td><td><code>PascalCase,</code> but usually one letter</td></tr><tr><td>type aliases</td><td><code>PascalCase</code></td></tr><tr><td>variables</td><td><code>snake_case</code></td></tr></tbody></table><h2 id="syntax-highlights" tabindex="-1">Syntax Highlights</h2><ul><li>Rust prefers short keywords. Examples include <code>const</code> for constant, <code>fn</code> for function, <code>i<i>size</i></code> for integer types, <code>impl</code> for implement, <code>let</code> for variable declarations, <code>mod</code> for module, <code>mut</code> for mutable, <code>pub</code> for public, <code>u<i>size</i></code> for unsigned integer types, and <code>use</code> for imports.</li><li>Strings are delimited by double quotes.</li><li>Single characters are delimited by single quotes.</li><li>Items (like functions, structs, and struct members) are made public using the <code>pub</code> keyword.</li><li>A dot (<code>.</code>) character is used to access struct fields and call instance methods.</li><li>A double colon (<code>::</code>) is used as a namespace separator (borrowed from C++) and to call &quot;associated functions&quot; (like class or static methods in other languages).</li><li>Conditions for conditional logic and iteration are not surrounded by any delimiter (no parentheses).</li><li>Statements associated with conditional logic and iteration must be in blocks surrounded by curly braces.</li><li>The preferred indentation is four spaces.</li><li>Named functions are declared with the <code>fn</code> keyword.</li><li>Function return types follow the parameter list and the characters <code>-&gt;</code>.</li><li>Functions that return nothing omit <code>-&gt;</code> and the return type.</li><li>Statements must terminated by a semicolon.</li><li>If the last evaluated expression in a function does not end with a semicolon, its value is returned.</li><li>Most statements are also expressions and evaluate to a value, including the <code>if</code> and <code>match</code> statements.</li><li>There is no null type or value. Instead the <code>Option</code> enum <code>None</code> variant used.</li></ul><h2 id="comments" tabindex="-1">Comments</h2><p>Rust supports regular comments and &quot;doc comments&quot;.</p><table><thead><tr><th>Syntax</th><th>Usage</th></tr></thead><tbody><tr><td><code>//</code></td><td>extends to end of current line</td></tr><tr><td><code>/* ... */</code></td><td>can span multiple lines</td></tr><tr><td><code>///</code></td><td>doc comment preceding the item it describes</td></tr><tr><td><code>//!</code></td><td>doc comment inside the block of the item it describes</td></tr></tbody></table><p>&quot;Doc comments&quot; are included in HTML documentation that is generated by entering <code>cargo doc</code>. This creates the directory <code>target/doc/<i>crate-name</i></code> and writes HTML for the documentation there.</p><p>To generate the documentation and open it in the default browser, enter <code>cargo doc --open</code>. Optionally add the <code>--no-deps</code> flag to avoid building documentation for crate dependencies.</p><p>Doc comments optionally include sections with titles that begin with <code>#</code>. Common sections include:</p><ul><li><p><code># Examples</code></p><p>This section provides code examples in Markdown fences. It is especially useful to demonstrate calls to functions and methods. For library crates (not for binary crates) this code is executed along with other test code by the <code>cargo test</code> and <code>rustdoc --test</code> commands.</p></li><li><p><code># Errors</code></p><p>This section describes any errors that can be returned by the code in a <code>Result</code> enum which has <code>Ok</code> and <code>Err</code> variants.</p></li><li><p><code># Panics</code></p><p>This section describes scenarios that can cause the code to panic.</p></li><li><p><code># Safety</code></p><p>For functions marked as <code>unsafe</code>, this section explains why. It also describes what callers must do to use it safely.</p></li></ul><p>Let's walk through a simple example of code that includes a doc comment with an &quot;Examples&quot; section. The <code>vec!</code> macro, <code>iter</code> method, and <code>sum</code> method are described in more detail later. For now all you need to know is that the <code>vec!</code> macro creates a list of values, the <code>iter</code> method returns an iterator over the values, and the <code>sum</code> method adds all the values provided by the iterator. In this case all the values have the type <code>f64</code> which is an 8-byte floating point value.</p><ol><li><p>Create a library project by entering <code>cargo new math --lib</code>.</p></li><li><p>Edit the file <code>src/lib.rs</code> and replace its content the following:</p><pre class="language-rust"><code class="language-rust"><span class="token comment">/// # Examples</span><br><span class="token comment">///</span><br><span class="token comment">/// ```</span><br><span class="token comment">/// let numbers = vec![1.0, 2.0, 3.0, 4.0];</span><br><span class="token comment">/// assert_eq!(math::average(&amp;numbers), 2.5);</span><br><span class="token comment">/// ```</span><br><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">average</span><span class="token punctuation">(</span>numbers<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">f64</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f64</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> sum<span class="token punctuation">:</span> <span class="token keyword">f64</span> <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    sum <span class="token operator">/</span> numbers<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">f64</span> <span class="token comment">// return value</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Run the doc comment examples as tests by entering <code>cargo test</code>.</p></li></ol><h2 id="attributes" tabindex="-1"><a name="attributes">Attributes</a></h2><p>Rust attributes are like &quot;decorators&quot; in other programming languages. They annotate an item in order to change its behavior. An attribute can be specified immediately before an item with the syntax <code>#[attr]</code>, inside the block of an item with the syntax <code>#![attr]</code>, or at the top level of a source file. When used at the top level, <code>#![attr]</code> specifies a crate-wide attribute.</p><p>The following table summarizes commonly used built-in attributes.</p><table><thead><tr><th>Attribute</th><th>Description</th></tr></thead><tbody><tr><td><code>allow(warning1, warning2, ...)</code></td><td>suppresses the specified linting rule warnings</td></tr><tr><td><code>derive(name1, name2, ...)</code></td><td>automatically implements traits or<br>applies &quot;derive macros&quot;, often on a <code>struct</code></td></tr><tr><td><code>doc</code></td><td>provides an alternate way to specify and format doc comments</td></tr><tr><td><code>should_panic</code></td><td>indicates that a test function is expected to panic</td></tr><tr><td><code>test</code></td><td>indicates that a function is a test</td></tr></tbody></table><p>For a list of linting rules that produce warnings, see <a href="https://doc.rust-lang.org/rustc/lints/listing/warn-by-default.html?v=1.1.1" rel="noopener" target="_blank">Warn-by-default lints</a>. Examples include <code>dead_code</code>, <code>unreachable_code</code>, <code>unused_assignment</code>, <code>unused_imports</code>, and <code>unused_variables</code>. These warnings can be disabled using the <code>allow</code> attribute.</p><p>The <a href="#trait-table">table of provided traits</a> in the &quot;Traits&quot; section indicates those can be automatically implemented using the <code>derive</code> attribute. For more detail, see <a href="https://doc.rust-lang.org/rust-by-example/trait/derive.html?v=1.1.1" rel="noopener" target="_blank">Derive</a>.</p><p>For more built-in attributes, see the list in &quot;The Rust Reference&quot; at <a href="https://doc.rust-lang.org/reference/attributes.html#built-in-attributes-index?v=1.1.1" rel="noopener" target="_blank">Attributes</a>.</p><p>Custom attributes can be implemented by defining <a href="https://doc.rust-lang.org/book/ch19-06-macros.html#attribute-like-macros?v=1.1.1" rel="noopener" target="_blank">attribute-like macros</a>.</p><h2 id="formatted-print" tabindex="-1">Formatted Print</h2><p>The <code>std</code> namespace, pronounced &quot;stood&quot;, defines many commonly used values. The <code>std::fmt</code> namespace defines macros that format text.</p><table><thead><tr><th>Macro Name</th><th>Description</th></tr></thead><tbody><tr><td><code>print!</code></td><td>writes to stdout</td></tr><tr><td><code>println!</code></td><td>same as <code>print!</code>, but adds a newline</td></tr><tr><td><code>eprint!</code></td><td>writes to stderr</td></tr><tr><td><code>eprintln!</code></td><td>same as <code>eprint!</code>, but adds a newline</td></tr><tr><td><code>format!</code></td><td>writes to a <code>String</code></td></tr></tbody></table><p>All of these macros take a formatting string followed by zero or more expressions whose values are substituted into the formatting string where occurrences of <code>{}</code> appear. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{} is {}."</span><span class="token punctuation">,</span> <span class="token string">"Rust"</span><span class="token punctuation">,</span> <span class="token string">"interesting"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Rust is interesting.</span></code></pre><p>To print a representation of a value for debugging purposes on a single line, use <code>{:?}</code>. To print each field of a struct on separate lines, use <code>{:#?}</code>. Custom structs must implement the <code>Debug</code> trait in order to use these. The easiest way to do this is to add the attribute <code>#[derive(Debug)]</code> before struct definitions.</p><p>The following table summarizes what each of the supported format arguments produce.</p><table><thead><tr><th>Format Argument</th><th>Description</th></tr></thead><tbody><tr><td><code>{}</code></td><td>value of next argument</td></tr><tr><td><code>{:?}</code></td><td>debugging value on single line</td></tr><tr><td><code>{:#?}</code></td><td>debugging value on multiple lines</td></tr><tr><td><code>{n}</code></td><td>value of argument at zero-based index n</td></tr><tr><td><code>{name}</code></td><td>value with a given name</td></tr><tr><td><code>{:.n}</code></td><td>number with <code>n</code> decimal places</td></tr><tr><td><code>{:.*}</code></td><td>number with specified number of decimal places</td></tr><tr><td><code>{:#X}</code></td><td>number as uppercase hexadecimal</td></tr><tr><td><code>{:#x}</code></td><td>number as lowercase hexadecimal</td></tr><tr><td><code>{:&lt;n}</code></td><td>value left justified in a width of n</td></tr><tr><td><code>{:&gt;n}</code></td><td>value right justified in a width of n</td></tr><tr><td><code>{:^n}</code></td><td>value centered in a width of n</td></tr></tbody></table><p>Here are some examples:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{} {}"</span><span class="token punctuation">,</span> n <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> n <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6, 9</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{2} {1}"</span><span class="token punctuation">,</span> n <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> n <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 9, 6</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{double} {triple}"</span><span class="token punctuation">,</span> double <span class="token operator">=</span> n <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> triple <span class="token operator">=</span> n <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6 9</span><br><br><span class="token attribute attr-name">#[derive(Debug)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Point2D</span> <span class="token punctuation">{</span><br>    x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br>    y<span class="token punctuation">:</span> <span class="token keyword">f64</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// constructs a struct instance</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Point2D { x: 1.0, y: 2.0 }</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:#?}"</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// Point2D {</span><br><span class="token comment">//     x: 1.0,</span><br><span class="token comment">//     y: 2.0,</span><br><span class="token comment">// }</span><br><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{1} {0} {2} {1}"</span><span class="token punctuation">,</span> <span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"green"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// green red blue green</span><br><br><span class="token macro property">println!</span><span class="token punctuation">(</span><br>    <span class="token string">"{red} {green} {blue}"</span><span class="token punctuation">,</span><br>    blue<span class="token operator">=</span><span class="token string">"00F"</span><span class="token punctuation">,</span> green<span class="token operator">=</span><span class="token string">"0F0"</span><span class="token punctuation">,</span> red<span class="token operator">=</span><span class="token string">"F00"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// F00 0F0 00F</span><br><br><span class="token keyword">let</span> pi <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token keyword">f64</span><span class="token punctuation">::</span><span class="token namespace">consts<span class="token punctuation">::</span></span><span class="token constant">PI</span><span class="token punctuation">;</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:.4}"</span><span class="token punctuation">,</span> pi<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3.1416</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:.*}"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> pi<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3.1416</span><br><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:#X}"</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0xF</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:#x}"</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0xf</span><br><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"A{:&lt;5}Z"</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// A123  Z</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"A{:>5}Z"</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// A  123Z</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"A{:^5}Z"</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// A 123 Z</span></code></pre><p>Here is an example of customizing the way a struct is formatted as a string:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>fmt<span class="token punctuation">;</span><br><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Point2D</span> <span class="token punctuation">{</span><br>    x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br>    y<span class="token punctuation">:</span> <span class="token keyword">f64</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Display</span> <span class="token keyword">for</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Using "self" as the name of the first parameter makes this a method.</span><br>    <span class="token comment">// The second parameter "fmt" must be a mutable reference.</span><br>    <span class="token comment">// This method renders a value with the type "fmt::Result".</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> formatter<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Formatter</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Result</span> <span class="token punctuation">{</span><br>        <span class="token macro property">write!</span><span class="token punctuation">(</span>formatter<span class="token punctuation">,</span> <span class="token string">"(x:{}, y:{})"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> pt <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1.2</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">3.4</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> pt<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (x:1.2, y:3.4)</span><br><span class="token punctuation">}</span></code></pre><p>For more formatting options, see <a href="https://doc.rust-lang.org/std/fmt/?v=1.1.1" rel="noopener" target="_blank">std::fmt</a>.</p><h2 id="variables" tabindex="-1"><a name="variables">Variables</a></h2><p>Rust variables are immutable by default. For variables that hold non-primitive values such as arrays, tuples, and structs, even their elements/fields cannot be mutated.</p><p>The <code>mut</code> keyword marks a variable or parameter as mutable. For variables that hold non-primitive values such as arrays, tuples, and structs, the variable can be changed to point to a different value AND their elements/fields can be mutated.</p><p>A variable declaration has the syntax <code>let[ mut] name[: <i>type</i>][ = <i>value</i>];</code> where optional parts are surrounded by square brackets. The colon and type can be omitted if the desired type can be inferred from the value. A value must be assigned before the variable is referenced. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Point2D</span> <span class="token punctuation">{</span><br>    x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br>    y<span class="token punctuation">:</span> <span class="token keyword">f64</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> p<span class="token punctuation">:</span> <span class="token class-name">Point2D</span> <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// can assign in declaration</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"p = {:?}"</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Point2D { x: 1.0, y: 2.0 }</span><br><br>    <span class="token keyword">let</span> p<span class="token punctuation">:</span> <span class="token class-name">Point2D</span><span class="token punctuation">;</span> <span class="token comment">// shadows previous declaration (described later)</span><br>    p <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// can assign after declaration</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"p = {:?}"</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Point2D { x: 1.0, y: 2.0 }</span><br>    <span class="token comment">//p = Point2D { x: 1.2, y: 3.4 }; // cannot change value</span><br>    <span class="token comment">//p.x = 5.6; // cannot change a field in current value</span><br><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> p <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"p = {:?}"</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Point2D { x: 1.0, y: 2.0 }</span><br>    p <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1.2</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">3.4</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// can change value</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"p = {:?}"</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Point2D { x: 1.2, y: 3.4 }</span><br>    p<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">5.6</span><span class="token punctuation">;</span> <span class="token comment">// can change a field in current value</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"p = {:?}"</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Point2D { x: 5.6, y: 3.4 }</span><br><span class="token punctuation">}</span></code></pre><p>There are five ways to declare a variable.</p><table><thead><tr><th>Syntax</th><th>Meaning</th></tr></thead><tbody><tr><td><code>let name: type = value;</code></td><td>immutable variable that must be assigned a value<br>before it is used</td></tr><tr><td><code>let mut name: type = value;</code></td><td>mutable variable that must be assigned a value<br>before it is used and can be modified</td></tr><tr><td><code>const name: type = value;</code></td><td>constant that must be assigned a compile-time expression<br>when it is declared, not the result of a function call</td></tr><tr><td><code>static name: type = value;</code></td><td>immutable variable that lives for the duration of the program</td></tr><tr><td><code>static mut name: type = value;</code></td><td>mutable variable that lives for the duration of the program;<br>can only access in <code>unsafe</code> blocks and functions</td></tr></tbody></table><p>Variables defined with <code>static</code> are given a fixed location in memory and all references refer to the value at that location. Their <a href="#lifetimes">lifetime</a> is <code>'static</code> which is the duration of the program.</p><p>Variables defined with <code>const</code> do not have a location in memory. The compiler substitutes their value where all references appear, so the variable doesn't exist at runtime. In that sense they do not have a lifetime.</p><p>Declarations of <code>const</code> and <code>static</code> variables must be explicitly typed, rather than inferring a type based on the assigned value. One rationale is that because their scope can extend to the entire crate, it is better to be explicit about the desired type.</p><p>Constants can be defined using either <code>const</code> or <code>static</code>. Using <code>static</code> is preferred for values that are larger than a pointer. This is because the value of a <code>const</code> variable is copied everywhere it is used, unlike the value of a <code>static</code> variable that is shared. In order to assign <code>static</code> variables to other variables, their type must implements the <code>Copy</code> trait because the assignment requires copying. All of the scalar types like <code>bool</code>, <code>char</code>, <code>i32</code>, and <code>f64</code> implement the <code>Copy</code> trait.</p><p>Here are examples of using <code>const</code> and <code>static</code> variables:</p><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Color</span> <span class="token punctuation">{</span><br>    r<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span><br>    g<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span><br>    b<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><span class="token keyword">const</span> <span class="token constant">PURPLE_C</span><span class="token punctuation">:</span> <span class="token class-name">Color</span> <span class="token operator">=</span> <span class="token class-name">Color</span> <span class="token punctuation">{</span> r<span class="token punctuation">:</span> <span class="token number">255</span><span class="token punctuation">,</span> g<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token number">255</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">static</span> <span class="token constant">PURPLE_S</span><span class="token punctuation">:</span> <span class="token class-name">Color</span> <span class="token operator">=</span> <span class="token class-name">Color</span> <span class="token punctuation">{</span> r<span class="token punctuation">:</span> <span class="token number">255</span><span class="token punctuation">,</span> g<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token number">255</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">static</span> <span class="token keyword">mut</span> <span class="token constant">SIZE</span><span class="token punctuation">:</span> <span class="token keyword">u8</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> <span class="token constant">PURPLE_C</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Color { r: 255, g: 0, b: 255 }</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> <span class="token constant">PURPLE_S</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Color { r: 255, g: 0, b: 255 }</span><br>    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token constant">PURPLE_C</span><span class="token punctuation">;</span> <span class="token comment">// allowed</span><br>    <span class="token comment">//let v = PURPLE_S; // error: cannot move out of static item</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Color { r: 255, g: 0, b: 255 }b</span><br><br>    <span class="token keyword">unsafe</span> <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token constant">SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span><br>        <span class="token function">change_it</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token function">use_it</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">unsafe</span> <span class="token keyword">fn</span> <span class="token function-definition function">change_it</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token constant">SIZE</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// mutates "static mut" variable</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">unsafe</span> <span class="token keyword">fn</span> <span class="token function-definition function">use_it</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token constant">SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span><br><span class="token punctuation">}</span></code></pre><p>To print the type of a variable for debugging purposes, define the following function and pass a reference to it:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">print_type</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">(</span>_<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// The syntax ::&lt;T> is referred to as the "turbofish" qualifier.</span><br>    <span class="token comment">// It specifies a type in the middle of an expression.</span><br>    <span class="token comment">// In this case it is a generic type.:</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token namespace">std<span class="token punctuation">::</span>any<span class="token punctuation">::</span></span><span class="token function">type_name</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token number">19</span><span class="token punctuation">;</span><br>    <span class="token function">print_type</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// i32</span><br><span class="token punctuation">}</span></code></pre><p>Rust allows variables to be re-declared with a different type in the same block. This is referred to as &quot;shadowing&quot;. Sometimes this is preferred over coming up with multiple names for the same concept. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> command <span class="token operator">=</span> <span class="token string">"order 3 tacos"</span><span class="token punctuation">;</span> <span class="token comment">// &amp;str</span><br><br><span class="token comment">// The str split_whitespace method returns an Iterator.</span><br><span class="token comment">// The Iterator nth method returns an Option</span><br><span class="token comment">// whose value can be obtained in many ways.</span><br><span class="token comment">// One way is to call unwrap_or, passing it</span><br><span class="token comment">// a value to return if no value is found.</span><br><span class="token keyword">let</span> quantity <span class="token operator">=</span> command<span class="token punctuation">.</span><span class="token function">split_whitespace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nth</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap_or</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &amp;str</span><br><br><span class="token comment">// Parse the string value to create an i32 value.</span><br><span class="token keyword">let</span> quantity <span class="token operator">=</span> quantity<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap_or</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">if</span> quantity <span class="token operator">></span> <span class="token number">2</span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"You must be very hungry!"</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Perhaps you don't really like tacos."</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre><h2 id="ownership-model" tabindex="-1"><a name="ownership-model">Ownership Model</a></h2><p>Memory management in Rust is handled by following these rules, referred to as the ownership model:</p><ol><li>Each value is referred to by a variable that is its owner.</li><li>Each value has one owner at a time, but the owner can change over its lifetime.</li><li>When the owner variable goes out of the scope, the value is dropped (freed).</li></ol><p>The ownership model provides the following benefits:</p><ul><li>Runtime speed is achieved by eliminating the need for a garbage collector (GC).</li><li>Performance is more predictable because there are no GC pauses.</li><li>Memory access is safer since there is no possibility of null pointer accesses or dangling pointer accesses (accessing memory that has already been freed).</li><li>Parallel and concurrent processing is safer because there is no possibility of data races causing unpredictable interactions between threads.</li></ul><p>Values are stored either in the stack or the heap. Accessing stack data is faster, but data on the heap can grow and shrink, and it can live beyond the scope that created it.</p><p>Values whose sizes are known at compile time are stored on the stack. Values of all other types are stored in the heap. The documentation for types whose size is not known at compile time indicates this with <code>?Sized</code>. These include:</p><ul><li>slices, not references to them</li><li>string slice types <code>str</code> and <code>OsStr</code></li><li><code>std::path::Path</code> for representing and operating on file system paths</li><li>trait objects (<code>dyn <i>TraitName</i></code>)</li><li>structs and tuples for which the last field/item has one of these types</li></ul><p>Values of types whose sizes are not known at compile time can be stored on the heap by using the <code>Box</code> type. This provides a fixed size way to refer to a value that does not have a fixed size. An example is returning an error struct whose specific type is selected at run time based on the kind of error that occurs. Another example is a recursive type such as linked list.</p><aside>Sometimes Rust chooses to stores `&str` values on the stack but you cannot control that, so it's best to think of them as always being on the heap.</aside><p>All code blocks are delimited by a pair of curly braces and create a new scope. Variables declared in each new scope add data to the stack that is freed when that scope exits. Many keywords have an associated block, including <code>fn</code>, <code>if</code>, <code>loop</code>, <code>for</code>, and <code>while</code>.</p><p>The <code>Drop</code> trait can be implemented for any type to specify code to execute (in the <code>drop</code> method) when data of that type is dropped.</p><p>While it is not typically called directly, <code>std::mem::drop</code> is a function that can be called to explicitly free the memory owned by a variable before it goes out of scope.</p><p>The following table summarizes the options for assigning a variable to another or passing a variable an argument to a function.</p><table><thead><tr><th>Goal</th><th>Syntax</th></tr></thead><tbody><tr><td>transfer ownership</td><td><code>name</code></td></tr><tr><td>copy</td><td><code>name</code></td></tr><tr><td>borrow immutably</td><td><code>&amp;name</code></td></tr><tr><td>borrow mutably</td><td><code>&amp;mut name</code></td></tr></tbody></table><p>The difference between the first and second cases is entirely based on whether the type of the data implements the <code>Copy</code> trait.</p><p>Having all of these options requires considering the following questions for every variable being passed to a function or assigned to another variable:</p><ol><li>Do I want to transfer ownership? Often the answer is &quot;no&quot;.</li><li>Does the receiver need to modify the value? Often the answer is &quot;no&quot;.</li><li>Do I want to avoid making a copy for efficiency? Often the answer is &quot;yes&quot;.</li><li>If I want to pass a copy, will one be made automatically or do I need to explicitly clone it?</li></ol><p>Here are some examples that demonstrate ownership inside a single function. See the <a href="#strings">Strings</a> section for more detail on the differences between the <code>String</code> and <code>&amp;str</code> types.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Because a has a scalar type (fixed size) that implements the Copy trait,</span><br>    <span class="token comment">// this makes a copy of a and assigns that to b</span><br>    <span class="token comment">// rather than moving ownership from a to b.</span><br>    <span class="token comment">// Both a and b can then be used.</span><br>    <span class="token keyword">let</span> b <span class="token operator">=</span> a<span class="token punctuation">;</span><br><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span><br><br>    <span class="token comment">// This creates a String instance from a &amp;str value.</span><br>    <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Because c is on the heap and String does not implement</span><br>    <span class="token comment">// the Copy trait, this moves ownership from c to d</span><br>    <span class="token comment">// and c can no longer be used.</span><br>    <span class="token keyword">let</span> d <span class="token operator">=</span> c<span class="token punctuation">;</span><br><br>    <span class="token comment">//println!("c = {}", c); // error: value borrowed here after move</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"d = {}"</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// test</span><br><br>    <span class="token comment">// The Copy trait requires also implementing the Clone trait.</span><br>    <span class="token comment">// We can implement these traits manually, but that is more work.</span><br>    <span class="token comment">// The easiest way to implement them is with the derive attribute.</span><br>    <span class="token attribute attr-name">#[derive(Clone, Copy, Debug)]</span><br>    <span class="token keyword">struct</span> <span class="token type-definition class-name">Point2D</span> <span class="token punctuation">{</span><br>        x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br>        y<span class="token punctuation">:</span> <span class="token keyword">f64</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">let</span> e <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Since we implemented the Copy trait on the Point2D type,</span><br>    <span class="token comment">// this makes a copy of e and assigns it to f.</span><br>    <span class="token comment">// If we hadn't implemented the Copy trait,</span><br>    <span class="token comment">// this would move ownership from e to f.</span><br>    <span class="token keyword">let</span> f <span class="token operator">=</span> e<span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"f = {:?}"</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Point2D { x: 1.0, y: 2.0 }</span><br><br>    <span class="token comment">// This works because we implemented the Copy trait.</span><br>    <span class="token comment">// If we hadn't, we would get the error "value borrowed here after move".</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"e = {:?}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>Ownership of a value can be &quot;borrowed&quot; by any number of variables by getting a reference to a value. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> e <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"e = {:?}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Point2D { x: 1.0, y: 2.0 }</span><br><br><span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token operator">&amp;</span>e<span class="token punctuation">;</span> <span class="token comment">// an immutable borrow</span><br><span class="token keyword">let</span> g <span class="token operator">=</span> <span class="token operator">&amp;</span>e<span class="token punctuation">;</span> <span class="token comment">// another immutable borrow</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"f={:?}, g={:?}"</span><span class="token punctuation">,</span> f<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// no errors here</span></code></pre><p>Any variable whose type acts like a pointer to another type (for example, <code>&amp;variable</code> and smart pointers like <code>Box</code>, <code>Rc</code>, and <code>Arc</code> that are described later) can be dereferenced to get the value to which it points. This can be done with the <code>*</code> operator. Automatic dereferencing is performed by the dot operator which is used to access a field or method of a type. Automatic dereferencing also occurs when a reference type is passed to a function or macro. This is why we were able to print <code>f</code> above without specifying <code>*f</code> which also works. Automatic dereferencing makes code less &quot;noisy&quot; than it would otherwise be.</p><p>Borrowing does not transfer (also referred to as &quot;move&quot;) ownership. A borrowed variable can go out of scope without freeing the memory associated with the original variable.</p><p>When a value is mutable and ownership is borrowed, the compiler will report an error if the value is mutated after the borrow is created and before the last use of the borrow. This is because references expect the data they reference to remain the same for the duration of the borrow. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> <span class="token keyword">mut</span> e <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token operator">&amp;</span>e<span class="token punctuation">;</span> <span class="token comment">// f borrows a reference rather than taking ownership</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"f = {:?}"</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// works</span><br><br><span class="token comment">// The next line mutates e.</span><br><span class="token comment">// But f which is a mutable borrow is used after this line.</span><br><span class="token comment">// So we get the error "cannot assign to `e.x` because it is borrowed".</span><br>e<span class="token punctuation">.</span>x <span class="token operator">+=</span> <span class="token number">3.0</span><span class="token punctuation">;</span><br><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"f = {:?}"</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Often a borrow only needs to read a value (referred to as an &quot;immutable borrow&quot;). Any number of immutable borrows can be created. A mutable borrow allows changing a mutable value through the borrowed variable. But a mutable borrow can only be created when there will be no uses of already created immutable borrows until after the last use of the mutable one. Also, only one mutable borrow of a given variable can be active at a time. The original variable cannot be accessed again until after the last access of the borrowed variable. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Point2D</span> <span class="token punctuation">{</span><br>    x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br>    y<span class="token punctuation">:</span> <span class="token keyword">f64</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> pt <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> ref1 <span class="token operator">=</span> <span class="token operator">&amp;</span>pt<span class="token punctuation">;</span> <span class="token comment">// immutable borrow</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> ref1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Point2D { x: 1.0, y: 2.0 }</span><br><br>    <span class="token comment">// Can create and use any number of additional immutable borrows.</span><br>    <span class="token keyword">let</span> ref2 <span class="token operator">=</span> <span class="token operator">&amp;</span>pt<span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> ref2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Point2D { x: 1.0, y: 2.0 }</span><br><br>    <span class="token comment">// Can use earlier immutable borrows again.</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> ref1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Point2D { x: 1.0, y: 2.0 }</span><br><br>    <span class="token comment">// Can create and use a mutable borrow.</span><br>    <span class="token keyword">let</span> ref3 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> pt<span class="token punctuation">;</span><br>    ref3<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">3.0</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> ref3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Point2D { x: 3.0, y: 2.0 }</span><br><br>    <span class="token comment">// Can't use immutable borrows created before a mutable borrow,</span><br>    <span class="token comment">// even if the mutable borrow isn't used to mutate the value.</span><br>    <span class="token comment">//println!("{:?}", ref1);</span><br>    <span class="token comment">// error: cannot borrow `pt` as mutable</span><br>    <span class="token comment">// because it is also borrowed as immutable</span><br><br>    <span class="token comment">// Can create and use new immutable borrows because</span><br>    <span class="token comment">// we are finished with the mutable borrow at this point.</span><br>    <span class="token keyword">let</span> ref4 <span class="token operator">=</span> <span class="token operator">&amp;</span>pt<span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> ref4<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Point2D { x: 3.0, y: 2.0 }</span><br><span class="token punctuation">}</span></code></pre><p>An alternative to borrowing is to clone data, but doing this is often unnecessarily inefficient. To clone a value, call its <code>clone</code> method which is available for all types that implement the <code>Clone</code> trait. A large number of built-in types implement this including <code>String</code>, arrays, tuples, <code>Vec</code>, <code>HashMap</code>, and <code>HashSet</code>. To enable cloning a struct, implement the <code>Clone</code> trait by adding the <code>#[derive(Clone)]</code> attribute before it.</p><p>When variables whose values are on the stack are passed to functions, the functions are given copies. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">my_function</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><br>    <span class="token function">my_function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// a copy of x is passed</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span><br><span class="token punctuation">}</span></code></pre><p>When variables (not references) of types that do not implement the <code>Copy</code> trait are passed to functions, copies are not made and ownership is transferred. When the function exits, the data is freed. The calling function can then no longer use variables that were passed. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[derive(Clone, Copy, Debug)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Point2D</span> <span class="token punctuation">{</span><br>    x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br>    y<span class="token punctuation">:</span> <span class="token keyword">f64</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">take_point</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token class-name">Point2D</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"p = {:?}"</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">take_vector</span><span class="token punctuation">(</span>v<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"v = {:?}"</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> pt <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token comment">// A copy is passed because the Point2D type implements the copy trait.</span><br>    <span class="token function">take_point</span><span class="token punctuation">(</span>pt<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// We can still use pt because ownership was not transferred.</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"pt = {:?}"</span><span class="token punctuation">,</span> pt<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> numbers <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token comment">// Ownership is transferred because</span><br>    <span class="token comment">// the Vec type does not implement the Copy trait.</span><br>    <span class="token function">take_vector</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error: borrow of moved value: `numbers`</span><br>    <span class="token comment">// We cannot use numbers here because ownership was transferred.</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"numbers = {:?}"</span><span class="token punctuation">,</span> numbers<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// value borrowed here after move</span><br><span class="token punctuation">}</span></code></pre><p>We can fix the error above by changing the function to return the parameter which returns ownership. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">take_vector</span><span class="token punctuation">(</span>v<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"v = {:?}"</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    v<br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> numbers <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> new_numbers <span class="token operator">=</span> <span class="token function">take_vector</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"new_numbers = {:?}"</span><span class="token punctuation">,</span> new_numbers<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>When references to variables are passed to functions, ownership is borrowed rather than being transferred. When the function exits, the value is not freed and the calling function can continue using it. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token comment">// We could pass the i32 argument by reference,</span><br><span class="token comment">// but there is no benefit in doing that.</span><br><span class="token keyword">fn</span> <span class="token function-definition function">my_function</span><span class="token punctuation">(</span>i<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "test"</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">my_function</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "test"</span><br><span class="token punctuation">}</span></code></pre><p>To allow a function to modify data passed to it by reference, pass and receive mutable references. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">my_function</span><span class="token punctuation">(</span>i<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span><br>    <span class="token operator">*</span>i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// dereferences and increments</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "test"</span><br>    s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">" more"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// on stack</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// on heap</span><br>    <span class="token comment">// Even though i and s are mutable, the arguments to</span><br>    <span class="token comment">// my_function below only need to be marked as mutable</span><br>    <span class="token comment">// if that function requires them to be mutable.</span><br>    <span class="token function">my_function</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> i<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "test more"</span><br><span class="token punctuation">}</span></code></pre><p>A function can create a value and return it. This transfers ownership to the caller rather than freeing the data when the function exits. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Point2D</span> <span class="token punctuation">{</span><br>    x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br>    y<span class="token punctuation">:</span> <span class="token keyword">f64</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">get_origin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span><br>    <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0.0</span> <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">get_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">{</span><br>    <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token function">get_origin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Point2D { x: 0.0, y: 0.0 }</span><br><br>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token function">get_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// test</span><br><span class="token punctuation">}</span></code></pre><p>Early we said that memory for values allocated in a scope is freed when the scope exits. However, there is an exception to this when ownership is transferred outside a block. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> a<span class="token punctuation">;</span> <span class="token comment">// set once inside the block that follows</span><br><br>    <span class="token punctuation">{</span><br>        <span class="token comment">// Allocate inside block.</span><br>        <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>        <span class="token comment">// Move ownership to "a" which lives outside this block.</span><br>        a <span class="token operator">=</span> b<span class="token punctuation">;</span><br><br>        <span class="token comment">// If the previous line is changed to</span><br>        <span class="token comment">// a = &amp;b;</span><br>        <span class="token comment">// we get the error "`b` does not live long enough"</span><br>        <span class="token comment">// because a will no longer get ownership</span><br>        <span class="token comment">// and b will be freed at the end of the block.</span><br><br>        <span class="token comment">// Memory for b is not freed when this block exits</span><br>        <span class="token comment">// because b no longer owns it.</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// "a" can be used here because its lifetime has yet not ended.</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>Closures are functions that capture values in their environment so they can be accessed later when the function is executed. Functions defined with the <code>fn</code> keyword are not closures. Closures are defined as anonymous functions with a parameter list written between vertical bars which must be present even if there are no parameters. While function parameter and return types must be specified, these can be inferred for closures.</p><p>Here is an ownership example that is similar to the previous example, but uses a closure:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// This variable must be initialized in order to access it in the closure.</span><br>    <span class="token comment">// Because it is then modified in the closure, it must be mutable.</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> a <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// an empty string</span><br><br>    <span class="token comment">// This variable must be `mut` because it captures and mutates</span><br>    <span class="token comment">// the mutable variable "a" in its environment.</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> inner <span class="token operator">=</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span> <span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span> <span class="token comment">// no parameters</span><br>        <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        a <span class="token operator">=</span> b<span class="token punctuation">;</span> <span class="token comment">// Moves ownership from b to a.</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>    <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// test</span><br><span class="token punctuation">}</span></code></pre><p>Here is an example that concisely summarizes the ownership options when passing a value to a function:</p><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Point2D</span> <span class="token punctuation">{</span><br>    x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br>    y<span class="token punctuation">:</span> <span class="token keyword">f64</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">take</span><span class="token punctuation">(</span>pt<span class="token punctuation">:</span> <span class="token class-name">Point2D</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"in take, {:?}"</span><span class="token punctuation">,</span> pt<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">take_and_return</span><span class="token punctuation">(</span>pt<span class="token punctuation">:</span> <span class="token class-name">Point2D</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"in take_and_return, {:?}"</span><span class="token punctuation">,</span> pt<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    pt <span class="token comment">// returns ownership to caller</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">borrow_immutably</span><span class="token punctuation">(</span>pt<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Point2D</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">//pt.x = 3.0; // can't mutate</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"in borrow_immutably, {:?}"</span><span class="token punctuation">,</span> pt<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">borrow_mutably</span><span class="token punctuation">(</span>pt<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Point2D</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    pt<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">3.0</span><span class="token punctuation">;</span> <span class="token comment">// can mutate</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"in borrow_mutably, {:?}"</span><span class="token punctuation">,</span> pt<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> pt <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token function">take</span><span class="token punctuation">(</span>pt<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// in take, Point2D { x: 1.0, y: 2.0 }</span><br>    <span class="token comment">// Can't use pt after ownership was transferred and not returned.</span><br>    <span class="token comment">//println!("after take, pt = {:?}", pt);</span><br><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> pt <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    pt <span class="token operator">=</span> <span class="token function">take_and_return</span><span class="token punctuation">(</span>pt<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// in take_and_return, Point2D { x: 1.0, y: 2.0 }</span><br>    <span class="token comment">// Can use after this because ownership is returned.</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> pt<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Point2D { x: 1.0, y: 2.0 }</span><br><br>    <span class="token keyword">let</span> pt <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token function">borrow_immutably</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pt<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// in borrow_immutably, Point2D { x: 1.0, y: 2.0 }</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> pt<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Point2D { x: 1.0, y: 2.0 }</span><br><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> pt <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token function">borrow_mutably</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> pt<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// in borrow_mutably, Point2D { x: 3.0, y: 2.0 }</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> pt<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Point2D { x: 3.0, y: 2.0 }</span><br><span class="token punctuation">}</span></code></pre><p>Here are some <em>guidelines</em> related to ownership of heap data. While there are situations in which these do not apply, often to improve performance, following these will typically reduce ownership issues in your code.</p><ol><li>Compound types should own their heap data rather than hold references to heap data owned elsewhere. For example, struct fields that are strings should use the <code>String</code> type instead of <code>&amp;str</code>.</li><li>Pass references to heap data to functions rather than transferring ownership. For example, a parameter that accepts string data should have the type <code>&amp;str</code> instead of <code>String</code>. An exception is when the function wants to take ownership in order to add items to a compound type that it owns.</li><li>In functions that create and return heap data, transfer ownership to the caller. For example, return <code>String</code> rather than <code>&amp;str</code>.</li></ol><h2 id="lifetimes" tabindex="-1"><a name="lifetimes">Lifetimes</a></h2><p>Lifetimes ensure that memory does not get freed before a reference to it can use it.</p><aside>This is an advanced topic. Be prepared to revisit this later and read it multiple times before it sinks in. Fortunately for most function definitions there is no need to explicitly specify lifetimes.</aside><p>Lifetime annotations only apply to references. All reference parameters and reference return types have a lifetime, but in most cases the Rust compiler automatically determines them. It does so using these three simple &quot;lifetime elision&quot; rules:</p><ol><li>Each parameter with a reference type and no specified lifetime parameter is assigned a unique lifetime parameter.</li><li>If all the reference parameters now have the same lifetime and the return type is a reference, it is assigned the same lifetime as the reference parameters. This occurs when there is only one parameter with a reference type or when there is more that one, but they all have the same specified lifetime annotation.</li><li>If the function is a method (indicated by the first parameter having the name <code>self</code>), the <code>self</code> parameter is a reference (<code>&amp;self</code> or <code>&amp;mut self</code>), and the return type is a reference, the <code>self</code> reference and the return type reference are given the same lifetime parameter. The reason for this is that it is common for such a method to return a reference to part of <code>self</code>.</li></ol><p>If after applying these rules to a function whose return type is a reference the lifetime of the return type is still unknown, the compiler outputs a &quot;missing lifetime specifier&quot;. This means that lifetimes must be explicitly specified. Typically explicit lifetime parameters are only needed when there are multiple reference parameters and the return type is a reference. When this is the case, often the same explicit lifetime parameter is added to all of the reference parameters AND the return reference type.</p><p>Lifetime annotations used in function signatures are declared by listing them in angle brackets just like generic types. They are distinguish from generic types by beginning with a single quote. Lifetime annotations appear in reference types after the <code>&amp;</code> and before type names. Their names are typically a single letter such as &quot;a&quot;. Lifetime annotations only serve to indicate which items in a function signature have the same lifetime (or at least as long as another), not an actual duration.</p><p>The following example illustrates a case where lifetime annotations are required:</p><pre class="language-rust"><code class="language-rust"><span class="token comment">// The function signature below results in a</span><br><span class="token comment">// "missing lifetime specifier" error.</span><br><span class="token comment">// Additionally, the compiler says "explicit lifetime required"</span><br><span class="token comment">// for s1, s2, and the return type.</span><br><span class="token comment">// When more than one reference is passed to a function AND</span><br><span class="token comment">// one of them can be returned, Rust requires lifetime specifiers.</span><br><span class="token comment">//fn get_greater(s1: &amp;str, s2: &amp;str) -> &amp;str {</span><br><br><span class="token comment">// The next function signature includes lifetime specifiers.</span><br><span class="token keyword">fn</span> <span class="token function-definition function">get_greater</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">></span><span class="token punctuation">(</span>s1<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">str</span><span class="token punctuation">,</span> s2<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">str</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> s1 <span class="token operator">></span> s2 <span class="token punctuation">{</span><br>        s1<br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>        s2<br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">get_surprise</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token function">get_greater</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"no soup for you"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token function">get_surprise</span><span class="token punctuation">(</span><span class="token string">"soup"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// soup</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token function">get_surprise</span><span class="token punctuation">(</span><span class="token string">"bread"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// no soup for you</span><br><span class="token punctuation">}</span></code></pre><p>The name <code>static</code> is a reserved lifetime name. It is the lifetime of <code>const</code> and <code>static</code> values which live for the duration of the program.</p><p>To use more than one lifetime specifier in a function signature, list them after the function name inside angle brackets separated by commas. For example, <code>fn my_function&lt;'a, 'b&gt;(...)</code>.</p><p>To specify that lifetime <code>b</code> is at least as long as lifetime <code>a</code>, use <code>fn my_function&lt;'a, 'b: 'a&gt;(...)</code>.</p><h2 id="enums" tabindex="-1"><a name="enums">Enums</a></h2><p>Enums specify a list of allowed values referred to as &quot;variants&quot;. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[allow(dead_code)]</span> <span class="token comment">// suppresses warning about not using all the variants</span><br><span class="token attribute attr-name">#[derive(Debug)]</span><br><span class="token keyword">enum</span> <span class="token type-definition class-name">PrimaryColor</span> <span class="token punctuation">{</span> <span class="token class-name">Red</span><span class="token punctuation">,</span> <span class="token class-name">Green</span><span class="token punctuation">,</span> <span class="token class-name">Blue</span> <span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">process_color</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token class-name">PrimaryColor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> color<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Green</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> color<span class="token punctuation">:</span> <span class="token class-name">PrimaryColor</span> <span class="token operator">=</span> <span class="token class-name">PrimaryColor</span><span class="token punctuation">::</span><span class="token class-name">Green</span><span class="token punctuation">;</span><br>    <span class="token function">process_color</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>Match expressions are similar to <code>switch</code> statements in other languages, but they evaluate to a value. Instead of <code>case</code> statements inside a <code>switch</code> they have &quot;match arms&quot;. There must be a match arm for every possible value of the expression being matched, i.e. they must be exhaustive. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[allow(dead_code)]</span><br><span class="token attribute attr-name">#[derive(Debug)]</span><br><span class="token keyword">enum</span> <span class="token type-definition class-name">PrimaryColor</span> <span class="token punctuation">{</span> <span class="token class-name">Red</span><span class="token punctuation">,</span> <span class="token class-name">Green</span><span class="token punctuation">,</span> <span class="token class-name">Blue</span> <span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">use</span> <span class="token class-name">PrimaryColor</span><span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span> <span class="token comment">// brings all values into current scope</span><br>    <span class="token keyword">let</span> color <span class="token operator">=</span> <span class="token class-name">Red</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// If a match arm for any PrimaryColor variant was missing</span><br>    <span class="token comment">// we would get a "non-exhaustive patterns" error.</span><br>    <span class="token keyword">let</span> item <span class="token operator">=</span> <span class="token keyword">match</span> color <span class="token punctuation">{</span><br>        <span class="token class-name">Red</span> <span class="token operator">=></span> <span class="token string">"stop sign"</span><span class="token punctuation">,</span><br>        <span class="token class-name">Green</span> <span class="token operator">=></span> <span class="token string">"grass"</span><span class="token punctuation">,</span><br>        <span class="token class-name">Blue</span> <span class="token operator">=></span> <span class="token string">"sky"</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// stop sign</span><br><br>    <span class="token keyword">let</span> item <span class="token operator">=</span> <span class="token keyword">match</span> color <span class="token punctuation">{</span><br>        <span class="token class-name">Blue</span> <span class="token operator">=></span> <span class="token string">"sky"</span><span class="token punctuation">,</span><br>        _ <span class="token operator">=></span> <span class="token string">"unknown"</span> <span class="token comment">// wildcard handling all other values</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// unknown</span><br><span class="token punctuation">}</span></code></pre><p>The <a href="#error-handling">Error Handling</a> section describes the <code>Option</code> and <code>Result</code> generic enums that are provided by the standard library. These contain variants that hold data, which is something that enums in most other programming languages cannot do. The <code>Option&lt;T&gt;</code> enum defines the variants <code>Some(T)</code> and <code>None</code>. The <code>Result&lt;T, E&gt;</code> enum defines the variants <code>Ok(T)</code> and <code>Err&lt;E&gt;</code>.</p><p>Enum variants can hold many kinds of values. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Debug</span><span class="token punctuation">;</span><br><br><span class="token attribute attr-name">#[derive(Debug)]</span><br><span class="token keyword">enum</span> <span class="token type-definition class-name">Demo</span> <span class="token punctuation">{</span><br>    <span class="token class-name">Empty</span><span class="token punctuation">,</span><br>    <span class="token class-name">Single</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token class-name">TupleLike</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// holds positional items</span><br>    <span class="token class-name">StructLike</span><span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// holds named items</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">use</span> <span class="token class-name">Demo</span><span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> d1 <span class="token operator">=</span> <span class="token class-name">Empty</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> d2 <span class="token operator">=</span> <span class="token class-name">Single</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> d3 <span class="token operator">=</span> <span class="token class-name">TupleLike</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"red"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> d4 <span class="token operator">=</span> <span class="token class-name">StructLike</span><span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token number">1.2</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">3.4</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}, {:?}, {:?}, {:?}"</span><span class="token punctuation">,</span> d1<span class="token punctuation">,</span> d2<span class="token punctuation">,</span> d3<span class="token punctuation">,</span> d4<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// prints Empty, Single("Hello"),</span><br>    <span class="token comment">// TupleLike("red", 19, true),</span><br>    <span class="token comment">// StructLike { x: 1.2, y: 3.4 }</span><br><span class="token punctuation">}</span></code></pre><h2 id="error-handling" tabindex="-1"><a name="error-handling">Error Handling</a></h2><p>Unlike many other programming languages, Rust does not support throwing and catching exceptions. Instead, functions that can fail typically return the enum type <code>Option</code> or <code>Result</code>.</p><p>The <code>Option</code> enum has two variants, <code>Some</code> which wraps a value and <code>None</code> which doesn't. For example, a function that takes a vector and returns the first element that matches some criteria could return <code>Some</code> wrapping the element, or <code>None</code> if no match is found. This is similar to the <code>Maybe</code> monad in Haskell.</p><p>The <code>Result</code> enum also has two variants, <code>Ok</code> which wraps a value and <code>Err</code> which wraps an error description. For example, a function that reads all the text in a file could return <code>Ok</code> wrapping the text, or <code>Err</code> wrapping a description of why reading the file failed. This is similar to the <code>Either</code> monad in Haskell.</p><p>There are many ways to handle variants from these enum types.</p><ol><li><p>Use a <code>match</code> statement.</p><p>For example:</p><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span><br><span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">MathError</span> <span class="token punctuation">{</span><br>    <span class="token class-name">DivisionByZero</span> <span class="token comment">// used by divide2 function below</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Demonstrates returning a Option enum.</span><br><span class="token keyword">fn</span> <span class="token function-definition function">divide1</span><span class="token punctuation">(</span>numerator<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span> denominator<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">f64</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> denominator <span class="token operator">==</span> <span class="token number">0.0</span> <span class="token punctuation">{</span><br>        <span class="token class-name">None</span> <span class="token comment">// means there is no result, but doesn't explain why</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>        <span class="token class-name">Some</span><span class="token punctuation">(</span>numerator <span class="token operator">/</span> denominator<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Demonstrates returning a Result enum.</span><br><span class="token comment">// Commented lines below show an alternative way</span><br><span class="token comment">// to describe the error using a string.</span><br><span class="token comment">//const DIV_BY_ZERO: &amp;str = "divide by zero";</span><br><span class="token keyword">fn</span> <span class="token function-definition function">divide2</span><span class="token punctuation">(</span>numerator<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span> denominator<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">)</span><br><span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">f64</span><span class="token punctuation">,</span> <span class="token class-name">MathError</span><span class="token operator">></span> <span class="token punctuation">{</span><br><span class="token comment">//fn divide2(numerator: f64, denominator: f64)</span><br><span class="token comment">//-> Result&lt;f64, &amp;'static str> {</span><br>    <span class="token keyword">if</span> denominator <span class="token operator">==</span> <span class="token number">0.0</span> <span class="token punctuation">{</span><br>        <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">MathError</span><span class="token punctuation">::</span><span class="token class-name">DivisionByZero</span><span class="token punctuation">)</span><br>        <span class="token comment">//Err(DIV_BY_ZERO)</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>        <span class="token class-name">Ok</span><span class="token punctuation">(</span>numerator <span class="token operator">/</span> denominator<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token number">5.0</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> d <span class="token operator">=</span> <span class="token number">2.0</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">match</span> <span class="token function">divide1</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> d<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// returns an Option enum</span><br>        <span class="token class-name">Some</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:.2}"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 2.50</span><br>        <span class="token class-name">None</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"divide by zero"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">match</span> <span class="token function">divide2</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> d<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// returns a Result enum</span><br>        <span class="token class-name">Ok</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:.2}"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 2.50</span><br>        <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token comment">//Err(msg) => println!("{}", msg),</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Use <code>if let</code> statement.</p><p>We can replace the <code>match</code> statements in the previous example with the following:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">divide1</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> d<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:.2}"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"fail"</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">divide2</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> d<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:.2}"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// With this approach we lose the detail in the Err variant.</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"fail"</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Use the <code>unwrap</code>, <code>unwrap_or</code>, <code>unwrap_or_default</code>, or <code>unwrap_or_else</code> method.</p><p>These extract the value from an <code>Option</code> or <code>Result</code> enum.</p><p>If the value is a <code>Some</code> or <code>Ok</code>, these succeed.</p><p>If the value is a <code>None</code> or <code>Err</code>:</p><ul><li><code>unwrap</code> panics, exiting the program.<br>If the value is <code>Err</code>, the message it wraps will be output.</li><li><code>unwrap_or</code> uses a specified value.</li><li><code>unwrap_or_default</code> uses the default value for the type.<br>For custom types, this is specified by implementing the <code>Default</code> trait.</li><li><code>unwrap_or_else</code> executes a closure passed to it to compute the value to use.</li></ul><p>For example, we can replace the <code>match</code> and <code>if let</code> statements above with the following:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">divide1</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:.2}"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// When d is zero this uses infinity for the value.</span><br><span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">divide2</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap_or</span><span class="token punctuation">(</span><span class="token namespace">std<span class="token punctuation">::</span></span><span class="token keyword">f64</span><span class="token punctuation">::</span><span class="token constant">INFINITY</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:.2}"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Use the <code>expect</code> method.</p><p>This is nearly the same as the <code>unwrap</code> method. The only difference is that a custom error message can be supplied. We can replace the lines above with the following:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">divide1</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"division failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:.2}"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">divide2</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"division failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:.2}"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Use the <code>?</code> operator which is shorthand for the <code>try!</code> macro.</p><p>This allows the caller to handle errors, similar to re-throwing an exception in other programming languages. It can be applied to functions that return a <code>Result</code> or <code>Option</code> enum.</p><p>If the value is a <code>Some</code> or <code>Ok</code> variant then it is unwrapped and returned. If the value is a <code>None</code> or <code>Err</code> variant then it is passed through the <code>from</code> function (defined in the standard library <code>From</code> trait) in order to convert it to the return type of the function, and that is returned to the caller.</p><p>The function in which this operator is used must declare the proper return type and return a value of that type.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">divide1</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:.2}"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">divide2</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:.2}"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Uses of <code>?</code> can be chained in the same statement. For example, suppose the function <code>alpha</code> returns a <code>Result</code> whose wrapped value is an object with a method <code>beta</code> that returns a <code>Result</code> whose wrapped value is an object with a method <code>gamma</code> that returns a <code>Result</code>. We can get the value of this call sequences with the following:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token function">alpha</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token function">beta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token function">gamma</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span></code></pre><p>In functions that call multiple other functions that return <code>Result</code> instances with different types of errors and wish to return them to callers, consider making the return type <code>Result&lt;SomeOkType, Box&lt;dyn std::error::Error&gt;&gt;</code>. <code>Box</code> is needed to accommodate error values of different sizes because the size of the error value must be known at compile time. A <code>Box</code> is a smart pointer with a fixed size that points to another value. The <code>dyn</code> keyword performs dynamic dispatch to allow a value of any type that implements a given trait, <code>Error</code> in this case. Even the <code>main</code> function can be given this return type.</p><p>In the case below the errors that can be returned (<code>std::io::Error</code> and <code>std::num::ParseIntError</code>) all implement the <code>std::error::Error</code> trait. This example comes from the Rustlings exercise <code>errorsn.rs</code>.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">read_and_validate</span><span class="token punctuation">(</span><br>    b<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">dyn</span> <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token class-name">BufRead</span><span class="token punctuation">,</span><br><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">PositiveNonzeroInteger</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token namespace">std<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">>></span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> line <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// The read_line method can return Err(std::io::Error).</span><br>    b<span class="token punctuation">.</span><span class="token function">read_line</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> line<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token comment">// The parse method can return Err(std::num::ParseIntError).</span><br>    <span class="token keyword">let</span> num<span class="token punctuation">:</span> <span class="token keyword">i64</span> <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> answer <span class="token operator">=</span> <span class="token class-name">PositiveNonzeroInteger</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token class-name">Ok</span><span class="token punctuation">(</span>answer<span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre></li></ol><p>The following example demonstrates several approaches to error handling for functions that can return multiple error types. To experiment with this code, download it from the GitHub repo named <a href="https://github.com/mvolkmann/rust-error-handling?v=1.1.1" rel="noopener" target="_blank">rust-error-handling</a>.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">serde<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Deserialize</span><span class="token punctuation">,</span> <span class="token class-name">Serialize</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>fmt<span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span>read_to_string<span class="token punctuation">;</span><br><br><span class="token comment">// This is a custom error type.</span><br><span class="token comment">// It enables callers that receive this kind of error</span><br><span class="token comment">// to handle different error causes differently.</span><br><span class="token comment">// These must implement the Error trait (done below) which requires</span><br><span class="token comment">// implementing the Debug (done here) and Display (done below) traits.</span><br><span class="token attribute attr-name">#[derive(Debug)]</span><br><span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">GetDogsError</span> <span class="token punctuation">{</span><br>    <span class="token class-name">BadFile</span><span class="token punctuation">(</span><span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token class-name">BadJson</span><span class="token punctuation">(</span><span class="token namespace">serde_json<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Make the variants of this enum directly available.</span><br><span class="token keyword">use</span> <span class="token class-name">GetDogsError</span><span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span><br><br><span class="token comment">// All of the Error trait methods have default implementations, so</span><br><span class="token comment">// no body is required here, but we will implement the source method.</span><br><span class="token keyword">impl</span> <span class="token class-name">Error</span> <span class="token keyword">for</span> <span class="token class-name">GetDogsError</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Returns the wrapped error, if any.</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">source</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token keyword">dyn</span> <span class="token class-name">Error</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">'static</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">{</span><br>        <span class="token keyword">match</span> <span class="token operator">*</span><span class="token keyword">self</span> <span class="token punctuation">{</span><br>            <span class="token comment">// The wrapped error type is implicitly cast to the trait object</span><br>            <span class="token comment">// type &amp;Error because it implements the Error trait.</span><br>            <span class="token class-name">BadFile</span><span class="token punctuation">(</span><span class="token keyword">ref</span> e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token class-name">Some</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span><br>            <span class="token class-name">BadJson</span><span class="token punctuation">(</span><span class="token keyword">ref</span> e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token class-name">Some</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Display</span> <span class="token keyword">for</span> <span class="token class-name">GetDogsError</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Formatter</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Result</span> <span class="token punctuation">{</span><br>        <span class="token keyword">match</span> <span class="token operator">*</span><span class="token keyword">self</span> <span class="token punctuation">{</span><br>            <span class="token class-name">BadFile</span><span class="token punctuation">(</span><span class="token keyword">ref</span> e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"bad file: {}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span><br>            <span class="token class-name">BadJson</span><span class="token punctuation">(</span><span class="token keyword">ref</span> e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"bad JSON: {}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// The "From" trait converts values of one type to another.</span><br><span class="token comment">// Having the following implementations enables</span><br><span class="token comment">// using the ? operator in the get_dogs3 function below.</span><br><span class="token keyword">impl</span> <span class="token class-name">From</span><span class="token operator">&lt;</span><span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">></span> <span class="token keyword">for</span> <span class="token class-name">GetDogsError</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">from</span><span class="token punctuation">(</span>other<span class="token punctuation">:</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span><br>        <span class="token class-name">BadFile</span><span class="token punctuation">(</span>other<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><span class="token keyword">impl</span> <span class="token class-name">From</span><span class="token operator">&lt;</span><span class="token namespace">serde_json<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">></span> <span class="token keyword">for</span> <span class="token class-name">GetDogsError</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">from</span><span class="token punctuation">(</span>other<span class="token punctuation">:</span> <span class="token namespace">serde_json<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span><br>        <span class="token class-name">BadJson</span><span class="token punctuation">(</span>other<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// This struct can be deserialized from JSON and serialized to JSON.</span><br><span class="token attribute attr-name">#[derive(Deserialize, Serialize, Debug)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Dog</span> <span class="token punctuation">{</span><br>    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>    breed<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Let's look at three versions of a function that</span><br><span class="token comment">// reads a JSON file describing dogs and parses it</span><br><span class="token comment">// to create a vector of Dog instances.</span><br><br><span class="token comment">// With this version callers cannot easily distinguish between</span><br><span class="token comment">// the two types of errors that can occur,</span><br><span class="token comment">// std::io:Error from failing to read the file and</span><br><span class="token comment">// serde_json::error::Error from failing to parse the JSON.</span><br><span class="token comment">// This approach is fine when callers only need to</span><br><span class="token comment">// know if an error occurred and print an error message.</span><br><span class="token keyword">fn</span> <span class="token function-definition function">get_dogs1</span><span class="token punctuation">(</span>file_path<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Dog</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Error</span><span class="token operator">>></span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> json <span class="token operator">=</span> <span class="token function">read_to_string</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> dogs<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Dog</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token namespace">serde_json<span class="token punctuation">::</span></span><span class="token function">from_str</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>json<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token class-name">Ok</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// If we have many functions with this same return type,</span><br><span class="token comment">// Result&lt;some-type, GetDogsError> {</span><br><span class="token comment">// we can reduce the repetition by defining a type alias.</span><br><span class="token keyword">pub</span> <span class="token keyword">type</span> <span class="token type-definition class-name">MyResult</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>result<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">GetDogsError</span><span class="token operator">></span><span class="token punctuation">;</span><br><br><span class="token comment">// With this version callers can distinguish between the</span><br><span class="token comment">// two types of errors by matching on the GetDogsError variants.</span><br><span class="token keyword">fn</span> <span class="token function-definition function">get_dogs2</span><span class="token punctuation">(</span>file_path<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">MyResult</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Dog</span><span class="token operator">>></span> <span class="token punctuation">{</span><br>    <span class="token keyword">match</span> <span class="token function">read_to_string</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token class-name">Ok</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">match</span> <span class="token namespace">serde_json<span class="token punctuation">::</span></span><span class="token function">from_str</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>json<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token class-name">Ok</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span><span class="token punctuation">,</span><br>            <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">BadJson</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token punctuation">}</span><span class="token punctuation">,</span><br>        <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">BadFile</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// This version takes advantage of the fact that</span><br><span class="token comment">// GetDogsError implements the From trait for</span><br><span class="token comment">// each of the kinds of errors that can occur.</span><br><span class="token comment">// This enables using the ? operator because errors of those</span><br><span class="token comment">// types will automatically be converted to the GetDogsError type.</span><br><span class="token keyword">fn</span> <span class="token function-definition function">get_dogs3</span><span class="token punctuation">(</span>file_path<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">MyResult</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Dog</span><span class="token operator">>></span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> json <span class="token operator">=</span> <span class="token function">read_to_string</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> dogs<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Dog</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token namespace">serde_json<span class="token punctuation">::</span></span><span class="token function">from_str</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>json<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token class-name">Ok</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// If the main function has this return type, it can use the ? operator.</span><br><span class="token comment">//fn main() -> Result&lt;(), Box&lt;dyn Error>> {</span><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> file_path <span class="token operator">=</span> <span class="token string">"./dogs.json"</span><span class="token punctuation">;</span><br><br>    <span class="token comment">/*<br>    // With the first approach we can easily detect<br>    // that an error has occurred.<br>    if let Ok(dogs) = get_dogs1(file_path) {<br>        dbg!(dogs);<br>    } else {<br>        eprintln!("failed to get dogs, but don't know why");<br>    }<br>    */</span><br><br>    <span class="token comment">/*<br>    // But handling different kinds of errors differently is messy.<br>    match get_dogs1(file_path) {<br>        Ok(dogs) => println!("{:?}", dogs),<br>        Err(e) => {<br>            if let Some(e) = e.downcast_ref::&lt;std::io::Error>() {<br>                eprintln!("bad file: {:?}", e);<br>            } else if let Some(e) =<br>                e.downcast_ref::&lt;serde_json::error::Error>() {<br>                eprintln!("bad json {:?}", e);<br>            } else {<br>                eprintln!("some other kind of error");<br>            }<br>        }<br>    }<br>    */</span><br><br>    <span class="token comment">// With the second and third approaches it is much easier</span><br>    <span class="token comment">// to handle different kinds of errors differently.</span><br>    <span class="token comment">//match get_dogs2(file_path) {</span><br>    <span class="token keyword">match</span> <span class="token function">get_dogs3</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token class-name">Ok</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> dogs<span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">BadFile</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">eprintln!</span><span class="token punctuation">(</span><span class="token string">"bad file: {}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">BadJson</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">eprintln!</span><span class="token punctuation">(</span><span class="token string">"bad json: {}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>The <code>quick-error</code> crate makes implementing custom error types easier. Here are the changes required to use this approach which also requires adding <code>quick-error</code> as a dependency in <code>Cargo.toml</code>. Note that we no longer need to manually implement the <code>Error</code>, <code>Display</code>, and <code>From</code> traits for our custom error enum. To experiment with this code, see the <code>quick_error</code> branch of the <a href="https://github.com/mvolkmann/rust-error-handling?v=1.1.1" rel="noopener" target="_blank">rust-error-handling</a> GitHub repo.</p><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[macro_use]</span><br><span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">quick_error</span><span class="token punctuation">;</span><br><br><span class="token keyword">use</span> <span class="token namespace">serde<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Deserialize</span><span class="token punctuation">,</span> <span class="token class-name">Serialize</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span>read_to_string<span class="token punctuation">;</span><br><br><span class="token macro property">quick_error!</span> <span class="token punctuation">{</span><br>    <span class="token attribute attr-name">#[derive(Debug)]</span><br>    <span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">GetDogsError</span> <span class="token punctuation">{</span><br>        <span class="token class-name">BadFile</span><span class="token punctuation">(</span>e<span class="token punctuation">:</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token function">display</span><span class="token punctuation">(</span><span class="token string">"bad file {}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><br>            <span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>        <span class="token class-name">BadJson</span><span class="token punctuation">(</span>e<span class="token punctuation">:</span> <span class="token namespace">serde_json<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token function">display</span><span class="token punctuation">(</span><span class="token string">"bad json {}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><br>            <span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><h2 id="generics" tabindex="-1">Generics</h2><p>Rust makes heavy use of generic types. They enable implementing functions, structs, and traits that operate on various types of data instead of only specific types.</p><p>Generic types are declared inside angle brackets. They can specify one or more traits that must be implemented by concrete types in order to use them in place of the type parameters. The sections on functions, structs, and traits contain many examples of using generic types.</p><h2 id="built-in-types" tabindex="-1">Built-in Types</h2><p>Rust provides many built-types. The following diagram summarizes them.</p><p><img alt="Rust Built-in Data Types" style="width: 70%" src="/blog/assets/rust-types.png?v=1.1.1" title="Rust Built-in Data Types"></p><h3 id="built-in-scalar-types" tabindex="-1"><a name="scalar-types">Built-in Scalar Types</a></h3><p>Rust defines many scalar (primitive) types which can be categorized as boolean, character, integer (6 kinds), or floating point (2 kinds).</p><p>The boolean type name is <code>bool</code>. Its only values are <code>true</code> and <code>false</code>.</p><p>The character type name is <code>char</code>. Literal values are surrounded by single quotes. Its values are Unicode values that each occupy four bytes, regardless of whether four bytes are actually needed to represent them. This gives the values a known size at compile time.</p><p>The signed integer type names are <code>i{n}</code> where <code>{n}</code> is the number of bits which can be 8, 16, 32, 64, 128, or <code>size</code>. The <code>isize</code> type matches either <code>i32</code> or <code>i64</code> depending on the current processor architecture. The default type for literal integers is <code>i32</code> regardless of the processor.</p><p>The unsigned integer types are the same, but start with <code>u</code> instead of <code>i</code>. The <code>usize</code> type is typically used to index into collections such as arrays and vectors.</p><p>Literal number values can end with these type names to make their type explicit. For example, the following variable declarations are equivalent:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> number<span class="token punctuation">:</span> <span class="token keyword">i8</span> <span class="token operator">=</span> <span class="token number">19</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> number <span class="token operator">=</span> <span class="token number">19i8</span><span class="token punctuation">;</span></code></pre><p>Literal integer values can use the underscore character to separate thousands, millions, and so on. For example, the population of the U.S. in 2020 was approximately 330_676_544.</p><p>Hex literal values begin with <code>0x</code>, octal literal values begin with <code>0o</code>, and binary literal values begin with <code>0b</code>.</p><p>The floating point type names are <code>f{n}</code> where <code>{n}</code> is 32 or 64. The default type for literal floats is <code>f64</code> regardless of the current processor. Literal floating point values must include a decimal point to avoid being treated as integer values, but it is acceptable to have no digits after the decimal point. This means that <code>123.</code> is treated the same as <code>123.0</code>.</p><p>The &quot;unit type&quot; represents not having a value, like <code>void</code> in other languages. It can be thought of as an enum with a single variant which is written as <code>()</code>. It is the return value of functions that do not return a value. It is also what the <code>Result</code> enum <code>Ok</code> variant wraps when there is nothing to return. The unit type value can follow the <code>=&gt;</code> in a <code>match</code> arm to take no action.</p><p>Rust allows adding methods to any type, even built-in, scalar types. The following example shows added a method to the <code>i32</code> type:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">trait</span> <span class="token type-definition class-name">Days</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">days_from_now</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span> <span class="token class-name">Days</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">></span> <span class="token keyword">for</span> <span class="token keyword">i32</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">days_from_now</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token keyword">match</span> <span class="token keyword">self</span> <span class="token punctuation">{</span><br>            <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">=></span> <span class="token string">"yesterday"</span><span class="token punctuation">,</span><br>            <span class="token number">0</span> <span class="token operator">=></span> <span class="token string">"today"</span><span class="token punctuation">,</span><br>            <span class="token number">1</span> <span class="token operator">=></span> <span class="token string">"tomorrow"</span><span class="token punctuation">,</span><br>            _ <span class="token operator">=></span> <span class="token keyword">if</span> <span class="token keyword">self</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">{</span> <span class="token string">"future"</span> <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token string">"past"</span> <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><span class="token punctuation">;</span><br>        s<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> days<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> days<span class="token punctuation">.</span><span class="token function">days_from_now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// yesterday</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token function">days_from_now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// today</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token function">days_from_now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// tomorrow</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">.</span><span class="token function">days_from_now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// future</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">days_from_now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// past</span><br><span class="token punctuation">}</span></code></pre><p>Here is another way to implement this that works on values of any type that implements the traits <code>Eq</code>, <code>Ord</code>, and <code>From&lt;i8&gt;</code> which all the number types do:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>cmp<span class="token punctuation">::</span></span><span class="token punctuation">{</span> <span class="token class-name">Eq</span><span class="token punctuation">,</span> <span class="token class-name">Ord</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">trait</span> <span class="token type-definition class-name">Days</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">days_from_now</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'static</span> <span class="token keyword">str</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Eq</span> <span class="token operator">+</span> <span class="token class-name">Ord</span> <span class="token operator">+</span> <span class="token class-name">From</span><span class="token operator">&lt;</span><span class="token keyword">i8</span><span class="token operator">>></span> <span class="token class-name">Days</span> <span class="token keyword">for</span> <span class="token class-name">T</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">days_from_now</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'static</span> <span class="token keyword">str</span> <span class="token punctuation">{</span><br>        <span class="token comment">// Can't use match with Self::from(n) values.</span><br>        <span class="token keyword">if</span> <span class="token keyword">self</span> <span class="token operator">==</span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token string">"today"</span><br>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token keyword">self</span> <span class="token operator">==</span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token string">"yesterday"</span><br>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token keyword">self</span> <span class="token operator">==</span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token string">"tomorrow"</span><br>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token keyword">self</span> <span class="token operator">></span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token string">"future"</span><br>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>            <span class="token string">"past"</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> days<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> days<span class="token punctuation">.</span><span class="token function">days_from_now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// yesterday</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token function">days_from_now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// today</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token function">days_from_now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// tomorrow</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">.</span><span class="token function">days_from_now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// future</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">days_from_now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// past</span><br><span class="token punctuation">}</span></code></pre><p>The <a href="#macros">Macros</a> section shows one more approach.</p><h3 id="primitive-compound-types" tabindex="-1">Primitive Compound Types</h3><p>Rust defines three primitive compound types which are tuple, array, and slice. These are distinct from the collection types that are described in the next section.</p><p>A tuple is a fixed-length list of values that can be of different types. The maximum length is 12. The syntax for a tuple type is <code>(type1, type2, ...)</code>. The syntax for a tuple value is <code>(value1, value2, ...)</code>. Individual values can be accessed by index or destructuring. It is not possible to iterate over the elements of a tuple.</p><p>For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> <span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token punctuation">)</span> <span class="token operator">=</span> t<span class="token punctuation">;</span> <span class="token comment">// destructuring; .. means ignore remaining values</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{} {}"</span><span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 2</span></code></pre><p>An array is a fixed-length list of values that have the same type. Once created, it cannot grow or shrink. The syntax for an array type is <code>[type; length]</code>. The syntax for an array value is <code>[value1, value2, ...]</code>. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// inferred type is [i32; 4]</span><br><span class="token keyword">let</span> <span class="token punctuation">[</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">;</span> <span class="token comment">// destructuring; .. means ignore remaining values</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{} {}"</span><span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 2</span><br><br><span class="token keyword">let</span> rgb <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"green"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token comment">// A Rust string is a "compound collection", covered later.</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> rgb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ["red", "green", "blue"]</span><br><br><span class="token comment">// A literal value (7 here) can be used as a type.</span><br><span class="token keyword">let</span> sevens <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">;</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// same as [7, 7, 7, 7, 7]</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> sevens<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [7, 7, 7, 7, 7]</span></code></pre><p>Elements of an array can be accessed using square brackets and zero-based indexes. For example, <code>rgb[1]</code> is &quot;green&quot;.</p><p>Rust provides the <code>Vec</code> (vector) type for creating variable-length lists of values that have the same type. These can be used in place of arrays when the number of values varies. Operating on an array or <code>Vec</code> often requires obtaining an <a href="#iterators"><code>Iterator</code></a>. For example, that is where the methods <code>map</code>, <code>filter</code>, and <code>fold</code> are found.</p><p>A slice is a borrowed reference to a contiguous subset of a collection that is represented by pointer and a length. These are described in more detail in the <a href="#slices">Slices</a> section.</p><h3 id="collections" tabindex="-1">Collections</h3><p>TODO: Continue review here.</p><p>Rust defines many kinds of collections that hold a variable number of values. These include strings and collections in the <code>std::collections</code> namespace.</p><p>The <code>std::collections</code> namespace defines the following sequence types:</p><ul><li><code>Vec</code>: a resizable, ordered array of values of the same type where items can be efficiently adding and removing items at the end</li><li><code>VecDeque</code>: like a <code>Vec</code>, but items can also be efficiently adding and removing items at the beginning</li><li><code>LinkedList</code>: like a <code>VecDeque</code>, but can be efficiently split which enables efficiently adding and removing items in the middle</li></ul><p>The <code>std::collections</code> namespace defines the following map types:</p><ul><li><code>HashMap</code>: a collection of key/value pairs with efficient value lookup by key where keys and values can be any type</li><li><code>BTreeMap</code>: like a <code>HashMap</code>, but sorted by key enabling efficient retrieval of values corresponding to the smallest key, largest key, closest key that is smaller or larger than some key value, or range of keys</li></ul><p>The <code>std::collections</code> namespace defines the following set types:</p><ul><li><code>HashSet</code>: a collection of unique values with efficient determination of whether a given value is a member</li><li><code>BTreeSet</code>: similar to storing only the keys in a <code>BTreeMap</code></li></ul><p>The <code>std::collections</code> namespace defines one more collection type that doesn't fall into the previous categories:</p><ul><li><code>BinaryHeap</code>: implements a priority queue where only the highest priority item is accessible</li></ul><h4 id="strings" tabindex="-1"><a name="strings">Strings</a></h4><p>Strings are collections of UTF-8 encoded characters stored as a <code>Vec</code> of <code>u8</code> byte values. Literal values are surrounded by double quotes. Strings are more difficult to work with in Rust than in other languages. Rust trades simplicity here for better performance, memory management, and concurrency.</p><p>There are two kinds of strings in Rust. The language defines the &quot;string slice&quot; type <code>&amp;str</code> and the standard library defines the <code>String</code> type. A <code>&amp;str</code> value is a reference (or pointer) to data that includes the length of the string and a pointer to where the character data is stored, which can be on the stack or the heap. A <code>String</code> value is a <a href="#smart-pointers?v=1.1.1" rel="noopener" target="_blank">smart pointer</a> that holds a pointer to the character data on the heap, a length, and a capacity. The capacity is the length to which the character data can grow before additional space must be allocated (handled automatically). A <code>&amp;str</code> value can be a view into the characters of <code>String</code>, sharing its character data.</p><p>While one reason to choose the <code>String</code> type over the <code>&amp;str</code> type is so the length can change, the most common reason is so a variable can &quot;own&quot; it. Values of type <code>&amp;str</code> cannot be owned by a variable.</p><p>Literal characters (just one) are surrounded by single quotes and have the type <code>char</code>. Literal strings (zero or more characters) are surrounded by double quotes and have the type <code>&amp;str</code>.</p><p>Here is a summary of the types that can be used to represent strings:</p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>str</code></td><td>rarely used directly</td></tr><tr><td><code>&amp;str</code></td><td>reference to an immutable string slice; commonly used</td></tr><tr><td><code>&amp;mut str</code></td><td>rarely user; some <code>str</code> methods use it</td></tr><tr><td><code>String</code></td><td>immutable if declared with <code>let</code>; mutable with <code>let mut</code>; commonly used</td></tr><tr><td><code>&amp;String</code></td><td>reference to an immutable string; typically <code>&amp;str</code> is used instead</td></tr><tr><td><code>&amp;mut String</code></td><td>reference to a mutable string; commonly used</td></tr></tbody></table><p>So the string types most frequently used are <code>&amp;str</code>, <code>String</code>, and <code>&amp;mut String</code>.</p><p>To get a <code>&amp;str</code> from a <code>String</code> in the variable <code>s</code>, use <code>&amp;s</code> or <code>s.as_str()</code> which are equivalent.</p><p>To get a <code>String</code> from a <code>&amp;str</code> in the variable <code>s</code>, use <code>s.to_string()</code>, <code>String::from(s)</code>, or <code>s.to_owned()</code> which are equivalent. Actually, <code>to_string</code> calls <code>String::from</code> which calls <code>to_owned</code>. These calls are inlined so they all have the same performance.</p><p>When a <code>String</code> reference is passed to a function that expects a <code>&amp;str</code> it is automatically coerced to that type. This is because <code>String</code> implements the <code>Deref</code> trait with a <code>Target</code> of <code>str</code>. For more on this, see the <a href="#smart-pointers">Smart Pointers</a> section. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">my_function</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "test"</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">my_function</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ownership is not transferred</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "test"</span><br><span class="token punctuation">}</span></code></pre><p>To create a <code>String</code> from multiple values of types that implement the <code>Display</code> trait, use <code>format!(fmt_string, v1, v2, ...)</code>.</p><p>Here are examples of declaring, creating, and passing various kinds of strings:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">demo</span><span class="token punctuation">(</span>s1<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> s2<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> s3<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">String</span><span class="token punctuation">,</span> s4<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"s1 = {}"</span><span class="token punctuation">,</span> s1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// one</span><br>  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"s2 = {}"</span><span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// two</span><br>  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"s3 = {}"</span><span class="token punctuation">,</span> s3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// three</span><br>  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"s4 = {}"</span><span class="token punctuation">,</span> s4<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// four alpha</span><br>  <span class="token comment">//s3.push_str(" beta"); // error: cannot borrow `*s3` as mutable</span><br>  s4<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">" beta"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// only s4 can be mutated</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token string">"one"</span><span class="token punctuation">;</span> <span class="token comment">// type is inferred as &amp;str</span><br>    <span class="token keyword">let</span> s2<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string">"two"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> s3<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"three"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> s4<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string">"four"</span><span class="token punctuation">.</span><span class="token function">to_owned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    s4<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">" alpha"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token function">demo</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> <span class="token operator">&amp;</span>s3<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s4<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"main: s1 = {}"</span><span class="token punctuation">,</span> s1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// one</span><br>    <span class="token comment">//println!("main: s2 = {}", s2); // error: borrow of moved value</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"main: s3 = {}"</span><span class="token punctuation">,</span> s3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// three</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"main: s4 = {}"</span><span class="token punctuation">,</span> s4<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// four alpha beta</span><br><span class="token punctuation">}</span></code></pre><p>Typically variables and parameters for strings that do not require mutation should use the type <code>&amp;str</code> and those that do should use the type <code>&amp;mut String</code>.</p><p>In the tables below, assume the following variable types:</p><ul><li><code>c</code> holds a <code>char</code> value</li><li><code>r</code> holds a <code>std::ops::Range</code> value</li><li><code>s</code> and <code>t</code> hold <code>&amp;str</code> values</li><li><code>u</code>, <code>v</code>, and <code>w</code> hold <code>String</code> values</li><li><code>z</code> holds a <code>char</code> or <code>&amp;str</code> value</li></ul><p>Everywhere <code>c</code> is used, a literal character can be used in its place. Everywhere <code>s</code> and <code>t</code> are used, a literal string can be used in their place.</p><p>Here are operations on the <code>str</code> type:</p><table><thead><tr><th>Syntax</th><th>Operation</th></tr></thead><tbody><tr><td>create</td><td><code>&quot;text in double quotes&quot;</code></td></tr><tr><td>get substring</td><td><code>s[start..end]</code> (1)</td></tr><tr><td>get iterator over Unicode characters</td><td><code>s.chars()</code></td></tr><tr><td>get <code>char</code> at index</td><td><code>s.chars().nth(index)</code> (2)</td></tr><tr><td>determine if contains</td><td><code>s.contains(z)</code></td></tr><tr><td>determine if ends with</td><td><code>s.ends_with(z)</code></td></tr><tr><td>determine if starts with</td><td><code>s.starts_with(z)</code></td></tr><tr><td>get substring</td><td><code>s.get(r)</code> (3)</td></tr><tr><td>get length</td><td><code>s.len()</code></td></tr><tr><td>get iterator over lines</td><td><code>s.lines()</code></td></tr><tr><td>parse into another type such as specific number type</td><td><code>let v = s.parse::&lt;T&gt;()</code> (4)</td></tr><tr><td>create <code>String</code> that repeat n times</td><td><code>s.repeat(n)</code></td></tr><tr><td>replace all occurrences of z1 with z2</td><td><code>s.replace(z1, z2)</code></td></tr><tr><td>replace first n occurrences of z1 with z2</td><td><code>s.replacen(z1, z2, n)</code></td></tr><tr><td>split on a character</td><td><code>s.split(c)</code> returns an iterator (5)</td></tr><tr><td>split on a character n times (last contains rest)</td><td><code>s.splitn(n, c)</code> returns an iterator</td></tr><tr><td>split at index</td><td><code>s.split_at(n)</code> returns tuple</td></tr><tr><td>split on any amounts of whitespace</td><td><code>s.split_whitespace()</code></td></tr><tr><td>remove prefix</td><td><code>s.strip_prefix(z)</code> returns <code>Option</code></td></tr><tr><td>remove suffix</td><td><code>s.strip_suffix(z)</code> returns <code>Option</code></td></tr><tr><td>convert <code>&amp;str</code> to <code>String</code></td><td><code>s.to_string()</code></td></tr><tr><td>convert <code>&amp;str</code> to <code>String</code></td><td><code>String::from(s)</code></td></tr><tr><td>convert <code>&amp;str</code> to <code>String</code></td><td><code>s.to_owned()</code></td></tr><tr><td>get lowercase <code>String</code></td><td><code>s.to_lowercase()</code></td></tr><tr><td>get uppercase <code>String</code></td><td><code>s.to_uppercase()</code></td></tr><tr><td>get <code>&amp;str</code> with leading and trailing whitespace removed</td><td><code>s.trim()</code></td></tr><tr><td>get <code>&amp;str</code> with trailing whitespace removed</td><td><code>s.trim_end()</code></td></tr><tr><td>get <code>&amp;str</code> with leading whitespace removed</td><td><code>s.trim_start()</code></td></tr></tbody></table><ol><li><code>start</code> is inclusive and <code>end</code> is exclusive.</li><li>The <code>chars</code> method can be used to iterate over the characters in a string. The <code>nth</code> method returns a <code>Option</code> object because the string may be shorter than the index. See the <a href="#error-handling">Error Handling</a> section for ways to get the <code>char</code> from it.</li><li>This returns an <code>Option</code> object rather than panic on bad indexes.</li><li>The <code>::&lt;T&gt;</code> syntax is called &quot;turbofish&quot; and is described later.</li><li>The <code>collect</code> method can be called on this iterator to get a <code>Vec&lt;&amp;str&gt;</code>.</li></ol><p>Many <code>String</code> methods operate on byte indexes. This works for strings that only contain ASCII characters, but is error-prone for strings that contain multi-byte Unicode characters. Methods on the <code>str</code> type are better for working with Unicode characters.</p><p>Here are operations on the <code>String</code> type. Note that methods that modify the value require the <code>String</code> to be mutable (<code>mut</code>).</p><table><thead><tr><th>Operation</th><th>Syntax</th></tr></thead><tbody><tr><td>create empty</td><td><code>String::new()</code></td></tr><tr><td>create from <code>&amp;str</code> #1</td><td><code>String::from(s)</code></td></tr><tr><td>create from <code>&amp;str</code> #2</td><td><code>s.to_string()</code></td></tr><tr><td>create from multiple <code>&amp;str</code> #1</td><td><code>let u = [s, t].concat();</code></td></tr><tr><td>create from multiple <code>&amp;str</code> #2</td><td><code>let u = format!(&quot;{}{}&quot;, s, t);</code></td></tr><tr><td>create from <code>String</code> and <code>&amp;str</code> (1)</td><td><code>let u = v + s;</code></td></tr><tr><td>create from multiple <code>String</code> values (2)</td><td><code>let u = v + &amp;w;</code></td></tr><tr><td>get <code>&amp;str</code> without copying</td><td><code>let s = &amp;t;</code></td></tr><tr><td>get <code>&amp;str</code> without copying</td><td><code>let s = t.as_str();</code></td></tr><tr><td>append <code>char</code></td><td><code>u.push(c)</code></td></tr><tr><td>append <code>&amp;str</code></td><td><code>u += s;</code></td></tr><tr><td>append <code>&amp;str</code></td><td><code>u.push_str(s)</code></td></tr><tr><td>append <code>String</code></td><td><code>u += v;</code></td></tr><tr><td>insert <code>char</code></td><td><code>u.insert(index, c)</code></td></tr><tr><td>insert <code>&amp;str</code></td><td><code>u.insert_str(v, s)</code></td></tr><tr><td>get substring</td><td><code>s.get(r)</code> same as for <code>&amp;str</code></td></tr><tr><td>get substring from index to end</td><td><code>s[start..]</code></td></tr><tr><td>get substring from beginning to index</td><td><code>s[..end]</code></td></tr><tr><td>get substring where end is exclusive</td><td><code>u[start..end]</code></td></tr><tr><td>get substring where end is inclusive</td><td><code>u[start..=end]</code></td></tr><tr><td>get <code>char</code> at index</td><td><code>&amp;u.chars().nth(index)</code></td></tr><tr><td>get length</td><td><code>u.len()</code></td></tr><tr><td>remove and return last character</td><td><code>u.pop()</code></td></tr></tbody></table><ol><li>The <code>String</code> <code>v</code> here must precede the <code>&amp;str</code> s.</li><li>All <code>String</code> values on the right of <code>=</code> after the first must be preceded by <code>&amp;</code> which converts them to <code>&amp;str</code>.</li></ol><p>Here's an example of working with Unicode characters:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> my_string <span class="token operator">=</span> <span class="token string">"Santa  "</span><span class="token punctuation">;</span><br><span class="token comment">// Get the Santa emoji character.</span><br><span class="token keyword">let</span> letter <span class="token operator">=</span> <span class="token operator">&amp;</span>my_string<span class="token punctuation">.</span><span class="token function">chars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nth</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Approach #1</span><br><span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">=</span> letter <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"letter is {}"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// </span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Approach #2</span><br><span class="token keyword">match</span> letter <span class="token punctuation">{</span><br>    <span class="token class-name">Some</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"letter is {}"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// </span><br>    <span class="token class-name">None</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// ignores when string is shorter</span><br><span class="token punctuation">}</span></code></pre><p>Here's a function that returns the first word in a string that might contain non-ASCII Unicode characters:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">first_word</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token punctuation">{</span><br>    <span class="token comment">// The chars method returns an iterator.</span><br>    <span class="token comment">// The enumerate method on the iterator returns a new iterator over</span><br>    <span class="token comment">// tuples of indexes and values in the iterator on which it is called.</span><br>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> letter<span class="token punctuation">)</span> <span class="token keyword">in</span> s<span class="token punctuation">.</span><span class="token function">chars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> letter <span class="token operator">==</span> <span class="token char">' '</span> <span class="token punctuation">{</span><br>            <span class="token comment">// Return all the characters up to,</span><br>            <span class="token comment">// but not including the space.</span><br>            <span class="token keyword">return</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token punctuation">..</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>    s<br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"foo bar baz"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> word <span class="token operator">=</span> <span class="token function">first_word</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> word<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// foo</span><br><br>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"onelongword"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> word <span class="token operator">=</span> <span class="token function">first_word</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> word<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// onelongword</span><br><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token function">first_word</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// empty string</span><br><span class="token punctuation">}</span></code></pre><p>In many programming languages strings are immutable. To make a change you create a new string and assign it back to the same variable. In Rust the <code>&amp;mut str</code> type can be used for this. If it is desirable to modify a string in place, perhaps for performance reasons, the <code>mut String</code> type can be used instead. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> <span class="token keyword">mut</span> s1 <span class="token operator">=</span> <span class="token string">"first"</span><span class="token punctuation">;</span><br>s1 <span class="token operator">=</span> <span class="token string">"second"</span><span class="token punctuation">;</span><br><br><span class="token keyword">let</span> <span class="token keyword">mut</span> s2 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"first"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>s2<span class="token punctuation">.</span><span class="token function">replace_range</span><span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token punctuation">,</span> <span class="token string">"second"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// range .. is the entire string</span></code></pre><h4 id="vectors" tabindex="-1">Vectors</h4><p>A vector is represented by the <code>Vec</code> generic type. It is a smart pointer that holds a pointer to the data on the heap, a length, and a capacity. The capacity is the length to which the data can grow before additional space must be allocated (handled automatically).</p><p>Here is a summary of commonly used <code>Vec</code> methods:</p><table><thead><tr><th>Operation</th><th>Syntax</th></tr></thead><tbody><tr><td>create empty</td><td><code>Vec::new()</code></td></tr><tr><td>create empty with capacity</td><td><code>Vec::with_capacity(capacity)</code></td></tr><tr><td>create with items</td><td><code>vec![item1, item2, ...]</code> (1)</td></tr><tr><td>append other</td><td><code>v.append(&amp;other_vector)</code></td></tr><tr><td>search for index of value when sorted</td><td><code>v.binary_search(value)</code></td></tr><tr><td>remove all items</td><td><code>v.clear()</code></td></tr><tr><td>determine if contains value</td><td><code>v.contains(value)</code></td></tr><tr><td>remove consecutive repeated items</td><td><code>v.dedup()</code></td></tr><tr><td>remove consecutive repeated items</td><td><code>v.dedup_by(fn)</code> (2)</td></tr><tr><td>remove consecutive repeated items</td><td><code>v.dedup_by_key(fn)</code> (3)</td></tr><tr><td>get first value</td><td><code>v.first()</code></td></tr><tr><td>insert at index</td><td><code>v.insert(index, value)</code></td></tr><tr><td>determine if empty</td><td><code>v.is_empty()</code></td></tr><tr><td>get iterator</td><td><code>v.iter()</code></td></tr><tr><td>get iterator that allows mutating</td><td><code>v.iter_mut()</code></td></tr><tr><td>get last value</td><td><code>v.last()</code></td></tr><tr><td>get length</td><td><code>v.len()</code></td></tr><tr><td>remove and return last item</td><td><code>v.pop()</code></td></tr><tr><td>add to end</td><td><code>v.push(value)</code></td></tr><tr><td>remove and return item at index</td><td><code>v.remove(index)</code></td></tr><tr><td>remove item with value</td><td><code>v.remove_item(index)</code></td></tr><tr><td>reverse in place</td><td><code>v.reverse()</code></td></tr><tr><td>sort in place</td><td><code>v.sort()</code></td></tr><tr><td>sort in place</td><td><code>v.sort_by(fn)</code> (2)</td></tr><tr><td>sort in place</td><td><code>v.sort_by_key(fn)</code> (3)</td></tr><tr><td>replace items</td><td><code>v.splice(range, iter)</code> (4)</td></tr><tr><td>swap items at indexes</td><td><code>v.swap(index1, index2)</code></td></tr></tbody></table><ol><li><code>vec!</code> is a macro, not a method.</li><li><code>fn</code> is passed two values and returns a <code>bool</code> indicating if the first should be removed.</li><li><code>fn</code> is passed a value and returns a computed value to be used for comparison.</li><li><code>range</code> specifies indexes to remove and <code>iter</code> specifies items to insert in their place.</li></ol><p>Also see the <a href="#iterators">Iterator</a> methods that include <code>filter</code>, <code>map</code>, <code>fold</code> (like <code>reduce</code> in JavaScript), <code>min</code>, <code>max</code>, <code>sum</code>, <code>product</code>, and more.</p><p>Here is an example of creating and operating on a vector:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> scores <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">for</span> score <span class="token keyword">in</span> <span class="token operator">&amp;</span>scores <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> grade <span class="token operator">=</span> <span class="token keyword">match</span> score <span class="token punctuation">{</span><br>            <span class="token number">90</span><span class="token punctuation">..=</span><span class="token number">100</span> <span class="token operator">=></span> <span class="token char">'A'</span><span class="token punctuation">,</span><br>            <span class="token number">80</span><span class="token punctuation">..=</span><span class="token number">89</span> <span class="token operator">=></span> <span class="token char">'B'</span><span class="token punctuation">,</span><br>            <span class="token number">70</span><span class="token punctuation">..=</span><span class="token number">79</span> <span class="token operator">=></span> <span class="token char">'C'</span><span class="token punctuation">,</span><br>            <span class="token number">60</span><span class="token punctuation">..=</span><span class="token number">69</span> <span class="token operator">=></span> <span class="token char">'D'</span><span class="token punctuation">,</span><br>            _ <span class="token operator">=></span> <span class="token char">'F'</span><span class="token punctuation">,</span><br>        <span class="token punctuation">}</span><span class="token punctuation">;</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> grade<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">let</span> total<span class="token punctuation">:</span> <span class="token keyword">u32</span> <span class="token operator">=</span> scores<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> average <span class="token operator">=</span> total <span class="token keyword">as</span> <span class="token keyword">f32</span> <span class="token operator">/</span> total <span class="token keyword">as</span> <span class="token keyword">f32</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"average = {:.1}"</span><span class="token punctuation">,</span> average<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>When a <code>Vec</code> reference is passed to a function that expects a slice reference it is automatically coerced to that type. This is because <code>Vec&lt;T&gt;</code> implements the <code>Deref</code> trait with a <code>Target</code> of <code>[T]</code>. For more on this, see the <a href="#smart-pointers">Smart Pointers</a> section. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">average_i32</span><span class="token punctuation">(</span>numbers<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">i32</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f32</span> <span class="token punctuation">{</span><br>    <span class="token comment">// The "sum" generic function doesn't know what its output type should be,</span><br>    <span class="token comment">// so that must be specified.  One approach to specify it as the type of a variable that will hold return value.</span><br>    <span class="token comment">// For example:</span><br>    <span class="token comment">// let numerator: i32 = numbers.iter().sum();</span><br>    <span class="token comment">// numerator as f32 / numbers.len() as f32</span><br>    <span class="token comment">// Another approach is to use the turbofish qualifier which is</span><br>    <span class="token comment">// ideal for specifying the type in the middle of a longer expression.</span><br>    <span class="token comment">// For example:</span><br>    numbers<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">f32</span> <span class="token operator">/</span> numbers<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">f32</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> scores <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Print average of all scores.</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"average = {:.1}"</span><span class="token punctuation">,</span> <span class="token function">average_i32</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>scores<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 86.2</span><br><br>    <span class="token comment">// Print average of all scores except the first.</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"average = {:.1}"</span><span class="token punctuation">,</span> <span class="token function">average_i32</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>scores<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 91.7</span><br><span class="token punctuation">}</span></code></pre><p>The size of items in a vector must all be the same and must be known at compile time. One way to hold items with varying sizes to place each item in a <code>Box</code> and place these in the vector. For example, this approach can be used to can create a vector of items that all implement a given trait.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Debug</span><span class="token punctuation">;</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> items<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Debug</span><span class="token operator">>></span> <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// bool</span><br>    items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token char">'X'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// char</span><br>    items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// i32</span><br>    items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">1.23</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// f64</span><br>    items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &amp;str</span><br>    items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// String</span><br>    items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// array</span><br>    items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// tuple</span><br><br>    <span class="token keyword">for</span> item <span class="token keyword">in</span> items <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><h4 id="sets" tabindex="-1">Sets</h4><p>A set is a collection of unique values.</p><p>The <code>std::collections</code> namespace defines the <code>HashSet</code> generic type.</p><p>Here is a summary of commonly used <code>HashSet</code> methods:</p><table><thead><tr><th>Operation</th><th>Syntax</th></tr></thead><tbody><tr><td>create empty</td><td><code>let set = HashSet::new()</code></td></tr><tr><td>remove all items</td><td><code>set.clear()</code></td></tr><tr><td>determine if an item is present</td><td><code>set.contains(item)</code></td></tr><tr><td>get iterator over items not in another set</td><td><code>set1.difference(set2)</code></td></tr><tr><td>get a reference to an item with a given value</td><td><code>set.get(value)</code></td></tr><tr><td>insert an item</td><td><code>set.insert(item)</code> (1)</td></tr><tr><td>get iterator over common items in two sets</td><td><code>set1.intersection(set2)</code></td></tr><tr><td>determine if empty</td><td><code>set.is_empty()</code></td></tr><tr><td>determine if a subset of another set</td><td><code>set1.is_subset(set2)</code></td></tr><tr><td>determine if a superset of another set</td><td><code>set1.is_superset(set2)</code></td></tr><tr><td>get iterator over all items</td><td><code>set.iter()</code></td></tr><tr><td>get number of items (length)</td><td><code>set.len()</code></td></tr><tr><td>remove a value</td><td><code>set.remove(value)</code></td></tr><tr><td>remove elements that do not match a predicate</td><td><code>set.retain(pred_fn)</code> (2)</td></tr><tr><td>get iterator over unique items in two sets</td><td><code>set1.union(set2)</code></td></tr></tbody></table><ol><li>returns a <code>bool</code> indicating if the item was added; <code>false</code> if already present</li><li>modifies in place</li></ol><p>Here is an example of creating and using a <code>HashSet</code> containing <code>String</code> elements. Using the <code>String</code> type rather than <code>&amp;str</code> allows the <code>HashSet</code> to own the values so they have the same lifetime as the <code>HashSet</code> which is generally desirable.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashSet</span><span class="token punctuation">;</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Element type is inferred from what is inserted.</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> colors <span class="token operator">=</span> <span class="token class-name">HashSet</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    colors<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"red"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    colors<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"green"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    colors<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"blue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> colors<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {"red", "green", "blue"}</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> colors<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> colors<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"green"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> colors<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"orange"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span><br><br>    colors<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">"green"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> colors<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {"blue", "red"}</span><br><br>    <span class="token keyword">for</span> color <span class="token keyword">in</span> <span class="token operator">&amp;</span>colors <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> color<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// blue then red</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>Here is an example of creating and using a <code>HashSet</code> containing <code>struct</code> elements:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashSet</span><span class="token punctuation">;</span><br><br><span class="token attribute attr-name">#[derive(Debug, Eq, Hash, PartialEq)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Dog</span> <span class="token punctuation">{</span><br>    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>    breed<span class="token punctuation">:</span> <span class="token class-name">String</span><br><span class="token punctuation">}</span><br><span class="token keyword">impl</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span><br>    <span class="token comment">// This is a constructor function where</span><br>    <span class="token comment">// the name "new" is used by convention.</span><br>    <span class="token comment">// The type "Self" here refers to "Dog".</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> breed<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span><br>        <span class="token keyword">Self</span> <span class="token punctuation">{</span><br>            name<span class="token punctuation">:</span> name<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            breed<span class="token punctuation">:</span> breed<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> dogs <span class="token operator">=</span> <span class="token class-name">HashSet</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    dogs<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Dog</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Maisey"</span><span class="token punctuation">,</span> <span class="token string">"Treeing Walker Coonhound"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    dogs<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Dog</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Ramsay"</span><span class="token punctuation">,</span> <span class="token string">"Native American Indian Dog"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    dogs<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Dog</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Oscar"</span><span class="token punctuation">,</span> <span class="token string">"German Shorthaired Pointer"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    dogs<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Dog</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Comet"</span><span class="token punctuation">,</span> <span class="token string">"Whippet"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"dogs = {:#?}"</span><span class="token punctuation">,</span> dogs<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">for</span> dog <span class="token keyword">in</span> <span class="token operator">&amp;</span>dogs <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> dog<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">let</span> comet <span class="token operator">=</span> <span class="token class-name">Dog</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Comet"</span><span class="token punctuation">,</span> <span class="token string">"Whippet"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> spot <span class="token operator">=</span> <span class="token class-name">Dog</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Spot"</span><span class="token punctuation">,</span> <span class="token string">"Beagle"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> dogs<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>comet<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> dogs<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>spot<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span><br><span class="token punctuation">}</span></code></pre><h4 id="maps" tabindex="-1">Maps</h4><p>Maps are collections of key/value pairs. Keys can be any type, but they must all be the same type. The same is true for values.</p><p>The <code>std::collections</code> namespace defines the <code>HashMap</code> generic type.</p><p>Here is a summary of commonly used <code>HashMap</code> methods:</p><table><thead><tr><th>Operation</th><th>Syntax</th></tr></thead><tbody><tr><td>create empty</td><td><code>let map = HashMap::new()</code></td></tr><tr><td>remove all items</td><td><code>map.clear()</code></td></tr><tr><td>determine if a key is present</td><td><code>set.contains_key(key)</code></td></tr><tr><td>get value associated with a key</td><td><code>map.get(key)</code> (1)</td></tr><tr><td>get mutable value associated with a key</td><td><code>map.get_mut(key)</code> (1)</td></tr><tr><td>insert key/value pair</td><td><code>map.insert(key, value)</code> (2)</td></tr><tr><td>determine if empty</td><td><code>map.is_empty()</code></td></tr><tr><td>get iterator over key/value pairs as tuples</td><td><code>map.iter()</code></td></tr><tr><td>get mutable iterator over key/value pairs as tuples</td><td><code>map.iter_mut()</code></td></tr><tr><td>get iterator over keys</td><td><code>map.keys()</code></td></tr><tr><td>get number of key/value pairs (length)</td><td><code>map.len()</code></td></tr><tr><td>get value for key, inserting default value if not present</td><td><code>map.entry(key).or_insert(initial-value)</code></td></tr><tr><td>remove a key/value pair</td><td><code>map.remove(key)</code> (2)</td></tr><tr><td>remove key/value pairs that do not match a predicate</td><td><code>map.retain(pred_fn)</code> (3)</td></tr><tr><td>get iterator over values</td><td><code>map.values()</code></td></tr><tr><td>get iterator over mutable values</td><td><code>map.values_mut()</code></td></tr></tbody></table><ol><li>returns an <code>Option</code></li><li>returns <code>Some(old_value)</code> if key was already present and <code>None</code> otherwise</li><li>modifies in place</li></ol><p>Here is an example of creating and using a <code>HashMap</code> containing <code>String</code> keys and <code>i32</code> values. Using the <code>String</code> type for keys rather than <code>&amp;str</code> allows the <code>HashMap</code> to own the values so they have the same lifetime as the <code>HashMap</code> which is generally desirable.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">get_shortest_v1</span><span class="token punctuation">(</span>months<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">i8</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> shortest<span class="token punctuation">:</span> <span class="token keyword">i8</span> <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token keyword">i8</span><span class="token punctuation">::</span><span class="token constant">MAX</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> name<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token class-name">None</span><span class="token punctuation">;</span><br>    <span class="token keyword">for</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token operator">&amp;</span>val<span class="token punctuation">)</span> <span class="token keyword">in</span> months <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> val <span class="token operator">&lt;</span> shortest <span class="token punctuation">{</span><br>            name <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span><br>            shortest <span class="token operator">=</span> val<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>    name<br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">get_shortest_v2</span><span class="token punctuation">(</span>months<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">i8</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token operator">></span> <span class="token punctuation">{</span><br>      <span class="token comment">// The HashMap iter method returns</span><br>      <span class="token comment">// an iterator over (key, value) tuples.</span><br>      months<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token comment">// The Iter min_by_key method is passed a closure and returns</span><br>        <span class="token comment">// an Option that wraps the smallest value returned by the closure.</span><br>        <span class="token comment">// The closure is passed each tuple, one at a time,</span><br>        <span class="token comment">// and returns the value to be compared.</span><br>        <span class="token comment">// In this case it is the second element in the tuple (at index 1).</span><br>        <span class="token punctuation">.</span><span class="token function">min_by_key</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>p<span class="token closure-punctuation punctuation">|</span></span> p<span class="token number">.1</span><span class="token punctuation">)</span><br>        <span class="token comment">// The Option map is called on an Option of one type</span><br>        <span class="token comment">// and returns an Option of another.</span><br>        <span class="token comment">// In this case it is called on an Option wrapping a (key, value) tuple</span><br>        <span class="token comment">// and returns an Option wrapping just the key (at index 0).</span><br>        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>p<span class="token closure-punctuation punctuation">|</span></span> p<span class="token number">.0</span><span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> days_in_month<span class="token punctuation">:</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">i8</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    days_in_month<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"January"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    days_in_month<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"February"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    days_in_month<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"March"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    days_in_month<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"April"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"daysInMonth = {:#?}"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>days_in_month<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">for</span> <span class="token punctuation">(</span>month<span class="token punctuation">,</span> days<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token operator">&amp;</span>days_in_month <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"There are {} days in {}."</span><span class="token punctuation">,</span> days<span class="token punctuation">,</span> month<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"entries = {:?}"</span><span class="token punctuation">,</span> days_in_month<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span><br><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"days in March = {:?}"</span><span class="token punctuation">,</span> days_in_month<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"March"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// get_shortest_v1 and get_shortest_v2 return the same value.</span><br>    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>shortest<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">get_shortest_v1</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>days_in_month<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"shortest = {}"</span><span class="token punctuation">,</span> shortest<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// February</span><br>    <span class="token punctuation">}</span><br><br>    days_in_month<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">"February"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"entries = {:?}"</span><span class="token punctuation">,</span> days_in_month<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"days in February = {:?}"</span><span class="token punctuation">,</span> days_in_month<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"February"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> month <span class="token operator">=</span> <span class="token string">"April"</span><span class="token punctuation">;</span><br>    <span class="token keyword">match</span> days_in_month<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>month<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token class-name">Some</span><span class="token punctuation">(</span>days<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"There are {} days in {}."</span><span class="token punctuation">,</span> days<span class="token punctuation">,</span> month<span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token class-name">None</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"No data found for {}."</span><span class="token punctuation">,</span> month<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>Here is an example of creating and using a <code>HashMap</code> with <code>String</code> keys and <code>struct</code> values:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span><br><br><span class="token attribute attr-name">#[derive(Debug, Eq, Hash, PartialEq)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Dog</span> <span class="token punctuation">{</span><br>    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>    breed<span class="token punctuation">:</span> <span class="token class-name">String</span><br><span class="token punctuation">}</span><br><span class="token keyword">impl</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> breed<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span><br>        <span class="token keyword">Self</span> <span class="token punctuation">{</span><br>            name<span class="token punctuation">:</span> name<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            breed<span class="token punctuation">:</span> breed<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Key and value types are inferred from what is inserted.</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> dogs <span class="token operator">=</span> <span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// This function must be a closure so it can access dogs.</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> add_dog <span class="token operator">=</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> breed<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span><br>        dogs<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Dog</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> breed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>    <span class="token function">add_dog</span><span class="token punctuation">(</span><span class="token string">"Maisey"</span><span class="token punctuation">,</span> <span class="token string">"Treeing Walker Coonhound"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">add_dog</span><span class="token punctuation">(</span><span class="token string">"Ramsay"</span><span class="token punctuation">,</span> <span class="token string">"Native American Indian Dog"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">add_dog</span><span class="token punctuation">(</span><span class="token string">"Oscar"</span><span class="token punctuation">,</span> <span class="token string">"German Shorthaired Pointer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">add_dog</span><span class="token punctuation">(</span><span class="token string">"Comet"</span><span class="token punctuation">,</span> <span class="token string">"Whippet"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"dogs = {:#?}"</span><span class="token punctuation">,</span> dogs<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"entries = {:?}"</span><span class="token punctuation">,</span> dogs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Comet = {:#?}"</span><span class="token punctuation">,</span> dogs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"Comet"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    dogs<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">"Comet"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"entries = {:?}"</span><span class="token punctuation">,</span> dogs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span><br><br>    <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">"Oscar"</span><span class="token punctuation">;</span><br>    <span class="token keyword">match</span> dogs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token class-name">Some</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"found {:#?}."</span><span class="token punctuation">,</span> dog<span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token class-name">None</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"No dog named {} found."</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">for</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> dog<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token operator">&amp;</span>dogs <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{} is a {}."</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> dog<span class="token punctuation">.</span>breed<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>For a longer example of using a <code>HashMap</code> and the <code>entry</code> method, see <a href="https://github.com/mvolkmann/rust-poker?v=1.1.1" rel="noopener" target="_blank">rust-poker</a>. The file <code>src/lib.rs</code> defines the <code>evaluate</code> method of the <code>Hand</code> struct. This uses the <code>entry</code> method to determine the number of cards in the hand from each suit and rank. This repository also serves as a good example of implementing doc tests, unit tests, and integration tests.</p><h2 id="slices" tabindex="-1">Slices</h2><p>A slice is a borrowed reference to a contiguous subset of a collection that is represented by pointer and a length. For example, a slice of a <code>String</code> has the type <code>&amp;str</code> which holds a pointer and a length. Slice are created on a reference (<code>&amp;</code>) using a range (<code>[start..end]</code>). Indexes that are out of bounds are caught at runtime, not compile-time. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"abcdefgh"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// The &amp; here says we are getting a "reference" to a portion of the string.</span><br><span class="token keyword">let</span> sub <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">..</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> sub<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "def"</span><br><br><span class="token keyword">let</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"orange"</span><span class="token punctuation">,</span> <span class="token string">"yellow"</span><span class="token punctuation">,</span> <span class="token string">"green"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">,</span> <span class="token string">"purple"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br><span class="token keyword">let</span> slice1 <span class="token operator">=</span> <span class="token operator">&amp;</span>colors<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> slice1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ["orange", "yellow", "green", "blue"]</span><br><br><span class="token comment">// We can get a slice of a slice.</span><br><span class="token keyword">let</span> slice2 <span class="token operator">=</span> <span class="token operator">&amp;</span>slice1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> slice2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ["yellow", "green"]</span></code></pre><p>Many kinds of collections, including arrays and vectors, support obtaining slices of their items. This includes strings, arrays, and vectors.</p><p>For example:</p><pre class="language-rust"><code class="language-rust"></code></pre><p>Mutable slices allow their items to be mutated. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Create a vector of &amp;str values.</span><br>    <span class="token keyword">let</span> original <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"orange"</span><span class="token punctuation">,</span> <span class="token string">"yellow"</span><span class="token punctuation">,</span> <span class="token string">"green"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">,</span> <span class="token string">"purple"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Create a vector of String values from original.</span><br>    <span class="token comment">// map is lazy and collect forces its evaluation.</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> colors <span class="token operator">=</span> original<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>c<span class="token closure-punctuation punctuation">|</span></span> c<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">>></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Change a subset of the colors to uppercase.</span><br>    <span class="token keyword">let</span> subset <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> colors<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token keyword">for</span> color <span class="token keyword">in</span> subset <span class="token punctuation">{</span><br>        color<span class="token punctuation">.</span><span class="token function">make_ascii_uppercase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> colors<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ["red", "ORANGE", "YELLOW", "GREEN", "blue", "purple"]</span><br><span class="token punctuation">}</span></code></pre><p>For details on the syntax for specifying ranges, see <a href="#ranges">Ranges</a>.</p><h2 id="conditional-logic" tabindex="-1">Conditional Logic</h2><p>The most common way to implement conditional logic is with an <code>if</code> expressions. The expression after the <code>if</code> keyword must evaluate to a <code>bool</code> value. It is not surrounded by parentheses and code to be executed must be surrounded curly braces, even if there is only one statement or expression. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">if</span> temperature <span class="token operator">></span> <span class="token number">90</span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"hot"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> temperature <span class="token operator">&lt;</span> <span class="token number">40</span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"cold"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"tolerable"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>An <code>if</code> expression can be assigned to a variable and newlines are not required. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> color <span class="token operator">=</span> <span class="token keyword">if</span> temperature <span class="token operator">></span> <span class="token number">90</span> <span class="token punctuation">{</span> <span class="token string">"red"</span> <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token string">"blue"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>Other ways to implement conditional logic include <code>if let</code> and <code>match</code> expressions which use pattern matching to extract a value. These were shown in the <a href="#error-handling">Error Handling</a> section.</p><p>A <code>match</code> expression can match the following kinds of values: boolean, integer, &amp;str, String, and enum. These must be exhaustive, meaning that they account for every possible value of the expression being matched. An underscore can be used as a wildcard match. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> month <span class="token operator">=</span> <span class="token string">"February"</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> holiday <span class="token operator">=</span> <span class="token keyword">match</span> month <span class="token punctuation">{</span><br>    <span class="token string">"January"</span> <span class="token operator">=></span> <span class="token string">"New Year's Day"</span><span class="token punctuation">,</span><br>    <span class="token string">"February"</span> <span class="token operator">=></span> <span class="token string">"Valentine's Day"</span><span class="token punctuation">,</span><br>    <span class="token string">"July"</span> <span class="token operator">=></span> <span class="token string">"Independence Day"</span><span class="token punctuation">,</span><br>    <span class="token string">"October"</span> <span class="token operator">=></span> <span class="token string">"Halloween"</span><span class="token punctuation">,</span><br>    <span class="token string">"November"</span> <span class="token operator">=></span> <span class="token string">"Thanksgiving"</span><span class="token punctuation">,</span><br>    <span class="token string">"December"</span> <span class="token operator">=></span> <span class="token string">"Christmas"</span><span class="token punctuation">,</span><br>    _ <span class="token operator">=></span> <span class="token string">"unknown"</span> <span class="token comment">// matches any other value</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"The holiday in {} is {}."</span><span class="token punctuation">,</span> month<span class="token punctuation">,</span> holiday<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The lines containing <code>=&gt;</code> are referred to as &quot;match arms&quot;. They can match a single pattern or one of a set of patterns separated by <code>|</code> characters. Patterns can be literal values of the types <code>bool</code>, <code>char</code>, <code>&amp;str</code>, non-negative integer, wildcard (<code>_</code>), tuple of these types, array of these types, inclusive range (<code>m..=n</code>, not <code>m..n</code>), enum variant, or struct. There are a few more less commonly used patterns that are supported. For details, see <a href="https://doc.rust-lang.org/reference/patterns.html?v=1.1.1" rel="noopener" target="_blank">Patterns</a>.</p><p>The part on the right side of <code>=&gt;</code> can be an expression or a block.</p><p>For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">get_points</span><span class="token punctuation">(</span>rank<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i8</span> <span class="token punctuation">{</span><br>    <span class="token keyword">match</span> rank <span class="token punctuation">{</span><br>        <span class="token string">"Jack"</span> <span class="token operator">|</span> <span class="token string">"Queen"</span> <span class="token operator">|</span> <span class="token string">"King"</span> <span class="token operator">=></span> <span class="token number">10</span><span class="token punctuation">,</span><br>        <span class="token string">"Ace"</span> <span class="token operator">=></span> <span class="token number">1</span><span class="token punctuation">,</span><br>        _ <span class="token operator">=></span> <span class="token keyword">match</span> rank<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">i8</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>              <span class="token class-name">Ok</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span> <span class="token operator">=></span> points<span class="token punctuation">,</span><br>              <span class="token class-name">Err</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token number">0</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> cards <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"7"</span><span class="token punctuation">,</span> <span class="token string">"Jack"</span><span class="token punctuation">,</span> <span class="token string">"Ace"</span><span class="token punctuation">,</span> <span class="token string">"5"</span><span class="token punctuation">,</span> <span class="token string">"bad"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token keyword">for</span> rank <span class="token keyword">in</span> <span class="token operator">&amp;</span>cards <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Points for {} is {}."</span><span class="token punctuation">,</span> rank<span class="token punctuation">,</span> <span class="token function">get_points</span><span class="token punctuation">(</span>rank<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> category <span class="token operator">=</span> <span class="token keyword">match</span> age <span class="token punctuation">{</span><br>        <span class="token comment">// The ranges cannot overlap and</span><br>        <span class="token comment">// must use "..=" rather than "..".</span><br>        <span class="token number">0</span><span class="token punctuation">..=</span><span class="token number">2</span> <span class="token operator">=></span> <span class="token string">"toddler"</span><span class="token punctuation">,</span><br>        <span class="token number">3</span><span class="token punctuation">..=</span><span class="token number">12</span> <span class="token operator">=></span> <span class="token string">"child"</span><span class="token punctuation">,</span><br>        <span class="token number">13</span><span class="token punctuation">..=</span><span class="token number">19</span> <span class="token operator">=></span> <span class="token string">"teen"</span><span class="token punctuation">,</span><br>        <span class="token number">20</span><span class="token punctuation">..=</span><span class="token number">59</span> <span class="token operator">=></span> <span class="token string">"adult"</span><span class="token punctuation">,</span><br>        _ <span class="token operator">=></span> <span class="token string">"senior"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{} is a {}."</span><span class="token punctuation">,</span> age<span class="token punctuation">,</span> category<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>The expression being evaluated can be a complex type such as a tuple. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> suit <span class="token operator">=</span> <span class="token string">"diamond"</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> rank <span class="token operator">=</span> <span class="token string">"queen"</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> card <span class="token operator">=</span> <span class="token keyword">match</span> <span class="token punctuation">(</span>suit<span class="token punctuation">,</span> rank<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token punctuation">(</span><span class="token string">"spade"</span><span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">"a spade"</span><span class="token punctuation">,</span><br>    <span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token string">"king"</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">"a king"</span><span class="token punctuation">,</span><br>    <span class="token punctuation">(</span><span class="token string">"diamond"</span><span class="token punctuation">,</span> <span class="token string">"queen"</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">"queen of diamonds"</span><span class="token punctuation">,</span><br>    _ <span class="token operator">=></span> <span class="token string">"something else"</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Your card is {}."</span><span class="token punctuation">,</span> card<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>A &quot;match guard&quot; adds an <code>if</code> expression to a match pattern. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Point2D</span> <span class="token punctuation">{</span><br>    x<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span><br>    y<span class="token punctuation">:</span> <span class="token keyword">i32</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> numbers <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Suppose the numbers are supposed to be between 1 and 10 inclusive</span><br>    <span class="token comment">// and we want to know whether each is even, odd,</span><br>    <span class="token comment">// or invalid because it is outside that range.</span><br>    <span class="token keyword">for</span> n <span class="token keyword">in</span> numbers <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> describe <span class="token operator">=</span> <span class="token keyword">match</span> n <span class="token punctuation">{</span><br>            <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">10</span> <span class="token keyword">if</span> n <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">=></span> <span class="token string">"even"</span><span class="token punctuation">,</span><br>            <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">10</span> <span class="token keyword">if</span> n <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">=></span> <span class="token string">"odd"</span><span class="token punctuation">,</span><br>            _ <span class="token keyword">if</span> n <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">=></span> <span class="token string">"too high"</span><span class="token punctuation">,</span><br>            _ <span class="token operator">=></span> <span class="token string">"negative"</span> <span class="token comment">// only other possibility</span><br>        <span class="token punctuation">}</span><span class="token punctuation">;</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"n is {}"</span><span class="token punctuation">,</span> describe<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// odd, even, negative, too high</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> pt <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Structs can be matched, but</span><br>    <span class="token comment">// floating point values cannot be used in match patterns.</span><br>    <span class="token comment">// This is why the Point2D struct here uses integer values.</span><br>    <span class="token keyword">let</span> describe <span class="token operator">=</span> <span class="token keyword">match</span> pt <span class="token punctuation">{</span><br>        <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token operator">=></span> <span class="token string">"origin"</span><span class="token punctuation">,</span><br>        <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> _<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token operator">=></span> <span class="token string">"x-axis"</span><span class="token punctuation">,</span><br>        <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> _ <span class="token punctuation">}</span> <span class="token operator">=></span> <span class="token string">"y-axis"</span><span class="token punctuation">,</span><br>        <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token keyword">if</span> x <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> y <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">=></span> <span class="token string">"1st quadrant"</span><span class="token punctuation">,</span><br>        <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token keyword">if</span> x <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> y <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">=></span> <span class="token string">"2nd quadrant"</span><span class="token punctuation">,</span><br>        <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token keyword">if</span> x <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> y <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">=></span> <span class="token string">"3rd quadrant"</span><span class="token punctuation">,</span><br>        <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token keyword">if</span> x <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> y <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">=></span> <span class="token string">"4th quadrant"</span><span class="token punctuation">,</span><br>        _ <span class="token operator">=></span> <span class="token string">"impossible"</span> <span class="token comment">// doesn't know about conditions are exhaustive</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> describe<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4th quadrant</span><br><span class="token punctuation">}</span></code></pre><p>Rust does not support the ternary operator (<code>? :</code>) found in many other programming languages. Since <code>if</code> expressions have a value, the following can be written to simulate a ternary:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">const</span> color <span class="token operator">=</span> <span class="token keyword">if</span> temperature <span class="token operator">></span> <span class="token number">90</span> <span class="token punctuation">{</span> <span class="token string">"red"</span> <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token string">"blue"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>It is possible to write a macro to mimic this, but it doesn't reduce the expression much. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token macro property">macro_rules!</span> tern <span class="token punctuation">{</span><br>    <span class="token punctuation">(</span><span class="token variable">$cond</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span> <span class="token operator">=></span> <span class="token variable">$true_expr</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">,</span> <span class="token variable">$false_expr</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token variable">$cond</span> <span class="token punctuation">{</span><br>            <span class="token variable">$true_expr</span><br>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>            <span class="token variable">$false_expr</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> temperature <span class="token operator">=</span> <span class="token number">80</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> color <span class="token operator">=</span> <span class="token macro property">tern!</span><span class="token punctuation">(</span>temperature <span class="token operator">></span> <span class="token number">90</span> <span class="token operator">=></span> <span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> color<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// blue</span><br><span class="token punctuation">}</span></code></pre><h2 id="iteration-(looping)" tabindex="-1">Iteration (Looping)</h2><p>Rust supports the following loop expressions:</p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code>loop</code></td><td>infinite loop that can be exited with a <code>break</code></td></tr><tr><td><code>while</code></td><td>top-tested loop that repeats as long as an expression evaluates to <code>true</code></td></tr><tr><td><code>while let</code></td><td>like <code>while</code>, but repeats as long as a pattern match succeeds</td></tr><tr><td><code>for</code></td><td>for looping over an iterator</td></tr></tbody></table><p>All these support using the a <code>break</code> statement to break out of the loop and the <code>continue</code> statement to advance to the next iteration. While not commonly used, <code>break</code> can be followed by an expression whose value becomes the value of a <code>loop</code> expression. This is not permitted inside <code>while</code>, <code>while let</code>, or <code>for</code> loops.</p><p>See the <a href="#standard-io">Standard IO</a> section for an example using <code>loop</code>.</p><p>Here's an example of using a <code>while</code> loop:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Item</span> <span class="token punctuation">{</span><br>    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>    price<span class="token punctuation">:</span> <span class="token keyword">u32</span> <span class="token comment">// in cents</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> items<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Item</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><br>        <span class="token class-name">Item</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">"milk"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> price<span class="token punctuation">:</span> <span class="token number">289</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>        <span class="token class-name">Item</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">"bread"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> price<span class="token punctuation">:</span> <span class="token number">349</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>        <span class="token class-name">Item</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">"orange juice"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> price<span class="token punctuation">:</span> <span class="token number">479</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>        <span class="token class-name">Item</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">"cheese"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> price<span class="token punctuation">:</span> <span class="token number">399</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>        <span class="token class-name">Item</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">"cereal"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> price<span class="token punctuation">:</span> <span class="token number">379</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> len <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> wallet <span class="token operator">=</span> <span class="token number">1200</span><span class="token punctuation">;</span> <span class="token comment">// $12</span><br><br>    <span class="token comment">// Buy items until there isn't enough left in the wallet.</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br>    <span class="token keyword">while</span> index <span class="token operator">&lt;</span> len <span class="token operator">&amp;&amp;</span> wallet <span class="token operator">>=</span> items<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>price <span class="token punctuation">{</span><br>      wallet <span class="token operator">-=</span> items<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>price<span class="token punctuation">;</span><br>      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"bought {}"</span><span class="token punctuation">,</span> items<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// milk, bread, and orange juice</span><br>      index <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// Here is a somewhat nicer approach using a for loop:</span><br>    <span class="token comment">/*<br>    for item in items {<br>        if wallet &lt; item.price { break; }<br>        wallet -= item.price;<br>        println!("bought {}", item.name); // milk, bread, and orange juice<br>    }<br>    */</span><br><span class="token punctuation">}</span></code></pre><p>A <code>while let</code> loop is useful when iterating over repeated calls to a function that might fail. The example below uses the <code>futures</code> and <code>rand</code> crates which requires adding the dependencies <code>futures = &quot;0.3.8&quot;</code> and <code>rand = &quot;0.8.2&quot;</code> to <code>Cargo.toml</code>. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">futures<span class="token punctuation">::</span>executor<span class="token punctuation">::</span></span>block_on<span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">rand<span class="token punctuation">::</span></span><span class="token class-name">Rng</span><span class="token punctuation">;</span><br><br><span class="token comment">// Pretend this function makes a REST call that could possibly fail.</span><br><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">get_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">i8</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'static</span> <span class="token keyword">str</span><span class="token operator">></span> <span class="token punctuation">{</span><br>  <span class="token comment">// rng stands for "random number generator".</span><br>  <span class="token keyword">let</span> <span class="token keyword">mut</span> rng <span class="token operator">=</span> <span class="token namespace">rand<span class="token punctuation">::</span></span><span class="token function">thread_rng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">let</span> n <span class="token operator">=</span> rng<span class="token punctuation">.</span><span class="token function">gen_range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// number from 1 to 10</span><br>  <span class="token comment">// Fail if n is greater than 7.</span><br>  <span class="token keyword">if</span> n <span class="token operator">&lt;=</span> <span class="token number">7</span> <span class="token punctuation">{</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token string">"failed"</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Here is an approach for processing the result of a single call.</span><br>    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">block_on</span><span class="token punctuation">(</span><span class="token function">get_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">match</span> result <span class="token punctuation">{</span><br>        <span class="token class-name">Ok</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"in single call, n = {}"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token class-name">Err</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"error: {}"</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// Here is an approach for processing calls in a loop</span><br>    <span class="token comment">// that continues until an Err is returned.</span><br>    <span class="token keyword">while</span> <span class="token keyword">let</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">block_on</span><span class="token punctuation">(</span><span class="token function">get_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"in while let, n = {}"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>A <code>for</code> loop is used to iterate over any kind of iterator. It can operate on an explicitly obtained iterator or it can obtain an iterator from any type that implements the <code>IntoIterator</code> trait. Collection types such as <code>Range</code>, <code>HashMap</code>, <code>HashSet</code>, and <code>Vec</code> implement this, but arrays and tuples do not. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// We can use range notation to iterate over a range of numbers</span><br>    <span class="token comment">// where the first number inclusive and the last is exclusive.</span><br>    <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">4</span> <span class="token punctuation">{</span> <span class="token comment">// 1, 2, and 3</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"loop 1: n = {}"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token comment">// Adding = before the second number makes the range inclusive.</span><br>    <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">4</span> <span class="token punctuation">{</span> <span class="token comment">// 1, 2, 3, and 4</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"loop 2: n = {}"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// Iterating over the items in a tuple is not supported, but we</span><br>    <span class="token comment">// can iterate over the items in an array using the "iter" method.</span><br>    <span class="token keyword">let</span> num_arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token keyword">for</span> n <span class="token keyword">in</span> num_arr<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"loop 3: n = {:?}"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// The iter_mut method allows items to be mutated during iteration.</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> num_arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token comment">// Double all the numbers during iteration.</span><br>    <span class="token keyword">for</span> n <span class="token keyword">in</span> num_arr<span class="token punctuation">.</span><span class="token function">iter_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token operator">*</span>n <span class="token operator">*=</span> <span class="token number">2</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">for</span> n <span class="token keyword">in</span> num_arr<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"loop 4: {:?}"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// values are doubled</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// Another approach is to create a new array of modified values</span><br>    <span class="token comment">// using the array map method that is considered experimental</span><br>    <span class="token comment">// and only available in nightly builds as of 12/13/20.</span><br>    <span class="token comment">//let new_numbers = numbers.map(|n| n * 2);</span><br><br>    <span class="token comment">// We can call the map method on an iterator</span><br>    <span class="token comment">// to create a new iterator over doubled numbers.</span><br>    <span class="token keyword">let</span> new_iter <span class="token operator">=</span> num_arr<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>n<span class="token closure-punctuation punctuation">|</span></span> n <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">for</span> n <span class="token keyword">in</span> new_iter <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"loop 5: {:?}"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// values are doubled</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// We can iterate over the items in a vector</span><br>    <span class="token comment">// without calling the "iter" method.</span><br>    <span class="token keyword">let</span> num_vec <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token keyword">for</span> n <span class="token keyword">in</span> num_vec <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"loop 6: n = {:?}"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>Let's look at one more iteration example that requires specifying lifetimes. The function <code>longest</code> is passed a reference to an array of strings. There are three lifetimes to consider, that of the array, that of the items inside it, and that of the return value. Rust wants to know that the array items will live as long as the return value since one of them will be returned. We must specify that with lifetime annotations (<code>'a</code> below).</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">longest</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">></span><span class="token punctuation">(</span>strings<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">str</span> <span class="token punctuation">{</span><br>    strings<br>        <span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">fold</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>acc<span class="token punctuation">,</span> s<span class="token closure-punctuation punctuation">|</span></span> <span class="token keyword">if</span> s<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> acc<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> s <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> acc <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> fruits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"apple"</span><span class="token punctuation">,</span> <span class="token string">"banana"</span><span class="token punctuation">,</span> <span class="token string">"cherry"</span><span class="token punctuation">,</span> <span class="token string">"date"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">longest</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>fruits<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"longest is {}"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// banana</span><br><span class="token punctuation">}</span></code></pre><h2 id="functions" tabindex="-1">Functions</h2><p>Functions are defined using the <code>fn</code> keyword, followed by a name, parameter list, return type, and body. Functions that do not return anything omit the return type rather than specify a type like <code>void</code> as is done in some other languages. Functions that might fail should return a <code>Result</code> enum to allow callers to handle errors. See the &quot;Error Handling&quot; section for details.</p><p>A <code>return</code> statement returns the value of an expression. If the last statement is not terminated by a semicolon, its value is returned. This means that <code>return my_result;</code> is equivalent to <code>my_result</code>.</p><p>For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">average</span><span class="token punctuation">(</span>numbers<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">f64</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f64</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> sum<span class="token punctuation">:</span> <span class="token keyword">f64</span> <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    sum <span class="token operator">/</span> numbers<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">f64</span> <span class="token comment">// return value</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">greet</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Hello, {}!"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> numbers<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">f64</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">4.0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"average = {}"</span><span class="token punctuation">,</span> <span class="token function">average</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>numbers<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">greet</span><span class="token punctuation">(</span><span class="token string">"World"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>The documentation for the <code>Copy</code> trait says that values of types that implement it &quot;can be duplicated by simply copying bits&quot;. When such a value is passed to a function, rather than passing a reference, a copy is created and ownership of the original value is not transferred. All primitive types such as <code>bool</code>, <code>char</code>, <code>i32</code>, and <code>f64</code> implement <code>Copy</code>. However, structs and collection types like tuple, array, <code>Vec</code>, <code>HashMap</code>, and <code>HashMap</code> do not. You can choose to implement the <code>Copy</code> trait for custom structs if all their fields also implement it.</p><p>Function parameters of non-Copy types typically use reference types. This is because usually the function wants to borrow their values rather than take ownership. If the caller uses a variable to pass a non-Copy value, and the function takes ownership, the caller loses ownership and can no longer use the variable unless the function returns it.</p><p>Function return values typically have non-reference types. This is because usually the function creates the value and wants to transfer ownership to the caller. If a function creates a value and returns a reference to it, the code will not compile because the value goes out of scope and is dropped.</p><p>Function parameters that are strings that are not mutated by the function should almost always have the type <code>&amp;str</code>. This allows many string representations to be passed in including literal strings, <code>&amp;str</code> values, and references to <code>String</code> values (not <code>String</code> values). Functions that create and return strings have the return type <code>String</code> so ownership can be transferred to the caller.</p><p>Functions that take data from arrays or vectors typically should have slice parameters. This makes them more flexible than taking a reference to an array or vector because callers can pass an array, vector, or slice of them.</p><p>Functions are accessible by default within the same source file, but they are private by default when defined in a different source file. For functions that should be visible outside the source file that defines them, add the <code>pub</code> keyword before the <code>fn</code> keyword.</p><p>In the <a href="#ownership-model">Ownership Model</a> section we learned that closures are functions that capture values in their environment so they can be access later when the function is executed. Functions defined with the <code>fn</code> keyword are not closures. Closures are defined as anonymous functions with a parameter list written between vertical bars which must be present even if there are no parameters.</p><p>Rust does not support writing functions that accept a variable number of arguments (variadic), but macros can do this. Functions can instead be passed in an array. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token comment">// This takes an array of strings and returns one of them.</span><br><span class="token comment">// Lifetimes must be specified, but why?</span><br><span class="token keyword">fn</span> <span class="token function-definition function">longest</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">></span><span class="token punctuation">(</span>strings<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">str</span> <span class="token punctuation">{</span><br>    strings<br>        <span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">fold</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>acc<span class="token punctuation">,</span> s<span class="token closure-punctuation punctuation">|</span></span> <span class="token keyword">if</span> s<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> acc<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> s <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> acc <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> fruits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"apple"</span><span class="token punctuation">,</span> <span class="token string">"banana"</span><span class="token punctuation">,</span> <span class="token string">"cherry"</span><span class="token punctuation">,</span> <span class="token string">"date"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">longest</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>fruits<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"longest is {}"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h2 id="iterators" tabindex="-1"><a name="iterators">Iterators</a></h2><p>Many Rust methods return a <code>std::iter::Iterator</code> that can be used to iterate over the elements of a collection. Iterators are lazy, meaning that they do not pre-compute the values they will return.</p><p>The commonly used methods for creating an iterator over a collection include:</p><ul><li><code>iter</code> for iterating over immutable references to items</li><li><code>iter_mut</code> for iterating over mutable references to items</li><li><code>into_iter</code> for iterating over items</li></ul><p>Here is an example of modifying the items in a collection while iterating over it.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> <span class="token keyword">mut</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"red"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"orange"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"yellow"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token keyword">for</span> color <span class="token keyword">in</span> colors<span class="token punctuation">.</span><span class="token function">iter_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token operator">*</span>color <span class="token operator">=</span> color<span class="token punctuation">.</span><span class="token function">to_uppercase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>The <code>into_iter</code> method is described by the <code>IntoIterator</code> trait. Collections that implement this can be iterated over using a <code>for</code> loop without needing to call one of the methods listed above. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"orange"</span><span class="token punctuation">,</span> <span class="token string">"yellow"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token keyword">for</span> color <span class="token keyword">in</span> <span class="token operator">&amp;</span>colors <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> color<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// red then orange then yellow</span><br><span class="token punctuation">}</span></code></pre><p>The <code>Iterator</code> trait supports methods in the following non-exhaustive list:</p><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody><tr><td><code>all(pred_fn)</code></td><td>returns <code>bool</code> indicating if <code>pred_fn</code> returns true for all items</td></tr><tr><td><code>any(pred_fn)</code></td><td>returns <code>bool</code> indicating if <code>pred_fn</code> returns true for any items</td></tr><tr><td><code>chain(iter2)</code></td><td>returns <code>Iterator</code> that iterates over combined items</td></tr><tr><td><code>collect()</code></td><td>returns a <code>std::vec::Vec</code> containing all the items</td></tr><tr><td><code>count()</code></td><td>returns number of items in <code>Iterator</code>, consuming it</td></tr><tr><td><code>enumerate()</code></td><td>returns <code>Iterator</code> over tuples of indexes and items</td></tr><tr><td><code>filter(pred_fn)</code></td><td>returns <code>Iterator</code> over items for which <code>pred_fn</code> returns true</td></tr><tr><td><code>fold(fn)</code></td><td>returns result of combining items into a single value; like <code>reduce</code> in other languages</td></tr><tr><td><code>last()</code></td><td>returns last item in <code>Iterator</code>, consuming it</td></tr><tr><td><code>map(fn)</code></td><td>returns <code>Iterator</code> over results of calling a function on each item</td></tr><tr><td><code>max()</code></td><td>returns <code>Option</code> that wraps the largest item</td></tr><tr><td><code>max_by(fn)</code></td><td>returns <code>Option</code> that wraps the largest result based on passing pairs of items to a function</td></tr><tr><td><code>max_by_key(fn)</code></td><td>returns <code>Option</code> that wraps the largest result of passing each item to a function</td></tr><tr><td><code>min()</code></td><td>returns <code>Option</code> that wraps the smallest item</td></tr><tr><td><code>min_by(fn)</code></td><td>returns <code>Option</code> that wraps the smallest result based on passing pairs of items to a function</td></tr><tr><td><code>min_by_key(fn)</code></td><td>returns <code>Option</code> that wraps the smallest result of passing each item to a function</td></tr><tr><td><code>next()</code></td><td>returns <code>Option</code> that wraps the next item</td></tr><tr><td><code>nth(n)</code></td><td>returns <code>Option</code> that wraps the nth item</td></tr><tr><td><code>partition(pred_fn)</code></td><td>returns two collections containing items for which a function returns true or false</td></tr><tr><td><code>position(pred_fn)</code></td><td>returns <code>Option</code> that wraps the index of first item for which <code>pred_fn</code> returns true</td></tr><tr><td><code>product()</code></td><td>returns product of items; panics on overflow</td></tr><tr><td><code>rev()</code></td><td>returns <code>Iterator</code> that iterates in reverse order</td></tr><tr><td><code>skip(n)</code></td><td>returns <code>Iterator</code> that begins after n items</td></tr><tr><td><code>skip_while(pred_fn)</code></td><td>returns <code>Iterator</code> that begins at first item for which <code>pred_fn</code> returns false</td></tr><tr><td><code>sum()</code></td><td>returns sum of items; panics on overflow</td></tr><tr><td><code>take(n)</code></td><td>returns <code>Iterator</code> that stops after the first n items</td></tr><tr><td><code>take_while(pred_fn)</code></td><td>returns <code>Iterator</code> that stops at last item for which <code>pred_fn</code> returns true</td></tr><tr><td><code>zip(iter2)</code></td><td>returns <code>Iterator</code> over <code>Option</code> objects that wrap<br>references to corresponding items from two <code>Iterators</code></td></tr></tbody></table><p>Here is an example of using the <code>next</code> method:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"yellow"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token comment">// Must be mutable because calling methods</span><br>    <span class="token comment">// like "next" on it modifies its state.</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> iter <span class="token operator">=</span> colors<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">match</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token class-name">Some</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> color<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// red</span><br>        <span class="token class-name">None</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"no more colors"</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span> <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> color<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// yellow</span><br>        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span> <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> color<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// blue</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>We can also obtain an iterator that allows the underlying collection to be modify while iterating over it. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"red"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"yellow"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">for</span> color <span class="token keyword">in</span> colors<span class="token punctuation">.</span><span class="token function">iter_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        color<span class="token punctuation">.</span><span class="token function">make_ascii_uppercase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> colors<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ["RED", "YELLOW", "BLUE"]</span><br><br>    <span class="token comment">// To create a new vector rather than modify one in place ...</span><br>    <span class="token comment">//let new_colors: Vec&lt;String> =</span><br>    <span class="token comment">//    colors.iter().map(|s| s.to_uppercase()).collect();</span><br><span class="token punctuation">}</span></code></pre><p>Here is an example of using the <code>fold</code> method which is like <code>reduce</code> in some other programming languages:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> a1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> sum <span class="token operator">=</span> a1<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fold</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>acc<span class="token punctuation">,</span> n<span class="token closure-punctuation punctuation">|</span></span> acc <span class="token operator">+</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6</span><br><br><span class="token comment">// For this use of "fold" we can use the "sum" method instead.</span><br><span class="token keyword">let</span> sum<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> a1<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6</span></code></pre><p>Here is an example of using the <code>filter</code> method.</p><pre class="language-rust"><code class="language-rust"><span class="token comment">// This is a predicate function used by the "filter" method.</span><br><span class="token comment">// It must take a reference to a item in an "Iterator".</span><br><span class="token comment">// In this case the item type is "&amp;str",</span><br><span class="token comment">// so the parameter type must be "&amp;&amp;str".</span><br><span class="token keyword">fn</span> <span class="token function-definition function">is_short</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">bool</span> <span class="token punctuation">{</span><br>    s<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">4</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> months <span class="token operator">=</span> <span class="token string">"January|February|March|April|May|June|July|August"</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// This passes a closure to the filter method.</span><br>    <span class="token keyword">let</span> short_names<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token operator">></span> <span class="token operator">=</span><br>        months<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token char">'|'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>m<span class="token closure-punctuation punctuation">|</span></span> m<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> short_names<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ["May", "June", "July"]</span><br><br>    <span class="token comment">// This passes a function to the filter method.</span><br>    <span class="token keyword">let</span> short_names<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token operator">></span> <span class="token operator">=</span><br>        months<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token char">'|'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>is_short<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> short_names<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ["May", "June", "July"]</span><br><span class="token punctuation">}</span></code></pre><p>Here is an example of using the <code>map</code> method:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> a1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> iter <span class="token operator">=</span> a1<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>n<span class="token closure-punctuation punctuation">|</span></span> n <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// doubles each number</span><br><span class="token keyword">for</span> n <span class="token keyword">in</span> iter <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2 then 4 then 6</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// We cannot create an array from an iterator,</span><br><span class="token comment">// but we can create a Vector.</span><br><span class="token comment">// map is lazy and collect forces its evaluation.</span><br><span class="token keyword">let</span> v1 <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> v2<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">></span> <span class="token operator">=</span> v1<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>n<span class="token closure-punctuation punctuation">|</span></span> n <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [2, 4, 6]</span></code></pre><p>Here is an example of using the <code>zip</code> method:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> a1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> a2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br><span class="token comment">// This creates an "Iterator" over "Option" enums.</span><br><span class="token comment">// The "Some" variant will contain tuples of references.</span><br><span class="token keyword">let</span> <span class="token keyword">mut</span> iter <span class="token operator">=</span> a1<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">zip</span><span class="token punctuation">(</span>a2<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">None</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// extra item in a2 ignored</span></code></pre><p>Here is an example of using the <code>take</code> method to get a certain number of initial values from an iterator:</p><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Student</span> <span class="token punctuation">{</span><br>    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>    scores<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">f32</span><span class="token operator">></span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span> <span class="token class-name">Student</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> scores<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span><br>        <span class="token keyword">Self</span> <span class="token punctuation">{</span><br>            name<span class="token punctuation">:</span> name<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            scores<span class="token punctuation">:</span> scores<span class="token punctuation">.</span><span class="token function">to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">average</span><span class="token punctuation">(</span>numbers<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f32</span> <span class="token punctuation">{</span><br>    numbers<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">f32</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> numbers<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">f32</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// This is mutable because the sort_by method sorts it in place.</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> students<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Student</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><br>        <span class="token class-name">Student</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">90.0</span><span class="token punctuation">,</span> <span class="token number">75.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token class-name">Student</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Betty"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">85.0</span><span class="token punctuation">,</span> <span class="token number">95.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token class-name">Student</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Claire"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">70.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">75.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token class-name">Student</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Dina"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">95.0</span><span class="token punctuation">,</span> <span class="token number">100.0</span><span class="token punctuation">,</span> <span class="token number">90.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token class-name">Student</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Elaine"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">75.0</span><span class="token punctuation">,</span> <span class="token number">90.0</span><span class="token punctuation">,</span> <span class="token number">100.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">]</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Sort the students in descending order by their average scores.</span><br>    students<span class="token punctuation">.</span><span class="token function">sort_by</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>a<span class="token punctuation">,</span> b<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> a_avg <span class="token operator">=</span> <span class="token function">average</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>a<span class="token punctuation">.</span>scores<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">let</span> b_avg <span class="token operator">=</span> <span class="token function">average</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>b<span class="token punctuation">.</span>scores<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        b_avg<span class="token punctuation">.</span><span class="token function">partial_cmp</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>a_avg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Print the names of the top 3 students.</span><br>    <span class="token keyword">for</span> student <span class="token keyword">in</span> students<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> student<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>Here is an example of using the <code>some</code> and <code>all</code> methods:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> numbers <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br><span class="token comment">// Is any number less than 3?</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"any &lt; 3? {}"</span><span class="token punctuation">,</span> numbers<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;</span>n<span class="token closure-punctuation punctuation">|</span></span> n <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Is any number greater or equal to 20?</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"any >= 20? {}"</span><span class="token punctuation">,</span> numbers<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;</span>n<span class="token closure-punctuation punctuation">|</span></span> n <span class="token operator">>=</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Are all the numbers even?</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"all even? {}"</span><span class="token punctuation">,</span> numbers<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;</span>n<span class="token closure-punctuation punctuation">|</span></span> n <span class="token operator">&amp;</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Are all the numbers less than 30?</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"all &lt; 30? {}"</span><span class="token punctuation">,</span> numbers<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;</span>n<span class="token closure-punctuation punctuation">|</span></span> n <span class="token operator">&lt;</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="regular-expressions" tabindex="-1">Regular Expressions</h2><p>Regular expressions for string pattern matching are not directly supported. Instead an external crate such as <a href="https://crates.io/crates/regex?v=1.1.1" rel="noopener" target="_blank">regex</a> must be used. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">regex<span class="token punctuation">::</span></span><span class="token class-name">Regex</span><span class="token punctuation">;</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Determine if a string matches a regular expression.</span><br>    <span class="token comment">// Match 'h' or 's' followed by 1 to 3 digits.</span><br>    <span class="token keyword">let</span> re <span class="token operator">=</span> <span class="token class-name">Regex</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">r"[hs]\d{1,3}"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"The host is h19 and the switch is s257."</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> re<span class="token punctuation">.</span><span class="token function">is_match</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"matched"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"mismatch"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// Get text matching capture groups.</span><br>    <span class="token keyword">for</span> cap <span class="token keyword">in</span> re<span class="token punctuation">.</span><span class="token function">captures_iter</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token operator">&amp;</span>cap<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// h19 and s257</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// Split a string on a regular expression</span><br>    <span class="token comment">// and collect the pieces into a vector.</span><br>    <span class="token keyword">let</span> pieces<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token operator">></span> <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> pieces<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ["The host is ", " and the switch is ", "."]</span><br><br>    <span class="token comment">// Split a string on a regular expression</span><br>    <span class="token comment">// and iterate over the pieces.</span><br>    <span class="token keyword">let</span> piece_iter <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">for</span> piece <span class="token keyword">in</span> piece_iter <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> piece<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token comment">// The host is</span><br>        <span class="token comment">//  and the switch is</span><br>        <span class="token comment">// .</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><h2 id="operators" tabindex="-1">Operators</h2><p>Rust supports most of the common operators found in other programming languages.</p><p>The <code>std::ops</code> namespace defines overloadable operators. For example, we can define what it means to add and subtract to <code>Point2D</code> objects by implementing the <code>Add</code> and <code>Sub</code> traits defined in <code>std::ops</code>.</p><p>The operators that can be implemented for custom types include:</p><ul><li>arithmetic: <code>+</code>, <code>+=</code>, <code>-</code>, <code>-=</code>, <code>_</code>, <code>_=</code>, <code>/</code>, <code>/=</code></li><li>bit shift: <code>&lt;&lt;</code>, <code>&lt;&lt;=</code>, <code>&gt;&gt;</code>, and <code>&gt;&gt;=</code></li><li>bitwise: <code>&amp;</code>, <code>&amp;=</code>, <code>|</code>, <code>|=</code>, <code>^</code>, and <code>^=</code></li><li>deref: <code>\*</code> for getting and setting a value</li><li>functions: <code>()</code> call operator in three forms</li><li>index: <code>[]</code> operator to get and set an element</li><li>logical: <code>!</code> not, but <code>&amp;&amp;</code> and <code>||</code> cannot be defined</li><li>mod: <code>%</code> and <code>%=</code></li><li>negate: <code>-</code> (unary)</li><li>range: <code>..</code> and <code>..=</code></li></ul><h2 id="ranges" tabindex="-1"><a name="ranges">Ranges</a></h2><p>The <code>std::ops</code> namespace defines the following range types:</p><table><thead><tr><th>Range Type</th><th>Meaning</th><th>Syntax</th></tr></thead><tbody><tr><td><code>RangeFull</code></td><td>all items</td><td><code>..</code></td></tr><tr><td><code>Range</code></td><td>start inclusive to end exclusive</td><td><code>s..e</code></td></tr><tr><td><code>RangeInclusive</code></td><td>start inclusive to end inclusive</td><td><code>s..=e</code></td></tr><tr><td><code>RangeFrom</code></td><td>start inclusive and above</td><td><code>s..</code></td></tr><tr><td><code>RangeTo</code></td><td>zero to end exclusive</td><td><code>..e</code></td></tr><tr><td><code>RangeToInclusive</code></td><td>zero to end inclusive</td><td><code>..=e</code></td></tr></tbody></table><p>These are distinct types and there is not a provided range type that encompasses all of them.</p><p>Instances these types are values that can be assigned to variables, be members of structs, be passed to functions, and be returned from functions.</p><p>For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Range</span><span class="token punctuation">,</span> <span class="token class-name">RangeInclusive</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">print_range</span><span class="token punctuation">(</span>r<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Range</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"range = {:?}"</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">print_range_inclusive</span><span class="token punctuation">(</span>r<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">RangeInclusive</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"range = {:?}"</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> r1 <span class="token operator">=</span> a<span class="token punctuation">..</span>b<span class="token punctuation">;</span><br>    <span class="token function">print_range</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>r1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// range = 3..7</span><br>    <span class="token comment">// The Range contains method requires a ref to a number,</span><br>    <span class="token comment">// so even literal values must be passed by reference.</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> r1<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> r1<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span><br><br>    <span class="token keyword">let</span> r2 <span class="token operator">=</span> a<span class="token punctuation">..=</span>b<span class="token punctuation">;</span><br>    <span class="token function">print_range_inclusive</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>r2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// range = 3..=7</span><br>    <span class="token keyword">for</span> n <span class="token keyword">in</span> r2 <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3, 4, 5, 6, 7</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><h2 id="structs" tabindex="-1"><a name="structs">Structs</a></h2><p>A struct defines a type that is a set of related fields and methods, similar to a class in other languages.</p><p>The <code>struct</code> keyword only defines a set of fields. When there a no fields, it is referred to as a &quot;unit struct&quot;. These are used to implement groups of related functionality that have no state.</p><p>The <code>impl</code> keyword adds associated functions (like class or static methods in other languages) and methods (like instance methods in other languages) to a struct. Associated functions are typically used to construct instances or a struct. By convention, many structs have an associated function named <code>new</code> for just this purpose.</p><p>The first parameter of methods must be named &quot;self&quot;, like the convention in Python. Any <code>fn</code> definition with no parameters or a first parameter with a name other than &quot;self&quot; is an &quot;associated function&quot; rather than a method. Associated functions are called with the syntax <code>StructName::function_name(arguments)</code>. Methods are called with the syntax <code>instance_variable.method_name(arguments)</code>.</p><p>In an <code>impl</code> block the type <code>Self</code> refers to the associated struct type. Using <code>Self</code> in place of the struct name enables renaming structs without needing to change uses of their names inside <code>impl</code> blocks.</p><p>An instance of a struct can be created using its name. It is also common to define an associated function named &quot;new&quot; (by convention) that creates an instance that is initialized in a specific way, similar to a constructor in other languages. In addition, we can implement the <code>Default</code> trait for a struct to provide a way to create a &quot;default&quot; instance.</p><p>For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>default<span class="token punctuation">::</span></span><span class="token class-name">Default</span><span class="token punctuation">;</span><br><br><span class="token attribute attr-name">#[derive(Debug, Default)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Point2D</span> <span class="token punctuation">{</span><br>    x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br>    y<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span> <span class="token comment">// comma after last field is optional</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// We only need to manually implement the "Default" trait</span><br><span class="token comment">// when one or more fields should be assigned non-default values,</span><br><span class="token comment">// such as a number other than zero for numeric fields.</span><br><span class="token comment">// In this case the default fields values work fine,</span><br><span class="token comment">// so we don't need to write the commented out code below.</span><br><span class="token comment">// The derive attribute above generates this code for us.</span><br><span class="token comment">/*<br>impl Default for Point2D {<br>    fn default() -> Self {<br>        Self { x: 0.0, y: 0.0 } // origin<br>    }<br>}<br>*/</span><br><br><span class="token keyword">impl</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span><br>        <span class="token keyword">Self</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// Associated function</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">distance_between</span><span class="token punctuation">(</span>pt1<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">,</span> pt2<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f64</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> dx <span class="token operator">=</span> pt1<span class="token punctuation">.</span>x <span class="token operator">-</span> pt2<span class="token punctuation">.</span>x<span class="token punctuation">;</span><br>        <span class="token keyword">let</span> dy <span class="token operator">=</span> pt1<span class="token punctuation">.</span>y <span class="token operator">-</span> pt2<span class="token punctuation">.</span>y<span class="token punctuation">;</span><br>        <span class="token punctuation">(</span>dx<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> dy<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// Method that does not mutate</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">distance_to</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f64</span> <span class="token punctuation">{</span><br>        <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">distance_between</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// Method that mutates</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">translate</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">Self</span><span class="token punctuation">,</span> dx<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span> dy<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span>x <span class="token operator">+=</span> dx<span class="token punctuation">;</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span>y <span class="token operator">+=</span> dy<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Create an instance using the "default" function.</span><br>    <span class="token keyword">let</span> origin <span class="token operator">=</span> <span class="token class-name">Point2D</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Create an instance using the struct name.</span><br>    <span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">3.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">4.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Create an instance using the "constructor" function.</span><br>    <span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token class-name">Point2D</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">6.0</span><span class="token punctuation">,</span> <span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> origin<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Point2D { x: 0.0, y: 0.0 }</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token class-name">Point2D</span><span class="token punctuation">::</span><span class="token function">distance_between</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>p2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> p1<span class="token punctuation">.</span><span class="token function">distance_to</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span><br><br>    p2<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> p2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Point2D { x: 4.0, y: 9.0 }</span><br><span class="token punctuation">}</span></code></pre><p>In general it's best for struct fields to not have reference types. This makes the lifetime of field values match that of the struct. This simplifies its usage by removing the need to specify lifetime annotations. For example, struct fields with a string value should almost always use the type <code>String</code> instead of <code>&amp;str</code> or <code>&amp;String</code>.</p><p>To allow structs to be printed for debugging purposes, add the following above their definition: <code>#[derive(Debug)]</code>. Then print instances using the <code>:?</code> (single line) or <code>:#?</code> (multi-line) format specifier. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"p1 = {:?}"</span><span class="token punctuation">,</span> p1<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"p2 = {:#?}"</span><span class="token punctuation">,</span> p1<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>This outputs the following:</p><pre class="language-text"><code class="language-text">p1 = Point2D { x: 3.0, y: 4.0 }<br>p2 = Point2D {<br>    x: 3.0,<br>    y: 4.0,<br>}</code></pre><p>Structs are not cloneable, copyable, or printable by default. Being copyable allows instances to be passed by value (copy) instead of by reference. These features add compile time, so Rust requires implementing them on a case-by-case basis. The easiest way to implement these features is the precede a struct definition with the following:</p><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[derive(Clone, Copy, Debug)]</span></code></pre><p>Structs and their fields are accessible by default within the same source file, but they are private by default when defined in a different source file. For structs that should be visible outside the source file that defines them, add the <code>pub</code> keyword to both the <code>struct</code> and the fields to be exposed.</p><p>Structs cannot inherit from (extend) other structs, but they can nest other structs (composition).</p><p>A <code>struct</code> can include the fields of another <code>struct</code> of the same type using the <code>..</code> syntax. This can only appear at the end of the list of values. It only supplies values that were not specified. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Point3D</span> <span class="token punctuation">{</span><br>    x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br>    y<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br>    z<span class="token punctuation">:</span> <span class="token keyword">f64</span><br><span class="token punctuation">}</span><br><span class="token keyword">let</span> p3 <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> z<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> p4 <span class="token operator">=</span> <span class="token class-name">Point3D</span> <span class="token punctuation">{</span> z<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token punctuation">..</span>p3 <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// uses p3.x and p3.y, but not p3.z</span></code></pre><p>Note that it wouldn't make sense to allow including the fields of multiple structs because struct fields are never optional. Each struct being included would contain all the fields.</p><p>A &quot;tuple struct&quot; gives a name to a tuple, allowing it to be used as a type. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">RGB</span><span class="token punctuation">(</span><span class="token keyword">u8</span><span class="token punctuation">,</span> <span class="token keyword">u8</span><span class="token punctuation">,</span> <span class="token keyword">u8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token constant">CORNFLOWER_BLUE</span><span class="token punctuation">:</span> <span class="token constant">RGB</span> <span class="token operator">=</span> <span class="token constant">RGB</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">149</span><span class="token punctuation">,</span> <span class="token number">237</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">REBECCA_PURPLE</span><span class="token punctuation">:</span> <span class="token constant">RGB</span> <span class="token operator">=</span> <span class="token constant">RGB</span><span class="token punctuation">(</span><span class="token number">0x66</span><span class="token punctuation">,</span> <span class="token number">0x33</span><span class="token punctuation">,</span> <span class="token number">0x99</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> <span class="token constant">CORNFLOWER_BLUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// RGB(100, 149, 237)</span><br><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> <span class="token constant">REBECCA_PURPLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// RGB(102, 51, 153)</span></code></pre><p>Tuples whose values have the same types as those in a tuple struct are not compatible with that type. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> <span class="token keyword">mut</span> color<span class="token punctuation">:</span> <span class="token constant">RGB</span> <span class="token operator">=</span> <span class="token constant">RGB</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">149</span><span class="token punctuation">,</span> <span class="token number">237</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>color <span class="token operator">=</span> <span class="token constant">RGB</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">137</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// can change to value of type RGB</span><br>color <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">149</span><span class="token punctuation">,</span> <span class="token number">237</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error: expected struct `RGB, found tuple</span></code></pre><p>One use of a tuple struct is referred to as the &quot;new type&quot; pattern. It assigns a name to a specific use of an existing type. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Temperature</span><span class="token punctuation">(</span><span class="token keyword">i16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">is_cold</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Temperature</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">bool</span> <span class="token punctuation">{</span><br>    t<span class="token number">.0</span> <span class="token operator">&lt;=</span> <span class="token number">32</span> <span class="token comment">// Fahrenheit</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> temperature<span class="token punctuation">:</span> <span class="token class-name">Temperature</span> <span class="token operator">=</span> <span class="token class-name">Temperature</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token function">is_cold</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>temperature<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span><br>    temperature <span class="token operator">=</span> <span class="token class-name">Temperature</span><span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token function">is_cold</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>temperature<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token function">is_cold</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">Temperature</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token function">is_cold</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error: expected struct `Temperature`, found integer</span><br><span class="token punctuation">}</span></code></pre><p>The <code>impl</code> keyword can be used multiple times on the same struct. However, usually all the non-trait methods of a struct are defined in one <code>impl</code> block. The following example shows using three <code>impl</code> blocks to define methods on the same struct.</p><p>File <code>geometry.rs</code></p><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span><br><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Point2D</span> <span class="token punctuation">{</span><br>    <span class="token keyword">pub</span> x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br>    <span class="token keyword">pub</span> y<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span><br>    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">distance_from_origin</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f64</span> <span class="token punctuation">{</span><br>        <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>File <code>more_geometry.rs</code></p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token keyword">super</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>geometry<span class="token punctuation">::</span></span><span class="token class-name">Point2D</span><span class="token punctuation">;</span><br><br><span class="token keyword">impl</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span><br>    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">translate_x</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> dx<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span>x <span class="token operator">+=</span> dx<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">scoot</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Point2D</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    p<span class="token punctuation">.</span><span class="token function">translate_x</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>File <code>main.rs</code></p><pre class="language-rust"><code class="language-rust"><span class="token keyword">mod</span> <span class="token module-declaration namespace">geometry</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">geometry<span class="token punctuation">::</span></span><span class="token class-name">Point2D</span><span class="token punctuation">;</span><br><br><span class="token keyword">mod</span> <span class="token module-declaration namespace">more_geometry</span><span class="token punctuation">;</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">demo</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Point2D</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">impl</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span><br>        <span class="token keyword">fn</span> <span class="token function-definition function">translate_y</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> dy<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token keyword">self</span><span class="token punctuation">.</span>y <span class="token operator">+=</span> dy<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    p<span class="token punctuation">.</span><span class="token function">translate_y</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> p <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"distance = {}"</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span><span class="token function">distance_from_origin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// The translate_x method is defined in geometry.rs.</span><br>    p<span class="token punctuation">.</span><span class="token function">translate_x</span><span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// The "scoot" function is defined in more.rs.</span><br>    <span class="token comment">// Just because "p" is mutable doesn't mean</span><br>    <span class="token comment">// that all references to it are mutable.</span><br>    <span class="token comment">// The "scoot" function requires a mutable reference</span><br>    <span class="token comment">// and we must specify that when passing a reference.</span><br>    <span class="token namespace">more<span class="token punctuation">::</span></span><span class="token function">scoot</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token function">demo</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// The "translate_y" method is defined in the "demo" function above.</span><br>    p<span class="token punctuation">.</span><span class="token function">translate_y</span><span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Point2D { x: 4.0, y: 5.0 }</span><br><span class="token punctuation">}</span></code></pre><p>Structs can use generic types. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">num<span class="token punctuation">::</span></span><span class="token class-name">ToPrimitive</span><span class="token punctuation">;</span><br><br><span class="token comment">// T can be any type that implements the "ToPrimitive" trait.</span><br><span class="token comment">// This is required because the "distance_to_origin" method</span><br><span class="token comment">// calls the "to_f64" method defined by that trait.</span><br><span class="token attribute attr-name">#[derive(Debug)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Point2D</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">ToPrimitive</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    x<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span><br>    y<span class="token punctuation">:</span> <span class="token class-name">T</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">ToPrimitive</span><span class="token operator">></span> <span class="token class-name">Point2D</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">distance_from_origin</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f64</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">to_f64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">to_f64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> y<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> pt1 <span class="token operator">=</span> <span class="token class-name">Point2D</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">f32</span><span class="token operator">></span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">3.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">4.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> pt2 <span class="token operator">=</span> <span class="token class-name">Point2D</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">i8</span><span class="token operator">></span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"pt1 = {:?}"</span><span class="token punctuation">,</span> pt1<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"pt1 distance = {:?}"</span><span class="token punctuation">,</span> pt1<span class="token punctuation">.</span><span class="token function">distance_from_origin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"pt2 = {:?}"</span><span class="token punctuation">,</span> pt2<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"pt2 distance = {:?}"</span><span class="token punctuation">,</span> pt2<span class="token punctuation">.</span><span class="token function">distance_from_origin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">/* Can't do this because &amp;str does not implement the ToPrimitive trait.<br>    let pt3 = Point2D::&lt;&amp;str> { x: "foo", y: "bar" };<br>    println!("pt3 = {:?}", pt3);<br>    println!("pt3 distance = {:?}", pt3.distance_from_origin());<br>    */</span><br><span class="token punctuation">}</span></code></pre><h2 id="dereference" tabindex="-1">Dereference</h2><p>The dereference operator is used to get the value of a reference. This isn't needed very often because unlike in most programming languages that support references (or pointers), Rust does not require different syntax for accessing fields and methods based on whether an instance or a reference is used. It supplies &quot;automatic referencing and dereferencing&quot; in field access and method calls for types that implement the <code>Deref</code> trait. This includes immutable and mutable references to all types. In the case of method calls, it automatically adds <code>&amp;</code>, <code>&amp;mut</code>, or <code>*</code> based on the method declaration of the <code>self</code> parameter.</p><p>For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Point2D</span> <span class="token punctuation">{</span><br>    x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br>    y<span class="token punctuation">:</span> <span class="token keyword">f64</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">is_origin</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">bool</span> <span class="token punctuation">{</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span>x <span class="token operator">==</span> <span class="token number">0.0</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y <span class="token operator">==</span> <span class="token number">0.0</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> p_ref <span class="token operator">=</span> <span class="token operator">&amp;</span>p<span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> p_ref<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1; same syntax with reference</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span><span class="token function">is_origin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> p_ref<span class="token punctuation">.</span><span class="token function">is_origin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false; same syntax with reference</span><br><span class="token punctuation">}</span></code></pre><p>Here is an example where dereference is needed:</p><pre class="language-rust"><code class="language-rust"><span class="token comment">// Implementing the PartialEq and PartialOrd traits</span><br><span class="token comment">// enables comparing instances.</span><br><span class="token attribute attr-name">#[derive(Debug, PartialEq, PartialOrd)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Point2D</span> <span class="token punctuation">{</span><br>    x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br>    y<span class="token punctuation">:</span> <span class="token keyword">f64</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">const</span> <span class="token constant">ORIGIN</span><span class="token punctuation">:</span> <span class="token class-name">Point2D</span> <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">is_origin</span><span class="token punctuation">(</span>pt<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Point2D</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">bool</span> <span class="token punctuation">{</span><br>    <span class="token comment">// We could just check whether x and y are zero,</span><br>    <span class="token comment">// but then we wouldn't need to dereference pt.</span><br>    <span class="token comment">//pt.x == 0.0 &amp;&amp; pt.y == 0.0</span><br><br>    <span class="token comment">// We can't compare a Point2D reference to a Point2D,</span><br>    <span class="token comment">// but we can dereference pt to get the Point2D instance</span><br>    <span class="token comment">// it references and then compare that to ORIGIN.</span><br>    <span class="token operator">*</span>pt <span class="token operator">==</span> <span class="token constant">ORIGIN</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> q <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"p equal q? {}"</span><span class="token punctuation">,</span> p <span class="token operator">==</span> q<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"p is origin? {:?}"</span><span class="token punctuation">,</span> <span class="token function">is_origin</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"q is origin? {:?}"</span><span class="token punctuation">,</span> <span class="token function">is_origin</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>q<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span><br><span class="token punctuation">}</span></code></pre><h2 id="type-aliases" tabindex="-1">Type Aliases</h2><p>Aliases for types can be defined using the <code>type</code> keyword. These can be used anywhere a type can be specified.</p><p>Here is an example of a type alias for a <code>HashMap</code> with specific key and value types:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span><br><br><span class="token keyword">type</span> <span class="token type-definition class-name">StringToIntMap</span> <span class="token operator">=</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token operator">></span><span class="token punctuation">;</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> score_map<span class="token punctuation">:</span> <span class="token class-name">StringToIntMap</span> <span class="token operator">=</span> <span class="token class-name">StringToIntMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    score_map<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"Mark"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    score_map<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"Tami"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    score_map<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"Amanda"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    score_map<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"Jeremy"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Iterating takes ownership of score_map unless a reference is used.</span><br>    <span class="token keyword">for</span> entry <span class="token keyword">in</span> <span class="token operator">&amp;</span>score_map <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> entry<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>winner<span class="token punctuation">)</span> <span class="token operator">=</span> score_map<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max_by_key</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>entry<span class="token closure-punctuation punctuation">|</span></span> entry<span class="token number">.1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"winner is {}"</span><span class="token punctuation">,</span> winner<span class="token number">.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"no players found"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>Here is an example of using a type alias for a function signature:</p><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Point2D</span> <span class="token punctuation">{</span><br>    x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br>    y<span class="token punctuation">:</span> <span class="token keyword">f64</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// This is a type alias for a function signature.</span><br><span class="token keyword">type</span> <span class="token type-definition class-name">PointFn</span> <span class="token operator">=</span> <span class="token keyword">fn</span> <span class="token punctuation">(</span>pt<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Point2D</span><span class="token punctuation">,</span> input<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Point2D</span><span class="token punctuation">;</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">rotate</span><span class="token punctuation">(</span>pt<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Point2D</span><span class="token punctuation">,</span> angle<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> cos <span class="token operator">=</span> angle<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> sin <span class="token operator">=</span> angle<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> x <span class="token operator">=</span> pt<span class="token punctuation">.</span>x <span class="token operator">*</span> cos <span class="token operator">-</span> pt<span class="token punctuation">.</span>y <span class="token operator">*</span> sin<span class="token punctuation">;</span><br>    <span class="token keyword">let</span> y <span class="token operator">=</span> pt<span class="token punctuation">.</span>x <span class="token operator">*</span> sin <span class="token operator">+</span> pt<span class="token punctuation">.</span>y <span class="token operator">*</span> cos<span class="token punctuation">;</span><br>    <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">translate_x</span><span class="token punctuation">(</span>pt<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Point2D</span><span class="token punctuation">,</span> dx<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span><br>    <span class="token comment">// "..*pt" gets the rest of the fields in the "pt" object</span><br>    <span class="token comment">// which in this case is just the "y" field.</span><br>    <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> pt<span class="token punctuation">.</span>x <span class="token operator">+</span> dx<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token operator">*</span>pt <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">translate_y</span><span class="token punctuation">(</span>pt<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Point2D</span><span class="token punctuation">,</span> dy<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span><br>    <span class="token comment">// "..*pt" gets the rest of the fields in the "pt" object</span><br>    <span class="token comment">// which in this case is just the "x" field.</span><br>    <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> y<span class="token punctuation">:</span> pt<span class="token punctuation">.</span>x <span class="token operator">+</span> dy<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token operator">*</span>pt <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// The type of the second parameter is the type alias defined above.</span><br><span class="token keyword">fn</span> <span class="token function-definition function">operate</span><span class="token punctuation">(</span>pt<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Point2D</span><span class="token punctuation">,</span> function<span class="token punctuation">:</span> <span class="token class-name">PointFn</span><span class="token punctuation">,</span> input<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span><br>    <span class="token function">function</span><span class="token punctuation">(</span>pt<span class="token punctuation">,</span> input<span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token number">3.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">4.0</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> <span class="token function">operate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token punctuation">,</span> translate_x<span class="token punctuation">,</span> <span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// Point2D { x: 7.0, y: 4.0 }</span><br><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> <span class="token function">operate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token punctuation">,</span> translate_y<span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// Point2D { x: 3.0, y: 5.0 }</span><br><br>    <span class="token keyword">let</span> pi <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token keyword">f64</span><span class="token punctuation">::</span><span class="token namespace">consts<span class="token punctuation">::</span></span><span class="token constant">PI</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> <span class="token function">operate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token punctuation">,</span> rotate<span class="token punctuation">,</span> pi <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// Point2D { x: -4.0, y: 3.0000000000000004 }</span><br><span class="token punctuation">}</span></code></pre><h2 id="traits" tabindex="-1"><a name="traits">Traits</a></h2><p>A trait describes an interface that any number of types can implement.</p><p>Any trait can be implemented on a type defined in the current crate. A trait defined in the current crate can be implemented on any type, even those in the standard library. But a trait defined outside the current crate cannot be implemented on a type that is also defined outside the current crate. For example, the <code>std::vec::Vec</code> type does not implement the <code>std::fmt::Display</code> trait and this implementation cannot be added. This is referred to as the &quot;orphan rule&quot;.</p><p>A trait defines any number of associated constants (not commonly used), associated functions, and methods. The first parameter of methods must be named &quot;self&quot;. Any <code>fn</code> definition whose first parameter name is not &quot;self&quot; is an &quot;associated function&quot; rather than a method.</p><p>The first parameter of a method can be written as <code>self</code> (takes ownership or copies), <code>&amp;self</code> (borrows immutably; most common), or <code>&amp;mut self</code> (borrows mutably; needed to modify struct fields). These are shorthand for <code>self: Self</code>, <code>self: &amp;Self</code>, and <code>self: &amp;mut Self</code> respectively. In the first case, if the type implements the <code>Copy</code> trait then the value is copied. Otherwise ownership is transferred to the method.</p><p>Often traits are implemented for structs, but they can also be implemented for tuples and primitive types like <code>bool</code>.</p><p>A trait function or method can be described by providing only its signature. This requires implementing types to define the body. It can also provide a default implementation that is used by implementing types that do not override it.</p><p>We saw in the <a href="#structs">Structs</a> section that we can add methods to a struct without defining a trait. Using a trait is useful when it is desireable to implement the same set of functions and methods on many types. The trait can then be used as a parameter or return type, enabling any type that implements the trait to be used. This is how Rust achieves polymorphism.</p><p>Many functions provided by the standard library are implementations of traits. When looking at documentation for a type consider that some methods may only be described in the documentation for traits that are implemented for the type.</p><p>In this example we define the trait <code>Item</code> which is implemented by specific kinds of items such as <code>Book</code> and <code>Food</code>. A <code>Cart</code> holds items that implement the <code>Item</code> trait.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>fmt<span class="token punctuation">;</span><br><br><span class="token keyword">type</span> <span class="token type-definition class-name">Price</span> <span class="token operator">=</span> <span class="token keyword">u64</span><span class="token punctuation">;</span><br><br><span class="token keyword">trait</span> <span class="token type-definition class-name">Item</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">get_description</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">;</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">get_price</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Price</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Book</span> <span class="token punctuation">{</span><br>    price<span class="token punctuation">:</span> <span class="token class-name">Price</span><span class="token punctuation">,</span><br>    title<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span> <span class="token class-name">Item</span> <span class="token keyword">for</span> <span class="token class-name">Book</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">get_description</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token punctuation">{</span><br>        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>title<br>    <span class="token punctuation">}</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">get_price</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Price</span> <span class="token punctuation">{</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span>price<br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Food</span> <span class="token punctuation">{</span><br>    calories_per_serving<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span><br>    description<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>    price<span class="token punctuation">:</span> <span class="token class-name">Price</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span> <span class="token class-name">Item</span> <span class="token keyword">for</span> <span class="token class-name">Food</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">get_description</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token punctuation">{</span><br>        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>description<br>    <span class="token punctuation">}</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">get_price</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Price</span> <span class="token punctuation">{</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span>price<br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token attribute attr-name">#[derive(Default)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Cart</span> <span class="token punctuation">{</span><br>    <span class="token comment">// A Cart holds any kind of items that implement the Item trait.</span><br>    items<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Item</span><span class="token operator">>></span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span> <span class="token class-name">Cart</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Each Item added to a Cart is guaranteed</span><br>    <span class="token comment">// to live for the duration of the program.</span><br>    <span class="token comment">// There are two ways to specify the item parameter type.</span><br>    <span class="token comment">//fn add&lt;T: Item + 'static>(&amp;mut self, item: T) {</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">add</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> item<span class="token punctuation">:</span> <span class="token keyword">impl</span> <span class="token class-name">Item</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">'static</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">fn</span> <span class="token function-definition function">get_subtotal</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Price</span> <span class="token punctuation">{</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span>items<br>            <span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">fold</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>acc<span class="token punctuation">,</span> item<span class="token closure-punctuation punctuation">|</span></span> acc <span class="token operator">+</span> item<span class="token punctuation">.</span><span class="token function">get_price</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Display</span> <span class="token keyword">for</span> <span class="token class-name">Cart</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Formatter</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'_</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Result</span> <span class="token punctuation">{</span><br>        <span class="token keyword">for</span> item <span class="token keyword">in</span> <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>items <span class="token punctuation">{</span><br>            <span class="token comment">// We don't need to manually extract items from their Box.</span><br>            <span class="token macro property">writeln!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"{} ${}"</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span><span class="token function">get_description</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span><span class="token function">get_price</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> cart <span class="token operator">=</span> <span class="token class-name">Cart</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> item <span class="token operator">=</span> <span class="token class-name">Book</span> <span class="token punctuation">{</span><br>        title<span class="token punctuation">:</span> <span class="token string">"Svelte and Sapper in Action"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        price<span class="token punctuation">:</span> <span class="token number">2000</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    cart<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    cart<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Food</span> <span class="token punctuation">{</span><br>        description<span class="token punctuation">:</span> <span class="token string">"Snickers bar"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        calories_per_serving<span class="token punctuation">:</span> <span class="token number">229</span><span class="token punctuation">,</span><br>        price<span class="token punctuation">:</span> <span class="token number">75</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    cart<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Food</span> <span class="token punctuation">{</span><br>        description<span class="token punctuation">:</span> <span class="token string">"Coke can"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        calories_per_serving<span class="token punctuation">:</span> <span class="token number">140</span><span class="token punctuation">,</span><br>        price<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"subtotal = {}"</span><span class="token punctuation">,</span> cart<span class="token punctuation">.</span><span class="token function">get_subtotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">f64</span> <span class="token operator">/</span> <span class="token number">100.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>Traits can be made generic by including type parameters. Here is an example of a custom generic trait named <code>Distance</code> that is implemented for the custom type <code>Point2D</code>.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Point2D</span> <span class="token punctuation">{</span><br>    x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br>    y<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">trait</span> <span class="token type-definition class-name">Distance</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token comment">// The type Self here refers to the implementing type.</span><br>    <span class="token comment">// In the "impl" below, that is the Point2D type.</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">distance_to</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">T</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span> <span class="token class-name">Distance</span><span class="token operator">&lt;</span><span class="token keyword">f32</span><span class="token operator">></span> <span class="token keyword">for</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">distance_to</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Point2D</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f32</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> dx <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>x <span class="token operator">-</span> other<span class="token punctuation">.</span>x<span class="token punctuation">;</span><br>        <span class="token keyword">let</span> dy <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y <span class="token operator">-</span> other<span class="token punctuation">.</span>y<span class="token punctuation">;</span><br>        <span class="token punctuation">(</span>dx<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> dy<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">f32</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span> <span class="token class-name">Distance</span><span class="token operator">&lt;</span><span class="token keyword">f64</span><span class="token operator">></span> <span class="token keyword">for</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">distance_to</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Point2D</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f64</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> dx <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>x <span class="token operator">-</span> other<span class="token punctuation">.</span>x<span class="token punctuation">;</span><br>        <span class="token keyword">let</span> dy <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y <span class="token operator">-</span> other<span class="token punctuation">.</span>y<span class="token punctuation">;</span><br>        <span class="token punctuation">(</span>dx<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> dy<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">3.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">4.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">6.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">8.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// The type of d must be specified because there is more than one</span><br>    <span class="token comment">// implementation of the Distance Trait on the Point2D type.</span><br>    <span class="token keyword">let</span> d<span class="token punctuation">:</span> <span class="token keyword">f32</span> <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">distance_to</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span><br>    <span class="token keyword">let</span> d<span class="token punctuation">:</span> <span class="token keyword">f64</span> <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">distance_to</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span><br><span class="token punctuation">}</span></code></pre><p>An alternative to making a trait generic is to use &quot;associated types&quot;. A key distinction is the number of implementations that can be defined on a given type, many (with generics) or only one (with associated types). For example, for the <code>Point2D</code> type above if we only need one implementation of the <code>distance_to</code> method, we can use an associated type as follows:</p><pre class="language-rust"><code class="language-rust"><span class="token comment">// We can implement this trait for any number of types like Point2D,</span><br><span class="token comment">// but each can only specify one output type for its distance_to method.</span><br><span class="token keyword">trait</span> <span class="token type-definition class-name">Distance</span> <span class="token punctuation">{</span><br>    <span class="token comment">// We can define any number of named associated types here,</span><br>    <span class="token comment">// but only one is needed in this example.</span><br>    <span class="token keyword">type</span> <span class="token type-definition class-name">Output</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">fn</span> <span class="token function-definition function">distance_to</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Output</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span> <span class="token class-name">Distance</span> <span class="token keyword">for</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Specify the concrete type of each associated type here.</span><br>    <span class="token keyword">type</span> <span class="token type-definition class-name">Output</span> <span class="token operator">=</span> <span class="token keyword">f64</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">fn</span> <span class="token function-definition function">distance_to</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Point2D</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Output</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> dx <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>x <span class="token operator">-</span> other<span class="token punctuation">.</span>x<span class="token punctuation">;</span><br>        <span class="token keyword">let</span> dy <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y <span class="token operator">-</span> other<span class="token punctuation">.</span>y<span class="token punctuation">;</span><br>        <span class="token punctuation">(</span>dx<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> dy<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>A trait must be in scope in order to use its constants and methods. This avoids ambiguities in cases where a type implements multiple traits that happen to define constants and/or methods with the same names. Consider this example, defined by three source files: TODO: Maybe this example belongs in the &quot;Modules&quot; section instead.</p><p>Here is <code>src/printable.rs</code> which defines the <code>Printable</code> trait:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token type-definition class-name">Printable</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">print</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>Here is <code>src/person.rs</code> which defines the <code>Person</code> type:</p><pre class="language-rust"><code class="language-rust"><span class="token comment">// super traverses up a level to the parent of this module</span><br><span class="token comment">// which is the same parent as the "printable" module.</span><br><span class="token comment">// It is only aware of the "printable" module</span><br><span class="token comment">// because src/main.rs contains "mod printable;".</span><br><span class="token keyword">use</span> <span class="token keyword">super</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>printable<span class="token punctuation">::</span></span><span class="token class-name">Printable</span><span class="token punctuation">;</span><br><br><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Person</span> <span class="token punctuation">{</span><br>    <span class="token keyword">pub</span> first_name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>    <span class="token keyword">pub</span> last_name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span> <span class="token class-name">Printable</span> <span class="token keyword">for</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">print</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{} {}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>first_name<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>last_name<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>Here is <code>src/main.rs</code> which uses the <code>Person</code> type:</p><pre class="language-rust"><code class="language-rust"><span class="token comment">// These mod statements tell the compiler to read the corresponding ".rs" files</span><br><span class="token comment">// and add entries in the module tree which will become</span><br><span class="token comment">// crate (src/main.rs)</span><br><span class="token comment">// - crate::person (src/person.rs)</span><br><span class="token comment">// - crate::printable (src/printable.rs)</span><br><span class="token comment">// Note that `person` and `printable` are siblings,</span><br><span class="token comment">// but `main is not their sibling!</span><br><span class="token comment">// There can be only one "mod" statement per module in the project.</span><br><span class="token comment">// Each "mod" statement is placed in the highest module</span><br><span class="token comment">// that encompasses all usages of the module.j</span><br><span class="token comment">// Often, but not always, this is the top source file (main.rs or lib.rs).</span><br><span class="token keyword">mod</span> <span class="token module-declaration namespace">person</span><span class="token punctuation">;</span><br><span class="token keyword">mod</span> <span class="token module-declaration namespace">printable</span><span class="token punctuation">;</span><br><br><span class="token keyword">use</span> <span class="token namespace">person<span class="token punctuation">::</span></span><span class="token class-name">Person</span><span class="token punctuation">;</span><br><br><span class="token comment">// In order to use methods defined by a trait, the trait must be in scope.</span><br><span class="token keyword">use</span> <span class="token namespace">printable<span class="token punctuation">::</span></span><span class="token class-name">Printable</span><span class="token punctuation">;</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span><br>        first_name<span class="token punctuation">:</span> <span class="token string">"Mark"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        last_name<span class="token punctuation">:</span> <span class="token string">"Volkmann"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    p<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>Traits can specify other traits that must also be implemented by any types that implement them. These are referred to as &quot;supertraits&quot;. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token type-definition class-name">HockeyPlayer</span><span class="token punctuation">:</span> <span class="token class-name">Athlete</span> <span class="token operator">+</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Describe functions unique to hockey players here.</span><br><span class="token punctuation">}</span></code></pre><p>Now any <code>struct</code> that implements <code>HockeyPlayer</code> must also implement the <code>Athlete</code> and <code>Person</code> traits. Also see the <code>Printable</code> example later in this section.</p><p>It is possible for a type to implement multiple traits that describe constants and/or methods with the same names. Calling them requires doing so in a form that makes it clear which is desired. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">trait</span> <span class="token type-definition class-name">First</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> <span class="token constant">SOME_CONST</span><span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// associated constant</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">some_method</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"First some_method {}"</span><span class="token punctuation">,</span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token constant">SOME_CONST</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">trait</span> <span class="token type-definition class-name">Second</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> <span class="token constant">SOME_CONST</span><span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// associated constant</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">some_method</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Second some_method {}"</span><span class="token punctuation">,</span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token constant">SOME_CONST</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Implement both traits on the built-in bool type.</span><br><span class="token keyword">impl</span> <span class="token class-name">First</span> <span class="token keyword">for</span> <span class="token keyword">bool</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// using default some_method implementation</span><br><span class="token keyword">impl</span> <span class="token class-name">Second</span> <span class="token keyword">for</span> <span class="token keyword">bool</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// using default some_method implementation</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">//println!("{}", bool::SOME_CONST); // error; multiple `VALUE` found</span><br>    <span class="token comment">//println!("{}", First::SOME_CONST); // error; type annotations needed</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">bool</span> <span class="token keyword">as</span> <span class="token class-name">First</span><span class="token operator">></span><span class="token punctuation">::</span><span class="token constant">SOME_CONST</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">bool</span> <span class="token keyword">as</span> <span class="token class-name">Second</span><span class="token operator">></span><span class="token punctuation">::</span><span class="token constant">SOME_CONST</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span><br><br>    <span class="token comment">//true.some_method(); // error; multiple applicable items in scope</span><br>    <span class="token comment">// Using a "fully-qualified function call addresses this.</span><br>    <span class="token comment">// Normal function calls are really syntactic sugar for this form.</span><br>    <span class="token comment">// The compiler converts them to this form.</span><br>    <span class="token class-name">First</span><span class="token punctuation">::</span><span class="token function">some_method</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// First some_method 1</span><br>    <span class="token class-name">Second</span><span class="token punctuation">::</span><span class="token function">some_method</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Second some_method 2</span><br><span class="token punctuation">}</span></code></pre><p><a name="trait-table"></a> The following table summarizes the built-in traits. Those that can be derived (automatically implemented) using the <code>#[derive(trait1, trait2, ...)]</code> attribute are indicted in the &quot;Notes&quot; column. &quot;Marker traits&quot; are used to indicate a property of a type without defining any methods and are also indicated in the &quot;Notes&quot; column. Other traits must be manually implemented.</p><table><thead><tr><th>Trait Name</th><th>Description</th><th>Notes</th></tr></thead><tbody><tr><td><code>std::borrow::Borrow</code></td><td>defines <code>borrow</code> method that allows an immutable type to be borrowed as a different type<br>(ex. <code>String</code> borrowed as <code>str</code>)</td><td></td></tr><tr><td><code>std::borrow::BorrowMut</code></td><td>defines <code>borrow_mut</code> method that allows a mutable type to be borrowed as a different type</td><td></td></tr><tr><td><code>std::borrow::ToOwned</code></td><td>defines <code>to_owned</code> and <code>clone_into</code> methods to construct owned data from a borrow</td><td></td></tr><tr><td><code>std::clone::Clone</code></td><td>defines <code>clone</code> method that explicitly copies an object</td><td>derivable</td></tr><tr><td><code>std::cmp::Eq</code></td><td>defines <code>eq</code> method that is used by the <code>==</code> and <code>!=</code> operators to compare instances</td><td>derivable</td></tr><tr><td><code>std::cmp::Ord</code></td><td>defines <code>cmp</code>, <code>max</code>, <code>min</code>, and <code>clamp</code> methods that are used to<br>compare instances using <code>&lt;</code>, <code>&lt;=</code>, <code>==</code>, <code>!=</code>, <code>&gt;=</code>, and <code>&gt;</code> operators</td><td>derivable</td></tr><tr><td><code>std::cmp::PartialEq</code></td><td>defines <code>eq</code> and <code>ne</code> methods for comparing types where some instances are not equal to themselves (2)</td><td>derivable</td></tr><tr><td><code>std::cmp::PartialOrd</code></td><td>defines <code>partial_cmp</code> method for comparing types where some instances cannot be logically compared to others (3)</td><td>derivable</td></tr><tr><td><code>std::convert::AsMut</code></td><td>defines <code>as_mut</code> method that converts one mutable reference type to another</td><td></td></tr><tr><td><code>std::convert::AsRef</code></td><td>defines <code>as_ref</code> method that converts one reference type to another</td><td></td></tr><tr><td><code>std::convert::From</code></td><td>defines <code>from</code> associated function that converts one value type to another; ex. <code>String::from</code></td><td></td></tr><tr><td><code>std::convert::Into</code></td><td>defines <code>into</code> method that is the opposite of <code>From</code><br>and is automatically implemented when that is implemented</td><td></td></tr><tr><td><code>std::convert::TryFrom</code></td><td>defines <code>try_from</code> method for type conversions that can fail; opposite of <code>TryInto</code></td><td></td></tr><tr><td><code>std::convert::TryInto</code></td><td>defines <code>try_into</code> method for type conversions that can fail; opposite of <code>TryFrom</code></td><td></td></tr><tr><td><code>std::default::Default</code></td><td>defines <code>default</code> associated function for getting a default instance of a type</td><td>derivable</td></tr><tr><td><code>std::fmt::Debug</code></td><td>defines <code>fmt</code> method that outputs a value for debugging using <code>{:?}</code> and <code>{:#?}</code> in a format string</td><td>derivable</td></tr><tr><td><code>std::fmt::Display</code></td><td>defines <code>fmt</code> method that formats a value for output<br>to be seen by a user rather than a developer</td><td></td></tr><tr><td><code>std::hash::Hash</code></td><td>defines <code>hash</code> method for computing the hash value of an instance (1)</td><td>derivable</td></tr><tr><td><code>std::io::Read</code></td><td>defines <code>read</code> method that reads the receiver value into an array of bytes (4)</td><td></td></tr><tr><td><code>std::io::Write</code></td><td>defines <code>write</code> method that writes data from an array of bytes into the receiver</td><td></td></tr><tr><td><code>std::iter::Extend</code></td><td>defines <code>extend</code> method that adds items to a collection</td><td></td></tr><tr><td><code>std::iter::FromIterator</code></td><td>defines <code>from_iter</code> method that is used to automatically<br>convert an iterator to a collection</td><td></td></tr><tr><td><code>std::iter::IntoIterator</code></td><td>defines <code>into_iter</code> method that is used to automatically<br>convert a collection to an iterator over it</td><td></td></tr><tr><td><code>std::iter::Iterator</code></td><td>defines <code>next</code> method for iterating over the data in a value</td><td></td></tr><tr><td><code>std::iter::Product</code></td><td>defines <code>product</code> method on an iterator to compute the product of its items</td><td></td></tr><tr><td><code>std::iter::Sum</code></td><td>defines <code>sum</code> method for on an iterator to compute the sum of its items</td><td></td></tr><tr><td><code>std::marker::Copy</code></td><td>marks a type whose instances can be implicitly copied by assignment or passing by value</td><td>derivable, marker</td></tr><tr><td><code>std::marker::Send</code></td><td>marks a type whose instance ownership can be transferred from one thread to another</td><td>marker</td></tr><tr><td><code>std::marker::Sized</code></td><td>marks a type whose instance sizes are known a compile time</td><td>marker</td></tr><tr><td><code>std::marker::Sync</code></td><td>marks a type whose instance references can be shared between threads</td><td>marker</td></tr><tr><td><code>std::marker::Unpin</code></td><td>marks a type whose instances can be moved after being pinned to a memory location</td><td>marker</td></tr><tr><td><code>std::ops::Add</code></td><td>defines the <code>+</code> operator on a type</td><td></td></tr><tr><td><code>std::ops::AddAssign</code></td><td>defines the <code>+=</code> operator on a type</td><td></td></tr><tr><td><code>std::ops::BitAnd</code></td><td>defines the <code>&amp;</code> operator on a type</td><td></td></tr><tr><td><code>std::ops::BitAndAssign</code></td><td>defines the <code>&amp;=</code> operator on a type</td><td></td></tr><tr><td><code>std::ops::BitOr</code></td><td>defines the <code>|</code> operator on a type</td><td></td></tr><tr><td><code>std::ops::BitOrAssign</code></td><td>defines the <code>| =</code> operator on a type</td><td></td></tr><tr><td><code>std::ops::BitXor</code></td><td>defines the <code>^</code> operator on a type</td><td></td></tr><tr><td><code>std::ops::BitXorAssign</code></td><td>defines the <code>^=</code> operator on a type</td><td></td></tr><tr><td><code>std::ops::Deref</code></td><td>defines <code>deref</code> method that allows smart pointers to be<br>used as immutable references to the data to which they point</td><td></td></tr><tr><td><code>std::ops::DerefMut</code></td><td>defines <code>deref_mut</code> method that allows smart pointers to be<br>used as mutable references to the data to which they point</td><td></td></tr><tr><td><code>std::ops::Div</code></td><td>defines the <code>/</code> operator on a type</td><td></td></tr><tr><td><code>std::ops::DivAssign</code></td><td>defines the <code>/=</code> operator on a type</td><td></td></tr><tr><td><code>std::ops::Drop</code></td><td>defines <code>drop</code> method that is called when a value is dropped, typically to free resources</td><td></td></tr><tr><td><code>std::ops::Fn</code></td><td>defines <code>call</code> method for closures that borrow values from their environment immutably</td><td></td></tr><tr><td><code>std::ops::FnMut</code></td><td>defines <code>call_mut</code> method for closures that borrow values from their environment mutably</td><td></td></tr><tr><td><code>std::ops::FnOnce</code></td><td>defines <code>call_once</code> method for closures that takes ownership of values from their environment;<br>can only be called once</td><td></td></tr><tr><td><code>std::ops::Index</code></td><td>defines <code>index</code> method for getting data from a value by index; supports <code>[index]</code> syntax</td><td></td></tr><tr><td><code>std::ops::IndexMut</code></td><td>defines <code>index</code> method</td><td></td></tr><tr><td><code>std::ops::Mul</code></td><td>defines the <code>*</code> operator on a type</td><td></td></tr><tr><td><code>std::ops::MulAssign</code></td><td>defines the <code>*=</code> operator on a type</td><td></td></tr><tr><td><code>std::ops::Neg</code></td><td>defines the unary <code>-</code> operator on a type</td><td></td></tr><tr><td><code>std::ops::Not</code></td><td>defines the unary <code>!</code> operator on a type</td><td></td></tr><tr><td><code>std::ops::RangeBound</code></td><td>defines the <code>..</code> and <code>..=</code> operator on a type</td><td></td></tr><tr><td><code>std::ops::Rem</code></td><td>defines the <code>%</code> mod operator on a type</td><td></td></tr><tr><td><code>std::ops::RemAssign</code></td><td>defines the <code>%=</code> mod operator on a type</td><td></td></tr><tr><td><code>std::ops::Shl</code></td><td>defines the <code>&lt;&lt;</code> operator on a type</td><td></td></tr><tr><td><code>std::ops::ShlAssign</code></td><td>defines the <code>&lt;&lt;=</code> operator on a type</td><td></td></tr><tr><td><code>std::ops::Shr</code></td><td>defines the <code>&gt;&gt;</code> operator on a type</td><td></td></tr><tr><td><code>std::ops::ShrAssign</code></td><td>defines the <code>&gt;&gt;=</code> operator on a type</td><td></td></tr><tr><td><code>std::ops::Sub</code></td><td>defines the <code>-</code> operator on a type</td><td></td></tr><tr><td><code>std::ops::SubAssign</code></td><td>defines the <code>-=</code> operator on a type</td><td></td></tr><tr><td><code>std::str::FromStr</code></td><td>defines <code>from_str</code> associated function that converts a <code>&amp;str</code> value to the implementing type</td><td></td></tr><tr><td><code>std::string::ToString</code></td><td>defines <code>to_string</code> method that is automatically implemented by implementing the <code>Display</code> trait</td><td></td></tr></tbody></table><ol><li>The <code>hash</code> method is used by the <code>HashMap</code> and <code>HashSet</code> collections.</li><li>This means values are not necessarily reflexive. For example, the number value <code>NaN</code> is not equal to itself.</li><li>For example, the number value <code>NaN</code> is not less than, equal to, or greater than zero.</li><li>The term &quot;receiver&quot; refers to the value to the left of the dot.</li></ol><p>Here is an example of implementing some of the built-in traits for a custom struct:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>cmp<span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>default<span class="token punctuation">::</span></span><span class="token class-name">Default</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Add</span><span class="token punctuation">,</span> <span class="token class-name">AddAssign</span><span class="token punctuation">,</span> <span class="token class-name">Sub</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token attribute attr-name">#[derive(Clone, Copy, Debug, Default)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Color</span> <span class="token punctuation">{</span><br>    r<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span><br>    g<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span><br>    b<span class="token punctuation">:</span> <span class="token keyword">u8</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Implementing the "Add" trait enables using</span><br><span class="token comment">// the "+" operator to add "Color" instances.</span><br><span class="token keyword">impl</span> <span class="token class-name">Add</span> <span class="token keyword">for</span> <span class="token class-name">Color</span> <span class="token punctuation">{</span><br>    <span class="token comment">// The "Add" trait requires specifying an "associated type"</span><br>    <span class="token comment">// named "Output" that specifies the return type of the "add" method.</span><br>    <span class="token comment">// It could be a type other than "Self" which represents</span><br>    <span class="token comment">// the type on which it is being implemented (Color in this case),</span><br>    <span class="token comment">// but that's what we want here.</span><br>    <span class="token keyword">type</span> <span class="token type-definition class-name">Output</span> <span class="token operator">=</span> <span class="token keyword">Self</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">fn</span> <span class="token function-definition function">add</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token keyword">Self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span><br>        <span class="token keyword">Self</span> <span class="token punctuation">{</span><br>            r<span class="token punctuation">:</span> <span class="token namespace">cmp<span class="token punctuation">::</span></span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>r <span class="token operator">+</span> other<span class="token punctuation">.</span>r<span class="token punctuation">)</span><span class="token punctuation">,</span><br>            g<span class="token punctuation">:</span> <span class="token namespace">cmp<span class="token punctuation">::</span></span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>g <span class="token operator">+</span> other<span class="token punctuation">.</span>g<span class="token punctuation">)</span><span class="token punctuation">,</span><br>            b<span class="token punctuation">:</span> <span class="token namespace">cmp<span class="token punctuation">::</span></span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>b <span class="token operator">+</span> other<span class="token punctuation">.</span>b<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Implementing the "AddAssign" trait enables using the</span><br><span class="token comment">// "+=" operator to add a "Color" instance to a receiver "Color".</span><br><span class="token keyword">impl</span> <span class="token class-name">AddAssign</span> <span class="token keyword">for</span> <span class="token class-name">Color</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">add_assign</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token keyword">Self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span>r <span class="token operator">=</span> <span class="token namespace">cmp<span class="token punctuation">::</span></span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>r <span class="token operator">+</span> other<span class="token punctuation">.</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span>g <span class="token operator">=</span> <span class="token namespace">cmp<span class="token punctuation">::</span></span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>g <span class="token operator">+</span> other<span class="token punctuation">.</span>g<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token namespace">cmp<span class="token punctuation">::</span></span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>b <span class="token operator">+</span> other<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Implementing the "Sub" trait enables using the</span><br><span class="token comment">// "-" operator to subtract "Color" instances.</span><br><span class="token keyword">impl</span> <span class="token class-name">Sub</span> <span class="token keyword">for</span> <span class="token class-name">Color</span> <span class="token punctuation">{</span><br>    <span class="token keyword">type</span> <span class="token type-definition class-name">Output</span> <span class="token operator">=</span> <span class="token keyword">Self</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">fn</span> <span class="token function-definition function">sub</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token keyword">Self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span><br>        <span class="token keyword">Self</span> <span class="token punctuation">{</span><br>            r<span class="token punctuation">:</span> <span class="token namespace">cmp<span class="token punctuation">::</span></span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>r <span class="token operator">-</span> other<span class="token punctuation">.</span>r<span class="token punctuation">)</span><span class="token punctuation">,</span><br>            g<span class="token punctuation">:</span> <span class="token namespace">cmp<span class="token punctuation">::</span></span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>g <span class="token operator">-</span> other<span class="token punctuation">.</span>g<span class="token punctuation">)</span><span class="token punctuation">,</span><br>            b<span class="token punctuation">:</span> <span class="token namespace">cmp<span class="token punctuation">::</span></span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>b <span class="token operator">-</span> other<span class="token punctuation">.</span>b<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Implementing the "SubAssign" trait to enable using the "-=" operator</span><br><span class="token comment">// would be similar to implementing the "AddAssign" trait.</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> red <span class="token operator">=</span> <span class="token class-name">Color</span> <span class="token punctuation">{</span> r<span class="token punctuation">:</span> <span class="token number">255</span><span class="token punctuation">,</span> g<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> blue <span class="token operator">=</span> <span class="token class-name">Color</span> <span class="token punctuation">{</span> r<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> g<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token number">255</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> purple <span class="token operator">=</span> red <span class="token operator">+</span> blue<span class="token punctuation">;</span> <span class="token comment">// can add colors</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> purple<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Color { r: 255, g: 0, b: 255 }</span><br><br>    <span class="token keyword">let</span> blue <span class="token operator">=</span> purple <span class="token operator">-</span> red<span class="token punctuation">;</span> <span class="token comment">// can subtract colors</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> blue<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Color { r: 0, g: 0, b: 255 }</span><br><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> color <span class="token operator">=</span> <span class="token class-name">Color</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    color <span class="token operator">+=</span> red<span class="token punctuation">;</span> <span class="token comment">// can add a Color to the one on the left side</span><br>    color <span class="token operator">+=</span> blue<span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> color<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Color { r: 255, g: 0, b: 255 }</span><br><span class="token punctuation">}</span></code></pre><p>Here is an example of implementing the <code>From</code> and <code>Into</code> traits on custom structs <code>Point2D</code> (a point with x and y coordinates) and <code>Point3D</code> (a point with x, y, and z coordinates). It implements the following type conversions:</p><ul><li><code>Point2D</code> -&gt; <code>Point3D</code> sets <code>z</code> to zero.</li><li><code>Point2D</code> -&gt; <code>f64</code> calculates the distance from the origin.</li><li><code>Point3D</code> -&gt; <code>Point2D</code> discards the <code>z</code> coordinate.</li><li><code>Point3D</code> -&gt; <code>f64</code> calculates the distance from the origin.</li></ul><p>This code can also be found in the GitHub repo <a href="https://github.com/mvolkmann/rust-from-into?v=1.1.1" rel="noopener" target="_blank">rust-from-into</a>.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>convert<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">From</span><span class="token punctuation">,</span> <span class="token class-name">Into</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token attribute attr-name">#[derive(Debug, Default)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Point2D</span> <span class="token punctuation">{</span><br>    x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br>    y<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span><br>        <span class="token keyword">Self</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span> <span class="token class-name">Into</span><span class="token operator">&lt;</span><span class="token keyword">f64</span><span class="token operator">></span> <span class="token keyword">for</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">into</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f64</span> <span class="token punctuation">{</span><br>        <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span> <span class="token class-name">From</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token class-name">Point3D</span><span class="token operator">></span> <span class="token keyword">for</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">from</span><span class="token punctuation">(</span>p3<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Point3D</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span><br>        <span class="token keyword">Self</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> p3<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> p3<span class="token punctuation">.</span>y <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token attribute attr-name">#[derive(Debug, Default)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Point3D</span> <span class="token punctuation">{</span><br>    x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br>    y<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br>    z<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span> <span class="token class-name">Point3D</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span> z<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Point3D</span> <span class="token punctuation">{</span><br>        <span class="token keyword">Self</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span> <span class="token class-name">Into</span><span class="token operator">&lt;</span><span class="token keyword">f64</span><span class="token operator">></span> <span class="token keyword">for</span> <span class="token class-name">Point3D</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">into</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f64</span> <span class="token punctuation">{</span><br>        <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">self</span><span class="token punctuation">.</span>z<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span> <span class="token class-name">From</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token class-name">Point2D</span><span class="token operator">></span> <span class="token keyword">for</span> <span class="token class-name">Point3D</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">from</span><span class="token punctuation">(</span>p2<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Point2D</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span><br>        <span class="token keyword">Self</span> <span class="token punctuation">{</span><br>            x<span class="token punctuation">:</span> p2<span class="token punctuation">.</span>x<span class="token punctuation">,</span><br>            y<span class="token punctuation">:</span> p2<span class="token punctuation">.</span>y<span class="token punctuation">,</span><br>            z<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token class-name">Point2D</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// One way to convert a Point2D to a Point3D.</span><br>    <span class="token keyword">let</span> p3 <span class="token operator">=</span> <span class="token class-name">Point3D</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"p2 to 3D = {:?}"</span><span class="token punctuation">,</span> p3<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Another way to convert a Point2D to a Point3D.</span><br>    <span class="token comment">// Parens are required around the reference because the</span><br>    <span class="token comment">// dot operator for the call to "into" has higher precedence.</span><br>    <span class="token keyword">let</span> p3<span class="token punctuation">:</span> <span class="token class-name">Point3D</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>p2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"p2 to 3D = {:?}"</span><span class="token punctuation">,</span> p3<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> distance<span class="token punctuation">:</span> <span class="token keyword">f64</span> <span class="token operator">=</span> p2<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"p2 distance from origin = {}"</span><span class="token punctuation">,</span> distance<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> p3 <span class="token operator">=</span> <span class="token class-name">Point3D</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">4.0</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// One way to convert a Point3D to a Point2D.</span><br>    <span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token class-name">Point2D</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p3<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"p3 to 2D = {:?}"</span><span class="token punctuation">,</span> p2<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Another way to convert a Point3D to a Point2D.</span><br>    <span class="token keyword">let</span> p2<span class="token punctuation">:</span> <span class="token class-name">Point2D</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>p3<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"p3 to 2D = {:?}"</span><span class="token punctuation">,</span> p2<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> distance<span class="token punctuation">:</span> <span class="token keyword">f64</span> <span class="token operator">=</span> p3<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"p3 distance from origin = {}"</span><span class="token punctuation">,</span> distance<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>Here is an example of implementing a custom trait on built-in types, in this case <code>str</code> and <code>String</code>:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">itertools<span class="token punctuation">::</span></span>join<span class="token punctuation">;</span><br><br><span class="token keyword">trait</span> <span class="token type-definition class-name">Case</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">to_camel</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span><span class="token punctuation">;</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">to_snake</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span> <span class="token class-name">Case</span> <span class="token keyword">for</span> <span class="token keyword">str</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">to_camel</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> word_tuples <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">split_whitespace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">let</span> word_iter <span class="token operator">=</span> word_tuples<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span><br>          <span class="token keyword">let</span> word <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">to_lowercase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token keyword">if</span> index <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span><br>              <span class="token keyword">return</span> word<span class="token punctuation">;</span><br>          <span class="token punctuation">}</span><br>          <span class="token comment">// Change first letter to uppercase.</span><br>          <span class="token keyword">let</span> <span class="token keyword">mut</span> chars <span class="token operator">=</span> word<span class="token punctuation">.</span><span class="token function">chars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// iterator over characters</span><br>          <span class="token keyword">let</span> first <span class="token operator">=</span> chars<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_uppercase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token keyword">let</span> rest <span class="token operator">=</span> chars<span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"{}{}"</span><span class="token punctuation">,</span> first<span class="token punctuation">,</span> rest<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token function">join</span><span class="token punctuation">(</span>word_iter<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">fn</span> <span class="token function-definition function">to_snake</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">{</span><br>        <span class="token function">join</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">split_whitespace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>s<span class="token closure-punctuation punctuation">|</span></span> s<span class="token punctuation">.</span><span class="token function">to_lowercase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"_"</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span> <span class="token class-name">Case</span> <span class="token keyword">for</span> <span class="token class-name">String</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">to_camel</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">{</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_camel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// uses str implementation</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">fn</span> <span class="token function-definition function">to_snake</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">{</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_snake</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// uses str implementation</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token string">"Foo BAR bAZ"</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> s2<span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s1<span class="token punctuation">.</span><span class="token function">to_camel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// fooBarBaz</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s2<span class="token punctuation">.</span><span class="token function">to_camel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// fooBarBaz</span><br><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s1<span class="token punctuation">.</span><span class="token function">to_snake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// foo_bar_baz</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s2<span class="token punctuation">.</span><span class="token function">to_snake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// foo_bar_baz</span><br><span class="token punctuation">}</span></code></pre><p>Traits can be used as parameter and return types to specify that any type which implements them can be substituted. Specifying traits as a qualifier on a generic type is referred to a &quot;trait bound&quot;. In the <code>print_string</code> function below, the type of the first parameter is <code>&amp;str</code> and the type of the second is a reference to any type that implements both the <code>Debug</code> and <code>ToString</code> traits. The compiler will generate separate versions of the function for each concrete type passed as the second argument.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Debug</span><span class="token punctuation">;</span><br><br><span class="token attribute attr-name">#[derive(Debug)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Point2D</span> <span class="token punctuation">{</span><br>    x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br>    y<span class="token punctuation">:</span> <span class="token keyword">f64</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span> <span class="token class-name">ToString</span> <span class="token keyword">for</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">to_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">{</span><br>        <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"({}, {})"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// There are three ways to write the function signature</span><br><span class="token comment">// that all specify that the "value" parameter</span><br><span class="token comment">// must implement both the "Debug" and "ToString" traits:</span><br><span class="token comment">// 1) fn print_string(label: &amp;str, value: &amp;(impl Debug + ToString)) {</span><br><span class="token comment">// 2) fn print_string&lt;T: Debug + ToString>(label: &amp;str, value: &amp;T) {</span><br><span class="token comment">// 3) fn print_string&lt;T>(label: &amp;str, value: &amp;T)</span><br><span class="token comment">//    where T: Debug + ToString {</span><br><span class="token comment">// Option 3 is often used when there are multiple generic parameters</span><br><span class="token comment">// or they have more than one trait bound.</span><br><span class="token keyword">fn</span> <span class="token function-definition function">print_string</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">(</span>label<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">T</span><span class="token punctuation">)</span><br><span class="token keyword">where</span> <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Debug</span> <span class="token operator">+</span> <span class="token class-name">ToString</span> <span class="token punctuation">{</span><br>  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}: {}"</span><span class="token punctuation">,</span> label<span class="token punctuation">,</span> value<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"debug: {:?}"</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token function">print_string</span><span class="token punctuation">(</span><span class="token string">"Name"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">"Mark"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// Name: Mark</span><br>  <span class="token comment">// debug: "Mark"</span><br><br>  <span class="token function">print_string</span><span class="token punctuation">(</span><span class="token string">"Score"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Score: 19</span><br>  <span class="token comment">// Score: 19</span><br>  <span class="token comment">// debug: 19</span><br><br>  <span class="token keyword">let</span> pt <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1.2</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">3.4</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token function">print_string</span><span class="token punctuation">(</span><span class="token string">"Point"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>pt<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// Point: (1.2, 3.4)</span><br>  <span class="token comment">// debug: Point2D { x: 1.2, y: 3.4 }</span><br><span class="token punctuation">}</span></code></pre><p>Another approach is to use the <code>dyn</code> keyword. This causes the compiler to generate a single version of a function that uses runtime dynamic dispatch. Here is a new version of the <code>print_string</code> function that does this:</p><pre class="language-rust"><code class="language-rust"><span class="token comment">// We need to define a new trait that combines the desired traits</span><br><span class="token comment">// because only one trait name can follow the `dyn` keyword.</span><br><span class="token keyword">trait</span> <span class="token type-definition class-name">Printable</span><span class="token punctuation">:</span> <span class="token class-name">Debug</span> <span class="token operator">+</span> <span class="token class-name">ToString</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Debug</span> <span class="token operator">+</span> <span class="token class-name">ToString</span><span class="token operator">></span> <span class="token class-name">Printable</span> <span class="token keyword">for</span> <span class="token class-name">T</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">print_string</span><span class="token punctuation">(</span>label<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">dyn</span> <span class="token class-name">Printable</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}: {}"</span><span class="token punctuation">,</span> label<span class="token punctuation">,</span> value<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"debug: {:?}"</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>Writing functions that operate on any numeric type can be done using trait bounds. There are three ways to specify them. One way is shown in this example.</p><pre class="language-rust"><code class="language-rust"><span class="token comment">// The trait bound "Copy + Into&lt;f32>" means that this</span><br><span class="token comment">// takes a slice of any type that can be copied</span><br><span class="token comment">// and can be converted to the f32 type.</span><br><span class="token comment">// This is true of all the primitive numbers types except f64.</span><br><span class="token comment">// This approach is more flexible than declaring the parameter</span><br><span class="token comment">// to be "&amp;[i32]" which only accepts a slice of i32 values.</span><br><span class="token keyword">fn</span> <span class="token function-definition function">sum</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">(</span>numbers<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f32</span><br><span class="token keyword">where</span> <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Copy</span> <span class="token operator">+</span> <span class="token class-name">Into</span><span class="token operator">&lt;</span><span class="token keyword">f32</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token comment">// The map part below can also be written as ".map(|x| x.into())".</span><br>    numbers<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">copied</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Into</span><span class="token punctuation">::</span>into<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">f32</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">average</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">(</span>numbers<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f32</span><br><span class="token keyword">where</span> <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Copy</span> <span class="token operator">+</span> <span class="token class-name">Into</span><span class="token operator">&lt;</span><span class="token keyword">f32</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token function">sum</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span> <span class="token operator">/</span> numbers<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">f32</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">200u8</span><span class="token punctuation">,</span> <span class="token number">255u8</span><span class="token punctuation">,</span> <span class="token number">3u8</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> total <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>numbers<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"total = {}"</span><span class="token punctuation">,</span> total<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 458 which would overflow u8</span><br><br>    <span class="token keyword">let</span> scores<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Print average of all scores.</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"average = {:.1}"</span><span class="token punctuation">,</span> <span class="token function">average</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>scores<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 86.2</span><br><br>    <span class="token comment">// Print average of all scores except the first.</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"average = {:.1}"</span><span class="token punctuation">,</span> <span class="token function">average</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>scores<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 91.7</span><br><span class="token punctuation">}</span></code></pre><p>Alternatively we can define a new trait that combines several others and then use it as a trait bound. With the following in place, we can use the trait <code>Number</code> in the code above in place of <code>Copy + Into&lt;f32&gt;</code>. We can also use it in functions that need the capabilities of the additional traits from the <code>std::ops</code> namespace.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span><br><span class="token keyword">trait</span> <span class="token type-definition class-name">Number</span><span class="token punctuation">:</span><br>    <span class="token class-name">Add</span> <span class="token operator">+</span> <span class="token class-name">AddAssign</span> <span class="token operator">+</span> <span class="token class-name">Copy</span> <span class="token operator">+</span> <span class="token class-name">Div</span> <span class="token operator">+</span> <span class="token class-name">DivAssign</span> <span class="token operator">+</span><br>    <span class="token class-name">Into</span><span class="token operator">&lt;</span><span class="token keyword">f64</span><span class="token operator">></span> <span class="token operator">+</span> <span class="token class-name">Mul</span> <span class="token operator">+</span> <span class="token class-name">MulAssign</span> <span class="token operator">+</span> <span class="token class-name">Sub</span> <span class="token operator">+</span> <span class="token class-name">SubAssign</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token class-name">Number</span> <span class="token keyword">for</span> <span class="token class-name">T</span> <span class="token keyword">where</span><br>    <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Add</span> <span class="token operator">+</span> <span class="token class-name">AddAssign</span> <span class="token operator">+</span> <span class="token class-name">Copy</span> <span class="token operator">+</span> <span class="token class-name">Div</span> <span class="token operator">+</span> <span class="token class-name">DivAssign</span> <span class="token operator">+</span><br>       <span class="token class-name">Into</span><span class="token operator">&lt;</span><span class="token keyword">f64</span><span class="token operator">></span> <span class="token operator">+</span> <span class="token class-name">Mul</span> <span class="token operator">+</span> <span class="token class-name">MulAssign</span> <span class="token operator">+</span> <span class="token class-name">Sub</span> <span class="token operator">+</span> <span class="token class-name">SubAssign</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>A similar approach is used by <a href="https://docs.rs/num-traits/?v=1.1.1" rel="noopener" target="_blank">num_traits</a> library crate.</p><p>Another approach is to use the <a href="https://crates.io/crates/num?v=1.1.1" rel="noopener" target="_blank">num</a> crate. Add this as a dependency in <code>Cargo.toml</code> with a line like <code>num = &quot;0.3.1&quot;</code>.</p><p>For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">num</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">core<span class="token punctuation">::</span>ops<span class="token punctuation">::</span></span><span class="token class-name">AddAssign</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">num<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Num</span><span class="token punctuation">,</span> <span class="token class-name">ToPrimitive</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token comment">// T can be any type that implements the traits</span><br><span class="token comment">// AddAssign, Copy, Num, and ToPrimitive.</span><br><span class="token comment">// The built-in primitive number types like i32, u8, and f32</span><br><span class="token comment">// all implement the AddAssign and Copy traits.</span><br><span class="token comment">// The num crate adds implementations of</span><br><span class="token comment">// Num and ToPrimitive to those same types.</span><br><span class="token comment">// So T can be any built-in numeric type.</span><br><span class="token keyword">fn</span> <span class="token function-definition function">average</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">AddAssign</span> <span class="token operator">+</span> <span class="token class-name">Copy</span> <span class="token operator">+</span> <span class="token class-name">Num</span> <span class="token operator">+</span> <span class="token class-name">ToPrimitive</span><span class="token operator">></span><span class="token punctuation">(</span>numbers<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f32</span> <span class="token punctuation">{</span><br>    <span class="token comment">// The Num trait requires also implementing the Zero trait</span><br>    <span class="token comment">// which defines the zero function.</span><br>    <span class="token comment">// That returns the zero value for the wrapped primitive type.</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> sum <span class="token operator">=</span> <span class="token class-name">T</span><span class="token punctuation">::</span><span class="token function">zero</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">for</span> n <span class="token keyword">in</span> numbers <span class="token punctuation">{</span><br>        sum <span class="token operator">+=</span> <span class="token operator">*</span>n<span class="token punctuation">;</span> <span class="token comment">// requires implementing the AddAssign trait</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">let</span> numerator <span class="token operator">=</span> sum<span class="token punctuation">.</span><span class="token function">to_f32</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    numerator <span class="token operator">/</span> numbers<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">f32</span><br><span class="token punctuation">}</span></code></pre><p>The following table maps built-in traits to the commonly used built-in types that implement them. Knowing this is useful for determining the trait bounds that can be used to write functions that support arguments of multiple types. The goal is provide a sense for the use of each trait. See the official documentation for details.</p><p>Recall that Rust supports the following built-in scalar (single value) types:</p><ul><li><code>bool</code></li><li><code>char</code></li><li>number: float and integer</li><li>float: <code>f32</code> and <code>f64</code></li><li>integer: signed and unsigned</li><li>signed integer: <code>i8</code>, <code>i16</code>, <code>i32</code>, <code>i64</code>, <code>i128</code>, and <code>isize</code></li><li>unsigned integer: <code>u8</code>, <code>u16</code>, <code>u32</code>, <code>u64</code>, <code>u128</code>, and <code>usize</code></li></ul><p>The compound types (multiple values) with fixed sizes include arrays and tuples. When these are listed as a implementing type below, this is only the case if their items implement the trait.</p><p>In the lists of implementing types:</p><ul><li>B means all the built-in scalar and compound types.</li><li>C means any type that implements the <code>Clone</code> trait or slices of such types.</li><li>S means any type with size known at compile type or slices of such types.</li><li>Often there are restrictions on an implementing type. For example, when <code>HashMap</code> is listed, there may be restrictions on the types of keys and values that can be used.</li></ul><table><thead><tr><th>Trait</th><th>Implementing Types</th></tr></thead><tbody><tr><td><code>std::borrow::Borrow</code></td><td>S, scalar, compound, <code>Arc</code>, <code>Box</code>, <code>Rc</code>, <code>String</code>, <code>Vec</code></td></tr><tr><td><code>std::borrow::BorrowMut</code></td><td>S, array, <code>Box</code>, <code>String</code>, <code>Vec</code></td></tr><tr><td><code>std::borrow::ToOwned</code></td><td>C, <code>str</code></td></tr><tr><td><code>std::clone::Clone</code></td><td>B, S, <code>Arc</code>, <code>Box</code>, <code>Error</code>, <code>HashMap</code>, <code>HashSet</code>, <code>LinkedList</code>, <code>Rc</code>, <code>Result</code>, <code>String</code>, <code>Vec</code>, and many more</td></tr><tr><td><code>std::cmp::Eq</code></td><td>B, arrays, ranges, slices, tuples, <code>Arc</code>, <code>Box</code>, <code>Duration</code>, <code>Error</code>, <code>HashMap</code>, <code>HashSet</code>, <code>LinkedList</code>, <code>Rc</code>, <code>Result</code>, <code>String</code>, <code>Vec</code>, and many more</td></tr><tr><td><code>std::cmp::Ord</code></td><td>B, S, arrays, slices, tuples, <code>Arc</code>, <code>Box</code>, <code>Duration</code>, <code>Error</code>, <code>LinkedList</code>, <code>Option</code>, <code>Rc</code>, <code>Result</code>, <code>String</code>, <code>Vec</code></td></tr><tr><td><code>std::cmp::PartialEq</code></td><td>B, S, arrays, ranges, slices, tuples, <code>Arc</code>, <code>Box</code>, <code>Duration</code>, <code>HashMap</code>, <code>HashSet</code>, <code>LinkedList</code>, <code>str</code>, <code>String</code>, <code>Vec</code></td></tr><tr><td><code>std::cmp::PartialOrd</code></td><td>B, arrays, tuples, <code>Arc</code>, <code>Box</code>, <code>Duration</code>, <code>Error</code>, <code>LinkedList</code>, <code>Option</code>, <code>Rc</code>, <code>Result</code>, <code>str</code>, <code>String</code>, <code>Vec</code></td></tr><tr><td><code>std::convert::AsMut</code></td><td>arrays, slices, <code>Box</code>, <code>String</code>, <code>Vec</code></td></tr><tr><td><code>std::convert::AsRef</code></td><td>arrays, slices, <code>Arc</code>, <code>Box</code>, <code>Rc</code>, <code>str</code>, <code>String</code>, <code>Vec</code></td></tr><tr><td><code>std::convert::From</code></td><td>B (not <code>bool</code>), <code>Arc</code>, <code>Box</code>, <code>Error</code>, <code>String</code>, <code>Vec</code></td></tr><tr><td><code>std::convert::Into</code></td><td>any type that implements the <code>From</code> trait</td></tr><tr><td><code>std::convert::TryFrom</code></td><td>B (not <code>bool</code>), arrays (and arrays wrapped by <code>Arc</code>, <code>Box</code>, or <code>Rc</code>), <code>Vec</code></td></tr><tr><td><code>std::convert::TryInto</code></td><td>any type that implements the <code>TryFrom</code> trait</td></tr><tr><td><code>std::default::Default</code></td><td>B, arrays, ranges, slices, tuples, <code>Arc</code>, <code>Duration</code>, <code>Error</code>, <code>HashMap</code>, <code>HashSet</code>, <code>LinkedList</code>, <code>Rc</code>, <code>String</code>, <code>Vec</code></td></tr><tr><td><code>std::fmt::Debug</code></td><td>B, arrays, ranges, slices, tuples, <code>Arc</code>, <code>Box</code>, <code>Duration</code>, <code>Error</code>, <code>HashMap</code>, <code>HashSet</code>, <code>Rc</code>, <code>str</code>, <code>String</code></td></tr><tr><td><code>std::fmt::Display</code></td><td>B, <code>Arc</code>, <code>Box</code>, <code>Error</code>, <code>Rc</code>, <code>str</code> <code>String</code></td></tr><tr><td><code>std::hash::Hash</code></td><td>B, arrays, ranges, slices, tuples, <code>Arc</code>, <code>Box</code>, <code>LinkedList</code>, <code>Rc</code>, <code>Result</code>, <code>Vec</code></td></tr><tr><td><code>std::io::Read</code></td><td><code>BufReader</code>, <code>File</code>, <code>Stdin</code>, <code>TcpStream</code>, <code>UnixStream</code></td></tr><tr><td><code>std::io::Write</code></td><td><code>BufWriter</code>, <code>File</code> <code>LineWriter</code>, <code>Stderr</code>, <code>Stdout</code>, <code>TcpStream</code>, <code>UnixStream</code></td></tr><tr><td><code>std::iter::Extend</code></td><td><code>HashMap</code>, <code>HashSet</code>, <code>LinkedList</code>, <code>String</code>, <code>Vec</code></td></tr><tr><td><code>std::iter::FromIterator</code></td><td><code>Arc</code>, <code>Box</code>, <code>HashMap</code>, <code>HashSet</code>, <code>LinkedList</code>, <code>Option</code>, <code>Rc</code>, <code>Result</code>, <code>String</code>, <code>Vec</code></td></tr><tr><td><code>std::iter::IntoIterator</code></td><td>arrays, slices, <code>HashMap</code>, <code>LinkedList</code>, <code>Option</code>, <code>Result</code>, <code>Vec</code></td></tr><tr><td><code>std::iter::Iterator</code></td><td>ranges and many more</td></tr><tr><td><code>std::iter::Product</code></td><td>numbers, <code>Option</code>, <code>Result</code></td></tr><tr><td><code>std::iter::Sum</code></td><td>numbers, <code>Option</code>, <code>Result</code></td></tr><tr><td><code>std::marker::Copy</code></td><td>B, arrays, tuples, <code>Error</code>, <code>Result</code></td></tr><tr><td><code>std::marker::Send</code></td><td>B, arrays, ranges, slices, <code>Arc</code>, <code>Box</code>, <code>Cell</code>, <code>Error</code>, <code>HashMap</code>, <code>HashSet</code>, <code>LinkedList</code>, <code>RefCell</code>, <code>Vec</code></td></tr><tr><td><code>std::marker::Sized</code></td><td>From the docs, &quot;All type parameters have an implicit bound of <code>Sized</code>.<br>The special syntax <code>?Sized</code> can be used to remove this bound if it's not appropriate.&quot;</td></tr><tr><td><code>std::marker::Sync</code></td><td>B, arrays, ranges, slices, <code>Arc</code>, <code>Box</code>, <code>Duration</code>, <code>Error</code>, <code>HashMap</code>, <code>HashSet</code>, <code>LinkedList</code>, <code>Result</code>, <code>String</code>, <code>Vec</code></td></tr><tr><td><code>std::marker::Unpin</code></td><td>B, arrays, ranges, slices, <code>Arc</code>, <code>Box</code>, <code>Cell</code>, <code>Duration</code>, <code>HashMap</code>, <code>HashSet</code>, <code>LinkedList</code>, <code>Ref</code>, <code>RefCell</code>, <code>Result</code>, <code>String</code>, <code>Vec</code></td></tr><tr><td><code>std::ops::Add</code></td><td>numbers, <code>Duration</code>, <code>String</code></td></tr><tr><td><code>std::ops::AddAssign</code></td><td>numbers</td></tr><tr><td><code>std::ops::BitAnd</code></td><td><code>bool</code>, numbers</td></tr><tr><td><code>std::ops::BitAndAssign</code></td><td><code>bool</code>, numbers</td></tr><tr><td><code>std::ops::BitOr</code></td><td><code>bool</code>, numbers</td></tr><tr><td><code>std::ops::BitOrAssign</code></td><td><code>bool</code>, numbers</td></tr><tr><td><code>std::ops::BitXor</code></td><td><code>bool</code>, numbers</td></tr><tr><td><code>std::ops::BitXorAssign</code></td><td><code>bool</code>, numbers:</td></tr><tr><td><code>std::ops::Deref</code></td><td><code>Arc</code>, <code>Box</code>, <code>Rc</code>, <code>Ref</code>, <code>RefMut</code>, <code>String</code>, <code>Vec</code></td></tr><tr><td><code>std::ops::DerefMut</code></td><td><code>Box</code>, <code>String</code>, <code>Vec</code></td></tr><tr><td><code>std::ops::Div</code></td><td>numbers</td></tr><tr><td><code>std::ops::DivAssign</code></td><td>numbers</td></tr><tr><td><code>std::ops::Drop</code></td><td><code>Arc</code>, <code>Box</code>, <code>LinkedList</code>, <code>Rc</code></td></tr><tr><td><code>std::ops::Fn</code></td><td></td></tr><tr><td><code>std::ops::FnMut</code></td><td></td></tr><tr><td><code>std::ops::FnOnce</code></td><td></td></tr><tr><td><code>std::ops::Index</code></td><td>slices, <code>HashMap</code>, <code>str</code>, <code>String</code>, <code>Vec</code></td></tr><tr><td><code>std::ops::IndexMut</code></td><td>slices, <code>str</code>, <code>String</code>, <code>Vec</code></td></tr><tr><td><code>std::ops::Mul</code></td><td>numbers</td></tr><tr><td><code>std::ops::MulAssign</code></td><td>numbers</td></tr><tr><td><code>std::ops::Neg</code></td><td>numbers</td></tr><tr><td><code>std::ops::Not</code></td><td><code>bool</code>, numbers</td></tr><tr><td><code>std::ops::RangeBound</code></td><td>ranges</td></tr><tr><td><code>std::ops::Rem</code></td><td>numbers</td></tr><tr><td><code>std::ops::RemAssign</code></td><td>ranges</td></tr><tr><td><code>std::ops::Shl</code></td><td>numbers</td></tr><tr><td><code>std::ops::ShlAssign</code></td><td>numbers</td></tr><tr><td><code>std::ops::Shr</code></td><td>numbers</td></tr><tr><td><code>std::ops::ShrAssign</code></td><td>numbers</td></tr><tr><td><code>std::ops::Sub</code></td><td>numbers</td></tr><tr><td><code>std::ops::SubAssign</code></td><td>numbers</td></tr><tr><td><code>std::str::FromStr</code></td><td>B, <code>String</code></td></tr><tr><td><code>std::string::ToString</code></td><td><code>char</code>, <code>str</code>, <code>String</code></td></tr></tbody></table><h2 id="macros" tabindex="-1"><a name="macros">Macros</a></h2><p>Macros generate code at compile-time. There are two ways to define a macro: &quot;declarative&quot; and &quot;procedural&quot;. There are three ways to use macros: attribute-like, derive, and function-like. Macros defined with the procedural syntax can be used in any of these ways. But macros defined with the declarative syntax can only create function-like macros.</p><p>Declarative macros are defined with <code>macro_rules!</code>. They specify patterns to match, similar to a <code>match</code> expression, and code to replace what is matched. One example is the <code>vec</code> macro that is used create instances of the <code>Vec</code> type.</p><p>Attribute-like macros annotate the code that follows. Examples include:</p><ul><li><code>allow</code> disables certain warnings (ex. <code>unused</code> variables and functions)</li><li><code>cfg</code> conditionally includes an item based on a predicate (ex. configuration value or target OS)</li><li><code>deprecated</code> marks an item as deprecated so usages of it will trigger a warning message</li><li><code>derive</code> derives the implementation of specified traits on a type such as a struct</li><li><code>feature</code> enables unstable or experimental compiler features</li><li><code>macro_use</code> to expand the scope of a macro definition or import macros from another crate</li><li><code>should_panic</code> indicates that a test function is expected to panic</li><li><code>test</code> identifies a test function</li></ul><p>Derive macros specify code to be added to implement traits when the <code>derive</code> attribute is applied to a type such as a struct. For example, <code>#[derive(Clone, Copy, Debug)]</code>.</p><p>Function-like macros are invoked like Rust functions, but with <code>!</code> at the end of their name. Unlike functions, they can take a variable number of arguments. Examples include all the macros in the table below.</p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code>assert</code></td><td>takes a boolean expression and panics if it is false</td></tr><tr><td><code>assert_eq</code></td><td>takes two arguments and panics if they are not equal</td></tr><tr><td><code>assert_ne</code></td><td>takes two arguments and panics if they are equal</td></tr><tr><td><code>dbg</code></td><td>takes expressions separated by commas and<br>prints each followed by <code>=</code> and its value on separate lines</td></tr><tr><td><code>debug_assert</code></td><td>same as <code>assert</code>, but not enabled in release builds</td></tr><tr><td><code>debug_assert_eq</code></td><td>same as <code>assert_eq</code>, but not enabled in release builds</td></tr><tr><td><code>debug_assert_ne</code></td><td>same as <code>assert_ne</code>, but not enabled in release builds</td></tr><tr><td><code>env</code></td><td>takes an environment variable name and is replaced by its value</td></tr><tr><td><code>eprint</code></td><td>same as <code>print</code>, but prints to stderr instead of stdout</td></tr><tr><td><code>eprintln</code></td><td>same as <code>println</code>, but prints to stderr instead of stdout</td></tr><tr><td><code>file</code></td><td>expands to the relative path to the current source file</td></tr><tr><td><code>format</code></td><td>takes a format string and expressions and returns a <code>String</code></td></tr><tr><td><code>include_bytes</code></td><td>takes a relative file path and returns the contents as a byte array</td></tr><tr><td><code>include_str</code></td><td>takes a relative file path and returns the contents as a Unicode string</td></tr><tr><td><code>line</code></td><td>expands to the line number of the current source line</td></tr><tr><td><code>matches</code></td><td>takes an expression and a pattern and returns a boolean indicating whether it matches the pattern</td></tr><tr><td><code>option_env</code></td><td>takes an environment variable name and expands to an <code>Option</code> enum;<br><code>Some(value)</code> if defined, <code>None</code> otherwise</td></tr><tr><td><code>panic</code></td><td>exits program and outputs a stack trace and error message</td></tr><tr><td><code>print</code></td><td>takes a format string and expressions and prints them</td></tr><tr><td><code>println</code></td><td>same as <code>print</code>, but adds a newline at the end</td></tr><tr><td><code>todo</code></td><td>panics with the message &quot;not yet implemented&quot;</td></tr><tr><td><code>unimplemented</code></td><td>panics with the message &quot;not implemented&quot;</td></tr><tr><td><code>unreachable</code></td><td>panics with the message &quot;entered unreachable code&quot;</td></tr><tr><td><code>vec</code></td><td>creates a <code>Vec</code> containing specified items listed in square brackets</td></tr><tr><td><code>write</code></td><td>like <code>print</code>, but writes to a byte buffer</td></tr><tr><td><code>writeln</code></td><td>like <code>write</code>, but adds a newline at the end</td></tr></tbody></table><p>The assert macros are used in tests and to check pre-conditions that must hold at the beginning of functions.</p><p>The <code>dbg</code> macro is incredibly useful for debugging! For example, rather than writing <code>println!(&quot;score = {}&quot;, score);</code> write <code>$dbg(score)</code>.</p><p>The following macros all take a format string and expressions to insert into the format string: <code>eprint</code>, <code>eprintln</code>, <code>format</code>, <code>panic</code>, <code>println</code>, <code>write</code>, and <code>writeln</code>.</p><p>The <code>file</code> and <code>line</code> macros are useful for debugging output. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"in {} on line {} x = {}"</span><span class="token punctuation">,</span> <span class="token macro property">file!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token macro property">line!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The <code>todo</code> and <code>unimplemented</code> macro is called from functions that have not yet been implemented so that calls to them will be flagged. From the official documentation, &quot;The difference ... is that while todo! conveys an intent of implementing the functionality later ..., unimplemented! makes no such claims.&quot;</p><p>The <code>unreachable</code> macro is called in code paths that should never be reached. An example is in the last arm of a <code>match</code> expression that uses a wildcard (<code>_</code>) on the left side where all the expected conditions are described in the preceding match arms.</p><p>Another source of macros is the external crate <code>log</code> which provides macros for logging. It defines the macros <code>debug</code>, <code>error</code>, <code>info</code>, <code>log</code>, <code>trace</code>, and <code>warn</code>.</p><p>Implementing macros is an advanced topic. We will just show some basic examples here. Declarative macros are defined with <code>macro_rules!</code>. They specify code patterns to match and code to replace the match.</p><p>Here is a macro that expands on the provided <code>dbg</code> macro by outputting the relative file path and line number of the call.</p><pre class="language-rust"><code class="language-rust"><span class="token macro property">macro_rules!</span> debug <span class="token punctuation">{</span><br>    <span class="token punctuation">(</span><span class="token variable">$ex</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}@{}: {} = {}"</span><span class="token punctuation">,</span> <span class="token macro property">file!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token macro property">line!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token macro property">stringify!</span><span class="token punctuation">(</span><span class="token variable">$ex</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$ex</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token macro property">debug!</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// outputs src/main.rs@8: 2 + 3 = 5</span><br><span class="token punctuation">}</span></code></pre><p>In the <a href="#scalar-types">Built-in Scalar Types</a> section we included examples of adding methods to built-in types. This can also be accomplished with declarative macros as shown below:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">trait</span> <span class="token type-definition class-name">Days</span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">days_from_now</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token macro property">macro_rules!</span> implement_days <span class="token punctuation">{</span><br>    <span class="token punctuation">(</span><span class="token variable">$t</span><span class="token punctuation">:</span> ty<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> <span class="token comment">// "ty" matches a Rust type</span><br>        <span class="token keyword">impl</span> <span class="token class-name">Days</span> <span class="token keyword">for</span> <span class="token variable">$t</span> <span class="token punctuation">{</span><br>            <span class="token keyword">fn</span> <span class="token function-definition function">days_from_now</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">{</span><br>                <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token keyword">match</span> <span class="token keyword">self</span> <span class="token punctuation">{</span><br>                    <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">=></span> <span class="token string">"yesterday"</span><span class="token punctuation">,</span><br>                    <span class="token number">0</span> <span class="token operator">=></span> <span class="token string">"today"</span><span class="token punctuation">,</span><br>                    <span class="token number">1</span> <span class="token operator">=></span> <span class="token string">"tomorrow"</span><span class="token punctuation">,</span><br>                    _ <span class="token operator">=></span> <span class="token punctuation">{</span><br>                        <span class="token keyword">if</span> <span class="token keyword">self</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">{</span><br>                            <span class="token string">"future"</span><br>                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>                            <span class="token string">"past"</span><br>                        <span class="token punctuation">}</span><br>                    <span class="token punctuation">}</span><br>                <span class="token punctuation">}</span><span class="token punctuation">;</span><br>                s<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>            <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token macro property">implement_days!</span> <span class="token punctuation">{</span><span class="token keyword">i8</span><span class="token punctuation">}</span><br><span class="token macro property">implement_days!</span> <span class="token punctuation">{</span><span class="token keyword">i16</span><span class="token punctuation">}</span><br><span class="token macro property">implement_days!</span> <span class="token punctuation">{</span><span class="token keyword">i32</span><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> d8<span class="token punctuation">:</span> <span class="token keyword">i8</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> d16<span class="token punctuation">:</span> <span class="token keyword">i16</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> d8<span class="token punctuation">.</span><span class="token function">days_from_now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// tomorrow</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> d16<span class="token punctuation">.</span><span class="token function">days_from_now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// yesterday</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token function">days_from_now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// today</span><br><span class="token punctuation">}</span></code></pre><p>In the example above, each call to the <code>implement_days!</code> macro adds the <code>days_from_now</code> method to a single type. To allow adding the the method to multiple types in one call, change the first line inside the macro to the following:</p><pre class="language-rust"><code class="language-rust">    <span class="token punctuation">(</span>$<span class="token punctuation">(</span><span class="token variable">$t</span><span class="token punctuation">:</span> ty<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> $<span class="token punctuation">(</span></code></pre><p>Then add the line <code>)*</code> after the end of the <code>impl</code> block. Now the macro can be called as follows to add the <code>days_from_now</code> method to several types:</p><pre class="language-rust"><code class="language-rust"><span class="token macro property">implement_days!</span> <span class="token punctuation">{</span> <span class="token keyword">i8</span><span class="token punctuation">,</span> <span class="token keyword">i16</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i64</span><span class="token punctuation">,</span> <span class="token keyword">i128</span> <span class="token punctuation">}</span></code></pre><p>The built-in, declarative macro <code>vec</code> is defined as follows:</p><pre class="language-rust"><code class="language-rust"><span class="token macro property">macro_rules!</span> vec <span class="token punctuation">{</span><br>    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><br>        <span class="token variable">$crate</span><span class="token punctuation">::</span><span class="token namespace">vec<span class="token punctuation">::</span></span><span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">(</span><span class="token variable">$elem</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">;</span> <span class="token variable">$n</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><br>        <span class="token variable">$crate</span><span class="token punctuation">::</span><span class="token namespace">vec<span class="token punctuation">::</span></span><span class="token function">from_elem</span><span class="token punctuation">(</span><span class="token variable">$elem</span><span class="token punctuation">,</span> <span class="token variable">$n</span><span class="token punctuation">)</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">(</span>$<span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">+</span> $<span class="token punctuation">(</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><br>        <span class="token operator">&lt;</span><span class="token punctuation">[</span>_<span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">::</span><span class="token function">into_vec</span><span class="token punctuation">(</span><span class="token keyword">box</span> <span class="token punctuation">[</span>$<span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">+</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>TODO: What is the syntax for defining a procedural macro?</p><h2 id="tests" tabindex="-1"><a name="tests">Tests</a></h2><p>Rust supports three kinds of tests: doc tests, unit tests, and integration tests. Examples of each kind of test can be found in the Rust application at <a href="https://github.com/mvolkmann/rust-poker?v=1.1.1" rel="noopener" target="_blank">rust-poker</a>. All of these tests are executed by entering <code>cargo test</code>. To run only test files whose names match a pattern, enter <code>cargo test {pattern}</code>.</p><p>By default output to stdout is captured and not displayed. To run the tests and see this output, enter <code>cargo test -- --nocapture</code>.</p><p>Doc tests are placed in special comments above the library functions they test. A nice feature of these tests is that they provide examples of using the function they test along with other comments about the function. A downside is that because they appear in a comment, editors like VS Code do not inspect the code for syntax and usage errors. Note that placing doc tests above non library functions has no effect.</p><p>Here is an example from the <code>src/lib.js</code> file in the rust-poker app. This function takes a <code>Hand</code> struct that has a <code>cards</code> field with the type <code>Vec&lt;Card&gt;</code>. It also takes a <code>rank</code> that is a <code>char</code> representing a card rank such as <code>K</code> for king. The function returns the suit (a Unicode character) of the first card found with a matching rank.</p><pre class="language-rust"><code class="language-rust"><span class="token comment">/// ```</span><br><span class="token comment">/// use std::str::FromStr; // needs to be in scope</span><br><span class="token comment">/// let hand = poker::Hand::from_str("Q 9 J 8 10").unwrap();</span><br><span class="token comment">/// assert_eq!(poker::get_suit(&amp;hand, 'J'), '');</span><br><span class="token comment">/// ```</span><br><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">get_suit</span><span class="token punctuation">(</span>hand<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Hand</span><span class="token punctuation">,</span> rank<span class="token punctuation">:</span> <span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">char</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>card<span class="token punctuation">)</span> <span class="token operator">=</span> hand<span class="token punctuation">.</span>cards<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;</span>c<span class="token closure-punctuation punctuation">|</span></span> c<span class="token punctuation">.</span>rank <span class="token operator">==</span> rank<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        card<span class="token punctuation">.</span>suit<br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>        <span class="token char">'?'</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>The file <code>src/lib.rs</code> has doc tests above each of the functions it defines. Examine this file for additional doc test examples.</p><p>Unit tests are placed in the source files of the functions they test. Each unit test is meant to test a single function in isolation from the others, although nothing enforces this. Unlike doc tests, these are not placed in comments. This enables editors like VS Code inspect the code for syntax and usage errors.</p><p>Here is an example from the <code>src/lib.js</code> file in the rust-poker app. It tests the <code>suit_name</code> function that takes a suit Unicode character and returns the name of the suit. It also tests the <code>Hand::deal</code> function that deals a set of random cards.</p><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[cfg(test)]</span><br><span class="token keyword">mod</span> <span class="token module-declaration namespace">tests</span> <span class="token punctuation">{</span><br>    <span class="token comment">// This makes all the functions in the containing module available.</span><br>    <span class="token keyword">use</span> <span class="token keyword">super</span><span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span><br><br>    <span class="token attribute attr-name">#[test]</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">it_gets_suit_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token function">suit_name</span><span class="token punctuation">(</span><span class="token char">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"clubs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token function">suit_name</span><span class="token punctuation">(</span><span class="token char">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"diamonds"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token function">suit_name</span><span class="token punctuation">(</span><span class="token char">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"hearts"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token function">suit_name</span><span class="token punctuation">(</span><span class="token char">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"spades"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token attribute attr-name">#[test]</span><br>    <span class="token comment">//#[ignore] to temporarily ignore a test</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">it_deals</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> size <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span><br>        <span class="token keyword">let</span> hand <span class="token operator">=</span> <span class="token class-name">Hand</span><span class="token punctuation">::</span><span class="token function">deal</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>hand<span class="token punctuation">.</span>cards<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token comment">// We could make more assertions here, but</span><br>        <span class="token comment">// other tests cover the creation of individual cards.</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>Integration tests are placed in separate source files under the <code>test</code> directory. Unlike unit tests, these are meant to test multiple functions in conjunction with each other.</p><p>Here is an example from the <code>tests/tests.rs</code> file in the rust-poker app. It tests the <code>evaluate</code> method of the <code>Hand</code> struct which determines the type of hand such as &quot;full house&quot;, &quot;flush&quot;, or &quot;straight&quot;.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> poker<span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">poker<span class="token punctuation">::</span></span><span class="token class-name">Hand</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token keyword">str</span><span class="token punctuation">::</span><span class="token class-name">FromStr</span><span class="token punctuation">;</span><br><br><span class="token attribute attr-name">#[test]</span><br><span class="token keyword">fn</span> <span class="token function-definition function">it_evaluates_hand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> hand <span class="token operator">=</span> <span class="token class-name">Hand</span><span class="token punctuation">::</span><span class="token function">from_str</span><span class="token punctuation">(</span><span class="token string">"A K Q J 10"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>hand<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"royal flush"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> hand <span class="token operator">=</span> <span class="token class-name">Hand</span><span class="token punctuation">::</span><span class="token function">from_str</span><span class="token punctuation">(</span><span class="token string">"Q J 10 9 8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>hand<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"straight flush"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> hand <span class="token operator">=</span> <span class="token class-name">Hand</span><span class="token punctuation">::</span><span class="token function">from_str</span><span class="token punctuation">(</span><span class="token string">"Q 7 Q Q Q"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>hand<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"4 of a kind of queens"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> hand <span class="token operator">=</span> <span class="token class-name">Hand</span><span class="token punctuation">::</span><span class="token function">from_str</span><span class="token punctuation">(</span><span class="token string">"Q 7 Q Q 7"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>hand<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"full house"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> hand <span class="token operator">=</span> <span class="token class-name">Hand</span><span class="token punctuation">::</span><span class="token function">from_str</span><span class="token punctuation">(</span><span class="token string">"Q 7 3 A 9"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>hand<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"flush"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> hand <span class="token operator">=</span> <span class="token class-name">Hand</span><span class="token punctuation">::</span><span class="token function">from_str</span><span class="token punctuation">(</span><span class="token string">"Q 9 J 8 10"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>hand<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"straight"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> hand <span class="token operator">=</span> <span class="token class-name">Hand</span><span class="token punctuation">::</span><span class="token function">from_str</span><span class="token punctuation">(</span><span class="token string">"Q 7 Q Q J"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>hand<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"3 of a kind of queens"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> hand <span class="token operator">=</span> <span class="token class-name">Hand</span><span class="token punctuation">::</span><span class="token function">from_str</span><span class="token punctuation">(</span><span class="token string">"Q 7 Q 5 7"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>hand<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"two pairs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> hand <span class="token operator">=</span> <span class="token class-name">Hand</span><span class="token punctuation">::</span><span class="token function">from_str</span><span class="token punctuation">(</span><span class="token string">"Q 7 Q 5 J"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>hand<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"pair of queens"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> hand <span class="token operator">=</span> <span class="token class-name">Hand</span><span class="token punctuation">::</span><span class="token function">from_str</span><span class="token punctuation">(</span><span class="token string">"Q 7 J 5 A"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>hand<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"high card ace of "</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h2 id="standard-io" tabindex="-1"><a name="standard-io">Standard IO</a></h2><p>The <code>std::io</code> namespace supports many input/output operations. The members <code>stdin</code> and <code>stdout</code> are functions that return objects with methods for operating on the <code>stdin</code> and <code>stdout</code> streams.</p><p>The <code>stdin</code> methods like <code>read_line</code> and <code>stdout</code> methods like <code>write</code> and <code>flush</code> return a <code>Result</code> enum value to enable representing successful operations and errors. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token comment">// The Write trait must be in scope in order to use the flush method.</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token punctuation">{</span>stdin<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> <span class="token class-name">Write</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> buffer <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">loop</span> <span class="token punctuation">{</span><br>        <span class="token comment">// Output a prompt.</span><br>        <span class="token macro property">print!</span><span class="token punctuation">(</span><span class="token string">"Command: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token comment">// Flush stdio without writing a newline character.</span><br>        <span class="token function">stdout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>        <span class="token comment">// Read a line of input from the user.</span><br>        <span class="token function">stdin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read_line</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> buffer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token comment">// Remove the newline character from the end of the buffer.</span><br>        buffer<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>        <span class="token comment">// Break out of the loop if the user entered "quit".</span><br>        <span class="token keyword">if</span> buffer <span class="token operator">==</span> <span class="token string">"quit"</span> <span class="token punctuation">{</span><br>            <span class="token keyword">break</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"You entered {}."</span><span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>        <span class="token comment">// Prepare to reuse the buffer.</span><br>        buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>Here is a modified version of the code above that uses the <code>text_io</code> crate which simplify it. To use this, add the dependency <code>text_io = &quot;0.1.8&quot;</code> in the <code>Cargo.toml</code> file. This version also adds a <code>print</code> function to simplify writing to <code>stdout</code> without including a newline. The <code>main</code> function in this version is much simpler!</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token class-name">Write</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">use</span> <span class="token namespace">text_io<span class="token punctuation">::</span></span>read<span class="token punctuation">;</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">print</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">let</span> <span class="token keyword">mut</span> stdout <span class="token operator">=</span> <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token function">stdout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  stdout<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  stdout<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">loop</span> <span class="token punctuation">{</span><br>    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Command: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> command<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token macro property">read!</span><span class="token punctuation">(</span><span class="token string">"{}\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// reads until newline and omits it</span><br>    <span class="token keyword">if</span> command <span class="token operator">==</span> <span class="token string">"quit"</span> <span class="token punctuation">{</span><br>      <span class="token keyword">break</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"You entered {}."</span><span class="token punctuation">,</span> command<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><h2 id="file-io" tabindex="-1">File IO</h2><p>The <code>std::fs</code> and <code>std::io</code> modules enable reading and writing from files. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">File</span><span class="token punctuation">,</span> read_to_string<span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">BufReader</span><span class="token punctuation">,</span> <span class="token class-name">BufWriter</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token comment">// The following is required to gain access to the</span><br><span class="token comment">// "lines" and "write" methods.</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">write_file</span><span class="token punctuation">(</span>path<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token comment">// To write entire file from one string ...</span><br>    <span class="token comment">//let mut f = File::create(path)?;</span><br>    <span class="token comment">//f.write_all(b"Hello\nWorld\n")</span><br><br>    <span class="token comment">// To write one line at a time ...</span><br>    <span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> writer <span class="token operator">=</span> <span class="token class-name">BufWriter</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// The write method takes a byte slice</span><br>    <span class="token comment">// and returns the number of bytes written.</span><br>    <span class="token comment">// This shows two ways to create a byte slice from a string.</span><br>    writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">b"Hello\n"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"World\n"</span><span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">read_file</span><span class="token punctuation">(</span>path<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token comment">// To read entire file into a string ...</span><br>    <span class="token comment">//let content = read_to_string(path)?;</span><br>    <span class="token comment">//println!("content = {}", content);</span><br><br>    <span class="token comment">// To read one line at a time ...</span><br>    <span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> reader <span class="token operator">=</span> <span class="token class-name">BufReader</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">for</span> line <span class="token keyword">in</span> reader<span class="token punctuation">.</span><span class="token function">lines</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"line = {}"</span><span class="token punctuation">,</span> line<span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// returning unit value</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token string">"demo.txt"</span><span class="token punctuation">;</span><br>    <span class="token function">write_file</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token function">read_file</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre><p>To read and write JSON files, consider using <a href="https://github.com/serde-rs/json?v=1.1.1" rel="noopener" target="_blank">Serde JSON</a>. The name is short for &quot;<b>ser</b>ializing and <b>de</b>serializing&quot;. This requires adding the following dependencies in <code>cargo.toml</code>:</p><pre class="language-toml"><code class="language-toml"><span class="token key property">serde</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"1.0.118"</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"derive"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><br><span class="token key property">serde_json</span> <span class="token punctuation">=</span> <span class="token string">"1.0.60"</span></code></pre><p>Rust allows libraries to &quot;feature-gate&quot; <a href="https://doc.rust-lang.org/cargo/reference/features.html?v=1.1.1" rel="noopener" target="_blank">feature-gate</a> some their features. This enables reduced compile times and generated binary sizes for applications that do not use all the features of a library. The &quot;features&quot; option above specifies that we wish to use parts of the &quot;derive&quot; feature of the &quot;serde&quot; library, which is a gated feature.</p><p>Here is an example of writing and reading a JSON file:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">serde<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Deserialize</span><span class="token punctuation">,</span> <span class="token class-name">Serialize</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> serde_json<span class="token punctuation">;</span><br><br><span class="token attribute attr-name">#[derive(Deserialize, Serialize, Debug)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Dog</span> <span class="token punctuation">{</span><br>    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>    breed<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> dogs <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    dogs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">Dog</span> <span class="token punctuation">{</span><br>        name<span class="token punctuation">:</span> <span class="token string">"Comet"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        breed<span class="token punctuation">:</span> <span class="token string">"Whippet"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    dogs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">Dog</span> <span class="token punctuation">{</span><br>        name<span class="token punctuation">:</span> <span class="token string">"Oscar"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        breed<span class="token punctuation">:</span> <span class="token string">"German Shorthaired Pointer"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Produce JSON from the dogs vector.</span><br>    <span class="token keyword">let</span> json <span class="token operator">=</span> <span class="token namespace">serde_json<span class="token punctuation">::</span></span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>dogs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// To produced pretty-printed JSON, use the following instead:</span><br>    <span class="token comment">// let json = serde_json::to_string_pretty(&amp;dogs).unwrap();</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"json = {}"</span><span class="token punctuation">,</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Parse the JSON to obtain a vector of Dog instances.</span><br>    <span class="token keyword">let</span> dogs<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Dog</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token namespace">serde_json<span class="token punctuation">::</span></span><span class="token function">from_str</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>json<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"dogs = {:#?}"</span><span class="token punctuation">,</span> dogs<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>The JSON produced by the code above is the following, all on a single line:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><br>  <span class="token punctuation">{</span><span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Comet"</span><span class="token punctuation">,</span> <span class="token property">"breed"</span><span class="token operator">:</span> <span class="token string">"Whippet"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Oscar"</span><span class="token punctuation">,</span> <span class="token property">"breed"</span><span class="token operator">:</span> <span class="token string">"German Shorthaired Pointer"</span><span class="token punctuation">}</span><br><span class="token punctuation">]</span></code></pre><h2 id="command-line-arguments" tabindex="-1">Command-line Arguments</h2><p>Command-line arguments can be passed to a Rust program by listing them after the executable path. To execute a Rust program using <code>cargo run</code> and pass it command-line arguments, specify them after <code>--</code> as follows: <code>cargo run -- arg1 arg2 ...</code></p><p>In either case, the arguments are available in the iterator <code>std::env::args</code>. The <code>collect</code> method can be used to create a vector of the arguments. The first item is the path the executable and the remaining items are the actual arguments. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> args<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">args</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Command-line arguments can represent options that affect what an application does. A library crate like <a href="https://crates.io/crates/clap?v=1.1.1" rel="noopener" target="_blank">clap</a> can be used to simplify parsing of the options and provide help.</p><p>The <code>clap</code> crate supports many features including the ability to:</p><ul><li>generate help viewed with <code>--help</code> (not with <code>-h</code>)</li><li>get the program version with <code>--version</code> or <code>-V</code> (not with <code>-v</code>) specified in the code or obtained from the <code>Cargo.toml</code> file</li><li>parse positional arguments (known as &quot;args&quot;)</li><li>parse optional named arguments with no value, also known as &quot;flags&quot; (ex. <code>--quiet</code>)</li><li>parse named arguments with values, also known as &quot;options&quot; (ex. <code>--color yellow</code>)</li><li>parse arguments with default values</li><li>define when an argument is allowed or required (see the <code>Arg</code> methods <code>required_if</code>, <code>required_ifs</code>, <code>required_unless</code>, <code>required_unless_all</code>, and <code>required_unless_one</code>)</li><li>specify options with YAML (However, a benefit of specifying them in code is that an IDE can detect and report errors.)</li><li>produce colored error messages</li><li>parse non-string option values (ex. <code>bool</code>, <code>i32</code>, or <code>f64</code>)</li><li>implement custom value validation</li><li>and more</li></ul><p>Named arguments can have short (ex. <code>-q</code>) and long (ex. <code>--quiet</code>) forms.</p><p>Flags can be combined. This means that <code>-abc</code> is treated the same as <code>-a -b -c</code>.</p><p>Each argument must have a name that is used to retrieve its value. While it typically matches its long name, specifying this name is required because positional options are not required to have a long or short name.</p><p>To demonstrate using <code>clap</code> we will create a program that accepts:</p><ul><li>a positional argument with a type of <code>u8</code> that specifies a size</li><li>an optional flag that causes output to be minimized (<code>--quiet</code>)</li><li>a required option that supplies a color name (<code>--color</code>)</li></ul><p>To get help on the app, enter <code>cargo run -- --help</code> or build the app with <code>cargo build</code> and enter <code>./target/debug/clap-demo --help</code>.</p><p>To run the app, enter <code>cargo run -- 19 --color yellow -q</code> or build the app with <code>cargo build</code> and enter <code>./target/debug/clap-demo -- 19 --color yellow -q</code>.</p><pre class="language-rust"><code class="language-rust"><span class="token comment">// The following attribute enables using macros defined in the clap crate.</span><br><span class="token attribute attr-name">#[macro_use]</span><br><span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">clap</span><span class="token punctuation">;</span><br><br><span class="token keyword">use</span> <span class="token namespace">clap<span class="token punctuation">::</span></span><span class="token class-name">Arg</span><span class="token punctuation">;</span><br><span class="token comment">// Use the following line instead if the</span><br><span class="token comment">// alternate approach described below is selected.</span><br><span class="token comment">//use clap::{App, Arg};</span><br><br><span class="token comment">// This is a custom validator function that</span><br><span class="token comment">// is passed to the `validator` method below.</span><br><span class="token keyword">fn</span> <span class="token function-definition function">validate_color</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> color <span class="token operator">==</span> <span class="token string">"white"</span> <span class="token punctuation">{</span><br>        <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token string">"white is not a valid choice"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// The code below gets some values from the Cargo.toml file.</span><br>    <span class="token comment">// To supply those values in the code here, use the following:</span><br>    <span class="token comment">// let matches = App::new("clap-demo) // next line preferred</span><br>    <span class="token comment">// let matches = App::new(crate_name!()) // gets from Cargo.toml</span><br>    <span class="token comment">//     .about("This demonstrates the use of clap.") // next line preferred</span><br>    <span class="token comment">//     .about(crate_description!()) // gets from Cargo.toml</span><br>    <span class="token comment">//     .author("R. Mark Volkmann") // next line preferred</span><br>    <span class="token comment">//     .author(crate_authors!()) // gets from Cargo.toml</span><br>    <span class="token comment">//     .version("1.0") // next line preferred</span><br>    <span class="token comment">//     .version(crate_version!()) // gets from Cargo.toml</span><br><br>    <span class="token comment">// The preferred approach is to get</span><br>    <span class="token comment">// all possible values from Cargo.toml file.</span><br>    <span class="token comment">// The `app_from_crate!` macro does this by combining</span><br>    <span class="token comment">// the use of all the macros used above.</span><br>    <span class="token keyword">let</span> matches <span class="token operator">=</span> <span class="token macro property">app_from_crate!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token comment">// This adds text before the generated help text.</span><br>        <span class="token punctuation">.</span><span class="token function">before_help</span><span class="token punctuation">(</span><span class="token string">"Welcome to my demo!"</span><span class="token punctuation">)</span> <span class="token comment">// optional; rarely used</span><br>        <span class="token comment">// This adds text after the generated help text.</span><br>        <span class="token punctuation">.</span><span class="token function">after_help</span><span class="token punctuation">(</span><span class="token string">"Have fun!"</span><span class="token punctuation">)</span> <span class="token comment">// optional; rarely used</span><br><br>        <span class="token comment">// Good usage text is generated automatically,</span><br>        <span class="token comment">// but it can be overridden as follows:</span><br>        <span class="token comment">//.usage("overridden usage text")</span><br><br>        <span class="token comment">// This is a named argument that doesn't have a value (a "flag")</span><br>        <span class="token comment">// and is either present or not.</span><br>        <span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span><br>            <span class="token class-name">Arg</span><span class="token punctuation">::</span><span class="token function">with_name</span><span class="token punctuation">(</span><span class="token string">"quiet"</span><span class="token punctuation">)</span><br>                <span class="token punctuation">.</span><span class="token function">long</span><span class="token punctuation">(</span><span class="token string">"quiet"</span><span class="token punctuation">)</span><br>                <span class="token punctuation">.</span><span class="token function">short</span><span class="token punctuation">(</span><span class="token string">"q"</span><span class="token punctuation">)</span><br>                <span class="token punctuation">.</span><span class="token function">help</span><span class="token punctuation">(</span><span class="token string">"minimizes output"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token punctuation">)</span><br><br>        <span class="token comment">// This is a named argument that has a value (an "option").</span><br>        <span class="token comment">// The name can be separated from the value with a space or "=".</span><br>        <span class="token comment">// For example, "--color yellow" or "--color=yellow".</span><br>        <span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span><br>            <span class="token class-name">Arg</span><span class="token punctuation">::</span><span class="token function">with_name</span><span class="token punctuation">(</span><span class="token string">"color"</span><span class="token punctuation">)</span><br>                <span class="token punctuation">.</span><span class="token function">long</span><span class="token punctuation">(</span><span class="token string">"color"</span><span class="token punctuation">)</span><br>                <span class="token punctuation">.</span><span class="token function">short</span><span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">)</span><br>                <span class="token punctuation">.</span><span class="token function">takes_value</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// makes this an "option"</span><br>                <span class="token punctuation">.</span><span class="token function">default_value</span><span class="token punctuation">(</span><span class="token string">"black"</span><span class="token punctuation">)</span><br>                <span class="token punctuation">.</span><span class="token function">value_name</span><span class="token punctuation">(</span><span class="token string">"COLOR"</span><span class="token punctuation">)</span><br>                <span class="token punctuation">.</span><span class="token function">help</span><span class="token punctuation">(</span><span class="token string">"your favorite color"</span><span class="token punctuation">)</span><br>                <span class="token punctuation">.</span><span class="token function">validator</span><span class="token punctuation">(</span>validate_color<span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token punctuation">)</span><br><br>        <span class="token comment">// This argument is positional (an "arg").</span><br>        <span class="token comment">// Positional arguments can come before or after named arguments.</span><br>        <span class="token comment">// Their order is the order in which they are defined here</span><br>        <span class="token comment">// unless the "index" method is called.</span><br>        <span class="token comment">// It specifies the position and is only used on positional arguments.</span><br>        <span class="token comment">// When the "index" method is used, "takes_value" defaults to "true".</span><br>        <span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span><br>            <span class="token class-name">Arg</span><span class="token punctuation">::</span><span class="token function">with_name</span><span class="token punctuation">(</span><span class="token string">"size"</span><span class="token punctuation">)</span><br>                <span class="token punctuation">.</span><span class="token function">takes_value</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><br>                <span class="token punctuation">.</span><span class="token function">help</span><span class="token punctuation">(</span><span class="token string">"how big?"</span><span class="token punctuation">)</span><br>                <span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token punctuation">)</span><br><br>        <span class="token punctuation">.</span><span class="token function">get_matches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// parses command-line arguments</span><br><br>    <span class="token comment">// The "value_of" method returns an "Option" enum, with</span><br>    <span class="token comment">// "Some" wrapping the value or "None" when the option is not present.</span><br>    <span class="token comment">// We can safely call "unwrap" for required options or</span><br>    <span class="token comment">// options with a default value, instead of calling "unwrap_or"</span><br>    <span class="token comment">// which supplies a value to use when a parsing error occurs.</span><br>    <span class="token comment">// In this case, "color" is not required and has a default value.</span><br>    <span class="token keyword">let</span> color <span class="token operator">=</span> matches<span class="token punctuation">.</span><span class="token function">value_of</span><span class="token punctuation">(</span><span class="token string">"color"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Values are always strings, but clap provides</span><br>    <span class="token comment">// a macro to convert them to other types.</span><br>    <span class="token keyword">let</span> size <span class="token operator">=</span> <span class="token macro property">value_t_or_exit!</span><span class="token punctuation">(</span>matches<span class="token punctuation">,</span> <span class="token string">"size"</span><span class="token punctuation">,</span> <span class="token keyword">u8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// The `is_present` method checks whether a flag is present.</span><br>    <span class="token keyword">if</span> matches<span class="token punctuation">.</span><span class="token function">is_present</span><span class="token punctuation">(</span><span class="token string">"quiet"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{} {}"</span><span class="token punctuation">,</span> size<span class="token punctuation">,</span> color<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"You ordered size {} in {}."</span><span class="token punctuation">,</span> size<span class="token punctuation">,</span> color<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><h2 id="modules" tabindex="-1"><a name="modules">Modules</a></h2><p>A module defines a collection of values like constants, functions, and structs. A module can be defined in many places:</p><ol><li>in the Rust standard library</li><li>in a dependency declared in the <code>Cargo.toml</code> file</li><li>in a file whose name is the module name</li><li>in multiple files within a directory whose name is the module name</li><li>inside a source file that uses it (with <code>mod { ... }</code>)</li></ol><p>By default, all members of a module are private. To make a member accessible outside the module, add the <code>pub</code> keyword at the beginning of its definition.</p><p>When a module is defined inside a source file, it is typically only used by code in that file. This is useful for teaching Rust concepts, but is not often used in practice. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">mod</span> <span class="token module-declaration namespace">points</span> <span class="token punctuation">{</span><br>    <span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Point2D</span> <span class="token punctuation">{</span><br>        <span class="token keyword">pub</span> x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br>        <span class="token keyword">pub</span> y<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span> <span class="token comment">// comma after last field is optional</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">impl</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span><br>        <span class="token comment">// Associated function</span><br>        <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">distance_between</span><span class="token punctuation">(</span>pt1<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">,</span> pt2<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f64</span> <span class="token punctuation">{</span><br>            <span class="token keyword">let</span> dx <span class="token operator">=</span> pt1<span class="token punctuation">.</span>x <span class="token operator">-</span> pt2<span class="token punctuation">.</span>x<span class="token punctuation">;</span><br>            <span class="token keyword">let</span> dy <span class="token operator">=</span> pt1<span class="token punctuation">.</span>y <span class="token operator">-</span> pt2<span class="token punctuation">.</span>y<span class="token punctuation">;</span><br>            <span class="token punctuation">(</span>dx<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> dy<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br><br>        <span class="token comment">// Method</span><br>        <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">distance_to</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f64</span> <span class="token punctuation">{</span><br>            <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">distance_between</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">use</span> <span class="token namespace">points<span class="token punctuation">::</span></span><span class="token class-name">Point2D</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">3.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">4.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">6.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">8.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> d1 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">distance_to</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> d1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span><br>    <span class="token keyword">let</span> d2 <span class="token operator">=</span> <span class="token class-name">Point2D</span><span class="token punctuation">::</span><span class="token function">distance_between</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> d2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span><br><span class="token punctuation">}</span></code></pre><p>Moving the module definition into a separate file de-clutters the source file that uses it and enables using the module in many source files.</p><p>Here is the same code, split into two files. First up is the file <code>src/points.rs</code>:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Point2D</span> <span class="token punctuation">{</span><br>    <span class="token keyword">pub</span> x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br>    <span class="token keyword">pub</span> y<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span> <span class="token comment">// comma after last field is optional</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Associated function</span><br>    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">distance_between</span><span class="token punctuation">(</span>pt1<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">,</span> pt2<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f64</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> dx <span class="token operator">=</span> pt1<span class="token punctuation">.</span>x <span class="token operator">-</span> pt2<span class="token punctuation">.</span>x<span class="token punctuation">;</span><br>        <span class="token keyword">let</span> dy <span class="token operator">=</span> pt1<span class="token punctuation">.</span>y <span class="token operator">-</span> pt2<span class="token punctuation">.</span>y<span class="token punctuation">;</span><br>        <span class="token punctuation">(</span>dx<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> dy<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>    <span class="token comment">// Method</span><br>    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">distance_to</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f64</span> <span class="token punctuation">{</span><br>        <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">distance_between</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>In addition to its use in defining a module inside a source file, the <code>mod</code> keyword is used to gain access to modules defined outside. The statement <code>mod name;</code> is equivalent to <code>mod name { include!(&quot;main.rs&quot;); }</code> where <code>main.rs</code> is the file that contains the module definition (determined by the compiler).</p><p>Values in the <code>std::prelude</code> module are automatically made available. A list of these values can be found <a href="https://doc.rust-lang.org/std/prelude/?v=1.1.1" rel="noopener" target="_blank">here</a> and include <code>Box</code>, <code>Option</code>, <code>Result</code>, <code>String</code>, and <code>Vec</code>.</p><p>Other libraries can also define a <code>prelude</code> module, but the values it defines are not automatically imported. Users of the library can include all the items defined in a <code>prelude</code> module using <code>use library_name::prelude::\*;</code>. This is most useful for bringing traits into scope. (See this comment in the <a href="https://users.rust-lang.org/t/defining-a-prelude-module-for-a-library-crate/54018/2?v=1.1.1" rel="noopener" target="_blank">Rust Forum</a>).</p><p>The <code>use</code> statement binds a module path to a new name for easier access. For example, <code>use A::B::C</code> enables using <code>C</code> with just that name instead of its fully qualified name. This is also referred to as bringing <code>C</code> into scope. In this example, <code>C</code> can be any kind of item including a module, enum, struct, or function.</p><p>When bringing functions into scope, it is idiomatic to just specify the path to their parent module in a <code>use</code> statement and use that to refer to the function (<code>ParentModule::fnName</code>). This makes it apparent when looking a calls to these functions that they are not defined locally.</p><p>When bringing other items like structs and enums into scope it is idiomatic to specify their full paths in a <code>use</code> statement and then refer to them using only their name. However, this approach doesn't work if multiple items are needed from different modules and they have the same name. In that case either bring their parent modules into scope and use those to disambiguate references or use the <code>as</code> keyword in the <code>use</code> statement to assign aliases to the names. For example, <code>use math::dimension3::Point as Point3D</code>.</p><p>The file <code>src/main.rs</code> below uses the <code>points</code> module defined above.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">mod</span> <span class="token module-declaration namespace">points</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">points<span class="token punctuation">::</span></span><span class="token class-name">Point2D</span><span class="token punctuation">;</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">3.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">4.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">6.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">8.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> d1 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">distance_to</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> d1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span><br>    <span class="token keyword">let</span> d2 <span class="token operator">=</span> <span class="token class-name">Point2D</span><span class="token punctuation">::</span><span class="token function">distance_between</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> d2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span><br><span class="token punctuation">}</span></code></pre><p>This approach works well for small modules. For large modules it is sometimes desirable to split their definition across multiple source files. Each <code>.rs</code> file defines a module and placing them in subdirectories creates sub-modules. A <code>.rs</code> file can use the <code>mod</code> and <code>use</code> statements to gain access to items in multiple other modules and re-export those items as their own.</p><p>The old way of doing this was to create a directory with the name of the module, place the files that define the module functionality inside it, and create the file <code>mod.rs</code> inside the directory that imports items to be exposed from those files and re-exports them.</p><p>The new way is similar, but a <code>.rs</code> file with the name of the module is created instead of <code>mod.rs</code> and this is placed in the same directory as the module directory.</p><p>Here is the previous code using this approach. We'll add a function to the module that is defined in a different source file than the one that defines the <code>Point2D</code> struct just to demonstrate using multiple files.</p><p>The file <code>src/points/types.rs</code> can be identical to the file <code>src/points.rs</code> above, defining the <code>Point2D</code> struct and it's associated function and method.</p><p>The file <code>src/points/functions.rs</code> defines the function <code>distance_from_origin</code> which returns the distance from a <code>Point2D</code> object to the origin. Note that this is a plain function, not a method or associated function.</p><pre class="language-rust"><code class="language-rust"><span class="token comment">// The super keyword enables finding a module</span><br><span class="token comment">// (types in this case) in the same directory.</span><br><span class="token keyword">use</span> <span class="token keyword">super</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>types<span class="token punctuation">::</span></span><span class="token class-name">Point2D</span><span class="token punctuation">;</span><br><br><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">distance_from_origin</span><span class="token punctuation">(</span>pt<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Point2D</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f64</span> <span class="token punctuation">{</span><br>    <span class="token punctuation">(</span>pt<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> pt<span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre><p>The file <code>src/points.rs</code> ties it all together.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">mod</span> <span class="token module-declaration namespace">functions</span><span class="token punctuation">;</span><br><span class="token keyword">mod</span> <span class="token module-declaration namespace">types</span><span class="token punctuation">;</span><br><span class="token keyword">pub</span> <span class="token keyword">use</span> <span class="token namespace">functions<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span><br><span class="token keyword">pub</span> <span class="token keyword">use</span> <span class="token namespace">types<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span></code></pre><p>The file <code>src/main.rs</code> below demonstrates using all the features of the <code>points</code> module.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">mod</span> <span class="token module-declaration namespace">points</span><span class="token punctuation">;</span><br><span class="token comment">// Note how a "use" statement can access multiple values</span><br><span class="token comment">// from a module using curly braces.</span><br><span class="token keyword">use</span> <span class="token namespace">points<span class="token punctuation">::</span></span><span class="token punctuation">{</span>distance_to_origin<span class="token punctuation">,</span> <span class="token class-name">Point2D</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">3.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">4.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">6.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">8.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> d1 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">distance_to</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> d1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span><br>    <span class="token keyword">let</span> d2 <span class="token operator">=</span> <span class="token class-name">Point2D</span><span class="token punctuation">::</span><span class="token function">distance_between</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> d2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span><br>    <span class="token keyword">let</span> d3 <span class="token operator">=</span> <span class="token function">distance_to_origin</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> d3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span><br><span class="token punctuation">}</span></code></pre><p>Modules can be nested to further segregate the defined items.</p><h2 id="crates" tabindex="-1"><a name="crates">Crates</a></h2><p>A crate is a tree of modules. There are two kinds of crates. Binary (bin) crates produce an executable. Library (lib) crates provide code used by other crates. TODO: Can a crate be both types?</p><p>The most popular source of open source crates is <a href="https://crates.io/?v=1.1.1" rel="noopener" target="_blank">crates.io</a>. Commonly used crates found here include:</p><ul><li><a href="https://crates.io/crates/actix-web?v=1.1.1" rel="noopener" target="_blank">actix-web</a> - web framework</li><li><a href="https://crates.io/crates/chrono?v=1.1.1" rel="noopener" target="_blank">chrono</a> - date and time library</li><li><a href="https://crates.io/crates/clap?v=1.1.1" rel="noopener" target="_blank">clap</a> - command-line argument parser</li><li><a href="https://crates.io/crates/futures?v=1.1.1" rel="noopener" target="_blank">futures</a> - &quot;An implementation of futures and streams featuring zero allocations, composability, and iterator-like interfaces.</li><li><a href="https://crates.io/crates/hyper?v=1.1.1" rel="noopener" target="_blank">hyper</a> - HTTP client library</li><li><a href="https://crates.io/crates/log?v=1.1.1" rel="noopener" target="_blank">log</a> - logging API</li><li><a href="https://crates.io/crates/nom?v=1.1.1" rel="noopener" target="_blank">log</a> - parser combinators library</li><li><a href="https://crates.io/crates/num-traits?v=1.1.1" rel="noopener" target="_blank">num-traits</a> - generic mathematics</li><li><a href="https://crates.io/crates/rand?v=1.1.1" rel="noopener" target="_blank">rand</a> - random number generation</li><li><a href="https://crates.io/crates/rayon?v=1.1.1" rel="noopener" target="_blank">rayon</a> - &quot;data-parallelism library&quot;</li><li><a href="https://crates.io/crates/reqwest?v=1.1.1" rel="noopener" target="_blank">reqwest</a> - HTTP client</li><li><a href="https://crates.io/crates/rocket?v=1.1.1" rel="noopener" target="_blank">rocket</a> - web framework</li><li><a href="https://crates.io/crates/serde?v=1.1.1" rel="noopener" target="_blank">serde</a> - data structure serialization and deserialization, including JSON</li><li><a href="https://crates.io/crates/tokio?v=1.1.1" rel="noopener" target="_blank">tokio</a> - &quot;An event-driven, non-blocking I/O platform for writing asynchronous I/O backed applications.&quot;</li></ul><h2 id="creating-and-using-a-library" tabindex="-1">Creating and Using a Library</h2><p>To create a library project, enter <code>cargo new {name} --lib</code></p><p>To demonstrate, let's create a library for operating on 2D points.</p><ol><li><p>Create the library directory structure by entering <code>cargo new geometry2d --lib</code></p></li><li><p>Enter <code>cd geometry2d</code></p></li><li><p>Create <code>src/geometry2d.rs</code> containing the following:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Point2D</span> <span class="token punctuation">{</span><br>    <span class="token keyword">pub</span> x<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br>    <span class="token keyword">pub</span> y<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Associated function</span><br>    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">distance_between</span><span class="token punctuation">(</span>pt1<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">,</span> pt2<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f64</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> dx <span class="token operator">=</span> pt1<span class="token punctuation">.</span>x <span class="token operator">-</span> pt2<span class="token punctuation">.</span>x<span class="token punctuation">;</span><br>        <span class="token keyword">let</span> dy <span class="token operator">=</span> pt1<span class="token punctuation">.</span>y <span class="token operator">-</span> pt2<span class="token punctuation">.</span>y<span class="token punctuation">;</span><br>        <span class="token punctuation">(</span>dx<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> dy<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// Method</span><br>    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">distance_to</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">f64</span> <span class="token punctuation">{</span><br>        <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">distance_between</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Modify <code>src/lib.rs</code> to contain the following:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">mod</span> <span class="token module-declaration namespace">geometry2d</span><span class="token punctuation">;</span><br><br><span class="token comment">// Expose the Point2D struct as a root item.</span><br><span class="token keyword">pub</span> <span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>geometry2d<span class="token punctuation">::</span></span><span class="token class-name">Point2D</span><span class="token punctuation">;</span><br><br><span class="token attribute attr-name">#[cfg(test)]</span><br><span class="token keyword">mod</span> <span class="token module-declaration namespace">tests</span> <span class="token punctuation">{</span><br>    <span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>geometry2d<span class="token punctuation">::</span></span><span class="token class-name">Point2D</span><span class="token punctuation">;</span><br><br>    <span class="token attribute attr-name">#[test]</span><br>    <span class="token comment">// To temporarily skip a test, add: #[ignore]</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">distance_between</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> pt1 <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">3.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">4.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>        <span class="token keyword">let</span> pt2 <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">6.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">8.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>        <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token class-name">Point2D</span><span class="token punctuation">::</span><span class="token function">distance_between</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pt1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pt2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token attribute attr-name">#[test]</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">distance_to</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> pt1 <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">3.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">4.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>        <span class="token keyword">let</span> pt2 <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">6.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">8.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>        <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>pt1<span class="token punctuation">.</span><span class="token function">distance_to</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pt2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Run the tests by entering <code>cargo test</code></p></li><li><p>Build the library by entering <code>cargo build</code></p></li><li><p>Go back up a directory by entering <code>cd ..</code></p></li><li><p>Create the directory structure for an application that will use the library by entering <code>cargo new geometry2d-app</code></p></li><li><p>Enter <code>cd geometry2d-app</code></p></li><li><p>Modify <code>Cargo.toml</code> to contain the following dependency:</p><pre class="language-toml"><code class="language-toml"><span class="token key property">geometry2d</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">path</span> <span class="token punctuation">=</span> <span class="token string">"../geometry2d"</span> <span class="token punctuation">}</span></code></pre></li><li><p>Modify <code>src/main.rs</code> to contain the following:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">geometry2d</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">geometry2d<span class="token punctuation">::</span></span><span class="token class-name">Point2D</span><span class="token punctuation">;</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> pt1 <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">3.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">4.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> pt2 <span class="token operator">=</span> <span class="token class-name">Point2D</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">6.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">8.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token class-name">Point2D</span><span class="token punctuation">::</span><span class="token function">distance_between</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pt1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pt2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> pt1<span class="token punctuation">.</span><span class="token function">distance_to</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pt2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Run the app by entering <code>cargo run</code></p></li></ol><h2 id="cross-compiling" tabindex="-1">Cross-compiling</h2><p>Rust can build executables for platforms other than the host platform. For example, follow these steps to build a Windows executable when not running on a Windows machine:</p><ol><li>One time, install mingw-w64. In macOS this can be done by installing Homebrew and entering <code>brew install mingw-w64</code></li><li>One time, enter <code>rustup target add x86_64-pc-windows-gnu</code></li><li>One time, enter <code>rustup toolchain install stable-x86_64-pc-windows-gnu</code></li><li><code>cd</code> to the application root directory.</li><li>Enter <code>cargo build --target x86_64-pc-windows-gnu --release</code></li></ol><p>This creates an executable file in the <code>target/x86_64-pc-windows-gnu/release</code> directory with the same name as the project and a <code>.exe</code> file extension.</p><h2 id="smart-pointers" tabindex="-1"><a name="smart-pointers">Smart Pointers</a></h2><p>TODO: Resume review here. Smart pointers are an alternative to references. Each is implemented by a struct that holds metadata and has methods that implement its features. Many are defined in the standard library and developers can implement new ones.</p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code>Arc&lt;T&gt;</code></td><td>stands for &quot;atomically reference counted&quot;; enables multiple owners across multiple threads</td></tr><tr><td><code>Box&lt;T&gt;</code></td><td>a pointer stored on the stack to data on the heap</td></tr><tr><td><code>Cell&lt;T&gt;</code></td><td>enables having multiple mutable references to a value within a single thread (1)</td></tr><tr><td><code>Cow&lt;T&gt;</code></td><td>stands for &quot;Clone On Write&quot;; wraps an immutable borrow and<br>provides the <code>to_mut</code> method for lazy cloning when mutation or ownership is needed</td></tr><tr><td><code>Rc&lt;T&gt;</code></td><td>stands for &quot;reference counted&quot;; enables multiple owners</td></tr><tr><td><code>Ref&lt;T&gt;</code></td><td>used with a <code>RefCell</code> to enforce immutable borrowing rules at runtime</td></tr><tr><td><code>RefCell&lt;T&gt;</code></td><td>similar to <code>Cell</code>, but holds references to values instead of values and supports mutable borrows</td></tr><tr><td><code>RefMut&lt;T&gt;</code></td><td>used with a <code>RefCell</code> to enforce mutable borrowing rules at runtime</td></tr><tr><td><code>String</code></td><td>owns <code>str</code> data, holds <code>capacity</code> and <code>length</code> metadata, and provides methods to operate on the data</td></tr><tr><td><code>Vec&lt;T&gt;</code></td><td>similar to <code>String</code>, but the data elements can be any specified type</td></tr></tbody></table><ol><li>This supports &quot;interior mutability&quot; which is described below.</li></ol><p>Smart pointers must implement the <code>std::ops::Deref</code> and <code>Drop</code> traits. The <code>Deref</code> trait requires a single method, <code>deref</code>, that is used by the dereference operator <code>*</code>. The <code>Drop</code> trait requires a single method, <code>drop</code>, that is called automatically when an object from an implementing struct goes out of scope. It can define what should happen in addition to freeing memory, including freeing resources like file handles and network connections.</p><p>Rust provides &quot;deref coercion&quot; which automatically converts a reference to any value that implements the <code>Deref</code> trait to a reference to the value returned by the <code>deref</code> method. This enables passing references or smart pointers to functions that take a reference. No additional uses of the <code>&amp;</code> or <code>*</code> operators are required. This is why references to <code>String</code> values can be passed to functions that take a <code>&amp;str</code>.</p><p>It is possible to drop (free) a value that implements the <code>Drop</code> trait before it goes out of scope. This is done by passing the value to the prelude function <code>std::mem::drop</code> rather than calling the <code>drop</code> method.</p><p>A <code>Box</code> smart pointer lives on the stack and holds a pointer to data on the heap. It is useful in three scenarios:</p><ol><li>A value that implements a given trait should be owned, but the value can be any type that implements the trait (ex. <code>Box&lt;dyn Error&gt;</code>).</li><li>Ownership of a large value should be transferred without copying the data.</li><li>The size of some data cannot be known at compile time, but it must be used in a context that requires a fixed size (ex. a recursive type such as linked-list or tree)</li></ol><p>An <code>Rc</code> smart pointer holds a reference count that starts at one, is incremented each time it is cloned (by calling <code>Rc::clone(&amp;my_rc)</code>), and is decremented when the original or a clone goes out of scope. The value they refer to is not dropped until the reference count goes to zero. This smart pointer is useful when it is not possible to know at compile-time which scope that uses the data will be the last to do so.</p><p>&quot;Interior mutability&quot; is the ability to modify data inside an immutable object. Normally Rust does not allow this, but the <code>RefCell</code> smart pointer enables it. Often <code>RefCell</code> is used in combination with <code>Rc</code>.</p><p>The <code>Rc</code> smart pointer can hold both strong (owning) and weak (not owning) references. Instances are dropped when the number of strong references goes to zero, but not when the number of weak references goes to zero. This distinction is useful in situations like representing a tree where parent nodes have strong references to children, but children have a weak reference to their parent. The result is that dropping a parent also drops its children (unless there are other strong references to them), but dropping a child does not drop its parent.</p><p>Smart pointers are needed to implement data structures such as linked lists, trees, and graphs. The standard library provides <code>std::collections::LinkedList</code>, but it does not provide structs that implement trees and graphs. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>cell<span class="token punctuation">::</span></span><span class="token class-name">RefCell</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Display</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>rc<span class="token punctuation">::</span></span><span class="token class-name">Rc</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>vec<span class="token punctuation">::</span></span><span class="token class-name">Vec</span><span class="token punctuation">;</span><br><br><span class="token comment">// This is a common combination of types</span><br><span class="token comment">// for holding a reference to a value that can be mutated.</span><br><span class="token comment">// Rc cannot mutate what it holds, but</span><br><span class="token comment">// RefCell provides "interior mutability" which</span><br><span class="token comment">// allows a mutable borrow while immutable borrows exist.</span><br><span class="token comment">// Normally this is not allowed by the compiler, but using</span><br><span class="token comment">// RefCell moves the checking of correct usage to runtime.</span><br><span class="token keyword">type</span> <span class="token type-definition class-name">Wrapper</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token class-name">Rc</span><span class="token operator">&lt;</span><span class="token class-name">RefCell</span><span class="token operator">&lt;</span><span class="token class-name">Node</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">>></span><span class="token operator">></span><span class="token punctuation">;</span><br><br><span class="token attribute attr-name">#[derive(Debug)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Node</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    data<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span><br>    children<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Wrapper</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">>></span><br><span class="token punctuation">}</span><br><br><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Display</span><span class="token operator">></span> <span class="token class-name">Node</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">add_child</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> child<span class="token punctuation">:</span> <span class="token class-name">Wrapper</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Node</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">{</span><br>        <span class="token class-name">Node</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> children<span class="token punctuation">:</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">fn</span> <span class="token function-definition function">depth_first</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">for</span> child <span class="token keyword">in</span> <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>children <span class="token punctuation">{</span><br>            <span class="token comment">// These two lines can be replaced by the one that follows.</span><br>            <span class="token comment">//let child_node = child.borrow();</span><br>            <span class="token comment">//child_node.depth_first();</span><br>            child<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">depth_first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">fn</span> <span class="token function-definition function">wrap</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Wrapper</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">{</span><br>        <span class="token class-name">Rc</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">RefCell</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token class-name">Node</span><span class="token punctuation">::</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token char">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token class-name">Node</span><span class="token punctuation">::</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token char">'B'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token class-name">Node</span><span class="token punctuation">::</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token char">'C'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> d <span class="token operator">=</span> <span class="token class-name">Node</span><span class="token punctuation">::</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token char">'D'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    a<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add_child</span><span class="token punctuation">(</span><span class="token class-name">Rc</span><span class="token punctuation">::</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    a<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add_child</span><span class="token punctuation">(</span><span class="token class-name">Rc</span><span class="token punctuation">::</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    b<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add_child</span><span class="token punctuation">(</span><span class="token class-name">Rc</span><span class="token punctuation">::</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    a<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">depth_first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>The <code>Arc</code> smart pointer is similar to the <code>Rc</code> smart pointer, but can be used by multiple threads to safely share data between them. Often this is used in conjunction with <code>std::sync::Mutex</code> or <code>std::sync::RwLock</code>.</p><p>&quot;Mutex&quot; is short for &quot;mutual exclusion&quot;. Instances guarantee that only one thread at a time will have access to the data it holds. A thread gains access by calling the <code>lock</code> method. This blocks until the lock can be acquired. The lock is automatically released when the variable that holds it goes out of scope.</p><p><code>RwLock</code> instances a similar, but distinguish between uses that need the ability to modify the data and those that merely read the data. Only one thread at a time can acquire a write lock, but any number of threads can acquire a read lock as long as no thread has a write lock. The <code>read</code> and <code>write</code> methods are called to acquire a lock. These block until it can be acquired. Like with a <code>Mutex</code>, the lock is automatically released when the variable that holds it goes out of scope.</p><p>TODO: Also look at use async_std::sync::{Arc, RwLock}; TODO: How does async_std::sync::RwLock differ from std::sync::RwLock? TODO: Is it better to put RwLock outside Arc instead of Arc outside RwLock? TODO: Also discuss the versions of these in the parking_lot crate.:</p><p>I said: It would be great if there was a resource that provided guidance for choosing between the std::sync , async_std::sync , tokio::sync , and parking_lot versions of all of these locking mechanisms.</p><p>Alice replied: Use the guide on Tokio's docs to choose between blocking or async lock, then use either Tokio or async-std's lock if you need an async lock, choosing the same as the one you use as runtime, or std/parking_lot if you need a blocking lock.</p><p>The shared state chapter in Tokio's tutorial has more details. See <a href="https://tokio.rs/tokio/tutorial/shared-state">https://tokio.rs/tokio/tutorial/shared-state</a>.</p><h2 id="threads" tabindex="-1">Threads</h2><p>Rust has built-in support for threads. It uses native threads, not &quot;green threads&quot;. But support for green threads (or &quot;tasks&quot;) is available in popular crates including async-std and tokio.</p><p>When writing to code to execute multiple blocks of code or functions there are four options to consider.</p><ol><li>serially: one at a time</li><li>concurrently: taking turns using a single thread</li><li>parallel using operating system threads</li><li>parallel using tasks (a.k.a. green threads)</li></ol><p>These options are demonstrated using the <code>std</code>, <code>async_std</code>, and <code>tokio</code> crates. Note that options 2 and 4 are not possible using only the <code>std</code> crate.</p><table><thead><tr><th>Option</th><th><code>std</code></th><th><code>async_std</code></th><th><code>tokio</code></th></tr></thead><tbody><tr><td>serial</td><td></td><td></td><td></td></tr><tr><td>concurrent</td><td>x</td><td></td><td></td></tr><tr><td>parallel threads</td><td></td><td></td><td></td></tr><tr><td>parallel tasks</td><td>x</td><td></td><td></td></tr></tbody></table><p>Here is a simple example that spawns a number of threads that each sleep for a random duration, send a value to the main thread using a channel, and return a value. The main thread receives and prints the messages sent over the channel. It also waits for all the threads to finish by calling their <code>join</code> method.</p><p>The file <code>src/main.rs</code> exercises all four options using a single crate. To use a different crate, uncomment the related code in this file and comment the previously uncommented part. This code can be found in the GitHub repo at <a href="https://github.com/mvolkmann/rust-parallel-options?v=1.1.1" rel="noopener" target="_blank">rust-parallel-options</a>.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">;</span><br><br><span class="token keyword">mod</span> <span class="token module-declaration namespace">std_demo</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">std_demo<span class="token punctuation">::</span></span><span class="token punctuation">{</span>concurrent<span class="token punctuation">,</span> parallel_tasks<span class="token punctuation">,</span> parallel_threads<span class="token punctuation">,</span> serial<span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Error</span><span class="token operator">>></span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> <span class="token punctuation">(</span>sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">serial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"serial: sum1 = {:?}, sum2 = {:?}"</span><span class="token punctuation">,</span> sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> <span class="token punctuation">(</span>sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">concurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"concurrent: sum1 = {:?}, sum2 = {:?}"</span><span class="token punctuation">,</span> sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> <span class="token punctuation">(</span>sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">parallel_threads</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"threads: sum1 = {:?}, sum2 = {:?}"</span><span class="token punctuation">,</span> sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> <span class="token punctuation">(</span>sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">parallel_tasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"tasks: sum1 = {:?}, sum2 = {:?}"</span><span class="token punctuation">,</span> sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">mod</span> <span class="token module-declaration namespace">async_std_demo</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">async_std_demo<span class="token punctuation">::</span></span><span class="token punctuation">{</span>concurrent<span class="token punctuation">,</span> parallel_threads<span class="token punctuation">,</span> parallel_tasks<span class="token punctuation">,</span> serial<span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token attribute attr-name">#[async_std::main]</span><br><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Error</span><span class="token operator">>></span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> <span class="token punctuation">(</span>sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">serial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"serial: sum1 = {:?}, sum2 = {:?}"</span><span class="token punctuation">,</span> sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">//let (sum1, sum2) = concurrent()?;</span><br>    <span class="token keyword">let</span> <span class="token punctuation">(</span>sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">concurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"concurrent: sum1 = {:?}, sum2 = {:?}"</span><span class="token punctuation">,</span> sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">//let (sum1, sum2) = parallel_threads()?;</span><br>    <span class="token keyword">let</span> <span class="token punctuation">(</span>sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">parallel_threads</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"threads: sum1 = {:?}, sum2 = {:?}"</span><span class="token punctuation">,</span> sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">//let (sum1, sum2) = parallel_tasks()?;</span><br>    <span class="token keyword">let</span> <span class="token punctuation">(</span>sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">parallel_tasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"tasks: sum1 = {:?}, sum2 = {:?}"</span><span class="token punctuation">,</span> sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">mod</span> <span class="token module-declaration namespace">tokio_demo</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">tokio_demo<span class="token punctuation">::</span></span><span class="token punctuation">{</span>concurrent<span class="token punctuation">,</span> parallel_tasks<span class="token punctuation">,</span> parallel_threads<span class="token punctuation">,</span> serial<span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token attribute attr-name">#[tokio::main]</span><br><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Error</span><span class="token operator">>></span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> <span class="token punctuation">(</span>sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">serial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"serial: sum1 = {:?}, sum2 = {:?}"</span><span class="token punctuation">,</span> sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> <span class="token punctuation">(</span>sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">concurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"concurrent: sum1 = {:?}, sum2 = {:?}"</span><span class="token punctuation">,</span> sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> <span class="token punctuation">(</span>sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">parallel_threads</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"threads: sum1 = {:?}, sum2 = {:?}"</span><span class="token punctuation">,</span> sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> <span class="token punctuation">(</span>sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">parallel_tasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"tasks: sum1 = {:?}, sum2 = {:?}"</span><span class="token punctuation">,</span> sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre><p>TODO: See other mpsc implementations that are in futures::sync::mpsc TODO: :and tokio::sync::mpsc, but not in async-std!</p><p>In addition, &quot;channels&quot; can be used to enable threads to communicate during their execution rather than waiting to get a result when they complete.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">rand<span class="token punctuation">::</span></span><span class="token class-name">Rng</span><span class="token punctuation">;</span> <span class="token comment">// stands for "random number generator".</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span>mpsc<span class="token punctuation">;</span> <span class="token comment">// stands for "multiple producer, single consumer"</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>thread<span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> <span class="token punctuation">(</span>tx<span class="token punctuation">,</span> rx<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">mpsc<span class="token punctuation">::</span></span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">const</span> <span class="token class-name">N</span><span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Start N threads and collect their handles.</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> handles <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> rng <span class="token operator">=</span> <span class="token namespace">rand<span class="token punctuation">::</span></span><span class="token function">thread_rng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token class-name">N</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> ms <span class="token operator">=</span> rng<span class="token punctuation">.</span><span class="token function">gen_range</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">..</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token comment">// The "move" keyword below is necessary for</span><br>        <span class="token comment">// the closure to take ownership of i and ms.</span><br>        <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token namespace">mpsc<span class="token punctuation">::</span></span><span class="token class-name">Sender</span><span class="token punctuation">::</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tx<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        handles<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><br>            <span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">u64</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token namespace">mpsc<span class="token punctuation">::</span></span><span class="token class-name">SendError</span><span class="token operator">&lt;</span>_<span class="token operator">>></span> <span class="token punctuation">{</span><br>                <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"thread {} started"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span><br>                <span class="token comment">// Generate a random number of milliseconds to sleep.</span><br>                <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_millis</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>                <span class="token keyword">let</span> msg <span class="token operator">=</span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"tx from thread {}!"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span><br>                tx<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>                <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"thread {} finished"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span><br>                <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> ms<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// tuple of thread number and milliseconds slept</span><br>            <span class="token punctuation">}</span><span class="token punctuation">,</span><br>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token comment">// Need to drop the original sender (tx) so the receiver (rx) so</span><br>    <span class="token comment">// the loop below can exit after the last tx clone goes out of scope.</span><br>    <span class="token function">drop</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Listen for channel messages in a different thread.</span><br>    <span class="token comment">// This is a good way to enable processing the results from each thread</span><br>    <span class="token comment">// in the order in which they complete</span><br>    <span class="token comment">// rather than the order in which they were started.</span><br>    <span class="token keyword">for</span> msg <span class="token keyword">in</span> rx <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"received {}"</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// Wait for all the threads to finish.</span><br>    <span class="token comment">// Results will be processed in the order the threads were created,</span><br>    <span class="token comment">// not in the order in which the threads complete.</span><br>    <span class="token keyword">for</span> handle <span class="token keyword">in</span> handles <span class="token punctuation">{</span><br>        <span class="token keyword">match</span> handle<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token class-name">Ok</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"result = {:?}"</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">eprintln!</span><span class="token punctuation">(</span><span class="token string">"error: {:?}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"done"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>Here is an example that scrapes web sites listed in a file. It reports the number of <code>img</code> tags found at each site. First it does this with a single thread and then spawning a separate tasks for each site to enable using multiple threads. The elapsed time for each approach is output to show the speed benefit of using multiple threads.</p><p>The code can be found at <a href="https://github.com/mvolkmann/rust-web-scrape?v=1.1.1" rel="noopener" target="_blank">rust-web-scrape</a>. With 19 web sites listed in <code>web-sites.txt</code> and running on a 2019 MacBook Pro laptop with 32GB of memory, the single-threaded approach took 16.18 seconds and the multi-threaded approach took 707 milliseconds.</p><p>Note that spawning more threads than there are processor cores is not an issue for a reasonable number of threads, 19 in this case. But spawning thousands of concurrent threads will consume a large amount of memory. In that case spawning &quot;tasks&quot;, such as those supported by async-std and tokio is preferred.</p><p>Here are the dependencies added in <code>Cargo.toml</code>:</p><pre class="language-toml"><code class="language-toml"><span class="token key property">futures</span> <span class="token punctuation">=</span> <span class="token string">"0.3.12"</span><br><span class="token key property">reqwest</span> <span class="token punctuation">=</span> <span class="token string">"0.11.0"</span><br><span class="token key property">tokio</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"1.2.0"</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"full"</span><span class="token punctuation">,</span> <span class="token string">"rt"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span></code></pre><p>Here is the <code>src/main.js</code> file:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">reqwest</span><span class="token punctuation">;</span><br><span class="token comment">// We cannot use async-std in place of tokio because reqwest depends on tokio.</span><br><span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">tokio</span><span class="token punctuation">;</span><br><br><span class="token keyword">use</span> <span class="token namespace">reqwest<span class="token punctuation">::</span>header<span class="token punctuation">::</span></span><span class="token constant">USER_AGENT</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>boxed<span class="token punctuation">::</span></span><span class="token class-name">Box</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">BufRead</span><span class="token punctuation">,</span> <span class="token class-name">BufReader</span><span class="token punctuation">,</span> <span class="token class-name">Lines</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">Instant</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">tokio<span class="token punctuation">::</span></span>task<span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">tokio<span class="token punctuation">::</span>task<span class="token punctuation">::</span></span><span class="token class-name">JoinHandle</span><span class="token punctuation">;</span><br><br><span class="token comment">// We need to set the user agent because some sites return 403 Forbidden</span><br><span class="token comment">// for requests that do not seem to be coming from a web browser.</span><br><span class="token keyword">const</span> <span class="token constant">UA</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token operator">=</span> <span class="token string">"Mozilla/5.0"</span><span class="token punctuation">;</span> <span class="token comment">// This is enough.</span><br><br><span class="token keyword">type</span> <span class="token type-definition class-name">FileLines</span> <span class="token operator">=</span> <span class="token class-name">Lines</span><span class="token operator">&lt;</span><span class="token class-name">BufReader</span><span class="token operator">&lt;</span><span class="token class-name">File</span><span class="token operator">>></span><span class="token punctuation">;</span><br><br><span class="token keyword">type</span> <span class="token type-definition class-name">GenericError</span> <span class="token operator">=</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token namespace">std<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Error</span> <span class="token operator">+</span> <span class="token class-name">Send</span> <span class="token operator">+</span> <span class="token class-name">Sync</span><span class="token operator">></span><span class="token punctuation">;</span><br><span class="token keyword">type</span> <span class="token type-definition class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>result<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">GenericError</span><span class="token operator">></span><span class="token punctuation">;</span><br><br><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">get_sites</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">FileLines</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token string">"./web-sites.txt"</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> reader <span class="token operator">=</span> <span class="token class-name">BufReader</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token class-name">Ok</span><span class="token punctuation">(</span>reader<span class="token punctuation">.</span><span class="token function">lines</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">process_site</span><span class="token punctuation">(</span>url<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token comment">// If commented ...</span><br>    <span class="token keyword">if</span> url<span class="token punctuation">.</span><span class="token function">starts_with</span><span class="token punctuation">(</span><span class="token string">"#"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">let</span> client <span class="token operator">=</span> <span class="token namespace">reqwest<span class="token punctuation">::</span></span><span class="token class-name">Client</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> res <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token constant">USER_AGENT</span><span class="token punctuation">,</span> <span class="token constant">UA</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> html <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token comment">//dbg!(&amp;html);</span><br>    <span class="token keyword">let</span> images<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token operator">></span> <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">"&lt;img "</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{} has {} img tags"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> images<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token attribute attr-name">#[tokio::main]</span> <span class="token comment">// starts the Tokio runtime</span><br><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token comment">// Single threaded ...</span><br>    <span class="token keyword">let</span> sites <span class="token operator">=</span> <span class="token function">get_sites</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token class-name">Instant</span><span class="token punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">for</span> site <span class="token keyword">in</span> sites <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token operator">=</span> site <span class="token punctuation">{</span><br>            <span class="token function">process_site</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"single-threaded time: {:?}\n"</span><span class="token punctuation">,</span> start<span class="token punctuation">.</span><span class="token function">elapsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Multi-threaded ...</span><br>    <span class="token keyword">let</span> sites <span class="token operator">=</span> <span class="token function">get_sites</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token class-name">Instant</span><span class="token punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> handles<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">JoinHandle</span><span class="token operator">&lt;</span><span class="token class-name">MyResult</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">for</span> site <span class="token keyword">in</span> sites <span class="token punctuation">{</span><br>        <span class="token comment">//handles.push(thread::spawn(|| async move {</span><br>        handles<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token namespace">task<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">{</span><br>            <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token operator">=</span> site <span class="token punctuation">{</span><br>                <span class="token function">process_site</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br>            <span class="token punctuation">}</span><br>            <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">for</span> handle <span class="token keyword">in</span> handles <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span> handle<span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span> <span class="token punctuation">{</span><br>            <span class="token macro property">eprintln!</span><span class="token punctuation">(</span><span class="token string">"error: {}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"multi-threaded time: {:?}"</span><span class="token punctuation">,</span> start<span class="token punctuation">.</span><span class="token function">elapsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre><p><a href="https://github.com/rayon-rs/rayon?v=1.1.1" rel="noopener" target="_blank">rayon</a> is a Rust &quot;data parallelism library&quot;. It supports the parallel iterator methods <code>par_iter</code> and <code>par_iter_mut</code>. It also supports parallel sorting of slices and vectors.j The following example shows how rayon can be used to process of all the items in a vector using multiple threads. It uses the <code>rand</code> crate to generate random numbers.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">rand<span class="token punctuation">::</span></span><span class="token class-name">Rng</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">rayon<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">Instant</span><span class="token punctuation">;</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Generate a vector of random numbers.</span><br>    <span class="token keyword">const</span> <span class="token class-name">N</span><span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">1_000_000_000</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> numbers <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// rng stands for "random number generator".</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> rng <span class="token operator">=</span> <span class="token namespace">rand<span class="token punctuation">::</span></span><span class="token function">thread_rng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">for</span> _i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token class-name">N</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> n <span class="token operator">=</span> rng<span class="token punctuation">.</span><span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// number from 0 inclusive to 1 exclusive</span><br>        numbers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// The times given here are from a 2019 MacBook Pro laptop</span><br>    <span class="token comment">// with 32GB of memory and 8 cores.</span><br>    <span class="token comment">// Multiplying all the numbers by two took 2.617 seconds using one thread.</span><br>    <span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token class-name">Instant</span><span class="token punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    numbers<span class="token punctuation">.</span><span class="token function">iter_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">for_each</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>p<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">f64</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token operator">*</span>p <span class="token operator">*=</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"elapsed time: {:?}"</span><span class="token punctuation">,</span> start<span class="token punctuation">.</span><span class="token function">elapsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Using multiple threads took only 554ms.</span><br>    <span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token class-name">Instant</span><span class="token punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    numbers<span class="token punctuation">.</span><span class="token function">par_iter_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">for_each</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>p<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">f64</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token operator">*</span>p <span class="token operator">*=</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"elapsed time: {:?}"</span><span class="token punctuation">,</span> start<span class="token punctuation">.</span><span class="token function">elapsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>It is often necessary to coordinate access to data that is shared between threads. Common ways to do this include using a <code>Mutex</code> or <code>RwLock</code>. There are multiple implementations available for each of these. Consider using those in <code>std::sync</code> and the <code>parking_lot</code> crate.</p><p>The <code>parking_lot</code> versions of <code>Mutex</code> and <code>RwLock</code> are generally preferred over the <code>std::sync</code> versions for reasons described at <a href="https://docs.rs/parking_lot/0.11.1/parking_lot/type.Mutex.html?v=1.1.1" rel="noopener" target="_blank">parking_lot::Mutex</a> and <a href="https://docs.rs/parking_lot/0.11.1/parking_lot/type.RwLock.html?v=1.1.1" rel="noopener" target="_blank">parking_lot::RwLock</a>.:w The reasons include better poison handling, less memory usage, better fairness of lock sharing, and better performance.</p><p>To gain exclusive access to a value wrapped in a <code>Mutex</code>, call its <code>lock</code> method. The lock is automatically released when the value returned by this method goes out of scope.</p><p>To gain non-exclusive read access to a value wrapped in a <code>RwLock</code>, call its <code>read</code> method. There can be any number of concurrent readers. To gain exclusive write access to a value wrapped in a <code>RwLock</code>, call its <code>write</code> method. This will block until there are no other readers or writers. Like with a <code>Mutex</code>, the lock is automatically released when the value returned by the <code>read</code> or <code>write</code> method goes out of scope.</p><p>A mutex is &quot;poisoned&quot; when a thread that holds the lock panics. This causes attempts to acquire the lock in other threads to fail, The <code>lock</code> method returns a <code>LockResult</code> which enables callers to detect this situation.</p><p>A <code>RwLock</code> is poisoned when a thread that holds a write lock (not a read lock) panics. This causes attempts to acquire the lock in other threads to fail, The <code>read</code> and <code>write</code> methods returns a <code>LockResult</code> which enables callers to detect this situation.</p><h2 id="futures-and-async%2Fawait" tabindex="-1">Futures and async/await</h2><p><code>Future</code> is a trait that enables defining code to be executed in the future. While it can be used directly, typically the keywords <code>async</code> and <code>await</code> are used to provide syntactic sugar that simplifies the code.</p><p>The keyword <code>async</code> is added to the beginning of function definitions or blocks. It changes the function to be non-blocking and return an instance that implements the <code>Future</code> trait.</p><p>All <code>async</code> functions return a <code>Future</code> even though they do not explicitly specify that in their return type.</p><p>It is not possible to manually write normal Rust code that is the equivalent of the code produced by the <code>async</code> and <code>await</code> keywords. The Rust compiler performs some magic to support these.</p><p>From user &quot;kornel&quot; in the Rust Forum February 3, 2020,</p><blockquote><p><code>async</code> can create <code>Future</code> objects that are self-referential structs, and this is the only place in safe Rust where this is allowed. It ends up being a state machine that uses unsafe pointers. It's not a straightforward translation, and there's no equivalent high-level syntax. That unique complexity is the reason why <code>.await</code> is a built-in syntax. Otherwise it would be a crate with a proc_macro.</p></blockquote><p>For example, add the following dependencies in <code>Cargo.toml</code>:</p><pre class="language-toml"><code class="language-toml"><span class="token key property">async-std</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span><span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"1.9.0"</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"attributes"</span><span class="token punctuation">]</span><span class="token punctuation">}</span><br><span class="token key property">futures</span> <span class="token punctuation">=</span> <span class="token string">"0.3.12"</span></code></pre><p>Using <code>async</code> requires a futures executor like those provided by the external crates async-std and tokio. While you could write your own executor or write low-level routines that return futures and wake them after some hardware event, in practice typically async-std or tokio is used.</p><p>Add the following in <code>src/main.rs</code>:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">async_std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">File</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">async_std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">BufReader</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">async_std<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span><br><br><span class="token comment">// The return type, in this case a Result, is wrapped in a Future.</span><br><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">sum_file</span><span class="token punctuation">(</span>file_path<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">f64</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> reader <span class="token operator">=</span> <span class="token class-name">BufReader</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> sum <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span><br>    <span class="token comment">//for line in reader.lines() { // can use this with std::io::BufReader</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> stream <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">lines</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">while</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token class-name">Ok</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span> <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">f64</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"n = {}"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span><br>            sum <span class="token operator">+=</span> n<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>    <span class="token class-name">Ok</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token attribute attr-name">#[async_std::main]</span><br><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">match</span> <span class="token function">sum_file</span><span class="token punctuation">(</span><span class="token string">"./numbers.txt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span> <span class="token punctuation">{</span><br>        <span class="token class-name">Ok</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"sum = {}"</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">eprintln!</span><span class="token punctuation">(</span><span class="token string">"error = {}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p><code>Future</code>s are lazy meaning they are not executed until the <code>await</code> keyword is applied to them. The <code>await</code> keyword triggers execution of the future, waits for it to complete, and yields control back to the thread so it has the opportunity to do other work while waiting. The <code>.await</code> syntax is often placed at the end of a function call with a dot (period) before it. This makes it appear that <code>await</code> is a property, but it is actually a keyword. For example: <code>some_future.await;</code>.</p><p>The <code>await</code> keyword can only be used in <code>async</code> functions or <code>async</code> blocks. An async block has the syntax <code>async { ... }</code>. The <code>move</code> keyword can be added to move ownership of variables defined outside the block that are used in the block into it. For example, <code>async move { ... }</code>.</p><p>An &quot;executor&quot; is required in order to evaluate <code>Future</code>s. The most common way to add an executor is to include the attribute <code>#[async_std::main]</code> or <code>#[tokio::main]</code> before <code>async fn main</code>. These are macros that transform the <code>async fn main()</code> into a synchronous <code>fn main()</code> that initializes a runtime instance and executes the code in the function.</p><p>From the tokio tutorial, the following:</p><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[tokio::main]</span><br><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>is transformed into:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> rt <span class="token operator">=</span> <span class="token namespace">tokio<span class="token punctuation">::</span>runtime<span class="token punctuation">::</span></span><span class="token class-name">Runtime</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    rt<span class="token punctuation">.</span><span class="token function">block_on</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre><p>Crates like async-std and tokio support &quot;tasks&quot; which are like lightweight threads that are scheduled to run in read threads. A task can be thought of as a collection of futures.</p><h2 id="async-std" tabindex="-1">async-std</h2><p>The <code>async-std</code> crate is a port of the <code>std</code> crate that provides provides asynchronous alternatives to some its functionality . Programs that wish to use it can replace references to the <code>std</code> namespace with <code>async_std</code>. It utilizes the <code>async</code> and <code>await</code> keywords. Form the official documentation, &quot;blocking functions have been replaced with async functions and threads have been replaced with lightweight tasks.&quot;</p><p>Prefer using the tokio runtime instead of async-std because it is very mature and supports more features. These cannot be mixed, so you must choose one.</p><p>To use this runtime, add <code>async-std</code> as a dependency in <code>Cargo.toml</code></p><pre class="language-toml"><code class="language-toml"><span class="token key property">async-std</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"1.9.0"</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"attributes"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span></code></pre><p>Then add the following attribute before the <code>main</code> function:</p><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[async_std::main]</span></code></pre><h2 id="tokio" tabindex="-1">Tokio</h2><p><a href="https://crates.io/crates/tokio?v=1.1.1" rel="noopener" target="_blank">tokio</a> is a popular crate that makes implementing asynchronous code even easier. It was initially created by Carl Lerche and is supported by many contributors including Alex Crichton, Ivan Petkov, Alice Rhyl, Taiki Endo, Eliza Weisman, Lucio Franco, Sean McArthur, and more.</p><p>Features supported by Tokio include:</p><ul><li>TCP, UDP, Unix sockets, and pipes</li><li>timers</li><li>spawning threads</li><li>communication between threads using channels</li><li>mutex and semaphore</li><li>subprocesses</li><li>signal handlers</li><li>streams</li><li>sync utilities</li><li>work-stealing task scheduling</li><li>and more</li></ul><p>From the Tokio tutorial:</p><blockquote><p>Many of Tokio's types are named the same as their synchronous equivalent in the Rust standard library. When it makes sense, Tokio exposes the same APIs as <code>std</code> but using <code>async fn</code>.</p></blockquote><p>Here is a very basic example of using <code>tokio</code>. It assumes the following dependency line has been added in the <code>Cargo.toml</code> file.</p><pre class="language-toml"><code class="language-toml"><span class="token key property">tokio</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"1.1.1"</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"full"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span></code></pre><p>Tokio supports a large number of features. The resulting binary size for a program can be reduced by including only the features being used instead of &quot;full&quot;.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">tokio<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token punctuation">{</span>sleep<span class="token punctuation">,</span> <span class="token class-name">Sleep</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">sleep_ms</span><span class="token punctuation">(</span>ms<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Sleep</span> <span class="token punctuation">{</span><br>    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_millis</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token attribute attr-name">#[tokio::main]</span><br><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">//sleep(Duration::from_millis(1000)).await;</span><br>    <span class="token function">sleep_ms</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"World"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>The following example spawns 10 tasks that each sleep for a random amount of time and then return some data. The results are processed in the order in which the tasks complete.</p><p>TODO: Add code from <a href="https://github.com/mvolkmann/rust-tokio">https://github.com/mvolkmann/rust-tokio</a>.</p><p>TODO: Add information from <a href="https://github.com/mvolkmann/rust-parallel-options">https://github.com/mvolkmann/rust-parallel-options</a>.</p><h2 id="standard-library" tabindex="-1">Standard Library</h2><p>The <a href="https://doc.rust-lang.org/std/index.html?v=1.1.1" rel="noopener" target="_blank">Rust Standard Library</a> is relatively small. Often commonly needed functionality is instead found in the collection of crates at <a href="https://crates.io/?v=1.1.1" rel="noopener" target="_blank">crates.io</a>.</p><h2 id="databases" tabindex="-1">Databases</h2><p>Rust can access many kinds of databases including PostgreSQL, MySQL, SQLite, and MongoDB. This is supported by several crates including:</p><ul><li><a href="https://crates.io/crates/diesel?v=1.1.1" rel="noopener" target="_blank">diesel</a></li><li><a href="https://crates.io/crates/postgres?v=1.1.1" rel="noopener" target="_blank">postgres</a></li><li><a href="https://crates.io/crates/mongodb?v=1.1.1" rel="noopener" target="_blank">mongodb</a></li><li><a href="https://crates.io/crates/mysql?v=1.1.1" rel="noopener" target="_blank">mysql</a></li><li><a href="https://crates.io/crates/rusqlite?v=1.1.1" rel="noopener" target="_blank">rusqlite</a></li></ul><p>Here is an example of using the <code>postgres</code> crate:</p><ol><li><p>Start the PostgreSQL server by entering <code>pg_ctl -D /usr/local/pgsql/data -l logfile start</code></p></li><li><p>Create the &quot;animals&quot; database by entering <code>createdb animals</code>.</p></li><li><p>Create the file <code>db.ddl</code> containing the following:</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> dogs <span class="token punctuation">(</span><br>  id <span class="token keyword">serial</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span><br>  breed <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span><br>  name <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span><br><span class="token punctuation">)</span></code></pre></li><li><p>Create the &quot;dogs&quot; table by entering <code>psql -d animals -f db.ddl</code></p></li><li><p>Create a new Rust project by entering <code>cargo new postgres-demo</code></p></li><li><p>Enter <code>cd postgres-demo</code></p></li><li><p>Edit <code>Cargo.toml</code> and add the dependency <code>postgres = &quot;0.19.0&quot;</code>.</p></li><li><p>Edit <code>src/main.rs</code> to contain the following:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">postgres<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Client</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token punctuation">,</span> <span class="token class-name">NoTls</span><span class="token punctuation">,</span> <span class="token class-name">Row</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">insert_dog</span><span class="token punctuation">(</span>client<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Client</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> breed<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Row</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    client<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><br>        <span class="token string">"insert into dogs (name, breed) VALUES ($1, $2) returning id"</span><span class="token punctuation">,</span><br>        <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token operator">&amp;</span>breed<span class="token punctuation">]</span><span class="token punctuation">,</span><br>    <span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">insert_dogs</span><span class="token punctuation">(</span>client<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Client</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">u64</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> dogs <span class="token operator">=</span> <span class="token punctuation">[</span><br>        <span class="token punctuation">(</span><span class="token string">"Maisey"</span><span class="token punctuation">,</span> <span class="token string">"Treeing Walker Coonhound"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token punctuation">(</span><span class="token string">"Ramsay"</span><span class="token punctuation">,</span> <span class="token string">"Native American Indian Dog"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token punctuation">(</span><span class="token string">"Comet"</span><span class="token punctuation">,</span> <span class="token string">"Whippet"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token keyword">for</span> dog <span class="token keyword">in</span> <span class="token operator">&amp;</span>dogs <span class="token punctuation">{</span><br>        <span class="token function">insert_dog</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> dog<span class="token number">.0</span><span class="token punctuation">,</span> dog<span class="token number">.1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token class-name">Ok</span><span class="token punctuation">(</span>dogs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">u64</span><span class="token punctuation">)</span> <span class="token comment">// # of inserted rows</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">delete_dogs</span><span class="token punctuation">(</span>client<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Client</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">u64</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    client<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">"delete from dogs"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">update_dog</span><span class="token punctuation">(</span>client<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Client</span><span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">u64</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    client<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">"update dogs set name = $2 where id = $1"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span>id<span class="token punctuation">,</span> <span class="token operator">&amp;</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">report_dogs</span><span class="token punctuation">(</span>client<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Client</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>rows<span class="token punctuation">)</span> <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"select id, name, breed from dogs"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">for</span> row <span class="token keyword">in</span> rows <span class="token punctuation">{</span><br>            <span class="token keyword">let</span> id<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> row<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token keyword">let</span> name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token operator">=</span> row<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token keyword">let</span> breed<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token operator">=</span> row<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"id={} name={} breed={}"</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> breed<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> username <span class="token operator">=</span> <span class="token string">"mark"</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> password <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> database <span class="token operator">=</span> <span class="token string">"animals"</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> conn_str <span class="token operator">=</span> <span class="token macro property">format!</span><span class="token punctuation">(</span><br>        <span class="token string">"postgresql://{}:{}@localhost/{}"</span><span class="token punctuation">,</span><br>        username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> database<br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> client <span class="token operator">=</span> <span class="token class-name">Client</span><span class="token punctuation">::</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>conn_str<span class="token punctuation">,</span> <span class="token class-name">NoTls</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token function">delete_dogs</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> client<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">insert_dogs</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> client<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> rows <span class="token operator">=</span> <span class="token function">insert_dog</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> client<span class="token punctuation">,</span> <span class="token string">"Oscar"</span><span class="token punctuation">,</span> <span class="token string">"German Shorthaired Pointer"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> row <span class="token operator">=</span> rows<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">></span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">=</span> row<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token function">update_dog</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> client<span class="token punctuation">,</span> id<span class="token punctuation">,</span> <span class="token string">"Oscar Wilde"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token function">report_dogs</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> client<span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Enter <code>cargo run</code></p></li></ol><p>Here is an example of using the <code>diesel</code> crate to access the same PostgreSQL database: This code can also be found at <a href="https://github.com/mvolkmann/rust-diesel-demo?v=1.1.1" rel="noopener" target="_blank">rust-diesel-demo</a>.</p><ol><li><p>Enter <code>cargo new diesel_demo</code></p></li><li><p>Enter <code>cd diesel_demo</code></p></li><li><p>Add these dependencies in <code>Cargo.toml</code>:</p><pre class="language-toml"><code class="language-toml"><span class="token key property">diesel</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"1.4.5"</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"postgres"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><br><span class="token key property">dotenv</span> <span class="token punctuation">=</span> <span class="token string">"0.15.0"</span></code></pre></li><li><p>Enter <code>cargo install diesel_cli</code></p></li><li><p>Create the file <code>.env</code> that sets the environment variable <code>DATABASE_URL</code> to the proper connection string with the syntax <code>postgresql://{username}:{password}@localhost/{database}</code>. For example:</p><pre class="language-bash"><code class="language-bash"><span class="token assign-left variable">DATABASE_URL</span><span class="token operator">=</span>postgresql://mark:@localhost/animals</code></pre></li><li><p>Enter <code>diesel setup</code></p></li><li><p>Enter <code>diesel migration generate dogs</code></p></li><li><p>Edit <code>migrations/dogs/up.sql</code> to contain:</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> dogs <span class="token punctuation">(</span><br>  id <span class="token keyword">serial</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span><br>  breed <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span><br>  name <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span><br><span class="token punctuation">)</span></code></pre></li><li><p>Edit <code>migrations/dogs/down.sql</code> to contain the following:</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">drop</span> <span class="token keyword">table</span> dogs</code></pre></li><li><p>Enter <code>diesel migration run</code>. Later, to drop the <code>dogs</code> table and recreate it enter <code>diesel migration redo</code>.</p></li><li><p>Edit <code>src/models.rs</code> to contain the following:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>schema<span class="token punctuation">::</span></span>dogs<span class="token punctuation">;</span><br><br><span class="token comment">// The order of the fields in these structs must match</span><br><span class="token comment">// the order of the columns in the corresponding table.</span><br><span class="token comment">//</span><br><span class="token comment">// Implementing the "Identifiable" trait means the struct</span><br><span class="token comment">// represents a single row in a database table and, by default,</span><br><span class="token comment">// has an "id" field that is its primary key.</span><br><span class="token comment">//</span><br><span class="token comment">// The associated table name defaults to the lowercase version</span><br><span class="token comment">// of the struct name with an "s" on the end.</span><br><span class="token comment">// If this is not the table name, specify the "table_name" attribute</span><br><span class="token comment">// as shown above the "NewDog" struct that follows.</span><br><span class="token attribute attr-name">#[derive(AsChangeset, Identifiable, Queryable)]</span><br><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Dog</span> <span class="token punctuation">{</span><br>    <span class="token keyword">pub</span> id<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span><br>    <span class="token keyword">pub</span> breed<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>    <span class="token keyword">pub</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token attribute attr-name">#[table_name = <span class="token string">"dogs"</span>]</span><br><span class="token attribute attr-name">#[derive(Insertable)]</span><br><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">NewDog</span> <span class="token punctuation">{</span><br>    <span class="token keyword">pub</span> breed<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>    <span class="token keyword">pub</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span></code></pre></li><li><p>Edit <code>src/main.rs</code> to contain the following:</p><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[macro_use]</span><br><span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">diesel</span><span class="token punctuation">;</span><br><br><span class="token keyword">mod</span> <span class="token module-declaration namespace">models</span><span class="token punctuation">;</span><br><span class="token keyword">mod</span> <span class="token module-declaration namespace">schema</span><span class="token punctuation">;</span><br><br><span class="token keyword">use</span> <span class="token namespace">diesel<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">diesel<span class="token punctuation">::</span>result<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">models<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span><br><br><span class="token comment">// Deletes all rows from the dogs table.</span><br><span class="token keyword">fn</span> <span class="token function-definition function">delete_dogs</span><span class="token punctuation">(</span>conn<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">PgConnection</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">usize</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token namespace">diesel<span class="token punctuation">::</span></span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token namespace">schema<span class="token punctuation">::</span>dogs<span class="token punctuation">::</span></span>table<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Gets a connection to the "animals" database that contains a "dogs" table.</span><br><span class="token keyword">fn</span> <span class="token function-definition function">get_connection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">ConnectionResult</span><span class="token operator">&lt;</span><span class="token class-name">PgConnection</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token keyword">use</span> <span class="token namespace">dotenv<span class="token punctuation">::</span></span>dotenv<span class="token punctuation">;</span><br>    <span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>env<span class="token punctuation">;</span><br>    <span class="token function">dotenv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token namespace">env<span class="token punctuation">::</span></span><span class="token function">var</span><span class="token punctuation">(</span><span class="token string">"DATABASE_URL"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"DATABASE_URL must be set"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token class-name">PgConnection</span><span class="token punctuation">::</span><span class="token function">establish</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>url<span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Inserts a row in the "dogs" table and returns its id.</span><br><span class="token keyword">fn</span> <span class="token function-definition function">insert_dog</span><span class="token punctuation">(</span>conn<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">PgConnection</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> breed<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> dog <span class="token operator">=</span> <span class="token class-name">NewDog</span> <span class="token punctuation">{</span><br>        name<span class="token punctuation">:</span> name<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        breed<span class="token punctuation">:</span> breed<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> id<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token namespace">diesel<span class="token punctuation">::</span></span><span class="token function">insert_into</span><span class="token punctuation">(</span><span class="token namespace">schema<span class="token punctuation">::</span>dogs<span class="token punctuation">::</span></span>table<span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>dog<span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">returning</span><span class="token punctuation">(</span><span class="token namespace">schema<span class="token punctuation">::</span>dogs<span class="token punctuation">::</span></span>id<span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">get_result</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token class-name">Ok</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Outputs information about each row in the "dogs" table.</span><br><span class="token keyword">fn</span> <span class="token function-definition function">report_dogs</span><span class="token punctuation">(</span>conn<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">PgConnection</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> results <span class="token operator">=</span> <span class="token namespace">schema<span class="token punctuation">::</span>dogs<span class="token punctuation">::</span>dsl<span class="token punctuation">::</span></span>dogs<br>        <span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Dog</span><span class="token operator">></span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"error loading dogs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">for</span> dog <span class="token keyword">in</span> results <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{} is a {} (id {})."</span><span class="token punctuation">,</span> dog<span class="token punctuation">.</span>name<span class="token punctuation">,</span> dog<span class="token punctuation">.</span>breed<span class="token punctuation">,</span> dog<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Updates the "dogs" table row with a given id.</span><br><span class="token keyword">fn</span> <span class="token function-definition function">update_dog</span><span class="token punctuation">(</span>conn<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">PgConnection</span><span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> breed<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">usize</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> dog <span class="token operator">=</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span><br>        id<span class="token punctuation">,</span><br>        name<span class="token punctuation">:</span> name<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        breed<span class="token punctuation">:</span> breed<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token namespace">diesel<span class="token punctuation">::</span></span><span class="token function">update</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>dog<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>dog<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Updates the name of a dog with a given id in the "dogs" table.</span><br><span class="token keyword">fn</span> <span class="token function-definition function">update_name</span><span class="token punctuation">(</span>conn<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">PgConnection</span><span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">usize</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> dog <span class="token operator">=</span> <span class="token namespace">schema<span class="token punctuation">::</span>dogs<span class="token punctuation">::</span>dsl<span class="token punctuation">::</span></span>dogs<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token namespace">schema<span class="token punctuation">::</span>dogs<span class="token punctuation">::</span></span>id<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token namespace">diesel<span class="token punctuation">::</span></span><span class="token function">update</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span><br>        <span class="token comment">// can also pass a tuple of column changes</span><br>        <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token namespace">schema<span class="token punctuation">::</span>dogs<span class="token punctuation">::</span></span>name<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token operator">=</span> result <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> count <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span><br>            <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">Error</span><span class="token punctuation">::</span><span class="token class-name">NotFound</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>    result<br><span class="token punctuation">}</span><br><br><span class="token comment">// The return type specified here allows using "?" for error handling</span><br><span class="token comment">// regardless of the specific kinds of errors that occur.</span><br><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token namespace">std<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">>></span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> conn <span class="token operator">=</span> <span class="token function">get_connection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br><br>    <span class="token function">delete_dogs</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>conn<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> dogs <span class="token operator">=</span> <span class="token punctuation">[</span><br>        <span class="token punctuation">(</span><span class="token string">"Maisey"</span><span class="token punctuation">,</span> <span class="token string">"Treeing Walker Coonhound"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token punctuation">(</span><span class="token string">"Ramsay"</span><span class="token punctuation">,</span> <span class="token string">"Native American Indian Dog"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        <span class="token punctuation">(</span><span class="token string">"Comet"</span><span class="token punctuation">,</span> <span class="token string">"Whippet"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token keyword">for</span> dog <span class="token keyword">in</span> <span class="token operator">&amp;</span>dogs <span class="token punctuation">{</span><br>        <span class="token function">insert_dog</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>conn<span class="token punctuation">,</span> dog<span class="token number">.0</span><span class="token punctuation">,</span> dog<span class="token number">.1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token function">insert_dog</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>conn<span class="token punctuation">,</span> <span class="token string">"Oscar"</span><span class="token punctuation">,</span> <span class="token string">"German Shorthaired Pointer"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br><br>    <span class="token comment">//update_dog(&amp;conn, id, "Oscar Wilde", "German Shorthaired Pointer")?;</span><br>    <span class="token function">update_name</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>conn<span class="token punctuation">,</span> id<span class="token punctuation">,</span> <span class="token string">"Oscar Wilde"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br><br>    <span class="token function">report_dogs</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre></li></ol><p>Here is an example of using the <code>mongodb</code> crate:</p><ol><li><p>Edit <code>Cargo.toml</code> to include these dependencies:</p><pre class="language-toml"><code class="language-toml"><span class="token key property">futures</span> <span class="token punctuation">=</span> <span class="token string">"0.3.12"</span><br><span class="token key property">mongodb</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"1.1.1"</span><span class="token punctuation">,</span> <span class="token key property">default-features</span> <span class="token punctuation">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"tokio-runtime"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><br><span class="token key property">tokio</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"1.1.1"</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"full"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span></code></pre></li><li><p>Add the following in <code>src/main.rs</code>:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">futures<span class="token punctuation">::</span>stream<span class="token punctuation">::</span></span><span class="token class-name">StreamExt</span><span class="token punctuation">;</span> <span class="token comment">// needed to call "next" method on cursor</span><br><span class="token keyword">use</span> <span class="token namespace">mongodb<span class="token punctuation">::</span>bson<span class="token punctuation">::</span></span><span class="token punctuation">{</span>doc<span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">mongodb<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">mongodb<span class="token punctuation">::</span></span><span class="token class-name">Client</span><span class="token punctuation">;</span><br><br><span class="token attribute attr-name">#[tokio::main]</span><br><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> uri <span class="token operator">=</span> <span class="token string">"mongodb://127.0.0.1:27017"</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> client <span class="token operator">=</span> <span class="token class-name">Client</span><span class="token punctuation">::</span><span class="token function">with_uri_str</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Databases:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">for</span> name <span class="token keyword">in</span> client<span class="token punctuation">.</span><span class="token function">list_database_names</span><span class="token punctuation">(</span><span class="token class-name">None</span><span class="token punctuation">,</span> <span class="token class-name">None</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span> <span class="token punctuation">{</span><br>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"- {}"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">let</span> db <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token string">"animals"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> coll <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">"dogs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">//coll.delete_many(None, None).await?; // does not work</span><br>    coll<span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span><span class="token class-name">None</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> documents <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><br>        <span class="token macro property">doc!</span> <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Maisey"</span><span class="token punctuation">,</span> <span class="token string">"breed"</span><span class="token punctuation">:</span> <span class="token string">"Treeing Walker Coonhound"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>        <span class="token macro property">doc!</span> <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Ramsay"</span><span class="token punctuation">,</span> <span class="token string">"breed"</span><span class="token punctuation">:</span> <span class="token string">"Native American Indian Dog"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>        <span class="token macro property">doc!</span> <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Comet"</span><span class="token punctuation">,</span> <span class="token string">"breed"</span><span class="token punctuation">:</span> <span class="token string">"Whippet"</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">]</span><span class="token punctuation">;</span><br>    coll<span class="token punctuation">.</span><span class="token function">insert_many</span><span class="token punctuation">(</span>documents<span class="token punctuation">,</span> <span class="token class-name">None</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// An array can be used instead as follows.</span><br>    <span class="token comment">// But the "insert_many" method wants owned documents</span><br>    <span class="token comment">// and this array only contains references to them.</span><br>    <span class="token comment">// One way to get an array of owned documents from an</span><br>    <span class="token comment">// array of references is to call ".iter().cloned()" on it as shown here.</span><br>    <span class="token comment">/*<br>    let documents: [Document; 3] = [<br>        doc! {"name": "Maisey", "breed": "Treeing Walker Coonhound"},<br>        doc! {"name": "Ramsay", "breed": "Native American Indian Dog"},<br>        doc! {"name": "Comet", "breed": "Whippet"},<br>    ];<br>    coll.insert_many(documents.iter().cloned(), None).await?;<br>    */</span><br><br>    <span class="token keyword">let</span> document <span class="token operator">=</span> <span class="token macro property">doc!</span> <span class="token punctuation">{</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Oscar"</span><span class="token punctuation">,</span> <span class="token string">"breed"</span><span class="token punctuation">:</span> <span class="token string">"German Shorthaired Pointer"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> result <span class="token operator">=</span> coll<span class="token punctuation">.</span><span class="token function">insert_one</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> <span class="token class-name">None</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br><br>    coll<span class="token punctuation">.</span><span class="token function">update_one</span><span class="token punctuation">(</span><br>        <span class="token macro property">doc!</span> <span class="token punctuation">{</span><span class="token string">"_id"</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span>result<span class="token punctuation">.</span>inserted_id<span class="token punctuation">}</span><span class="token punctuation">,</span><br>        <span class="token macro property">doc!</span> <span class="token punctuation">{</span> <span class="token string">"$set"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Oscar Wilde"</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>        <span class="token class-name">None</span><span class="token punctuation">,</span><br>    <span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"\nDogs:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> cursor <span class="token operator">=</span> coll<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token class-name">None</span><span class="token punctuation">,</span> <span class="token class-name">None</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token keyword">while</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span> <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span> <span class="token operator">=</span> result <span class="token punctuation">{</span><br>            <span class="token macro property">dbg!</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre></li></ol><h2 id="sending-http-requests" tabindex="-1">Sending HTTP Requests</h2><p>The <a href="https://crates.io/crates/reqwest?v=1.1.1" rel="noopener" target="_blank">reqwest</a> crate is a popular option for sending HTTP requests. Here is an example of using it along with <a href="https://crates.io/crates/tokio?v=1.1.1" rel="noopener" target="_blank">tokio</a> for asynchronous calls and <a href="https://crates.io/crates/serde?v=1.1.1" rel="noopener" target="_blank">serde</a> for data structure deserialization.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">reqwest</span><span class="token punctuation">;</span><br><span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">tokio</span><span class="token punctuation">;</span><br><br><span class="token keyword">use</span> <span class="token namespace">serde<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Deserialize</span><span class="token punctuation">,</span> <span class="token class-name">Serialize</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> serde_json<span class="token punctuation">;</span><br><br><span class="token attribute attr-name">#[derive(Deserialize, Serialize, Debug)]</span><br><span class="token attribute attr-name">#[serde(rename_all = <span class="token string">"camelCase"</span>)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Todo</span> <span class="token punctuation">{</span><br>    user_id<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span><br>    id<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span><br>    title<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>    completed<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// std::error::Error is a trait, not a type.</span><br><span class="token comment">// Adding the `dyn` keyword before it means the error can be</span><br><span class="token comment">// described by any type of value that implements that trait.</span><br><span class="token comment">// The error value must have known size at compile time.</span><br><span class="token comment">// Since any value of a type that implements the trait can be used,</span><br><span class="token comment">// that size is not known.</span><br><span class="token comment">// But the compiler does know the size of a `Box`</span><br><span class="token comment">// which is what it is used to wrap the error value.</span><br><span class="token attribute attr-name">#[tokio::main]</span><br><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token namespace">std<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">>></span> <span class="token punctuation">{</span><br>    <span class="token comment">//let url = "https://jsonplaceholder.typicode.com/todos/3";</span><br>    <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token string">"https://jsonplaceholder.typicode.com/todos"</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token namespace">reqwest<span class="token punctuation">::</span></span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> json <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"json = {}"</span><span class="token punctuation">,</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">//let todo: Todo = serde_json::from_str(&amp;json).unwrap();</span><br>    <span class="token keyword">let</span> todos<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Todo</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token namespace">serde_json<span class="token punctuation">::</span></span><span class="token function">from_str</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>json<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">//println!("todo = {:?}", todo);</span><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"todos = {:#?}"</span><span class="token punctuation">,</span> todos<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre><p>Here is an example that uses reqwest to benchmark REST service implementations. This code can be found at <a href="https://github.com/mvolkmann/rust-rest-benchmark?v=1.1.1" rel="noopener" target="_blank">rust-rest-benchmark</a>.</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">serde<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Deserialize</span><span class="token punctuation">,</span> <span class="token class-name">Serialize</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">Instant</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">uuid<span class="token punctuation">::</span></span><span class="token class-name">Uuid</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token constant">BASE_URL</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token operator">=</span> <span class="token string">"http://localhost:1234/dog"</span><span class="token punctuation">;</span><br><span class="token attribute attr-name">#[derive(Clone, Debug, Deserialize, Serialize)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Dog</span> <span class="token punctuation">{</span><br>    id<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>    breed<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">delete_all_dogs</span><span class="token punctuation">(</span>client<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Client</span><span class="token punctuation">,</span> dogs<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Dog</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token namespace">std<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">>></span> <span class="token punctuation">{</span><br>    <span class="token keyword">for</span> dog <span class="token keyword">in</span> dogs <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"{}/{}"</span><span class="token punctuation">,</span> <span class="token constant">BASE_URL</span><span class="token punctuation">,</span> dog<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        client<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token attribute attr-name">#[tokio::main]</span><br><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token namespace">std<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">>></span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> count<span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> client <span class="token operator">=</span> <span class="token namespace">reqwest<span class="token punctuation">::</span></span><span class="token class-name">Client</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token class-name">Instant</span><span class="token punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Get all the current dogs.</span><br>    <span class="token keyword">let</span> dogs <span class="token operator">=</span> <span class="token namespace">reqwest<span class="token punctuation">::</span></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token constant">BASE_URL</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Dog</span><span class="token operator">>></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Delete all the current dogs.</span><br>    <span class="token function">delete_all_dogs</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>client<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dogs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Create new dogs.</span><br>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span>count <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token class-name">Uuid</span><span class="token punctuation">::</span><span class="token function">new_v4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">let</span> dog <span class="token operator">=</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span><br>            id<span class="token punctuation">,</span><br>            name<span class="token punctuation">:</span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"name-{}"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span><br>            breed<span class="token punctuation">:</span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"breed-{}"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><span class="token punctuation">;</span><br>        <span class="token keyword">let</span> res <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token constant">BASE_URL</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>dog<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br>        <span class="token keyword">if</span> <span class="token operator">!</span>res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is_success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token macro property">eprintln!</span><span class="token punctuation">(</span><span class="token string">"error creating dog, status = {}"</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token comment">//} else {</span><br>        <span class="token comment">//    let new_dog: Dog = res.json().await?;</span><br>        <span class="token comment">//    println!("created dog {:?}", new_dog);</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">let</span> dogs <span class="token operator">=</span> <span class="token namespace">reqwest<span class="token punctuation">::</span></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token constant">BASE_URL</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Dog</span><span class="token operator">>></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token comment">//println!("after creates, dogs = {:#?}", dogs);</span><br>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>dogs<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Update all the dogs.</span><br>    <span class="token keyword">for</span> dog <span class="token keyword">in</span> dogs <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> id <span class="token operator">=</span> dog<span class="token punctuation">.</span>id<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">let</span> new_dog <span class="token operator">=</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span><br>            id<span class="token punctuation">:</span> id<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            name<span class="token punctuation">:</span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"new-{}"</span><span class="token punctuation">,</span> dog<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span><br>            breed<span class="token punctuation">:</span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"new-{}"</span><span class="token punctuation">,</span> dog<span class="token punctuation">.</span>breed<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><span class="token punctuation">;</span><br>        <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"{}/{}"</span><span class="token punctuation">,</span> <span class="token constant">BASE_URL</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">let</span> res <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>new_dog<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br>        <span class="token keyword">if</span> <span class="token operator">!</span>res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is_success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token macro property">eprintln!</span><span class="token punctuation">(</span><span class="token string">"error updating dog, status = {}"</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// Retrieve all the dogs.</span><br>    <span class="token keyword">let</span> dogs <span class="token operator">=</span> <span class="token namespace">reqwest<span class="token punctuation">::</span></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token constant">BASE_URL</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Dog</span><span class="token operator">>></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token comment">//println!("after updates, dogs = {:#?}", dogs);</span><br><br>    <span class="token function">delete_all_dogs</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>client<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dogs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br><br>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"elapsed time: {:?}"</span><span class="token punctuation">,</span> start<span class="token punctuation">.</span><span class="token function">elapsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre><h2 id="http-servers" tabindex="-1"><a name="http-servers">HTTP Servers</a></h2><p>There are many ways to listen for and process HTTP requests. Popular creates for implementing HTTP servers include:</p><ul><li><a href="https://crates.io/crates/actix-web?v=1.1.1" rel="noopener" target="_blank">actix-web</a></li><li><a href="https://crates.io/crates/rocket?v=1.1.1" rel="noopener" target="_blank">rocket</a></li><li><a href="https://crates.io/crates/warp?v=1.1.1" rel="noopener" target="_blank">warp</a></li><li><a href="https://crates.io/crates/tide?v=1.1.1" rel="noopener" target="_blank">tide</a></li></ul><p>In order to demonstrate using each of these frameworks, we will implement the same set of CRUD REST services that operate on a collection of dog descriptions. Typically the data would be persisted to a database, but to keep the focus on the frameworks it will just be held in memory. This requires learning how each framework manages application state.</p><p>All of this code, along with benchmark results, can be found in GitHub at <a href="https://github.com/mvolkmann/rust-rest?v=1.1.1" rel="noopener" target="_blank">rust-rest</a>.</p><p>The endpoints exposed will be:</p><ul><li>GET /dog - to retrieve all the dogs</li><li>GET /dog/{id} - to retrieve a specific dog</li><li>POST /dog - to create a dog</li><li>PUT /dog/{id} - to update a dog</li><li>DELETE /dog/{id} - to delete a dog</li></ul><p><a href="https://www.techempower.com/benchmarks/#section=intro&hw=ph&test=fortune?v=1.1.1" rel="noopener" target="_blank">TechEmpower</a> is a company that has been performing benchmarks of web application frameworks since 2013. They catalog community-provided code and results for a large number of frameworks performing the same set of tasks that include &quot;JSON serialization, database access, and server-side template composition.&quot; The tests are run &quot;on cloud instances and on physical hardware.&quot; They are rerun with the latest versions of each framework every few months.</p><p>As of February 2021, five of the top 10 frameworks were implemented in Rust. Of these the most popular in terms of usage is actix. The Rust frameworks listed above had the following percentage performance scores compared to 100% for the fastest framework. For reference, a few non-Rust frameworks are included.</p><table><thead><tr><th>Framework</th><th>Language</th><th>Score</th></tr></thead><tbody><tr><td>drogon</td><td>C++</td><td>100%</td></tr><tr><td>actix</td><td>Rust</td><td>98.0%</td></tr><tr><td>vertx</td><td>Java</td><td>51.0%</td></tr><tr><td>greenlightning</td><td>Java</td><td>49.0%</td></tr><tr><td>warp</td><td>Rust</td><td>22.4%</td></tr><tr><td>php</td><td>PHP</td><td>14.1%</td></tr><tr><td>nodejs</td><td>JavaScript</td><td>13.7%</td></tr><tr><td>micronaut</td><td>Java</td><td>13.5%</td></tr><tr><td>fastify</td><td>JavaScript</td><td>10.9%</td></tr><tr><td>express</td><td>JavaScript</td><td>8.9%</td></tr><tr><td>rocket</td><td>Rust</td><td>5.0%</td></tr><tr><td>fastapi</td><td>Python</td><td>7.8%</td></tr><tr><td>flask</td><td>Python</td><td>3.5%</td></tr><tr><td>spring</td><td>Java</td><td>3.5%</td></tr><tr><td>grails</td><td>Java</td><td>1.7%</td></tr><tr><td>laravel</td><td>PHP</td><td>0.7%</td></tr><tr><td>tide</td><td>Rust</td><td>not listed</td></tr></tbody></table><p>Interestingly most of the frameworks evaluated are ones you have probably never heard of.</p><p>One reason to care about performance is cloud costs.</p><p>One might conclude from this that actix is the only Rust framework that should be considered. Why start with one that is significantly slower?</p><h3 id="actix-web" tabindex="-1">Actix-web</h3><p>This crate had a bad reputation for using unsafe code. See <a href="https://deavid.wordpress.com/2020/01/18/actix-web-is-dead-about-unsafe-rust/?v=1.1.1" rel="noopener" target="_blank">Actix-web is dead</a>. However, as of January 2020, this crate has new maintainers and perhaps the issues raised will be addressed. They claim that all of the unsafe code has been carefully analyzed and should be safe in practice.</p><p>Add the following dependencies in <code>Cargo.toml</code>:</p><pre class="language-toml"><code class="language-toml"><span class="token key property">actix-web</span> <span class="token punctuation">=</span> <span class="token string">"3.3.2"</span><br><span class="token key property">parking_lot</span> <span class="token punctuation">=</span> <span class="token string">"0.11.1"</span><br><span class="token key property">serde</span> <span class="token punctuation">=</span> <span class="token string">"1.0.123"</span><br><span class="token key property">uuid</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"0.8.2"</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"serde"</span><span class="token punctuation">,</span> <span class="token string">"v4"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span></code></pre><p>Add the following code in <code>src/main.rs</code>:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">actix_web<span class="token punctuation">::</span></span><span class="token punctuation">{</span>delete<span class="token punctuation">,</span> get<span class="token punctuation">,</span> post<span class="token punctuation">,</span> put<span class="token punctuation">,</span> web<span class="token punctuation">,</span> <span class="token class-name">App</span><span class="token punctuation">,</span> <span class="token class-name">HttpRequest</span><span class="token punctuation">,</span> <span class="token class-name">HttpResponse</span><span class="token punctuation">,</span> <span class="token class-name">HttpServer</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">parking_lot<span class="token punctuation">::</span></span><span class="token class-name">RwLock</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">serde<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Deserialize</span><span class="token punctuation">,</span> <span class="token class-name">Serialize</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">uuid<span class="token punctuation">::</span></span><span class="token class-name">Uuid</span><span class="token punctuation">;</span><br><br><span class="token comment">// We need to implement the "Clone" trait in order to</span><br><span class="token comment">// call the "cloned" method in the "get_dogs" route.</span><br><span class="token attribute attr-name">#[derive(Clone, Debug, Deserialize, Serialize)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Dog</span> <span class="token punctuation">{</span><br>    id<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>    breed<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token attribute attr-name">#[derive(Debug, Deserialize, Serialize)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">NewDog</span> <span class="token punctuation">{</span><br>    breed<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">type</span> <span class="token type-definition class-name">DogMap</span> <span class="token operator">=</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Dog</span><span class="token operator">></span><span class="token punctuation">;</span><br><br><span class="token keyword">struct</span> <span class="token type-definition class-name">AppState</span> <span class="token punctuation">{</span><br>    dog_map<span class="token punctuation">:</span> <span class="token class-name">DogMap</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token attribute attr-name">#[get(<span class="token string">"/dog"</span>)]</span><br><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">get_dogs</span><span class="token punctuation">(</span>state<span class="token punctuation">:</span> <span class="token namespace">web<span class="token punctuation">::</span></span><span class="token class-name">Data</span><span class="token operator">&lt;</span><span class="token class-name">RwLock</span><span class="token operator">&lt;</span><span class="token class-name">AppState</span><span class="token operator">>></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">HttpResponse</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> state <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> dogs<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Dog</span><span class="token operator">></span> <span class="token operator">=</span> state<span class="token punctuation">.</span>dog_map<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cloned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">HttpResponse</span><span class="token punctuation">::</span><span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token attribute attr-name">#[get(<span class="token string">"/dog/{id}"</span>)]</span><br><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">get_dog</span><span class="token punctuation">(</span>req<span class="token punctuation">:</span> <span class="token class-name">HttpRequest</span><span class="token punctuation">,</span> state<span class="token punctuation">:</span> <span class="token namespace">web<span class="token punctuation">::</span></span><span class="token class-name">Data</span><span class="token operator">&lt;</span><span class="token class-name">RwLock</span><span class="token operator">&lt;</span><span class="token class-name">AppState</span><span class="token operator">>></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">HttpResponse</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> id <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">match_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> state <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span> <span class="token operator">=</span> state<span class="token punctuation">.</span>dog_map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">HttpResponse</span><span class="token punctuation">::</span><span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">HttpResponse</span><span class="token punctuation">::</span><span class="token class-name">NotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token attribute attr-name">#[post(<span class="token string">"/dog"</span>)]</span><br><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">create_dog</span><span class="token punctuation">(</span><br>    json<span class="token punctuation">:</span> <span class="token namespace">web<span class="token punctuation">::</span></span><span class="token class-name">Json</span><span class="token operator">&lt;</span><span class="token class-name">NewDog</span><span class="token operator">></span><span class="token punctuation">,</span><br>    state<span class="token punctuation">:</span> <span class="token namespace">web<span class="token punctuation">::</span></span><span class="token class-name">Data</span><span class="token operator">&lt;</span><span class="token class-name">RwLock</span><span class="token operator">&lt;</span><span class="token class-name">AppState</span><span class="token operator">>></span><span class="token punctuation">,</span><br><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">HttpResponse</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token class-name">Uuid</span><span class="token punctuation">::</span><span class="token function">new_v4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> new_dog <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">into_inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> dog <span class="token operator">=</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span><br>        id<span class="token punctuation">:</span> id<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        name<span class="token punctuation">:</span> new_dog<span class="token punctuation">.</span>name<span class="token punctuation">,</span><br>        breed<span class="token punctuation">:</span> new_dog<span class="token punctuation">.</span>breed<span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> state <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    state<span class="token punctuation">.</span>dog_map<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> dog<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">HttpResponse</span><span class="token punctuation">::</span><span class="token class-name">Created</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token attribute attr-name">#[put(<span class="token string">"/dog/{id}"</span>)]</span><br><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">update_dog</span><span class="token punctuation">(</span><br>    json<span class="token punctuation">:</span> <span class="token namespace">web<span class="token punctuation">::</span></span><span class="token class-name">Json</span><span class="token operator">&lt;</span><span class="token class-name">Dog</span><span class="token operator">></span><span class="token punctuation">,</span><br>    state<span class="token punctuation">:</span> <span class="token namespace">web<span class="token punctuation">::</span></span><span class="token class-name">Data</span><span class="token operator">&lt;</span><span class="token class-name">RwLock</span><span class="token operator">&lt;</span><span class="token class-name">AppState</span><span class="token operator">>></span><span class="token punctuation">,</span><br><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">HttpResponse</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> dog <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">into_inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> id <span class="token operator">=</span> dog<span class="token punctuation">.</span>id<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">//println!("updating dog with id {}", id);</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> state <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    state<span class="token punctuation">.</span>dog_map<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> dog<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">HttpResponse</span><span class="token punctuation">::</span><span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token attribute attr-name">#[delete(<span class="token string">"/dog/{id}"</span>)]</span><br><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">delete_dog</span><span class="token punctuation">(</span>req<span class="token punctuation">:</span> <span class="token class-name">HttpRequest</span><span class="token punctuation">,</span> state<span class="token punctuation">:</span> <span class="token namespace">web<span class="token punctuation">::</span></span><span class="token class-name">Data</span><span class="token operator">&lt;</span><span class="token class-name">RwLock</span><span class="token operator">&lt;</span><span class="token class-name">AppState</span><span class="token operator">>></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">HttpResponse</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> id <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">match_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> state <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>_dog<span class="token punctuation">)</span> <span class="token operator">=</span> state<span class="token punctuation">.</span>dog_map<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">HttpResponse</span><span class="token punctuation">::</span><span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">HttpResponse</span><span class="token punctuation">::</span><span class="token class-name">NotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token attribute attr-name">#[actix_web::main]</span><br><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> dog_map<span class="token punctuation">:</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Dog</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Start with one dog already created.</span><br>    <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token class-name">Uuid</span><span class="token punctuation">::</span><span class="token function">new_v4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> dog <span class="token operator">=</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span><br>        id<span class="token punctuation">:</span> id<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        name<span class="token punctuation">:</span> <span class="token string">"Comet"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        breed<span class="token punctuation">:</span> <span class="token string">"Whippet"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    dog_map<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> dog<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token namespace">web<span class="token punctuation">::</span></span><span class="token class-name">Data</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">RwLock</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">AppState</span> <span class="token punctuation">{</span> dog_map <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token class-name">HttpServer</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span><br>        <span class="token class-name">App</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">app_data</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span>get_dog<span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span>get_dogs<span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span>delete_dog<span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span>create_dog<span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span>update_dog<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">1234</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><br>    <span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token keyword">await</span><br><span class="token punctuation">}</span></code></pre><h3 id="rocket" tabindex="-1">Rocket</h3><p>An issue with using Rocket is that it currently requires using a nightly version of Rust. For details, see <a href="https://github.com/SergioBenitez/Rocket/issues/19#issuecomment-736637259?v=1.1.1" rel="noopener" target="_blank">this issue</a>. However, the stable version of Rust can be used with the master branch of Rocket if that is specified in the <code>rocket</code> dependency.</p><p>Rocket includes built-in support for accessing the following databases: Memcache, MongoDB, MySQL, Neo4J, PostgreSQL, Redis, and SQLite.</p><p>The <a href="https://rocket.rs/v0.4/guide/configuration/?v=1.1.1" rel="noopener" target="_blank">Rocket configuration guide</a> says &quot;Warning: Rocket's built-in TLS is not considered ready for production use. It is intended for development use only.&quot; Presumably production uses of Rocket place the Rocket server behind another server such as nginx to get HTTPS support.</p><p>Some aspects of Rocket are configured by created a <code>Rocket.toml</code> file. If this file does not exist, default values are used. Here is example content for this file:</p><pre class="language-toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">debug</span><span class="token punctuation">]</span><br><span class="token key property">address</span> <span class="token punctuation">=</span> <span class="token string">"127.0.0.1"</span><br><span class="token key property">port</span> <span class="token punctuation">=</span> <span class="token number">1234</span><br><span class="token key property">log_level</span> <span class="token punctuation">=</span> <span class="token string">"normal"</span><br><br><span class="token punctuation">[</span><span class="token table class-name">staging</span><span class="token punctuation">]</span><br><span class="token key property">address</span> <span class="token punctuation">=</span> <span class="token string">"0.0.0.0"</span><br><span class="token key property">port</span> <span class="token punctuation">=</span> <span class="token number">80</span><br><span class="token key property">log_level</span> <span class="token punctuation">=</span> <span class="token string">"off"</span><br><br><span class="token punctuation">[</span><span class="token table class-name">release</span><span class="token punctuation">]</span><br><span class="token key property">address</span> <span class="token punctuation">=</span> <span class="token string">"0.0.0.0"</span><br><span class="token key property">port</span> <span class="token punctuation">=</span> <span class="token number">80</span><br><span class="token key property">log_level</span> <span class="token punctuation">=</span> <span class="token string">"critical"</span></code></pre><p>Add the following dependencies in <code>Cargo.toml</code>:</p><pre class="language-toml"><code class="language-toml"><span class="token key property">parking_lot</span> <span class="token punctuation">=</span> <span class="token string">"0.11.1"</span><br><span class="token key property">rocket</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">git</span> <span class="token punctuation">=</span> <span class="token string">"https://github.com/SergioBenitez/Rocket"</span><span class="token punctuation">,</span> <span class="token key property">branch</span> <span class="token punctuation">=</span> <span class="token string">"master"</span> <span class="token punctuation">}</span><br><span class="token key property">rocket_contrib</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">git</span> <span class="token punctuation">=</span> <span class="token string">"https://github.com/SergioBenitez/Rocket"</span><span class="token punctuation">,</span> <span class="token key property">branch</span> <span class="token punctuation">=</span> <span class="token string">"master"</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"json"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><br><span class="token key property">serde</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"1.0.118"</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"derive"</span><span class="token punctuation">,</span> <span class="token string">"rc"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><br><span class="token key property">serde_json</span> <span class="token punctuation">=</span> <span class="token string">"1.0.60"</span><br><span class="token key property">uuid</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"0.8.2"</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"serde"</span><span class="token punctuation">,</span> <span class="token string">"v4"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span></code></pre><p>Add the following code in <code>src/main.rs</code>:</p><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[macro_use]</span><br><span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">rocket</span><span class="token punctuation">;</span><br><br><span class="token keyword">use</span> <span class="token namespace">parking_lot<span class="token punctuation">::</span></span><span class="token class-name">RwLock</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">rocket<span class="token punctuation">::</span></span><span class="token class-name">State</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">rocket_contrib<span class="token punctuation">::</span>json<span class="token punctuation">::</span></span><span class="token class-name">Json</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">serde<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Deserialize</span><span class="token punctuation">,</span> <span class="token class-name">Serialize</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span><span class="token class-name">Arc</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">uuid<span class="token punctuation">::</span></span><span class="token class-name">Uuid</span><span class="token punctuation">;</span><br><br><span class="token comment">// We need to implement the "Clone" trait in order to</span><br><span class="token comment">// call the "cloned" method in the "get_dogs" function.</span><br><span class="token attribute attr-name">#[derive(Clone, Deserialize, Serialize, Debug)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Dog</span> <span class="token punctuation">{</span><br>    id<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>    breed<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token attribute attr-name">#[derive(Deserialize, Serialize, Debug)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">NewDog</span> <span class="token punctuation">{</span><br>    breed<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">struct</span> <span class="token type-definition class-name">MyState</span> <span class="token punctuation">{</span><br>    dog_map<span class="token punctuation">:</span> <span class="token class-name">Arc</span><span class="token operator">&lt;</span><span class="token class-name">RwLock</span><span class="token operator">&lt;</span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Dog</span><span class="token operator">>></span><span class="token operator">></span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token attribute attr-name">#[rocket::main]</span><br><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> dog_map<span class="token punctuation">:</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Dog</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token class-name">Uuid</span><span class="token punctuation">::</span><span class="token function">new_v4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> dog <span class="token operator">=</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span><br>        id<span class="token punctuation">:</span> id<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        name<span class="token punctuation">:</span> <span class="token string">"Comet"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        breed<span class="token punctuation">:</span> <span class="token string">"Whippet"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    dog_map<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> dog<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> state <span class="token operator">=</span> <span class="token class-name">MyState</span> <span class="token punctuation">{</span><br>        dog_map<span class="token punctuation">:</span> <span class="token class-name">Arc</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">RwLock</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>dog_map<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>    <span class="token attribute attr-name">#[post(<span class="token string">"/"</span>, format = <span class="token string">"json"</span>, data = <span class="token string">"&lt;json>"</span>)]</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">create_dog</span><span class="token punctuation">(</span>json<span class="token punctuation">:</span> <span class="token class-name">Json</span><span class="token operator">&lt;</span><span class="token class-name">NewDog</span><span class="token operator">></span><span class="token punctuation">,</span> state<span class="token punctuation">:</span> <span class="token class-name">State</span><span class="token operator">&lt;</span><span class="token class-name">MyState</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Json</span><span class="token operator">&lt;</span><span class="token class-name">Dog</span><span class="token operator">></span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> new_dog <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">into_inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token class-name">Uuid</span><span class="token punctuation">::</span><span class="token function">new_v4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">let</span> dog <span class="token operator">=</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span><br>            id<span class="token punctuation">:</span> id<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            name<span class="token punctuation">:</span> new_dog<span class="token punctuation">.</span>name<span class="token punctuation">,</span><br>            breed<span class="token punctuation">:</span> new_dog<span class="token punctuation">.</span>breed<span class="token punctuation">,</span><br>        <span class="token punctuation">}</span><span class="token punctuation">;</span><br>        <span class="token comment">//TODO: Find better way to get host and port.</span><br>        <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"http://localhost:1234/dog/{}"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">let</span> <span class="token keyword">mut</span> dog_map <span class="token operator">=</span> state<span class="token punctuation">.</span>dog_map<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        dog_map<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> dog<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>        <span class="token class-name">Created</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token class-name">Json</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token attribute attr-name">#[delete(<span class="token string">"/&lt;id>"</span>)]</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">delete_dog</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> state<span class="token punctuation">:</span> <span class="token class-name">State</span><span class="token operator">&lt;</span><span class="token class-name">MyState</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">NoContent</span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> <span class="token keyword">mut</span> dog_map <span class="token operator">=</span> state<span class="token punctuation">.</span>dog_map<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        dog_map<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token class-name">NoContent</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token attribute attr-name">#[get(<span class="token string">"/&lt;id>"</span>, format = <span class="token string">"json"</span>)]</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">get_dog</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> state<span class="token punctuation">:</span> <span class="token class-name">State</span><span class="token operator">&lt;</span><span class="token class-name">MyState</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">Json</span><span class="token operator">&lt;</span><span class="token class-name">Dog</span><span class="token operator">>></span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> dog_map <span class="token operator">=</span> state<span class="token punctuation">.</span>dog_map<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span> <span class="token operator">=</span> dog_map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token class-name">Json</span><span class="token punctuation">(</span>dog<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>            <span class="token class-name">None</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token attribute attr-name">#[get(<span class="token string">"/"</span>)]</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">get_dogs</span><span class="token punctuation">(</span>state<span class="token punctuation">:</span> <span class="token class-name">State</span><span class="token operator">&lt;</span><span class="token class-name">MyState</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Json</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Dog</span><span class="token operator">>></span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> dog_map <span class="token operator">=</span> state<span class="token punctuation">.</span>dog_map<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">let</span> dogs <span class="token operator">=</span> dog_map<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cloned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token class-name">Json</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token attribute attr-name">#[put(<span class="token string">"/&lt;id>"</span>, format = <span class="token string">"json"</span>, data = <span class="token string">"&lt;json>"</span>)]</span><br>    <span class="token keyword">fn</span> <span class="token function-definition function">update_dog</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> json<span class="token punctuation">:</span> <span class="token class-name">Json</span><span class="token operator">&lt;</span><span class="token class-name">Dog</span><span class="token operator">></span><span class="token punctuation">,</span> state<span class="token punctuation">:</span> <span class="token class-name">State</span><span class="token operator">&lt;</span><span class="token class-name">MyState</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Json</span><span class="token operator">&lt;</span><span class="token class-name">Dog</span><span class="token operator">></span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> dog<span class="token punctuation">:</span> <span class="token class-name">Dog</span> <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">into_inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">let</span> <span class="token keyword">mut</span> dog_map <span class="token operator">=</span> state<span class="token punctuation">.</span>dog_map<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        dog_map<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> dog<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token class-name">Json</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">//TODO: Learn how to get this to use TLS/HTTPS.</span><br>    <span class="token comment">// Note that https://rocket.rs/v0.4/guide/configuration/ says</span><br>    <span class="token comment">// "Warning: Rocket's built-in TLS is not considered ready for</span><br>    <span class="token comment">// production use. It is intended for development use only."</span><br>    <span class="token namespace">rocket<span class="token punctuation">::</span></span><span class="token function">ignite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">manage</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><br>            <span class="token string">"/dog"</span><span class="token punctuation">,</span><br>            <span class="token macro property">routes!</span><span class="token punctuation">[</span>create_dog<span class="token punctuation">,</span> delete_dog<span class="token punctuation">,</span> get_dog<span class="token punctuation">,</span> get_dogs<span class="token punctuation">,</span> update_dog<span class="token punctuation">]</span><span class="token punctuation">,</span><br>        <span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token keyword">await</span><br>        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"failed to start rocket"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h3 id="tide" tabindex="-1">Tide</h3><p>Add the following dependencies in <code>Cargo.toml</code>:</p><pre class="language-toml"><code class="language-toml"><span class="token key property">async-std</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"1.9.0"</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"attributes"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><br><span class="token key property">parking_lot</span> <span class="token punctuation">=</span> <span class="token string">"0.11.1"</span><br><span class="token key property">serde</span> <span class="token punctuation">=</span> <span class="token string">"1.0.123"</span><br><span class="token key property">tide</span> <span class="token punctuation">=</span> <span class="token string">"0.16.0"</span><br><span class="token key property">uuid</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"0.8.2"</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"serde"</span><span class="token punctuation">,</span> <span class="token string">"v4"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span></code></pre><p>While it may be possible to get Tide to work with tokio instead of async_std, the author has not provided an easy way to do this and no examples of doing it were found. See <a href="https://github.com/http-rs/tide/issues/791?v=1.1.1" rel="noopener" target="_blank">this issue</a>.</p><p>Add the following code in <code>src/main.rs</code>:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">async_std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span><span class="token class-name">Arc</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">parking_lot<span class="token punctuation">::</span></span><span class="token class-name">RwLock</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">tide<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">tide<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Body</span><span class="token punctuation">,</span> <span class="token class-name">Request</span><span class="token punctuation">,</span> <span class="token class-name">Response</span><span class="token punctuation">,</span> <span class="token class-name">StatusCode</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">uuid<span class="token punctuation">::</span></span><span class="token class-name">Uuid</span><span class="token punctuation">;</span><br><br><span class="token comment">// We need to implement the "Clone" trait in order to</span><br><span class="token comment">// call the "cloned" method in the "get_dogs" route.</span><br><span class="token attribute attr-name">#[derive(Clone, Debug, Deserialize, Serialize)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Dog</span> <span class="token punctuation">{</span><br>    <span class="token attribute attr-name">#[serde(default)]</span><br>    id<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">></span><span class="token punctuation">,</span><br>    breed<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">type</span> <span class="token type-definition class-name">DogMap</span> <span class="token operator">=</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Dog</span><span class="token operator">></span><span class="token punctuation">;</span><br><br><span class="token attribute attr-name">#[derive(Clone)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">State</span> <span class="token punctuation">{</span><br>    dog_map<span class="token punctuation">:</span> <span class="token class-name">Arc</span><span class="token operator">&lt;</span><span class="token class-name">RwLock</span><span class="token operator">&lt;</span><span class="token class-name">DogMap</span><span class="token operator">>></span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token attribute attr-name">#[async_std::main]</span><br><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">tide<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> dog_map<span class="token punctuation">:</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Dog</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token class-name">Uuid</span><span class="token punctuation">::</span><span class="token function">new_v4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> dog <span class="token operator">=</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span><br>        id<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        name<span class="token punctuation">:</span> <span class="token string">"Comet"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        breed<span class="token punctuation">:</span> <span class="token string">"Whippet"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    dog_map<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> dog<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> state <span class="token operator">=</span> <span class="token class-name">State</span> <span class="token punctuation">{</span><br>        dog_map<span class="token punctuation">:</span> <span class="token class-name">Arc</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">RwLock</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>dog_map<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> app <span class="token operator">=</span> <span class="token namespace">tide<span class="token punctuation">::</span></span><span class="token function">with_state</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    app<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token string">"/dog"</span><span class="token punctuation">)</span><br>        <span class="token comment">// Get all dogs.</span><br>        <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>req<span class="token punctuation">:</span> <span class="token class-name">Request</span><span class="token operator">&lt;</span><span class="token class-name">State</span><span class="token operator">></span><span class="token closure-punctuation punctuation">|</span></span> <span class="token keyword">async</span> <span class="token keyword">move</span> <span class="token punctuation">{</span><br>            <span class="token keyword">let</span> dog_map <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dog_map<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token keyword">let</span> dogs<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Dog</span><span class="token operator">></span> <span class="token operator">=</span> dog_map<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cloned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token keyword">let</span> <span class="token keyword">mut</span> res <span class="token operator">=</span> <span class="token class-name">Response</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">StatusCode</span><span class="token punctuation">::</span><span class="token class-name">Ok</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            res<span class="token punctuation">.</span><span class="token function">set_body</span><span class="token punctuation">(</span><span class="token class-name">Body</span><span class="token punctuation">::</span><span class="token function">from_json</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>dogs<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token class-name">Ok</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><br>        <span class="token comment">// Create a dog.</span><br>        <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token keyword">mut</span> req<span class="token punctuation">:</span> <span class="token class-name">Request</span><span class="token operator">&lt;</span><span class="token class-name">State</span><span class="token operator">></span><span class="token closure-punctuation punctuation">|</span></span> <span class="token keyword">async</span> <span class="token keyword">move</span> <span class="token punctuation">{</span><br>            <span class="token keyword">let</span> <span class="token keyword">mut</span> dog<span class="token punctuation">:</span> <span class="token class-name">Dog</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">body_json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br>            <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token class-name">Uuid</span><span class="token punctuation">::</span><span class="token function">new_v4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            dog<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token keyword">let</span> <span class="token keyword">mut</span> dog_map <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dog_map<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            dog_map<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> dog<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token keyword">let</span> <span class="token keyword">mut</span> res <span class="token operator">=</span> <span class="token namespace">tide<span class="token punctuation">::</span></span><span class="token class-name">Response</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">StatusCode</span><span class="token punctuation">::</span><span class="token class-name">Created</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            res<span class="token punctuation">.</span><span class="token function">set_body</span><span class="token punctuation">(</span><span class="token class-name">Body</span><span class="token punctuation">::</span><span class="token function">from_json</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>dog<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token class-name">Ok</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    app<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token string">"/dog/:id"</span><span class="token punctuation">)</span><br>        <span class="token comment">// Get a specific dog.</span><br>        <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>req<span class="token punctuation">:</span> <span class="token class-name">Request</span><span class="token operator">&lt;</span><span class="token class-name">State</span><span class="token operator">></span><span class="token closure-punctuation punctuation">|</span></span> <span class="token keyword">async</span> <span class="token keyword">move</span> <span class="token punctuation">{</span><br>            <span class="token keyword">let</span> id <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>            <span class="token keyword">let</span> dog_map <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dog_map<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span> <span class="token operator">=</span> dog_map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                <span class="token keyword">let</span> <span class="token keyword">mut</span> res <span class="token operator">=</span> <span class="token class-name">Response</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">StatusCode</span><span class="token punctuation">::</span><span class="token class-name">Ok</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>                res<span class="token punctuation">.</span><span class="token function">set_body</span><span class="token punctuation">(</span><span class="token class-name">Body</span><span class="token punctuation">::</span><span class="token function">from_json</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>dog<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>                <span class="token class-name">Ok</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><br>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>                <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">Response</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">StatusCode</span><span class="token punctuation">::</span><span class="token class-name">NotFound</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>            <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><br>        <span class="token comment">// Update a dog.</span><br>        <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token keyword">mut</span> req<span class="token punctuation">:</span> <span class="token class-name">Request</span><span class="token operator">&lt;</span><span class="token class-name">State</span><span class="token operator">></span><span class="token closure-punctuation punctuation">|</span></span> <span class="token keyword">async</span> <span class="token keyword">move</span> <span class="token punctuation">{</span><br>            <span class="token keyword">let</span> dog<span class="token punctuation">:</span> <span class="token class-name">Dog</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">body_json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br>            <span class="token keyword">let</span> id <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>            <span class="token keyword">let</span> <span class="token keyword">mut</span> dog_map <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dog_map<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>_dog<span class="token punctuation">)</span> <span class="token operator">=</span> dog_map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                dog_map<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dog<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>                <span class="token keyword">let</span> <span class="token keyword">mut</span> res <span class="token operator">=</span> <span class="token namespace">tide<span class="token punctuation">::</span></span><span class="token class-name">Response</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">StatusCode</span><span class="token punctuation">::</span><span class="token class-name">Ok</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>                res<span class="token punctuation">.</span><span class="token function">set_body</span><span class="token punctuation">(</span><span class="token class-name">Body</span><span class="token punctuation">::</span><span class="token function">from_json</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>dog<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>                <span class="token class-name">Ok</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><br>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>                <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">Response</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">StatusCode</span><span class="token punctuation">::</span><span class="token class-name">NotFound</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>            <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><br>        <span class="token comment">// Delete a dog.</span><br>        <span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>req<span class="token punctuation">:</span> <span class="token class-name">Request</span><span class="token operator">&lt;</span><span class="token class-name">State</span><span class="token operator">></span><span class="token closure-punctuation punctuation">|</span></span> <span class="token keyword">async</span> <span class="token keyword">move</span> <span class="token punctuation">{</span><br>            <span class="token keyword">let</span> id <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><br>            <span class="token keyword">let</span> <span class="token keyword">mut</span> dog_map <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dog_map<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>_dog<span class="token punctuation">)</span> <span class="token operator">=</span> dog_map<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">Response</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">StatusCode</span><span class="token punctuation">::</span><span class="token class-name">Ok</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>                <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">Response</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">StatusCode</span><span class="token punctuation">::</span><span class="token class-name">NotFound</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>            <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1:1234"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span><br>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre><h3 id="warp" tabindex="-1">Warp</h3><p>The Warp framework was created by Sean McArthur (@seanmonster) who has created many popular Rust crates including hyper, reqwest, and pretty-env-logger. It defines HTTP routes using &quot;filters&quot;.</p><p>Add the following dependencies in <code>Cargo.toml</code>:</p><pre class="language-toml"><code class="language-toml"><span class="token key property">parking_lot</span> <span class="token punctuation">=</span> <span class="token string">"0.11.1"</span><br><span class="token key property">serde</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"1.0.123"</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"derive"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><br><span class="token key property">serde_json</span> <span class="token punctuation">=</span> <span class="token string">"1.0.61"</span><br><span class="token key property">tokio</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"1.1.1"</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"full"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><br><span class="token key property">uuid</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"0.8.2"</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"serde"</span><span class="token punctuation">,</span> <span class="token string">"v4"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><br><span class="token key property">warp</span> <span class="token punctuation">=</span> <span class="token string">"0.3.0"</span></code></pre><p>Add the following code in <code>src/main.rs</code>:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">parking_lot<span class="token punctuation">::</span></span><span class="token class-name">RwLock</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">serde<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Deserialize</span><span class="token punctuation">,</span> <span class="token class-name">Serialize</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>convert<span class="token punctuation">::</span></span><span class="token class-name">Infallible</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span><span class="token class-name">Arc</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">uuid<span class="token punctuation">::</span></span><span class="token class-name">Uuid</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">warp<span class="token punctuation">::</span>http<span class="token punctuation">::</span></span><span class="token class-name">StatusCode</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">warp<span class="token punctuation">::</span>reply<span class="token punctuation">::</span></span><span class="token punctuation">{</span>json<span class="token punctuation">,</span> with_status<span class="token punctuation">,</span> <span class="token class-name">Json</span><span class="token punctuation">,</span> <span class="token class-name">Reply</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">use</span> <span class="token namespace">warp<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Filter</span><span class="token punctuation">,</span> <span class="token class-name">Rejection</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token comment">// We need to implement the "Clone" trait in order to</span><br><span class="token comment">// call the "cloned" method in the "get_dogs" route.</span><br><span class="token attribute attr-name">#[derive(Clone, Debug, Deserialize, Serialize)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">Dog</span> <span class="token punctuation">{</span><br>    id<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>    breed<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token attribute attr-name">#[derive(Debug, Deserialize, Serialize)]</span><br><span class="token keyword">struct</span> <span class="token type-definition class-name">NewDog</span> <span class="token punctuation">{</span><br>    breed<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br>    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">type</span> <span class="token type-definition class-name">DogMap</span> <span class="token operator">=</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Dog</span><span class="token operator">></span><span class="token punctuation">;</span><br><br><span class="token keyword">type</span> <span class="token type-definition class-name">State</span> <span class="token operator">=</span> <span class="token class-name">Arc</span><span class="token operator">&lt;</span><span class="token class-name">RwLock</span><span class="token operator">&lt;</span><span class="token class-name">DogMap</span><span class="token operator">>></span><span class="token punctuation">;</span><br><br><span class="token attribute attr-name">#[tokio::main]</span><br><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Add one dog for testing.</span><br>    <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token class-name">Uuid</span><span class="token punctuation">::</span><span class="token function">new_v4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> dog <span class="token operator">=</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span><br>        id<span class="token punctuation">:</span> id<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        name<span class="token punctuation">:</span> <span class="token string">"Comet"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>        breed<span class="token punctuation">:</span> <span class="token string">"Whippet"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> <span class="token keyword">mut</span> dog_map <span class="token operator">=</span> <span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    dog_map<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> dog<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> state<span class="token punctuation">:</span> <span class="token class-name">State</span> <span class="token operator">=</span> <span class="token class-name">Arc</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">RwLock</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>dog_map<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">fn</span> <span class="token function-definition function">with_state</span><span class="token punctuation">(</span>state<span class="token punctuation">:</span> <span class="token class-name">State</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">impl</span> <span class="token class-name">Filter</span><span class="token operator">&lt;</span><span class="token class-name">Extract</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">State</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Error</span> <span class="token operator">=</span> <span class="token class-name">Infallible</span><span class="token operator">></span> <span class="token operator">+</span> <span class="token class-name">Clone</span> <span class="token punctuation">{</span><br>        <span class="token namespace">warp<span class="token punctuation">::</span></span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> state<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">let</span> get_dogs <span class="token operator">=</span> <span class="token namespace">warp<span class="token punctuation">::</span></span><span class="token macro property">path!</span><span class="token punctuation">(</span><span class="token string">"dog"</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token namespace">warp<span class="token punctuation">::</span></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token function">with_state</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">and_then</span><span class="token punctuation">(</span>handle_get_dogs<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// In routes that cannot return an Err,</span><br>    <span class="token comment">// the compiler cannot infer the error type for the Result.</span><br>    <span class="token comment">// This must be an async fn instead of a closure passed to and_then</span><br>    <span class="token comment">// until proper support for async closures is added to Rust.</span><br>    <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">handle_get_dogs</span><span class="token punctuation">(</span>state<span class="token punctuation">:</span> <span class="token class-name">State</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Json</span><span class="token punctuation">,</span> <span class="token class-name">Rejection</span><span class="token operator">></span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> dog_map <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">let</span> dogs<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Dog</span><span class="token operator">></span> <span class="token operator">=</span> dog_map<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cloned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token namespace">warp<span class="token punctuation">::</span>reply<span class="token punctuation">::</span></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>dogs<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">let</span> get_dog <span class="token operator">=</span> <span class="token namespace">warp<span class="token punctuation">::</span></span><span class="token macro property">path!</span><span class="token punctuation">(</span><span class="token string">"dog"</span> <span class="token operator">/</span> <span class="token class-name">String</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token namespace">warp<span class="token punctuation">::</span></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token function">with_state</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">and_then</span><span class="token punctuation">(</span>handle_get_dog<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">handle_get_dog</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> state<span class="token punctuation">:</span> <span class="token class-name">State</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">impl</span> <span class="token class-name">Reply</span><span class="token punctuation">,</span> <span class="token class-name">Infallible</span><span class="token operator">></span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> dog_map <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span> <span class="token operator">=</span> dog_map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token function">with_status</span><span class="token punctuation">(</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>dog<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">StatusCode</span><span class="token punctuation">::</span><span class="token constant">OK</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>            <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token function">with_status</span><span class="token punctuation">(</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">StatusCode</span><span class="token punctuation">::</span><span class="token constant">NOT_FOUND</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">let</span> create_dog <span class="token operator">=</span> <span class="token namespace">warp<span class="token punctuation">::</span></span><span class="token macro property">path!</span><span class="token punctuation">(</span><span class="token string">"dog"</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token namespace">warp<span class="token punctuation">::</span></span><span class="token function">post</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token namespace">warp<span class="token punctuation">::</span>body<span class="token punctuation">::</span></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token function">with_state</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">and_then</span><span class="token punctuation">(</span>handle_create_dog<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// See the comment above the handle_get_dogs function.</span><br>    <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">handle_create_dog</span><span class="token punctuation">(</span>new_dog<span class="token punctuation">:</span> <span class="token class-name">NewDog</span><span class="token punctuation">,</span> state<span class="token punctuation">:</span> <span class="token class-name">State</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">impl</span> <span class="token class-name">Reply</span><span class="token punctuation">,</span> <span class="token class-name">Rejection</span><span class="token operator">></span> <span class="token punctuation">{</span><br>        <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token class-name">Uuid</span><span class="token punctuation">::</span><span class="token function">new_v4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">let</span> dog <span class="token operator">=</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span><br>            id<span class="token punctuation">:</span> id<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            name<span class="token punctuation">:</span> new_dog<span class="token punctuation">.</span>name<span class="token punctuation">,</span><br>            breed<span class="token punctuation">:</span> new_dog<span class="token punctuation">.</span>breed<span class="token punctuation">,</span><br>        <span class="token punctuation">}</span><span class="token punctuation">;</span><br>        <span class="token keyword">let</span> <span class="token keyword">mut</span> dog_map <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        dog_map<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> dog<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token function">with_status</span><span class="token punctuation">(</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>dog<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">StatusCode</span><span class="token punctuation">::</span><span class="token constant">CREATED</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">let</span> update_dog <span class="token operator">=</span> <span class="token namespace">warp<span class="token punctuation">::</span></span><span class="token macro property">path!</span><span class="token punctuation">(</span><span class="token string">"dog"</span> <span class="token operator">/</span> <span class="token class-name">String</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token namespace">warp<span class="token punctuation">::</span></span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token namespace">warp<span class="token punctuation">::</span>body<span class="token punctuation">::</span></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token function">with_state</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">and_then</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>id<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> dog<span class="token punctuation">:</span> <span class="token class-name">Dog</span><span class="token punctuation">,</span> state<span class="token punctuation">:</span> <span class="token class-name">State</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token keyword">async</span> <span class="token keyword">move</span> <span class="token punctuation">{</span><br>            <span class="token keyword">let</span> <span class="token keyword">mut</span> dog_map <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>_dog<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>dog_map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                dog_map<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> dog<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>                <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token namespace">warp<span class="token punctuation">::</span>reply<span class="token punctuation">::</span></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>dog<span class="token punctuation">)</span><span class="token punctuation">)</span><br>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>                <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token namespace">warp<span class="token punctuation">::</span>reject<span class="token punctuation">::</span></span><span class="token function">not_found</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>            <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> delete_dog <span class="token operator">=</span> <span class="token namespace">warp<span class="token punctuation">::</span></span><span class="token macro property">path!</span><span class="token punctuation">(</span><span class="token string">"dog"</span> <span class="token operator">/</span> <span class="token class-name">String</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token namespace">warp<span class="token punctuation">::</span></span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token function">with_state</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">and_then</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>id<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> state<span class="token punctuation">:</span> <span class="token class-name">State</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token keyword">async</span> <span class="token keyword">move</span> <span class="token punctuation">{</span><br>            <span class="token keyword">let</span> <span class="token keyword">mut</span> dog_map <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>_dog<span class="token punctuation">)</span> <span class="token operator">=</span> dog_map<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token function">with_status</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token class-name">StatusCode</span><span class="token punctuation">::</span><span class="token constant">NO_CONTENT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>                <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token namespace">warp<span class="token punctuation">::</span>reject<span class="token punctuation">::</span></span><span class="token function">not_found</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>            <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">//TODO: Learn how to get this to use TLS/HTTPS.</span><br>    <span class="token keyword">let</span> routes <span class="token operator">=</span> get_dogs<br>        <span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span>create_dog<span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span>update_dog<span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span>delete_dog<span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span>get_dog<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token namespace">warp<span class="token punctuation">::</span></span><span class="token function">serve</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1234</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></article>