<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Rust</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#installing">Installing</a></li><li><a href="#hello-world">Hello World</a></li><li><a href="#compiling-code">Compiling Code</a></li><li><a href="#formatting-code">Formatting Code</a></li><li><a href="#built-in-scalar-types">Built-in Scalar Types</a></li><li><a href="#built-in-compound-types">Built-in Compound Types</a></li></ol></nav></aside><article><p><img alt="Deno logo" style="width: 20%" src="/blog/assets/rust-logo.png" title="Rust logo"></p><h2 id="overview">Overview</h2><p><a href="https://www.rust-lang.org/" rel="noopener" target="_blank">Rust</a> is a programming language for building reliable and efficient software.</p><p>Features of Rust include:</p><ul><li>fast</li><li>memory-efficient</li><li>rich, static type system with type inference</li><li>ownership model to guarantee memory-safety and thread-safety</li></ul><h2 id="installing">Installing</h2><p>Rust is installed using the <a href="" rel="noopener" target="_blank">rustup</a> tool.</p><p>To install rustup in macOS, install <a href="" rel="noopener" target="_blank">homebrew</a> and then enter <code>brew install rustup</code>.</p><p>To install rustup in Linux (or macOS), enter the following command:</p><pre class="language-bash"><code class="language-bash"><span class="token function">curl</span> --proto <span class="token string">'=https'</span> --tlsv1.2 -sSf https://sh.rustup.rs <span class="token operator">|</span> <span class="token function">sh</span></code></pre><p>To install rustup in Windows, use <a href="https://chocolatey.org/" rel="noopener" target="_blank">Chocolately</a> or <a href="https://scoop.sh/" rel="noopener" target="_blank">Scoop</a>.</p><p>After installing rustup, enter <code>rustup-init</code>. This configures the use of Rust in the bash and zsh shells. When using the fish shell, add the following in <code>.config/fish/config.fish</code>:</p><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">set</span> -x <span class="token environment constant">PATH</span> <span class="token environment constant">$PATH</span> <span class="token environment constant">$HOME</span>/.cargo/bin</code></pre><p>Verify installation by entering <code>rustc --version</code>.</p><h2 id="hello-world">Hello World</h2><p>The following is a Rust Hello World program:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Hello World!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h2 id="compiling-code">Compiling Code</h2><p>To compile a <code>.rs</code> file, enter <code>rustc {name}.rs</code>. This creates an executable with the same name and no file extension. For example <code>rustc hello.rs</code> creates <code>hello</code>. To run the executable, enter <code>./</code> followed by the name. For example, <code>./hello</code>.</p><h2 id="formatting-code">Formatting Code</h2><p>The most popular code formatting tool for Rust is <a href="" rel="noopener" target="_blank">rustfmt</a>. To install this, enter <code>cargo install rustfmt</code>. TODO: Is this installed by default by rustup?</p><p>To run it on all <code>.rs</code> files in the current directory, enter <code>rustfmt *.rs</code>.</p><h2 id="built-in-scalar-types">Built-in Scalar Types</h2><p>Rust defines four scalar (primitive) types which are boolean, character, integer, and floating-point.</p><p>The boolean type name is <code>bool</code>. Its only values are <code>true</code> and <code>false</code>.</p><p>The character type name is <code>char</code>. Its values are Unicode values of up to four bytes. TODO: Does every character use all four bytes?</p><p>The signed integer type names are <code>i{n}</code> where <code>{n}</code> is the number of bits which can be 8, 16, 32, 64, 128 or <code>size</code> which corresponds to either 32 or 64 depending on the processor architecture. The default type for literal integers is <code>i32</code> regardless of the processor.</p><p>Literal integer values can use the underscore character to separate thousands, millions, and so on. For example, the population of the U.S. in 2020 was approximately 330_676_544. Hex values begin with <code>0x</code>, octal values begin with <code>0o</code>, and binary values begin with <code>0b</code>.</p><p>The unsigned integer types are the same, but start with <code>u</code> instead of <code>i</code>.</p><p>Floating-point type names are <code>f{n}</code> where <code>{n}</code> is 32 or 64. The default type for literal floats is <code>f64</code> regardless of the processor.</p><h2 id="built-in-compound-types">Built-in Compound Types</h2><p>Rust defines two compound (non-primitive) types which are tuple and array. These are distinct from the collection types that are described later.</p><p>A tuple is a fixed-length list of values that can be of different types. The syntax for a tuple type is <code>(type1, type2, ...)</code>. The syntax for a tuple value is <code>(value1, value2, ...)</code>. Individual values can be accessed by index or destructuring.</p><p>For example:</p><pre class="language-rust"><code class="language-rust">TODO<span class="token punctuation">:</span> ADD THIS</code></pre><p>An array is a fixed-length list of values that have the same type. The syntax for an array type is <code>[type, length]</code>. The syntax for an array value is <code>[value1, value2, ...]</code>. For example:</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">let</span> rgb <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"green"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token comment">// A Rust string is a "compound collection", covered later.</span><br><span class="token keyword">let</span> sevens <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// same as [7, 7, 7, 7, 7]</span><br>```<br><br>Elements of an array can <span class="token keyword">be</span> accessed using<br>square brackets and zero<span class="token operator">-</span>based indexes<span class="token punctuation">.</span><br>For example<span class="token punctuation">,</span> `rgb<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>` is <span class="token string">"green"</span><span class="token punctuation">.</span><br><br>A vector is a variable<span class="token operator">-</span>length list of values<span class="token punctuation">.</span><br>TODO<span class="token punctuation">:</span> Do they all have the same <span class="token keyword">type</span><span class="token operator">?</span><br><br>## Collections<br><br>Rust defines three kinds of collections that hold a variable number of values<span class="token punctuation">.</span><br>These include strings<span class="token punctuation">,</span> vectors<span class="token punctuation">,</span> and hash maps<span class="token punctuation">.</span><br><br>Strings are collections of characters<span class="token punctuation">.</span><br>Vectors are collections of any kind of value<span class="token punctuation">.</span><br>Hash maps hold key<span class="token operator">/</span>value pairs <span class="token keyword">where</span> the keys and values can <span class="token keyword">be</span> any <span class="token keyword">type</span><span class="token punctuation">.</span><br><br>There are two kinds of strings used <span class="token keyword">in</span> Rust programs<span class="token punctuation">.</span><br>The Rust language defines the `str` <span class="token keyword">type</span><br>and the standard library defines the `String` <span class="token keyword">type</span><span class="token punctuation">.</span><br>TODO<span class="token punctuation">:</span> Explain the <span class="token macro-rules function">differences!</span><br><br>## Operators<br><br>Rust supports common operators including<span class="token punctuation">:</span><br><br><span class="token operator">-</span> arithmetic<span class="token punctuation">:</span> `<span class="token operator">+</span>`<span class="token punctuation">,</span> `<span class="token operator">-</span>`<span class="token punctuation">,</span> `\<span class="token operator">*</span>`<span class="token punctuation">,</span> `<span class="token operator">/</span>`<span class="token punctuation">,</span> `<span class="token operator">%</span>` <span class="token punctuation">(</span><span class="token keyword">mod</span><span class="token punctuation">)</span><br><br>## Variables<br><br>Variables are immutable by default<span class="token punctuation">.</span><br>For variables that hold non<span class="token operator">-</span>primitive values<span class="token punctuation">,</span><br>even their fields cannot <span class="token keyword">be</span> mutated<span class="token punctuation">.</span><br><br>The `<span class="token keyword">mut</span>` keyword marks a variable <span class="token keyword">as</span> mutable<span class="token punctuation">.</span><br><br>A variable declaration has the syntax `<span class="token keyword">let</span> name<span class="token punctuation">:</span> <span class="token keyword">type</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>`<br><span class="token keyword">where</span> the value is optional<span class="token punctuation">.</span><br>However<span class="token punctuation">,</span> a value must <span class="token keyword">be</span> assigned before the variable is referenced<span class="token punctuation">.</span><br>The colon and the <span class="token keyword">type</span> can <span class="token keyword">be</span> omitted <span class="token keyword">if</span> it can <span class="token keyword">be</span> inferred from the value<span class="token punctuation">.</span><br><br>## Conditional Logic<br><br>## Iteration<br><br>## Functions<br><br>## Imports<br><br>## Custom Types<br><br>## Traits<br><br>## Standard Library<br><br>## <span class="token operator">&lt;</span>a name<span class="token operator">=</span><span class="token string">"webassembly"</span><span class="token operator">></span>WebAssembly<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><br><br>Tools <span class="token keyword">for</span> compiling Rust code to WebAssembly include<br><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"https://rustwasm.github.io/wasm-pack/"</span> rel<span class="token operator">=</span><span class="token string">"noopener"</span> target<span class="token operator">=</span><span class="token string">"_blank"</span><span class="token operator">></span>wasm<span class="token operator">-</span>pack<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span> and<br><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"https://www.secondstate.io/articles/ssvmup/"</span> rel<span class="token operator">=</span><span class="token string">"noopener"</span> target<span class="token operator">=</span><span class="token string">"_blank"</span><span class="token operator">></span>ssvmup<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><br>The last update to wasm<span class="token operator">-</span>pack was on February <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">2020</span><span class="token punctuation">,</span><br>so this project may <span class="token keyword">be</span> abandoned<span class="token punctuation">.</span><br>The ssvmup tool was inspired by wasm<span class="token operator">-</span>pack and has explicit support <span class="token keyword">for</span> Deno<span class="token punctuation">.</span><br><br>To compile a `<span class="token punctuation">.</span>rs` file to WebAssembly<span class="token punctuation">:</span><br><br><span class="token number">1</span><span class="token punctuation">.</span> Install ssvmup by entering the following <span class="token function">command</span> <span class="token punctuation">(</span>one time only<span class="token punctuation">)</span><span class="token punctuation">:</span><br><br>   ```bash<br>   curl https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>raw<span class="token punctuation">.</span>githubusercontent<span class="token punctuation">.</span>com<span class="token operator">/</span>second<span class="token operator">-</span>state<span class="token operator">/</span>ssvmup<span class="token operator">/</span>master<span class="token operator">/</span>installer<span class="token operator">/</span>init<span class="token punctuation">.</span>sh <span class="token operator">-</span>sSf <span class="token operator">|</span> sh<br>   ```<br><br><span class="token number">1</span><span class="token punctuation">.</span> Create a new Rust <span class="token function">library</span> <span class="token punctuation">(</span>referred to <span class="token keyword">as</span> a <span class="token string">"crate"</span><span class="token punctuation">)</span><br>   by entering `cargo new <span class="token operator">-</span><span class="token operator">-</span>lib my<span class="token operator">-</span><span class="token keyword">crate</span>`<br><br><span class="token number">1</span><span class="token punctuation">.</span> `cd my<span class="token operator">-</span><span class="token keyword">crate</span>`<br><br><span class="token number">1</span><span class="token punctuation">.</span> Edit `src<span class="token operator">/</span>lib<span class="token punctuation">.</span>rs` and add code there<span class="token punctuation">.</span><br>   For example<span class="token punctuation">:</span><br><br>   ```rust<br>   <span class="token keyword">use</span> wasm_bindgen<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span><br><br>   <span class="token attribute attr-name">#[wasm_bindgen]</span><br>   <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">factorial</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> u64<span class="token punctuation">)</span> <span class="token punctuation">-></span> u64 <span class="token punctuation">{</span><br>       <span class="token keyword">match</span> x <span class="token punctuation">{</span><br>           <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">=></span> <span class="token number">1</span><span class="token punctuation">,</span><br>           _ <span class="token operator">=></span> x <span class="token operator">*</span> <span class="token function">factorial</span><span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>       <span class="token punctuation">}</span><br>   <span class="token punctuation">}</span><br>   ```<br><br><span class="token number">1</span><span class="token punctuation">.</span> Edit the generated `Cargo<span class="token punctuation">.</span>toml` file<br>   which is similar to a Node<span class="token punctuation">.</span>js `package<span class="token punctuation">.</span>json` file<span class="token punctuation">.</span><br>   For example<span class="token punctuation">:</span><br><br>   ```toml<br>   <span class="token punctuation">[</span>package<span class="token punctuation">]</span><br>   name <span class="token operator">=</span> <span class="token string">"my-crate"</span><br>   version <span class="token operator">=</span> <span class="token string">"0.1.0"</span><br>   authors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"R. Mark Volkmann &lt;me@gmail.com>"</span><span class="token punctuation">]</span><br>   edition <span class="token operator">=</span> <span class="token string">"2018"</span><br>   description <span class="token operator">=</span> <span class="token string">"sample project using ssvmup"</span><br>   license <span class="token operator">=</span> <span class="token string">"MIT/Apache-2.0"</span><br>   #repository <span class="token operator">=</span> <span class="token string">"https://github.com/mvolkmann/my-crate"</span><br><br>   <span class="token punctuation">[</span>lib<span class="token punctuation">]</span><br>   <span class="token keyword">crate</span><span class="token operator">-</span><span class="token keyword">type</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"cdylib"</span><span class="token punctuation">]</span><br><br>   <span class="token punctuation">[</span>dependencies<span class="token punctuation">]</span><br>   wasm<span class="token operator">-</span>bindgen <span class="token operator">=</span> <span class="token string">"=0.2.61"</span><br>   ```<br><br><span class="token number">1</span><span class="token punctuation">.</span> Enter `ssvmup build <span class="token operator">-</span><span class="token operator">-</span>target deno`<br>   This creates a `pkg` directory containing<br>   `package<span class="token punctuation">.</span>json`<span class="token punctuation">,</span> a `<span class="token punctuation">.</span>wasm` file<span class="token punctuation">,</span> and a `<span class="token punctuation">.</span>js` file that<br>   reads the `<span class="token punctuation">.</span>wasm` file and prepares it <span class="token keyword">for</span> <span class="token keyword">use</span> <span class="token keyword">in</span> JavaScript code<span class="token punctuation">.</span><br><br><span class="token number">1</span><span class="token punctuation">.</span> Copy the generated `pkg` directory to the directory<br>   containing the Deno code that wishes to <span class="token keyword">use</span> it<span class="token punctuation">.</span><br><br><span class="token number">1</span><span class="token punctuation">.</span> Import the exported functions with a line like the following<span class="token punctuation">:</span><br><br>   ```js<br>   import <span class="token punctuation">{</span>factorial<span class="token punctuation">}</span> from <span class="token lifetime-annotation symbol">'./pkg/my_crate.js</span><span class="token lifetime-annotation symbol">';</span><br>   ```<br><br><span class="token number">1</span><span class="token punctuation">.</span> Call the imported functions<span class="token punctuation">.</span><br><br>   ```js<br>   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">factorial</span><span class="token punctuation">(</span>4n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "n" suffix makes it BitInt</span><br>   ```</code></pre></article>