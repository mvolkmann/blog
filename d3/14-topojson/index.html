<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><link rel="stylesheet" href="/blog/assets/github-extensions.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>D3 topojson Library</h2><aside><nav class="toc"><ol><li><a href="#index.html">index.html</a></li><li><a href="#world-map.js">world-map.js</a></li><li><a href="#world-map.css">world-map.css</a></li><li><a href="#pan-zoom.js">pan-zoom.js</a></li><li><a href="#pan-zoom.css">pan-zoom.css</a></li></ol></nav></aside><article><p>The D3 library topojson can be used to render topographical maps.</p><p>Here is an example of a world map. Countries are assigned a shade of blue based on their population. Hovering over a country displays a tooltip that shows the country name and its population. Buttons at the bottom support panning and zooming. The button in the center of the arrow buttons resets the pan and zoom. Dragging the map moves it. Double-clicking the map zooms in, or zooms out if the shift key is down.</p><p><img src="/blog/assets/d3-world-map.png" alt="D3 World Map"></p><p>To see this in action, browse <a href="https://world-map.rmarkvolkmann.now.sh?v=1.0.21" rel="noopener" target="_blank">Country Populations</a>.</p><p>This uses two input files, <code>world-countries.json</code> and <code>world-population.tsv</code>. These files can be obtained from a <a href="https://gist.github.com/jeremycflin/b43ab253f3ae02dced07?v=1.0.21" rel="noopener" target="_blank">gist by Jeremy Lin</a>.</p><h3 id="index.html" tabindex="-1">index.html</h3><pre class="language-html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pan-zoom.css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>world-map.css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://d3js.org/d3.v5.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://d3js.org/topojson.v2.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">defer</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>      <span class="token keyword">import</span> <span class="token punctuation">{</span>createWorldMap<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./world-map.js'</span><span class="token punctuation">;</span><br>      <span class="token function">createWorldMap</span><span class="token punctuation">(</span><span class="token string">'world-map'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>world-map<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tooltip<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">></span></span>Country:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>country<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">></span></span>Population:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>population<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h3 id="world-map.js" tabindex="-1">world-map.js</h3><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>panZoomSetup<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./pan-zoom.js'</span><span class="token punctuation">;</span><br><br><span class="token comment">// These values were carefully selected to make the map fill the SVG.</span><br><span class="token keyword">const</span> <span class="token constant">MAP_SCALE</span> <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">SVG_WIDTH</span> <span class="token operator">=</span> <span class="token number">772</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">SVG_HEIGHT</span> <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span><br><br><span class="token comment">// Create a function that a population number</span><br><span class="token comment">// to a shade of blue for country fills.</span><br><span class="token keyword">const</span> color <span class="token operator">=</span> d3<br>  <span class="token punctuation">.</span><span class="token function">scaleThreshold</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">domain</span><span class="token punctuation">(</span><span class="token punctuation">[</span><br>    <span class="token number">10000</span><span class="token punctuation">,</span><br>    <span class="token number">100000</span><span class="token punctuation">,</span><br>    <span class="token number">500000</span><span class="token punctuation">,</span><br>    <span class="token number">1000000</span><span class="token punctuation">,</span><br>    <span class="token number">5000000</span><span class="token punctuation">,</span><br>    <span class="token number">10000000</span><span class="token punctuation">,</span><br>    <span class="token number">50000000</span><span class="token punctuation">,</span><br>    <span class="token number">100000000</span><span class="token punctuation">,</span><br>    <span class="token number">500000000</span><span class="token punctuation">,</span><br>    <span class="token number">1500000000</span><br>  <span class="token punctuation">]</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span><br>    <span class="token string">'rgb(247,251,255)'</span><span class="token punctuation">,</span><br>    <span class="token string">'rgb(222,235,247)'</span><span class="token punctuation">,</span><br>    <span class="token string">'rgb(198,219,239)'</span><span class="token punctuation">,</span><br>    <span class="token string">'rgb(158,202,225)'</span><span class="token punctuation">,</span><br>    <span class="token string">'rgb(107,174,214)'</span><span class="token punctuation">,</span><br>    <span class="token string">'rgb(66,146,198)'</span><span class="token punctuation">,</span><br>    <span class="token string">'rgb(33,113,181)'</span><span class="token punctuation">,</span><br>    <span class="token string">'rgb(8,81,156)'</span><span class="token punctuation">,</span><br>    <span class="token string">'rgb(8,48,107)'</span><span class="token punctuation">,</span><br>    <span class="token string">'rgb(3,19,43)'</span><br>  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Create a function to format numbers with commas.</span><br><span class="token keyword">const</span> format <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> tooltip <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'.tooltip'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> tooltipCountry <span class="token operator">=</span> tooltip<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'.country'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> tooltipPopulation <span class="token operator">=</span> tooltip<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'.population'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">function</span> <span class="token function">hideTooltip</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  tooltip<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter">svg<span class="token punctuation">,</span> path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// Load the id, name, and polygon coordinates of each country.</span><br>  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'world-countries.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>features<span class="token punctuation">;</span><br><br>  <span class="token comment">// Load the id and population of each country.</span><br>  res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'world-population.tsv'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> tsv <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> lines <span class="token operator">=</span> tsv<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> population <span class="token operator">=</span> lines<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">line</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> <span class="token punctuation">[</span>id<span class="token punctuation">,</span> <span class="token punctuation">,</span> population<span class="token punctuation">]</span> <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> <span class="token punctuation">{</span>id<span class="token punctuation">,</span> population<span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Add the population of each country to its data object.</span><br>  <span class="token keyword">const</span> populationById <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> d <span class="token keyword">of</span> population<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    populationById<span class="token punctuation">[</span>d<span class="token punctuation">.</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>population<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> d <span class="token keyword">of</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    d<span class="token punctuation">.</span>population <span class="token operator">=</span> populationById<span class="token punctuation">[</span>d<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">// Create an SVG group containing a path for each country.</span><br>  svg<br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'countries'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span> <span class="token comment">// path is a function that is passed a data object</span><br>    <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'fill'</span><span class="token punctuation">,</span> <span class="token parameter">d</span> <span class="token operator">=></span> <span class="token function">color</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>population<span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'mouseenter'</span><span class="token punctuation">,</span> pathEntered<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> pathMoved<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'mouseout'</span><span class="token punctuation">,</span> hideTooltip<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// This handles when the mouse cursor</span><br><span class="token comment">// enters an SVG path that represent a country.</span><br><span class="token keyword">function</span> <span class="token function">pathEntered</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// Move this path element to the end of its SVG group so it</span><br>  <span class="token comment">// renders on top which allows it's entire stroke is visible.</span><br>  <span class="token keyword">this</span><span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// This handles when the mouse cursor</span><br><span class="token comment">// moves over an SVG path that represent a country.</span><br><span class="token keyword">function</span> <span class="token function">pathMoved</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// Configure the tooltip.</span><br>  tooltipCountry<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>properties<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  tooltipPopulation<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token function">format</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>population<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  tooltip<br>    <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'left'</span><span class="token punctuation">,</span> d3<span class="token punctuation">.</span>event<span class="token punctuation">.</span>pageX <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'top'</span><span class="token punctuation">,</span> d3<span class="token punctuation">.</span>event<span class="token punctuation">.</span>pageY <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Show the tooltip.</span><br>  tooltip<span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'opacity'</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createWorldMap</span><span class="token punctuation">(</span><span class="token parameter">svgId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> svg <span class="token operator">=</span> d3<br>    <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#'</span> <span class="token operator">+</span> svgId<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> <span class="token constant">SVG_WIDTH</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> <span class="token constant">SVG_HEIGHT</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'viewBox'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">0 0 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">SVG_WIDTH</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">SVG_HEIGHT</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token function">panZoomSetup</span><span class="token punctuation">(</span>svgId<span class="token punctuation">,</span> <span class="token constant">SVG_WIDTH</span><span class="token punctuation">,</span> <span class="token constant">SVG_HEIGHT</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Create a function that manages displaying geographical data.</span><br>  <span class="token keyword">const</span> projection <span class="token operator">=</span> d3<br>    <span class="token punctuation">.</span><span class="token function">geoMercator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token constant">MAP_SCALE</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token constant">SVG_WIDTH</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token constant">SVG_HEIGHT</span> <span class="token operator">/</span> <span class="token number">1.41</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Create a function generate a value for the "d" attribute</span><br>  <span class="token comment">// of an SVG "path" element given polygon data.</span><br>  <span class="token keyword">const</span> path <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">geoPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">projection</span><span class="token punctuation">(</span>projection<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token function">load</span><span class="token punctuation">(</span>svg<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h3 id="world-map.css" tabindex="-1">world-map.css</h3><pre class="language-css"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span><br>  <span class="token property">font-family</span><span class="token punctuation">:</span> sans-serif<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.countries > path</span> <span class="token punctuation">{</span><br>  <span class="token property">opacity</span><span class="token punctuation">:</span> 0.8<span class="token punctuation">;</span><br>  <span class="token property">stroke</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span><br>  <span class="token property">stroke-width</span><span class="token punctuation">:</span> 0.3<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.countries > path:hover</span> <span class="token punctuation">{</span><br>  <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span><br>  <span class="token property">stroke</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span><br>  <span class="token property">stroke-width</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span><br>  <span class="token property">z-index</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">svg</span> <span class="token punctuation">{</span><br>  <span class="token property">background-color</span><span class="token punctuation">:</span> linen<span class="token punctuation">;</span><br>  <span class="token property">cursor</span><span class="token punctuation">:</span> move<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.tooltip</span> <span class="token punctuation">{</span><br>  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span><br>  <span class="token property">background</span><span class="token punctuation">:</span> darkgreen<span class="token punctuation">;</span><br>  <span class="token property">border-radius</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span><br>  <span class="token property">color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span><br>  <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span> <span class="token comment">/* initially hidden */</span><br>  <span class="token property">padding</span><span class="token punctuation">:</span> 0.5rem<span class="token punctuation">;</span><br>  <span class="token property">pointer-events</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h3 id="pan-zoom.js" tabindex="-1">pan-zoom.js</h3><p>This supports panning and zooming on any SVG. It does this by modifying its <code>viewBox</code> attribute.</p><pre class="language-js"><code class="language-js"><span class="token comment">// Each pan using the arrow keys pans the SVG by this percentage.</span><br><span class="token keyword">const</span> <span class="token constant">PAN_PERCENT</span> <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">;</span><br><br><span class="token comment">// Each zoom in/out does so by this percentage.</span><br><span class="token keyword">const</span> <span class="token constant">ZOOM_PERCENT</span> <span class="token operator">=</span> <span class="token number">0.15</span><span class="token punctuation">;</span><br><br><span class="token comment">// This maps key names to functions that</span><br><span class="token comment">// should be invoked when they are pressed.</span><br><span class="token keyword">const</span> keyToFnMap <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token string-property property">'+'</span><span class="token operator">:</span> zoomIn<span class="token punctuation">,</span><br>  <span class="token string-property property">'-'</span><span class="token operator">:</span> zoomOut<span class="token punctuation">,</span><br>  <span class="token literal-property property">ArrowLeft</span><span class="token operator">:</span> panLeft<span class="token punctuation">,</span><br>  <span class="token literal-property property">ArrowRight</span><span class="token operator">:</span> panRight<span class="token punctuation">,</span><br>  <span class="token literal-property property">ArrowUp</span><span class="token operator">:</span> panUp<span class="token punctuation">,</span><br>  <span class="token literal-property property">ArrowDown</span><span class="token operator">:</span> panDown<br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">function</span> <span class="token function">addControlButtons</span><span class="token punctuation">(</span><span class="token parameter">svg<span class="token punctuation">,</span> svgWidth<span class="token punctuation">,</span> svgHeight</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">function</span> <span class="token function">addButton</span><span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> html<span class="token punctuation">,</span> onClick</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    parent<br>      <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">onClick</span><span class="token punctuation">(</span>svg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">// This resets the SVG viewBox to its original values</span><br>  <span class="token comment">// which undoes all panning and zooming.</span><br>  <span class="token keyword">function</span> <span class="token function">reset</span><span class="token punctuation">(</span><span class="token parameter">svg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    svg<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'viewBox'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">0 0 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>svgWidth<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>svgHeight<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">const</span> container <span class="token operator">=</span> <span class="token function">getParentSelection</span><span class="token punctuation">(</span>svg<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> controls <span class="token operator">=</span> container<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'controls'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> panDiv <span class="token operator">=</span> controls<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'pan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">let</span> div <span class="token operator">=</span> panDiv<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">addButton</span><span class="token punctuation">(</span>div<span class="token punctuation">,</span> <span class="token string">'&amp;#x25b2;'</span><span class="token punctuation">,</span> panUp<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  div <span class="token operator">=</span> panDiv<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">addButton</span><span class="token punctuation">(</span>div<span class="token punctuation">,</span> <span class="token string">'&amp;#x25c0;'</span><span class="token punctuation">,</span> panLeft<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">addButton</span><span class="token punctuation">(</span>div<span class="token punctuation">,</span> <span class="token string">'&amp;#x21ba;'</span><span class="token punctuation">,</span> reset<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">addButton</span><span class="token punctuation">(</span>div<span class="token punctuation">,</span> <span class="token string">'&amp;#x25b6;'</span><span class="token punctuation">,</span> panRight<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  div <span class="token operator">=</span> panDiv<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">addButton</span><span class="token punctuation">(</span>div<span class="token punctuation">,</span> <span class="token string">'&amp;#x25bc;'</span><span class="token punctuation">,</span> panDown<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  div <span class="token operator">=</span> controls<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'zoom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">addButton</span><span class="token punctuation">(</span>div<span class="token punctuation">,</span> <span class="token string">'&amp;#x2795;'</span><span class="token punctuation">,</span> zoomIn<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">addButton</span><span class="token punctuation">(</span>div<span class="token punctuation">,</span> <span class="token string">'&amp;#x2796;'</span><span class="token punctuation">,</span> zoomOut<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">getParentSelection</span><span class="token punctuation">(</span><span class="token parameter">selection</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> selection<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parentNode<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">panDown</span><span class="token punctuation">(</span><span class="token parameter">svg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">]</span> <span class="token operator">=</span> svg<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'viewBox'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> dy <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token constant">PAN_PERCENT</span><span class="token punctuation">;</span><br>  svg<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'viewBox'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">Number</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">+</span> dy<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>width<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>height<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">panLeft</span><span class="token punctuation">(</span><span class="token parameter">svg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">]</span> <span class="token operator">=</span> svg<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'viewBox'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> dx <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token constant">PAN_PERCENT</span><span class="token punctuation">;</span><br>  svg<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'viewBox'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">Number</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">-</span> dx<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>y<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>width<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>height<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">panRight</span><span class="token punctuation">(</span><span class="token parameter">svg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">]</span> <span class="token operator">=</span> svg<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'viewBox'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> dx <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token constant">PAN_PERCENT</span><span class="token punctuation">;</span><br>  svg<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'viewBox'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">Number</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> dx<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>y<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>width<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>height<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">panUp</span><span class="token punctuation">(</span><span class="token parameter">svg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">]</span> <span class="token operator">=</span> svg<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'viewBox'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> dy <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token constant">PAN_PERCENT</span><span class="token punctuation">;</span><br>  svg<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'viewBox'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">Number</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">-</span> dy<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>width<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>height<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// This zooms in or out depending on whether the shift key is down.</span><br><span class="token keyword">function</span> <span class="token function">zoom</span><span class="token punctuation">(</span><span class="token parameter">svg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> fn <span class="token operator">=</span> d3<span class="token punctuation">.</span>event<span class="token punctuation">.</span>shiftKey <span class="token operator">?</span> zoomOut <span class="token operator">:</span> zoomIn<span class="token punctuation">;</span><br>  <span class="token function">fn</span><span class="token punctuation">(</span>svg<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// This zooms in on the SVG, maintaining the current center.</span><br><span class="token keyword">function</span> <span class="token function">zoomIn</span><span class="token punctuation">(</span><span class="token parameter">svg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">]</span> <span class="token operator">=</span> svg<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'viewBox'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> factor <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">-</span> <span class="token constant">ZOOM_PERCENT</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> newWidth <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span> <span class="token operator">*</span> factor<span class="token punctuation">;</span><br>  <span class="token keyword">const</span> dx <span class="token operator">=</span> <span class="token punctuation">(</span>newWidth <span class="token operator">-</span> width<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> newHeight <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span> <span class="token operator">*</span> factor<span class="token punctuation">;</span><br>  <span class="token keyword">const</span> dy <span class="token operator">=</span> <span class="token punctuation">(</span>newHeight <span class="token operator">-</span> height<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span><br>  svg<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'viewBox'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x <span class="token operator">-</span> dx<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>y <span class="token operator">-</span> dy<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>newWidth<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>newHeight<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// This zooms out on the SVG, maintaining the current center.</span><br><span class="token keyword">function</span> <span class="token function">zoomOut</span><span class="token punctuation">(</span><span class="token parameter">svg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">]</span> <span class="token operator">=</span> svg<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'viewBox'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> factor <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token constant">ZOOM_PERCENT</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> newWidth <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span> <span class="token operator">*</span> factor<span class="token punctuation">;</span><br>  <span class="token keyword">const</span> dx <span class="token operator">=</span> <span class="token punctuation">(</span>newWidth <span class="token operator">-</span> width<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> newHeight <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span> <span class="token operator">*</span> factor<span class="token punctuation">;</span><br>  <span class="token keyword">const</span> dy <span class="token operator">=</span> <span class="token punctuation">(</span>newHeight <span class="token operator">-</span> height<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span><br>  svg<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'viewBox'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x <span class="token operator">-</span> dx<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>y <span class="token operator">-</span> dy<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>newWidth<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>newHeight<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">panZoomSetup</span><span class="token punctuation">(</span><span class="token parameter">svgId<span class="token punctuation">,</span> svgWidth<span class="token punctuation">,</span> svgHeight</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> svg <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'#'</span> <span class="token operator">+</span> svgId<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">let</span> lastX<span class="token punctuation">,</span> lastY<span class="token punctuation">;</span><br><br>  <span class="token comment">// This handles dragging on the SVG to change the visible portion.</span><br>  <span class="token keyword">function</span> <span class="token function">dragged</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> <span class="token punctuation">[</span>boxX<span class="token punctuation">,</span> boxY<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">]</span> <span class="token operator">=</span> svg<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'viewBox'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> <span class="token punctuation">{</span>x<span class="token punctuation">,</span> y<span class="token punctuation">}</span> <span class="token operator">=</span> d3<span class="token punctuation">.</span>event<span class="token punctuation">;</span><br>    <span class="token keyword">const</span> scaleX <span class="token operator">=</span> width <span class="token operator">/</span> svgWidth<span class="token punctuation">;</span><br>    <span class="token keyword">const</span> scaleY <span class="token operator">=</span> height <span class="token operator">/</span> svgHeight<span class="token punctuation">;</span><br>    <span class="token keyword">const</span> dx <span class="token operator">=</span> <span class="token punctuation">(</span>lastX <span class="token operator">-</span> x<span class="token punctuation">)</span> <span class="token operator">*</span> scaleX<span class="token punctuation">;</span><br>    <span class="token keyword">const</span> dy <span class="token operator">=</span> <span class="token punctuation">(</span>lastY <span class="token operator">-</span> y<span class="token punctuation">)</span> <span class="token operator">*</span> scaleY<span class="token punctuation">;</span><br>    lastX <span class="token operator">=</span> x<span class="token punctuation">;</span><br>    lastY <span class="token operator">=</span> y<span class="token punctuation">;</span><br>    svg<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><br>      <span class="token string">'viewBox'</span><span class="token punctuation">,</span><br>      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">Number</span><span class="token punctuation">(</span>boxX<span class="token punctuation">)</span> <span class="token operator">+</span> dx<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">Number</span><span class="token punctuation">(</span>boxY<span class="token punctuation">)</span> <span class="token operator">+</span> dy<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>width<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>height<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">function</span> <span class="token function">dragStarted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    lastX <span class="token operator">=</span> d3<span class="token punctuation">.</span>event<span class="token punctuation">.</span>x<span class="token punctuation">;</span><br>    lastY <span class="token operator">=</span> d3<span class="token punctuation">.</span>event<span class="token punctuation">.</span>y<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">// Create a function that will manage mouse drags on the SVG.</span><br>  <span class="token keyword">const</span> drag <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">drag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">,</span> dragStarted<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'drag'</span><span class="token punctuation">,</span> dragged<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token function">svg</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>drag<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  svg<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'dblclick'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">zoom</span><span class="token punctuation">(</span>svg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Set up event handling for all the keyboard shortcuts in keyToFnMap.</span><br>  d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'keydown'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> fn <span class="token operator">=</span> keyToFnMap<span class="token punctuation">[</span>d3<span class="token punctuation">.</span>event<span class="token punctuation">.</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token function">fn</span><span class="token punctuation">(</span>svg<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token function">addControlButtons</span><span class="token punctuation">(</span>svg<span class="token punctuation">,</span> svgWidth<span class="token punctuation">,</span> svgHeight<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h3 id="pan-zoom.css" tabindex="-1">pan-zoom.css</h3><pre class="language-css"><code class="language-css"><span class="token selector">.controls</span> <span class="token punctuation">{</span><br>  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span><br>  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.controls button</span> <span class="token punctuation">{</span><br>  <span class="token property">--size</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span><br>  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--size<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--size<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.pan</span> <span class="token punctuation">{</span><br>  <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.pan > div</span> <span class="token punctuation">{</span><br>  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span><br>  <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">#reset</span> <span class="token punctuation">{</span><br>  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span><br>  <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><br>  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><br><br>  <span class="token property">font-size</span><span class="token punctuation">:</span> 1.5rem<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.zoom</span> <span class="token punctuation">{</span><br>  <span class="token property">display</span><span class="token punctuation">:</span> inline-flex<span class="token punctuation">;</span><br>  <span class="token property">flex-direction</span><span class="token punctuation">:</span> column<span class="token punctuation">;</span><br>  <span class="token property">margin-left</span><span class="token punctuation">:</span> 0.5rem<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre></article>