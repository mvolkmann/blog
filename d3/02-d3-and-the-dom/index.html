<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><link rel="stylesheet" href="/blog/assets/github-extensions.css"><h2>D3 and the DOM</h2><p>At its core, D3 provides some of the functionality of jQuery for querying and manipulating the DOM. If you have used jQuery, you are familiar with the idea that the <code>$</code> function can be passed a CSS-like selector string and it returns an object that encapsulates zero or more matching DOM elements.</p><p>D3 does something similar in its &quot;Selections&quot; module which is included by default. This adds many methods to the <code>d3</code> object. It also defines the methods available on selection object. Highlights of these methods are provided below.</p><p>For more detail, see the official documentation for the d3-selection module at <a href="https://github.com/d3/d3-selection/blob/v1.4.1/README.md">https://github.com/d3/d3-selection/blob/v1.4.1/README.md</a>.</p><h2>Querying the DOM</h2><h3><code>d3.selectAll(selector)</code></h3><p>This method returns a &quot;selection&quot; that contains a reference to every element that matches a given selector. This is a empty collection if no matches are found. We will talk much more about selections later, but for now you think of them as being like a jQuery object.</p><p>For example, the following line finds all elements that have the CSS class <code>bar</code>, regardless of their nesting level in the document.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> selection <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'.bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>If you use <code>console.log</code> to output <code>selection</code> in the DevTools console, you will see that it is an object that has a <code>_groups</code> property that holds an array of groups. In this case there is only one group. The group is represented by a DOM <code>NodeList</code> that contains references to the each of the DOM elements that have a class of &quot;bar&quot;.</p><h3><code>selection.selectAll(selector)</code></h3><p>This method is similar to <code>d3.selectAll(selector)</code>, but only returns elements that are descendants of elements in the selection.</p><h3><code>d3.select(selector)</code></h3><p>This method is similar to <code>selectAll</code>, but returns a selection that only encapsulates the first matching DOM element.</p><h3><code>selection.select(selector)</code></h3><p>This method is similar to <code>d3.select(selector)</code>, but only returns the first matching element that is a descendant of an element in the selection.</p><h3><code>selection.filter(filter)</code></h3><p>This method creates a new selection that only contains a subset of the elements in the selection. The <code>filter</code> argument can be a selector string or a predicate function. For example, <code>const reds = selection.filter('.red');</code> creates a selection that only contains elements in <code>selection</code> with a class of <code>red</code>. And <code>const small = bars.filter(d =&gt; d &lt; 10);</code> creates a selection that only contains elements with a bound data value that is less than 10. TODO: BUT YOU HAVEN'T TALKED ABOUT DATA BINDING YET!</p><h3><code>selection.merge(otherSelection)</code></h3><p>This method creates a new selection that combines the selection on which it is called with a given selection. For example, <code>const s3 = s1.merge(s2);</code> creates a selection that contains all the elements in both <code>s1</code> and <code>s2</code>.</p><h3><code>d3.style(node, cssPropertyName)</code></h3><p>This method returns the value of a CSS property on a given node. For example, <code>const color = d3.style(node, 'color');</code> returns the value of the CSS property <code>color</code> on <code>node</code>.</p><h2>Modifying the DOM</h2><h3><code>selection.attr(name [, value])</code></h3><p>When only passed an attribute name, this returns the value of that attribute on the first element in the selection. When passed both a name and a value, this sets the attribute to the given value on every element in the selection. The selection is returned to support call chaining.</p><h3><code>selection.classed(classes [, boolean])</code></h3><p>When only passed a string of CSS class names, this returns a boolean indicating whether the first element in the selection has those classes. When passed both a string of CSS class names and a boolean value, those classes are added to all the elements in the selection if the boolean is true, and removed if it is false. The selection is returned to support call chaining.</p><h3><code>selection.style(name [, value])</code></h3><p>When only passed a CSS property name, this returns the current value of that property in the first element of the selection. When passed a CSS property name and a value, this sets that property to the given value for all elements in the selection. If the value is a function, it is invoked once for each element in the selection and is passed the data bound to the element and the element index so that a different value can be computed for each element. The selection is returned to support call chaining.</p><h3><code>selection.property(name, [, value])</code></h3><p>This is similar to <code>selection.attr(name [, value])</code>, but operates on special properties that are not treated as attributes. For example, it can be used on the <code>value</code> of a form element or the <code>checked</code> value of a checkbox.</p><h3><code>selection.text([value])</code></h3><p>When no value is passed, this returns the text content of the first element in the selection. When a value is passed, this sets the text content of every element in the selection. If the value is a function, it is invoked on each element in the selection, is passed the data bound to the element and its index, and returns the text content to be used for the element. The selection is returned to support call chaining.</p><h3><code>selection.html([value])</code></h3><p>This is similar to <code>selection.text([value])</code>, but operates on the inner HTML instead of the text content. The value is parsed as HTML, so it can include character entities that specify Unicode characters, and other HTML strings.</p><h3><code>selection.append(type)</code></h3><p>This appends a new element of the given type (ex. <code>'div'</code>) as the last child of each element in the selection. If it is passed a function instead of a string, the function is invoked for each element in the selection, is passed the data bound to the element and its index, and returns the name of the new element to be appended. This returns a new selection whose update selection contains both the existing elements and the appended elements. This is useful for modifying both sets of elements.</p><h3><code>selection.insert(type [, before])</code></h3><p>This is similar to <code>selection.append(type)</code>, but it inserts a new element before each element in the selection. For detail on the <code>before</code> argument, see the official documentation for the d3-selection module. This returns a new selection containing the inserted elements.</p><h3><code>selection.remove()</code></h3><p>This removes all element in the selection from the document. It returns a new selection containing the removed elements.</p><h3><code>selection.clone([deep])</code></h3><p>This inserts a clone of each element in the selection immediately after each of those elements. If <code>deep</code> is specified and is truthy, descendant elements are also cloned. Otherwise, references to the existing descendant elements are used in the clones.</p><h3><code>selection.sort(comparator)</code></h3><p>This reorders the elements in the selection within the DOM and returns a new selection that contains the elements in the selection sorted based on the comparator function. The comparator function follows the same rules as comparator functions that are used with the JavaScript <code>Array</code> <code>sort</code> method.</p><h3><code>selection.raise()</code></h3><p>This moves each element in the selection to be the last child of its parent.</p><h3><code>selection.lower()</code></h3><p>This moves each element in the selection to be the first child of its parent.</p><h3><code>d3.create(name)</code></h3><p>This creates an element with the given name and returns a selector containing this element. It is not yet attached to any other element.</p><h2>Joining Data</h2><h3><code>selection.data([dataArray [, keyFunction]])</code></h3><p>This binds the values in <code>dataArray</code> to the elements in the selection. It is a fundamental part of understanding D3. There are three possibilities to consider:</p><ol><li>The number of values in <code>dataArray</code> matches the number of elements in <code>selection</code>, so no elements need to be created or removed.</li><li>There are more values in <code>dataArray</code> than there are elements in <code>selection</code>, so more elements need to be created.</li><li>There are fewer values in <code>dataArray</code> than there are elements in <code>selection</code>, so some existing elements need to be removed.</li></ol><p>The <code>data</code> method returns a new selection that contains the properties <code>_groups</code> (the &quot;update&quot; selection), <code>_enter</code> (the &quot;enter&quot; selection), and <code>_exit</code> (the &quot;exit&quot; selection). Each of these sub-selections is an array of arrays where typically the outer array holds a single array.</p><p>From <a href="https://bost.ocks.org/mike/selection/">https://bost.ocks.org/mike/selection/</a>, &quot;Selections returned by <code>d3.select</code> and <code>d3.selectAll</code> have exactly one group. The only way for you to obtain a selection with multiple groups is <code>selection.selectAll</code>.&quot; and &quot;With selectAll, every element in the old selection becomes a group in the new selection; each group contains an old elementâ€™s matching descendant elements.&quot;</p><p>For example:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> tds <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'tr'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">'td'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The variable <code>tds</code> is set to a selection object whose <code>_groups</code> property is set to an array with one member for each <code>tr</code>. Those members are arrays that hold each of the <code>td</code> elements in the corresponding <code>tr</code>.</p><p>The update selection contains elements that were already present in the selection. The enter selection contains placeholders for elements that need to be created. The exit selection contains elements for which no data was bound. The elements in the update and enter selections have a <code>__data__</code> property that holds its bound value.</p><p>For example, suppose <code>selection</code> contains three elements and <code>dataArray</code> contains five values. In the returned selection, the update selection will contain the three existing elements, the enter selection will contain two placeholders, and the exit selection will be empty. The enter selection can be used to append an element for each of the placeholders.</p><p>As another example, suppose <code>selection</code> contains five elements and <code>dataArray</code> contains three values. In the returned selection, the update selection will contain the first three existing elements, the enter selection will be empty, and the exit selection will contain the two elements for which no data value could be bound. The exit selection can be used to remove the excess elements.</p><p>If a <code>keyFunction</code> is not provided, data from <code>dataArray</code> is bound to the elements in <code>selection</code> in the order in which it appears. If a <code>keyFunction</code> is provided,</p><h3><code>selection.join(enter [, update [, exit]])</code></h3><p>This provides an alternative to using the <code>enter</code> and <code>exit</code> methods that many find easier to understand. The arguments are all functions that invoked to handle adding new elements (enter), updating existing elements (update), and removing excess elements (exit). If no exit function is provided, excess elements are removed by default, which is typically the desired behavior.</p><p>The fruit bar chart example demonstrates using the <code>join</code> method.</p><h3>selection.enter</h3><h3>selection.exit</h3><h3>selection.datum</h3><h2>Handling Events</h2><h3>selection.on</h3><h3>selection.dispatch</h3><h3>d3.event</h3><h3>d3.customEvent</h3><h3>d3.mouse</h3><h3>d3.touch</h3><h3>d3.touches</h3><h3>d3.clientPoint</h3><h2>Control Flow</h2><h3>selection.each</h3><h3>selection.call</h3><h3>selection.empty</h3><h3>selection.nodes</h3><h3>selection.node</h3><h3>selection.size</h3><h2>Local Variables</h2><h3>d3.local</h3><h3>local.set</h3><h3>local.get</h3><h3>local.remove</h3><h3>local.toString</h3><hr><p>TODO: Do you want anything below this point?</p><h2>Basic Example</h2><pre class="language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>My D3 Demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://d3js.org/d3.v3.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>This is a paragraph.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>      <span class="token comment">// To change the text in the p element above ...</span><br>      d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'Hello, World!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      <span class="token comment">// To add a p element including text to the body ...</span><br>      d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'Hello, World!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h2>API Basics</h2><p>To select the first occurrence of an element with a given name inside a parent element<br><code>.select(<i>childElementName</i>)`</code></p><p>To select all occurrences of elements with a given name inside a parent element<br><code>.selectAll(<i>childElementName</i>)`</code></p><p>To append a new element with a given name to a parent element<br><code>.append(<i>elementName</i>)`</code></p><p>To set an attribute on an element<br><code>.attr(<i>property</i>, <i>name</i>)`</code></p><p>To get the value of an attribute on an element<br><code>.attr(<i>property</i>&gt;)`</code></p><p>For example, to translate an element such as an SVG <code>g</code>(for group),<br><code>.attr('transform', 'translate(100, 50))`</code></p><p>To set a CSS style property on an element<br><code>.style(<i>property</i>, <i>name</i>)</code></p><p>To add a CSS class to an element<br>// replaces value of class attribute <code>.attr('class', '<i>className</i>')</code> or // updates value of class attribute <code>.classed(<i>className</i>, true)</code></p><p>To set the text content of an element<br><code>.text(<i>textValue</i>, true)</code></p><p>To set the HTML content of an element<br><code>.html(<i>htmlString</i>, true)</code></p><p>For example:</p><p><img src="/blog/assets/d3-dom-basics.png" alt="DOM Basics"></p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>D3 DOM basics<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://d3js.org/d3.v5.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><br>      <span class="token selector">.bordered</span> <span class="token punctuation">{</span><br>        <span class="token property">border</span><span class="token punctuation">:</span> solid orange 3px<span class="token punctuation">;</span><br>        <span class="token property">border-radius</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span><br>        <span class="token property">padding</span><span class="token punctuation">:</span> 0.5rem<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br><br>      <span class="token selector">button</span> <span class="token punctuation">{</span><br>        <span class="token property">font-size</span><span class="token punctuation">:</span> 2rem<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br><br>      <span class="token selector">button:disabled</span> <span class="token punctuation">{</span><br>        <span class="token property">border-color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>      <span class="token keyword">const</span> lockUnicode <span class="token operator">=</span> <span class="token string">'&amp;#x1F512;'</span><span class="token punctuation">;</span><br>      d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'disabled'</span><span class="token punctuation">,</span> <span class="token string">'true'</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">classed</span><span class="token punctuation">(</span><span class="token string">'bordered'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'background-color'</span><span class="token punctuation">,</span> <span class="token string">'cornflowerblue'</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">'color'</span><span class="token punctuation">,</span> <span class="token string">'white'</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'&lt;i>Hello, World!&lt;/i> '</span> <span class="token operator">+</span> lockUnicode<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>