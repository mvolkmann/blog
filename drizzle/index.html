<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Drizzle</h2><aside><nav class="toc"><ol><li><a href="#postgres-example">Postgres Example</a></li><li><a href="#drizzle-studio">Drizzle Studio</a></li></ol></nav></aside><article><style>img {
    border: 1px solid gray;
  }</style><p><img alt="Drizzle logo" style="border: 0; width: 20%" src="/blog/assets/drizzle-logo.png?v=1.1.1"></p><p><a href="https://orm.drizzle.team?v=1.1.1" rel="noopener" target="_blank">Drizzle</a> is a TypeScript-based Object Relational Mapper (ORM) library that is free and open-source. It competes with other popular ORMs such as <a href="https://www.prisma.io?v=1.1.1" rel="noopener" target="_blank">Prisma</a>.</p><p>Drizzle was designed &quot;to be a thin layer on top of SQL and introduce minimal runtime overhead&quot;.</p><p>The methods supported by Drizzle are SQL-like so it doesn't feel like learning a new syntax.</p><p>Queries created with the Drizzle Query API always result in one SQL query. This helps with performance and minimizes round trips to the server.</p><p>The key features of Drizzle include:</p><ul><li><p>lightweight</p></li><li><p>simplicity</p></li><li><p>performance</p></li><li><p>migrations</p></li><li><p>no code generation</p></li><li><p>zero dependencies</p></li><li><p>database support</p><p>Supported databases include LiteFS, MySQL, Neon, PlanetScale, PostgreSQL, SQLite, Supabase, Turso, Vercel Postgres, Web SQLite, and Xata. Notable exceptions include Microsoft SQL Server and MongoDB.</p></li><li><p>edge support</p><p>This includes support for:</p><ul><li><a href="https://bun.sh?v=1.1.1" rel="noopener" target="_blank">Bun</a></li><li><a href="https://developers.cloudflare.com/workers/?v=1.1.1" rel="noopener" target="_blank">Cloudflare Workers</a></li><li><a href="https://deno.com/deploy?v=1.1.1" rel="noopener" target="_blank">Deno Deploy</a></li><li><a href="https://www.electronjs.org?v=1.1.1" rel="noopener" target="_blank">Electron</a></li><li><a href="https://fly.io?v=1.1.1" rel="noopener" target="_blank">Fly.io</a></li><li><a href="https://supabase.com/docs/guides/functions?v=1.1.1" rel="noopener" target="_blank">Supabase functions</a></li><li><a href="https://vercel.com/docs/functions/serverless-functions?v=1.1.1" rel="noopener" target="_blank">Vercel functions</a></li></ul></li></ul><h2 id="postgres-example" tabindex="-1">Postgres Example</h2><p>The schema is entirely defined in TypeScript. It is used to create/migrate tables AND provided type checking in code.</p><ul><li><p>Install PostgreSQL.</p><p>In macOS this can be done using the Homebrew command <code>brew install postgresql</code>. If it has already been installed, it can be upgraded to the latest version by entering <code>brew upgrade postgresql</code>.</p></li><li><p>Start the database server by entering <code>pg_ctl -D /usr/local/pgsql/data start</code></p></li><li><p>Create a database by entering <code>createdb drizzle-demo</code></p></li><li><p>Create a Node.js or Bun project.</p><ul><li>Install Node or Bun.</li><li>Create a directory for the project and cd to it.</li><li>Enter <code>npm init</code> or <code>bun init</code></li></ul></li><li><p>Enter <code>npm install drizzle-orm</code> or <code>bun add drizzle-orm</code></p></li><li><p>Enter <code>npm install pg</code> or <code>bun add pg</code></p></li><li><p>Enter <code>npm install postgres</code> or <code>bun add postgres</code></p></li><li><p>If on macOS and using Bun, enter <code>bun add @esbuild/darwin-x64</code></p></li><li><p>Enter <code>npm install -D drizzle-kit</code> or <code>bun add -d drizzle-kit</code></p></li><li><p>Enter <code>npm install dotenv</code>.</p></li><li><p>Add the following scripts in <code>package.json</code>:</p><pre class="language-json"><code class="language-json">  <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"drizzle-kit build"</span><span class="token punctuation">,</span><br>  <span class="token property">"migrations:generate"</span><span class="token operator">:</span> <span class="token string">"drizzle-kit generate:pg"</span><span class="token punctuation">,</span><br>  <span class="token property">"migrations:push"</span><span class="token operator">:</span> <span class="token string">"drizzle-kit push:pg"</span><span class="token punctuation">,</span><br>  <span class="token property">"migrations:drop"</span><span class="token operator">:</span> <span class="token string">"drizzle-kit drop --config=drizzle.config.ts"</span><span class="token punctuation">,</span><br>  <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"drizzle-kit start"</span><span class="token punctuation">,</span><br>  <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"drizzle-kit test"</span></code></pre></li><li><p>Create the file <code>src/lib/schema.ts</code> containing the following:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>relations<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'drizzle-orm'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>integer<span class="token punctuation">,</span> pgTable<span class="token punctuation">,</span> serial<span class="token punctuation">,</span> text<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'drizzle-orm/pg-core'</span><span class="token punctuation">;</span><br><br><span class="token comment">// To generate migrations for these, enter `bun run migrations:generate`.</span><br><span class="token comment">// To push a migration into the database, enter `bun run migrations:push`.</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> dogs <span class="token operator">=</span> <span class="token function">pgTable</span><span class="token punctuation">(</span><span class="token string">'dogs'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>  id<span class="token operator">:</span> <span class="token function">serial</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">primaryKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  name<span class="token operator">:</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  breed<span class="token operator">:</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'breed'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  ownerId<span class="token operator">:</span> <span class="token function">integer</span><span class="token punctuation">(</span><span class="token string">'owner_id'</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> owners <span class="token operator">=</span> <span class="token function">pgTable</span><span class="token punctuation">(</span><span class="token string">'owners'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>  id<span class="token operator">:</span> <span class="token function">serial</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">primaryKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  name<span class="token operator">:</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> dogsConfig <span class="token operator">=</span> <span class="token function">relations</span><span class="token punctuation">(</span>owners<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>many<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span><br>  dogs<span class="token operator">:</span> <span class="token function">many</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>Create the file <code>drizzle.config.ts</code> containing the following:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span>Config<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'drizzle-kit'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">'dotenv/config'</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><br>  schema<span class="token operator">:</span> <span class="token string">"./src/lib/schema.ts"</span><span class="token punctuation">,</span><br>  out<span class="token operator">:</span> <span class="token string">"./src/migrations"</span><span class="token punctuation">,</span><br>  driver<span class="token operator">:</span> <span class="token string">"pg"</span><span class="token punctuation">,</span><br>  dbCredentials<span class="token operator">:</span> <span class="token punctuation">{</span><br>    connectionString<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DATABASE_URL</span><span class="token punctuation">,</span><br>    host<span class="token operator">:</span> <span class="token string">"localhost"</span><span class="token punctuation">,</span><br>    database<span class="token operator">:</span> <span class="token string">"drizzle-demo"</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span> satisfies Config<span class="token punctuation">;</span><br></code></pre></li><li><p>Generate the first migration by entering <code>npm run migrations:generate</code>. This will create a <code>.sql</code> file in the <code>src/migrations</code> directory.</p></li><li><p>Create the tables described in the schema by entering <code>npm run migrations:push</code>. This will create the tables &quot;dogs&quot;, &quot;dogs_id_seq&quot;, &quot;owners&quot;, and &quot;owners_id_seq&quot;.</p></li></ul><h2 id="drizzle-studio" tabindex="-1">Drizzle Studio</h2><p>TODO: Document this.</p><pre><code>
</code></pre></article>