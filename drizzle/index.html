<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Drizzle</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#pros">Pros</a></li><li><a href="#cons">Cons</a></li><li><a href="#example-project">Example Project</a><ol><li><a href="#create-database">Create Database</a></li><li><a href="#create-project">Create Project</a></li><li><a href="#install-drizzle-and-a-database-client">Install Drizzle and a Database Client</a></li><li><a href="#add-npm-scripts">Add NPM Scripts</a></li><li><a href="#describe-tables">Describe Tables</a></li><li><a href="#configure-drizzle">Configure Drizzle</a></li><li><a href="#generate-initial-migration">Generate Initial Migration</a></li><li><a href="#create-tables">Create Tables</a></li><li><a href="#database-connection">Database Connection</a></li><li><a href="#perform-crud-operations">Perform CRUD Operations</a></li></ol></li><li><a href="#queries">Queries</a></li><li><a href="#query-filtering">Query Filtering</a></li><li><a href="#generating-drizzle-schema">Generating Drizzle Schema</a></li><li><a href="#schema-changes">Schema Changes</a></li><li><a href="#dropping-migrations">Dropping Migrations</a></li><li><a href="#drizzle-studio">Drizzle Studio</a></li></ol></nav></aside><article><style>img {
    border: 1px solid gray;
  }</style><h2 id="overview" tabindex="-1">Overview</h2><p><img alt="Drizzle logo" style="border: 0; width: 20%" src="/blog/assets/drizzle-logo.png?v=1.1.1"> <img alt="Drizzle mascot" style="border: 0; width: 20%" src="/blog/assets/drizzle-mascot.png?v=1.1.1"></p><p><a href="https://orm.drizzle.team?v=1.1.1" rel="noopener" target="_blank">Drizzle</a> is a TypeScript-based Object Relational Mapper (ORM) library that is free and open-source. It competes with other popular ORMs such as <a href="https://www.prisma.io?v=1.1.1" rel="noopener" target="_blank">Prisma</a>.</p><p>Drizzle is designed &quot;to be a thin layer on top of SQL and introduce minimal runtime overhead&quot;.</p><p>Database table schemas are defined entirely in TypeScript. These are used to create/migrate tables AND provide type checking in code.</p><h2 id="pros" tabindex="-1">Pros</h2><p>The Drizzle methods for interacting with databases are SQL-like, so it doesn't feel like learning a new syntax.</p><p>Queries created with the Drizzle Query API always result in one SQL query. This helps with performance and minimizes round trips to the server.</p><p>The Drizzle library is lightweight (32K minified).</p><p>Drizzle is easy to use.</p><p>Drizzle does not require any code generation.</p><p>Drizzle has no dependencies.</p><p>Drizzle supports many databases. These include LiteFS, MySQL, Neon, PlanetScale, PostgreSQL, SQLite, Supabase, Turso, Vercel Postgres, Web SQLite, and Xata. Notable exceptions include Microsoft SQL Server and MongoDB.</p><p>Drizzle can generate TypeScript schema definitions from existing database tables.</p><p>Drizzle supports schema migrations.</p><p>Drizzle supports many edge platforms. These include:</p><ul><li><a href="https://bun.sh?v=1.1.1" rel="noopener" target="_blank">Bun</a></li><li><a href="https://developers.cloudflare.com/workers/?v=1.1.1" rel="noopener" target="_blank">Cloudflare Workers</a></li><li><a href="https://deno.com/deploy?v=1.1.1" rel="noopener" target="_blank">Deno Deploy</a></li><li><a href="https://www.electronjs.org?v=1.1.1" rel="noopener" target="_blank">Electron</a></li><li><a href="https://fly.io?v=1.1.1" rel="noopener" target="_blank">Fly.io</a></li><li><a href="https://supabase.com/docs/guides/functions?v=1.1.1" rel="noopener" target="_blank">Supabase functions</a></li><li><a href="https://vercel.com/docs/functions/serverless-functions?v=1.1.1" rel="noopener" target="_blank">Vercel functions</a></li></ul><h2 id="cons" tabindex="-1">Cons</h2><p>While Drizzle supports many kinds of databases, switching the configuration and code that works with one type to work with another is fairly tedious. There are differences in the configuration and code required for each.</p><p>The current documentation is better for some databases than others. It can be difficult to determine how to correctly configure Drizzle to work with some databases that it claims to support.</p><p>Drizzle would benefit greatly from having a GitHub repo of example projects, one for each supported database/driver combination, that all show the same basic example of configuring access to a one-to-many relationship. This would help developers get started with using Drizzle.</p><p>It would be great if there was a tool that could modify an existing project to switch from one database/driver combination to another.</p><h2 id="example-project" tabindex="-1">Example Project</h2><p>All the example code in this page assumes the use of a PostgreSQL database.</p><p>Two npm packages that can be used to connect to the database are <a href="https://github.com/brianc/node-postgres?v=1.1.1" rel="noopener" target="_blank">pg</a> (aka node-postgres) and <a href="https://github.com/porsager/postgres#connection?v=1.1.1" rel="noopener" target="_blank">postgres</a>.</p><p>When I tried to call Drizzle methods with a database connection that was created with &quot;pg&quot;, I got the error <a href="https://github.com/brianc/node-postgres/issues/3120?v=1.1.1" rel="noopener" target="_blank">TypeError: client.unsafe is not a function</a>. But they work with the &quot;postgres&quot; package.</p><p>When I tried to run drizzle-kit commands using the dialog &quot;postgres&quot;, I got &quot;error: unknown command '*:postgres'&quot;. But they work with the &quot;pg&quot; package.</p><p>What a mess! It seems I need to install and use both packages.</p><h3 id="create-database" tabindex="-1">Create Database</h3><p>For PostgreSQL:</p><ul><li><p>Install PostgreSQL.</p><p>In macOS this can be done using the Homebrew command <code>brew install postgresql</code>. If it has already been installed, it can be upgraded to the latest version by entering <code>brew upgrade postgresql</code>.</p></li><li><p>Start the database server by entering <code>pg_ctl -D /usr/local/pgsql/data start</code></p></li><li><p>Create a database by entering <code>createdb {db-name}</code>. For this example, the database name is &quot;drizzle-demo&quot;.</p></li></ul><p>For SQLite, see <a href="/blog/topics/#/blog/sqlite" target="_blank">SQLite</a> for information on installing it and creating a database.</p><h3 id="create-project" tabindex="-1">Create Project</h3><ul><li>Install Node or Bun.</li><li>Create a directory for the project and cd to it.</li><li>Enter <code>npm init</code> or <code>bun init</code></li><li>Create a <code>src</code> directory.</li><li>If using Node, create the file <code>src/index.mjs</code></li><li>If using Bun, move <code>index.ts</code> to the <code>src</code> directory.</li></ul><h3 id="install-drizzle-and-a-database-client" tabindex="-1">Install Drizzle and a Database Client</h3><ul><li>Enter <code>npm install drizzle-orm</code> or <code>bun add drizzle-orm</code></li><li>Enter <code>npm install -D drizzle-kit</code> or <code>bun add -d drizzle-kit</code></li><li>If using PostgreSQL, enter <code>npm install postgres</code> or <code>bun add postgres</code></li></ul><h3 id="add-npm-scripts" tabindex="-1">Add NPM Scripts</h3><p>Add the following in <code>package.json</code>:</p><pre class="language-json"><code class="language-json">  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"demo"</span><span class="token operator">:</span> <span class="token string">"node src/index.mjs"</span><span class="token punctuation">,</span><br>    <span class="token property">"migrations:generate"</span><span class="token operator">:</span> <span class="token string">"drizzle-kit generate:pg"</span><span class="token punctuation">,</span><br>    <span class="token property">"migrations:pull"</span><span class="token operator">:</span> <span class="token string">"drizzle-kit introspect:pg"</span><span class="token punctuation">,</span><br>    <span class="token property">"migrations:push"</span><span class="token operator">:</span> <span class="token string">"drizzle-kit push:pg"</span><span class="token punctuation">,</span><br>    <span class="token property">"migrations:drop"</span><span class="token operator">:</span> <span class="token string">"drizzle-kit drop --config=drizzle.config.ts"</span><span class="token punctuation">,</span><br>    <span class="token property">"studio"</span><span class="token operator">:</span> <span class="token string">"drizzle-kit studio"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre><p>When using Bun instead of Node, change the <code>demo</code> script to:</p><pre class="language-json"><code class="language-json"><span class="token property">"demo"</span><span class="token operator">:</span> <span class="token string">"bun run src/index.ts"</span><span class="token punctuation">,</span></code></pre><h3 id="describe-tables" tabindex="-1">Describe Tables</h3><p>Create the file <code>src/schema.mjs</code> (Node) or <code>src/schema.ts</code> (Bun) containing the following:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>relations<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'drizzle-orm'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>integer<span class="token punctuation">,</span> pgTable<span class="token punctuation">,</span> serial<span class="token punctuation">,</span> text<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'drizzle-orm/pg-core'</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> dogs <span class="token operator">=</span> <span class="token function">pgTable</span><span class="token punctuation">(</span><span class="token string">'dogs'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>  id<span class="token operator">:</span> <span class="token function">serial</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">primaryKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  name<span class="token operator">:</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  breed<span class="token operator">:</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'breed'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  ownerId<span class="token operator">:</span> <span class="token function">integer</span><span class="token punctuation">(</span><span class="token string">'owner_id'</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> owners <span class="token operator">=</span> <span class="token function">pgTable</span><span class="token punctuation">(</span><span class="token string">'owners'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>  id<span class="token operator">:</span> <span class="token function">serial</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">primaryKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  name<span class="token operator">:</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Drizzle Studio requires relations to be specified in both directions.</span><br><span class="token comment">// In this case that is owners to dogs and dogs to owners.</span><br><span class="token keyword">export</span> <span class="token keyword">const</span> ownersRelations <span class="token operator">=</span> <span class="token function">relations</span><span class="token punctuation">(</span>owners<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>many<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span><br>  dogs<span class="token operator">:</span> <span class="token function">many</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> dogsRelations <span class="token operator">=</span> <span class="token function">relations</span><span class="token punctuation">(</span>dogs<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>one<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span><br>  owner<span class="token operator">:</span> <span class="token function">one</span><span class="token punctuation">(</span>owners<span class="token punctuation">,</span> <span class="token punctuation">{</span><br>    fields<span class="token operator">:</span> <span class="token punctuation">[</span>dogs<span class="token punctuation">.</span>ownerId<span class="token punctuation">]</span><span class="token punctuation">,</span><br>    references<span class="token operator">:</span> <span class="token punctuation">[</span>owners<span class="token punctuation">.</span>id<span class="token punctuation">]</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="configure-drizzle" tabindex="-1">Configure Drizzle</h3><p>Create the file <code>drizzle.config.ts</code> containing the following:</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Config <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"drizzle-kit"</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><br>  schema<span class="token operator">:</span> <span class="token string">"./src/schema.mjs"</span><span class="token punctuation">,</span><br>  out<span class="token operator">:</span> <span class="token string">"./src/migrations"</span><span class="token punctuation">,</span><br>  dbCredentials<span class="token operator">:</span> <span class="token punctuation">{</span><br>    host<span class="token operator">:</span> <span class="token string">"localhost"</span><span class="token punctuation">,</span><br>    database<span class="token operator">:</span> <span class="token string">"drizzle-demo"</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span> satisfies Config<span class="token punctuation">;</span></code></pre><p>When using Bun instead of Node, change the <code>schema</code> value to <code>./src/schema.ts</code>.</p><h3 id="generate-initial-migration" tabindex="-1">Generate Initial Migration</h3><p>Enter <code>npm run migrations:generate</code><br>or <code>bun run migrations:generate</code>.<br>This will create a <code>.sql</code> file in the <code>src/migrations</code> directory.</p><h3 id="create-tables" tabindex="-1">Create Tables</h3><p>Enter <code>npm run migrations:push</code><br>or <code>bun run migrations:push</code>.<br>This will create the tables &quot;dogs&quot;, &quot;dogs_id_seq&quot;, &quot;owners&quot;, and &quot;owners_id_seq&quot;.</p><h3 id="database-connection" tabindex="-1">Database Connection</h3><p>Create the file <code>src/db.mjs</code> (Node) or <code>src/db.ts</code> (Bun) containing the following. This creates a database connection and can be imported into any source file that needs to access the database.</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>drizzle<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'drizzle-orm/postgres-js'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> postgres <span class="token keyword">from</span> <span class="token string">'postgres'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> schema <span class="token keyword">from</span> <span class="token string">'./schema.mjs'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> dbName <span class="token operator">=</span> <span class="token string">'drizzle-demo'</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> dbPrefix <span class="token operator">=</span> <span class="token string">'postgres://postgres:adminadmin@0.0.0.0:5432'</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> connectionString <span class="token operator">=</span> dbPrefix <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> dbName<span class="token punctuation">;</span><br><span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token function">postgres</span><span class="token punctuation">(</span>connectionString<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">drizzle</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> <span class="token punctuation">{</span>schema<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>When using Bun instead of Node, change the schema import path to <code>./schema.ts</code>.</p><h3 id="perform-crud-operations" tabindex="-1">Perform CRUD Operations</h3><p>Change the contents of <code>src/index.mjs</code> (Node) or <code>src/index.ts</code> (Bun) to the following and run it by entering <code>npm run demo</code>.</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>eq<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'drizzle-orm'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>dogs<span class="token punctuation">,</span> owners<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./schema.mjs'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>db<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./db.mjs'</span><span class="token punctuation">;</span><br><br><span class="token comment">// Delete all records from the tables.</span><br><span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>owners<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Insert new rows in the owners table.</span><br><span class="token keyword">let</span> results <span class="token operator">=</span> <span class="token keyword">await</span> db<br>  <span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>owners<span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Tami'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">returning</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span> owners<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> tamiId <span class="token operator">=</span> results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span><br><br>results <span class="token operator">=</span> <span class="token keyword">await</span> db<br>  <span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>owners<span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Amanda'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">returning</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span> owners<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> amandaId <span class="token operator">=</span> results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span><br><br><span class="token comment">// Insert new rows in the dogs table.</span><br><span class="token keyword">await</span> db<br>  <span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Comet'</span><span class="token punctuation">,</span> <span class="token literal-property property">breed</span><span class="token operator">:</span> <span class="token string">'Greyhound'</span><span class="token punctuation">,</span> <span class="token literal-property property">ownerId</span><span class="token operator">:</span> tamiId<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">[</span><br>  <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Maisey'</span><span class="token punctuation">,</span> <span class="token literal-property property">breed</span><span class="token operator">:</span> <span class="token string">'Treeing Walker Coonhound'</span><span class="token punctuation">,</span> <span class="token literal-property property">ownerId</span><span class="token operator">:</span> amandaId<span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Ramsay'</span><span class="token punctuation">,</span> <span class="token literal-property property">breed</span><span class="token operator">:</span> <span class="token string">'Native American Indian Dog'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Oscar'</span><span class="token punctuation">,</span> <span class="token literal-property property">breed</span><span class="token operator">:</span> <span class="token string">'German Shorthaired Pointer'</span><span class="token punctuation">,</span> <span class="token literal-property property">ownerId</span><span class="token operator">:</span> amandaId<span class="token punctuation">}</span><br><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Modify a row in the dogs table.</span><br><span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">breed</span><span class="token operator">:</span> <span class="token string">'Whippet'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token function">eq</span><span class="token punctuation">(</span>dogs<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">'Comet'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Delete a row from the dogs table.</span><br><span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token function">eq</span><span class="token punctuation">(</span>dogs<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">'Ramsay'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Get all dogs.</span><br>results <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span><span class="token punctuation">;</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'All Dogs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> result <span class="token keyword">of</span> results<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Get dogs owned by Amanda.</span><br>results <span class="token operator">=</span> <span class="token keyword">await</span> db<br>  <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>dogs<span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">innerJoin</span><span class="token punctuation">(</span>owners<span class="token punctuation">,</span> <span class="token function">eq</span><span class="token punctuation">(</span>owners<span class="token punctuation">.</span>id<span class="token punctuation">,</span> dogs<span class="token punctuation">.</span>ownerId<span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token function">eq</span><span class="token punctuation">(</span>owners<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">'Amanda'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"\nAmanda's Dogs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> result <span class="token keyword">of</span> results<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>dogs<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br>process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Why needed?</span></code></pre><h2 id="queries" tabindex="-1">Queries</h2><p>Drizzle provides three methods for querying tables.</p><ul><li><code>db.select([options]).from({table}).where({filter})</code></li><li><code>db.query.{table}.findFirst([options])</code></li><li><code>db.query.{table}.findMany([options])</code></li></ul><h2 id="query-filtering" tabindex="-1">Query Filtering</h2><p>The <code>drizzle-orm</code> module provides the following methods that can be used to filter query results:</p><ul><li><code>and</code></li><li><code>between</code> - numeric range</li><li><code>eq</code></li><li><code>gt</code></li><li><code>gte</code></li><li><code>inArray</code></li><li><code>isNotNull</code></li><li><code>isNull</code></li><li><code>like</code> - pattern match</li><li><code>lt</code></li><li><code>lte</code></li><li><code>ne</code></li><li><code>not</code></li><li><code>notBetween</code> - numeric range</li><li><code>notInArray</code></li><li><code>notLike</code> - pattern match</li><li><code>or</code></li><li><code>references</code> - for foreign keys</li></ul><p>For example, the following query gets all users whose full name includes &quot;olk&quot; and are at least 50 years old.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span><br>  <span class="token punctuation">.</span>db<br>  <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token function">like</span><span class="token punctuation">(</span>users<span class="token punctuation">.</span>fullName<span class="token punctuation">,</span> <span class="token string">"%olk%"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">gte</span><span class="token punctuation">(</span>users<span class="token punctuation">.</span>age<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="generating-drizzle-schema" tabindex="-1">Generating Drizzle Schema</h2><p>When there is an existing database, a Drizzle schema file that describes all the tables in it can be generated with the command <code>drizzle-kit introspect</code>. The path to the generated file is <code>src/migrations/schema.ts</code>.</p><p>The generated code does not include definitions of relations between tables. Unfortunately those need to be added manually.</p><p>This command is often run from a script in <code>package.json</code> that is defined as:</p><pre class="language-json"><code class="language-json"><span class="token property">"migrations:pull"</span><span class="token operator">:</span> <span class="token string">"drizzle-kit introspect:pg"</span><span class="token punctuation">,</span></code></pre><p>Enter <code>npm run migrations:pull</code> to run this.</p><h2 id="schema-changes" tabindex="-1">Schema Changes</h2><p>To modify the schema for any of the tables:</p><ol><li>Modify <code>src/lib/schemas.mjs</code>.</li><li>Enter <code>npm run migrations:generate</code> to generate a new <code>.sql</code> file in <code>src/migrations</code> directory.</li><li>Enter <code>npm run migrations:push</code> to apply the schema changes to the database.</li></ol><h2 id="dropping-migrations" tabindex="-1">Dropping Migrations</h2><p>The <code>drizzle-kit drop</code> command prompts for a <code>.sql</code> file in the <code>src/migrations</code> directory to delete and then deletes it. This is preferable to manually deleting the file because doing so can break subsequent <code>drizzle-kit</code> commands.</p><p>WARNING: This does not undo changes made by the migration!</p><p>Drizzle does not provide a mechanism for rolling back applied migrations. To do that, create a new migration that reverses the changes and apply it.</p><p>To iterate on schema changes in a development environment without creating a new migration <code>.sql</code> file for the changes, skip the use of <code>npm run migrations:generate</code> and just use <code>npm run migrations:push</code>. This syncs your schema with the database schema directly.</p><h2 id="drizzle-studio" tabindex="-1">Drizzle Studio</h2><p>Drizzle Studio is a web-based database browser. To view it:</p><ol><li>Enter <code>npm run studio</code><br>or <code>bun run studio</code></li><li>Browse <a href="https://local.drizzle.studio">https://local.drizzle.studio</a></li></ol><p>As of January 2024 this was still in beta. It was fine for browsing data, but had issues with updating and adding data.</p></article>