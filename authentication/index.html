<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Authentication</h2><aside><nav class="toc"><ol><li><a href="#local-ssl-setup">Local SSL Setup</a></li></ol></nav></aside><article><p>This page describes an approach for implementing web-based authentication from scratch, not using libraries. This is useful for understanding all the underlying steps or implementing a custom authentication approach.</p><p>Encryption typically encodes data using a key and an algorithm. The data can be decoded if the key and algorithm are known.</p><p>Hashing is a one-way encoding of data. While it is possibly given sufficient computing power to recover the original data, doing so is very difficult. This is often used to store passwords in a database. Commonly used hashing algorithms include MD4, MD5, and SHA (Security Hashing Algorithm).</p><p>Salting makes data more secure by adding &quot;salt&quot; to the data to be encrypted or hashed. Often a fixed string is added to the beginning, end, or both ends of the data.</p><p>Passing user names, passwords, and email addresses from browsers to servers in plain text can be made safe by using HTTPS.</p><p><code>npm install bcryptjs</code> <code>npm install fastify</code> <code>npm install fastify-cookie</code> <code>npm install fastify-cors</code> <code>npm install jsonwebtoken</code> <code>npm install nodemailer</code></p><p>HTTP-only cookies can only be created by a server and can only be retrieved by the server that created them. They can be made secure and can expire after a given amount of time. Like other cookies, DevTools can see that they exists, but their values are not available. In addition, browser extensions cannot access them.</p><p>A JSON Web Token (JWT) encapsulates encoded information in a token that can be passed to and from servers. The data is not encrypted, so it should not contain sensitive data. It is comprised of three parts, a header, payload, and a signature. The header specifies the algorithm used to encode the data. The payload holds the data as a JSON string. Often this includes a user id and session id. The signature provides information required to decode the data.</p><p>Logging in can create a session that maintains data until the end of the session.</p><p>&quot;Access tokens&quot; are JWTs that are used to indicate that a given user has been authenticated. They often contain a user id, session id, and role information. They are only valid for the current session and typically has a short lifetime.</p><p>&quot;Refresh tokens&quot; are JWTs that typically only contains a session id. They have a longer lifetime than access tokens. When an access token expires, a web application can use a refresh token to request a new access token. This only works if the session is still valid. Site administrators can revoke sessions to prevent this.</p><h2 id="local-ssl-setup">Local SSL Setup</h2><p>In macOS, edit the &quot;hosts&quot; file by entering <code>sudo vim /etc/hosts</code>. Then add the following lines:</p><pre class="language-text"><code class="language-text">127.0.0.1 nodeauth.dev<br>127.0.0.1 api.nodeauth.dev</code></pre><p>Caddy is a local server that is implemented in Go and supports HTTPS. Browse <a href="https://caddyserver.com?v=1.0.14" rel="noopener" target="_blank">caddyserver.com</a> for installation instructions. In macOS this can be installed by installing Homebrew and entering <code>brew install caddy</code> and <code>brew install nss</code>. Create the file <code>Caddyfile</code> in the project root directory containing the following:</p><pre class="language-text"><code class="language-text">{<br>  http_port 81<br>  local_certs<br>}<br><br># This is for the UI server.<br>nodeauth.dev {<br>  reverse_proxy 127.0.0.1:5000<br>}<br><br># This is for the API server.<br># Why is it important for this to be a subdomain of the UI server?<br>api.nodeauth.dev {<br>  reverse_proxy 127.0.0.1:1919<br>}</code></pre><p>To start the Caddy server, cd to the project root directory and enter <code>caddy run</code>.</p><p>To stop the Caddy server, press ctrl-c or enter <code>caddy stop</code> in another terminal window.</p><p>To reload changes to <code>Caddyfile</code> in a running server, enter <code>caddy reload</code> in another terminal window.</p></article>