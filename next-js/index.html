<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Next.js</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#getting-started">Getting Started</a></li><li><a href="#tailwind">Tailwind</a></li><li><a href="#modifying-app">Modifying App</a></li><li><a href="#page-components">Page Components</a></li><li><a href="#non-page-components">Non-page Components</a></li><li><a href="#static-resources">Static Resources</a></li><li><a href="#client-vs.-server-components">Client vs. Server Components</a></li><li><a href="#layouts">Layouts</a></li><li><a href="#data-fetching">Data Fetching</a></li><li><a href="#error-pages">Error Pages</a></li><li><a href="#page-metadata">Page Metadata</a></li><li><a href="#hyperlinks">Hyperlinks</a></li><li><a href="#import-aliases">Import Aliases</a></li><li><a href="#dynamic-routes">Dynamic Routes</a></li><li><a href="#not-found-pages">Not Found Pages</a></li><li><a href="#custom-types">Custom Types</a></li><li><a href="#generating-static-pages">Generating Static Pages</a></li><li><a href="#server-routes">Server Routes</a></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p><a href="https://nextjs.org?v=1.0.21" rel="noopener" target="_blank">Next.js</a> is a full-stack web framework built on React.</p><p>Next.js uses <a href="https://turbo.build/pack?v=1.0.21" rel="noopener" target="_blank">Turbopack</a> rather than Vite as its module bundler. Turbopack bills itself as the &quot;Rust-powered successor to Webpack&quot;. It claims to be 10 times faster than Vite and 700 times faster than Webpack.</p><p>Next.js supports the following features:</p><ul><li><p>server-side rendering (SSR)</p><p>This improves first render efficiency and search engine optimization (SEO). JavaScript is hydrated in the client.</p></li><li><p>static site generation (SSG) at build time and on request</p></li><li><p>code splitting</p></li><li><p>prefetching</p><p>In dev mode this occurs when hovering over a link. In prod mode this occurs for all links on a page when the page is loaded. To run in prod mode, enter <code>npm run build</code> and <code>npm run start</code>.</p></li><li><p>serverless functions</p></li></ul><p>Next.js requires Node.js 16.8 or later.</p><h2 id="getting-started" tabindex="-1">Getting Started</h2><p>To create a new Next.js project, enter <code>npx create-next-app@latest</code>. This will ask a series of questions and produce output similar to what is shown below.</p><pre class="language-text"><code class="language-text">npx create-next-app@latest<br>Need to install the following packages:<br>  create-next-app@13.4.13<br>Ok to proceed? (y)<br>✔ What is your project named? … todo<br>✔ Would you like to use TypeScript? … No / Yes<br>✔ Would you like to use ESLint? … No / Yes<br>✔ Would you like to use Tailwind CSS? … No / Yes<br>✔ Would you like to use `src/` directory? … No / Yes<br>✔ Would you like to use App Router? (recommended) … No / Yes<br>✔ Would you like to customize the default import alias? … No / Yes<br>Creating a new Next.js app in /Users/volkmannm/todo.<br><br>Using npm.<br><br>Initializing project with template: app-tw<br><br>Installing dependencies:<br>- react<br>- react-dom<br>- next<br>- typescript<br>- @types/react<br>- @types/node<br>- @types/react-dom<br>- tailwindcss<br>- postcss<br>- autoprefixer<br>- eslint<br>- eslint-config-next</code></pre><p>Cd to the new project directory. It will contain a <code>package.json</code> file that defines the following scripts:</p><pre class="language-json"><code class="language-json">    <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"next dev"</span><span class="token punctuation">,</span><br>    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"next build"</span><span class="token punctuation">,</span><br>    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"next start"</span><span class="token punctuation">,</span><br>    <span class="token property">"lint"</span><span class="token operator">:</span> <span class="token string">"next lint"</span></code></pre><p>To start a local web server for running the app, enter <code>npm run dev</code>. Then browse <code>localhost:3000</code>.</p><p>See the provided <code>README.md</code> file in each project for more detail.</p><h2 id="tailwind" tabindex="-1">Tailwind</h2><p>To configure the use of Tailwind in a Next.js project, see <a href="https://tailwindcss.com/docs/guides/nextjs?v=1.0.21" rel="noopener" target="_blank">Install Tailwind CSS with Next.js</a>. These steps should not be necessary if you opted into use of Tailwind when the project was created.</p><h2 id="modifying-app" tabindex="-1">Modifying App</h2><p>Begin by modifying <code>src/app/page.tsx</code>.</p><h2 id="page-components" tabindex="-1">Page Components</h2><p>The &quot;app&quot; directory holds source files that define page components. The directory structure maps directly to the URLs used to access the pages.</p><p>To add a new page, create a directory in <code>src/app</code> whose name is the route name and create the file <code>page.tsx</code> (or <code>page.js</code>) inside that directory.</p><p>While the file must have the name &quot;page&quot;, the name of the function that defines the page component should reflect the route name. For example, &quot;TodoPage&quot;. Adding the name suffix &quot;Page&quot; is often useful when TypeScript is being used because there will likely be a custom type named &quot;Page.</p><p>In React, unlike in Svelte, the JSX returned by a component can be split into related pieces by writing functions that return snippets of JSX. Often this makes the code easier to read and understand.</p><h2 id="non-page-components" tabindex="-1">Non-page Components</h2><p>Components used by page components can be defined in two places. Page-specific components can be defined in the same directory as the page that uses them. Components that can potentially be reused across multiple pages should be placed in a top-level directory named &quot;components&quot;.</p><h2 id="static-resources" tabindex="-1">Static Resources</h2><p>Static resources like images are typically placed in a top-level &quot;public&quot; directory. This directory can have subdirectories such as &quot;images&quot;.</p><h2 id="client-vs.-server-components" tabindex="-1">Client vs. Server Components</h2><p>Components that perform data fetching through HTTP requests are considered to be &quot;server&quot; components. By default, components are server components.</p><p>Components that contain client-side logic like DOM event handling are considered to be &quot;client&quot; components. Their source files must begin with <code>'use client';</code>.</p><p>Client components cannot send HTTP requested and server components cannot perform DOM event handling. Sometimes both are needed. A solution is to use client components inside server components.</p><h2 id="layouts" tabindex="-1">Layouts</h2><p>The file <code>app/layout.tsx</code> defines the layout for all pages in the app. Additional <code>layout.tsx</code> files in page route directories define the layout for all pages at specific URL routes. These are nested inside the main layout.</p><h2 id="data-fetching" tabindex="-1">Data Fetching</h2><p>Components can use the fetch API to send API requests. These can fetch data that is then presented in a page.</p><p>The following code is an example of a function that fetches data:</p><pre class="language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>Todo<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'https://jsonplaceholder.typicode.com/todosx'</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Throwing an error triggers the error boundary</span><br>  <span class="token comment">// defined in error.ts.</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Failed to fetch todos.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>Functions like the one above can be defined in the source files of components that use them. They can also be defined in separate source files, often in the top-level &quot;lib&quot; directory, and imported where needed.</p><p>A component can call a data fetching function as follows:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token literal-property property">todos</span><span class="token operator">:</span> Todo<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Sometimes it is convenient to call such a function in multiple places. This will not result in duplicate fetches. Next.js will automatically cache the result of the first call and use it for the result of subsequent calls.</p><p>To cause cached results to expire after a given number of seconds, add an option to the <code>fetch</code> call. For example:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">next</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">revalidate</span><span class="token operator">:</span> <span class="token number">60</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>To cause all <code>fetch</code> calls made from a given page to expire after a given number of seconds, add the following:</p><pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">const</span> revalidate <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">;</span></code></pre><h2 id="error-pages" tabindex="-1">Error Pages</h2><p>Error pages are rendered when an error is thrown from a page component. A common example is errors that occur when fetching data.</p><p>Error pages wrap the page in a &quot;React Error Boundary&quot; and must be written in a specific way that differs from normal components. See <a href="https://nextjs.org/docs/app/building-your-application/routing/error-handling?v=1.0.21" rel="noopener" target="_blank">Error Handling</a>.</p><h2 id="page-metadata" tabindex="-1">Page Metadata</h2><p>To add static metadata such as title and description to a page:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> type <span class="token punctuation">{</span>Metadata<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next'</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token literal-property property">metadata</span><span class="token operator">:</span> Metadata <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'some title'</span><span class="token punctuation">,</span> <span class="token comment">// results in &lt;title> in &lt;head></span><br>  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'some description'</span> <span class="token comment">// results in &lt;meta> in &lt;head></span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>Older versions of Next.js used <code>head.tsx</code> files to specify these. These define a component that renders a fragment containing elements to add as children of the <code>&lt;head&gt;</code> element.</p><h2 id="hyperlinks" tabindex="-1">Hyperlinks</h2><p>To add hyperlinks to a page:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">'next/Link'</span><span class="token punctuation">;</span><br><br><span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">"some-url"</span><span class="token operator">></span>link text<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">></span><span class="token punctuation">;</span></code></pre><h2 id="import-aliases" tabindex="-1">Import Aliases</h2><p>Import statements can use paths that begin with the character <code>@</code> to specify a path that begins at the root of the project rather than being relative to the current directory. See <a href="https://nextjs.org/docs/app/building-your-application/configuring/absolute-imports-and-module-aliases#module-aliases?v=1.0.21" rel="noopener" target="_blank">Module Aliases</a>.</p><h2 id="dynamic-routes" tabindex="-1">Dynamic Routes</h2><p>Dynamic routes are pages whose URLs contain path parameters that are used to render the page. For example, the path parameter can be the ID of an object whose data should be rendered.</p><p>Path parameters are represented in the directory structure below the <code>app</code> directory with directories whose names begin with <code>[</code> and end with <code>]</code>. The name between the square brackets is the parameter name.</p><p>For example, suppose we want to render the todo with a given id using the URL <code>/todo/{id}</code>. We would create the directory <code>app/todo/[id]</code> and create the file <code>page.tsx</code> inside it. The follow code could be in this file:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">'next/link'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span>getTodos<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/lib/apis'</span><span class="token punctuation">;</span><br><br>type Params <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">id</span><span class="token operator">:</span> number<br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">TodoPage</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>id<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">:</span> Params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token literal-property property">todos</span><span class="token operator">:</span> Todo<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// The param properties are always strings.</span><br>  <span class="token keyword">const</span> number <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> todo <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=></span> t<span class="token punctuation">.</span>id <span class="token operator">===</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">return</span> <span class="token punctuation">(</span><br>    <span class="token operator">&lt;</span>section<span class="token operator">></span><br>      <span class="token operator">&lt;</span>h1<span class="token operator">></span>Todo<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><br>      <span class="token operator">&lt;</span>p<span class="token operator">></span>Id<span class="token operator">:</span> <span class="token punctuation">{</span>todo<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><br>      <span class="token operator">&lt;</span>p<span class="token operator">></span>Title<span class="token operator">:</span> <span class="token punctuation">{</span>todo<span class="token operator">?.</span>title <span class="token operator">??</span> <span class="token string">'missing title'</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><br>      <span class="token operator">&lt;</span>p<span class="token operator">></span>Completed<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token function">String</span><span class="token punctuation">(</span>todo<span class="token punctuation">.</span>completed<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><br>      <span class="token operator">&lt;</span>Link href<span class="token operator">=</span><span class="token string">"/todos"</span><span class="token operator">></span>Back<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">></span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">></span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><h2 id="not-found-pages" tabindex="-1">Not Found Pages</h2><p>The return value of the <code>notFound</code> function can be returned from a component when data it needs is not found. For example, suppose we can't find a todo item with a specific id. We could handle that as follows:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> notFound <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/navigation'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> getTodos <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/lib/apis'</span><span class="token punctuation">;</span><br><br>type Params <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">id</span><span class="token operator">:</span> number<br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">TodoPage</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token operator">:</span> Params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// params properties are always strings.</span><br>  <span class="token keyword">const</span> number <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> <span class="token literal-property property">todos</span><span class="token operator">:</span> Todo<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> todo <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=></span> t<span class="token punctuation">.</span>id <span class="token operator">===</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>todo<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">notFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">return</span> <span class="token punctuation">(</span><br>    <span class="token operator">...</span> content when found <span class="token operator">...</span><br>  <span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre><h2 id="custom-types" tabindex="-1">Custom Types</h2><p>Custom TypeScript types can be defined in many places. One option is to create the top-level file <code>types.d.ts</code> and define all custom types used by a project there. This file is automatically imported, so any source file in the project can use the types without importing them.</p><h2 id="generating-static-pages" tabindex="-1">Generating Static Pages</h2><p>To generate static pages (SSG) that use path parameters at build time, define and export the <code>generateStaticParams</code> function. This only works if the <code>dynamicParams</code> configuration option is set to <code>true</code>, which it is by default. This function should return an array of objects. TODO: How does it know which pages to generate? The generated pages can still be generated again at runtime using the <code>revalidate</code> option described in the &quot;Data Fetching&quot; section.</p><h2 id="server-routes" tabindex="-1">Server Routes</h2><p>REST APIs can be implemented by defining server routes in files without the &quot;pages/api&quot; directory. CORRECT?</p></article>