<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>Svelte and Storybook</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#storybook-with-svelte">Storybook with Svelte</a></li><li><a href="#adding-controls">Adding Controls</a></li><li><a href="#static-deploy">Static Deploy</a></li><li><a href="#conclusion">Conclusion</a></li></ol></nav></aside><article><h2 id="overview">Overview</h2><p>When developing web applications it is useful to be able to render a single component rather than run the entire app. This is especially true when the component does not appear on the first rendered page. For example, suppose we are developing a shopping app with the typical flow of login, add products to cart, and checkout. While developing a component that appears on the checkout page it is tedious to have to retrace all of these steps in order to test changes to the new component.</p><p><a href="https://storybook.js.org">Storybook</a> solves this! It provides a web UI where a list of components in various states appear in the left nav. Clicking one renders only that component in the main area where we can interact with it in all the ways it supports. It also provides a nice way to demo each component to stakeholders and focus on the design and styling of each component.</p><h2 id="storybook-with-svelte">Storybook with Svelte</h2><p>Storybook can be used with many web frameworks. Let's dive into how it can be used with Svelte, appropriate as I'm the author of the Manning book <a href="https://www.manning.com/books/svelte-and-sapper-in-action">Svelte and Sapper in Action</a>. Detailed instructions for using Storybook with Svelte components can be found in the Storybook documentation at <a href="https://storybook.js.org/docs/guides/guide-svelte/">https://storybook.js.org/docs/guides/guide-svelte/</a>.</p><p>To add the use of Storybook to an existing Svelte application, <code>cd</code> to the top application directory and enter <code>npx -p @storybook/cli sb init --type svelte</code>. This takes a couple of minutes to complete and results in the following changes:</p><ul><li><p>It installs all the development dependencies needed by Storybook.</p></li><li><p>It adds the following npm scripts in <code>package.json</code>:</p><pre class="language-json"><code class="language-json"><span class="token property">"storybook"</span><span class="token operator">:</span> <span class="token string">"start-storybook"</span><span class="token punctuation">,</span><br><span class="token property">"build-storybook"</span><span class="token operator">:</span> <span class="token string">"build-storybook"</span></code></pre></li><li><p>It creates the <code>.storybook</code> directory, which contains the <code>addons.js</code> file that registers the use of Storybook actions and links. Actions provide a way to log user interactions, such as a certain button being pressed. Links provide a way to add links in stories that can be clicked to navigate to other stories, as an alternative to clicking a link in the left nav.</p><p>This directory also contains the <code>config.js</code> file that configures the use of Storybook to automatically import all files found in the <code>stories</code> directory whose names end with <code>.stories.js</code>.</p></li><li><p>It creates the <code>stories</code> directory, which contains the <code>button.svelte</code> file that defines a simple Svelte component. It also contains the <code>index.stories.js</code> file that registers the <code>Button</code> component with Storybook. These files just provide an example of registering a component with Storybook. Typically source files for the components being demonstrated are found in the <code>src</code> directory rather than the <code>stories</code> directory.</p></li></ul><p>The supplied <code>Button</code> component dispatches an event when it is clicked. The <code>index.stories.js</code> file listens for the event and calls the <code>action</code> function that it imports from <code>@storybook/addon-actions</code>. Strings passed to the <code>action</code> function are logged at the bottom of the main section of the Storybook UI. The Clear button in the lower-right corner of the Actions area clears the list of logged actions.</p><p>To run Storybook locally, enter <code>npm run storybook</code>.</p><p>To add components to Storybook, add one <code>.stories.js</code> file for each component in the <code>stories</code> directory. These files should be similar to the provided <code>index.stories.js</code> file.</p><p>Each story renders a component in a different state. It is common for a <code>.stories.js</code> file to define multiple stories that render the same component in different states. Each state has a name that is displayed in the left nav below the component name. The two states for the provided <code>Button</code> component are &quot;Text&quot; and &quot;Emoji&quot;.</p><p>When new <code>.stories.js</code> files are created, refresh the browser where Storybook is running to see them in the left nav. When an existing <code>.stories.js</code> file is modified, Storybook automatically detects the changes and displays the modified story at the bottom of the left nav.</p><p>Letâ€™s create a new Svelte component and implement some Storybook stories for it! Start by entering the following commands:</p><pre class="language-bash"><code class="language-bash">npx degit sveltejs/template storybook-demo<br><span class="token builtin class-name">cd</span> storybook-demo<br><span class="token function">npm</span> <span class="token function">install</span><br>npx sb init</code></pre><p>Add the file <code>src/Pie.svelte</code> containing the code below. This component renders a progress indicator in the form of a pie chart. It uses SVG to drag the pie and takes advantage of the Svelte <code>tweened</code> function to animate changes to the value.</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">import</span> <span class="token punctuation">{</span>tweened<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'svelte/motion'</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">export</span> <span class="token keyword">let</span> bgColor <span class="token operator">=</span> <span class="token string">'tan'</span><span class="token punctuation">;</span><br>  <span class="token keyword">export</span> <span class="token keyword">let</span> fgColor <span class="token operator">=</span> <span class="token string">'blue'</span><span class="token punctuation">;</span><br>  <span class="token keyword">export</span> <span class="token keyword">let</span> size <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span><br>  <span class="token keyword">export</span> <span class="token keyword">let</span> value<span class="token punctuation">;</span> <span class="token comment">// 0 to 100</span><br><br>  <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">tweened</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token punctuation">{</span>duration<span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  $<span class="token operator">:</span> half <span class="token operator">=</span> size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span><br>  $<span class="token operator">:</span> viewBox <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">0 0 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>size<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>size<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>  $<span class="token operator">:</span> circumference <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> half<span class="token punctuation">;</span><br><br>  <span class="token keyword">let</span> dashArray <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br><br>  $<span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> v <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    store<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> dash <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">*</span> circumference<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span><br>    dashArray <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>circumference <span class="token operator">-</span> dash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{size}<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{size}<span class="token punctuation">"</span></span> <span class="token attr-name">{viewBox}</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>circle</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bg<span class="token punctuation">"</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{bgColor}<span class="token punctuation">"</span></span> <span class="token attr-name">r</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{half}<span class="token punctuation">"</span></span> <span class="token attr-name">cx</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{half}<span class="token punctuation">"</span></span> <span class="token attr-name">cy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{half}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>  &lt;circle class="fg" r={half / 2} cx={half} cy={half} fill="transparent"<br>  stroke={fgColor} stroke-width={half} stroke-dasharray={dashArray} /><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><br>  <span class="token selector">svg</span> <span class="token punctuation">{</span><br>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>-90deg<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre><p>Add the file <code>src/stories/Pie.stories.js</code> containing the following which renders the <code>Pie</code> component with the values 0, 30, 90, and 100:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> Pie <span class="token keyword">from</span> <span class="token string">'../Pie.svelte'</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><br>  title<span class="token operator">:</span> <span class="token string">'Pie'</span><span class="token punctuation">,</span><br>  component<span class="token operator">:</span> Pie<span class="token punctuation">,</span><br>  argTypes<span class="token operator">:</span> <span class="token punctuation">{</span><br>    value<span class="token operator">:</span> <span class="token punctuation">{</span>control<span class="token operator">:</span> <span class="token string">'number'</span><span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">Template</span> <span class="token operator">=</span> <span class="token parameter">props</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span><br>  Component<span class="token operator">:</span> Pie<span class="token punctuation">,</span><br>  props<br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> Pie0 <span class="token operator">=</span> <span class="token function">Template</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>Pie0<span class="token punctuation">.</span>args <span class="token operator">=</span> <span class="token punctuation">{</span>value<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> Pie30 <span class="token operator">=</span> <span class="token function">Template</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>Pie30<span class="token punctuation">.</span>args <span class="token operator">=</span> <span class="token punctuation">{</span>value<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> Pie90 <span class="token operator">=</span> <span class="token function">Template</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>Pie90<span class="token punctuation">.</span>args <span class="token operator">=</span> <span class="token punctuation">{</span>value<span class="token operator">:</span> <span class="token number">90</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> Pie100 <span class="token operator">=</span> <span class="token function">Template</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>Pie100<span class="token punctuation">.</span>args <span class="token operator">=</span> <span class="token punctuation">{</span>value<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>Enter the command <code>npm run storybook</code>. This starts the Storybook server and opens the Storybook page in your default web browser. Click the <code>Pie</code> component in the left nav to expand it and click &quot;Pie 30&quot; which renders the following:</p><p><img alt="Pie story" class="keep-size" src="/blog/assets/svelte-storybook-1.png?v=1.0.10"></p><h2 id="adding-controls">Adding Controls</h2><p>It would be nice if we could interactively change the value used by the <code>Pie</code> component. One way to do this is to introduce a new Svelte component that includes a slider for changing the value and then add a Storybook story for it.</p><p>Here is that component, defined in the file <code>src/stories/PieWithControl.svelte</code>:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token keyword">import</span> Pie <span class="token keyword">from</span> <span class="token string">'../Pie.svelte'</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>main</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>value<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Value<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>value<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">bind:</span>value</span> <span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Pie</span> <span class="token attr-name">{value}</span> <span class="token punctuation">/></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main</span><span class="token punctuation">></span></span></code></pre><p>And here is the new Storybook story for this component defined in the file <code>src/stories/PieWithControl.stories.js</code>:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> PieWithControl <span class="token keyword">from</span> <span class="token string">'./PieWithControl.svelte'</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><br>  title<span class="token operator">:</span> <span class="token string">'PieWithControl'</span><span class="token punctuation">,</span><br>  component<span class="token operator">:</span> PieWithControl<br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">Template</span> <span class="token operator">=</span> <span class="token parameter">props</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>Component<span class="token operator">:</span> PieWithControl<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> Primary <span class="token operator">=</span> <span class="token function">Template</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>When this story is selected in Storybook, the following is rendered:</p><p><img alt="PieWithControl story" class="keep-size" src="/blog/assets/svelte-storybook-2.png?v=1.0.10"></p><p>Now the slider value can be changed to render the <code>Pie</code> component with any value from zero to 100.</p><h2 id="static-deploy">Static Deploy</h2><p>Sometimes it is desirable to generate and deploy a static version of Storybook, including all the registered components, to allow others to view the components. To generate a static version of Storybook, enter <code>npm run build-storybook</code>. This creates the <code>storybook-static</code> directory containing all the required HTML and JavaScript files. All required CSS rules are compiled into the JavaScript. This directory can be copied to any web server. To view it locally, simply open the <code>index.html</code> file in a web browser.</p><h2 id="conclusion">Conclusion</h2><p>Storybook provides a nice way to see a list of components used by an app, demonstrate them in various states, and to interact with them. When a bug is discovered in a component, it can be debugged in the context of Storybook, which is typically faster than debugging in an app that uses it because there is no need to navigate to where the component is used.</p></article>