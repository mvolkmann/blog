<link rel="preload" as="style" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/prism-a11y.css"><link rel="stylesheet" href="/blog/assets/topic.css"><script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script><h2>SvelteKit</h2><aside><nav class="toc"><ol><li><a href="#overview">Overview</a></li><li><a href="#getting-started">Getting Started</a></li><li><a href="#typescript">TypeScript</a></li><li><a href="#file-based-page-routing">File-based Page Routing</a></li><li><a href="#file-based-endpoints-(rest-services)">File-based Endpoints (REST services)</a></li><li><a href="#recommended-directory-structure">Recommended Directory Structure</a></li><li><a href="#layouts">Layouts</a></li><li><a href="#error-page">Error Page</a></li><li><a href="#code-splitting">Code Splitting</a></li><li><a href="#hot-module-reloading">Hot Module Reloading</a></li><li><a href="#static-pages-and-sites">Static Pages and Sites</a></li><li><a href="#tool-setup">Tool Setup</a></li><li><a href="#path-aliases">Path Aliases</a></li><li><a href="#provided-modules">Provided Modules</a><ol><li><a href="#%24app%2Fenv">$app/env</a></li><li><a href="#%24app%2Fnavigation">$app/navigation</a></li><li><a href="#%24app%2Fpaths">$app/paths</a></li><li><a href="#%24app%2Fstores">$app/stores</a></li><li><a href="#%24service-worker">$service-worker</a></li></ol></li><li><a href="#adapters">Adapters</a><ol><li><a href="#netlify-example">Netlify Example</a></li></ol></li></ol></nav></aside><article><h2 id="overview" tabindex="-1">Overview</h2><p><a href="https://kit.svelte.dev?v=1.1.1" rel="noopener" target="_blank">SvelteKit</a> is a framework that leverages Svelte and is a replacement for previous framework Sapper. It is similar to Next for React and Nuxt for Vue.</p><p>The main features of SvelteKit are:</p><ul><li>file-based page routing</li><li>file-based endpoints (REST services)</li><li>layouts (ex. common page header, footer, and nav)</li><li>error page</li><li>code splitting for JS and CSS</li><li>first page visit is server-rendered for performance and remaining pages are rendered in the browser</li><li>page visits only load the JS and CSS they need</li><li>hot reloading (provided by Vite; very fast!)</li><li>can build static sites and individual static pages</li><li>offline support with ServiceWorkers</li><li>CLI tool that provides:<ul><li>setup of TypeScript</li><li>setup of Sass or Less CSS preprocessors</li><li>setup of ESLint</li><li>setup of Prettier</li></ul></li><li>adapters for specific deployment targets</li></ul><h2 id="getting-started" tabindex="-1">Getting Started</h2><p>To create a new SvelteKit project:</p><ol><li><p>Install Node.js</p></li><li><p>Enter <code>npm create svelte@latest [project-name]</code><br>Omit the project name to create a SvelteKit project in the current directory.</p></li><li><p>Answer the following question:</p><ul><li>Which SvelteKit app template? &quot;Skeleton project&quot; is recommended.</li><li>Add type checking with TypeScript? &quot;Yes, using TypeScript syntax&quot; is recommended.</li><li>Select additional options. All are recommended.</li></ul></li><li><p>Following instructions for next steps that are output.</p><ul><li>Enter <code>cd project-name</code></li><li>Enter <code>npm install</code></li></ul></li></ol><p>To run a SvelteKit project:</p><ol><li><p><code>cd</code> to the project root directory.</p></li><li><p>To run in development mode, enter <code>npm run dev</code><br>This provides watch and live reload. Optionally add options after <code>--</code>. The <code>--open</code> or <code>-o</code> option opens the app in the default web browser.<br>The <code>--port</code> or <code>-p</code> option specifies a port listen on which defaults to 3000.</p></li><li><p>To run the ESlint linter, enter <code>npm run lint</code></p></li><li><p>To run the Prettier code formatter, enter <code>npm run format</code></p></li></ol><h2 id="typescript" tabindex="-1">TypeScript</h2><p>The TypeScript types used by SvelteKit can be found in the files in the <code>node_modules/@sveltejs/kit/types</code> directory. Routes that need to load data before they are rendered do so by defining a <code>load</code> function in their module context. The <code>load</code> function has a single parameter whose type is <code>LoadInput</code> and it returns a <code>Promise&lt;LoadOutput&gt;</code>.</p><h2 id="file-based-page-routing" tabindex="-1">File-based Page Routing</h2><p>SvelteKit supports two kinds of routes, pages and endpoints. This section describes page routes. Endpoint routes are described in the next section.</p><p>The page routes of a SvelteKit app are defined by files and directories inside the <code>src/routes</code> directory. These can be rendered on the server or in the browser, depending on configuration.</p><p>There are two ways to define a new page route. Suppose the desired route name is &quot;some-route&quot;. The first approach is to add the file <code>src/routes/some-route.svelte</code> that describes a Svelte component to render.</p><p>The second approach is to add the directory <code>src/routes/some-route</code> with the file <code>index.svelte</code> inside it that describes a Svelte component to render. This approach is often used when there are other route-specific source files so they can be grouped in the same directory.</p><p>In both cases the route is rendered by adding <code>/some-route</code> to the end of the base URL for the app.</p><p>Routes that require loading data before they are rendered can do so by defining a <code>load</code> function in their module context. For example:</p><pre class="language-ts"><code class="language-ts"><span class="token operator">&lt;</span>script context<span class="token operator">=</span><span class="token string">"module"</span> lang<span class="token operator">=</span><span class="token string">"ts"</span><span class="token operator">></span><br>  <span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span>LoadInput<span class="token punctuation">,</span> LoadOutput<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@sveltejs/kit/types'</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">{</span>context<span class="token punctuation">,</span> fetch<span class="token punctuation">,</span> page<span class="token punctuation">,</span> session<span class="token punctuation">}</span><span class="token operator">:</span> LoadInput<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>LoadOutput<span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> dogId <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span>params<span class="token punctuation">.</span>someId<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/dog/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dogId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">const</span> dog <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">return</span> <span class="token punctuation">{</span>props<span class="token operator">:</span> <span class="token punctuation">{</span>dog<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><br><br><span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">"ts"</span><span class="token operator">></span><br>  <span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span>Dog<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'$lib/types'</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">export</span> <span class="token keyword">let</span> dog<span class="token operator">:</span> Dog<span class="token punctuation">;</span><br><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><br><br><span class="token operator">&lt;</span>h2<span class="token operator">></span>Dog<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span><br><br><span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">{</span>dog<span class="token punctuation">.</span>name<span class="token punctuation">}</span> <span class="token keyword">is</span> a <span class="token punctuation">{</span>dog<span class="token punctuation">.</span>breed<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span></code></pre><p>The <code>LoadInput</code> object passed to the <code>load</code> function contains four properties.</p><p>The <code>context</code> property is a <code>Context</code> object.</p><p>The <code>fetch</code> property is a function used to send an HTTP request. <code>fetch: (info: RequestInfo, init?: RequestInit) =&gt; Promise&lt;Response&gt;</code> This can be called to send an HTTP request to any server, including the one provided by SvelteKit where endpoints (described next) are hosted.</p><p>The <code>page</code> property is a <code>Page&lt;PageParams&gt;</code> object.</p><p>The <code>session</code> property is a <code>Session</code> object.</p><p>The file <code>src/routes/index.svelte</code> defines the page to render at the <code>/</code> route. To render this page when running the app locally on the default port, browse <code>localhost:3000</code>.</p><p>Nested subdirectories under <code>src/routes</code> define routes at URL paths with multiple path parts. Directories with names that begin with <code>[</code> and end with <code>]</code> represent path parameters (a.k.a dynamic parameters). For example, suppose a page is defined in the file <code>src/routes/person/[personId]/dog/[dogId]/index.svelte</code>. To render the page for the person with id 19 and the dog with id 2, browse <code>localhost:3000/person/19/dog/2</code>.</p><h2 id="file-based-endpoints-(rest-services)" tabindex="-1">File-based Endpoints (REST services)</h2><p>Endpoints are defined by creating <code>.js</code> or <code>.ts</code> files under the <code>src/routes</code> directory. This code is executed by a provided Node.js server, or a build time for pre-rendered pages. It is never executed in a browser.</p><p>Endpoints can access data from sources like databases. They return data as JSON by default, but other data formats can also be returned.</p><p>There are two common conventions for defining endpoints. One is to create an <code>api</code> directory in <code>src/routes</code> and create files in that directory and below. Another is to create files with a <code>.json.js</code> or <code>.json.ts</code> extension. TODO: Try the second option to verify.</p><p>TODO: Finish this</p><h2 id="recommended-directory-structure" tabindex="-1">Recommended Directory Structure</h2><p>This is my opinion on what makes a good directory structure for a SvelteKit project.</p><ul><li><code>.env</code> defines environment variables with names starting with VITE_</li><li><code>src</code><ul><li><code>app.html</code> is the topmost HTML file (import third-party CSS files here)</li><li><code>global.css</code> defines CSS rules that can affect all components</li><li><code>lib</code><ul><li><code>env.ts</code> imports environment variables from <code>.env</code> file and exports them so Svelte components can use them</li><li>shared JS functions</li><li>components used by multiple pages</li><li><code>stores.ts</code> defines stores used by multiple page</li></ul></li><li><code>routes</code><ul><li><code>index.svelte</code> defines the home page (import <code>global.css</code> here?)</li><li><code>api</code><ul><li>directories and files for file-based API routes</li></ul></li><li><code>page-name-1</code><ul><li><code>stores.ts</code> defines stores used only by this page</li><li><code>types.ts</code> defines types used only by this page</li><li><code>index.svelte</code> defines the top level of the page</li><li>components used only by this page</li></ul></li><li><code>page-name-2</code><ul><li><code>stores.ts</code> defines stores used only by this page</li><li><code>types.ts</code> defines types used only by this page</li><li><code>index.svelte</code> defines the top level of the page</li><li>components used only by this page</li></ul></li></ul></li></ul></li></ul><h2 id="layouts" tabindex="-1">Layouts</h2><p>TODO: Finish this</p><h2 id="error-page" tabindex="-1">Error Page</h2><p>TODO: Finish this</p><h2 id="code-splitting" tabindex="-1">Code Splitting</h2><p>TODO: Finish this</p><h2 id="hot-module-reloading" tabindex="-1">Hot Module Reloading</h2><p>TODO: Finish this</p><h2 id="static-pages-and-sites" tabindex="-1">Static Pages and Sites</h2><p>TODO: Finish this</p><h2 id="tool-setup" tabindex="-1">Tool Setup</h2><p>Creation of a new SvelteKit project prompts for desired features. It asks the following questions:</p><p>&quot;Use TypeScript in components?&quot; This defaults to no.</p><p>&quot;What do you want to use for writing Styles in Svelte components?&quot; The options are CSS (default), Less, and SCSS.</p><p>&quot;Add ESLint for code listing?&quot; This defaults to no.</p><p>&quot;Add Prettier for code formatting?&quot; This defaults to no.</p><h2 id="path-aliases" tabindex="-1">Path Aliases</h2><p>SvelteKit provides directory aliases. These can only be used in import path strings. They are not variables.</p><p><code>$app</code> is used to import various modules described below.</p><p><code>$lib</code> is an alias to the <code>src/lib</code> directory. It is used to import your own source files without using relative paths.</p><h2 id="provided-modules" tabindex="-1">Provided Modules</h2><h3 id="%24app%2Fenv" tabindex="-1"><code>$app/env</code></h3><p>To use this module, import the desired items as follows:</p><p><code>import { amp, browser, dev } from '$app/env';</code></p><p><code>amp</code> is a boolean that indicates whether the app uses <a href="https://developers.google.com/amp?v=1.1.1" rel="noopener" target="_blank">Accelerated Mobile Pages (AMP)</a> created by Google.</p><p><code>browser</code> is a boolean that indicates whether the code is running in the browser. When the value is <code>false</code>, the code is running on the server.</p><p><code>dev</code> is a boolean that indicates whether the code is running in development mode. When the value is <code>false</code>, the code is running in production mode.</p><h3 id="%24app%2Fnavigation" tabindex="-1"><code>$app/navigation</code></h3><p>To use this module, import the desired items as follows:</p><p><code>import { goto, prefetch, prefetchRoutes } from '$app/navigation';</code></p><p><code>goto</code> is a function that programmatically navigates to a new route. This is preferred over setting <code>location.href</code>.</p><p><code>prefetch</code> is a function that programmatically prefetches the page at a given route. It can be called before calling <code>goto</code> to improve performance. This is appropriate when it can be anticipated that the user will want to go to the page soon. It is the same functionality that is triggered by hovering over a link that uses the <code>sveltekit:prefetch</code> attribute.</p><p><code>prefetchRoutes</code> is a function that programmatically prefetches a set of pages at given routes or all pages.</p><h3 id="%24app%2Fpaths" tabindex="-1"><code>$app/paths</code></h3><p>To use this module, import the desired items as follows:</p><p><code>import { base, assets } from '$app/paths';</code></p><p>These are directory paths that are relative to the root project directory. The default to that directory, but can be modified in <code>svelte.config.cjs</code> at the property paths <code>kit.paths.assets</code> and <code>kit.paths.base</code>. Changing these doesn't seem very useful.</p><h3 id="%24app%2Fstores" tabindex="-1"><code>$app/stores</code></h3><p>To use this module, import the desired items as follows:</p><p><code>import { getStores, navigating, page, session } from '$app/stores';</code></p><p><code>getStores</code> is a function that returns an object containing the other three values. This doesn't seem useful.</p><p><code>navigating</code> is a readable store whose value is <code>null</code> when not navigating and an object with <code>from</code> and <code>to</code> properties when navigating. TODO: Why does this seem to always be null?</p><p><code>page</code> is a readable store that holds the data passed to page <code>load</code> functions, including <code>host</code>, <code>path</code>, <code>params</code>, and <code>query</code> for getting information about a request.</p><p><code>session</code> is a writable store that holds session data. However, setting it doesn't not cause data to be persisted on the server. If desired, that must be implemented.</p><h3 id="%24service-worker" tabindex="-1"><code>$service-worker</code></h3><p>To use this module, import the desired items as follows:</p><p><code>import { build, files, timestamp } from '$service-worker';</code></p><p><code>build</code> is an array of URLs for the files generated by Vite. These files can be cached by calling <code>cache.addAll(build)</code>.</p><p><code>files</code> is an array of URLs for the files in directory specified by <code>kit.files.assets</code> in the <code>svelte.config.cjs</code> file which defaults to <code>static</code>.</p><p><code>timestamp</code> is the value of <code>Date.now()</code> (milliseconds) at build time. It can be used generate a unique cache name which enables invalidating the caches of subsequent deploys.</p><h2 id="adapters" tabindex="-1"><a name="adapter">Adapters</a></h2><p>The provided adapter targets currently include Node.js, static, Begin, Netlify, and Vercel. New SvelteKit projects default to using the Node adapter. To change the adapter, modify the <code>svelte.config.cjs</code> file.</p><h3 id="netlify-example" tabindex="-1">Netlify Example</h3><ul><li><p>cd to the root directory of a SvelteKit project.</p></li><li><p>Install the Netlify SvelteKit adapter with <code>npm install -D @sveltejs/adapter-netlify@next</code></p><p>This deploys SvelteKit endpoints as serverless functions in AWS without requiring an AWS account.</p></li><li><p>Edit <code>svelte.config.cjs</code></p><ul><li>Change the first line to the following:</li></ul><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> adapter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@sveltejs/adapter-netlify'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ul><li><p>Change the &quot;adapter&quot; line to the following:</p><pre class="language-js"><code class="language-js"><span class="token literal-property property">adapter</span><span class="token operator">:</span> <span class="token function">adapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre></li></ul></li><li><p>Create the file <code>netlify.toml</code> in the project root directory containing the following:</p><pre class="language-toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">build</span><span class="token punctuation">]</span><br><span class="token key property">command</span> <span class="token punctuation">=</span> <span class="token string">"npm run build"</span><br><span class="token key property">functions</span><span class="token punctuation">=</span><span class="token string">"functions/"</span><br><span class="token key property">publish</span><span class="token punctuation">=</span><span class="token string">"build/"</span></code></pre></li><li><p>Create a GitHub repository to hold the project files, add all the files, and push.</p></li><li><p>Create a Netlify account if you don't already have one.</p><p>Browse <a href="https://www.netlify.com">https://www.netlify.com</a> and click &quot;Sign up&quot;.</p></li><li><p>Login to your Netlify account.</p></li><li><p>Press the &quot;New site from Git&quot; button.</p></li><li><p>Press the &quot;GitHub&quot; button.</p></li><li><p>Select the repository created above.</p><p>If you configured your account to only provide access to selected repositories, click the &quot;Configure the Netlify app on GitHub&quot; link, click &quot;Configure&quot;, scroll down to &quot;Repository access&quot;, click the &quot;Select repositories&quot; drop down, search for the repository, select it, and press the &quot;Save&quot; button.</p></li><li><p>Verify the settings displayed (defaults should be fine) and press the &quot;Deploy site&quot; button.</p></li><li><p>Wait for deployment to complete and note its URL.</p></li><li><p>Browse the URL to run the app.</p></li></ul><p>Note: I was expecting each SvelteKit endpoint to show up as a separate Netlify function. But instead I see just one Netlify function named &quot;render&quot;. I know it's working because if I add a <code>console.log</code> in the code of each of my endpoints, push the changes, wait for it to be redeployed to Netlify, run the new version of app to trigger calls to the endpoints, and then click that &quot;render&quot; function in Netlify, I do see the expected output from the <code>console.log</code> calls. It seems odd that all the endpoints are bundled into one Netlify function.</p></article>